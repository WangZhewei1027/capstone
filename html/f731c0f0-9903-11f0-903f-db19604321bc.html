<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Bubble Sort Visualization</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        background-color: #f0f0f0;
        margin: 0;
        padding: 20px;
      }
      canvas {
        background-color: #fff;
        border: 1px solid #333;
        display: block;
        margin: 20px auto;
      }
      button {
        padding: 10px 20px;
        margin: 10px;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <h1>Bubble Sort Visualization</h1>
    <canvas id="canvas" width="600" height="400"></canvas>
    <div>
      <button id="start">Start Bubble Sort</button>
      <button id="reset">Reset Array</button>
    </div>
    
    <script>
      // Get canvas and context
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      // Global variables for the array and our bubble sort pointers
      let arr = [];
      let i = 0, j = 0;
      let intervalId = null;

      // Initialize the random array and reset indices
      function init() {
        arr = [];
        const numberOfBars = 50;
        for (let k = 0; k < numberOfBars; k++) {
          // Generate a random height between 20 and canvas height (to avoid too short bars)
          arr.push(Math.floor(Math.random() * (canvas.height - 20)) + 20);
        }
        i = 0;
        j = 0;
        draw();
      }

      // Draw the array bars on the canvas.
      // If sorting is complete (i >= arr.length), display all bars in green.
      // Otherwise, highlight the two bars being compared in red.
      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const barWidth = canvas.width / arr.length;
        for (let k = 0; k < arr.length; k++) {
          if (i >= arr.length) {
            // Sorting complete
            ctx.fillStyle = "green";
          } else if (k === j || k === j + 1) {
            // Current pair being compared
            ctx.fillStyle = "red";
          } else {
            ctx.fillStyle = "blue";
          }
          ctx.fillRect(k * barWidth, canvas.height - arr[k], barWidth - 1, arr[k]);
        }
      }

      // Execute one "step" of bubble sort.
      // This function compares and swaps a single pair of adjacent elements,
      // then updates the indices. When done, it stops the interval.
      function bubbleSortStep() {
        if (i < arr.length) {
          if (j < arr.length - i - 1) {
            if (arr[j] > arr[j + 1]) {
              // Swap the elements
              const temp = arr[j];
              arr[j] = arr[j + 1];
              arr[j + 1] = temp;
            }
            j++;
          } else {
            // End of one full pass, reset inner index and move the outer pointer
            j = 0;
            i++;
          }
        } else {
          // Sorting is complete
          clearInterval(intervalId);
          intervalId = null;
        }
        draw();
      }

      // Start button event: Reset indices and start the interval to animate sorting
      document.getElementById("start").addEventListener("click", function () {
        if (intervalId) {
          clearInterval(intervalId);
        }
        // Reset counters to re-run the sort
        i = 0;
        j = 0;
        intervalId = setInterval(bubbleSortStep, 50);
      });

      // Reset button: Stop any ongoing sort and generate a new random array.
      document.getElementById("reset").addEventListener("click", function () {
        if (intervalId) {
          clearInterval(intervalId);
          intervalId = null;
        }
        init();
      });

      // Initialize the array and draw it on page load.
      init();
    </script>
  </body>
</html>