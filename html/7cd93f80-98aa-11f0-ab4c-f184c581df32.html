<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Bubble Sort Visualizer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#0f1724;
      --panel:#0b1320;
      --accent:#06b6d4;
      --muted:#94a3b8;
      --good:#16a34a;
      --bad:#ef4444;
      --compare:#f59e0b;
      --bar-bg:#0b1220;
    }
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
    body{background:linear-gradient(180deg,var(--bg),#07101a);color:#e6eef8;display:flex;flex-direction:column;align-items:stretch;padding:18px;box-sizing:border-box;}
    h1{margin:0 0 8px 0;font-size:20px;}
    .app{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:1fr 360px;gap:18px;align-items:start;}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.0));border:1px solid rgba(255,255,255,0.04);padding:14px;border-radius:12px;box-shadow: 0 6px 18px rgba(2,6,23,0.6);}
    .controls{display:flex;flex-direction:column;gap:10px;}
    .row{display:flex;gap:8px;align-items:center;}
    label{color:var(--muted);font-size:13px;}
    button{background:transparent;border:1px solid rgba(255,255,255,0.06);color:inherit;padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:600;}
    button.primary{background:linear-gradient(90deg,var(--accent),#62d6d9);color:#042028;border:none;box-shadow:0 6px 18px rgba(6,182,212,0.12);}
    button:disabled{opacity:0.45;cursor:default;}
    .controls .row > *{flex:1;}
    .vis{height:420px;display:flex;flex-direction:column;gap:12px;}
    .bars{background:var(--bar-bg);flex:1;border-radius:8px;padding:12px;display:flex;align-items:flex-end;gap:6px;overflow:hidden;}
    .bar{flex:1 1 auto;display:flex;align-items:flex-end;justify-content:center;border-radius:6px 6px 2px 2px;transition:height 150ms linear, background 150ms linear, transform 150ms;position:relative;}
    .bar .val{font-size:11px;color:rgba(255,255,255,0.9);padding-bottom:6px;text-shadow:0 1px 0 rgba(0,0,0,0.6);}
    .stats{display:flex;gap:10px;flex-wrap:wrap;color:var(--muted);font-size:13px;margin-top:6px;}
    .badge{background:rgba(255,255,255,0.03);padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.02);min-width:88px;text-align:center;}
    .pseudocode{font-family:monospace;background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;color:var(--muted);font-size:13px;line-height:1.5;white-space:pre;}
    .highlight{background:rgba(255,255,255,0.04);color:#fff;padding:2px 4px;border-radius:4px;}
    .footer{font-size:13px;color:var(--muted);margin-top:8px;}
    .small{font-size:12px;color:var(--muted);}
    .top-controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
    input[type="range"]{width:100%;}
    .center{display:flex;justify-content:center;align-items:center;gap:8px;}
    .legend{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
    .legend .item{display:flex;gap:6px;align-items:center;color:var(--muted);font-size:13px;}
    .color-swatch{width:14px;height:14px;border-radius:4px;}
    /* Colors for states */
    .bar.normal{background:linear-gradient(180deg,#0f2540,#0b1730);}
    .bar.compare{background:linear-gradient(180deg,var(--compare), #fab95d); transform:translateY(-4px);}
    .bar.swap{background:linear-gradient(180deg,var(--bad), #ff7b7b); transform:translateY(-6px);}
    .bar.sorted{background:linear-gradient(180deg,var(--good), #7ee7a8);}
    @media (max-width:980px){
      .app{grid-template-columns:1fr; padding-bottom:40px;}
      .panel{padding:12px;}
    }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Bubble sort visualizer">
    <div class="panel">
      <h1>Bubble Sort Visualizer</h1>
      <div class="vis" aria-live="polite">
        <div class="bars" id="bars" role="list" aria-label="Array bars"></div>
        <div class="stats" id="stats">
          <div class="badge">Comparisons: <span id="comp">0</span></div>
          <div class="badge">Swaps: <span id="swaps">0</span></div>
          <div class="badge">Pass: <span id="pass">0</span></div>
          <div class="badge">i / n: <span id="indices">-</span></div>
          <div class="badge">Status: <span id="status">Idle</span></div>
        </div>
      </div>
      <div class="footer small" style="margin-top:12px;">
        Complexity: Average/Worst O(n²), Best O(n) with early-exit optimization. Bubble sort repeatedly steps through the list, compares adjacent items and swaps them if out of order, "bubbling" largest/smallest to the end.
      </div>
    </div>

    <div class="panel">
      <div class="controls">
        <div class="top-controls">
          <button id="randomBtn" class="">Randomize</button>
          <button id="startBtn" class="primary">Start</button>
          <button id="stepBtn">Step</button>
          <button id="pauseBtn" disabled>Pause</button>
          <button id="resetBtn">Reset</button>
        </div>

        <div class="row">
          <label for="size">Array size: <span id="sizeVal">20</span></label>
          <input id="size" type="range" min="5" max="80" value="20">
        </div>

        <div class="row">
          <label for="speed">Speed (ms delay): <span id="speedVal">150</span></label>
          <input id="speed" type="range" min="10" max="600" value="150">
        </div>

        <div class="row">
          <label for="order">Order</label>
          <select id="order" aria-label="Sort order">
            <option value="asc">Ascending (small → left)</option>
            <option value="desc">Descending (large → left)</option>
          </select>
        </div>

        <div class="row legend">
          <div class="item"><span class="color-swatch" style="background:linear-gradient(180deg,#0f2540,#0b1730)"></span> Normal</div>
          <div class="item"><span class="color-swatch" style="background:linear-gradient(180deg,var(--compare), #fab95d)"></span> Comparing</div>
          <div class="item"><span class="color-swatch" style="background:linear-gradient(180deg,var(--bad), #ff7b7b)"></span> Swapping</div>
          <div class="item"><span class="color-swatch" style="background:linear-gradient(180deg,var(--good), #7ee7a8)"></span> Sorted</div>
        </div>

        <div style="margin-top:8px;">
          <div class="pseudocode" id="pseudocode" aria-hidden="true">
i = 0
while i < n-1:
  swapped = false
  for j from 0 to n-2-i:
    compare A[j] and A[j+1]
    if out of order:
      swap A[j] and A[j+1]
      swapped = true
  if not swapped:
    break
  i = i + 1
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Bubble Sort Visualizer
    (function(){
      const barsEl = document.getElementById('bars');
      const compEl = document.getElementById('comp');
      const swapsEl = document.getElementById('swaps');
      const passEl = document.getElementById('pass');
      const indicesEl = document.getElementById('indices');
      const statusEl = document.getElementById('status');

      const randomBtn = document.getElementById('randomBtn');
      const startBtn = document.getElementById('startBtn');
      const stepBtn = document.getElementById('stepBtn');
      const pauseBtn = document.getElementById('pauseBtn');
      const resetBtn = document.getElementById('resetBtn');

      const sizeRange = document.getElementById('size');
      const sizeVal = document.getElementById('sizeVal');
      const speedRange = document.getElementById('speed');
      const speedVal = document.getElementById('speedVal');
      const orderSelect = document.getElementById('order');

      let array = [];
      let initialArray = [];
      let bars = [];
      let comparisons = 0;
      let swaps = 0;
      let pass = 0;

      let gen = null;
      let playing = false;
      let autoTimer = null;

      function randInt(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }

      function createArray(n){
        const arr = [];
        // spread values so bar heights vary
        for(let i=0;i<n;i++) arr.push(randInt(10, 100));
        return arr;
      }

      function renderArray(arr){
        barsEl.innerHTML = '';
        bars = [];
        const max = Math.max(...arr, 1);
        for(let i=0;i<arr.length;i++){
          const el = document.createElement('div');
          el.className = 'bar normal';
          el.style.height = (arr[i] / max * 100) + '%';
          el.setAttribute('role','listitem');
          el.setAttribute('aria-label','Value '+arr[i]);
          const label = document.createElement('div');
          label.className = 'val';
          label.textContent = arr[i];
          el.appendChild(label);
          barsEl.appendChild(el);
          bars.push(el);
        }
      }

      function updateStats(){
        compEl.textContent = comparisons;
        swapsEl.textContent = swaps;
        passEl.textContent = pass;
      }

      function resetHighlights(){
        bars.forEach(b=>{ b.className='bar normal'; });
      }

      function markCompare(i,j){
        resetHighlights();
        if(bars[i]) bars[i].className='bar compare';
        if(bars[j]) bars[j].className='bar compare';
        indicesEl.textContent = i + ' / ' + j;
      }
      function markSwap(i,j){
        if(bars[i]) bars[i].className='bar swap';
        if(bars[j]) bars[j].className='bar swap';
        indicesEl.textContent = i + ' / ' + j;
      }
      function markSorted(index){
        if(bars[index]) bars[index].className='bar sorted';
      }

      // Bubble sort generator that yields actions for visualization
      function* bubbleGen(arr, ascending=true){
        const n = arr.length;
        let i = 0;
        while(i < n-1){
          let swapped = false;
          yield {type:'pass', pass:i+1};
          for(let j=0;j<n-1-i;j++){
            yield {type:'compare', i:j, j:j+1};
            if( (ascending && arr[j] > arr[j+1]) || (!ascending && arr[j] < arr[j+1]) ){
              // swap
              [arr[j], arr[j+1]] = [arr[j+1], arr[j]];
              yield {type:'swap', i:j, j:j+1};
              swapped = true;
            }
          }
          // after each pass, the last element in the unsorted portion is sorted
          yield {type:'sortedIndex', index: n-1-i};
          if(!swapped){
            // early exit
            yield {type:'done', early:true};
            return;
          }
          i++;
        }
        // mark remaining as sorted
        for(let k=0;k<n;k++){
          yield {type:'sortedIndex', index:k};
        }
        yield {type:'done', early:false};
      }

      function applyAction(action){
        switch(action.type){
          case 'pass':
            pass = action.pass;
            statusEl.textContent = 'Running pass ' + pass;
            break;
          case 'compare':
            comparisons++;
            markCompare(action.i, action.j);
            break;
          case 'swap':
            swaps++;
            // swap heights and labels in DOM to reflect array change
            const i = action.i, j = action.j;
            // swap style height and textContent
            const hi = bars[i].style.height;
            const hj = bars[j].style.height;
            const vi = bars[i].firstChild.textContent;
            const vj = bars[j].firstChild.textContent;
            bars[i].style.height = hj;
            bars[j].style.height = hi;
            bars[i].firstChild.textContent = vj;
            bars[j].firstChild.textContent = vi;
            markSwap(i,j);
            break;
          case 'sortedIndex':
            markSorted(action.index);
            break;
          case 'done':
            statusEl.textContent = action.early ? 'Done (early exit)' : 'Done';
            resetControlsAfterFinish();
            break;
        }
        updateStats();
      }

      function startAutoPlay(){
        if(!gen) return;
        playing = true;
        startBtn.disabled = true;
        pauseBtn.disabled = false;
        stepBtn.disabled = true;
        randomBtn.disabled = true;
        sizeRange.disabled = true;
        orderSelect.disabled = true;
        statusEl.textContent = 'Playing';
        const runStep = ()=>{
          const res = gen.next();
          if(res.done){
            playing = false;
            clearInterval(autoTimer);
            resetControlsAfterFinish();
            return;
          }
          applyAction(res.value);
        };
        // run first step immediately to be responsive
        runStep();
        autoTimer = setInterval(()=>{
          // if paused externally, skip
          if(!playing){ clearInterval(autoTimer); return; }
          const res = gen.next();
          if(res.done){
            playing = false;
            clearInterval(autoTimer);
            resetControlsAfterFinish();
            return;
          }
          applyAction(res.value);
        }, Number(speedRange.value));
      }

      function resetControlsAfterFinish(){
        startBtn.disabled = false;
        pauseBtn.disabled = true;
        stepBtn.disabled = false;
        randomBtn.disabled = false;
        sizeRange.disabled = false;
        orderSelect.disabled = false;
      }

      // Event handlers
      sizeRange.addEventListener('input', ()=>{
        sizeVal.textContent = sizeRange.value;
      });

      speedRange.addEventListener('input', ()=>{
        speedVal.textContent = speedRange.value;
        // if playing, restart interval with new speed
        if(playing){
          if(autoTimer) clearInterval(autoTimer);
          startAutoPlay();
        }
      });

      randomBtn.addEventListener('click', ()=>{
        const n = Number(sizeRange.value);
        array = createArray(n);
        initialArray = array.slice();
        comparisons = swaps = pass = 0;
        gen = null;
        playing = false;
        if(autoTimer) clearInterval(autoTimer);
        resetHighlights();
        renderArray(array);
        updateStats();
        statusEl.textContent = 'Ready';
        resetBtn.disabled = false;
      });

      startBtn.addEventListener('click', ()=>{
        if(!gen){
          // create a new generator on a copy of the current DOM state
          // ensure array matches what's currently displayed
          array = bars.map(b => Number(b.firstChild.textContent));
          gen = bubbleGen(array, orderSelect.value === 'asc');
        }
        if(playing) return;
        startAutoPlay();
      });

      pauseBtn.addEventListener('click', ()=>{
        playing = false;
        if(autoTimer) clearInterval(autoTimer);
        startBtn.disabled = false;
        pauseBtn.disabled = true;
        stepBtn.disabled = false;
        statusEl.textContent = 'Paused';
      });

      stepBtn.addEventListener('click', ()=>{
        if(!gen){
          array = bars.map(b => Number(b.firstChild.textContent));
          gen = bubbleGen(array, orderSelect.value === 'asc');
        }
        const res = gen.next();
        if(res.done){
          resetControlsAfterFinish();
          return;
        }
        applyAction(res.value);
      });

      resetBtn.addEventListener('click', ()=>{
        // reset to initial array before sorting
        if(initialArray.length){
          array = initialArray.slice();
          renderArray(array);
          comparisons = swaps = pass = 0;
          updateStats();
          gen = null;
          playing = false;
          if(autoTimer) clearInterval(autoTimer);
          statusEl.textContent = 'Reset';
        } else {
          // otherwise randomize
          randomBtn.click();
        }
      });

      // Initialize
      (function init(){
        sizeVal.textContent = sizeRange.value;
        speedVal.textContent = speedRange.value;
        array = createArray(Number(sizeRange.value));
        initialArray = array.slice();
        renderArray(array);
        updateStats();
        statusEl.textContent = 'Ready';
      })();

      // Keyboard shortcuts (optional)
      window.addEventListener('keydown', (e)=>{
        if(e.key === ' ') { e.preventDefault(); if(!playing) startBtn.click(); else pauseBtn.click(); }
        if(e.key === 's') stepBtn.click();
        if(e.key === 'r') randomBtn.click();
      });
    })();
  </script>
</body>
</html>