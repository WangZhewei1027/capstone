<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>K-Nearest Neighbor Demo</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      canvas {
        border: 1px solid #ccc;
        background: #f0f0f0;
      }
      .controls {
        margin: 15px 0;
      }
      input,
      button {
        padding: 8px;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <h2>K-Nearest Neighbor Visualization</h2>
    <div class="controls">
      K Value:
      <input type="number" id="kInput" min="1" value="3" style="width: 50px" />
      <button onclick="clearPoints()">Clear</button>
      <button onclick="addRandomPoints()">Add Random</button>
    </div>
    <canvas id="canvas" width="600" height="400"></canvas>
    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      let points = [];
      let queryPoint = null;

      class Point {
        constructor(x, y, cls) {
          this.x = x;
          this.y = y;
          this.cls = cls; // 0=blue, 1=red
        }
      }

      function distance(a, b) {
        return Math.hypot(a.x - b.x, a.y - b.y);
      }

      function classify(query, k) {
        if (points.length == 0) return 0;
        const sorted = points
          .map((p) => ({
            point: p,
            dist: distance(query, p),
          }))
          .sort((a, b) => a.dist - b.dist);

        const counts = [0, 0];
        for (let i = 0; i < k && i < sorted.length; i++) {
          counts[sorted[i].point.cls]++;
        }
        return counts[0] >= counts[1] ? 0 : 1;
      }

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Draw grid
        ctx.strokeStyle = "#eee";
        for (let x = 0; x <= canvas.width; x += 50)
          ctx.moveTo(x, 0), ctx.lineTo(x, canvas.height);
        for (let y = 0; y <= canvas.height; y += 50)
          ctx.moveTo(0, y), ctx.lineTo(canvas.width, y);
        ctx.stroke();

        // Draw points
        ctx.fillStyle = "rgba(0,0,0,0.2)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        points.forEach((p) => {
          ctx.fillStyle = p.cls ? "#ff4444" : "#44ff44";
          ctx.beginPath();
          ctx.arc(p.x, p.y, 6, 0, Math.PI * 2);
          ctx.fill();
        });

        if (queryPoint) {
          const k = parseInt(document.getElementById("kInput").value);
          const cls = classify(queryPoint, k);

          ctx.strokeStyle = "gold";
          ctx.lineWidth = 2;
          const neighbors = points
            .slice(0, k)
            .sort((a, b) => distance(queryPoint, a) - distance(queryPoint, b));

          neighbors.forEach((p) => {
            ctx.beginPath();
            ctx.moveTo(queryPoint.x, queryPoint.y);
            ctx.lineTo(p.x, p.y);
            ctx.stroke();
          });

          ctx.fillStyle = "rgba(255,215,0,0.5)";
          ctx.beginPath();
          ctx.arc(queryPoint.x, queryPoint.y, 15, 0, Math.PI * 2);
          ctx.fill();

          ctx.fillStyle = "white";
          ctx.font = "16px Arial";
          ctx.fillText(cls ? "Red" : "Blue", queryPoint.x + 20, queryPoint.y);
        }
      }

      canvas.addEventListener("click", (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        if (points.length < 2) {
          points.push(new Point(x, y, points.length % 2));
        } else {
          queryPoint = { x, y };
        }
        draw();
      });

      function clearPoints() {
        points = [];
        queryPoint = null;
        draw();
      }

      function addRandomPoints() {
        for (let i = 0; i < 10; i++) {
          points.push(
            new Point(
              Math.random() * canvas.width,
              Math.random() * canvas.height,
              Math.floor(Math.random() * 2)
            )
          );
        }
        draw();
      }

      draw();
    </script>
  </body>
</html>
