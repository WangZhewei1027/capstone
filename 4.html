<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Bubble Sort — Visual Demo (Single HTML)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        --bg: #0f1220;
        --panel: #181b2e;
        --accent: #6ee7ff;
        --accent-2: #a78bfa;
        --text: #eef2ff;
        --muted: #9aa3b2;
        --good: #22c55e;
        --warn: #f59e0b;
        --bad: #ef4444;
        --bar: #3b82f6;
        --bar-active: #f43f5e;
        --bar-sorted: #22c55e;
        --ring: 0 0 0 2px rgba(110, 231, 255, 0.45),
          0 10px 30px -12px rgba(110, 231, 255, 0.3);
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font: 15px/1.45 system-ui, -apple-system, Segoe UI, Roboto,
          "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--text);
        background: radial-gradient(
          1200px 600px at 70% -10%,
          #1f254a 0%,
          #121528 40%,
          var(--bg) 70%
        );
      }
      .wrap {
        max-width: 1100px;
        margin: 28px auto 60px;
        padding: 0 16px;
      }
      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 14px;
        margin-bottom: 18px;
      }
      h1 {
        font-size: clamp(22px, 4vw, 34px);
        margin: 0;
        letter-spacing: 0.3px;
        background: linear-gradient(90deg, var(--accent), var(--accent-2));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
      }
      .tagline {
        color: var(--muted);
        margin-top: 6px;
        font-size: 13px;
      }

      .panel {
        background: linear-gradient(
            180deg,
            rgba(255, 255, 255, 0.02),
            transparent 30%
          ),
          var(--panel);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 14px;
        padding: 14px;
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.24);
      }

      /* Controls */
      .controls {
        display: grid;
        grid-template-columns: 1fr;
        gap: 12px;
      }
      @media (min-width: 760px) {
        .controls {
          grid-template-columns: 1.2fr 0.8fr;
          align-items: start;
        }
      }

      .row {
        display: flex;
        flex-wrap: wrap;
        gap: 10px 12px;
        align-items: center;
      }
      .row label {
        color: var(--muted);
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.06em;
      }
      .row .val {
        color: var(--text);
        font-weight: 600;
        margin-left: 6px;
      }
      input[type="range"] {
        width: 180px;
      }
      input[type="text"] {
        width: 100%;
        padding: 9px 12px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(255, 255, 255, 0.04);
        color: var(--text);
        outline: none;
      }
      .btn {
        appearance: none;
        border: 0;
        padding: 10px 14px;
        border-radius: 10px;
        color: #0b1022;
        font-weight: 700;
        cursor: pointer;
        transition: 0.2s transform, 0.2s box-shadow, 0.2s background;
        background: linear-gradient(180deg, #7dd3fc, #60a5fa);
        box-shadow: var(--ring);
      }
      .btn.secondary {
        background: linear-gradient(180deg, #c4b5fd, #a78bfa);
      }
      .btn.ghost {
        background: rgba(255, 255, 255, 0.06);
        color: var(--text);
        box-shadow: none;
        border: 1px solid rgba(255, 255, 255, 0.12);
      }
      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        box-shadow: none;
      }
      .btn:hover:not(:disabled) {
        transform: translateY(-1px);
      }
      .btn:active:not(:disabled) {
        transform: translateY(0);
      }

      /* Stats */
      .stats {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }
      .stat {
        flex: 1 1 140px;
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.08);
        padding: 10px 12px;
        border-radius: 12px;
      }
      .stat .k {
        font-size: 11px;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }
      .stat .v {
        font-size: 18px;
        font-weight: 800;
        margin-top: 2px;
      }

      /* Bars area */
      .stage {
        margin-top: 16px;
        height: 360px;
        background: linear-gradient(
            180deg,
            rgba(255, 255, 255, 0.02),
            transparent 35%
          ),
          #0b1022;
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 14px;
        position: relative;
        overflow: hidden;
      }
      .bar {
        position: absolute;
        bottom: 0;
        width: var(--w);
        left: var(--x);
        height: var(--h);
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.35),
          rgba(255, 255, 255, 0.1) 10%,
          var(--bar)
        );
        border-top-left-radius: 6px;
        border-top-right-radius: 6px;
        transition: left var(--t) ease, height 0.15s ease,
          background-color 0.2s ease, transform 0.15s ease;
      }
      .bar.active {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.5),
          rgba(255, 255, 255, 0.12) 10%,
          var(--bar-active)
        );
        transform: translateY(-3px);
      }
      .bar.sorted {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.45),
          rgba(255, 255, 255, 0.12) 10%,
          var(--bar-sorted)
        );
      }

      footer {
        margin-top: 18px;
        color: var(--muted);
        font-size: 12px;
        text-align: center;
      }
      code.k {
        color: #c7d2fe;
        background: rgba(99, 102, 241, 0.15);
        padding: 2px 6px;
        border-radius: 6px;
      }
      a {
        color: var(--accent);
        text-decoration: none;
      }
      a:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <div>
          <h1>Bubble Sort — Visual Demo</h1>
          <div class="tagline">
            Classic O(n<span style="font-size: 11px; vertical-align: top"
              >2</span
            >) sorting with swaps & comparisons highlighted. Edit, randomize,
            step, or autoplay.
          </div>
        </div>
        <button class="btn ghost" id="aboutBtn" title="What is Bubble Sort?">
          ℹ️ About
        </button>
      </header>

      <div class="panel">
        <div class="controls">
          <div>
            <div class="row" style="margin-bottom: 10px">
              <label for="arrayInput">Array</label>
            </div>
            <input id="arrayInput" type="text" placeholder="e.g. 5,3,8,4,2" />
            <div class="row" style="margin-top: 10px">
              <button class="btn" id="applyBtn">Apply</button>
              <button class="btn secondary" id="randomBtn">Random</button>
              <button
                class="btn ghost"
                id="nearlyBtn"
                title="Mostly sorted input case"
              >
                Nearly Sorted
              </button>
              <button
                class="btn ghost"
                id="reversedBtn"
                title="Worst-case input"
              >
                Reversed
              </button>
              <button class="btn ghost" id="clearBtn">Clear</button>
            </div>
          </div>

          <div>
            <div class="row">
              <label>Size</label><span class="val" id="sizeVal"></span>
            </div>
            <div class="row">
              <input id="size" type="range" min="5" max="80" value="30" />
              <button class="btn ghost" id="resizeToInput">Fit Input</button>
            </div>

            <div class="row" style="margin-top: 8px">
              <label>Speed</label><span class="val" id="speedVal"></span>
            </div>
            <div class="row">
              <input id="speed" type="range" min="0" max="100" value="60" />
              <button class="btn ghost" id="stepBtn">Step ▶︎</button>
              <button class="btn" id="playBtn">Play</button>
              <button class="btn" id="pauseBtn" disabled>Pause</button>
              <button class="btn secondary" id="resetBtn">Reset</button>
            </div>
          </div>
        </div>

        <div class="stats" style="margin-top: 12px">
          <div class="stat">
            <div class="k">Comparisons</div>
            <div class="v" id="cmp">0</div>
          </div>
          <div class="stat">
            <div class="k">Swaps</div>
            <div class="v" id="swp">0</div>
          </div>
          <div class="stat">
            <div class="k">Pass</div>
            <div class="v" id="pass">0</div>
          </div>
          <div class="stat">
            <div class="k">State</div>
            <div class="v" id="state">Idle</div>
          </div>
          <div class="stat">
            <div class="k">Best</div>
            <div class="v">O(n)</div>
          </div>
          <div class="stat">
            <div class="k">Average / Worst</div>
            <div class="v">O(n²)</div>
          </div>
          <div class="stat">
            <div class="k">In-Place</div>
            <div class="v">Yes</div>
          </div>
          <div class="stat">
            <div class="k">Stable</div>
            <div class="v">Yes</div>
          </div>
        </div>

        <div
          class="stage"
          id="stage"
          aria-label="Bar chart visualization"
        ></div>
      </div>

      <footer>
        Hint: You can paste your own numbers above. Press
        <code class="k">Play</code> to animate, or
        <code class="k">Step</code> to advance exactly one comparison.
      </footer>
    </div>

    <dialog id="about">
      <form method="dialog" style="max-width: 720px">
        <h3 style="margin: 0 0 8px">About Bubble Sort</h3>
        <p style="color: #444">
          Bubble sort repeatedly scans adjacent pairs and swaps them if they're
          out of order. After each pass, the largest remaining element “bubbles”
          to the end. This demo uses an early-exit optimization: if a pass makes
          no swaps, the array is already sorted.
        </p>
        <p><b>Pseudocode</b>:</p>
        <pre
          style="
            white-space: pre-wrap;
            background: #0b1022;
            color: #e6e8ff;
            padding: 10px 12px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.08);
          "
        >
repeat
  swapped ← false
  for i from 0 to n-2
    if A[i] > A[i+1]
      swap(A[i], A[i+1])
      swapped ← true
until swapped = false
      </pre
        >
        <div style="text-align: right"><button class="btn">Close</button></div>
      </form>
    </dialog>

    <script>
      // ---------- Utilities ----------
      const $ = (sel) => document.querySelector(sel);
      const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
      const randInt = (a, b) => Math.floor(Math.random() * (b - a + 1)) + a;

      // ---------- State ----------
      const stage = $("#stage");
      const cmpEl = $("#cmp"),
        swpEl = $("#swp"),
        passEl = $("#pass"),
        stateEl = $("#state");
      const sizeEl = $("#size"),
        sizeVal = $("#sizeVal");
      const speedEl = $("#speed"),
        speedVal = $("#speedVal");
      const arrayInput = $("#arrayInput");

      const defaultSize = +sizeEl.value;
      let data = [];
      let baseline = [];
      let running = false;
      let generator = null;
      let passCount = 0;
      let comparisons = 0;
      let swaps = 0;
      let sortedBoundary = null; // last index of unsorted region

      // speed -> delay ms (0 == max speed)
      const msFromSpeed = (v) => {
        // map [0..100] -> [0..600] easing
        const t = 1 - v / 100; // 1..0
        return Math.round(600 * (t * t));
      };

      function setState(txt) {
        stateEl.textContent = txt;
      }

      // ---------- Data generation ----------
      function makeRandom(n) {
        const arr = [];
        for (let i = 0; i < n; i++) arr.push(randInt(5, 99));
        return arr;
      }
      function makeNearlySorted(n) {
        const arr = Array.from({ length: n }, (_, i) => i + 1);
        for (let k = 0; k < Math.max(1, Math.round(n * 0.08)); k++) {
          const i = randInt(0, n - 2);
          [arr[i], arr[i + 1]] = [arr[i + 1], arr[i]];
        }
        return arr;
      }
      function makeReversed(n) {
        return Array.from({ length: n }, (_, i) => n - i);
      }

      // ---------- Rendering ----------
      function renderBars(arr, activeIndex = -1) {
        const W = stage.clientWidth;
        const H = stage.clientHeight;
        const gap = clamp(2, 2, 12);
        const n = arr.length;
        const barW = Math.max(3, Math.floor((W - (n + 1) * gap) / n));
        const maxV = Math.max(...arr, 1);
        const t = running
          ? `${Math.max(0.08, msFromSpeed(+speedEl.value) / 1000)}s`
          : "0.15s";

        stage.innerHTML = "";
        for (let i = 0; i < n; i++) {
          const h = Math.max(4, Math.round((arr[i] / maxV) * (H - 18)));
          const x = gap + i * (barW + gap);
          const div = document.createElement("div");
          div.className = "bar";
          if (i === activeIndex || i + 1 === activeIndex)
            div.classList.add("active");
          if (sortedBoundary !== null && i > sortedBoundary)
            div.classList.add("sorted");
          div.style.setProperty("--x", x + "px");
          div.style.setProperty("--h", h + "px");
          div.style.setProperty("--w", barW + "px");
          div.style.setProperty("--t", t);
          div.title = `a[${i}] = ${arr[i]}`;
          stage.appendChild(div);
        }
      }

      function resetStats() {
        comparisons = 0;
        swaps = 0;
        passCount = 0;
        sortedBoundary = null;
        cmpEl.textContent = "0";
        swpEl.textContent = "0";
        passEl.textContent = "0";
      }

      function syncInputFromArray() {
        arrayInput.value = data.join(",");
      }

      function applyInputToArray() {
        const raw = arrayInput.value.trim();
        if (!raw) {
          data = [];
          return;
        }
        const parts = raw
          .split(/[,\s]+/)
          .map((x) => Number(x))
          .filter((x) => Number.isFinite(x));
        data = parts.slice(0, 200); // sanity cap
      }

      function fitSizeToInput() {
        if (!arrayInput.value.trim()) return;
        const parts = arrayInput.value.split(/[,\s]+/).filter(Boolean);
        sizeEl.value = clamp(parts.length, +sizeEl.min, +sizeEl.max);
        updateSizeLabel();
      }

      // ---------- Bubble Sort as generator ----------
      // Yields steps: {type:'compare'|'swap'|'pass', i, j, arraySnapshot}
      function* bubbleSort(arr) {
        const a = arr;
        let n = a.length;
        let swapped;
        do {
          swapped = false;
          passCount++;
          passEl.textContent = passCount;
          for (let i = 0; i < n - 1; i++) {
            comparisons++;
            cmpEl.textContent = comparisons;
            yield { type: "compare", i, j: i + 1, array: [...a] };
            if (a[i] > a[i + 1]) {
              [a[i], a[i + 1]] = [a[i + 1], a[i]];
              swaps++;
              swpEl.textContent = swaps;
              swapped = true;
              yield { type: "swap", i, j: i + 1, array: [...a] };
            }
          }
          n--; // last is in place
          sortedBoundary = n - 1;
          yield { type: "pass", i: n, j: null, array: [...a] };
        } while (swapped);
        sortedBoundary = a.length - 1;
      }

      // ---------- Controls ----------
      function updateSizeLabel() {
        sizeVal.textContent = sizeEl.value;
      }
      function updateSpeedLabel() {
        const ms = msFromSpeed(+speedEl.value);
        speedVal.textContent = ms === 0 ? "Max" : ms + " ms/step";
      }
      function setRunning(v) {
        running = v;
        $("#playBtn").disabled = running;
        $("#pauseBtn").disabled = !running;
        $("#applyBtn").disabled = running;
        $("#randomBtn").disabled = running;
        $("#nearlyBtn").disabled = running;
        $("#reversedBtn").disabled = running;
        $("#clearBtn").disabled = running;
        $("#resizeToInput").disabled = running;
        $("#stepBtn").disabled = running;
        arrayInput.disabled = running;
        sizeEl.disabled = running;
        speedEl.disabled = false;
        setState(running ? "Playing" : "Idle");
      }

      function randomize() {
        data = makeRandom(+sizeEl.value);
        baseline = data.slice();
        resetStats();
        renderBars(data);
        syncInputFromArray();
      }
      function nearlySorted() {
        data = makeNearlySorted(+sizeEl.value);
        baseline = data.slice();
        resetStats();
        renderBars(data);
        syncInputFromArray();
      }
      function reversed() {
        data = makeReversed(+sizeEl.value);
        baseline = data.slice();
        resetStats();
        renderBars(data);
        syncInputFromArray();
      }
      function clearAll() {
        data = [];
        baseline = [];
        resetStats();
        stage.innerHTML = "";
        arrayInput.value = "";
        setState("Cleared");
      }
      function resetToBaseline() {
        if (!baseline.length) {
          setState("Nothing to reset");
          return;
        }
        data = baseline.slice();
        resetStats();
        renderBars(data);
        setState("Reset");
      }

      async function play() {
        if (!data.length) {
          setState("No data — generating random");
          randomize();
        }
        setRunning(true);
        generator = bubbleSort(data);
        for (let step of generator) {
          renderBars(step.array, step.type !== "pass" ? step.i : -1);
          await new Promise((r) => setTimeout(r, msFromSpeed(+speedEl.value)));
          if (!running) return; // paused early
        }
        setRunning(false);
        setState("Sorted ✔");
        renderBars(data);
      }

      function stepOnce() {
        if (!data.length) {
          setState("No data — generating random");
          randomize();
        }
        if (!generator) generator = bubbleSort(data);
        const n = generator.next();
        if (!n.done) {
          const step = n.value;
          renderBars(step.array, step.type !== "pass" ? step.i : -1);
          setState("Stepping");
        } else {
          setState("Sorted ✔");
          renderBars(data);
        }
      }

      // ---------- Wire up ----------
      sizeEl.addEventListener("input", () => {
        updateSizeLabel();
      });
      sizeEl.addEventListener("change", () => {
        if (!arrayInput.value.trim()) randomize();
        else {
          fitSizeToInput();
          applyInputToArray();
          baseline = data.slice();
          resetStats();
          renderBars(data);
        }
      });

      speedEl.addEventListener("input", updateSpeedLabel);

      $("#applyBtn").addEventListener("click", () => {
        applyInputToArray();
        if (!data.length) {
          setState('Enter numbers like "5,3,8"');
          return;
        }
        sizeEl.value = clamp(data.length, +sizeEl.min, +sizeEl.max);
        updateSizeLabel();
        baseline = data.slice();
        resetStats();
        renderBars(data);
        generator = null;
        setState("Applied");
      });

      $("#randomBtn").addEventListener("click", randomize);
      $("#nearlyBtn").addEventListener("click", nearlySorted);
      $("#reversedBtn").addEventListener("click", reversed);
      $("#clearBtn").addEventListener("click", clearAll);
      $("#resetBtn").addEventListener("click", resetToBaseline);
      $("#resizeToInput").addEventListener("click", fitSizeToInput);
      $("#playBtn").addEventListener("click", () => {
        if (!running) {
          play();
        }
      });
      $("#pauseBtn").addEventListener("click", () => {
        setRunning(false);
        setState("Paused");
      });
      $("#stepBtn").addEventListener("click", stepOnce);
      $("#aboutBtn").addEventListener("click", () => $("#about").showModal());

      window.addEventListener("resize", () => renderBars(data));

      // ---------- Init ----------
      function init() {
        updateSizeLabel();
        updateSpeedLabel();
        data = makeRandom(defaultSize);
        baseline = data.slice();
        renderBars(data);
        syncInputFromArray();
      }
      init();
    </script>
  </body>
</html>
