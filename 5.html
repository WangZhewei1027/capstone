<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bubble Sort ‚Äî Visual, Interactive & Beginner-Friendly</title>
    <style>
      :root {
        --bg: #0f1221;
        --panel: #141935;
        --accent: #6ee7ff;
        --accent-2: #7c5cff;
        --text: #e9edff;
        --muted: #9aa4c7;
        --danger: #ff5d8f;
        --success: #9aff6e;
        --bar: #2a3170;
        --bar-compare: #ffcc66;
        --bar-swap: #ff7f50;
        --bar-sorted: #6ee7ff;
        --focus: 0 0 0 3px #ffffff22, 0 0 0 6px var(--accent-2);
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto,
          "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji",
          "Segoe UI Emoji", "Segoe UI Symbol";
        background: radial-gradient(
            1200px 600px at 10% -10%,
            #1b2050 0%,
            #0f1221 60%
          ),
          linear-gradient(180deg, #0b0e1a 0%, #0f1221 100%);
        color: var(--text);
        line-height: 1.45;
      }

      header {
        padding: 1.25rem clamp(1rem, 3vw, 2rem);
        border-bottom: 1px solid #ffffff12;
        background: linear-gradient(180deg, #141935 0%, #121632 100%);
        position: sticky;
        top: 0;
        z-index: 5;
      }
      header h1 {
        font-size: clamp(1.2rem, 1rem + 2vw, 1.8rem);
        margin: 0 0 0.25rem;
        letter-spacing: 0.4px;
      }
      header p {
        margin: 0;
        color: var(--muted);
      }

      main {
        padding: 1rem clamp(1rem, 3vw, 2rem) 2rem;
        display: grid;
        grid-template-columns: 1.2fr 0.8fr;
        gap: clamp(1rem, 3vw, 1.5rem);
      }
      @media (max-width: 980px) {
        main {
          grid-template-columns: 1fr;
        }
      }

      .card {
        background: var(--panel);
        border: 1px solid #ffffff14;
        border-radius: 14px;
        box-shadow: 0 10px 30px #00000055, inset 0 1px 0 #ffffff12;
      }
      .card header {
        position: static;
        background: transparent;
        border: 0;
        padding: 1rem 1rem 0 1rem;
      }
      .card .content {
        padding: 1rem;
      }

      /* Controls */
      .controls {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 1rem;
        align-items: end;
      }
      .controls .group {
        grid-column: span 6;
        background: #0d1230;
        border: 1px solid #ffffff10;
        padding: 0.75rem 0.9rem;
        border-radius: 12px;
      }
      .controls .group label {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        font-size: 0.9rem;
        color: var(--muted);
        margin-bottom: 0.35rem;
      }
      .controls .group output {
        color: var(--accent);
        font-variant-numeric: tabular-nums;
        margin-left: 0.5rem;
      }
      .controls input[type="range"] {
        width: 100%;
        accent-color: var(--accent-2);
        cursor: pointer;
      }
      .controls .buttons {
        grid-column: 1 / -1;
        display: flex;
        flex-wrap: wrap;
        gap: 0.6rem;
      }
      button {
        appearance: none;
        border: 0;
        border-radius: 12px;
        padding: 0.7rem 1rem;
        font-weight: 600;
        letter-spacing: 0.2px;
        color: #0b0e1a;
        background: linear-gradient(180deg, var(--accent) 0%, #82f0ff 100%);
        box-shadow: 0 6px 18px #6ee7ff44;
        cursor: pointer;
        transition: transform 0.06s ease, box-shadow 0.2s ease, filter 0.2s ease;
      }
      button.secondary {
        background: linear-gradient(180deg, #c7cff9 0%, #a6b3ff 100%);
      }
      button.ghost {
        color: var(--text);
        background: #ffffff12;
        border: 1px solid #ffffff1f;
        box-shadow: none;
      }
      button:disabled {
        filter: grayscale(0.5) brightness(0.8);
        cursor: not-allowed;
        opacity: 0.7;
      }
      button:focus-visible {
        outline: none;
        box-shadow: var(--focus);
      }

      /* Visualizer */
      #viz {
        height: clamp(250px, 38vh, 420px);
        background: linear-gradient(180deg, #0a0e26 0%, #0a0d20 100%);
        border-radius: 12px;
        border: 1px dashed #ffffff22;
        display: grid;
        align-items: end;
        gap: 2px;
        padding: 10px;
        overflow: hidden;
        position: relative;
      }
      #viz .bar {
        background: linear-gradient(180deg, #2f3784 0%, #232a66 100%);
        border-radius: 6px 6px 0 0;
        transition: height 0.15s linear, transform 0.15s ease;
        position: relative;
      }
      #viz .bar::after {
        content: attr(data-value);
        position: absolute;
        bottom: 6px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 10px;
        color: #ffffffcc;
        opacity: 0;
        transition: opacity 0.2s;
        user-select: none;
        pointer-events: none;
      }
      #viz:hover .bar::after {
        opacity: 0.85;
      }
      .bar.comparing {
        background: linear-gradient(180deg, var(--bar-compare), #f7a531);
        box-shadow: 0 0 0 2px #00000055 inset;
      }
      .bar.swapping {
        background: linear-gradient(180deg, var(--bar-swap), #ff6a33);
      }
      .bar.sorted {
        background: linear-gradient(180deg, #6ee7ff, #4eb1ff);
      }

      /* Info sidebar */
      .stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.75rem;
      }
      .stat {
        padding: 0.8rem;
        background: #0d1230;
        border: 1px solid #ffffff10;
        border-radius: 10px;
      }
      .stat .label {
        color: var(--muted);
        font-size: 0.85rem;
      }
      .stat .val {
        font-variant-numeric: tabular-nums;
        font-size: 1.25rem;
        margin-top: 0.2rem;
        color: #fff;
      }

      .progress {
        margin-top: 0.75rem;
        width: 100%;
        height: 10px;
        background: #ffffff14;
        border-radius: 999px;
        overflow: hidden;
        border: 1px solid #ffffff1a;
      }
      .progress > span {
        display: block;
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, var(--accent-2), var(--accent));
        transition: width 0.2s ease;
      }

      .explain ul {
        margin: 0.6rem 0 0 1.2rem;
        color: var(--muted);
      }
      .explain code {
        background: #00000040;
        padding: 0.1rem 0.35rem;
        border-radius: 6px;
        border: 1px solid #ffffff1a;
        color: #e7f2ff;
      }

      footer {
        padding: 1.25rem clamp(1rem, 3vw, 2rem);
        color: var(--muted);
        text-align: center;
        border-top: 1px solid #ffffff12;
      }

      /* Accessibility: live region */
      .sr-only {
        position: absolute !important;
        height: 1px;
        width: 1px;
        overflow: hidden;
        clip: rect(1px, 1px, 1px, 1px);
        white-space: nowrap;
        clip-path: inset(50%);
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Bubble Sort Visualizer</h1>
      <p>
        Learn how Bubble Sort works through animation, live stats, and
        interactive controls.
      </p>
    </header>

    <main>
      <!-- Left: Visualizer & Controls -->
      <section class="card" aria-labelledby="viz-title">
        <header><h2 id="viz-title">Visualization</h2></header>
        <div class="content">
          <div class="controls" role="group" aria-label="Controls">
            <div class="group" title="Change how many values are in the array">
              <label for="size">
                Array Size
                <output id="sizeOut">30</output>
              </label>
              <input
                id="size"
                type="range"
                min="5"
                max="120"
                value="30"
                step="1"
              />
            </div>

            <div class="group" title="Change how fast comparisons happen">
              <label for="speed">
                Speed (ms / step)
                <output id="speedOut">60</output>
              </label>
              <input
                id="speed"
                type="range"
                min="0"
                max="400"
                value="60"
                step="5"
              />
            </div>

            <div class="buttons">
              <button
                id="btnGenerate"
                class="secondary"
                aria-label="Generate new random array"
              >
                üîÄ New Array
              </button>
              <button id="btnStart" aria-label="Start sorting">‚ñ∂Ô∏è Start</button>
              <button
                id="btnPause"
                class="ghost"
                aria-label="Pause or resume sorting"
                disabled
              >
                ‚è∏Ô∏è Pause
              </button>
              <button
                id="btnRestart"
                class="ghost"
                aria-label="Restart sorting"
                disabled
              >
                üîÅ Restart
              </button>
            </div>
          </div>

          <div
            id="viz"
            aria-live="polite"
            aria-label="Sorting visualization grid"
          ></div>

          <p class="sr-only" aria-live="assertive" id="liveStatus"></p>
        </div>
      </section>

      <!-- Right: Live Stats & Explanation -->
      <aside class="card" aria-labelledby="info-title">
        <header><h2 id="info-title">Live Progress & How it Works</h2></header>
        <div class="content">
          <div class="stats-grid" role="region" aria-label="Live statistics">
            <div class="stat">
              <div class="label">Comparisons</div>
              <div class="val" id="cmpCount">0</div>
            </div>
            <div class="stat">
              <div class="label">Swaps</div>
              <div class="val" id="swapCount">0</div>
            </div>
            <div class="stat">
              <div class="label">Pass</div>
              <div class="val" id="passNum">0</div>
            </div>
            <div class="stat">
              <div class="label">Indices (i, j)</div>
              <div class="val" id="indices">‚Äì</div>
            </div>
          </div>
          <div class="progress" aria-label="Overall progress">
            <span id="progressBar" style="width: 0%"></span>
          </div>
          <div class="explain">
            <h3 style="margin-top: 1rem">Bubble Sort (concept)</h3>
            <p>
              Bubble Sort repeatedly steps through the list, compares adjacent
              elements, and swaps them if they are out of order. After each
              pass, the largest remaining unsorted value ‚Äúbubbles‚Äù to the end.
            </p>
            <ul>
              <li>Outer loop runs passes from start to end.</li>
              <li>
                Inner loop compares adjacent pairs:
                <code>if (a[j] &gt; a[j+1]) swap()</code>.
              </li>
              <li>
                After pass <code>p</code>, the last <code>p</code> items are in
                final position.
              </li>
              <li>
                Best case <em>O(n)</em> (already sorted with early exit), worst
                case <em>O(n¬≤)</em>.
              </li>
            </ul>
            <p style="margin: 0.6rem 0 0; color: var(--muted)">
              Tip: Open your browser console to see detailed logs of each
              comparison &amp; swap.
            </p>
          </div>
        </div>
      </aside>
    </main>

    <footer>
      Built with modern ES6+, accessible controls, and a responsive layout. Use
      this as a learning sandbox ‚ú®
    </footer>

    <script>
      // ============ Utility helpers ============
      const sleep = (ms) => new Promise((res) => setTimeout(res, ms));
      const randInt = (min, max) =>
        Math.floor(Math.random() * (max - min + 1)) + min;
      const clamp = (n, a, b) => Math.max(a, Math.min(b, n));

      // ============ DOM refs ============
      const sizeEl = document.getElementById("size");
      const sizeOut = document.getElementById("sizeOut");
      const speedEl = document.getElementById("speed");
      const speedOut = document.getElementById("speedOut");

      const btnGenerate = document.getElementById("btnGenerate");
      const btnStart = document.getElementById("btnStart");
      const btnPause = document.getElementById("btnPause");
      const btnRestart = document.getElementById("btnRestart");

      const viz = document.getElementById("viz");
      const liveStatus = document.getElementById("liveStatus");

      const cmpCountEl = document.getElementById("cmpCount");
      const swapCountEl = document.getElementById("swapCount");
      const passNumEl = document.getElementById("passNum");
      const indicesEl = document.getElementById("indices");
      const progressBar = document.getElementById("progressBar");

      // ============ State ============
      let arr = [];
      let isSorting = false;
      let isPaused = false;
      let abortController = { aborted: false };
      let lastSnapshot = null; // for restart

      function setControlsDuringSort(active) {
        sizeEl.disabled = active;
        btnGenerate.disabled = active;
        btnStart.disabled = active;
        btnPause.disabled = !active;
        btnRestart.disabled = !active;
      }

      function updateOutputs() {
        sizeOut.textContent = sizeEl.value;
        speedOut.textContent = speedEl.value;
      }

      // ============ Visualization ============
      function renderBars(array) {
        viz.style.gridTemplateColumns = `repeat(${array.length}, 1fr)`;
        viz.innerHTML = "";
        const maxVal = Math.max(...array);
        array.forEach((v, i) => {
          const bar = document.createElement("div");
          bar.className = "bar";
          bar.dataset.index = i;
          bar.dataset.value = v;
          const heightPct = (v / maxVal) * 100;
          bar.style.height = `calc(${heightPct}% - 10px)`;
          viz.appendChild(bar);
        });
      }

      function highlight(indices, className) {
        indices.forEach((i) => {
          const bar = viz.children[i];
          if (bar) bar.classList.add(className);
        });
      }
      function clearHighlight(indices, className) {
        indices.forEach((i) => {
          const bar = viz.children[i];
          if (bar) bar.classList.remove(className);
        });
      }
      function markSorted(fromIndex) {
        // Mark the tail [fromIndex, end) as sorted (used after each pass)
        for (let i = fromIndex; i < viz.children.length; i++) {
          viz.children[i].classList.add("sorted");
        }
      }

      function swapInDOM(i, j) {
        // Swap heights & labels (faster than re-rendering all bars)
        const bi = viz.children[i];
        const bj = viz.children[j];
        if (!bi || !bj) return;
        const tmpH = bi.style.height;
        const tmpV = bi.dataset.value;
        bi.style.height = bj.style.height;
        bi.dataset.value = bj.dataset.value;
        bj.style.height = tmpH;
        bj.dataset.value = tmpV;
      }

      function resetHighlights() {
        [...viz.children].forEach((bar) => {
          bar.classList.remove("comparing", "swapping", "sorted");
        });
      }

      function updateStats({ cmp, swaps, pass, i, j, progress }) {
        cmpCountEl.textContent = cmp;
        swapCountEl.textContent = swaps;
        passNumEl.textContent = pass;
        indicesEl.textContent = (i ?? "‚Äì") + ", " + (j ?? "‚Äì");
        progressBar.style.width = `${clamp(progress, 0, 100)}%`;
      }

      function announce(msg) {
        liveStatus.textContent = msg;
      }

      // ============ Data generation ============
      function generateArray(n) {
        // Values from 5..100, random but scaled by n for visual variety
        const min = 5,
          max = 100;
        return Array.from({ length: n }, () => randInt(min, max));
      }

      function newArray() {
        arr = generateArray(Number(sizeEl.value));
        lastSnapshot = arr.slice();
        resetHighlights();
        updateStats({
          cmp: 0,
          swaps: 0,
          pass: 0,
          i: null,
          j: null,
          progress: 0,
        });
        renderBars(arr);
        console.clear();
        console.log("%cNew array generated:", "color:#7c5cff;font-weight:bold");
        console.log(arr);
        announce("New random array generated.");
      }

      // ============ Bubble Sort (async, step-wise) ============
      async function bubbleSort(array, getDelay, controller) {
        console.log(
          "%cStarting Bubble Sort...",
          "color:#6ee7ff;font-weight:bold"
        );
        const n = array.length;
        let comparisons = 0,
          swaps = 0;
        let earlyExit = false;

        for (let pass = 1; pass <= n - 1; pass++) {
          let swappedThisPass = false;
          for (let j = 0; j <= n - pass - 1; j++) {
            if (controller.aborted) return { aborted: true };
            // Pause handling
            while (isPaused) {
              await sleep(60);
            }

            const i = j,
              k = j + 1;
            comparisons++;
            updateStats({
              cmp: comparisons,
              swaps,
              pass,
              i,
              j: k,
              progress: Math.round(
                (((pass - 1) * (n - 1) + j) / ((n - 1) * (n - 1))) * 100
              ),
            });

            console.log(
              `Compare indices ${i} & ${k}:`,
              array[i],
              "vs",
              array[k]
            );
            highlight([i, k], "comparing");
            announce(`Comparing positions ${i} and ${k}.`);

            await sleep(getDelay());

            if (array[i] > array[k]) {
              // Swap in data & DOM
              console.log(
                "%cSwap!",
                "color:#ff7f50;font-weight:bold",
                `(${array[i]} > ${array[k]})`
              );
              highlight([i, k], "swapping");
              [array[i], array[k]] = [array[k], array[i]];
              swapInDOM(i, k);
              swaps++;
              swappedThisPass = true;
              updateStats({
                cmp: comparisons,
                swaps,
                pass,
                i,
                j: k,
                progress: Math.round(
                  (((pass - 1) * (n - 1) + j) / ((n - 1) * (n - 1))) * 100
                ),
              });
              await sleep(getDelay());
              clearHighlight([i, k], "swapping");
            }

            clearHighlight([i, k], "comparing");
          }

          // Mark last element of this pass as sorted
          markSorted(n - pass);

          console.log(
            `Pass ${pass} complete. Swapped this pass?`,
            swappedThisPass
          );
          if (!swappedThisPass) {
            earlyExit = true;
            console.log(
              "%cEarly exit: array already sorted.",
              "color:#9aff6e;font-weight:bold"
            );
            // Mark the remaining as sorted too
            markSorted(0);
            break;
          }
        }

        updateStats({
          cmp: comparisons,
          swaps,
          pass: earlyExit ? "‚úì" : array.length - 1,
          i: null,
          j: null,
          progress: 100,
        });
        announce("Sorting complete.");
        console.log(
          "%cSorted result:",
          "color:#9aff6e;font-weight:bold",
          array.slice()
        );
        return { aborted: false };
      }

      // ============ Event wiring ============
      sizeEl.addEventListener("input", () => {
        updateOutputs();
        newArray();
      });
      speedEl.addEventListener("input", updateOutputs);

      btnGenerate.addEventListener("click", () => {
        if (isSorting) {
          return;
        }
        newArray();
      });

      btnStart.addEventListener("click", async () => {
        if (isSorting) {
          return;
        }
        isSorting = true;
        isPaused = false;
        abortController = { aborted: false };
        setControlsDuringSort(true);
        resetHighlights();
        // snapshot for restart
        lastSnapshot = arr.slice();

        const startBtnLabel = btnStart.textContent;
        btnStart.textContent = "Sorting‚Ä¶";
        await bubbleSort(arr, () => Number(speedEl.value), abortController);
        btnStart.textContent = startBtnLabel;

        isSorting = false;
        isPaused = false;
        setControlsDuringSort(false);
        btnRestart.disabled = false; // allow user to animate again from snapshot
      });

      btnPause.addEventListener("click", () => {
        if (!isSorting) return;
        isPaused = !isPaused;
        btnPause.textContent = isPaused ? "‚ñ∂Ô∏è Resume" : "‚è∏Ô∏è Pause";
        announce(isPaused ? "Paused." : "Resumed.");
        console.log(
          isPaused ? "%cPaused" : "%cResumed",
          "color:#c7cff9;font-weight:bold"
        );
      });

      btnRestart.addEventListener("click", async () => {
        if (isSorting) {
          // Abort current run, then restart once stopped
          abortController.aborted = true;
          isPaused = false;
          console.log(
            "%cAbort & Restart requested",
            "color:#ff5d8f;font-weight:bold"
          );
          // Small wait so current step can exit
          await sleep(80);
        }
        // Reset data & UI to snapshot
        arr = lastSnapshot ? lastSnapshot.slice() : arr.slice();
        resetHighlights();
        renderBars(arr);
        updateStats({
          cmp: 0,
          swaps: 0,
          pass: 0,
          i: null,
          j: null,
          progress: 0,
        });
        console.log(
          "%cRestart: using snapshot of original array",
          "color:#7c5cff;font-weight:bold",
          arr.slice()
        );
        announce("Restarted with the same array.");
        // Immediately start again
        isSorting = true;
        isPaused = false;
        setControlsDuringSort(true);
        btnPause.textContent = "‚è∏Ô∏è Pause";
        await bubbleSort(
          arr,
          () => Number(speedEl.value),
          (abortController = { aborted: false })
        );
        isSorting = false;
        setControlsDuringSort(false);
      });

      // Keyboard shortcuts (space pause/resume, r restart)
      document.addEventListener("keydown", (e) => {
        if (e.code === "Space") {
          e.preventDefault();
          if (btnPause.disabled) return;
          btnPause.click();
        } else if ((e.key === "r" || e.key === "R") && !btnRestart.disabled) {
          btnRestart.click();
        }
      });

      // Initial setup
      updateOutputs();
      newArray();

      // Window resize: nothing special, bars auto-fit via CSS grid.
      window.addEventListener("resize", () => {
        /* layout handled by CSS */
      });
    </script>
  </body>
</html>
