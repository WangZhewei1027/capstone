<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Bubble Sort Visualization</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#0f1724;
      --panel:#0b1220;
      --accent:#6ee7b7;
      --muted:#94a3b8;
      --bar:#60a5fa;
      --compare:#fb7185;
      --swap:#fbbf24;
      --sorted:#34d399;
      --text:#e6eef7;
    }
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
    body{
      margin:0;
      padding:20px;
      background:linear-gradient(180deg,var(--bg),#071019);
      color:var(--text);
      min-height:100vh;
    }
    .wrap{
      max-width:1100px;
      margin:0 auto;
      display:grid;
      grid-template-columns: 1fr 360px;
      gap:18px;
    }
    header{
      grid-column:1/-1;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      margin-bottom:6px;
    }
    h1{font-size:20px;margin:0}
    .controls{
      background:linear-gradient(180deg,var(--panel),#071927);
      padding:14px;
      border-radius:12px;
      box-shadow:0 6px 18px rgba(2,6,23,0.6);
    }
    .controls .row{display:flex;gap:8px;align-items:center;margin-bottom:8px}
    label{font-size:13px;color:var(--muted);min-width:75px}
    input[type=range]{flex:1}
    button{
      background:transparent;
      border:1px solid rgba(255,255,255,0.06);
      color:var(--text);
      padding:8px 10px;
      border-radius:8px;
      cursor:pointer;
      transition:all .15s;
    }
    button:hover{transform:translateY(-2px)}
    button.primary{
      background:linear-gradient(90deg,var(--accent),#34d399);
      color:#06323b;
      border:none;
      font-weight:600;
      box-shadow:0 6px 12px rgba(52,211,153,0.12);
    }
    .left-controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .right-panel{
      background:linear-gradient(180deg,var(--panel),#071927);
      padding:12px;
      border-radius:12px;
      box-shadow:0 6px 18px rgba(2,6,23,0.6);
      height:fit-content;
    }
    .stats{display:flex;gap:10px;flex-wrap:wrap;font-size:13px;margin-top:8px}
    .stat{background:rgba(255,255,255,0.03);padding:8px;border-radius:8px;min-width:88px;text-align:center}
    .visual{
      background:linear-gradient(180deg,#051228,#071925);
      border-radius:12px;
      padding:12px;
      height:460px;
      display:flex;
      flex-direction:column;
      gap:12px;
      box-shadow:0 6px 18px rgba(2,6,23,0.6);
    }
    #bars{
      flex:1;
      display:flex;
      align-items:end;
      gap:4px;
      padding:6px;
      border-radius:8px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
    }
    .bar{
      background:var(--bar);
      width:100%;
      border-radius:6px 6px 4px 4px;
      display:flex;
      align-items:flex-end;
      justify-content:center;
      color:rgba(0,0,0,0.6);
      font-size:11px;
      user-select:none;
      transition:height 180ms ease, transform 120ms ease, background-color 120ms ease;
    }
    .bar.compare{background:var(--compare); transform:translateY(-6px)}
    .bar.swap{background:var(--swap); transform:translateY(-6px)}
    .bar.sorted{background:var(--sorted)}
    .pseudocode{
      background:linear-gradient(180deg,#061023,#071522);
      color:var(--muted);
      padding:10px;
      border-radius:8px;
      font-family:ui-monospace,SFMono-Regular,Menlo,monospace;
      font-size:13px;
      line-height:1.55;
      margin-top:8px;
    }
    .codeLine{display:block;padding:3px 6px;border-radius:6px}
    .codeLine.active{background:rgba(110,231,183,0.06);color:var(--accent)}
    .footerNote{font-size:12px;color:var(--muted);margin-top:8px}
    .toggles{display:flex;align-items:center;gap:8px}
    small{color:var(--muted)}
    .legend{display:flex;gap:8px;align-items:center;margin-top:6px}
    .chip{display:inline-flex;gap:6px;align-items:center;padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.03);font-size:13px}
    .chip .dot{width:12px;height:12px;border-radius:3px}
    footer{grid-column:1/-1;color:var(--muted);font-size:12px;margin-top:12px;text-align:center}
    @media (max-width:980px){
      .wrap{grid-template-columns:1fr; padding:12px}
      .right-panel{order:3}
      header{flex-direction:column;align-items:flex-start;gap:12px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Bubble Sort â€” Interactive Visualization</h1>
        <small>Compare and swap until the array is sorted. Try step-by-step or run automatically.</small>
      </div>
      <div class="left-controls">
        <div class="controls" style="display:flex;flex-direction:column;gap:8px;">
          <div class="row">
            <label for="size">Size</label>
            <input id="size" type="range" min="5" max="80" value="24">
            <span id="sizeVal" style="min-width:34px;text-align:right;color:var(--muted)">24</span>
          </div>
          <div class="row">
            <label for="speed">Speed</label>
            <input id="speed" type="range" min="1" max="1000" value="220">
            <span id="speedVal" style="min-width:34px;text-align:right;color:var(--muted)">220ms</span>
          </div>
          <div class="row" style="justify-content:space-between;">
            <div class="toggles" title="Optimize with early exit when no swaps occur in a pass.">
              <input id="opt" type="checkbox" checked>
              <label for="opt" style="margin:0;color:var(--muted)">Optimized</label>
            </div>
            <div style="display:flex;gap:6px">
              <button id="random">Randomize</button>
              <button id="start" class="primary">Start</button>
              <button id="pause">Pause</button>
              <button id="step">Step</button>
              <button id="reset">Reset</button>
            </div>
          </div>
        </div>
      </div>
    </header>

    <section class="visual">
      <div id="bars" aria-hidden="true"></div>
      <div class="legend">
        <div class="chip"><span class="dot" style="background:var(--bar)"></span> Unsorted</div>
        <div class="chip"><span class="dot" style="background:var(--compare)"></span> Comparing</div>
        <div class="chip"><span class="dot" style="background:var(--swap)"></span> Swapping</div>
        <div class="chip"><span class="dot" style="background:var(--sorted)"></span> Sorted</div>
      </div>
      <div style="display:flex;gap:12px;align-items:center;justify-content:space-between">
        <div style="display:flex;gap:8px;">
          <div class="stat"><div style="font-size:12px;color:var(--muted)">Pass</div><div id="pass">0</div></div>
          <div class="stat"><div style="font-size:12px;color:var(--muted)">Comparisons</div><div id="comp">0</div></div>
          <div class="stat"><div style="font-size:12px;color:var(--muted)">Swaps</div><div id="swaps">0</div></div>
        </div>
        <div style="display:flex;gap:8px;align-items:center;">
          <small id="status">Idle</small>
        </div>
      </div>
    </section>

    <aside class="right-panel">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>Pseudocode</strong>
        <small style="color:var(--muted)">Optimized flag toggles early exit</small>
      </div>
      <div class="pseudocode" id="pcode" aria-hidden="false">
        <div class="codeLine" data-line="0">function bubbleSort(arr)</div>
        <div class="codeLine" data-line="1">  n = arr.length</div>
        <div class="codeLine" data-line="2">  for i from 0 to n-1</div>
        <div class="codeLine" data-line="3">    swapped = false</div>
        <div class="codeLine" data-line="4">    for j from 0 to n-i-2</div>
        <div class="codeLine" data-line="5">      if arr[j] > arr[j+1]</div>
        <div class="codeLine" data-line="6">        swap arr[j] and arr[j+1]</div>
        <div class="codeLine" data-line="7">        swapped = true</div>
        <div class="codeLine" data-line="8">    if optimized and not swapped then break</div>
        <div class="codeLine" data-line="9">  return arr</div>
      </div>

      <div style="margin-top:12px">
        <strong>Time Complexity</strong>
        <div style="font-size:13px; color:var(--muted); margin-top:6px">
          Worst-case: O(n^2) | Average: O(n^2) | Best (optimized): O(n)
        </div>
      </div>

      <div style="margin-top:12px">
        <strong>Notes</strong>
        <div class="footerNote">Bubble sort repeatedly compares adjacent elements and swaps them if they are in the wrong order. It's simple but inefficient for large datasets.</div>
      </div>
    </aside>

    <footer>
      Try the "Step" button to advance one comparison at a time. "Optimized" stops early if a pass needs no swaps.
    </footer>
  </div>

  <script>
    // Elements
    const barsEl = document.getElementById('bars');
    const sizeInput = document.getElementById('size');
    const speedInput = document.getElementById('speed');
    const sizeVal = document.getElementById('sizeVal');
    const speedVal = document.getElementById('speedVal');
    const randomBtn = document.getElementById('random');
    const startBtn = document.getElementById('start');
    const pauseBtn = document.getElementById('pause');
    const stepBtn = document.getElementById('step');
    const resetBtn = document.getElementById('reset');
    const optCheckbox = document.getElementById('opt');
    const passEl = document.getElementById('pass');
    const compEl = document.getElementById('comp');
    const swapsEl = document.getElementById('swaps');
    const statusEl = document.getElementById('status');
    const codeLines = document.querySelectorAll('.codeLine');

    let arr = [];
    let running = false;
    let controllerState = 'idle'; // 'running','paused','step','stopped','idle'
    let speed = parseInt(speedInput.value,10);
    let pass = 0, comparisons = 0, swaps = 0;
    let currentHighlights = [];

    function randArray(n){
      const a = [];
      for(let i=0;i<n;i++){
        a.push(Math.floor(Math.random()*100)+5); // keep min height >0
      }
      return a;
    }

    function render(){
      barsEl.innerHTML = '';
      const n = arr.length;
      for(let i=0;i<n;i++){
        const b = document.createElement('div');
        b.className='bar';
        b.style.height = (arr[i]* ( (barsEl.clientHeight-20) / 110 )) + 'px';
        b.style.flex = `1 1 ${Math.max(4, 100/n)}%`;
        b.title = String(arr[i]);
        b.dataset.index = i;
        // show small label for few elements
        if(n<=32) b.textContent = arr[i];
        barsEl.appendChild(b);
      }
      updateCounts();
    }

    function updateCounts(){
      passEl.textContent = pass;
      compEl.textContent = comparisons;
      swapsEl.textContent = swaps;
    }

    // util highlight functions
    function clearBarClasses(){
      barsEl.querySelectorAll('.bar').forEach(b=>{
        b.classList.remove('compare','swap','sorted');
        b.style.transform = '';
      });
    }
    function markCompare(i,j){
      clearBarClasses();
      const a = barsEl.children[i];
      const b = barsEl.children[j];
      if(a) a.classList.add('compare');
      if(b) b.classList.add('compare');
    }
    function markSwap(i,j){
      clearBarClasses();
      const a = barsEl.children[i];
      const b = barsEl.children[j];
      if(a) a.classList.add('swap');
      if(b) b.classList.add('swap');
    }
    function markSorted(upto){
      for(let k=barsEl.children.length-1;k>=upto;k--){
        const el = barsEl.children[k];
        if(el) el.classList.add('sorted');
      }
    }

    // pseudocode highlight
    function highlightLine(num){
      codeLines.forEach(line=>{
        line.classList.toggle('active', Number(line.dataset.line) === num);
      });
    }

    // sleep/wait that respects pause/step/reset
    function waiter(ms){
      const start = performance.now();
      return new Promise(resolve=>{
        function tick(){
          if(controllerState === 'stopped' || controllerState==='idle'){ resolve({aborted:true}); return; }
          if(controllerState === 'step'){
            controllerState = 'paused';
            resolve({aborted:false, stepped:true});
            return;
          }
          if(controllerState === 'running'){
            const now = performance.now();
            if(now - start >= ms){
              resolve({aborted:false});
              return;
            }
          }
          // else paused: keep waiting
          requestAnimationFrame(tick);
        }
        tick();
      });
    }

    async function bubbleSortVisual(){
      running = true;
      controllerState = 'running';
      pass = 0; comparisons = 0; swaps = 0;
      updateCounts();
      statusEl.textContent = 'Running';
      const n = arr.length;
      highlightLine(0);
      await sleepFrame();

      for(let i=0;i<n;i++){
        pass = i+1;
        updateCounts();
        highlightLine(2); // for i from 0 to n-1
        await sleepFrame();

        let swapped = false;
        highlightLine(3);
        await sleepFrame();

        for(let j=0;j<n-i-1;j++){
          // if aborted
          if(controllerState === 'stopped') { running=false; statusEl.textContent='Stopped'; highlightLine(-1); return; }

          // comparing arr[j] and arr[j+1]
          comparisons++;
          updateCounts();
          markCompare(j,j+1);
          highlightLine(5);
          const r = await waiter(speed);
          if(r.aborted){ running=false; statusEl.textContent='Stopped'; highlightLine(-1); return; }

          if(arr[j] > arr[j+1]){
            // swap
            swaps++;
            swapped = true;
            updateCounts();
            markSwap(j,j+1);
            highlightLine(6);
            await animateSwap(j,j+1);
            // actual swap in array
            const tmp = arr[j];
            arr[j] = arr[j+1];
            arr[j+1] = tmp;
            render();
            await sleepFrame();
            highlightLine(7);
            const r2 = await waiter(Math.max(60, speed/2));
            if(r2.aborted){ running=false; statusEl.textContent='Stopped'; highlightLine(-1); return; }
          }
        }

        // mark elements from end that are known to be sorted
        markSorted(n - i - 1);
        await sleepFrame();

        if(optCheckbox.checked){
          highlightLine(8);
          await sleepFrame();
          if(!swapped){
            statusEl.textContent = 'Sorted (early exit)';
            // entire array sorted
            for(let k=0;k<n;k++){
              const el = barsEl.children[k];
              if(el) el.classList.add('sorted');
            }
            running=false;
            highlightLine(-1);
            return;
          }
        }
      }
      statusEl.textContent = 'Sorted';
      running = false;
      highlightLine(-1);
      // mark all sorted
      for(let k=0;k<arr.length;k++){
        const el = barsEl.children[k];
        if(el) el.classList.add('sorted');
      }
    }

    // small helper to allow UI to update
    function sleepFrame(){ return new Promise(resolve => requestAnimationFrame(resolve)); }

    // Animate swap by exchanging heights visually
    async function animateSwap(i,j){
      const a = barsEl.children[i];
      const b = barsEl.children[j];
      if(!a || !b) return;
      // simple visual: move them up briefly (class swap already applied)
      a.style.transform = 'translateY(-8px)';
      b.style.transform = 'translateY(-8px)';
      await new Promise(r => setTimeout(r, Math.max(80, speed/3)));
    }

    // Event bindings
    sizeInput.addEventListener('input', e=>{
      sizeVal.textContent = e.target.value;
      resetArray(Number(e.target.value));
    });
    speedInput.addEventListener('input', e=>{
      speed = Number(e.target.value);
      speedVal.textContent = speed + 'ms';
    });
    randomBtn.addEventListener('click', ()=> resetArray(Number(sizeInput.value)));
    startBtn.addEventListener('click', async ()=>{
      if(running){
        // if paused, resume
        controllerState = 'running';
        statusEl.textContent = 'Running';
        return;
      }
      // start fresh visualization
      clearBarClasses();
      comparisons=0; swaps=0; pass=0;
      updateCounts();
      await sleepFrame();
      bubbleSortVisual();
    });
    pauseBtn.addEventListener('click', ()=>{
      if(!running) return;
      controllerState = 'paused';
      statusEl.textContent = 'Paused';
    });
    stepBtn.addEventListener('click', ()=>{
      if(!running){
        // start algorithm in paused mode and then step once
        comparisons=0; swaps=0; pass=0;
        updateCounts();
        controllerState='paused';
        bubbleSortVisual();
        // give it a tick then step
        setTimeout(()=>{ controllerState='step'; statusEl.textContent='Stepping'; }, 40);
      } else {
        controllerState='step';
        statusEl.textContent='Stepping';
      }
    });
    resetBtn.addEventListener('click', ()=>{
      controllerState='stopped';
      running=false;
      statusEl.textContent='Idle';
      clearBarClasses();
      highlightLine(-1);
      resetArray(Number(sizeInput.value));
    });

    function resetArray(n){
      arr = randArray(n);
      pass = 0; comparisons = 0; swaps = 0;
      updateCounts();
      statusEl.textContent = 'Idle';
      controllerState = 'idle';
      running = false;
      render();
      clearBarClasses();
      highlightLine(-1);
    }

    // init
    sizeVal.textContent = sizeInput.value;
    speedVal.textContent = speedInput.value + 'ms';
    resetArray(Number(sizeInput.value));

    // allow clicking bars to shuffle small subset (fun)
    barsEl.addEventListener('click', (e)=>{
      const b = e.target.closest('.bar');
      if(!b) return;
      const idx = Number(b.dataset.index);
      // swap with random neighbor
      const j = Math.min(arr.length-1, Math.max(0, idx + (Math.random()>0.5?1:-1)));
      const tmp = arr[idx]; arr[idx] = arr[j]; arr[j] = tmp;
      render();
    });

    // remove highlight when mouse leaves
    document.addEventListener('visibilitychange', ()=>{
      if(document.hidden && running){
        controllerState='paused';
        statusEl.textContent='Paused (tab hidden)';
      }
    });

  </script>
</body>
</html>