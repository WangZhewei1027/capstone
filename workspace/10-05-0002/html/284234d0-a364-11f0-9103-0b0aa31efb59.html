<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bubble Sort Visualizer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --bg: #0f172a; /* slate-900 */
      --panel: #111827; /* gray-900 */
      --text: #e5e7eb; /* gray-200 */
      --muted: #9ca3af; /* gray-400 */
      --accent: #3b82f6; /* blue-500 */
      --accent-dim: #1f4bd5;
      --compare: #f59e0b; /* amber-500 */
      --swap: #ef4444; /* red-500 */
      --sorted: #22c55e; /* green-500 */
      --bar: #7c3aed; /* violet-600 */
      --bar-dim: #5b21b6;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background: radial-gradient(1200px 1200px at 10% 10%, #0a0f2b 0%, #0f172a 40%, #0b1324 100%);
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: center;
    }
    .app {
      width: min(1100px, 95vw);
      margin: 24px auto;
    }
    header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }
    header h1 {
      font-size: 1.6rem;
      margin: 0;
      letter-spacing: 0.25px;
    }
    header .badge {
      background: rgba(59,130,246,0.2);
      color: #93c5fd;
      border: 1px solid rgba(59,130,246,0.3);
      font-size: 0.8rem;
      padding: 4px 8px;
      border-radius: 999px;
    }

    .panel {
      background: linear-gradient(180deg, rgba(17,24,39,0.85), rgba(17,24,39,0.6));
      backdrop-filter: blur(6px);
      border: 1px solid rgba(148,163,184,0.2);
      border-radius: 14px;
      padding: 12px;
    }

    .controls {
      display: grid;
      grid-template-columns: 1.2fr 1fr 1fr 1fr 1fr;
      gap: 10px;
      align-items: center;
      margin-bottom: 14px;
    }
    .control-block {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .control-block label {
      font-size: 0.78rem;
      color: var(--muted);
    }
    .control-inline {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }
    .btn {
      background: linear-gradient(180deg, var(--accent), var(--accent-dim));
      border: none;
      color: white;
      padding: 8px 12px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      letter-spacing: 0.2px;
      transition: filter 0.2s ease, transform 0.04s ease;
    }
    .btn:hover { filter: brightness(1.06); }
    .btn:active { transform: translateY(1px); }
    .btn.secondary {
      background: linear-gradient(180deg, #374151, #1f2937);
      color: #e5e7eb;
      border: 1px solid rgba(148,163,184,0.2);
    }
    .btn.danger {
      background: linear-gradient(180deg, #ef4444, #b91c1c);
    }
    .btn.success {
      background: linear-gradient(180deg, #22c55e, #15803d);
    }

    .switch {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      color: var(--text);
      cursor: pointer;
    }
    .switch input {
      accent-color: var(--accent);
      width: 18px; height: 18px;
    }

    .range-wrap {
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 6px;
      align-items: center;
    }
    input[type="range"] {
      width: 100%;
      -webkit-appearance: none;
      appearance: none;
      height: 6px;
      background: #1f2937;
      border-radius: 999px;
      outline: none;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px; height: 16px;
      border-radius: 50%;
      background: var(--accent);
      border: 2px solid #93c5fd;
      cursor: pointer;
    }

    .viz {
      height: 340px;
      display: flex;
      align-items: flex-end;
      gap: 6px;
      padding: 14px;
      border-radius: 12px;
      border: 1px solid rgba(148,163,184,0.2);
      background: linear-gradient(180deg, rgba(2,6,23,0.2), rgba(2,6,23,0.35));
      position: relative;
      overflow: hidden;
    }

    .bar {
      flex: 1 1 auto;
      min-width: 10px;
      background: linear-gradient(180deg, var(--bar), var(--bar-dim));
      transition: height 200ms ease, background 120ms ease, transform 120ms ease, outline 120ms ease;
      border-radius: 8px 8px 2px 2px;
      outline: 1px solid rgba(148,163,184,0.15);
      position: relative;
      display: flex;
      align-items: flex-end;
      justify-content: center;
    }
    .bar.compare {
      background: linear-gradient(180deg, var(--compare), #b45309);
      outline-color: rgba(245,158,11,0.4);
      transform: translateY(-2px);
    }
    .bar.swap {
      background: linear-gradient(180deg, var(--swap), #991b1b);
      outline-color: rgba(239,68,68,0.45);
      transform: translateY(-3px);
    }
    .bar.sorted {
      background: linear-gradient(180deg, var(--sorted), #166534);
      outline-color: rgba(34,197,94,0.5);
    }
    .bar-label {
      font-size: 0.75rem;
      color: #f3f4f6;
      margin-bottom: 4px;
      opacity: 0.9;
      user-select: none;
      pointer-events: none;
      text-shadow: 0 1px 2px rgba(0,0,0,0.6);
    }

    .legend {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 0.85rem;
      color: var(--muted);
      margin-top: 8px;
    }
    .legend .dot {
      width: 14px; height: 14px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 6px;
      outline: 1px solid rgba(148,163,184,0.25);
    }
    .dot.compare { background: var(--compare); }
    .dot.swap { background: var(--swap); }
    .dot.sorted { background: var(--sorted); }

    .status {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      margin-top: 14px;
    }
    .stat {
      padding: 8px 10px;
      background: rgba(148,163,184,0.08);
      border: 1px solid rgba(148,163,184,0.18);
      border-radius: 10px;
      text-align: center;
    }
    .stat .label {
      font-size: 0.74rem;
      color: var(--muted);
    }
    .stat .value {
      font-size: 1.1rem;
      font-weight: 700;
      margin-top: 2px;
    }

    .explain {
      margin-top: 16px;
      line-height: 1.55;
      color: #cbd5e1;
      font-size: 0.95rem;
    }
    .code {
      margin-top: 10px;
      background: #0b1023;
      border: 1px solid rgba(148,163,184,0.2);
      border-radius: 10px;
      padding: 10px;
      overflow: auto;
      max-height: 220px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.85rem;
      color: #e2e8f0;
    }
    .msg {
      margin-top: 8px;
      font-size: 0.95rem;
      color: #93c5fd;
      min-height: 20px;
    }
    .footer-note {
      margin-top: 8px;
      color: var(--muted);
      font-size: 0.85rem;
    }

    @media (max-width: 900px) {
      .controls {
        grid-template-columns: 1fr 1fr;
      }
      .status {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Bubble Sort Visualizer</h1>
      <span class="badge">Stable • In-place • O(n²)</span>
    </header>

    <div class="panel">
      <div class="controls">
        <div class="control-block">
          <label>Array Size</label>
          <div class="range-wrap">
            <span id="sizeLabel">20</span>
            <input id="sizeRange" type="range" min="5" max="100" value="20">
            <button class="btn secondary" id="btnGenerate">Generate Random</button>
          </div>
        </div>

        <div class="control-block">
          <label>Speed</label>
          <div class="range-wrap">
            <span id="speedLabel">1x</span>
            <input id="speedRange" type="range" min="1" max="60" value="25">
            <span class="footer-note">lower = slower</span>
          </div>
        </div>

        <div class="control-block">
          <label>Presets</label>
          <div class="control-inline">
            <button class="btn secondary" id="btnNearlySorted">Nearly sorted</button>
            <button class="btn secondary" id="btnReversed">Reversed</button>
            <button class="btn secondary" id="btnDistinct">Distinct values</button>
          </div>
        </div>

        <div class="control-block">
          <label>Play</label>
          <div class="control-inline">
            <button class="btn" id="btnStart">Start</button>
            <button class="btn secondary" id="btnPause">Pause</button>
            <button class="btn success" id="btnStep">Step</button>
          </div>
        </div>

        <div class="control-block">
          <label>Reset</label>
          <div class="control-inline">
            <button class="btn danger" id="btnReset">Reset</button>
            <label class="switch"><input id="chkOptimized" type="checkbox" checked> Optimized early exit</label>
            <label class="switch"><input id="chkLabels" type="checkbox"> Show values</label>
          </div>
        </div>
      </div>

      <div class="viz" id="viz"></div>

      <div class="legend">
        <span><span class="dot compare"></span>Comparing</span>
        <span><span class="dot swap"></span>Swapping</span>
        <span><span class="dot sorted"></span>Sorted</span>
      </div>

      <div class="status">
        <div class="stat"><div class="label">Comparisons</div><div class="value" id="statComparisons">0</div></div>
        <div class="stat"><div class="label">Swaps</div><div class="value" id="statSwaps">0</div></div>
        <div class="stat"><div class="label">Passes</div><div class="value" id="statPasses">0</div></div>
        <div class="stat"><div class="label">Array Length</div><div class="value" id="statLength">0</div></div>
      </div>

      <div class="msg" id="msg">Use Start or Step to begin sorting.</div>

      <div class="explain">
        Bubble sort repeatedly walks through the array, compares adjacent elements, and swaps them if they are in the wrong order. Each pass "bubbles" the largest remaining element to the end. The optimized version stops early if no swap happens in a pass.
        <div class="code">
          // Optimized Bubble Sort (stable, in-place)
          function bubbleSort(arr) {
            for (let i = 0; i < arr.length; i++) {
              let swapped = false;
              for (let j = 0; j < arr.length - 1 - i; j++) {
                if (arr[j] > arr[j + 1]) {
                  [arr[j], arr[j + 1]] = [arr[j + 1], arr[j]];
                  swapped = true;
                }
              }
              if (!swapped) break; // Early exit when already sorted
            }
            return arr;
          }

          // Complexity:
          // Worst/Average time: O(n²)
          // Best time (already sorted, optimized): O(n)
          // Space: O(1) extra
          // Stable: Yes
        </div>
      </div>
    </div>
  </div>

  <script>
    (() => {
      const vizEl = document.getElementById('viz');
      const btnGenerate = document.getElementById('btnGenerate');
      const btnStart = document.getElementById('btnStart');
      const btnPause = document.getElementById('btnPause');
      const btnStep = document.getElementById('btnStep');
      const btnReset = document.getElementById('btnReset');
      const btnNearlySorted = document.getElementById('btnNearlySorted');
      const btnReversed = document.getElementById('btnReversed');
      const btnDistinct = document.getElementById('btnDistinct');
      const sizeRange = document.getElementById('sizeRange');
      const speedRange = document.getElementById('speedRange');
      const sizeLabel = document.getElementById('sizeLabel');
      const speedLabel = document.getElementById('speedLabel');
      const chkOptimized = document.getElementById('chkOptimized');
      const chkLabels = document.getElementById('chkLabels');
      const msg = document.getElementById('msg');

      const statComparisons = document.getElementById('statComparisons');
      const statSwaps = document.getElementById('statSwaps');
      const statPasses = document.getElementById('statPasses');
      const statLength = document.getElementById('statLength');

      // State
      let arr = [];
      let originalArr = [];
      let bars = []; // DOM elements
      let playing = false;
      let timer = null;
      let stepper = null;
      let sortedSet = new Set();
      let comparisons = 0;
      let swaps = 0;
      let passes = 0;

      // Utils
      const randInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

      function generateRandomArray(n, range = {min: 5, max: 120}) {
        const a = new Array(n).fill(0).map(() => randInt(range.min, range.max));
        return a;
      }
      function generateNearlySortedArray(n) {
        const a = new Array(n).fill(0).map((_, i) => i + 1);
        // introduce a few small local swaps
        for (let k = 0; k < Math.max(1, Math.floor(n * 0.1)); k++) {
          const i = randInt(0, n - 2);
          const j = i + 1;
          [a[i], a[j]] = [a[j], a[i]];
        }
        // scale values
        const scale = 3;
        return a.map(v => v * scale);
      }
      function generateReversedArray(n) {
        const a = new Array(n).fill(0).map((_, i) => n - i);
        return a.map(v => v * 3);
      }
      function generateDistinctArray(n) {
        // values 1..n scaled so we have unique elements
        const a = new Array(n).fill(0).map((_, i) => i + 1);
        // shuffle
        for (let i = a.length - 1; i > 0; i--) {
          const j = randInt(0, i);
          [a[i], a[j]] = [a[j], a[i]];
        }
        return a.map(v => v * 3);
      }

      function clearTimer() {
        if (timer) {
          clearInterval(timer);
          timer = null;
        }
      }

      function resetStats() {
        comparisons = 0;
        swaps = 0;
        passes = 0;
        sortedSet.clear();
        statComparisons.textContent = '0';
        statSwaps.textContent = '0';
        statPasses.textContent = '0';
        statLength.textContent = String(arr.length);
      }

      function setMessage(text) {
        msg.textContent = text;
      }

      function setPlaying(on) {
        playing = on;
        btnStart.disabled = on;
        btnPause.disabled = !on;
        btnStep.disabled = on; // step disabled during play
      }

      function buildBars() {
        vizEl.innerHTML = '';
        bars = [];
        const max = Math.max(...arr);
        const heightMax = vizEl.clientHeight - 20; // account for label
        for (let i = 0; i < arr.length; i++) {
          const bar = document.createElement('div');
          bar.className = 'bar';
          const heightPx = Math.round((arr[i] / max) * heightMax);
          bar.style.height = `${Math.max(6, heightPx)}px`;
          const label = document.createElement('div');
          label.className = 'bar-label';
          label.textContent = arr[i];
          label.style.display = chkLabels.checked ? 'block' : 'none';
          bar.appendChild(label);
          bars.push(bar);
          vizEl.appendChild(bar);
        }
      }

      function updateHeights(indices = null) {
        const max = Math.max(...arr);
        const heightMax = vizEl.clientHeight - 20;
        const updateIndex = (i) => {
          const h = Math.round((arr[i] / max) * heightMax);
          bars[i].style.height = `${Math.max(6, h)}px`;
          const label = bars[i].querySelector('.bar-label');
          label.textContent = arr[i];
          label.style.display = chkLabels.checked ? 'block' : 'none';
        };
        if (indices && Array.isArray(indices)) {
          indices.forEach(updateIndex);
        } else {
          for (let i = 0; i < arr.length; i++) updateIndex(i);
        }
      }

      function clearHighlights() {
        for (const b of bars) {
          b.classList.remove('compare', 'swap');
          // keep 'sorted' if present
        }
      }

      function markSorted(index) {
        sortedSet.add(index);
        bars[index].classList.add('sorted');
      }

      function* bubbleSortSteps(source, optimized = true) {
        const a = source.slice();
        let comps = 0, sws = 0, p = 0;
        const n = a.length;
        for (let i = 0; i < n; i++) {
          let swappedThisPass = false;
          for (let j = 0; j < n - 1 - i; j++) {
            comps++;
            yield { type: 'compare', i: j, j: j + 1, comparisons: comps, swaps: sws, passes: p };
            if (a[j] > a[j + 1]) {
              const tmp = a[j]; a[j] = a[j + 1]; a[j + 1] = tmp; sws++;
              swappedThisPass = true;
              yield { type: 'swap', i: j, j: j + 1, comparisons: comps, swaps: sws, passes: p, values: [a[j], a[j + 1]] };
            }
          }
          p++;
          yield { type: 'markSorted', index: n - 1 - i, comparisons: comps, swaps: sws, passes: p };
          if (optimized && !swappedThisPass) {
            for (let k = n - 2 - i; k >= 0; k--) {
              yield { type: 'markSorted', index: k, comparisons: comps, swaps: sws, passes: p };
            }
            break;
          }
        }
        yield { type: 'done', comparisons: comps, swaps: sws, passes: p };
      }

      function processStep(step) {
        if (!step || step.done) {
          setMessage('Finished! Array is sorted.');
          setPlaying(false);
          clearTimer();
          // mark all sorted if not already
          for (let i = 0; i < arr.length; i++) {
            bars[i].classList.add('sorted');
          }
          return true;
        }
        const ev = step.value;
        statComparisons.textContent = String(ev.comparisons ?? comparisons);
        statSwaps.textContent = String(ev.swaps ?? swaps);
        statPasses.textContent = String(ev.passes ?? passes);

        clearHighlights();

        switch (ev.type) {
          case 'compare':
            comparisons = ev.comparisons;
            bars[ev.i].classList.add('compare');
            bars[ev.j].classList.add('compare');
            setMessage(`Comparing indices ${ev.i} and ${ev.j} → ${arr[ev.i]} vs ${arr[ev.j]}`);
            break;
          case 'swap':
            swaps = ev.swaps;
            // Update array values and heights for the two indices
            arr[ev.i] = ev.values[0];
            arr[ev.j] = ev.values[1];
            updateHeights([ev.i, ev.j]);
            bars[ev.i].classList.add('swap');
            bars[ev.j].classList.add('swap');
            setMessage(`Swapping indices ${ev.i} and ${ev.j} because ${arr[ev.i]} < ${arr[ev.j]} after swap`);
            break;
          case 'markSorted':
            passes = ev.passes;
            markSorted(ev.index);
            setMessage(`End of pass ${ev.passes}. Position ${ev.index} is in its final place.`);
            break;
          case 'done':
            comparisons = ev.comparisons;
            swaps = ev.swaps;
            passes = ev.passes;
            setMessage('Finished! Array is sorted.');
            // mark all
            for (let i = 0; i < arr.length; i++) bars[i].classList.add('sorted');
            setPlaying(false);
            clearTimer();
            return true;
        }
        return false;
      }

      function startSorting() {
        if (!stepper) {
          resetStats();
          stepper = bubbleSortSteps(arr.slice(), chkOptimized.checked);
        }
        setPlaying(true);
        clearTimer();
        const intervalMs = speedToMs(Number(speedRange.value));
        timer = setInterval(() => {
          const done = processStep(stepper.next());
          if (done) {
            clearTimer();
          }
        }, intervalMs);
      }

      function pauseSorting() {
        setPlaying(false);
        clearTimer();
        setMessage('Paused.');
      }

      function resetSorting() {
        pauseSorting();
        arr = originalArr.slice();
        sortedSet.clear();
        stepper = null;
        resetStats();
        buildBars();
        clearHighlights();
        for (const b of bars) b.classList.remove('sorted');
        setMessage('Reset to original unsorted array.');
      }

      function stepOnce() {
        if (!stepper) {
          resetStats();
          stepper = bubbleSortSteps(arr.slice(), chkOptimized.checked);
        }
        const done = processStep(stepper.next());
        if (done) {
          pauseSorting();
        }
      }

      function speedToMs(speedVal) {
        // Map 1..60 to ~800ms..20ms
        const min = 20, max = 800;
        const t = (60 - speedVal) / 59; // 0..1
        const ms = Math.round(min + t * (max - min));
        return ms;
      }

      function initArray(n, kind = 'random') {
        pauseSorting();
        switch (kind) {
          case 'nearly': arr = generateNearlySortedArray(n); break;
          case 'reversed': arr = generateReversedArray(n); break;
          case 'distinct': arr = generateDistinctArray(n); break;
          default: arr = generateRandomArray(n);
        }
        originalArr = arr.slice();
        stepper = null;
        sortedSet.clear();
        resetStats();
        buildBars();
        clearHighlights();
        for (const b of bars) b.classList.remove('sorted');
        setMessage('Array generated. Press Start or Step to begin.');
      }

      // Event bindings
      btnGenerate.addEventListener('click', () => initArray(Number(sizeRange.value), 'random'));
      btnNearlySorted.addEventListener('click', () => initArray(Number(sizeRange.value), 'nearly'));
      btnReversed.addEventListener('click', () => initArray(Number(sizeRange.value), 'reversed'));
      btnDistinct.addEventListener('click', () => initArray(Number(sizeRange.value), 'distinct'));

      btnStart.addEventListener('click', startSorting);
      btnPause.addEventListener('click', pauseSorting);
      btnReset.addEventListener('click', resetSorting);
      btnStep.addEventListener('click', stepOnce);

      sizeRange.addEventListener('input', (e) => {
        sizeLabel.textContent = e.target.value;
      });
      sizeRange.addEventListener('change', () => initArray(Number(sizeRange.value), 'random'));

      speedRange.addEventListener('input', (e) => {
        speedLabel.textContent = `${Math.round((Number(e.target.value) / 60) * 10) / 10}x`;
        if (playing) {
          // Restart timer with new speed
          clearTimer();
          timer = setInterval(() => {
            const done = processStep(stepper.next());
            if (done) clearTimer();
          }, speedToMs(Number(speedRange.value)));
        }
      });

      chkLabels.addEventListener('change', () => updateHeights());
      chkOptimized.addEventListener('change', () => {
        // If currently sorting, restart with new optimization
        if (playing || stepper) {
          setMessage('Optimization setting changed. Resetting current sort.');
          resetSorting();
        }
      });

      window.addEventListener('resize', () => updateHeights());

      // Initialize
      initArray(Number(sizeRange.value), 'random');
    })();
  </script>
</body>
</html>