<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bubble Sort Visualizer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f172a;         /* slate-900 */
      --panel: #111827;      /* gray-900 */
      --text: #e5e7eb;       /* gray-200 */
      --muted: #9ca3af;      /* gray-400 */
      --accent: #22d3ee;     /* cyan-400 */
      --compareA: #f59e0b;   /* amber-500 */
      --compareB: #3b82f6;   /* blue-500 */
      --swap: #ef4444;       /* red-500 */
      --sorted: #10b981;     /* emerald-500 */
      --bar: #64748b;        /* slate-500 */
      --barHover: #94a3b8;   /* slate-400 */
      --btn: #1f2937;        /* gray-800 */
      --btnHover: #374151;   /* gray-700 */
      --inp: #0b1220;        /* darker bg */
      --focus: #22d3ee;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, #0b1020 0%, #0f172a 100%);
      color: var(--text);
      min-height: 100vh;
      display: grid;
      grid-template-rows: auto auto 1fr auto;
      gap: 12px;
    }
    header {
      padding: 16px 20px;
      border-bottom: 1px solid #1f2937;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 12px;
    }
    header h1 {
      margin: 0;
      font-size: 20px;
      letter-spacing: 0.3px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    header h1 .dot {
      width: 12px; height: 12px; border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 12px var(--accent);
    }
    header .subtitle {
      font-size: 12px;
      color: var(--muted);
    }

    .controls {
      padding: 8px 20px 0 20px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    .panel {
      background: var(--panel);
      border: 1px solid #1f2937;
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }
    .row .group {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    button {
      appearance: none;
      border: 1px solid #283241;
      background: var(--btn);
      color: var(--text);
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.15s ease, transform 0.04s ease;
      font-weight: 600;
      font-size: 14px;
    }
    button:hover { background: var(--btnHover); }
    button:active { transform: translateY(1px); }
    button.primary {
      background: #0ea5e9; /* sky-500 */
      border-color: #0284c7;
      color: #0b1220;
    }
    button.primary:hover { background: #38bdf8; }
    button.danger {
      background: #ef4444;
      border-color: #b91c1c;
      color: #0b1220;
    }
    button[disabled], button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .input {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border: 1px solid #263146;
      background: var(--inp);
      padding: 8px 10px;
      border-radius: 8px;
      min-width: 220px;
    }
    .input input[type="text"] {
      background: transparent;
      border: none;
      outline: none;
      color: var(--text);
      width: 300px;
      font-size: 14px;
    }
    .hint {
      font-size: 11px;
      color: var(--muted);
    }

    .slider-group {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #263146;
      background: var(--inp);
    }
    .slider-group input[type="range"] {
      accent-color: var(--focus);
    }
    .label {
      font-size: 12px;
      color: var(--muted);
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      margin-top: 8px;
    }
    .stat {
      background: #0c1324;
      border: 1px solid #1f2937;
      border-radius: 10px;
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .stat .title {
      font-size: 11px;
      color: var(--muted);
    }
    .stat .value {
      font-size: 16px;
      font-weight: 700;
      color: var(--text);
    }

    .visualizer {
      padding: 8px 20px 20px 20px;
    }
    .canvas {
      height: 360px;
      min-height: 260px;
      background: linear-gradient(180deg, #0d1426 0%, #0b1220 100%);
      border: 1px solid #1f2937;
      border-radius: 12px;
      position: relative;
      overflow: hidden;
      box-shadow: inset 0 0 30px rgba(0,0,0,0.35);
    }
    .bars {
      position: absolute;
      inset: 12px;
      display: flex;
      align-items: flex-end;
      gap: 4px;
      padding: 0 8px;
    }
    .bar {
      flex: 1 1 auto;
      min-width: 8px;
      background: var(--bar);
      border-radius: 6px 6px 0 0;
      transition: height 0.18s cubic-bezier(.25,.8,.25,1), background 0.12s ease, transform 0.1s ease;
      position: relative;
      box-shadow: 0 4px 10px rgba(0,0,0,0.25);
    }
    .bar:hover {
      background: var(--barHover);
      transform: translateY(-2px);
    }
    .bar .value {
      position: absolute;
      bottom: -22px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 11px;
      color: var(--muted);
      background: rgba(0,0,0,0.25);
      padding: 2px 6px;
      border-radius: 6px;
      white-space: nowrap;
      pointer-events: none;
    }
    .bar.compareA { background: var(--compareA); }
    .bar.compareB { background: var(--compareB); }
    .bar.swap { background: var(--swap); }
    .bar.sorted { background: var(--sorted); }
    .bar.currentPass { outline: 2px dashed rgba(34, 211, 238, 0.35); outline-offset: -2px; }

    .legend {
      padding: 10px 20px 0 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      font-size: 12px;
      color: var(--muted);
    }
    .legend .item { display: inline-flex; align-items: center; gap: 6px; }
    .legend .swatch {
      width: 14px; height: 14px; border-radius: 4px;
    }
    .swatch.compareA { background: var(--compareA); }
    .swatch.compareB { background: var(--compareB); }
    .swatch.swap { background: var(--swap); }
    .swatch.sorted { background: var(--sorted); }
    .swatch.default { background: var(--bar); }

    .code-panel {
      padding: 0 20px 20px 20px;
    }
    pre {
      margin: 0;
      overflow: auto;
      background: var(--panel);
      border: 1px solid #1f2937;
      border-radius: 12px;
      padding: 12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      line-height: 1.4;
      color: #cbd5e1;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    }

    footer {
      padding: 10px 20px 20px 20px;
      font-size: 12px;
      color: var(--muted);
    }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
    .error {
      color: #fca5a5;
      font-size: 12px;
      margin-left: 6px;
    }
  </style>
</head>
<body>
  <header>
    <h1><span class="dot"></span> Bubble Sort Visualizer</h1>
    <div class="subtitle">Step through comparisons and swaps to see how Bubble Sort works.</div>
  </header>

  <div class="controls">
    <div class="panel">
      <div class="row">
        <div class="group">
          <button id="btnPlay" class="primary">Play</button>
          <button id="btnPause">Pause</button>
          <button id="btnStep">Step</button>
          <button id="btnReset">Reset</button>
          <button id="btnRandom">Randomize</button>
        </div>
        <div class="group">
          <div class="slider-group">
            <span class="label">Speed</span>
            <input id="speed" type="range" min="10" max="1000" step="10" value="300" />
            <span id="speedLabel" class="label">300 ms/step</span>
          </div>
          <div class="slider-group">
            <span class="label">Size</span>
            <input id="size" type="range" min="5" max="60" step="1" value="20" />
            <span id="sizeLabel" class="label">20</span>
          </div>
        </div>
      </div>
      <div class="row" style="margin-top:8px">
        <div class="input" style="flex:1;">
          <input id="arrayInput" type="text" placeholder="Enter numbers (e.g., 5, 3, 8, 2, 9)" />
          <button id="btnSet">Set Input</button>
        </div>
        <span id="inputError" class="error"></span>
        <span class="hint">Tip: Use commas or spaces. Values should be integers between 1 and 99.</span>
      </div>
      <div class="stats">
        <div class="stat">
          <div class="title">Comparisons</div>
          <div id="statComparisons" class="value">0</div>
        </div>
        <div class="stat">
          <div class="title">Swaps</div>
          <div id="statSwaps" class="value">0</div>
        </div>
        <div class="stat">
          <div class="title">Pass</div>
          <div id="statPass" class="value">0</div>
        </div>
        <div class="stat">
          <div class="title">Status</div>
          <div id="statStatus" class="value">Ready</div>
        </div>
      </div>
    </div>
  </div>

  <div class="visualizer">
    <div class="canvas">
      <div id="bars" class="bars" aria-label="Bubble sort bars"></div>
    </div>
  </div>

  <div class="legend">
    <div class="item"><span class="swatch default"></span> Unsorted</div>
    <div class="item"><span class="swatch compareA"></span> Compare (left)</div>
    <div class="item"><span class="swatch compareB"></span> Compare (right)</div>
    <div class="item"><span class="swatch swap"></span> Swapped</div>
    <div class="item"><span class="swatch sorted"></span> Sorted tail</div>
  </div>

  <div class="code-panel">
    <pre>// Bubble Sort (ascending)
// Repeatedly step through the list, compare adjacent items,
// and swap them if they are in the wrong order.
// After each pass, the largest remaining element "bubbles" to the end.

function bubbleSort(arr) {
  const a = arr.slice();
  for (let i = 0; i &lt; a.length - 1; i++) {
    let swapped = false;
    for (let j = 0; j &lt; a.length - i - 1; j++) {
      if (a[j] &gt; a[j + 1]) {
        [a[j], a[j + 1]] = [a[j + 1], a[j]];
        swapped = true;
      }
    }
    if (!swapped) break; // Optimization: stop early if already sorted
  }
  return a;
}</pre>
  </div>

  <footer>
    Bubble Sort has average and worst-case time complexity O(n²) and is stable. It’s simple to implement and useful as an educational example, but generally inefficient for large datasets.
  </footer>

  <script>
    // Utility: sleep
    const sleep = (ms) => new Promise(res => setTimeout(res, ms));

    // State
    let baseArray = [];
    let currentArray = [];
    let gen = null;
    let playing = false;
    let speedMs = 300;
    let sizeN = 20;
    let currentStep = null;
    let comparisons = 0;
    let swaps = 0;
    let pass = 0;

    // Elements
    const barsEl = document.getElementById('bars');
    const statComparisonsEl = document.getElementById('statComparisons');
    const statSwapsEl = document.getElementById('statSwaps');
    const statPassEl = document.getElementById('statPass');
    const statStatusEl = document.getElementById('statStatus');

    const btnPlay = document.getElementById('btnPlay');
    const btnPause = document.getElementById('btnPause');
    const btnStep = document.getElementById('btnStep');
    const btnReset = document.getElementById('btnReset');
    const btnRandom = document.getElementById('btnRandom');
    const btnSet = document.getElementById('btnSet');

    const speedRange = document.getElementById('speed');
    const speedLabel = document.getElementById('speedLabel');
    const sizeRange = document.getElementById('size');
    const sizeLabel = document.getElementById('sizeLabel');

    const arrayInput = document.getElementById('arrayInput');
    const inputError = document.getElementById('inputError');

    // Random array generator
    function randomArray(n) {
      const arr = [];
      for (let i = 0; i < n; i++) {
        arr.push(Math.floor(5 + Math.random() * 95)); // 5..99
      }
      return arr;
    }

    // Bubble Sort generator producing detailed steps
    function* bubbleSortGenerator(arr) {
      const a = arr.slice();
      const n = a.length;
      let comps = 0;
      let swps = 0;
      // i passes completed = number of elements in sorted tail
      for (let i = 0; i < n - 1; i++) {
        let swappedInPass = false;
        for (let j = 0; j < n - i - 1; j++) {
          comps++;
          yield {
            type: 'compare',
            array: a.slice(),
            i,
            j,
            comparisons: comps,
            swaps: swps,
            sortedFromIndex: n - i, // tail of size i is sorted from here
          };
          if (a[j] > a[j + 1]) {
            const left = j, right = j + 1;
            [a[j], a[j + 1]] = [a[j + 1], a[j]];
            swps++;
            swappedInPass = true;
            yield {
              type: 'swap',
              array: a.slice(),
              i,
              j,
              swapped: [left, right],
              comparisons: comps,
              swaps: swps,
              sortedFromIndex: n - i,
            };
          }
        }
        // End of pass i: the largest among first n-i items moved to position n-i-1
        yield {
          type: 'pass_end',
          array: a.slice(),
          i,
          j: null,
          comparisons: comps,
          swaps: swps,
          sortedFromIndex: n - (i + 1),
        };
        if (!swappedInPass) {
          // Early exit: already sorted
          yield {
            type: 'done',
            array: a.slice(),
            i,
            j: null,
            comparisons: comps,
            swaps: swps,
            sortedFromIndex: 0,
          };
          return;
        }
      }
      yield {
        type: 'done',
        array: a.slice(),
        i: n - 1,
        j: null,
        comparisons: comps,
        swaps: swps,
        sortedFromIndex: 0,
      };
    }

    // Rendering
    function render(step) {
      if (!step) {
        // Initial state render
        barsEl.innerHTML = '';
        const max = Math.max(...currentArray, 100);
        currentArray.forEach((v, idx) => {
          const bar = document.createElement('div');
          bar.className = 'bar';
          bar.style.height = `${Math.round((v / max) * 100)}%`;
          const label = document.createElement('div');
          label.className = 'value';
          label.textContent = v;
          bar.appendChild(label);
          barsEl.appendChild(bar);
        });
        statComparisonsEl.textContent = '0';
        statSwapsEl.textContent = '0';
        statPassEl.textContent = '0';
        statStatusEl.textContent = 'Ready';
        return;
      }

      currentArray = step.array.slice();
      comparisons = step.comparisons ?? comparisons;
      swaps = step.swaps ?? swaps;
      pass = step.type === 'pass_end' ? (step.i + 1) : pass;

      barsEl.innerHTML = '';
      const max = Math.max(...currentArray, 100);

      for (let idx = 0; idx < currentArray.length; idx++) {
        const v = currentArray[idx];
        const bar = document.createElement('div');
        bar.className = 'bar';
        bar.style.height = `${Math.round((v / max) * 100)}%`;

        // Sorted tail
        if (idx >= (step.sortedFromIndex ?? currentArray.length + 1)) {
          bar.classList.add('sorted');
        }

        // Compare highlighting
        if (step.type === 'compare' && (idx === step.j || idx === step.j + 1)) {
          bar.classList.add(idx === step.j ? 'compareA' : 'compareB');
        }

        // Swap highlighting (after swap)
        if (step.type === 'swap' && step.swapped && step.swapped.includes(idx)) {
          bar.classList.add('swap');
        }

        // Optional outline for current pass (elements still in play)
        const stillUnsortedMaxIndex = (step.sortedFromIndex ?? currentArray.length) - 1;
        if (idx <= stillUnsortedMaxIndex) {
          bar.classList.add('currentPass');
        }

        const label = document.createElement('div');
        label.className = 'value';
        label.textContent = v;
        // Hide labels if too many bars to avoid clutter
        if (currentArray.length > 40) {
          label.style.display = 'none';
        }
        bar.appendChild(label);
        barsEl.appendChild(bar);
      }

      statComparisonsEl.textContent = String(comparisons);
      statSwapsEl.textContent = String(swaps);
      statPassEl.textContent = String(pass);
      statStatusEl.textContent =
        step.type === 'compare' ? `Comparing indices ${step.j} and ${step.j + 1}` :
        step.type === 'swap' ? `Swapped indices ${step.swapped[0]} and ${step.swapped[1]}` :
        step.type === 'pass_end' ? `End of pass ${step.i + 1}` :
        step.type === 'done' ? `Done` : `Ready`;
    }

    // Controls logic
    async function play() {
      if (!gen) gen = bubbleSortGenerator(baseArray);
      if (playing) return;
      playing = true;
      btnPlay.disabled = true;
      btnPause.disabled = false;
      btnStep.disabled = true;

      while (playing) {
        const next = gen.next();
        if (next.done) {
          render({ type: 'done', array: currentArray.slice(), comparisons, swaps, sortedFromIndex: 0 });
          playing = false;
          btnPlay.disabled = false;
          btnPause.disabled = true;
          btnStep.disabled = false;
          statStatusEl.textContent = 'Done';
          break;
        }
        currentStep = next.value;
        render(currentStep);
        await sleep(speedMs);
      }
    }

    function pause() {
      playing = false;
      btnPlay.disabled = false;
      btnPause.disabled = true;
      btnStep.disabled = false;
      statStatusEl.textContent = 'Paused';
    }

    function step() {
      if (!gen) gen = bubbleSortGenerator(baseArray);
      const next = gen.next();
      if (next.done) {
        render({ type: 'done', array: currentArray.slice(), comparisons, swaps, sortedFromIndex: 0 });
        statStatusEl.textContent = 'Done';
        btnPlay.disabled = false;
        btnPause.disabled = true;
        btnStep.disabled = true;
        playing = false;
        return;
      }
      currentStep = next.value;
      render(currentStep);
    }

    function reset() {
      pause();
      currentArray = baseArray.slice();
      gen = bubbleSortGenerator(baseArray);
      comparisons = 0;
      swaps = 0;
      pass = 0;
      currentStep = null;
      render(null);
    }

    function randomize() {
      pause();
      baseArray = randomArray(sizeN);
      currentArray = baseArray.slice();
      gen = bubbleSortGenerator(baseArray);
      comparisons = 0;
      swaps = 0;
      pass = 0;
      currentStep = null;
      inputError.textContent = '';
      arrayInput.value = '';
      render(null);
    }

    function setInputFromText() {
      const raw = arrayInput.value.trim();
      inputError.textContent = '';
      if (!raw) {
        inputError.textContent = 'Please enter some numbers.';
        return;
      }
      const tokens = raw.split(/[\s,]+/).filter(Boolean);
      const arr = [];
      for (const t of tokens) {
        if (!/^[-+]?\d+$/.test(t)) {
          inputError.textContent = `Invalid number: "${t}"`;
          return;
        }
        const num = parseInt(t, 10);
        if (num < 1 || num > 99) {
          inputError.textContent = `Numbers must be between 1 and 99.`;
          return;
        }
        arr.push(num);
      }
      if (arr.length < 2) {
        inputError.textContent = 'Need at least 2 numbers.';
        return;
      }
      if (arr.length > 100) {
        inputError.textContent = 'Too many numbers (max 100).';
        return;
      }
      pause();
      baseArray = arr.slice();
      sizeN = arr.length;
      sizeRange.value = String(sizeN);
      sizeLabel.textContent = String(sizeN);
      currentArray = baseArray.slice();
      gen = bubbleSortGenerator(baseArray);
      comparisons = 0;
      swaps = 0;
      pass = 0;
      currentStep = null;
      render(null);
    }

    // Event bindings
    btnPlay.addEventListener('click', play);
    btnPause.addEventListener('click', pause);
    btnStep.addEventListener('click', step);
    btnReset.addEventListener('click', reset);
    btnRandom.addEventListener('click', randomize);
    btnSet.addEventListener('click', setInputFromText);

    speedRange.addEventListener('input', () => {
      speedMs = Number(speedRange.value);
      speedLabel.textContent = `${speedMs} ms/step`;
    });

    sizeRange.addEventListener('input', () => {
      sizeN = Number(sizeRange.value);
      sizeLabel.textContent = String(sizeN);
    });
    sizeRange.addEventListener('change', () => {
      // Recreate random array with new size
      randomize();
    });

    // Keyboard shortcuts
    window.addEventListener('keydown', (e) => {
      // Space: Play/Pause, Enter: Step, Escape: Reset
      if (e.key === ' ') {
        e.preventDefault();
        if (playing) pause(); else play();
      } else if (e.key === 'Enter') {
        e.preventDefault();
        step();
      } else if (e.key === 'Escape') {
        e.preventDefault();
        reset();
      }
    });

    // Initial setup
    function init() {
      baseArray = randomArray(sizeN);
      currentArray = baseArray.slice();
      speedMs = Number(speedRange.value);
      sizeN = Number(sizeRange.value);
      sizeLabel.textContent = String(sizeN);
      speedLabel.textContent = `${speedMs} ms/step`;
      gen = bubbleSortGenerator(baseArray);
      render(null);
      btnPause.disabled = true;
    }

    init();
  </script>
</body>
</html>