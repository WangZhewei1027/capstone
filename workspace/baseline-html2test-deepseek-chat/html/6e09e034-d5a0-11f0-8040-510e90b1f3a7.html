<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bubble Sort Visualization</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
        }
        .description {
            text-align: center;
            margin-bottom: 30px;
            color: #7f8c8d;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        .array-input {
            width: 250px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .visualization {
            margin-top: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .array-bar {
            width: 30px;
            margin: 0 5px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            background-color: #3498db;
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .bars-container {
            display: flex;
            align-items: flex-end;
            margin-bottom: 20px;
            height: 200px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
            width: 100%;
            overflow-x: auto;
        }
        .comparison {
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
            padding: 5px 15px;
            border-radius: 4px;
            background-color: #f8f9fa;
            font-style: italic;
        }
        .active-bar {
            background-color: #e74c3c !important;
        }
        .compared-bar {
            background-color: #f39c12 !important;
        }
        .sorted-bar {
            background-color: #2ecc71 !important;
        }
        .steps {
            margin-top: 20px;
            text-align: center;
        }
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }
        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        .speed-slider {
            width: 150px;
        }
    </style>
</head>
<body>
    <h1>Bubble Sort Visualization</h1>
    <p class="description">Bubble Sort is a simple sorting algorithm that repeatedly steps through the list, 
    compares adjacent elements and swaps them if they are in the wrong order.</p>
    
    <div class="controls">
        <input type="text" id="arrayInput" class="array-input" placeholder="Enter numbers separated by commas (e.g., 5,3,8,4,2)">
        <button id="resetBtn">Reset Array</button>
        <button id="randomBtn">Generate Random Array</button>
        <button id="sortBtn">Start Bubble Sort</button>
        <button id="pauseBtn" disabled>Pause</button>
        <button id="stepBtn" disabled>Next Step</button>
    </div>

    <div class="speed-control">
        <span>Animation Speed:</span>
        <input type="range" id="speedSlider" class="speed-slider" min="1" max="10" value="5">
        <span id="speedValue">Medium</span>
    </div>

    <div class="legend">
        <div class="legend-item">
            <div class="legend-color" style="background-color: #3498db;"></div>
            <span>Normal Element</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #e74c3c;"></div>
            <span>Currently Comparing</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #f39c12;"></div>
            <span>Compared Element</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #2ecc71;"></div>
            <span>Sorted Element</span>
        </div>
    </div>

    <div class="visualization">
        <div id="barsContainer" class="bars-container"></div>
        <div id="comparisonText" class="comparison"></div>
        <div id="stepsText" class="steps">Steps: 0 | Comparisons: 0 | Swaps: 0</div>
    </div>

    <script>
        // Global variables for the algorithm
        let array = [];
        let isSorting = false;
        let isPaused = false;
        let currentStep = 0;
        let steps = 0;
        let comparisons = 0;
        let swaps = 0;
        let animationSpeed = 500; // ms
        
        // DOM elements
        const arrayInput = document.getElementById('arrayInput');
        const resetBtn = document.getElementById('resetBtn');
        const randomBtn = document.getElementById('randomBtn');
        const sortBtn = document.getElementById('sortBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const stepBtn = document.getElementById('stepBtn');
        const barsContainer = document.getElementById('barsContainer');
        const comparisonText = document.getElementById('comparisonText');
        const stepsText = document.getElementById('stepsText');
        const speedSlider = document.getElementById('speedSlider');
        const speedValue = document.getElementById('speedValue');
        
        // Initialize with a default array
        window.onload = function() {
            array = [5, 3, 8, 4, 2];
            arrayInput.value = array.join(', ');
            renderBars();
        };
        
        // Event listeners
        resetBtn.addEventListener('click', function() {
            if (isSorting) return;
            const inputArray = arrayInput.value.split(',').map(item => parseInt(item.trim())).filter(item => !isNaN(item));
            if (inputArray.length > 0) {
                array = inputArray;
                renderBars();
                resetStats();
            } else {
                alert('Please enter valid numbers separated by commas.');
            }
        });
        
        randomBtn.addEventListener('click', function() {
            if (isSorting) return;
            array = generateRandomArray(8, 1, 20);
            arrayInput.value = array.join(', ');
            renderBars();
            resetStats();
        });
        
        sortBtn.addEventListener('click', function() {
            if (isSorting) return;
            isSorting = true;
            sortBtn.disabled = true;
            pauseBtn.disabled = false;
            stepBtn.disabled = true;
            bubbleSort();
        });
        
        pauseBtn.addEventListener('click', function() {
            if (!isSorting) return;
            isPaused = !isPaused;
            pauseBtn.textContent = isPaused ? 'Resume' : 'Pause';
            stepBtn.disabled = !isPaused;
        });
        
        stepBtn.addEventListener('click', function() {
            if (!isPaused) return;
            executeSortStep();
        });
        
        speedSlider.addEventListener('input', function() {
            const speed = parseInt(this.value);
            animationSpeed = 1000 - (speed * 90); // Convert to ms (100ms to 1000ms)
            
            // Update speed label
            if (speed <= 3) speedValue.textContent = 'Slow';
            else if (speed <= 7) speedValue.textContent = 'Medium';
            else speedValue.textContent = 'Fast';
        });
        
        // Bubble Sort algorithm with visualization
        async function bubbleSort() {
            const n = array.length;
            let swapped;
            
            for (let i = 0; i < n - 1; i++) {
                swapped = false;
                
                for (let j = 0; j < n - i - 1; j++) {
                    // Update stats
                    comparisons++;
                    steps++;
                    updateStats();
                    
                    // Highlight compared elements
                    highlightBars(j, j + 1);
                    comparisonText.textContent = `Comparing ${array[j]} and ${array[j+1]}`;
                    
                    // Wait for next step or continue
                    if (isPaused) {
                        await waitForStep();
                    }
                    
                    // Compare adjacent elements
                    if (array[j] > array[j + 1]) {
                        // Swap elements
                        [array[j], array[j + 1]] = [array[j + 1], array[j]];
                        swapped = true;
                        swaps++;
                        
                        // Update visualization
                        renderBars();
                        highlightBars(j, j + 1);
                        comparisonText.textContent = `Swapping ${array[j+1]} and ${array[j]}`;
                        
                        if (isPaused) {
                            await waitForStep();
                        } else {
                            await sleep(animationSpeed);
                        }
                    }
                    
                    // Mark sorted elements
                    markSorted(n - i - 1);
                }
                
                // If no swapping occurred, array is sorted
                if (!swapped) break;
            }
            
            // Mark all elements as sorted
            markAllSorted();
            comparisonText.textContent = 'Array is sorted!';
            
            // Reset controls
            isSorting = false;
            sortBtn.disabled = false;
            pauseBtn.disabled = true;
            stepBtn.disabled = true;
            pauseBtn.textContent = 'Pause';
        }
        
        // Helper functions
        function generateRandomArray(size, min, max) {
            return Array.from({ length: size }, () => Math.floor(Math.random() * (max - min + 1)) + min);
        }
        
        function renderBars() {
            barsContainer.innerHTML = '';
            const maxValue = Math.max(...array);
            
            array.forEach((value, index) => {
                const bar = document.createElement('div');
                bar.className = 'array-bar';
                bar.style.height = `${(value / maxValue) * 180}px`;
                bar.textContent = value;
                bar.id = `bar-${index}`;
                barsContainer.appendChild(bar);
            });
        }
        
        function highlightBars(idx1, idx2) {
            // Reset all bars to normal state
            document.querySelectorAll('.array-bar').forEach(bar => {
                bar.classList.remove('active-bar', 'compared-bar');
            });
            
            // Highlight the bars being compared
            document.getElementById(`bar-${idx1}`).classList.add('active-bar');
            document.getElementById(`bar-${idx2}`).classList.add('compared-bar');
        }
        
        function markSorted(index) {
            document.getElementById(`bar-${index}`).classList.add('sorted-bar');
        }
        
        function markAllSorted() {
            document.querySelectorAll('.array-bar').forEach(bar => {
                bar.classList.remove('active-bar', 'compared-bar');
                bar.classList.add('sorted-bar');
            });
        }
        
        function updateStats() {
            stepsText.textContent = `Steps: ${steps} | Comparisons: ${comparisons} | Swaps: ${swaps}`;
        }
        
        function resetStats() {
            steps = 0;
            comparisons = 0;
            swaps = 0;
            updateStats();
            comparisonText.textContent = '';
            document.querySelectorAll('.array-bar').forEach(bar => {
                bar.classList.remove('active-bar', 'compared-bar', 'sorted-bar');
            });
        }
        
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        function waitForStep() {
            return new Promise(resolve => {
                const checkStep = setInterval(() => {
                    if (!isPaused) {
                        clearInterval(checkStep);
                        resolve();
                    }
                }, 100);
                
                stepBtn.onclick = function() {
                    clearInterval(checkStep);
                    resolve();
                };
            });
        }
        
        // Execute a single sorting step (for step-by-step mode)
        let sortState = { i: 0, j: 0 };
        
        function executeSortStep() {
            const n = array.length;
            let { i, j } = sortState;
            
            comparisons++;
            steps++;
            updateStats();
            
            highlightBars(j, j + 1);
            comparisonText.textContent = `Comparing ${array[j]} and ${array[j+1]}`;
            
            if (array[j] > array[j + 1]) {
                [array[j], array[j + 1]] = [array[j + 1], array[j]];
                swaps++;
                renderBars();
                highlightBars(j, j + 1);
                comparisonText.textContent = `Swapping ${array[j+1]} and ${array[j]}`;
            }
            
            j++;
            
            if (j >= n - i - 1) {
                markSorted(n - i - 1);
                i++;
                j = 0;
                
                if (i >= n - 1) {
                    markAllSorted();
                    comparisonText.textContent = 'Array is sorted!';
                    isSorting = false;
                    isPaused = false;
                    sortBtn.disabled = false;
                    pauseBtn.disabled = true;
                    stepBtn.disabled = true;
                    pauseBtn.textContent = 'Pause';
                    sortState = { i: 0, j: 0 };
                    return;
                }
            }
            
            sortState = { i, j };
        }
    </script>
</body>
</html>