<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merge Sort Visualization</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
        }
        
        .controls {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .array-input {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }
        
        input[type="text"] {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .algorithm-info {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .visualization {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .step {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .step-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .array-container {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        
        .array-element {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #3498db;
            color: white;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .array-element.merged {
            background-color: #2ecc71;
        }
        
        .array-element.being-sorted {
            background-color: #e74c3c;
        }
        
        .explanation {
            font-size: 14px;
            color: #555;
            margin-top: 10px;
        }
        
        .complexity {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        
        .complexity-item {
            text-align: center;
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            flex: 1;
            margin: 0 10px;
        }
        
        .complexity-value {
            font-size: 24px;
            font-weight: bold;
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <h1>Merge Sort Visualization</h1>
    
    <div class="controls">
        <div class="array-input">
            <label for="array-input">Enter numbers (comma-separated):</label>
            <input type="text" id="array-input" value="38, 27, 43, 3, 9, 82, 10">
            <button id="sort-button">Sort Step by Step</button>
            <button id="random-button">Generate Random Array</button>
        </div>
    </div>
    
    <div class="algorithm-info">
        <h2>About Merge Sort</h2>
        <p>Merge Sort is a divide-and-conquer algorithm that works by recursively dividing the array into smaller subarrays until each subarray contains a single element, and then merging those subarrays in a sorted manner.</p>
        
        <div class="complexity">
            <div class="complexity-item">
                <div>Time Complexity (Best)</div>
                <div class="complexity-value">O(n log n)</div>
            </div>
            <div class="complexity-item">
                <div>Time Complexity (Average)</div>
                <div class="complexity-value">O(n log n)</div>
            </div>
            <div class="complexity-item">
                <div>Time Complexity (Worst)</div>
                <div class="complexity-value">O(n log n)</div>
            </div>
            <div class="complexity-item">
                <div>Space Complexity</div>
                <div class="complexity-value">O(n)</div>
            </div>
        </div>
    </div>
    
    <div class="visualization" id="visualization">
        <!-- Steps will be dynamically added here -->
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const arrayInput = document.getElementById('array-input');
            const sortButton = document.getElementById('sort-button');
            const randomButton = document.getElementById('random-button');
            const visualization = document.getElementById('visualization');
            
            let currentStep = 0;
            let steps = [];
            
            // Generate random array
            randomButton.addEventListener('click', function() {
                const length = Math.floor(Math.random() * 10) + 5; // 5 to 14 elements
                const randomArray = [];
                for (let i = 0; i < length; i++) {
                    randomArray.push(Math.floor(Math.random() * 100) + 1);
                }
                arrayInput.value = randomArray.join(', ');
                resetVisualization();
            });
            
            // Start sorting
            sortButton.addEventListener('click', function() {
                const inputArray = arrayInput.value.split(',').map(num => parseInt(num.trim()));
                if (inputArray.some(isNaN)) {
                    alert('Please enter valid numbers separated by commas.');
                    return;
                }
                
                resetVisualization();
                steps = [];
                currentStep = 0;
                
                // Perform merge sort and capture steps
                mergeSortWithSteps(inputArray, 0, inputArray.length - 1, []);
                
                // Display first step
                displayStep(currentStep);
                
                // Add event listener for next step
                document.addEventListener('keydown', handleKeyPress);
            });
            
            function handleKeyPress(e) {
                if (e.key === 'ArrowRight') {
                    nextStep();
                } else if (e.key === 'ArrowLeft') {
                    previousStep();
                }
            }
            
            function nextStep() {
                if (currentStep < steps.length - 1) {
                    currentStep++;
                    displayStep(currentStep);
                }
            }
            
            function previousStep() {
                if (currentStep > 0) {
                    currentStep--;
                    displayStep(currentStep);
                }
            }
            
            function resetVisualization() {
                visualization.innerHTML = '';
                currentStep = 0;
                steps = [];
                document.removeEventListener('keydown', handleKeyPress);
            }
            
            function displayStep(stepIndex) {
                visualization.innerHTML = '';
                
                if (steps.length === 0) return;
                
                const step = steps[stepIndex];
                
                // Show step counter
                const stepCounter = document.createElement('div');
                stepCounter.innerHTML = `<strong>Step ${stepIndex + 1} of ${steps.length}</strong> - Use left/right arrow keys to navigate`;
                visualization.appendChild(stepCounter);
                
                // Create step visualization
                const stepDiv = document.createElement('div');
                stepDiv.className = 'step';
                
                const title = document.createElement('div');
                title.className = 'step-title';
                title.textContent = step.description;
                stepDiv.appendChild(title);
                
                const arrayContainer = document.createElement('div');
                arrayContainer.className = 'array-container';
                
                step.array.forEach((num, index) => {
                    const element = document.createElement('div');
                    element.className = 'array-element';
                    
                    // Highlight elements being processed
                    if (step.highlightedIndices && step.highlightedIndices.includes(index)) {
                        element.classList.add('being-sorted');
                    } 
                    // Highlight merged elements
                    else if (step.mergedIndices && step.mergedIndices.includes(index)) {
                        element.classList.add('merged');
                    }
                    
                    element.textContent = num;
                    arrayContainer.appendChild(element);
                });
                
                stepDiv.appendChild(arrayContainer);
                
                // Add explanation if available
                if (step.explanation) {
                    const explanation = document.createElement('div');
                    explanation.className = 'explanation';
                    explanation.textContent = step.explanation;
                    stepDiv.appendChild(explanation);
                }
                
                // Add navigation buttons
                const navDiv = document.createElement('div');
                navDiv.style.display = 'flex';
                navDiv.style.gap = '10px';
                navDiv.style.marginTop = '15px';
                
                const prevButton = document.createElement('button');
                prevButton.textContent = 'Previous Step';
                prevButton.disabled = stepIndex === 0;
                prevButton.addEventListener('click', previousStep);
                
                const nextButton = document.createElement('button');
                nextButton.textContent = 'Next Step';
                nextButton.disabled = stepIndex === steps.length - 1;
                nextButton.addEventListener('click', nextStep);
                
                navDiv.appendChild(prevButton);
                navDiv.appendChild(nextButton);
                stepDiv.appendChild(navDiv);
                
                visualization.appendChild(stepDiv);
            }
            
            function mergeSortWithSteps(arr, left, right, parentIndices) {
                if (left >= right) return;
                
                const mid = Math.floor((left + right) / 2);
                
                // Add step for dividing
                steps.push({
                    array: [...arr],
                    description: `Dividing array from index ${left} to ${right}`,
                    highlightedIndices: Array.from({length: right - left + 1}, (_, i) => left + i),
                    explanation: `Finding midpoint at index ${mid} and preparing to divide into left (${left}-${mid}) and right (${mid+1}-${right}) subarrays.`
                });
                
                // Recursively sort left and right halves
                mergeSortWithSteps(arr, left, mid, [...parentIndices, ...Array.from({length: mid - left + 1}, (_, i) => left + i)]);
                mergeSortWithSteps(arr, mid + 1, right, [...parentIndices, ...Array.from({length: right - mid}, (_, i) => mid + 1 + i)]);
                
                // Merge the sorted halves
                mergeWithSteps(arr, left, mid, right, parentIndices);
            }
            
            function mergeWithSteps(arr, left, mid, right, parentIndices) {
                const leftArr = arr.slice(left, mid + 1);
                const rightArr = arr.slice(mid + 1, right + 1);
                
                let i = 0, j = 0, k = left;
                const mergedIndices = [];
                
                // Add step for starting merge
                steps.push({
                    array: [...arr],
                    description: `Merging sorted subarrays from index ${left} to ${right}`,
                    highlightedIndices: Array.from({length: right - left + 1}, (_, idx) => left + idx),
                    explanation: `Comparing elements from left subarray [${leftArr.join(', ')}] and right subarray [${rightArr.join(', ')}].`
                });
                
                while (i < leftArr.length && j < rightArr.length) {
                    if (leftArr[i] <= rightArr[j]) {
                        arr[k] = leftArr[i];
                        mergedIndices.push(k);
                        
                        // Add step for comparison and placement
                        steps.push({
                            array: [...arr],
                            description: `Comparing ${leftArr[i]} (left) and ${rightArr[j]} (right)`,
                            highlightedIndices: [k],
                            mergedIndices: [...mergedIndices],
                            explanation: `${leftArr[i]} â‰¤ ${rightArr[j]}, so placing ${leftArr[i]} from left subarray at position ${k}.`
                        });
                        
                        i++;
                    } else {
                        arr[k] = rightArr[j];
                        mergedIndices.push(k);
                        
                        // Add step for comparison and placement
                        steps.push({
                            array: [...arr],
                            description: `Comparing ${leftArr[i]} (left) and ${rightArr[j]} (right)`,
                            highlightedIndices: [k],
                            mergedIndices: [...mergedIndices],
                            explanation: `${leftArr[i]} > ${rightArr[j]}, so placing ${rightArr[j]} from right subarray at position ${k}.`
                        });
                        
                        j++;
                    }
                    k++;
                }
                
                // Add remaining elements from leftArr
                while (i < leftArr.length) {
                    arr[k] = leftArr[i];
                    mergedIndices.push(k);
                    
                    steps.push({
                        array: [...arr],
                        description: `Adding remaining element from left subarray`,
                        highlightedIndices: [k],
                        mergedIndices: [...mergedIndices],
                        explanation: `Left subarray still has elements, so placing ${leftArr[i]} at position ${k}.`
                    });
                    
                    i++;
                    k++;
                }
                
                // Add remaining elements from rightArr
                while (j < rightArr.length) {
                    arr[k] = rightArr[j];
                    mergedIndices.push(k);
                    
                    steps.push({
                        array: [...arr],
                        description: `Adding remaining element from right subarray`,
                        highlightedIndices: [k],
                        mergedIndices: [...mergedIndices],
                        explanation: `Right subarray still has elements, so placing ${rightArr[j]} at position ${k}.`
                    });
                    
                    j++;
                    k++;
                }
                
                // Add final step for this merge
                steps.push({
                    array: [...arr],
                    description: `Completed merge from index ${left} to ${right}`,
                    highlightedIndices: Array.from({length: right - left + 1}, (_, idx) => left + idx),
                    mergedIndices: Array.from({length: right - left + 1}, (_, idx) => left + idx),
                    explanation: `Subarray from index ${left} to ${right} is now sorted: [${arr.slice(left, right + 1).join(', ')}].`
                });
            }
        });
    </script>
</body>
</html>