<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bubble Sort Demonstration</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 2rem;
    background-color: #f0f4f8;
    color: #333;
  }
  h1 {
    text-align: center;
    margin-bottom: 1rem;
  }
  #arrayInput {
    width: 100%;
    max-width: 400px;
    font-size: 1.1rem;
    padding: 0.5rem;
    margin-bottom: 0.5rem;
  }
  button {
    padding: 0.6rem 1rem;
    font-size: 1.1rem;
    cursor: pointer;
    margin-right: 1rem;
  }
  #sortBtn:disabled {
    background-color: #ccc;
    cursor: not-allowed;
  }
  #arrayContainer {
    display: flex;
    margin-top: 2rem;
    justify-content: center;
    gap: 0.5rem;
    flex-wrap: wrap;
  }
  .bar {
    background-color: #4a90e2;
    height: 50px;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    color: white;
    font-weight: bold;
    border-radius: 4px 4px 0 0;
    transition: background-color 0.3s ease;
    user-select: none;
  }
  .bar.current {
    background-color: #f39c12;
  }
  .bar.swapping {
    background-color: #e74c3c;
  }
  .bar.sorted {
    background-color: #2ecc71;
  }
  #steps {
    margin-top: 2rem;
    font-family: monospace;
    white-space: pre-line;
    max-height: 300px;
    overflow-y: auto;
    background: #222;
    color: #eee;
    padding: 1rem;
    border-radius: 8px;
  }
  @media (max-width: 600px) {
    #arrayContainer {
      justify-content: center;
    }
    .bar {
      height: 40px;
      font-size: 0.8rem;
    }
  }
</style>
</head>
<body>
<h1>Bubble Sort Visualization</h1>
<p>Enter numbers separated by commas (e.g. 5,3,8,6,2)</p>
<input type="text" id="arrayInput" placeholder="Enter numbers here" />
<button id="sortBtn">Start Bubble Sort</button>
<button id="resetBtn" disabled>Reset</button>

<div id="arrayContainer"></div>

<div id="steps"></div>

<script>
  const arrayInput = document.getElementById('arrayInput');
  const sortBtn = document.getElementById('sortBtn');
  const resetBtn = document.getElementById('resetBtn');
  const arrayContainer = document.getElementById('arrayContainer');
  const stepsContainer = document.getElementById('steps');

  let arr = [];
  let bars = [];
  let sorting = false;

  function parseInput(input) {
    // Parse input and ensure only numbers
    return input
      .split(',')
      .map(num => num.trim())
      .filter(num => num !== '')
      .map(num => Number(num))
      .filter(num => !isNaN(num));
  }

  function createBars(array) {
    arrayContainer.innerHTML = '';
    bars = [];
    for (let num of array) {
      const bar = document.createElement('div');
      bar.classList.add('bar');
      bar.style.width = `${Math.max(30, 300 / array.length)}px`;
      bar.style.height = `${num * 5 + 30}px`; // scaled height
      bar.textContent = num;
      arrayContainer.appendChild(bar);
      bars.push(bar);
    }
  }

  function logStep(text) {
    stepsContainer.textContent += text + '\n';
    stepsContainer.scrollTop = stepsContainer.scrollHeight;
  }

  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  async function bubbleSortVisual(array) {
    const n = array.length;
    sorting = true;
    sortBtn.disabled = true;
    resetBtn.disabled = false;
    arrayInput.disabled = true;
    stepsContainer.textContent = '';
    logStep('Starting Bubble Sort...\n');

    for (let i = 0; i < n -1; i++) {
      let swapped = false;
      logStep(`Pass ${i + 1}:`);
      for (let j = 0; j < n - i - 1; j++) {
        highlightBars(j, j+1, 'current');
        logStep(`  Compare indices ${j} and ${j+1}: ${array[j]} and ${array[j+1]}`);
        await sleep(600);

        if (array[j] > array[j+1]) {
          logStep(`  Swap ${array[j]} and ${array[j+1]}`);
          highlightBars(j, j+1, 'swapping');
          await sleep(600);

          // Swap values
          [array[j], array[j+1]] = [array[j+1], array[j]];

          updateBars(j, array[j]);
          updateBars(j+1, array[j+1]);

          await sleep(600);
          swapped = true;
        }
        clearHighlights(j, j+1);
      }
      markSorted(n - i - 1);
      if (!swapped) {
        logStep('No swaps done, array is sorted.');
        break;
      }
      logStep('');
    }
    // Mark the rest as sorted if early break
    for (let k = 0; k < n; k++) {
      bars[k].classList.add('sorted');
    }
    logStep('Sorting completed.');
    sorting = false;
    sortBtn.disabled = true;
    resetBtn.disabled = false;
    arrayInput.disabled = true;
  }

  function highlightBars(i, j, className) {
    bars[i].classList.add(className);
    bars[j].classList.add(className);
  }

  function clearHighlights(i, j) {
    bars[i].classList.remove('current', 'swapping');
    bars[j].classList.remove('current', 'swapping');
  }

  function updateBars(index, value) {
    bars[index].style.height = `${value * 5 + 30}px`;
    bars[index].textContent = value;
  }

  function markSorted(index) {
    bars[index].classList.add('sorted');
  }

  sortBtn.addEventListener('click', () => {
    if (sorting) return;
    arr = parseInput(arrayInput.value);
    if (arr.length < 2) {
      alert('Please enter at least two valid numbers.');
      return;
    }
    createBars(arr);
    bubbleSortVisual(arr);
  });

  resetBtn.addEventListener('click', () => {
    sorting = false;
    sortBtn.disabled = false;
    resetBtn.disabled = true;
    arrayInput.disabled = false;
    stepsContainer.textContent = '';
    arrayContainer.innerHTML = '';
  });

</script>
</body>
</html>