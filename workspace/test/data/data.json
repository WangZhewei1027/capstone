[
  {
    "id": "8a68eb30-c886-11f0-9c4a-bfd91516196d",
    "timestamp": "2025-11-23T16:10:51.518Z",
    "model": "gpt-5-mini",
    "status": "success",
    "question": "创建冒泡排序可视化",
    "answer": {
      "role": "assistant",
      "content": "<html lang=\"zh-CN\">\n<head>\n  <meta charset=\"utf-8\" />\n  <title>冒泡排序可视化</title>\n  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n  <style>\n    :root{\n      --bg:#0f1724;\n      --panel:#0b1220;\n      --accent:#3b82f6;\n      --muted:#94a3b8;\n      --good:#10b981;\n      --bad:#ef4444;\n      --compare:#f59e0b;\n      --bar-bg:#e6eef8;\n    }\n    *{box-sizing:border-box;font-family: \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial;}\n    body{\n      margin:0;\n      padding:20px;\n      background:linear-gradient(180deg,var(--bg),#071028 140%);\n      color:#e6eef8;\n      min-height:100vh;\n    }\n\n    .app{\n      max-width:1100px;\n      margin:0 auto;\n    }\n\n    header{\n      display:flex;\n      align-items:center;\n      gap:16px;\n      margin-bottom:12px;\n    }\n    header h1{\n      margin:0;\n      font-size:20px;\n    }\n    .controls{\n      display:flex;\n      gap:12px;\n      flex-wrap:wrap;\n      align-items:center;\n      margin-bottom:12px;\n      background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);\n      padding:12px;\n      border-radius:8px;\n      border:1px solid rgba(255,255,255,0.03);\n    }\n    .controls > * {display:flex; align-items:center; gap:8px;}\n    button{\n      background:var(--accent);\n      color:white;\n      border:0;\n      padding:8px 12px;\n      border-radius:6px;\n      cursor:pointer;\n      box-shadow:0 6px 18px rgba(59,130,246,0.12);\n    }\n    button.secondary{\n      background:transparent;\n      border:1px solid rgba(255,255,255,0.06);\n      color:var(--muted);\n      padding:8px 10px;\n    }\n    button.danger{\n      background:var(--bad);\n    }\n    input[type=\"range\"]{\n      cursor:pointer;\n    }\n    .panel{\n      display:grid;\n      grid-template-columns: 1fr 360px;\n      gap:12px;\n      align-items:start;\n    }\n    .visual{\n      background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);\n      padding:12px;\n      border-radius:8px;\n      border:1px solid rgba(255,255,255,0.03);\n      min-height:320px;\n    }\n    .bars{\n      display:flex;\n      align-items:flex-end;\n      gap:4px;\n      height:320px;\n      width:100%;\n      padding:8px;\n      background:linear-gradient(90deg, rgba(255,255,255,0.01), transparent);\n      border-radius:6px;\n    }\n    .bar{\n      flex:1;\n      background:var(--bar-bg);\n      border-radius:4px 4px 2px 2px;\n      display:flex;\n      align-items:flex-end;\n      justify-content:center;\n      color:#0b1220;\n      font-weight:700;\n      transition: height 180ms ease, background 180ms ease, transform 180ms ease;\n      position:relative;\n      user-select:none;\n      cursor:pointer;\n    }\n    .bar span{\n      transform:translateY(-6px);\n      font-size:12px;\n      color:rgba(11,18,32,0.9);\n    }\n    .legend{\n      display:flex;\n      gap:8px;\n      margin-top:8px;\n      color:var(--muted);\n      font-size:13px;\n    }\n    .legend > div{display:flex; gap:6px; align-items:center;}\n    .chip{width:16px;height:12px;border-radius:3px;}\n    .stats{\n      display:flex;\n      gap:12px;\n      margin-top:8px;\n      color:var(--muted);\n      font-size:13px;\n    }\n\n    aside{\n      background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);\n      padding:12px;\n      border-radius:8px;\n      border:1px solid rgba(255,255,255,0.03);\n      color:var(--muted);\n    }\n    .section{\n      margin-bottom:12px;\n    }\n    label{font-size:13px;color:var(--muted);}\n    .row{display:flex;gap:8px;align-items:center;margin-top:6px;}\n    .pseudocode{\n      background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);\n      padding:8px;\n      border-radius:6px;\n      border:1px solid rgba(255,255,255,0.02);\n      font-family: monospace;\n      font-size:13px;\n      color:var(--muted);\n    }\n    .line{\n      padding:6px 8px;\n      border-radius:4px;\n    }\n    .line.active{\n      background:rgba(59,130,246,0.12);\n      color:var(--accent);\n      border-left:3px solid var(--accent);\n      padding-left:6px;\n    }\n    .small{\n      font-size:13px;\n      color:var(--muted);\n    }\n    .footer{\n      margin-top:12px;\n      color:var(--muted);\n      font-size:13px;\n    }\n    .flex-space{flex:1}\n    .saved-controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}\n    @media (max-width:900px){\n      .panel{grid-template-columns:1fr;}\n      .bars{height:240px}\n    }\n  </style>\n</head>\n<body>\n  <div class=\"app\">\n    <header>\n      <h1>冒泡排序可视化</h1>\n      <div class=\"small\">演示冒泡排序算法，支持开始/暂停/单步/速度/数组大小控制</div>\n    </header>\n\n    <div class=\"controls\">\n      <div>\n        <button id=\"btn-generate\">生成随机数组</button>\n        <button id=\"btn-start\">开始</button>\n        <button id=\"btn-pause\" class=\"secondary\">暂停</button>\n        <button id=\"btn-step\" class=\"secondary\">单步</button>\n        <button id=\"btn-reset\" class=\"secondary\">重置</button>\n      </div>\n\n      <div>\n        <label>大小</label>\n        <input id=\"size\" type=\"range\" min=\"5\" max=\"80\" value=\"30\"/>\n        <span id=\"size-val\">30</span>\n      </div>\n\n      <div>\n        <label>速度</label>\n        <input id=\"speed\" type=\"range\" min=\"1\" max=\"1000\" value=\"200\"/>\n        <span id=\"speed-val\">200 ms</span>\n      </div>\n\n      <div>\n        <label>方向</label>\n        <select id=\"order\">\n          <option value=\"asc\">升序</option>\n          <option value=\"desc\">降序</option>\n        </select>\n      </div>\n\n      <div class=\"flex-space\"></div>\n\n      <div class=\"saved-controls\">\n        <div class=\"small\">比较: <strong id=\"comp\">0</strong></div>\n        <div class=\"small\">交换: <strong id=\"swaps\">0</strong></div>\n        <div class=\"small\">步数: <strong id=\"steps\">0</strong></div>\n      </div>\n    </div>\n\n    <div class=\"panel\">\n      <div class=\"visual\">\n        <div class=\"bars\" id=\"bars\" title=\"点击条形可以修改数值\"></div>\n\n        <div class=\"legend\">\n          <div><div class=\"chip\" style=\"background:var(--compare)\"></div><div>比较中</div></div>\n          <div><div class=\"chip\" style=\"background:var(--bad)\"></div><div>正在交换</div></div>\n          <div><div class=\"chip\" style=\"background:var(--good)\"></div><div>已排序</div></div>\n        </div>\n\n        <div class=\"stats\">\n          <div>数组长度: <strong id=\"nsize\">0</strong></div>\n          <div>当前 i: <strong id=\"cur-i\">-</strong></div>\n          <div>当前 j: <strong id=\"cur-j\">-</strong></div>\n          <div>已完成轮数: <strong id=\"passes\">0</strong></div>\n        </div>\n      </div>\n\n      <aside>\n        <div class=\"section\">\n          <div style=\"display:flex;justify-content:space-between;align-items:center;\">\n            <div><strong>伪代码</strong></div>\n            <div class=\"small\">当前高亮显示执行行</div>\n          </div>\n          <div class=\"pseudocode\" id=\"pseudocode\" style=\"margin-top:8px;\">\n            <div class=\"line\" data-line=\"1\">1. procedure bubbleSort(A)</div>\n            <div class=\"line\" data-line=\"2\">2.   n = length(A)</div>\n            <div class=\"line\" data-line=\"3\">3.   for i from 0 to n-2</div>\n            <div class=\"line\" data-line=\"4\">4.     for j from 0 to n-i-2</div>\n            <div class=\"line\" data-line=\"5\">5.       if A[j] &gt; A[j+1]</div>\n            <div class=\"line\" data-line=\"6\">6.         swap A[j], A[j+1]</div>\n            <div class=\"line\" data-line=\"7\">7.   end</div>\n          </div>\n        </div>\n\n        <div class=\"section\">\n          <strong>说明</strong>\n          <div class=\"small\" style=\"margin-top:6px;\">\n            点击“生成随机数组”创建一个新的数组。点击条形可以修改该元素为随机值。可用“开始”开始自动可视化，使用“暂停”停止，“单步”逐步执行。\n          </div>\n        </div>\n\n        <div class=\"section\">\n          <strong>快速提示</strong>\n          <div class=\"small\" style=\"margin-top:6px;\">\n            - 减小速度值会让可视化更快（ms延迟）。<br>\n            - 改变大小会生成新的数组。<br>\n            - 排序方向可切换升序/降序。\n          </div>\n        </div>\n      </aside>\n    </div>\n\n    <div class=\"footer\">\n      演示仅用于学习目的 — 冒泡排序时间复杂度 O(n^2)。\n    </div>\n  </div>\n\n  <script>\n    (function(){\n      // DOM elements\n      const barsEl = document.getElementById('bars');\n      const btnGenerate = document.getElementById('btn-generate');\n      const btnStart = document.getElementById('btn-start');\n      const btnPause = document.getElementById('btn-pause');\n      const btnStep = document.getElementById('btn-step');\n      const btnReset = document.getElementById('btn-reset');\n      const sizeInput = document.getElementById('size');\n      const sizeVal = document.getElementById('size-val');\n      const speedInput = document.getElementById('speed');\n      const speedVal = document.getElementById('speed-val');\n      const orderSelect = document.getElementById('order');\n\n      const compEl = document.getElementById('comp');\n      const swapsEl = document.getElementById('swaps');\n      const stepsEl = document.getElementById('steps');\n      const nsizeEl = document.getElementById('nsize');\n      const curIEl = document.getElementById('cur-i');\n      const curJEl = document.getElementById('cur-j');\n      const passesEl = document.getElementById('passes');\n\n      const pseudoLines = Array.from(document.querySelectorAll('.pseudocode .line'));\n\n      // state\n      let arr = [];\n      let bars = []; // DOM nodes\n      let n = parseInt(sizeInput.value,10) || 30;\n      let running = false;\n      let sorting = false;\n      let aborted = false;\n      let stepRequested = false;\n      let waitingResolve = null;\n      let compareCount = 0;\n      let swapCount = 0;\n      let stepCount = 0;\n      let passCount = 0;\n      let currentI = null;\n      let currentJ = null;\n\n      function randInt(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }\n\n      function createArray(len){\n        const a = [];\n        for(let i=0;i<len;i++) a.push(randInt(5,100));\n        return a;\n      }\n\n      function renderArray(){\n        barsEl.innerHTML='';\n        bars = [];\n        const maxVal = Math.max(...arr);\n        arr.forEach((v,i)=>{\n          const bar = document.createElement('div');\n          bar.className='bar';\n          bar.style.height = (v / maxVal * 100) + '%';\n          bar.style.flex = (1).toString();\n          bar.dataset.index = i;\n          bar.innerHTML = '<span>' + v + '</span>';\n          bar.title = '值: ' + v;\n          bar.addEventListener('click', ()=> {\n            if(sorting){ // if sorting, clicking won't change while running but allowed to change when paused\n              if(running) return;\n            }\n            const newVal = randInt(5,100);\n            arr[i] = newVal;\n            updateBars();\n          });\n          barsEl.appendChild(bar);\n          bars.push(bar);\n        });\n        nsizeEl.textContent = arr.length;\n      }\n\n      function updateBars(highlight = {}) {\n        // highlight: {compare:[i,j], swap:[i,j], sorted: uptoIndex}\n        const maxVal = Math.max(...arr);\n        bars.forEach((bar, i) => {\n          bar.style.height = (arr[i] / maxVal * 100) + '%';\n          bar.querySelector('span').textContent = arr[i];\n          bar.style.background = '';\n          bar.style.transform = '';\n          bar.style.zIndex = '0';\n        });\n\n        if(highlight.compare){\n          highlight.compare.forEach(idx=>{\n            if(bars[idx]) bars[idx].style.background = 'var(--compare)';\n          });\n        }\n        if(highlight.swap){\n          highlight.swap.forEach(idx=>{\n            if(bars[idx]) {\n              bars[idx].style.background = 'var(--bad)';\n              bars[idx].style.transform = 'scale(1.03)';\n              bars[idx].style.zIndex = '2';\n            }\n          });\n        }\n        if(typeof highlight.sorted === 'number'){\n          for(let k=highlight.sorted;k<arr.length;k++){\n            if(bars[k]) bars[k].style.background = 'var(--good)';\n          }\n        }\n      }\n\n      function setPseudoline(lineNum){\n        pseudoLines.forEach(l=>{\n          l.classList.toggle('active', parseInt(l.dataset.line,10)===lineNum);\n        });\n      }\n\n      function resetStats(){\n        compareCount=0; swapCount=0; stepCount=0; passCount=0;\n        compEl.textContent = compareCount;\n        swapsEl.textContent = swapCount;\n        stepsEl.textContent = stepCount;\n        passesEl.textContent = passCount;\n        curIEl.textContent = '-';\n        curJEl.textContent = '-';\n      }\n\n      function setControlsDuringRun(isRunning){\n        btnStart.disabled = isRunning;\n        btnGenerate.disabled = isRunning;\n        sizeInput.disabled = isRunning;\n        orderSelect.disabled = isRunning;\n      }\n\n      // wait mechanism: waits until user resumes or step requested\n      function waitForStepOrResume(){\n        // If running is true, proceed immediately but still delay to reflect speed\n        const delay = Math.max(1, parseInt(speedInput.value,10));\n        return new Promise(resolve => {\n          // If running is false, store resolver and return when resumed/stepped\n          if(!running){\n            waitingResolve = () => {\n              waitingResolve = null;\n              // small animation delay then resolve\n              setTimeout(resolve, delay);\n            };\n          } else {\n            // if stepRequested true, we allow one step and then pause\n            if(stepRequested){\n              stepRequested = false;\n              running = false; // pause after taking this step\n              setTimeout(resolve, delay);\n            } else {\n              setTimeout(resolve, delay);\n            }\n          }\n        });\n      }\n\n      // Controls\n      btnGenerate.addEventListener('click', ()=>{\n        aborted = true;\n        running = false;\n        sorting = false;\n        arr = createArray(parseInt(sizeInput.value,10));\n        renderArray();\n        resetStats();\n        setPseudoline(0);\n      });\n\n      btnReset.addEventListener('click', ()=>{\n        aborted = true;\n        running = false;\n        sorting = false;\n        arr = createArray(parseInt(sizeInput.value,10));\n        renderArray();\n        resetStats();\n        setPseudoline(0);\n      });\n\n      sizeInput.addEventListener('input', ()=>{\n        sizeVal.textContent = sizeInput.value;\n      });\n\n      sizeInput.addEventListener('change', ()=>{\n        aborted = true;\n        running = false;\n        sorting = false;\n        n = parseInt(sizeInput.value,10);\n        arr = createArray(n);\n        renderArray();\n        resetStats();\n        setPseudoline(0);\n      });\n\n      speedInput.addEventListener('input', ()=>{\n        speedVal.textContent = speedInput.value + ' ms';\n      });\n\n      btnStart.addEventListener('click', async ()=>{\n        if(sorting){\n          running = true;\n          // resume if paused\n          if(waitingResolve) { waitingResolve(); }\n          setControlsDuringRun(true);\n          return;\n        }\n        // start new sort\n        aborted = false;\n        sorting = true;\n        running = true;\n        setControlsDuringRun(true);\n        resetStats();\n        await bubbleSortVisual(arr, orderSelect.value);\n        sorting = false;\n        running = false;\n        setControlsDuringRun(false);\n      });\n\n      btnPause.addEventListener('click', ()=>{\n        running = false;\n        // do not resolve waiting; simply pause\n        setControlsDuringRun(false);\n      });\n\n      btnStep.addEventListener('click', ()=>{\n        // If not sorting yet, start sorting but immediately pause after first step.\n        if(!sorting){\n          // Start but set stepRequested so it runs one step then pauses\n          sorting = true;\n          running = true;\n          stepRequested = true;\n          setControlsDuringRun(true);\n          // start the algorithm\n          bubbleSortVisual(arr, orderSelect.value).then(()=>{\n            sorting = false;\n            running = false;\n            setControlsDuringRun(false);\n          });\n          return;\n        }\n        // If waitingResolve exists, cause it to resolve once (single step)\n        if(waitingResolve){\n          waitingResolve();\n        } else {\n          // if currently running but we want exactly one step from paused state\n          stepRequested = true;\n          running = true;\n        }\n      });\n\n      // initial array\n      arr = createArray(n);\n      renderArray();\n      resetStats();\n\n      // bubble sort visualization algorithm\n      async function bubbleSortVisual(A, order='asc'){\n        const cmp = (x,y) => (order==='asc' ? x>y : x<y);\n        const len = A.length;\n        nsizeEl.textContent = len;\n        setPseudoline(1);\n        await waitForStepOrResume(); if(aborted) return;\n\n        setPseudoline(2);\n        await waitForStepOrResume(); if(aborted) return;\n\n        for(let i=0;i<len-1;i++){\n          currentI = i;\n          currentJ = null;\n          passCount = i;\n          passesEl.textContent = passCount;\n          curIEl.textContent = i;\n          setPseudoline(3);\n          await waitForStepOrResume(); if(aborted) return;\n\n          let swapped = false;\n          for(let j=0;j<len-i-1;j++){\n            currentJ = j;\n            curJEl.textContent = j;\n            // highlight compare\n            setPseudoline(4);\n            updateBars({compare:[j, j+1], sorted: len - i});\n            await waitForStepOrResume(); if(aborted) return;\n\n            setPseudoline(5);\n            compareCount++;\n            compEl.textContent = compareCount;\n            stepCount++;\n            stepsEl.textContent = stepCount;\n\n            if(cmp(A[j], A[j+1])){\n              // swap\n              setPseudoline(6);\n              swapCount++;\n              swapsEl.textContent = swapCount;\n              swapped = true;\n              // highlight swap\n              updateBars({swap:[j,j+1], sorted: len - i});\n              await waitForStepOrResume(); if(aborted) return;\n\n              // do actual swap (with animation via height change)\n              const tmp = A[j];\n              A[j] = A[j+1];\n              A[j+1] = tmp;\n              updateBars({swap:[j,j+1], sorted: len - i});\n              await waitForStepOrResume(); if(aborted) return;\n            } else {\n              // not swapped, still show compare highlight briefly\n              updateBars({compare:[j,j+1], sorted: len - i});\n              await waitForStepOrResume(); if(aborted) return;\n            }\n            // after each inner iteration, clear highlights\n            updateBars({sorted: len - i});\n            await waitForStepOrResume(); if(aborted) return;\n          }\n          // after inner loop, mark last element as sorted (len-i-1)\n          updateBars({sorted: len - i - 1});\n          setPseudoline(7);\n          await waitForStepOrResume(); if(aborted) return;\n\n          if(!swapped){\n            // array is sorted; mark all sorted\n            updateBars({sorted:0});\n            break;\n          }\n        }\n        // finished\n        updateBars({sorted:0});\n        curIEl.textContent = '-';\n        curJEl.textContent = '-';\n        setPseudoline(0);\n      }\n\n      // If user clicks resume while waiting\n      document.addEventListener('visibilitychange', ()=>{\n        // no-op\n      });\n\n      // Allow keyboard shortcuts\n      window.addEventListener('keydown', (e)=>{\n        if(e.code==='Space'){\n          e.preventDefault();\n          if(running){ btnPause.click(); } else { btnStart.click(); }\n        } else if(e.key==='ArrowRight'){\n          btnStep.click();\n        }\n      });\n\n      // If waitingResolve is present and user clicks resume or start\n      // We already call waitingResolve in btnStart/btnStep handlers when appropriate.\n\n      // Safety: when clicking generate or reset during waiting, ensure waiting resolves to stop pending promises\n      const ensureResolveWaiting = () => {\n        if(waitingResolve){ waitingResolve(); waitingResolve = null; }\n      };\n\n      btnGenerate.addEventListener('click', ensureResolveWaiting);\n      btnReset.addEventListener('click', ensureResolveWaiting);\n      btnPause.addEventListener('click', ensureResolveWaiting);\n\n    })();\n  </script>\n</body>\n</html>"
    },
    "messages": [
      {
        "role": "system",
        "content": "Generate a single HTML file with JavaScript demonstrating the user-given concept. Only respond in a single HTML file."
      },
      {
        "role": "user",
        "content": "创建冒泡排序可视化"
      }
    ],
    "topic": "Bubble Sort",
    "hasFSM": true,
    "hasTest": true,
    "evaluation": {
      "score": null,
      "notes": ""
    }
  }
]