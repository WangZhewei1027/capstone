{
  "meta": {
    "concept": "BubbleSort",
    "topic": "Simple Bubble Sort Demonstration",
    "educational_goal": "Show how bubble sort compares and swaps adjacent elements",
    "expected_interactions": ["input_array", "start_sort", "reset"]
  },
  "states": [
    {
      "id": "S0_Idle",
      "label": "Idle",
      "type": "idle",
      "entry_actions": ["showInputField()", "enableControls()"],
      "exit_actions": []
    },
    {
      "id": "S1_ArrayReady",
      "label": "ArrayReady",
      "type": "atomic",
      "entry_actions": ["renderArray()", "enableSortButton()"],
      "exit_actions": []
    },
    {
      "id": "S2_Comparing",
      "label": "Comparing",
      "type": "atomic",
      "entry_actions": ["highlightPair()", "showComparison()"],
      "exit_actions": ["removeHighlight()"]
    },
    {
      "id": "S3_Swapping",
      "label": "Swapping",
      "type": "atomic",
      "entry_actions": ["animateSwap()", "updateArray()"],
      "exit_actions": []
    },
    {
      "id": "S4_PassComplete",
      "label": "PassComplete",
      "type": "atomic",
      "entry_actions": ["markSorted()", "checkIfDone()"],
      "exit_actions": []
    },
    {
      "id": "S5_SortComplete",
      "label": "SortComplete",
      "type": "atomic",
      "entry_actions": ["showSuccess()", "enableReset()"],
      "exit_actions": []
    }
  ],
  "events": [
    {
      "id": "arrayInputEntered",
      "event_type": "user_input",
      "description": "User enters array values"
    },
    {
      "id": "startButtonClicked",
      "event_type": "user_action",
      "description": "User clicks start sorting"
    },
    {
      "id": "resetButtonClicked",
      "event_type": "user_action",
      "description": "User clicks reset"
    },
    {
      "id": "comparisonDone",
      "event_type": "system_event",
      "description": "Comparison of two elements complete"
    },
    {
      "id": "swapDone",
      "event_type": "system_event",
      "description": "Element swap animation complete"
    },
    {
      "id": "passFinished",
      "event_type": "system_event",
      "description": "One pass through array complete"
    },
    {
      "id": "sortingFinished",
      "event_type": "system_event",
      "description": "All elements are sorted"
    }
  ],
  "transitions": [
    {
      "from": "S0_Idle",
      "to": "S1_ArrayReady",
      "event": "arrayInputEntered",
      "guard": "validInput",
      "actions": ["parseArray()", "visualizeArray()"],
      "expected_observables": ["visual:arrayDisplayed"],
      "timeout": 1000
    },
    {
      "from": "S1_ArrayReady",
      "to": "S2_Comparing",
      "event": "startButtonClicked",
      "guard": "arrayNotEmpty",
      "actions": ["startBubbleSort()", "selectFirstPair()"],
      "expected_observables": ["visual:sortingStarted"],
      "timeout": 500
    },
    {
      "from": "S2_Comparing",
      "to": "S3_Swapping",
      "event": "comparisonDone",
      "guard": "needsSwap",
      "actions": ["swapElements()"],
      "expected_observables": ["visual:elementsSwapped"],
      "timeout": 1000
    },
    {
      "from": "S2_Comparing",
      "to": "S2_Comparing",
      "event": "comparisonDone",
      "guard": "noSwapNeeded",
      "actions": ["moveToNextPair()"],
      "expected_observables": ["visual:nextComparison"],
      "timeout": 500
    },
    {
      "from": "S3_Swapping",
      "to": "S2_Comparing",
      "event": "swapDone",
      "guard": "moreComparisons",
      "actions": ["moveToNextPair()"],
      "expected_observables": ["visual:nextComparison"],
      "timeout": 500
    },
    {
      "from": "S2_Comparing",
      "to": "S4_PassComplete",
      "event": "passFinished",
      "guard": "passEnded",
      "actions": ["completeBubblePass()"],
      "expected_observables": ["visual:passCompleted"],
      "timeout": 800
    },
    {
      "from": "S3_Swapping",
      "to": "S4_PassComplete",
      "event": "passFinished",
      "guard": "passEnded",
      "actions": ["completeBubblePass()"],
      "expected_observables": ["visual:passCompleted"],
      "timeout": 800
    },
    {
      "from": "S4_PassComplete",
      "to": "S2_Comparing",
      "event": "passFinished",
      "guard": "morePassesNeeded",
      "actions": ["startNextPass()"],
      "expected_observables": ["visual:nextPassStarted"],
      "timeout": 1000
    },
    {
      "from": "S4_PassComplete",
      "to": "S5_SortComplete",
      "event": "sortingFinished",
      "guard": "allSorted",
      "actions": ["celebrateCompletion()"],
      "expected_observables": ["visual:sortCompleted"],
      "timeout": 2000
    },
    {
      "from": "S5_SortComplete",
      "to": "S0_Idle",
      "event": "resetButtonClicked",
      "guard": "true",
      "actions": ["clearVisualization()", "resetState()"],
      "expected_observables": ["visual:reset"],
      "timeout": 500
    },
    {
      "from": "S1_ArrayReady",
      "to": "S0_Idle",
      "event": "resetButtonClicked",
      "guard": "true",
      "actions": ["clearArray()", "resetControls()"],
      "expected_observables": ["visual:reset"],
      "timeout": 500
    }
  ],
  "components": [
    "array_input",
    "start_button",
    "reset_button",
    "array_visualization"
  ]
}
