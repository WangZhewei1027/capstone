<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bubble Sort Interactive Visualization</title>
    <style>
        body {
            margin: 0;
            padding: 24px;
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }
        h1 {
            text-align: center;
        }
        #array-container {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            margin-bottom: 16px;
        }
        .bar {
            width: 24px;
            margin: 0 8px;
            background-color: #4CAF50;
            transition: height 0.5s ease;
        }
        .swapping {
            background-color: #FF5722; /* Red for swapping */
        }
        #controls {
            text-align: center;
            margin-bottom: 16px;
        }
        #iteration-count {
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>
<body>

<h1>Understanding Bubble Sort</h1>
<p>Drag and drop numbers to create your unsorted list. Click "Sort" to visualize the bubble sort algorithm.</p>

<div id="array-container"></div>

<div id="controls">
    <button id="sort-btn">Sort</button>
    <button id="pause-btn">Pause</button>
    <button id="step-btn">Step</button>
</div>

<div id="iteration-count">Iterations: 0</div>

<script>
    const arrayContainer = document.getElementById('array-container');
    const sortBtn = document.getElementById('sort-btn');
    const pauseBtn = document.getElementById('pause-btn');
    const stepBtn = document.getElementById('step-btn');
    const iterationCount = document.getElementById('iteration-count');

    let array = [];
    let iteration = 0;
    let intervalId;
    let isPaused = false;

    function initializeArray() {
        array = [];
        arrayContainer.innerHTML = '';
        for (let i = 10; i < 100; i += 10) {
            let bar = document.createElement('div');
            bar.classList.add('bar');
            bar.style.height = i + 'px';
            bar.setAttribute('draggable', 'true');
            bar.innerText = i / 10;
            bar.addEventListener('dragstart', dragStart);
            arrayContainer.appendChild(bar);
            array.push(i / 10);
        }
    }

    function dragStart(e) {
        e.dataTransfer.setData("text/plain", e.target.style.height);
        e.dataTransfer.setData("textContent", e.target.innerText);
        e.target.classList.add('swapping');
    }

    document.addEventListener('dragover', (e) => e.preventDefault());
    document.addEventListener('drop', (e) => {
        e.preventDefault();
        const draggedHeight = e.dataTransfer.getData("text/plain");
        const draggedValue = e.dataTransfer.getData("textContent");
        const droppedBar = document.elementFromPoint(e.clientX, e.clientY);
        
        if (droppedBar && droppedBar.classList.contains('bar')) {
            const originalHeight = droppedBar.style.height;
            const originalValue = droppedBar.innerText;
            droppedBar.style.height = draggedHeight;
            droppedBar.innerText = draggedValue;
            e.target.style.height = originalHeight;
            e.target.innerText = originalValue;
            array = Array.from(document.querySelectorAll('.bar')).map(bar => parseInt(bar.innerText));
        }

        document.querySelectorAll('.bar').forEach(bar => bar.classList.remove('swapping'));
    });

    async function bubbleSort() {
        iteration = 0;
        updateCounter();
        for (let i = 0; i < array.length - 1; i++) {
            for (let j = 0; j < array.length - 1 - i; j++) {
                if (array[j] > array[j + 1]) {
                    swap(j, j + 1);
                    await sleep(500);
                    iteration++;
                    updateCounter();
                }
            }
        }
        clearInterval(intervalId);
    }

    function swap(index1, index2) {
        const bars = document.querySelectorAll('.bar');
        [array[index1], array[index2]] = [array[index2], array[index1]];
        bars[index1].style.height = array[index1] * 10 + 'px';
        bars[index2].style.height = array[index2] * 10 + 'px';
        bars[index1].classList.add('swapping');
        bars[index2].classList.add('swapping');
        setTimeout(() => {
            bars[index1].classList.remove('swapping');
            bars[index2].classList.remove('swapping');
        }, 500);
    }

    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    function updateCounter() {
        iterationCount.innerText = `Iterations: ${iteration}`;
    }

    // Button Event Listeners
    sortBtn.addEventListener('click', () => {
        if (!isPaused) {
            bubbleSort();
        }
    });

    pauseBtn.addEventListener('click', () => {
        isPaused = !isPaused;
        pauseBtn.innerText = isPaused ? 'Resume' : 'Pause';
        isPaused ? clearInterval(intervalId) : bubbleSort();
    });

    stepBtn.addEventListener('click', () => {
        if (!isPaused) {
            step(bubbleSort);
        }
    });

    initializeArray();
</script>



  <script id="fsm" type="application/json">
    {
  "topic": "bubble sort",
  "description": "Finite state machine for the Bubble Sort interactive visualization application.",
  "states": [
    {
      "name": "idle",
      "onEnter": "initializeArray",
      "on": {
        "DRAG_START": "dragging",
        "SORT_BUTTON_CLICK": "sorting",
        "PAUSE_BUTTON_CLICK": "paused",
        "STEP_BUTTON_CLICK": "stepping"
      }
    },
    {
      "name": "dragging",
      "onExit": "removeSwappingClass",
      "on": {
        "DROP": "idle"
      }
    },
    {
      "name": "sorting",
      "onEnter": "bubbleSort",
      "onExit": "clearInterval",
      "on": {
        "PAUSE_BUTTON_CLICK": "paused",
        "SORT_COMPLETED": "done"
      }
    },
    {
      "name": "paused",
      "on": {
        "PAUSE_BUTTON_CLICK": "sorting",
        "STEP_BUTTON_CLICK": "stepping"
      }
    },
    {
      "name": "stepping",
      "on": {
        "PAUSE_BUTTON_CLICK": "paused",
        "SORT_COMPLETED": "done"
      }
    },
    {
      "name": "done",
      "on": {
        "SORT_BUTTON_CLICK": "sorting",
        "DRAG_START": "dragging"
      }
    }
  ],
  "events": [
    "DRAG_START",
    "DROP",
    "SORT_BUTTON_CLICK",
    "PAUSE_BUTTON_CLICK",
    "STEP_BUTTON_CLICK",
    "SORT_COMPLETED"
  ],
  "notes": "The FSM captures the states of the bubble sort visualization, including user interactions for sorting, pausing, stepping through the sort, and dragging elements."
}
  </script>
</body>
</html>