<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Insertion Sort Visualizer</title>
  <style>
    :root{
      --bg:#0f1724;
      --panel:#0b1220;
      --accent:#60a5fa;
      --muted:#94a3b8;
      --good:#34d399;
      --bad:#fb7185;
      --glass: rgba(255,255,255,0.03);
      --font-sans: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font-sans);
      background:linear-gradient(180deg,#041028 0%, #07102a 60%);
      color:#e6eef8;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    .app{
      max-width:1100px;
      margin:24px auto;
      padding:20px;
      border-radius:12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));
      box-shadow: 0 6px 24px rgba(2,6,23,0.6);
    }
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:12px;
    }
    header h1{
      margin:0;
      font-size:20px;
      letter-spacing:0.2px;
    }
    .controls{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    .panel{
      background:var(--panel);
      padding:12px;
      border-radius:10px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.02);
    }
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    input[type="text"], select{
      background:var(--glass);
      border:1px solid rgba(255,255,255,0.03);
      color:inherit;
      padding:8px 10px;
      border-radius:8px;
      min-width:220px;
    }
    button{
      background:linear-gradient(180deg,var(--accent),#3b82f6);
      border:0;
      color:white;
      padding:8px 12px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
      box-shadow: 0 6px 14px rgba(59,130,246,0.18);
    }
    button.secondary{
      background:transparent;
      border:1px solid rgba(255,255,255,0.06);
      color:var(--muted);
      box-shadow:none;
      font-weight:600;
      padding:8px 10px;
    }
    .row{display:flex;gap:12px;align-items:center}
    .viz{
      display:flex;
      gap:12px;
      margin-top:14px;
      align-items:flex-end;
      height:320px;
      padding:18px;
      background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.02));
      border-radius:12px;
      overflow:hidden;
    }
    .bar{
      flex:1;
      margin:0 4px;
      display:flex;
      align-items:flex-end;
      justify-content:center;
      transition: all 250ms ease;
      position:relative;
      border-radius:6px 6px 4px 4px;
      min-width:14px;
    }
    .bar .val{
      font-size:12px;
      padding:4px 6px;
      color:rgba(0,0,0,0.7);
      background:white;
      border-radius:6px;
      transform:translateY(6px);
      position:relative;
      font-weight:700;
    }
    .status-default{ background: linear-gradient(180deg,#1f2937,#111827); opacity:0.9; }
    .status-sorted{ background: linear-gradient(180deg,var(--good),#10b981); }
    .status-key{ background: linear-gradient(180deg,#facc15,#eab308); transform:translateY(-6px); box-shadow:0 8px 20px rgba(234,179,8,0.12); }
    .status-compare{ background: linear-gradient(180deg,#fb7185,#ef4444); box-shadow:0 8px 24px rgba(239,68,68,0.12); }
    .status-shift{ background: linear-gradient(180deg,#60a5fa,#3b82f6); box-shadow:0 8px 24px rgba(59,130,246,0.12); }
    .controls-bottom{
      display:flex;
      gap:12px;
      align-items:center;
      margin-top:12px;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .play-controls{display:flex;gap:8px;align-items:center}
    .small{font-size:13px;color:var(--muted)}
    input[type="range"]{width:160px}
    .sidebar{
      margin-top:14px;
      display:grid;
      grid-template-columns:1fr 320px;
      gap:12px;
    }
    .info{
      padding:12px;
      border-radius:10px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));
    }
    pre{background:transparent;margin:0;padding:8px;border-radius:8px;overflow:auto}
    .pseudocode{
      font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Helvetica Neue", monospace;
      font-size:13px;
      line-height:1.5;
      color:#cbd5e1;
    }
    .pseudocode .line{padding:4px 8px;border-radius:6px;margin-bottom:4px}
    .pc-active{ background:rgba(96,165,250,0.12); border-left:4px solid var(--accent); color:#e6f0ff;}
    .legend{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .legend .item{display:flex;gap:6px;align-items:center;font-size:13px;color:var(--muted)}
    .swatch{width:14px;height:14px;border-radius:4px}
    footer{margin-top:18px;color:var(--muted);font-size:13px}
    @media(max-width:880px){
      .sidebar{grid-template-columns:1fr}
      .viz{height:260px}
    }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Insertion Sort Visualizer">
    <header>
      <h1>Insertion Sort — Visual Demonstration</h1>
      <div class="controls">
        <div class="panel" style="display:flex;gap:8px;align-items:center">
          <div style="min-width:220px">
            <label for="arrayInput">Array (comma-separated)</label>
            <input id="arrayInput" type="text" value="8,5,2,9,5,6,3,7" aria-label="Array values"/>
          </div>
          <div style="min-width:120px">
            <label for="order">Order</label>
            <select id="order" aria-label="Sort order">
              <option value="asc">Ascending</option>
              <option value="desc">Descending</option>
            </select>
          </div>
          <div style="display:flex;flex-direction:column;gap:6px">
            <label style="visibility:hidden">Actions</label>
            <div style="display:flex;gap:6px">
              <button id="btnLoad">Load</button>
              <button id="btnRandom" class="secondary">Random</button>
              <button id="btnReset" class="secondary">Reset</button>
            </div>
          </div>
        </div>
      </div>
    </header>

    <section class="panel" aria-hidden="false" style="padding:14px">
      <div class="viz" id="viz" role="graphics-document" aria-label="Array visualization">
        <!-- Bars injected here -->
      </div>

      <div class="controls-bottom">
        <div class="play-controls">
          <button id="btnPrev" class="secondary">⟨ Prev</button>
          <button id="btnPlay">Play</button>
          <button id="btnNext" class="secondary">Next ⟩</button>
          <div style="display:flex;flex-direction:column;margin-left:12px">
            <label class="small">Speed</label>
            <input id="speed" type="range" min="50" max="1200" step="10" value="500" />
          </div>
          <div style="margin-left:12px" class="small">
            Step: <span id="stepCounter">0</span>/<span id="stepTotal">0</span>
          </div>
        </div>

        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <div style="display:flex;flex-direction:column">
            <label class="small">Auto-play</label>
            <select id="autoMode" aria-label="Auto play mode">
              <option value="pause">Pause at each important step</option>
              <option value="continuous">Continuous</option>
            </select>
          </div>
          <div style="display:flex;flex-direction:column">
            <label class="small">Highlight</label>
            <select id="highlightMode" aria-label="Highlight mode">
              <option value="compact">Compact (key, compare, shift)</option>
              <option value="verbose">Verbose (show more intermediate states)</option>
            </select>
          </div>
        </div>
      </div>

      <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px">
        <div class="legend">
          <div class="item"><span class="swatch status-key"></span> Key</div>
          <div class="item"><span class="swatch status-compare"></span> Comparing</div>
          <div class="item"><span class="swatch status-shift"></span> Shifting</div>
          <div class="item"><span class="swatch status-sorted"></span> Sorted prefix</div>
        </div>
        <div class="small">Tip: Use "Play" to animate. Modify the array and click Load.</div>
      </div>
    </section>

    <div class="sidebar">
      <div class="info panel" aria-live="polite">
        <h3 style="margin-top:0;margin-bottom:8px">What is Insertion Sort?</h3>
        <p style="margin:0 0 8px;color:var(--muted)">
          Insertion Sort builds the final sorted array one item at a time. It takes each element (the key),
          compares it with elements in the sorted portion (to its left), shifts larger elements rightward,
          and inserts the key into the correct position.
        </p>

        <div style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:8px">
          <div style="min-width:140px">
            <label class="small">Time Complexity</label>
            <div style="font-weight:700">Best: O(n) — already sorted</div>
            <div style="font-weight:700">Average / Worst: O(n²)</div>
          </div>
          <div style="min-width:140px">
            <label class="small">Space Complexity</label>
            <div style="font-weight:700">O(1) — in-place</div>
          </div>
        </div>

        <h4 style="margin-bottom:6px">Pseudocode</h4>
        <div class="pseudocode" id="pseudocode">
          <div class="line" data-line="1">1. for i = 1 to A.length - 1</div>
          <div class="line" data-line="2">2.   key = A[i]</div>
          <div class="line" data-line="3">3.   j = i - 1</div>
          <div class="line" data-line="4">4.   while j >= 0 and A[j] > key</div>
          <div class="line" data-line="5">5.     A[j + 1] = A[j]</div>
          <div class="line" data-line="6">6.     j = j - 1</div>
          <div class="line" data-line="7">7.   A[j + 1] = key</div>
        </div>
      </div>

      <div class="panel info">
        <h4 style="margin:0 0 8px">Current Step</h4>
        <div id="stepInfo" style="color:var(--muted);line-height:1.5">No steps generated yet. Load an array to begin.</div>
        <hr style="opacity:0.06;margin:12px 0">
        <h4 style="margin:0 0 8px">Array Snapshot</h4>
        <pre id="arraySnapshot" style="color:#dbeafe">[]</pre>
      </div>
    </div>

    <footer style="text-align:center">
      Built to demonstrate insertion sort. Try different arrays, sizes and ordering.
    </footer>
  </div>

  <script>
    // Insertion Sort Visualizer
    (function(){
      // DOM refs
      const viz = document.getElementById('viz');
      const arrayInput = document.getElementById('arrayInput');
      const btnLoad = document.getElementById('btnLoad');
      const btnRandom = document.getElementById('btnRandom');
      const btnReset = document.getElementById('btnReset');
      const orderSel = document.getElementById('order');
      const btnPlay = document.getElementById('btnPlay');
      const btnNext = document.getElementById('btnNext');
      const btnPrev = document.getElementById('btnPrev');
      const speed = document.getElementById('speed');
      const stepCounter = document.getElementById('stepCounter');
      const stepTotal = document.getElementById('stepTotal');
      const stepInfo = document.getElementById('stepInfo');
      const arraySnapshot = document.getElementById('arraySnapshot');
      const pseudocode = document.getElementById('pseudocode');
      const autoMode = document.getElementById('autoMode');
      const highlightMode = document.getElementById('highlightMode');

      // State
      let baseArray = [];
      let steps = []; // each step: {arr:[], statuses:[], pcLine:int, desc:string}
      let current = 0;
      let timer = null;
      let playing = false;

      // Helpers
      function parseArrayInput(text){
        // Accept numbers (ints/floats) separated by commas or spaces
        const parts = text.split(/[\s,]+/).filter(Boolean);
        const nums = parts.map(p => {
          const n = Number(p);
          return isNaN(n) ? 0 : n;
        });
        return nums;
      }

      function setArrayInputFromArray(a){
        arrayInput.value = a.join(', ');
      }

      function randomArray(n=10, min=1, max=100){
        const arr=[];
        for(let i=0;i<n;i++){
          arr.push(Math.floor(Math.random()*(max-min+1))+min);
        }
        return arr;
      }

      function cloneState(arr, statuses, pcLine, desc){
        return {
          arr: arr.slice(),
          statuses: statuses.slice(),
          pcLine: pcLine || null,
          desc: desc || ''
        };
      }

      function clearTimer(){
        if(timer){ clearInterval(timer); timer = null; }
        playing = false;
        btnPlay.textContent = 'Play';
      }

      function updateStepUI(){
        stepCounter.textContent = Math.max(0, Math.min(steps.length>0?current:0, steps.length));
        stepTotal.textContent = steps.length>0?steps.length-1:0;
        if(steps.length>0){
          const s = steps[current];
          renderArray(s.arr, s.statuses);
          highlightPseudocode(s.pcLine);
          stepInfo.textContent = s.desc || '';
          arraySnapshot.textContent = JSON.stringify(s.arr);
        } else {
          viz.innerHTML = '';
          highlightPseudocode(null);
          stepInfo.textContent = 'No steps generated yet. Load an array to begin.';
          arraySnapshot.textContent = '[]';
        }
      }

      function renderArray(arr, statuses=[]){
        viz.innerHTML = '';
        if(!arr || arr.length===0) return;
        const max = Math.max(...arr.map(v => Math.abs(v))) || 1;
        const n = arr.length;
        const barWidth = Math.max(8, Math.floor((viz.clientWidth - (n-1)*8) / n));
        for(let i=0;i<arr.length;i++){
          const val = arr[i];
          const h = Math.max(6, Math.round((Math.abs(val)/max) * 260));
          const div = document.createElement('div');
          div.className = 'bar status-default';
          const status = statuses[i] || 'default';
          if(status==='key') div.className = 'bar status-key';
          else if(status==='compare') div.className = 'bar status-compare';
          else if(status==='shift') div.className = 'bar status-shift';
          else if(status==='sorted') div.className = 'bar status-sorted';
          div.style.height = (h+18)+'px';
          div.style.minWidth = barWidth + 'px';
          div.style.maxWidth = barWidth + 'px';
          const span = document.createElement('div');
          span.className = 'val';
          span.textContent = String(val);
          div.appendChild(span);
          viz.appendChild(div);
        }
      }

      function highlightPseudocode(line){
        const lines = pseudocode.querySelectorAll('.line');
        lines.forEach(l => {
          const num = Number(l.getAttribute('data-line'));
          if(line && num===line) l.classList.add('pc-active');
          else l.classList.remove('pc-active');
        });
      }

      // Generate steps for insertion sort
      function generateSteps(arr, ascending=true, mode='compact'){
        steps = [];
        const n = arr.length;
        const A = arr.slice();
        // initial state: mark first element as sorted
        let statuses = Array(n).fill('default');
        if(n>0) statuses[0]='sorted';
        steps.push(cloneState(A,statuses,1,'Start: first element considered sorted'));

        const cmp = (a,b) => ascending ? (a > b) : (a < b);

        for(let i=1;i<n;i++){
          let key = A[i];
          let j = i-1;

          // select key
          statuses = Array(n).fill('default');
          for(let k=0;k<i;k++) statuses[k] = 'sorted';
          statuses[i] = 'key';
          steps.push(cloneState(A,statuses,2,`Select key A[${i}] = ${key}`));

          statuses[i]='key'; for(let k=0;k<i;k++) statuses[k]='sorted';
          steps.push(cloneState(A,statuses,3,`Set j = ${j}`));

          // while loop
          while(j>=0 && cmp(A[j], key)){
            // compare A[j] with key
            statuses = Array(n).fill('default');
            for(let k=0;k<i;k++) statuses[k] = 'sorted';
            statuses[j] = 'compare';
            statuses[i] = 'key';
            steps.push(cloneState(A,statuses,4,`Compare A[${j}] = ${A[j]} with key = ${key} → needs shift`));

            // shift A[j] to A[j+1]
            A[j+1] = A[j];
            statuses = Array(n).fill('default');
            for(let k=0;k<i;k++) statuses[k] = 'sorted';
            statuses[j+1] = 'shift';
            statuses[i] = 'key';
            steps.push(cloneState(A,statuses,5,`Shift A[${j}] to position ${j+1}`));

            j = j - 1;
            // after decrement j
            statuses = Array(n).fill('default');
            for(let k=0;k<i;k++) statuses[k] = 'sorted';
            if(j>=0) statuses[j] = 'compare';
            statuses[i] = 'key';
            steps.push(cloneState(A,statuses,6,`Decrement j to ${j}`));
          }

          // insert key
          A[j+1] = key;
          statuses = Array(n).fill('default');
          for(let k=0;k<=i;k++) statuses[k] = 'sorted';
          steps.push(cloneState(A,statuses,7,`Insert key = ${key} at position ${j+1}`));

          // compact mode: optionally remove some verbose intermediate states
          if(mode==='compact'){
            // Keep the selection, one compare that leads to shift, and insertion & sorted state.
            // We'll post-process to remove some repeated patterns for cleanliness.
            // (But simplest approach: keep as-is; it's okay.)
          }
        }

        // final state: all sorted
        const finalStatuses = Array(n).fill('sorted');
        steps.push(cloneState(A, finalStatuses, null, 'Array fully sorted'));
        // ensure indices are within bounds
        if(steps.length===0){
          steps.push(cloneState(A,[],null,'No steps'));
        }
        current = 0;
        return steps;
      }

      // Controls
      btnLoad.addEventListener('click', ()=>{
        const parsed = parseArrayInput(arrayInput.value.trim());
        baseArray = parsed.slice();
        setArrayInputFromArray(baseArray);
        steps = generateSteps(baseArray, orderSel.value==='asc', highlightMode.value);
        stepTotal.textContent = steps.length-1;
        current = 0;
        updateStepUI();
        clearTimer();
      });

      btnRandom.addEventListener('click', ()=>{
        const n = Math.max(3, Math.min(30, Math.floor(Math.random()*12)+5));
        const arr = randomArray(n, 1, 99);
        baseArray = arr;
        setArrayInputFromArray(arr);
        steps = generateSteps(baseArray, orderSel.value==='asc', highlightMode.value);
        current=0;
        updateStepUI();
        clearTimer();
      });

      btnReset.addEventListener('click', ()=>{
        if(!baseArray || baseArray.length===0) return;
        steps = generateSteps(baseArray, orderSel.value==='asc', highlightMode.value);
        current = 0;
        updateStepUI();
        clearTimer();
      });

      btnNext.addEventListener('click', ()=>{
        if(steps.length===0) return;
        if(current < steps.length-1){
          current++;
          updateStepUI();
        } else {
          clearTimer();
        }
      });

      btnPrev.addEventListener('click', ()=>{
        if(steps.length===0) return;
        if(current > 0){
          current--;
          updateStepUI();
        }
      });

      btnPlay.addEventListener('click', ()=>{
        if(playing){
          clearTimer();
        } else {
          if(steps.length===0) return;
          playing = true;
          btnPlay.textContent = 'Pause';
          const delay = Number(speed.value) || 500;
          const mode = autoMode.value;
          // If continuous, play through, otherwise pause at each "pcLine" change for inspection
          timer = setInterval(()=>{
            if(current < steps.length-1){
              current++;
              updateStepUI();
              if(mode==='pause'){
                // pause at important lines: when pcLine is 4 (compare) or 5 (shift) or 7 (insert) or null final
                const pc = steps[current].pcLine;
                if(pc && (pc===4 || pc===5 || pc===7 || pc===2)){
                  clearTimer();
                }
              }
            } else {
              clearTimer();
            }
          }, delay);
        }
      });

      speed.addEventListener('input', ()=>{
        if(playing){
          clearTimer();
          btnPlay.textContent = 'Play';
          playing = false;
        }
      });

      // keyboard shortcuts
      document.addEventListener('keydown', (e)=>{
        if(e.key === ' '){
          e.preventDefault();
          btnPlay.click();
        } else if(e.key === 'ArrowRight'){
          btnNext.click();
        } else if(e.key === 'ArrowLeft'){
          btnPrev.click();
        }
      });

      orderSel.addEventListener('change', ()=>{
        // regenerate with new order
        if(!baseArray || baseArray.length===0) return;
        steps = generateSteps(baseArray, orderSel.value==='asc', highlightMode.value);
        current=0;
        updateStepUI();
        clearTimer();
      });

      highlightMode.addEventListener('change', ()=>{
        if(!baseArray || baseArray.length===0) return;
        steps = generateSteps(baseArray, orderSel.value==='asc', highlightMode.value);
        current=0;
        updateStepUI();
        clearTimer();
      });

      // initialize with default array
      (function init(){
        baseArray = parseArrayInput(arrayInput.value);
        steps = generateSteps(baseArray, orderSel.value==='asc', highlightMode.value);
        current = 0;
        updateStepUI();
      })();

      // Make viz responsive: rerender on resize
      window.addEventListener('resize', ()=> updateStepUI());
    })();
  </script>
</body>
</html>