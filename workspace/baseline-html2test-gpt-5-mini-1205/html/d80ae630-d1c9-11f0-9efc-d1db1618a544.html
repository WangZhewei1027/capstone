<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Quick Sort Visualizer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root {
      --bg: #0f1724;
      --panel: #0b1220;
      --accent: #3b82f6;
      --muted: #94a3b8;
      --good: #10b981;
      --bad: #ef4444;
      --yellow: #f59e0b;
    }
    html,body { height:100%; margin:0; font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background: linear-gradient(180deg,#071022 0%,#07132a 100%); color:#e6eef8; }
    .app { max-width:1100px; margin:20px auto; padding:18px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:12px; box-shadow:0 6px 30px rgba(2,6,23,0.6); }
    header { display:flex; gap:12px; align-items:center; margin-bottom:14px; }
    header h1 { font-size:18px; margin:0; color:#fff; letter-spacing:0.2px; }
    .controls { display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin-bottom:12px; }
    .control { background:rgba(255,255,255,0.02); padding:10px; border-radius:8px; display:flex; gap:8px; align-items:center; font-size:14px; color:var(--muted); }
    .control label { font-size:12px; color:var(--muted); margin-right:6px; min-width:80px; }
    input[type=range] { width:140px; }
    select, input[type=number], input[type=text] { background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--muted); padding:6px 8px; border-radius:6px; min-width:120px; }
    button { background:var(--panel); border:1px solid rgba(255,255,255,0.04); color:#dff1ff; padding:8px 12px; border-radius:8px; cursor:pointer; }
    button.primary { background:linear-gradient(90deg,var(--accent),#60a5fa); border:none; color:#021033; font-weight:600; }
    button.danger { background:linear-gradient(90deg,#ef4444,#f97316); color:#061116; border:none; }
    .layout { display:grid; grid-template-columns: 1fr 360px; gap:12px; }
    .visual { background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:12px; border-radius:10px; min-height:360px; }
    .bars { position:relative; height:320px; display:flex; align-items:flex-end; gap:4px; padding:8px; border-radius:6px; background:rgba(0,0,0,0.02); }
    .bar { flex:1 1 auto; display:flex; align-items:flex-end; justify-content:center; border-radius:4px 4px 2px 2px; color:rgba(0,0,0,0.6); font-weight:700; font-size:11px; }
    .bar .val { transform:translateY(-6px); color:#041020; font-weight:700; font-size:11px; }
    .panel { padding:12px; background:rgba(255,255,255,0.01); border-radius:10px; color:var(--muted); }
    .stats { display:flex; gap:12px; margin-top:10px; }
    .stat { background:rgba(255,255,255,0.02); padding:8px 10px; border-radius:8px; font-size:13px; color:#dff1ff; display:flex; flex-direction:column; }
    .stat .label { font-size:11px; color:var(--muted); }
    .pseudocode { background:rgba(255,255,255,0.01); padding:8px; border-radius:6px; font-family:monospace; font-size:13px; color:var(--muted); max-height:220px; overflow:auto; }
    .line { padding:4px 6px; border-radius:4px; white-space:pre-wrap; }
    .line.current { background:linear-gradient(90deg, rgba(99,102,241,0.15), rgba(59,130,246,0.08)); color:#e6f1ff; }
    .legend { display:flex; gap:8px; align-items:center; margin-top:8px; flex-wrap:wrap; }
    .chip { display:flex; gap:8px; align-items:center; background:rgba(255,255,255,0.02); padding:6px 8px; border-radius:20px; font-size:12px; color:var(--muted); }
    .dot { width:14px; height:14px; border-radius:4px; display:inline-block; }
    footer { margin-top:12px; font-size:12px; color:var(--muted); display:flex; justify-content:space-between; align-items:center; }
    @media (max-width:980px) { .layout { grid-template-columns: 1fr; } .visual { order:2; } .panel { order:1; } }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Quick Sort Visualizer</h1>
      <div style="margin-left:auto;color:var(--muted);font-size:13px;">Interactive demonstration with step playback, pivot strategies, and stats</div>
    </header>

    <div class="controls">
      <div class="control">
        <label>Array size</label>
        <input id="size" type="range" min="5" max="80" value="30">
        <span id="sizeVal" style="color:var(--muted);font-weight:600;margin-left:8px">30</span>
      </div>

      <div class="control">
        <label>Pivot</label>
        <select id="pivot">
          <option value="last">Last element</option>
          <option value="first">First element</option>
          <option value="random">Random</option>
          <option value="median">Median-of-three</option>
        </select>
      </div>

      <div class="control">
        <label>Order</label>
        <select id="order">
          <option value="asc">Ascending</option>
          <option value="desc">Descending</option>
        </select>
      </div>

      <div class="control">
        <label>Speed</label>
        <input id="speed" type="range" min="10" max="1000" value="120">
        <span id="speedVal" style="color:var(--muted);font-weight:600;margin-left:8px">120ms</span>
      </div>

      <div class="control">
        <label>Custom</label>
        <input id="custom" type="text" placeholder="e.g. 5,2,9,1,6">
        <button id="load">Load</button>
      </div>

      <div class="control" style="margin-left:auto">
        <button id="random" class="primary">Randomize</button>
        <button id="prepare">Prepare</button>
        <button id="start" class="primary">Start</button>
        <button id="pause">Pause</button>
        <button id="stepBack">◀</button>
        <button id="stepFwd">▶</button>
        <button id="reset" class="danger">Reset</button>
      </div>
    </div>

    <div class="layout">
      <div class="visual panel">
        <div class="bars" id="bars" aria-hidden="true"></div>

        <div class="stats" id="stats">
          <div class="stat">
            <div class="label">Comparisons</div>
            <div id="compCount" style="font-size:16px;margin-top:6px">0</div>
          </div>
          <div class="stat">
            <div class="label">Swaps</div>
            <div id="swapCount" style="font-size:16px;margin-top:6px">0</div>
          </div>
          <div class="stat">
            <div class="label">Steps</div>
            <div id="stepCount" style="font-size:16px;margin-top:6px">0 / 0</div>
          </div>
        </div>

        <div class="legend">
          <div class="chip"><span class="dot" style="background:linear-gradient(180deg,#60a5fa,#3b82f6)"></span> Unsorted</div>
          <div class="chip"><span class="dot" style="background:linear-gradient(180deg,#fde68a,#f59e0b)"></span> Pivot</div>
          <div class="chip"><span class="dot" style="background:linear-gradient(180deg,#34d399,#10b981)"></span> In place / Sorted</div>
          <div class="chip"><span class="dot" style="background:linear-gradient(180deg,#f87171,#ef4444)"></span> Current comparison / swap</div>
        </div>
      </div>

      <div class="panel">
        <div style="display:flex;gap:10px;align-items:center; justify-content:space-between;">
          <strong style="color:#fff">Algorithm pseudocode</strong>
          <div style="color:var(--muted);font-size:13px">Line highlighted shows current step</div>
        </div>
        <div class="pseudocode" id="pseudocode"></div>

        <div style="margin-top:12px;">
          <strong style="color:#fff">Recursion stack</strong>
          <div id="stack" style="margin-top:8px;color:var(--muted);font-size:13px;min-height:56px; background:rgba(255,255,255,0.01);padding:8px;border-radius:6px"></div>
        </div>

      </div>
    </div>

    <footer>
      <div>Quick Sort visualization — Pivot strategies: first / last / random / median-of-three. Uses Lomuto partitioning for clarity.</div>
      <div style="color:var(--muted)">Made for learning • Step through to explore</div>
    </footer>
  </div>

<script>
(() => {
  // DOM
  const barsEl = document.getElementById('bars');
  const sizeEl = document.getElementById('size');
  const sizeVal = document.getElementById('sizeVal');
  const speedEl = document.getElementById('speed');
  const speedVal = document.getElementById('speedVal');
  const randomBtn = document.getElementById('random');
  const prepareBtn = document.getElementById('prepare');
  const startBtn = document.getElementById('start');
  const pauseBtn = document.getElementById('pause');
  const resetBtn = document.getElementById('reset');
  const loadBtn = document.getElementById('load');
  const customInput = document.getElementById('custom');
  const pivotSel = document.getElementById('pivot');
  const orderSel = document.getElementById('order');
  const compCountEl = document.getElementById('compCount');
  const swapCountEl = document.getElementById('swapCount');
  const stepCountEl = document.getElementById('stepCount');
  const pseudoEl = document.getElementById('pseudocode');
  const stackEl = document.getElementById('stack');
  const stepFwd = document.getElementById('stepFwd');
  const stepBack = document.getElementById('stepBack');
  const prepareRequired = { val: false };

  // State
  let array = [];
  let initialArray = [];
  let snapshots = []; // list of states
  let playing = false;
  let currentIndex = 0;
  let timer = null;
  let comparisons = 0;
  let swaps = 0;

  // Pseudocode (Lomuto)
  const pseudo = [
`quickSort(A, lo, hi)
  if lo < hi
    p = partition(A, lo, hi)
    quickSort(A, lo, p-1)
    quickSort(A, p+1, hi)`,

`partition(A, lo, hi)
  pivot = A[hi]
  i = lo - 1
  for j = lo to hi - 1
    if A[j] <= pivot
      i = i + 1
      swap A[i] and A[j]
  swap A[i+1] and A[hi]
  return i+1`
  ];

  // Render pseudocode
  function renderPseudocode(highlightLine = null) {
    pseudoEl.innerHTML = '';
    pseudo.forEach((block, bi) => {
      const lines = block.split('\n');
      lines.forEach((ln, idx) => {
        const lineNo = `${bi+1}.${idx+1}`;
        const div = document.createElement('div');
        div.className = 'line' + ((highlightLine === lineNo) ? ' current' : '');
        div.textContent = ln;
        pseudoEl.appendChild(div);
      });
    });
  }

  // Utilities
  function randInt(min, max) { return Math.floor(Math.random()*(max-min+1))+min; }

  function generateRandom(n) {
    const arr = [];
    for (let i=0;i<n;i++) arr.push(randInt(5, 400));
    return arr;
  }

  function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

  // Visualization drawing
  function drawArray(state = null) {
    // state: {arr, highlights, comps, swaps}
    const arr = state ? state.arr : array;
    const highlights = state ? state.highlights || {} : {};
    const max = Math.max(...array.concat([1]));
    barsEl.innerHTML = '';
    const showIndices = arr.length <= 45;
    arr.forEach((val, idx) => {
      const bar = document.createElement('div');
      bar.className = 'bar';
      const height = Math.round((val / max) * 100);
      bar.style.height = (height + 8) + '%';
      // color logic
      let bg = 'linear-gradient(180deg,#60a5fa,#3b82f6)'; // unsorted default
      if (highlights.sorted && highlights.sorted.includes(idx)) bg = 'linear-gradient(180deg,#34d399,#10b981)';
      if (highlights.pivot === idx) bg = 'linear-gradient(180deg,#fde68a,#f59e0b)';
      if (highlights.current && highlights.current.includes(idx)) bg = 'linear-gradient(180deg,#f87171,#ef4444)';
      if (highlights.left === idx || highlights.right === idx) bg = 'linear-gradient(180deg,#c7b3ff,#8b5cf6)';
      bar.style.background = bg;
      bar.title = String(val);
      // show value inside
      const v = document.createElement('div');
      v.className = 'val';
      v.textContent = val;
      if (showIndices) {
        bar.appendChild(v);
      }
      barsEl.appendChild(bar);
    });
  }

  // Snapshots: capture important state for playback
  function pushSnapshot(arr, highlights, action, note, stackSnapshot) {
    snapshots.push({
      arr: arr.slice(),
      highlights: JSON.parse(JSON.stringify(highlights || {})),
      action: action || '',
      note: note || '',
      comps: comparisons,
      swaps: swaps,
      stack: JSON.parse(JSON.stringify(stackSnapshot || []))
    });
  }

  // Instrumented QuickSort using Lomuto partition; records snapshots (synchronous)
  function buildSnapshots(rawArr, settings) {
    snapshots = [];
    comparisons = 0;
    swaps = 0;
    const arr = rawArr.slice();
    const n = arr.length;
    const stack = [];

    function recordState(action, highlights, note) {
      pushSnapshot(arr, highlights, action, note, stack);
    }

    function choosePivotIndex(lo, hi) {
      const strat = settings.pivot;
      if (strat === 'first') return lo;
      if (strat === 'last') return hi;
      if (strat === 'random') return randInt(lo, hi);
      if (strat === 'median') {
        const mid = Math.floor((lo+hi)/2);
        const trio = [{i:lo,v:arr[lo]},{i:mid,v:arr[mid]},{i:hi,v:arr[hi]}];
        trio.sort((a,b)=>a.v-b.v);
        return trio[1].i;
      }
      return hi;
    }

    function swap(i,j) {
      const tmp = arr[i]; arr[i] = arr[j]; arr[j] = tmp;
      swaps++;
      recordState('swap', { current: [i,j] }, `swap indices ${i} & ${j}`);
    }

    function partition(lo, hi) {
      // choose pivot according to strategy then move pivot to end (hi) for Lomuto
      const pIndex = choosePivotIndex(lo, hi);
      recordState('choosePivot', { pivot: pIndex }, `choose pivot index ${pIndex}`);
      if (pIndex !== hi) {
        swap(pIndex, hi); // move pivot to end
      }
      const pivotVal = arr[hi];
      recordState('pivotPlaced', { pivot: hi }, `pivot value ${pivotVal} at index ${hi}`);
      let i = lo - 1;
      for (let j = lo; j <= hi - 1; j++) {
        comparisons++;
        recordState('compare', { current: [j], pivot: hi, left: i }, `compare A[${j}] (${arr[j]}) <= pivot (${pivotVal})`);
        const cmp = settings.order === 'asc' ? (arr[j] <= pivotVal) : (arr[j] >= pivotVal);
        if (cmp) {
          i++;
          recordState('move', { left: i, current: [j], pivot: hi }, `move i to ${i}`);
          if (i !== j) swap(i, j);
        }
      }
      // place pivot to correct position
      if (i+1 !== hi) swap(i+1, hi);
      recordState('partitionDone', { pivot: i+1, sorted: Array.from({length:1}, (_,k)=>i+1) }, `partition returns ${i+1}`);
      return i+1;
    }

    function quicksort(lo, hi) {
      stack.push([lo,hi]);
      recordState('stackPush', { stack: stack.slice(), left: lo, right: hi }, `enter quickSort(${lo},${hi})`);
      if (lo < hi) {
        const p = partition(lo, hi);
        // mark pivot as in-place
        recordState('pivotInPlace', { pivot: p, sorted: Array.from({length:1}, (_,k)=>p) }, `pivot at ${p} placed`);
        // recurse left
        quicksort(lo, p-1);
        // recurse right
        quicksort(p+1, hi);
      }
      recordState('stackPop', { stack: stack.slice(), left: lo, right: hi }, `exit quickSort(${lo},${hi})`);
      stack.pop();
    }

    // initial snapshot
    pushSnapshot(arr, {}, 'init', 'initial array', stack);
    quicksort(0, n-1);
    // final: mark all sorted
    recordState('finished', { sorted: Array.from({length:n}, (_,i)=>i) }, 'array sorted');
    return snapshots;
  }

  // Playback controls
  function setIndex(i) {
    i = clamp(i, 0, snapshots.length - 1);
    currentIndex = i;
    const s = snapshots[currentIndex];
    drawArray(s);
    compCountEl.textContent = s.comps;
    swapCountEl.textContent = s.swaps;
    stepCountEl.textContent = `${currentIndex+1} / ${snapshots.length}`;
    renderPseudocodeForSnapshot(s);
    renderStack(s.stack);
  }

  function renderStack(stack) {
    if (!stack || stack.length===0) {
      stackEl.textContent = '(empty)';
      return;
    }
    stackEl.innerHTML = '';
    stack.forEach(([lo,hi], idx) => {
      const d = document.createElement('div');
      d.style.padding = '6px 8px';
      d.style.borderRadius = '6px';
      d.style.background = 'rgba(255,255,255,0.01)';
      d.style.marginBottom = '6px';
      d.textContent = `quickSort(${lo}, ${hi})`;
      stackEl.appendChild(d);
    });
  }

  function renderPseudocodeForSnapshot(s) {
    // Map actions to pseudo line numbers (bi.idx)
    // We'll highlight:
    // choosePivot / pivotPlaced -> partition pivot lines (block 2, line 1-2)
    // compare -> partition for-loop line (block2, 3)
    // swap -> partition swap lines (block2, 4/5)
    // partitionDone / pivotInPlace -> return i+1 line (block2, last)
    // stackPush/pop -> quickSort first block lines
    let line = null;
    switch(s.action) {
      case 'init': line = '1.1'; break;
      case 'stackPush': line = '1.1'; break;
      case 'stackPop': line = '1.1'; break;
      case 'choosePivot': line = '2.1'; break;
      case 'pivotPlaced': line = '2.1'; break;
      case 'compare': line = '2.3'; break;
      case 'move': line = '2.3'; break;
      case 'swap': line = '2.4'; break;
      case 'partitionDone': line = '2.5'; break;
      case 'pivotInPlace': line = '2.5'; break;
      case 'finished': line = '1.1'; break;
      default: line = null;
    }
    renderPseudocode(line);
  }

  // Playback engine
  function startPlayback() {
    if (!snapshots || snapshots.length===0) return;
    playing = true;
    startBtn.disabled = true;
    prepareBtn.disabled = true;
    randomBtn.disabled = true;
    loadBtn.disabled = true;
    sizeEl.disabled = true;
    pivotSel.disabled = true;
    orderSel.disabled = true;
    stepFwd.disabled = true;
    stepBack.disabled = true;
    resetBtn.disabled = true;
    pauseBtn.disabled = false;

    const speed = parseInt(speedEl.value,10);
    if (timer) clearInterval(timer);
    timer = setInterval(() => {
      if (currentIndex < snapshots.length - 1) {
        setIndex(currentIndex + 1);
      } else {
        pausePlayback();
      }
    }, speed);
  }

  function pausePlayback() {
    playing = false;
    startBtn.disabled = false;
    prepareBtn.disabled = false;
    randomBtn.disabled = false;
    loadBtn.disabled = false;
    sizeEl.disabled = false;
    pivotSel.disabled = false;
    orderSel.disabled = false;
    stepFwd.disabled = false;
    stepBack.disabled = false;
    resetBtn.disabled = false;
    if (timer) clearInterval(timer);
    timer = null;
  }

  function resetToInitial() {
    pausePlayback();
    array = initialArray.slice();
    snapshots = [];
    currentIndex = 0;
    comparisons = 0;
    swaps = 0;
    compCountEl.textContent = 0;
    swapCountEl.textContent = 0;
    stepCountEl.textContent = '0 / 0';
    renderPseudocode(null);
    stackEl.textContent = '';
    drawArray();
  }

  // Event wiring
  sizeEl.addEventListener('input', () => {
    sizeVal.textContent = sizeEl.value;
  });

  speedEl.addEventListener('input', () => {
    speedVal.textContent = speedEl.value + 'ms';
    if (playing) {
      // restart timer with new speed
      startPlayback();
    }
  });

  randomBtn.addEventListener('click', () => {
    const n = parseInt(sizeEl.value,10);
    array = generateRandom(n);
    initialArray = array.slice();
    resetToInitial(); // draws array
    drawArray();
  });

  loadBtn.addEventListener('click', () => {
    const txt = customInput.value.trim();
    if (!txt) return;
    const parts = txt.split(',').map(s=>s.trim()).filter(s=>s.length>0);
    const vals = [];
    for (const p of parts) {
      const v = Number(p);
      if (Number.isNaN(v)) {
        alert('Invalid number in custom input: ' + p);
        return;
      }
      vals.push(v);
    }
    if (vals.length===0) return;
    array = vals.slice();
    initialArray = array.slice();
    sizeEl.value = Math.max(5, Math.min(80, vals.length));
    sizeVal.textContent = sizeEl.value;
    resetToInitial();
    drawArray();
  });

  prepareBtn.addEventListener('click', () => {
    if (!array || array.length===0) {
      // generate default
      array = generateRandom(parseInt(sizeEl.value,10));
      initialArray = array.slice();
    }
    const settings = { pivot: pivotSel.value, order: orderSel.value };
    snapshots = buildSnapshots(array, settings);
    currentIndex = 0;
    setIndex(0);
    alert('Preparation complete — ' + snapshots.length + ' steps recorded. Use Start or step buttons to play.');
  });

  startBtn.addEventListener('click', () => {
    if (!snapshots || snapshots.length===0) {
      // auto-prepare
      if (!array || array.length===0) {
        array = generateRandom(parseInt(sizeEl.value,10));
        initialArray = array.slice();
      }
      const settings = { pivot: pivotSel.value, order: orderSel.value };
      snapshots = buildSnapshots(array, settings);
      currentIndex = 0;
      setIndex(0);
    }
    startPlayback();
  });

  pauseBtn.addEventListener('click', () => {
    pausePlayback();
  });

  stepFwd.addEventListener('click', () => {
    if (!snapshots || snapshots.length===0) return;
    pausePlayback();
    setIndex(currentIndex + 1);
  });

  stepBack.addEventListener('click', () => {
    if (!snapshots || snapshots.length===0) return;
    pausePlayback();
    setIndex(currentIndex - 1);
  });

  resetBtn.addEventListener('click', () => {
    // reset to the untouched initial array
    resetToInitial();
  });

  // Init default random array and draw
  function init() {
    const n = parseInt(sizeEl.value,10);
    array = generateRandom(n);
    initialArray = array.slice();
    drawArray();
    renderPseudocode(null);
    sizeVal.textContent = sizeEl.value;
    speedVal.textContent = speedEl.value + 'ms';
    pauseBtn.disabled = true;
    stepFwd.disabled = false;
    stepBack.disabled = false;
  }

  // keyboard shortcuts
  window.addEventListener('keydown', (e) => {
    if (e.key === ' ') { e.preventDefault(); if (playing) pausePlayback(); else startBtn.click(); }
    if (e.key === 'ArrowRight') stepFwd.click();
    if (e.key === 'ArrowLeft') stepBack.click();
  });

  init();
})();
</script>
</body>
</html>