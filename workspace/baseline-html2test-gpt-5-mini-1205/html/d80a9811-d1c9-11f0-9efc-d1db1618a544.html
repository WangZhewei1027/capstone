<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Bubble Sort Visualizer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#0f1724;
      --panel:#0b1220;
      --accent:#3b82f6;
      --muted:#94a3b8;
      --good:#10b981;
      --bad:#ef4444;
      --cmp:#f59e0b;
      --bar-bg:#111827;
      --glass: rgba(255,255,255,0.03);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color-scheme: dark;
    }
    html,body{
      height:100%;
      margin:0;
      background:linear-gradient(180deg,#071025 0%, #081228 60%);
      color: #e6eef6;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    .app {
      max-width:1100px;
      margin:24px auto;
      padding:18px;
      border-radius:12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      box-shadow: 0 8px 30px rgba(2,6,23,0.6);
    }
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:12px;
    }
    h1{
      font-size:18px;
      margin:0;
      color:#eaf2ff;
    }
    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .control {
      background:var(--glass);
      border:1px solid rgba(255,255,255,0.03);
      padding:8px;
      border-radius:8px;
      display:flex;
      gap:8px;
      align-items:center;
    }
    label{ font-size:12px; color:var(--muted); }
    input[type="range"]{ width:140px; }
    button{
      background:linear-gradient(180deg,var(--accent),#1e6fe5);
      border:none;
      padding:8px 12px;
      border-radius:8px;
      color:white;
      cursor:pointer;
      font-weight:600;
      box-shadow: 0 4px 12px rgba(59,130,246,0.18);
    }
    button.ghost{
      background:transparent;
      border:1px solid rgba(255,255,255,0.06);
      color:var(--muted);
      box-shadow:none;
    }
    .main{
      display:flex;
      gap:16px;
      align-items:flex-start;
    }
    .viz{
      flex:1 1 680px;
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      border-radius:10px;
      padding:12px;
      border:1px solid rgba(255,255,255,0.03);
      min-height:320px;
    }
    .bars{
      display:flex;
      align-items:flex-end;
      gap:4px;
      height:360px;
      padding:8px;
      box-sizing:border-box;
    }
    .bar{
      background:var(--bar-bg);
      flex:1 1 auto;
      border-radius:6px 6px 3px 3px;
      display:flex;
      align-items:flex-end;
      justify-content:center;
      color:rgba(255,255,255,0.85);
      font-size:11px;
      box-shadow: inset 0 -2px 8px rgba(0,0,0,0.4);
      transition: background-color 160ms, transform 120ms;
      position:relative;
      min-width:6px;
    }
    .bar .val{
      padding:4px;
      transform: translateY(-6px);
      opacity:0.9;
    }
    .bar.default{ background:linear-gradient(180deg,#1f2937,#111827); }
    .bar.compare{ background:linear-gradient(180deg,#fbbf24,#f59e0b); transform:scaleY(1.02); }
    .bar.swap{ background:linear-gradient(180deg,#fb7185,#ef4444); transform:scaleY(1.06); }
    .bar.sorted{ background:linear-gradient(180deg,#34d399,#10b981); }
    .info{
      width:320px;
      min-width:260px;
      background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      padding:12px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.03);
    }
    .stat{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      padding:8px 6px;
      margin-bottom:8px;
      border-radius:8px;
      background:rgba(255,255,255,0.02);
      font-size:14px;
    }
    .pseudocode{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace;
      background:rgba(255,255,255,0.02);
      padding:8px;
      border-radius:8px;
      font-size:13px;
      color:var(--muted);
      line-height:1.5;
    }
    .line{
      padding:2px 6px;
      border-radius:4px;
    }
    .line.active{
      background:rgba(59,130,246,0.12);
      color:#cfe8ff;
    }
    small{ color:var(--muted); }
    footer{ margin-top:12px; font-size:13px; color:var(--muted); }
    .row{ display:flex; gap:8px; align-items:center; }
    .toggle{
      display:flex;
      gap:6px;
      align-items:center;
      background:transparent;
      border:1px solid rgba(255,255,255,0.04);
      padding:6px 8px;
      border-radius:8px;
    }
    .legend{ display:flex; gap:6px; margin-top:8px; flex-wrap:wrap; }
    .legend .key{ display:flex; gap:6px; align-items:center; padding:6px; background:rgba(255,255,255,0.02); border-radius:8px; font-size:13px; }
    .dot{ width:12px; height:12px; border-radius:3px; }
    @media (max-width:900px){
      .main{ flex-direction:column; }
      .viz{ order:1 }
      .info{ order:2; width:100% }
      .bars{ height:300px }
    }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Bubble Sort Visualizer">
    <header>
      <div>
        <h1>Bubble Sort Visualizer</h1>
        <small>Step through or autoplay bubble sort. Watch comparisons and swaps.</small>
      </div>
      <div class="controls" aria-hidden="false">
        <div class="control">
          <label for="size">Size</label>
          <input id="size" type="range" min="6" max="80" value="24" />
        </div>
        <div class="control">
          <label for="speed">Speed</label>
          <input id="speed" type="range" min="20" max="1200" value="180" />
        </div>
        <div class="control toggle" title="Sort direction">
          <label for="dir">Order</label>
          <select id="dir" style="background:transparent;border:none;color:inherit;">
            <option value="asc">Ascending</option>
            <option value="desc">Descending</option>
          </select>
        </div>
        <div class="control">
          <button id="shuffle">Shuffle</button>
        </div>
        <div class="control">
          <button id="start">Start</button>
          <button id="step" class="ghost">Step</button>
          <button id="pause" class="ghost" disabled>Pause</button>
          <button id="reset" class="ghost">Reset</button>
        </div>
      </div>
    </header>

    <div class="main">
      <section class="viz" aria-live="polite">
        <div class="bars" id="bars" aria-hidden="false"></div>
      </section>

      <aside class="info">
        <div class="stat"><div>Comparisons</div><div id="compCount">0</div></div>
        <div class="stat"><div>Swaps</div><div id="swapCount">0</div></div>
        <div class="stat"><div>Current pass</div><div id="pass">0</div></div>
        <div class="stat"><div>Array size</div><div id="sizeLabel">24</div></div>

        <div style="margin-top:8px;" class="legend">
          <div class="key"><div class="dot" style="background:linear-gradient(180deg,#1f2937,#111827)"></div> Unvisited</div>
          <div class="key"><div class="dot" style="background:linear-gradient(180deg,#fbbf24,#f59e0b)"></div> Comparing</div>
          <div class="key"><div class="dot" style="background:linear-gradient(180deg,#fb7185,#ef4444)"></div> Swapping</div>
          <div class="key"><div class="dot" style="background:linear-gradient(180deg,#34d399,#10b981)"></div> Sorted</div>
        </div>

        <h3 style="margin-top:12px;margin-bottom:6px;">Pseudocode</h3>
        <div class="pseudocode" id="pseudocode" aria-hidden="false">
          <div class="line" data-line="1">for i from 0 to n-1</div>
          <div class="line" data-line="2" style="padding-left:8px">for j from 0 to n-i-2</div>
          <div class="line" data-line="3" style="padding-left:16px">if A[j] &gt; A[j+1]</div>
          <div class="line" data-line="4" style="padding-left:24px">swap A[j], A[j+1]</div>
          <div class="line" data-line="5" style="padding-left:8px">end for</div>
          <div class="line" data-line="6">end for</div>
        </div>

        <footer>
          Tip: Use Step to move one comparison at a time. Start to autoplay. Shuffle to randomize.
        </footer>
      </aside>
    </div>
  </div>

  <script>
    // Bubble Sort Visualizer
    (function(){
      // DOM
      const barsEl = document.getElementById('bars');
      const sizeRange = document.getElementById('size');
      const speedRange = document.getElementById('speed');
      const dirSelect = document.getElementById('dir');
      const shuffleBtn = document.getElementById('shuffle');
      const startBtn = document.getElementById('start');
      const pauseBtn = document.getElementById('pause');
      const stepBtn = document.getElementById('step');
      const resetBtn = document.getElementById('reset');
      const compCountEl = document.getElementById('compCount');
      const swapCountEl = document.getElementById('swapCount');
      const passEl = document.getElementById('pass');
      const sizeLabel = document.getElementById('sizeLabel');
      const pseudo = document.getElementById('pseudocode');

      // State
      let arr = [];
      let bars = [];
      let n = parseInt(sizeRange.value,10);
      let speed = parseInt(speedRange.value,10);
      let direction = dirSelect.value; // 'asc' or 'desc'
      let cmpCount = 0, swapCount = 0;
      let generator = null;
      let running = false;
      let timer = null;
      let lastUnsorted = null;
      let pass = 0;

      // Utils
      function randArray(size){
        const a = [];
        for(let i=0;i<size;i++){
          a.push(10 + Math.floor(Math.random()*490));
        }
        return a;
      }

      function renderArray(){
        barsEl.innerHTML = '';
        bars = [];
        const max = Math.max(...arr);
        arr.forEach((v, idx)=>{
          const bar = document.createElement('div');
          bar.className = 'bar default';
          bar.style.height = (v / max * 100) + '%';
          bar.dataset.index = idx;
          const val = document.createElement('div');
          val.className = 'val';
          val.textContent = Math.round(v);
          bar.appendChild(val);
          barsEl.appendChild(bar);
          bars.push(bar);
        });
        updateStats();
      }

      function updateStats(){
        compCountEl.textContent = cmpCount;
        swapCountEl.textContent = swapCount;
        passEl.textContent = pass;
        sizeLabel.textContent = n;
      }

      function highlightPseudocode(line){
        pseudo.querySelectorAll('.line').forEach(el=>{
          el.classList.toggle('active', el.dataset.line === String(line));
        });
      }

      // Bubble sort generator - yields steps to animate
      function* bubbleGenerator(array, dir){
        const n = array.length;
        let swapped;
        for(let i=0;i<n-1;i++){
          swapped = false;
          // pass i
          yield {type:'pass', i};
          for(let j=0;j<n-i-1;j++){
            // compare j and j+1
            yield {type:'compare', j, j1:j+1};
            const a = array[j], b = array[j+1];
            const shouldSwap = dir === 'asc' ? a > b : a < b;
            if(shouldSwap){
              // swap
              yield {type:'swap', j, j1:j+1};
              // perform swap in generator's array representation so comparisons reflect it
              const tmp = array[j];
              array[j] = array[j+1];
              array[j+1] = tmp;
              swapped = true;
            }
          }
          // after each pass, element at n-i-1 is in place
          yield {type:'sortedIndex', idx: n-i-1};
          if(!swapped){
            // already sorted
            break;
          }
        }
        // mark all sorted (for completeness)
        yield {type:'done'};
      }

      // Animation helpers
      function markAllDefault(){
        bars.forEach(b => {
          b.className = 'bar default';
        });
      }

      function markCompare(j, j1){
        markAllDefault();
        if(bars[j]) bars[j].className = 'bar compare';
        if(bars[j1]) bars[j1].className = 'bar compare';
      }

      function markSwap(j, j1){
        markAllDefault();
        if(bars[j]) bars[j].className = 'bar swap';
        if(bars[j1]) bars[j1].className = 'bar swap';
        // animate heights swapping visually
        const h1 = bars[j].style.height;
        const h2 = bars[j1].style.height;
        const v1 = bars[j].querySelector('.val').textContent;
        const v2 = bars[j1].querySelector('.val').textContent;
        bars[j].style.height = h2;
        bars[j1].style.height = h1;
        bars[j].querySelector('.val').textContent = v2;
        bars[j1].querySelector('.val').textContent = v1;
        // also swap nodes in the bars array to keep indexes meaningful
        const tmp = bars[j];
        bars[j] = bars[j1];
        bars[j1] = tmp;
      }

      function markSorted(idx){
        if(bars[idx]) bars[idx].className = 'bar sorted';
      }

      function setControlsEnabled(enabled){
        sizeRange.disabled = !enabled;
        dirSelect.disabled = !enabled;
        shuffleBtn.disabled = !enabled;
      }

      // Step execution: consume one yield from generator and animate
      async function stepOnce(){
        if(!generator) return;
        const res = generator.next();
        if(res.done) {
          // finish
          running = false;
          clearInterval(timer);
          timer = null;
          pauseBtn.disabled = true;
          startBtn.textContent = 'Start';
          setControlsEnabled(true);
          highlightPseudocode(null);
          markAllDefault();
          // mark all sorted just in case
          bars.forEach(b => b.classList.add('sorted'));
          return;
        }
        const op = res.value;
        switch(op.type){
          case 'pass':
            pass = op.i + 1;
            highlightPseudocode(1);
            updateStats();
            break;
          case 'compare':
            cmpCount++;
            highlightPseudocode(3);
            pass = pass; updateStats();
            markCompare(op.j, op.j1);
            break;
          case 'swap':
            swapCount++;
            highlightPseudocode(4);
            markSwap(op.j, op.j1);
            updateStats();
            break;
          case 'sortedIndex':
            highlightPseudocode(null);
            markSorted(op.idx);
            break;
          case 'done':
            highlightPseudocode(null);
            break;
        }
      }

      // Run loop for autoplay
      function startAuto(){
        if(running) return;
        running = true;
        setControlsEnabled(false);
        startBtn.textContent = 'Running';
        pauseBtn.disabled = false;
        stepBtn.disabled = true;
        sizeRange.disabled = true;
        // use setInterval based on speed: smaller speed range value => faster (we invert)
        const interval = Math.max(10, speed);
        timer = setInterval(()=>{
          // If generator completes, clear interval inside stepOnce
          stepOnce();
        }, interval);
      }

      function pauseAuto(){
        running = false;
        clearInterval(timer);
        timer = null;
        pauseBtn.disabled = true;
        startBtn.textContent = 'Start';
        stepBtn.disabled = false;
        setControlsEnabled(true);
      }

      // Setup / event wiring
      function resetState(newN){
        n = newN ?? n;
        arr = randArray(n);
        cmpCount = 0; swapCount = 0; pass = 0;
        generator = null;
        running = false;
        clearInterval(timer);
        timer = null;
        highlightPseudocode(null);
        sizeRange.value = n;
        sizeLabel.textContent = n;
        renderArray();
        pauseBtn.disabled = true;
        startBtn.textContent = 'Start';
        stepBtn.disabled = false;
        setControlsEnabled(true);
      }

      // initialize
      resetState(n);

      // Event listeners
      sizeRange.addEventListener('input', (e)=>{
        const val = parseInt(e.target.value,10);
        sizeLabel.textContent = val;
      });
      sizeRange.addEventListener('change', (e)=>{
        const val = parseInt(e.target.value,10);
        resetState(val);
      });
      speedRange.addEventListener('input', (e)=>{
        speed = parseInt(e.target.value,10);
      });
      dirSelect.addEventListener('change', (e)=>{
        direction = e.target.value;
      });
      shuffleBtn.addEventListener('click', ()=>{
        resetState(n);
      });

      startBtn.addEventListener('click', ()=>{
        if(running) return;
        // If generator not created yet, create fresh using a copy of arr so internal swaps are tracked
        if(!generator){
          // copy the numeric values shown currently (bars heights represent arr)
          // ensure arr matches bars values (in case user reloaded)
          arr = bars.map(b => Number(b.querySelector('.val').textContent));
          generator = bubbleGenerator(arr.slice(), direction);
          cmpCount = 0; swapCount = 0; pass = 0;
          updateStats();
        }
        startAuto();
      });

      pauseBtn.addEventListener('click', ()=>{
        pauseAuto();
      });

      stepBtn.addEventListener('click', async ()=>{
        // create generator if missing
        if(!generator){
          arr = bars.map(b => Number(b.querySelector('.val').textContent));
          generator = bubbleGenerator(arr.slice(), direction);
          cmpCount = 0; swapCount = 0; pass = 0;
        }
        // ensure not auto-running
        if(running){
          pauseAuto();
        }
        await stepOnce();
      });

      resetBtn.addEventListener('click', ()=>{
        // stop and reset to new random array of same size
        resetState(n);
      });

      // keyboard shortcuts
      window.addEventListener('keydown', (e)=>{
        if(e.key === ' '){
          e.preventDefault();
          if(running) pauseAuto();
          else startBtn.click();
        } else if(e.key === 'ArrowRight'){
          e.preventDefault();
          stepBtn.click();
        } else if(e.key === 'r' || e.key === 'R'){
          resetBtn.click();
        } else if(e.key === 's' || e.key === 'S'){
          shuffleBtn.click();
        }
      });

      // Accessibility: announce actions
      const liveRegion = barsEl;
      function announce(msg){
        // simple: update aria-live text by setting title attribute temporarily
        liveRegion.setAttribute('aria-label', msg);
      }

      // Update interval speed if changed during running
      setInterval(()=>{
        if(running && timer!=null){
          // restart interval with new speed
          clearInterval(timer);
          timer = setInterval(()=>stepOnce(), Math.max(10, speed));
        }
      }, 300);

      // Initialize pseudocode highlight to none
      highlightPseudocode(null);

      // Expose nothing globally
    })();
  </script>
</body>
</html>