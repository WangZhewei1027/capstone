{
  "id": "d80ae631-d1c9-11f0-9efc-d1db1618a544",
  "timestamp": "2025-12-05T11:04:51.287Z",
  "type": "html-to-test",
  "htmlModel": "gpt-5-mini",
  "playwrightModel": "gpt-5-mini",
  "status": "success",
  "question": "Heap Sort",
  "answer": {
    "role": "assistant",
    "content": "<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\">\n  <title>Heap Sort Visualizer</title>\n  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n  <style>\n    :root{\n      --bg:#0f1724;\n      --panel:#0b1220;\n      --accent:#2dd4bf;\n      --muted:#94a3b8;\n      --bar:#60a5fa;\n      --swap:#fb7185;\n      --compare:#fbbf24;\n      --sorted:#34d399;\n    }\n    html,body{height:100%;margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial; background:linear-gradient(180deg,#071023 0%,#07101a 100%); color:#e6eef6}\n    .wrap{max-width:1200px;margin:18px auto;padding:18px;}\n    header{display:flex;align-items:center;gap:18px;margin-bottom:18px}\n    header h1{font-size:20px;margin:0}\n    .controls{display:flex;flex-wrap:wrap;gap:12px;background:rgba(255,255,255,0.02);padding:12px;border-radius:10px}\n    .control-row{display:flex;gap:12px;align-items:center}\n    label{font-size:13px;color:var(--muted)}\n    input[type=\"range\"]{width:160px}\n    button{background:linear-gradient(180deg,#0ea5a4,#057a7a);border:0;color:white;padding:8px 12px;border-radius:8px;cursor:pointer}\n    button.secondary{background:#1f2937}\n    button:disabled{opacity:0.45;cursor:not-allowed}\n    .status{display:flex;gap:12px;align-items:center;margin-left:auto}\n    .panel{display:flex;gap:12px;margin-top:18px}\n    .left{flex:2;background:var(--panel);padding:12px;border-radius:10px;min-height:320px}\n    .right{flex:1;background:var(--panel);padding:12px;border-radius:10px;display:flex;flex-direction:column;gap:12px}\n    .array{position:relative;height:340px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border-radius:6px;padding:10px;display:flex;align-items:flex-end;gap:6px;overflow:hidden}\n    .bar{flex:1 1 auto;background:linear-gradient(180deg,var(--bar),#2563eb);border-radius:4px;display:flex;align-items:end;justify-content:center;color:rgba(255,255,255,0.9);font-size:11px;box-shadow:0 2px 4px rgba(2,6,23,0.6)}\n    .bar.small{font-size:10px}\n    .bar .idx{font-size:10px;color:rgba(255,255,255,0.65);margin-bottom:4px}\n    .info{background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;color:var(--muted);font-size:13px}\n    .counters{display:flex;gap:8px}\n    .pill{background:rgba(255,255,255,0.03);padding:8px;border-radius:8px;min-width:94px;text-align:center}\n    .pseudocode{background:#031022;padding:10px;border-radius:8px;overflow:auto;color:#cfe9ff;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, \"Roboto Mono\", monospace;font-size:13px}\n    .line{padding:4px 6px;border-left:3px solid transparent}\n    .line.active{background:linear-gradient(90deg, rgba(255,255,255,0.02), transparent);border-left-color:var(--accent)}\n    .legend{display:flex;gap:8px;flex-wrap:wrap}\n    .legend .key{display:flex;gap:6px;align-items:center;font-size:13px;color:var(--muted)}\n    .swatch{width:14px;height:14px;border-radius:4px}\n    footer{margin-top:14px;color:var(--muted);font-size:13px}\n    @media (max-width:900px){\n      .panel{flex-direction:column}\n      .array{height:260px}\n    }\n  </style>\n</head>\n<body>\n  <div class=\"wrap\">\n    <header>\n      <h1>Heap Sort Visualizer</h1>\n      <div style=\"color:var(--muted);font-size:13px\">Visual, step-through, and animated demonstration of Heap Sort (in-place)</div>\n      <div class=\"status\">\n        <div class=\"pill\" id=\"compCount\">Comparisons: 0</div>\n        <div class=\"pill\" id=\"swapCount\">Swaps: 0</div>\n      </div>\n    </header>\n\n    <div class=\"controls\">\n      <div class=\"control-row\">\n        <label>Array Size\n          <input id=\"sizeRange\" type=\"range\" min=\"6\" max=\"60\" value=\"24\">\n        </label>\n        <span id=\"sizeVal\" style=\"min-width:28px;color:var(--muted)\">24</span>\n      </div>\n\n      <div class=\"control-row\">\n        <label>Speed\n          <input id=\"speedRange\" type=\"range\" min=\"1\" max=\"100\" value=\"50\">\n        </label>\n        <span id=\"speedVal\" style=\"min-width:36px;color:var(--muted)\">50</span>\n      </div>\n\n      <div class=\"control-row\">\n        <label>Order\n          <select id=\"orderSelect\" style=\"padding:6px;border-radius:6px;background:#071027;color:#e6eef6;border:1px solid rgba(255,255,255,0.03)\">\n            <option value=\"asc\">Ascending</option>\n            <option value=\"desc\">Descending</option>\n          </select>\n        </label>\n      </div>\n\n      <div class=\"control-row\">\n        <button id=\"generateBtn\" title=\"Create new random array\">Generate</button>\n        <button id=\"startBtn\" style=\"background:linear-gradient(180deg,#0ea5a4,#057a7a)\">Start</button>\n        <button id=\"pauseBtn\" class=\"secondary\" disabled>Pause</button>\n        <button id=\"stepBtn\" class=\"secondary\">Step</button>\n        <button id=\"resetBtn\" class=\"secondary\">Reset</button>\n      </div>\n\n      <div class=\"control-row\" style=\"margin-left:auto\">\n        <div class=\"legend\">\n          <div class=\"key\"><div class=\"swatch\" style=\"background:var(--compare)\"></div> compare</div>\n          <div class=\"key\"><div class=\"swatch\" style=\"background:var(--swap)\"></div> swap</div>\n          <div class=\"key\"><div class=\"swatch\" style=\"background:var(--sorted)\"></div> sorted</div>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"panel\">\n      <div class=\"left\">\n        <div class=\"array\" id=\"arrayContainer\" aria-live=\"polite\" aria-label=\"Array visualization\"></div>\n      </div>\n\n      <div class=\"right\">\n        <div class=\"info\">\n          <strong>Current Action</strong>\n          <div id=\"actionText\" style=\"margin-top:6px;color:#dbeafe\">Idle</div>\n        </div>\n\n        <div class=\"pseudocode\" id=\"pseudocode\">\n          <div class=\"line\" id=\"line1\">function heapSort(arr):</div>\n          <div class=\"line\" id=\"line2\">&nbsp;&nbsp; n = arr.length</div>\n          <div class=\"line\" id=\"line3\">&nbsp;&nbsp; // Build heap</div>\n          <div class=\"line\" id=\"line4\">&nbsp;&nbsp; for i = floor(n/2)-1 downto 0: heapify(arr, n, i)</div>\n          <div class=\"line\" id=\"line5\">&nbsp;&nbsp; // Extract elements</div>\n          <div class=\"line\" id=\"line6\">&nbsp;&nbsp; for end = n-1 downto 1:</div>\n          <div class=\"line\" id=\"line7\">&nbsp;&nbsp;&nbsp;&nbsp; swap(arr[0], arr[end])</div>\n          <div class=\"line\" id=\"line8\">&nbsp;&nbsp;&nbsp;&nbsp; heapify(arr, end, 0)</div>\n          <hr style=\"border:none;border-top:1px dashed rgba(255,255,255,0.03);margin:6px 0\">\n          <div class=\"line\" id=\"line9\">function heapify(arr, n, i):</div>\n          <div class=\"line\" id=\"line10\">&nbsp;&nbsp; largest = i</div>\n          <div class=\"line\" id=\"line11\">&nbsp;&nbsp; left = 2*i + 1</div>\n          <div class=\"line\" id=\"line12\">&nbsp;&nbsp; right = 2*i + 2</div>\n          <div class=\"line\" id=\"line13\">&nbsp;&nbsp; if left &lt; n and arr[left] &gt; arr[largest]: largest = left</div>\n          <div class=\"line\" id=\"line14\">&nbsp;&nbsp; if right &lt; n and arr[right] &gt; arr[largest]: largest = right</div>\n          <div class=\"line\" id=\"line15\">&nbsp;&nbsp; if largest != i:</div>\n          <div class=\"line\" id=\"line16\">&nbsp;&nbsp;&nbsp;&nbsp; swap(arr[i], arr[largest])</div>\n          <div class=\"line\" id=\"line17\">&nbsp;&nbsp;&nbsp;&nbsp; heapify(arr, n, largest)</div>\n        </div>\n\n        <div class=\"info\">\n          <div class=\"counters\">\n            <div style=\"flex:1\">\n              <div style=\"font-size:13px;color:var(--muted)\">Comparisons</div>\n              <div id=\"comparisons\" style=\"font-size:16px\">0</div>\n            </div>\n            <div style=\"flex:1\">\n              <div style=\"font-size:13px;color:var(--muted)\">Swaps</div>\n              <div id=\"swaps\" style=\"font-size:16px\">0</div>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"info\" style=\"font-size:13px\">\n          Tips:\n          <ul style=\"margin:6px 0 0 18px; padding:0; color:var(--muted)\">\n            <li>Heap sort first builds a heap (max-heap here) then repeatedly extracts the top into the sorted region.</li>\n            <li>Use Step to go one action at a time; Pause to freeze the animation; Reset to restore the original array.</li>\n          </ul>\n        </div>\n      </div>\n    </div>\n\n    <footer>\n      Implementation notes: In-place heap sort; this demo highlights comparisons, swaps, and the sorted tail.\n    </footer>\n  </div>\n\n  <script>\n    // Heap Sort Visualizer\n    (() => {\n      // Elements\n      const arrayContainer = document.getElementById('arrayContainer');\n      const sizeRange = document.getElementById('sizeRange');\n      const sizeVal = document.getElementById('sizeVal');\n      const speedRange = document.getElementById('speedRange');\n      const speedVal = document.getElementById('speedVal');\n      const generateBtn = document.getElementById('generateBtn');\n      const startBtn = document.getElementById('startBtn');\n      const pauseBtn = document.getElementById('pauseBtn');\n      const stepBtn = document.getElementById('stepBtn');\n      const resetBtn = document.getElementById('resetBtn');\n      const orderSelect = document.getElementById('orderSelect');\n      const actionText = document.getElementById('actionText');\n      const comparisonsEl = document.getElementById('comparisons');\n      const swapsEl = document.getElementById('swaps');\n      const compCount = document.getElementById('compCount');\n      const swapCount = document.getElementById('swapCount');\n      const pseudoLines = Array.from(document.querySelectorAll('.pseudocode .line'));\n\n      // State\n      let array = [];\n      let original = [];\n      let bars = [];\n      let actions = []; // recorded actions to animate\n      let actionIndex = 0;\n      let running = false;\n      let paused = false;\n      let comps = 0;\n      let swaps = 0;\n      let animationTimer = null;\n\n      // Helpers\n      function randInt(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }\n      function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }\n\n      function createRandomArray(n){\n        const arr = [];\n        for(let i=0;i<n;i++) arr.push(randInt(12,320));\n        return arr;\n      }\n\n      function renderArray(arr, highlight = {}) {\n        arrayContainer.innerHTML = '';\n        bars = [];\n        const n = arr.length;\n        for(let i=0;i<n;i++){\n          const bar = document.createElement('div');\n          bar.className = 'bar' + (n>40?' small':'');\n          bar.style.height = (arr[i]) + 'px';\n          bar.dataset.index = i;\n          bar.title = String(arr[i]);\n          // label bottom index\n          const idx = document.createElement('div');\n          idx.className = 'idx';\n          idx.textContent = i;\n          const val = document.createElement('div');\n          val.textContent = arr[i];\n          val.style.padding = '4px 0 6px';\n          bar.appendChild(val);\n          bar.appendChild(idx);\n          // set default color\n          bar.style.background = 'linear-gradient(180deg,var(--bar),#2563eb)';\n          arrayContainer.appendChild(bar);\n          bars.push(bar);\n        }\n        // apply some highlights if provided\n        if(highlight.compare) highlight.compare.forEach(i => colorBar(i, 'var(--compare)'));\n        if(highlight.swap) highlight.swap.forEach(i => colorBar(i, 'var(--swap)'));\n        if(highlight.sorted) highlight.sorted.forEach(i => colorBar(i, 'var(--sorted)'));\n      }\n\n      function colorBar(i, color){\n        if(bars[i]) bars[i].style.background = color;\n      }\n\n      function swapVisual(i,j,arr){\n        // swap heights and titles and text\n        if(!bars[i] || !bars[j]) return;\n        const hi = bars[i].style.height;\n        const hj = bars[j].style.height;\n        bars[i].style.height = hj;\n        bars[j].style.height = hi;\n        const ti = bars[i].querySelector('div:nth-child(1)');\n        const tj = bars[j].querySelector('div:nth-child(1)');\n        const vi = ti.textContent, vj = tj.textContent;\n        ti.textContent = vj;\n        tj.textContent = vi;\n        bars[i].title = bars[i].querySelector('div:nth-child(1)').textContent;\n        bars[j].title = bars[j].querySelector('div:nth-child(1)').textContent;\n        // also update data-index display (the label should remain the index)\n      }\n\n      function resetHighlights(){\n        bars.forEach(bar => bar.style.background = 'linear-gradient(180deg,var(--bar),#2563eb)');\n      }\n\n      // Action recording and heap sort implementation that records small atomic actions:\n      // actions: {type:'compare', i,j}, {type:'swap', i,j}, {type:'markSorted', index}, {type:'action', text}, {type:'range', n}\n      function recordHeapSort(arrSrc, ascending=true){\n        const arr = arrSrc.slice();\n        const n = arr.length;\n        const comp = (a,b)=> a > b; // choose relation for max-heap\n        const wantMax = ascending; // for ascending, build max-heap; for descending, build min-heap by inverting compare\n        const compareFn = (a,b) => wantMax ? a > b : a < b;\n\n        actions = [];\n        comps = 0; swaps = 0;\n\n        function recHeapify(nLocal, i){\n          actions.push({type:'action', text:`heapify(n=${nLocal}, i=${i})`});\n          let largest = i;\n          for(;;){\n            let left = 2*i + 1;\n            let right = 2*i + 2;\n            let candidate = largest;\n            if(left < nLocal){\n              actions.push({type:'compare', i:left, j:largest});\n              comps++;\n              if(compareFn(arr[left], arr[candidate])) candidate = left;\n            }\n            if(right < nLocal){\n              actions.push({type:'compare', i:right, j:candidate});\n              comps++;\n              if(compareFn(arr[right], arr[candidate])) candidate = right;\n            }\n            if(candidate !== i){\n              actions.push({type:'swap', i:i, j:candidate});\n              swaps++;\n              // do swap in arr to reflect future comparisons\n              [arr[i], arr[candidate]] = [arr[candidate], arr[i]];\n              i = candidate; // continue sifting down\n              // continue loop with new i\n            } else {\n              break;\n            }\n          }\n        }\n\n        // Build heap\n        actions.push({type:'action', text:'Build heap'});\n        for(let i = Math.floor(n/2)-1; i>=0; i--){\n          actions.push({type:'action', text:`build: heapify index ${i}`});\n          recHeapify(n, i);\n        }\n\n        // Extract elements\n        actions.push({type:'action', text:'Extract elements / sort'});\n        for(let end = n-1; end > 0; end--){\n          actions.push({type:'swap', i:0, j:end});\n          swaps++;\n          [arr[0], arr[end]] = [arr[end], arr[0]];\n          actions.push({type:'markSorted', index:end});\n          // heapify reduced heap\n          // heapify on prefix of size end\n          // implement iterative heapify that records compares & swaps relative to the reduced heap\n          let i = 0;\n          while(true){\n            let left = 2*i + 1;\n            let right = 2*i + 2;\n            let candidate = i;\n            if(left < end){\n              actions.push({type:'compare', i:left, j:candidate});\n              comps++;\n              if(compareFn(arr[left], arr[candidate])) candidate = left;\n            }\n            if(right < end){\n              actions.push({type:'compare', i:right, j:candidate});\n              comps++;\n              if(compareFn(arr[right], arr[candidate])) candidate = right;\n            }\n            if(candidate !== i){\n              actions.push({type:'swap', i:i, j:candidate});\n              swaps++;\n              [arr[i], arr[candidate]] = [arr[candidate], arr[i]];\n              i = candidate;\n            } else break;\n          }\n        }\n        actions.push({type:'markSorted', index:0});\n        // record totals\n        actions.push({type:'done'});\n        return actions;\n      }\n\n      // Animation / execution engine\n      function getDelay(){\n        const speed = parseInt(speedRange.value,10);\n        // map 1..100 to delay 450..10 ms (higher speed -> lower delay)\n        return Math.max(8, Math.floor(500 - speed*4.8));\n      }\n\n      function updateCounters(){\n        comparisonsEl.textContent = comps;\n        swapsEl.textContent = swaps;\n        compCount.textContent = 'Comparisons: ' + comps;\n        swapCount.textContent = 'Swaps: ' + swaps;\n      }\n\n      function highlightPseudoFor(action){\n        // clear\n        pseudoLines.forEach(l => l.classList.remove('active'));\n        // map action types to lines roughly\n        if(!action) return;\n        switch(action.type){\n          case 'action':\n            if(action.text && action.text.startsWith('Build')) document.getElementById('line3').classList.add('active');\n            if(action.text && action.text.startsWith('Extract')) document.getElementById('line5').classList.add('active');\n            break;\n          case 'compare':\n            document.getElementById('line13').classList.add('active');\n            document.getElementById('line14').classList.add('active');\n            break;\n          case 'swap':\n            document.getElementById('line7').classList.add('active');\n            document.getElementById('line16').classList.add('active');\n            break;\n          case 'markSorted':\n            document.getElementById('line7').classList.add('active');\n            break;\n          case 'done':\n            pseudoLines.forEach(l => l.classList.add('active'));\n            break;\n          default:\n            break;\n        }\n      }\n\n      function renderAction(a){\n        resetHighlights();\n        if(!a) return;\n        switch(a.type){\n          case 'action':\n            actionText.textContent = a.text;\n            break;\n          case 'compare':\n            actionText.textContent = `Compare index ${a.i} and ${a.j}`;\n            if(bars[a.i]) bars[a.i].style.background = 'var(--compare)';\n            if(bars[a.j]) bars[a.j].style.background = 'var(--compare)';\n            break;\n          case 'swap':\n            actionText.textContent = `Swap index ${a.i} and ${a.j}`;\n            if(bars[a.i]) bars[a.i].style.background = 'var(--swap)';\n            if(bars[a.j]) bars[a.j].style.background = 'var(--swap)';\n            swapVisual(a.i, a.j, array);\n            break;\n          case 'markSorted':\n            actionText.textContent = `Mark sorted index ${a.index}`;\n            if(bars[a.index]) bars[a.index].style.background = 'var(--sorted)';\n            break;\n          case 'done':\n            actionText.textContent = `Done`;\n            break;\n        }\n        updateCounters();\n        highlightPseudoFor(a);\n      }\n\n      function executeNextAction(){\n        if(actionIndex >= actions.length){\n          running = false;\n          paused = false;\n          startBtn.disabled = false;\n          pauseBtn.disabled = true;\n          stepBtn.disabled = true;\n          return;\n        }\n        const a = actions[actionIndex++];\n        // When we perform a compare or swap the underlying model array must be updated as necessary.\n        // Our recorded actions already updated a temporary arr during recording; during replay we perform visual swaps for swaps only.\n        renderAction(a);\n        // Schedule next\n        if(a.type === 'done'){\n          running = false;\n          paused = false;\n          startBtn.disabled = false;\n          pauseBtn.disabled = true;\n          stepBtn.disabled = true;\n          return;\n        }\n        if(!paused){\n          animationTimer = setTimeout(() => {\n            executeNextAction();\n          }, getDelay());\n        }\n      }\n\n      // Controls behavior\n      function generateNew(){\n        const n = parseInt(sizeRange.value,10);\n        array = createRandomArray(n);\n        original = array.slice();\n        renderArray(array);\n        comps = 0; swaps = 0;\n        updateCounters();\n        actionText.textContent = 'Idle';\n        actionIndex = 0;\n        actions = [];\n        startBtn.disabled = false;\n        pauseBtn.disabled = true;\n        stepBtn.disabled = false;\n        resetBtn.disabled = false;\n      }\n\n      function prepareActions(){\n        actions = recordHeapSort(array, orderSelect.value === 'asc');\n        // Reset to original visualization array (we want to animate from original)\n        array = original.slice();\n        renderArray(array);\n        actionIndex = 0;\n        comps = 0; swaps = 0;\n        updateCounters();\n      }\n\n      // Event listeners\n      sizeRange.addEventListener('input', () => {\n        sizeVal.textContent = sizeRange.value;\n      });\n\n      speedRange.addEventListener('input', () => {\n        speedVal.textContent = speedRange.value;\n      });\n\n      generateBtn.addEventListener('click', () => {\n        generateNew();\n      });\n\n      startBtn.addEventListener('click', () => {\n        // compute actions and start animating\n        prepareActions();\n        running = true;\n        paused = false;\n        startBtn.disabled = true;\n        pauseBtn.disabled = false;\n        stepBtn.disabled = false;\n        executeNextAction();\n      });\n\n      pauseBtn.addEventListener('click', () => {\n        if(!running) return;\n        if(!paused){\n          paused = true;\n          pauseBtn.textContent = 'Resume';\n          if(animationTimer) clearTimeout(animationTimer);\n        } else {\n          paused = false;\n          pauseBtn.textContent = 'Pause';\n          // continue\n          executeNextAction();\n        }\n      });\n\n      stepBtn.addEventListener('click', () => {\n        if(!running){\n          // if not started, prepare actions but do not set running true\n          prepareActions();\n          running = true;\n        }\n        if(paused){\n          // perform one action\n          if(actionIndex < actions.length){\n            const a = actions[actionIndex++];\n            renderAction(a);\n            if(a.type === 'done'){\n              running = false;\n              paused = false;\n              startBtn.disabled = false;\n              pauseBtn.disabled = true;\n              stepBtn.disabled = true;\n            }\n          }\n        } else {\n          // Pause and step: pause current animation then step one\n          paused = true;\n          pauseBtn.textContent = 'Resume';\n          if(animationTimer) clearTimeout(animationTimer);\n          if(actionIndex < actions.length){\n            const a = actions[actionIndex++];\n            renderAction(a);\n            if(a.type === 'done'){\n              running = false;\n              paused = false;\n              startBtn.disabled = false;\n              pauseBtn.disabled = true;\n              stepBtn.disabled = true;\n            }\n          }\n        }\n      });\n\n      resetBtn.addEventListener('click', () => {\n        // Stop animation and restore original array\n        if(animationTimer) clearTimeout(animationTimer);\n        running = false;\n        paused = false;\n        actionIndex = 0;\n        actions = [];\n        array = original.slice();\n        renderArray(array);\n        comps = 0; swaps = 0;\n        updateCounters();\n        actionText.textContent = 'Idle';\n        startBtn.disabled = false;\n        pauseBtn.disabled = true;\n        pauseBtn.textContent = 'Pause';\n        stepBtn.disabled = false;\n      });\n\n      // initial\n      sizeVal.textContent = sizeRange.value;\n      speedVal.textContent = speedRange.value;\n      generateNew();\n\n    })();\n  </script>\n</body>\n</html>"
  },
  "messages": [
    {
      "role": "system",
      "content": "Generate a single HTML file with JavaScript demonstrating the user-given concept. Only respond in a single HTML file."
    },
    {
      "role": "user",
      "content": "Heap Sort"
    }
  ],
  "topic": "Heap Sort",
  "hasFSM": false,
  "hasTest": true
}