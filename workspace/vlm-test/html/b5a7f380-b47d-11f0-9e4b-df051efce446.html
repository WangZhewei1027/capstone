<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bubble Sort Visualizer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  :root {
    --bg: #0f172a;
    --panel: #111827;
    --accent: #60a5fa;
    --accent2: #34d399;
    --text: #e5e7eb;
    --muted: #9ca3af;
    --compare: #f59e0b;
    --swap: #ef4444;
    --sorted: #22c55e;
  }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    background: linear-gradient(180deg, #0b1220, #0f172a);
    color: var(--text);
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    min-height: 100vh;
    display: grid;
    grid-template-rows: auto 1fr auto;
  }
  header {
    padding: 16px 20px;
    background: rgba(17,24,39,0.7);
    border-bottom: 1px solid #1f2937;
    display: flex; align-items: center; gap: 16px; flex-wrap: wrap;
  }
  header h1 {
    margin: 0;
    font-size: 20px;
    letter-spacing: 0.4px;
  }
  .controls {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items: center;
  }
  button, input[type="range"] {
    appearance: none;
    border: none;
    outline: none;
  }
  button {
    background: #1f2937;
    color: var(--text);
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
    border: 1px solid #334155;
    transition: transform 0.05s ease, background 0.2s ease, border-color 0.2s ease;
  }
  button:hover { background: #223049; border-color: #3b82f6; }
  button:active { transform: translateY(1px); }
  button[disabled] {
    opacity: 0.4;
    cursor: not-allowed;
    background: #0b1220;
  }
  .range {
    display: grid;
    grid-template-columns: auto minmax(160px, 220px) auto;
    align-items: center;
    gap: 8px;
    color: var(--muted);
    padding: 4px 8px;
    border: 1px solid #1f2937;
    border-radius: 8px;
    background: #0b1220;
  }
  .range input[type="range"] {
    width: 100%;
    height: 6px;
    background: #111827;
    border-radius: 6px;
    position: relative;
  }
  .range input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 14px; height: 14px; border-radius: 50%;
    background: var(--accent);
    border: 2px solid #1f2937;
    cursor: pointer;
  }
  .range input[type="range"]::-moz-range-thumb {
    width: 14px; height: 14px; border-radius: 50%;
    background: var(--accent);
    border: 2px solid #1f2937;
    cursor: pointer;
  }
  main {
    padding: 12px 20px 18px;
    display: grid;
    grid-template-rows: auto 1fr;
    gap: 12px;
  }
  .status-row {
    display: flex; gap: 18px; align-items: center; flex-wrap: wrap;
    color: var(--muted);
  }
  .status-row .badge {
    background: #0b1220;
    border: 1px solid #1f2937;
    border-radius: 999px;
    padding: 6px 10px;
    color: var(--text);
  }
  .status-row strong { color: var(--text); }
  .viz {
    background: radial-gradient(1200px 600px at 50% -100px, rgba(96,165,250,0.12), transparent), #0b1220;
    border: 1px solid #1f2937;
    border-radius: 12px;
    padding: 12px;
    display: grid;
    grid-template-rows: 1fr auto;
  }
  #bars {
    display: grid;
    grid-auto-flow: column;
    grid-auto-columns: 1fr;
    align-items: end;
    gap: 6px;
    padding: 8px;
    min-height: 260px;
  }
  .bar {
    background: linear-gradient(180deg, #1f2937, #0b1220);
    border: 1px solid #1f2937;
    border-radius: 6px 6px 0 0;
    position: relative;
    transition: height 120ms ease, transform 120ms ease, border-color 120ms ease, background 120ms ease;
  }
  .bar::after {
    content: attr(data-value);
    position: absolute;
    bottom: -20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 10px;
    color: var(--muted);
    pointer-events: none;
  }
  .bar.compare {
    background: linear-gradient(180deg, #f59e0b, #0b1220);
    border-color: #f59e0b;
    box-shadow: 0 0 0 1px rgba(245,158,11,0.6), 0 6px 18px rgba(245,158,11,0.2);
  }
  .bar.swap {
    background: linear-gradient(180deg, #ef4444, #0b1220);
    border-color: #ef4444;
    box-shadow: 0 0 0 1px rgba(239,68,68,0.6), 0 6px 18px rgba(239,68,68,0.2);
  }
  .bar.sorted {
    background: linear-gradient(180deg, #22c55e, #0b1220);
    border-color: #22c55e;
  }
  .legend {
    display: flex; gap: 12px; align-items: center;
    padding: 6px 8px;
    color: var(--muted);
  }
  .legend .dot {
    width: 12px; height: 12px; border-radius: 50%;
    display: inline-block; margin-right: 6px;
  }
  .dot.compare { background: var(--compare); }
  .dot.swap { background: var(--swap); }
  .dot.sorted { background: var(--sorted); }
  footer {
    padding: 10px 20px;
    border-top: 1px solid #1f2937;
    color: var(--muted);
    font-size: 12px;
    display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;
  }
  .kbd {
    border: 1px solid #374151; border-bottom-width: 3px;
    background: #0b1220; color: var(--text);
    padding: 2px 6px; border-radius: 6px; font-size: 11px;
  }
</style>
</head>
<body>
  <header>
    <h1>Bubble Sort Visualizer</h1>
    <div class="controls" aria-label="Controls">
      <button role="button" aria-label="Randomize" id="btnRandom">Randomize</button>
      <button role="button" aria-label="Load Sample" id="btnSample">Load Sample</button>
      <div class="range" aria-label="Array Size">
        <span>Size</span>
        <input role="slider" aria-label="Size" type="range" id="sizeRange" min="5" max="50" value="18">
        <span id="sizeValue" data-testid="sizeValue">18</span>
      </div>
      <div class="range" aria-label="Speed">
        <span>Speed</span>
        <input role="slider" aria-label="Speed" type="range" id="speedRange" min="10" max="1000" value="160">
        <span id="speedValue" data-testid="speedValue">160ms</span>
      </div>
      <button role="button" aria-label="Start" id="btnStart">Start</button>
      <button role="button" aria-label="Pause" id="btnPause" disabled>Pause</button>
      <button role="button" aria-label="Step" id="btnStep">Step</button>
      <button role="button" aria-label="Reset" id="btnReset">Reset</button>
    </div>
  </header>
  <main>
    <div class="status-row">
      <span class="badge" data-testid="status" aria-live="polite">State: Idle</span>
      <span class="badge">i=<strong data-testid="i">0</strong>, j=<strong data-testid="j">0</strong></span>
      <span class="badge">Comparisons=<strong data-testid="comparisons">0</strong>, Swaps=<strong data-testid="swaps">0</strong></span>
    </div>
    <div class="viz">
      <div id="bars" role="list" aria-label="Array Container" data-testid="array" data-state="idle" data-sorted="false" data-length="0" data-i="0" data-j="0"></div>
      <div class="legend">
        <span><span class="dot compare"></span>Comparing</span>
        <span><span class="dot swap"></span>Swapped</span>
        <span><span class="dot sorted"></span>Sorted</span>
      </div>
    </div>
  </main>
  <footer>
    <div>Bubble sort repeatedly compares adjacent elements and swaps them if they are out of order, pushing the largest elements to the end each pass.</div>
    <div>
      Shortcuts:
      <span class="kbd" aria-label="Shortcut Start">S</span>
      <span class="kbd" aria-label="Shortcut Pause">P</span>
      <span class="kbd" aria-label="Shortcut Step">Space</span>
      <span class="kbd" aria-label="Shortcut Randomize">R</span>
    </div>
  </footer>

<script>
(function(){
  // Core state
  const el = {
    bars: document.getElementById('bars'),
    status: document.querySelector('[data-testid="status"]'),
    iText: document.querySelector('[data-testid="i"]'),
    jText: document.querySelector('[data-testid="j"]'),
    cmpText: document.querySelector('[data-testid="comparisons"]'),
    swpText: document.querySelector('[data-testid="swaps"]'),
    sizeRange: document.getElementById('sizeRange'),
    sizeValue: document.getElementById('sizeValue'),
    speedRange: document.getElementById('speedRange'),
    speedValue: document.getElementById('speedValue'),
    btnRandom: document.getElementById('btnRandom'),
    btnSample: document.getElementById('btnSample'),
    btnStart: document.getElementById('btnStart'),
    btnPause: document.getElementById('btnPause'),
    btnStep: document.getElementById('btnStep'),
    btnReset: document.getElementById('btnReset'),
  };

  const fsm = {
    state: 'idle', // idle | sorting | paused | done
    set(newState) {
      this.state = newState;
      el.bars.setAttribute('data-state', newState);
      updateButtons();
      updateStatus();
    }
  };

  let arr = [];
  let i = 0;
  let j = 0;
  let comparisons = 0;
  let swaps = 0;
  let timer = null;
  let msPerStep = parseInt(el.speedRange.value, 10);

  function randomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  function generate(size) {
    const out = [];
    for (let k = 0; k < size; k++) out.push(randomInt(5, 95));
    return out;
  }

  function loadSample() {
    // Deterministic sample dataset
    const size = parseInt(el.sizeRange.value, 10);
    const sample = [64, 34, 25, 12, 22, 11, 90, 5, 78, 45, 3, 33, 87, 31, 2, 8, 19, 70, 40, 16];
    arr = sample.slice(0, size);
    resetPointers();
    renderBars();
    fsm.set('idle');
  }

  function resetPointers() {
    i = 0; j = 0;
    comparisons = 0; swaps = 0;
    clearTimer();
    el.bars.setAttribute('data-sorted', 'false');
    updateIJ();
    updateCounters();
  }

  function renderBars() {
    el.bars.innerHTML = '';
    const maxVal = Math.max(...arr, 100);
    arr.forEach((val, idx) => {
      const bar = document.createElement('div');
      bar.className = 'bar';
      bar.setAttribute('role', 'listitem');
      bar.setAttribute('aria-label', `Index ${idx}, Value ${val}`);
      bar.setAttribute('data-index', idx);
      bar.setAttribute('data-value', val);
      const height = Math.max(8, Math.round((val / maxVal) * 220));
      bar.style.height = height + 'px';
      el.bars.appendChild(bar);
    });
    el.bars.setAttribute('data-length', String(arr.length));
  }

  function markSortedSuffix() {
    const n = arr.length;
    for (let idx = n - 1; idx >= n - i && idx >= 0; idx--) {
      const bar = el.bars.querySelector(`.bar[data-index="${idx}"]`);
      if (bar) bar.classList.add('sorted');
    }
  }

  function clearHighlights() {
    el.bars.querySelectorAll('.bar.compare, .bar.swap').forEach(b => {
      b.classList.remove('compare', 'swap');
    });
  }

  function updateIJ() {
    el.iText.textContent = String(i);
    el.jText.textContent = String(j);
    el.bars.setAttribute('data-i', String(i));
    el.bars.setAttribute('data-j', String(j));
  }

  function updateCounters() {
    el.cmpText.textContent = String(comparisons);
    el.swpText.textContent = String(swaps);
  }

  function updateStatus() {
    const label = fsm.state.charAt(0).toUpperCase() + fsm.state.slice(1);
    el.status.textContent = `State: ${label}`;
  }

  function updateButtons() {
    const st = fsm.state;
    const isDone = st === 'done';
    el.btnStart.disabled = st === 'sorting' || isDone;
    el.btnPause.disabled = st !== 'sorting';
    el.btnStep.disabled = st === 'sorting' || isDone;
    el.btnReset.disabled = false;
    el.btnRandom.disabled = st === 'sorting';
    el.btnSample.disabled = st === 'sorting';
    el.sizeRange.disabled = st === 'sorting';
    el.speedRange.disabled = false;
  }

  function randomize() {
    const size = parseInt(el.sizeRange.value, 10);
    arr = generate(size);
    resetPointers();
    renderBars();
    fsm.set('idle');
  }

  function reset() {
    // Reset pointers and visuals, keep current array
    resetPointers();
    el.bars.querySelectorAll('.bar').forEach(b => {
      b.classList.remove('sorted', 'compare', 'swap');
    });
    fsm.set('idle');
  }

  function clearTimer() {
    if (timer !== null) {
      clearInterval(timer);
      timer = null;
    }
  }

  function start() {
    if (fsm.state === 'done') return;
    if (timer !== null) clearTimer();
    fsm.set('sorting');
    timer = setInterval(tick, msPerStep);
  }

  function pause() {
    clearTimer();
    fsm.set('paused');
  }

  function finish() {
    clearTimer();
    // Mark all sorted
    el.bars.querySelectorAll('.bar').forEach(b => b.classList.add('sorted'));
    el.bars.setAttribute('data-sorted', 'true');
    fsm.set('done');
  }

  function bubbleStep() {
    const n = arr.length;
    if (i >= n - 1) {
      finish();
      return false;
    }
    clearHighlights();
    markSortedSuffix();

    const leftIdx = j;
    const rightIdx = j + 1;
    const leftBar = el.bars.querySelector(`.bar[data-index="${leftIdx}"]`);
    const rightBar = el.bars.querySelector(`.bar[data-index="${rightIdx}"]`);
    if (leftBar) leftBar.classList.add('compare');
    if (rightBar) rightBar.classList.add('compare');

    comparisons++;

    if (arr[leftIdx] > arr[rightIdx]) {
      const tmp = arr[leftIdx];
      arr[leftIdx] = arr[rightIdx];
      arr[rightIdx] = tmp;
      swaps++;

      // Update bars values and heights visually
      [leftBar.dataset.value, rightBar.dataset.value] = [String(arr[leftIdx]), String(arr[rightIdx])];
      const maxVal = Math.max(...arr, 100);
      leftBar.style.height = Math.max(8, Math.round((arr[leftIdx] / maxVal) * 220)) + 'px';
      rightBar.style.height = Math.max(8, Math.round((arr[rightIdx] / maxVal) * 220)) + 'px';

      leftBar.classList.add('swap');
      rightBar.classList.add('swap');
    }

    j++;
    if (j >= n - i - 1) {
      j = 0;
      i++;
      markSortedSuffix();
      if (i >= n - 1) {
        updateCounters();
        updateIJ();
        finish();
        return false;
      }
    }
    updateCounters();
    updateIJ();
    return true;
  }

  function tick() {
    const more = bubbleStep();
    if (!more && fsm.state === 'sorting') {
      finish();
    }
  }

  function step() {
    if (fsm.state === 'done') return;
    if (fsm.state === 'sorting') return; // ignore during auto
    const more = bubbleStep();
    if (!more) {
      // finished
      return;
    }
    if (fsm.state === 'idle') {
      fsm.set('paused');
    } else {
      updateStatus();
    }
  }

  // Wire UI
  el.btnRandom.addEventListener('click', () => { randomize(); });
  el.btnSample.addEventListener('click', () => { loadSample(); });
  el.btnStart.addEventListener('click', () => { start(); });
  el.btnPause.addEventListener('click', () => { pause(); });
  el.btnStep.addEventListener('click', () => { step(); });
  el.btnReset.addEventListener('click', () => { reset(); });

  el.sizeRange.addEventListener('input', () => {
    el.sizeValue.textContent = el.sizeRange.value;
  });
  el.sizeRange.addEventListener('change', () => {
    randomize();
  });
  el.speedRange.addEventListener('input', () => {
    msPerStep = parseInt(el.speedRange.value, 10);
    el.speedValue.textContent = msPerStep + 'ms';
    if (fsm.state === 'sorting') {
      clearTimer();
      timer = setInterval(tick, msPerStep);
    }
  });

  // Keyboard shortcuts
  document.addEventListener('keydown', (e) => {
    if (e.key === 's' || e.key === 'S') {
      el.btnStart.click();
    } else if (e.key === 'p' || e.key === 'P') {
      el.btnPause.click();
    } else if (e.key === ' ') {
      e.preventDefault();
      el.btnStep.click();
    } else if (e.key === 'r' || e.key === 'R') {
      el.btnRandom.click();
    }
  });

  // Initialize
  randomize();
})();
</script>

<script id="fsm" type="application/json">
{
  "name": "BubbleSortVisualizerFSM",
  "concept": "bubble sort",
  "initial": "idle",
  "states": {
    "idle": {
      "on": {
        "START": "sorting",
        "STEP": "paused",
        "RANDOMIZE": "idle",
        "RESET": "idle",
        "LOAD_SAMPLE": "idle"
      },
      "meta": {
        "description": "Ready to sort an array; no automatic progression."
      }
    },
    "sorting": {
      "on": {
        "PAUSE": "paused",
        "FINISH": "done",
        "RESET": "idle"
      },
      "meta": {
        "description": "Actively performing bubble sort steps on an interval."
      }
    },
    "paused": {
      "on": {
        "START": "sorting",
        "STEP": "paused",
        "RESET": "idle"
      },
      "meta": {
        "description": "Sorting progress retained; manual stepping allowed."
      }
    },
    "done": {
      "on": {
        "RANDOMIZE": "idle",
        "RESET": "idle",
        "LOAD_SAMPLE": "idle"
      },
      "meta": {
        "description": "Array is fully sorted."
      }
    }
  },
  "playwright": {
    "notes": "Selectors use role, aria-label, and data-testid for robustness.",
    "eventMap": [
      {
        "event": "RANDOMIZE",
        "actions": [
          { "click": "[role='button'][aria-label='Randomize']" }
        ],
        "assertions": [
          { "selector": "[data-testid='status']", "textIncludes": "State: Idle" },
          { "selector": "#bars", "hasAttribute": { "name": "data-state", "value": "idle" } },
          { "selector": "#bars", "hasAttribute": { "name": "data-sorted", "value": "false" } },
          { "selector": "[data-testid='array']", "hasAttribute": { "name": "data-length" } }
        ]
      },
      {
        "event": "LOAD_SAMPLE",
        "actions": [
          { "click": "[role='button'][aria-label='Load Sample']" }
        ],
        "assertions": [
          { "selector": "[data-testid='status']", "textIncludes": "State: Idle" },
          { "selector": "#bars", "hasAttribute": { "name": "data-state", "value": "idle" } },
          { "selector": "[data-testid='array']", "hasAttribute": { "name": "data-length" } }
        ]
      },
      {
        "event": "START",
        "pre": [
          { "ensure": { "selector": "#bars", "hasAttribute": { "name": "data-state", "value": "idle" } } }
        ],
        "actions": [
          { "click": "[role='button'][aria-label='Start']" }
        ],
        "assertions": [
          { "selector": "#bars", "hasAttribute": { "name": "data-state", "value": "sorting" } },
          { "selector": "[data-testid='status']", "textIncludes": "State: Sorting" }
        ]
      },
      {
        "event": "PAUSE",
        "actions": [
          { "click": "[role='button'][aria-label='Pause']" }
        ],
        "assertions": [
          { "selector": "#bars", "hasAttribute": { "name": "data-state", "value": "paused" } },
          { "selector": "[data-testid='status']", "textIncludes": "State: Paused" }
        ]
      },
      {
        "event": "STEP",
        "pre": [
          { "ensure": { "selector": "#bars", "hasAttribute": { "name": "data-state", "value": "idle" }, "or": { "name": "data-state", "value": "paused" } } }
        ],
        "actions": [
          { "click": "[role='button'][aria-label='Step']" }
        ],
        "assertions": [
          { "selector": "#bars", "hasAttribute": { "name": "data-state", "value": "paused" } },
          { "selector": "[data-testid='comparisons']", "increasesBy": 1 }
        ]
      },
      {
        "event": "RESET",
        "actions": [
          { "click": "[role='button'][aria-label='Reset']" }
        ],
        "assertions": [
          { "selector": "#bars", "hasAttribute": { "name": "data-state", "value": "idle" } },
          { "selector": "[data-testid='comparisons']", "hasText": "0" },
          { "selector": "[data-testid='swaps']", "hasText": "0" },
          { "selector": "[data-testid='i']", "hasText": "0" },
          { "selector": "[data-testid='j']", "hasText": "0" }
        ]
      },
      {
        "event": "FINISH",
        "actions": [
          { "script": "await page.click(\"[role='button'][aria-label='Start']\"); await page.waitForSelector('#bars[data-sorted=\"true\"]', { timeout: 10000 });" }
        ],
        "assertions": [
          { "selector": "#bars", "hasAttribute": { "name": "data-state", "value": "done" } },
          { "selector": "#bars", "hasAttribute": { "name": "data-sorted", "value": "true" } },
          { "selector": "[data-testid='status']", "textIncludes": "State: Done" }
        ]
      }
    ],
    "selectors": {
      "start": "[role='button'][aria-label='Start']",
      "pause": "[role='button'][aria-label='Pause']",
      "step": "[role='button'][aria-label='Step']",
      "reset": "[role='button'][aria-label='Reset']",
      "randomize": "[role='button'][aria-label='Randomize']",
      "sample": "[role='button'][aria-label='Load Sample']",
      "status": "[data-testid='status']",
      "array": "[data-testid='array']",
      "comparisons": "[data-testid='comparisons']",
      "swaps": "[data-testid='swaps']",
      "i": "[data-testid='i']",
      "j": "[data-testid='j']"
    }
  }
}
</script>


  <script id="fsm" type="application/json">
    {
  "topic": "bubble sort",
  "description": "Finite state machine for a Bubble Sort visualizer, capturing run modes (idle, sorting, paused, done), user interactions (buttons, sliders, keyboard), timer-driven progression, and completion.",
  "states": [
    {
      "name": "idle",
      "onEnter": "update_ui_state",
      "on": {
        "START": "sorting",
        "KEY_START": "sorting",
        "STEP": "paused",
        "KEY_STEP": "paused",
        "RANDOMIZE": "idle",
        "KEY_RANDOMIZE": "idle",
        "LOAD_SAMPLE": "idle",
        "RESET": "idle",
        "SIZE_CHANGE": "idle",
        "SPEED_CHANGE": "idle",
        "FINISH": "done"
      }
    },
    {
      "name": "sorting",
      "onEnter": "start_timer_and_update_ui",
      "onExit": "clear_timer",
      "on": {
        "PAUSE": "paused",
        "KEY_PAUSE": "paused",
        "RESET": "idle",
        "SPEED_CHANGE": "sorting",
        "TICK": "sorting",
        "FINISH": "done"
      }
    },
    {
      "name": "paused",
      "onEnter": "update_ui_state",
      "on": {
        "START": "sorting",
        "KEY_START": "sorting",
        "STEP": "paused",
        "KEY_STEP": "paused",
        "RESET": "idle",
        "RANDOMIZE": "idle",
        "KEY_RANDOMIZE": "idle",
        "LOAD_SAMPLE": "idle",
        "SPEED_CHANGE": "paused"
      }
    },
    {
      "name": "done",
      "onEnter": "update_ui_state",
      "on": {
        "RESET": "idle",
        "RANDOMIZE": "idle",
        "KEY_RANDOMIZE": "idle",
        "LOAD_SAMPLE": "idle"
      }
    }
  ],
  "events": [
    "START",
    "PAUSE",
    "STEP",
    "RESET",
    "RANDOMIZE",
    "LOAD_SAMPLE",
    "SIZE_CHANGE",
    "SPEED_CHANGE",
    "TICK",
    "FINISH",
    "KEY_START",
    "KEY_PAUSE",
    "KEY_STEP",
    "KEY_RANDOMIZE"
  ],
  "notes": "State semantics and actions:\n- update_ui_state: Called whenever fsm.set(newState) runs; updates #bars[data-state], button enabled/disabled states, and status text.\n- start_timer_and_update_ui: Sets state to 'sorting', starts setInterval(tick, msPerStep) to drive TICK events, and updates UI state.\n- clear_timer: Stops the interval timer (if any). Executed when leaving 'sorting' via Pause, Reset, or Finish.\n- Event to function mappings: START/KEY_START => start(); PAUSE/KEY_PAUSE => pause(); STEP/KEY_STEP => step(); RANDOMIZE/KEY_RANDOMIZE => randomize(); LOAD_SAMPLE => loadSample(); RESET => reset(); SIZE_CHANGE (range 'change') => randomize(); SPEED_CHANGE (range 'input') => update msPerStep and, if sorting, restart interval timer.\n- TICK: Internal timer-driven event emitted by setInterval; each TICK performs bubbleStep(). bubbleStep does the following per step: clears previous highlights (.compare,.swap), marks sorted suffix for completed passes, highlights current pair with .compare, increments comparisons counter, conditionally swaps values (updates arr and bar heights) and highlights with .swap, updates j/i indices and counters, and may trigger FINISH if array is sorted.\n- STEP: Manual progression when not in 'sorting'. From 'idle', STEP performs one bubbleStep and then transitions to 'paused' (unless the array becomes sorted and FINISH occurs). From 'paused', STEP stays 'paused' while advancing one bubbleStep. STEP is ignored in 'sorting' and 'done'.\n- FINISH: Triggered internally by bubbleStep when i >= n-1 (array sorted) or end of final pass. finish() clears timer, marks all bars as .sorted, sets #bars[data-sorted='true'], and transitions to 'done'.\n- Visual feedback states are implemented as CSS class toggles rather than top-level FSM states: '.compare' (current comparison pair), '.swap' (when a swap occurred in the step), '.sorted' (suffix or whole array when done). These occur during bubbleStep within 'sorting' (auto) and 'paused' (manual step) modes.\n- Controls availability: During 'sorting', Start, Randomize, Sample, and Size slider are disabled; Pause is enabled; Speed slider remains enabled and SPEED_CHANGE restarts the timer at the new interval. In 'done', Start and Step are disabled; Reset, Randomize, and Sample return to 'idle'.\n- Keyboard shortcuts: S => START, P => PAUSE, Space => STEP, R => RANDOMIZE (no effect while 'sorting' if the Randomize button is disabled)."
}
  </script>
</body>
</html>