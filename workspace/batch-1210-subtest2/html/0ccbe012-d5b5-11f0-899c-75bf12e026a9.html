<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Selection Sort Demo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
      background: #f0f4f8;
      color: #333;
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
    }
    #arrayInput {
      width: 100%;
      font-size: 1rem;
      padding: 0.5rem;
      margin-bottom: 1rem;
      box-sizing: border-box;
    }
    button {
      font-size: 1rem;
      padding: 0.6rem 1.2rem;
      border: none;
      border-radius: 4px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
    }
    button:disabled {
      background-color: #a0c8ff;
      cursor: not-allowed;
    }
    #visualization {
      margin-top: 2rem;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      gap: 5px;
      height: 300px;
      border: 1px solid #ccc;
      background: white;
      padding: 1rem;
      border-radius: 8px;
    }
    .bar {
      width: 30px;
      background-color: #6c757d;
      color: white;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      font-size: 0.8rem;
      border-radius: 4px 4px 0 0;
      user-select: none;
      position: relative;
    }
    .bar.current {
      background-color: #007bff;
    }
    .bar.min {
      background-color: #dc3545;
    }
    .bar.sorted {
      background-color: #28a745;
    }
    .legend {
      margin-top: 1rem;
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      font-size: 0.9rem;
    }
    .legend span {
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
    .legend .box {
      width: 20px;
      height: 20px;
      border-radius: 3px;
    }
    .box.current { background-color: #007bff; }
    .box.min { background-color: #dc3545; }
    .box.sorted { background-color: #28a745; }
  </style>
</head>
<body>
  <h1>Selection Sort Visualization</h1>
  <p>Enter numbers separated by commas, spaces, or both (e.g., 5,3,8,6,2):</p>
  <input id="arrayInput" type="text" value="64,25,12,22,11" />
  <button id="startBtn">Start Selection Sort</button>

  <div id="visualization" aria-label="Selection sort visualization"></div>

  <div class="legend" aria-label="Color legend">
    <span><div class="box current"></div> Current element being checked</span>
    <span><div class="box min"></div> Current minimum element</span>
    <span><div class="box sorted"></div> Sorted portion</span>
  </div>

  <script>
    const arrayInput = document.getElementById('arrayInput');
    const startBtn = document.getElementById('startBtn');
    const visualization = document.getElementById('visualization');

    let array = [];

    function parseInput(input) {
      // Split by comma and/or spaces, filter empty, map to numbers
      const values = input.split(/[\s,]+/).filter(v => v !== '');
      const nums = values.map(v => Number(v));
      if(nums.some(isNaN)) return null;
      return nums;
    }

    function createBars(arr) {
      visualization.innerHTML = '';
      for (let i = 0; i < arr.length; i++) {
        const bar = document.createElement('div');
        bar.classList.add('bar');
        bar.style.height = `${arr[i] * 3}px`;
        bar.textContent = arr[i];
        bar.setAttribute('data-index', i);
        visualization.appendChild(bar);
      }
    }

    function updateBars(arr, currentIndex = -1, minIndex = -1, sortedIndex = -1) {
      const bars = visualization.children;
      for (let i = 0; i < bars.length; i++) {
        bars[i].textContent = arr[i];
        bars[i].style.height = `${arr[i] * 3}px`;
        bars[i].classList.remove('current', 'min', 'sorted');
        if (i < sortedIndex) {
          bars[i].classList.add('sorted');
        }
        if (i === minIndex) {
          bars[i].classList.add('min');
        }
        if (i === currentIndex) {
          bars[i].classList.add('current');
        }
      }
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    async function selectionSortVisual(arr) {
      const n = arr.length;
      for (let i = 0; i < n - 1; i++) {
        let minIdx = i;
        updateBars(arr, i, minIdx, i);
        await sleep(800);

        for (let j = i + 1; j < n; j++) {
          updateBars(arr, j, minIdx, i);
          await sleep(600);
          if (arr[j] < arr[minIdx]) {
            minIdx = j;
            updateBars(arr, j, minIdx, i);
            await sleep(600);
          }
        }
        if (minIdx !== i) {
          // Swap elements
          [arr[i], arr[minIdx]] = [arr[minIdx], arr[i]];
          updateBars(arr, i, minIdx, i + 1);
          await sleep(800);
        }
        // Mark i as sorted (by passing sortedIndex = i+1)
        updateBars(arr, -1, -1, i + 1);
        await sleep(500);
      }
      // Mark all sorted
      updateBars(arr, -1, -1, n);
    }

    startBtn.addEventListener('click', async () => {
      const inputStr = arrayInput.value;
      const parsed = parseInput(inputStr);
      if (!parsed) {
        alert('Please enter a valid list of numbers separated by commas or spaces.');
        return;
      }
      if (parsed.length === 0) {
        alert('Please enter at least one number.');
        return;
      }
      array = parsed;
      createBars(array);
      startBtn.disabled = true;
      arrayInput.disabled = true;
      await selectionSortVisual(array);
      startBtn.disabled = false;
      arrayInput.disabled = false;
    });

    // Initialize visualization with default input
    window.onload = () => {
      const parsed = parseInput(arrayInput.value);
      if(parsed) createBars(parsed);
    };
  </script>
</body>
</html>