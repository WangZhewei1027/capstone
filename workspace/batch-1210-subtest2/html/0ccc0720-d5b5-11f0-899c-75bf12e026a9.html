<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Insertion Sort Visualization</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #fafafa;
  }
  h1 {
    text-align: center;
  }
  #arrayInput {
    width: 80%;
    margin: 0 auto 10px;
    display: block;
    font-size: 16px;
    padding: 8px;
  }
  #buttons {
    text-align: center;
    margin-bottom: 20px;
  }
  button {
    font-size: 16px;
    padding: 8px 14px;
    margin: 0 5px;
    cursor: pointer;
  }
  #message {
    text-align: center;
    margin-bottom: 10px;
    height: 20px;
    font-weight: bold;
    color: #333;
  }
  #arrayContainer {
    display: flex;
    justify-content: center;
    gap: 6px;
    flex-wrap: wrap;
    max-width: 800px;
    margin: 0 auto;
  }
  .bar {
    background-color: steelblue;
    color: white;
    display: flex;
    justify-content: center;
    align-items: flex-end;
    font-weight: bold;
    border-radius: 4px 4px 0 0;
    transition: background-color 0.3s ease;
  }
  .bar.highlight {
    background-color: #ff704d;
  }
  .bar.current {
    background-color: #4caf50;
  }
  .bar.compare {
    background-color: #ffa726;
  }
</style>
</head>
<body>
<h1>Insertion Sort Visualization</h1>
<input
  id="arrayInput"
  type="text"
  placeholder="Enter numbers separated by commas, e.g. 5,3,8,6,2"
/>
<div id="buttons">
  <button id="startBtn">Start Sorting</button>
  <button id="resetBtn" disabled>Reset</button>
</div>
<div id="message"></div>
<div id="arrayContainer"></div>

<script>
(() => {
  const arrayInput = document.getElementById("arrayInput");
  const startBtn = document.getElementById("startBtn");
  const resetBtn = document.getElementById("resetBtn");
  const arrayContainer = document.getElementById("arrayContainer");
  const message = document.getElementById("message");

  let array = [];
  let bars = [];
  let sorting = false;

  function createBars(arr) {
    arrayContainer.innerHTML = "";
    bars = [];
    const maxVal = Math.max(...arr);
    const scaleFactor = 300 / maxVal;
    arr.forEach((num) => {
      const bar = document.createElement("div");
      bar.classList.add("bar");
      bar.style.height = `${num * scaleFactor}px`;
      bar.style.width = "30px";
      bar.textContent = num;
      bars.push(bar);
      arrayContainer.appendChild(bar);
    });
  }

  // Sleep utility for delay
  function sleep(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms));
  }

  async function insertionSort(arr) {
    message.textContent = "Starting insertion sort...";
    for (let i = 1; i < arr.length; i++) {
      let key = arr[i];
      let j = i - 1;

      // Highlight the current key bar
      setBarColors(i, "current");
      message.textContent = `Considering element ${key} at index ${i}`;

      while (j >= 0 && arr[j] > key) {
        setBarColors(j, "compare");

        message.textContent = `Compare ${arr[j]} (index ${j}) > ${key}`;
        await sleep(700);

        arr[j + 1] = arr[j];
        updateBarHeight(j + 1, arr[j]);
        setBarColors(j + 1, "highlight");
        message.textContent = `Shift ${arr[j]} from index ${j} to index ${j + 1}`;
        await sleep(700);

        resetBarColors(j + 1);
        resetBarColors(j);
        j = j - 1;
      }

      arr[j + 1] = key;
      updateBarHeight(j + 1, key);

      resetAllBarColors();
      message.textContent = `Inserted ${key} at position ${j + 1}`;
      await sleep(800);
    }
    message.textContent = "Array sorted!";
    sorting = false;
    startBtn.disabled = false;
    resetBtn.disabled = false;
  }

  function setBarColors(index, type) {
    if (bars[index]) {
      bars[index].classList.add(type);
    }
  }

  function resetBarColors(index) {
    if (bars[index]) {
      bars[index].classList.remove("current", "compare", "highlight");
    }
  }

  function resetAllBarColors() {
    bars.forEach((bar) => {
      bar.classList.remove("current", "compare", "highlight");
    });
  }

  function updateBarHeight(index, value) {
    const maxVal = Math.max(...array);
    const scaleFactor = 300 / maxVal;
    if (bars[index]) {
      bars[index].style.height = `${value * scaleFactor}px`;
      bars[index].textContent = value;
    }
  }

  function validateInput(input) {
    const parts = input.split(",").map((s) => s.trim());
    if (parts.length === 0) return null;

    const nums = [];
    for (const p of parts) {
      if (!p.match(/^-?\d+$/)) return null;
      nums.push(parseInt(p, 10));
    }
    return nums;
  }

  function reset() {
    sorting = false;
    message.textContent = "";
    array = [];
    bars = [];
    arrayContainer.innerHTML = "";
    arrayInput.disabled = false;
    startBtn.disabled = false;
    resetBtn.disabled = true;
  }

  startBtn.addEventListener("click", () => {
    const userInput = arrayInput.value.trim();
    if (!userInput) {
      alert("Please enter a comma-separated list of numbers.");
      return;
    }
    const nums = validateInput(userInput);
    if (!nums || nums.length === 0) {
      alert("Invalid input. Please enter only integers separated by commas.");
      return;
    }
    array = nums;
    createBars(array);
    sorting = true;
    startBtn.disabled = true;
    resetBtn.disabled = true;
    arrayInput.disabled = true;
    insertionSort(array).then(() => {
      resetBtn.disabled = false;
      arrayInput.disabled = false;
    });
  });

  resetBtn.addEventListener("click", () => {
    reset();
  });
})();
</script>
</body>
</html>