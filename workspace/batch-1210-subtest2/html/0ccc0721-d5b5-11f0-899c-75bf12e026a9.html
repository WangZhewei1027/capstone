<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Merge Sort Visualization</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #fafafa;
    color: #333;
  }
  h1 {
    text-align: center;
  }
  #inputArea {
    text-align: center;
    margin-bottom: 20px;
  }
  #arrayInput {
    width: 300px;
    padding: 8px;
    font-size: 16px;
  }
  #sortBtn {
    padding: 8px 16px;
    font-size: 16px;
    margin-left: 10px;
    cursor: pointer;
  }
  #visualization {
    display: flex;
    justify-content: center;
    align-items: flex-end;
    height: 300px;
    max-width: 90vw;
    margin: 0 auto 30px;
    border: 1px solid #ddd;
    background: #fff;
    padding: 10px;
    box-sizing: border-box;
  }
  .bar {
    margin: 0 2px;
    background-color: #4a90e2;
    width: 20px;
    transition: all 0.4s ease;
    border-radius: 3px 3px 0 0;
  }
  .bar.compare {
    background-color: #f39c12;
  }
  .bar.merge {
    background-color: #27ae60;
  }
  .bar.sorted {
    background-color: #2ecc71;
  }
  #codeArea {
    max-width: 90vw;
    margin: 0 auto;
    background: #2d2d2d;
    color: #ccc;
    padding: 15px;
    border-radius: 8px;
    font-family: Consolas, monospace;
    white-space: pre-wrap;
    line-height: 1.5;
  }
  #status {
    max-width: 90vw;
    margin: 10px auto;
    text-align: center;
    font-size: 18px;
    min-height: 24px;
    color: #636363;
  }
  #legend {
    max-width: 90vw;
    margin: 10px auto 40px;
    display: flex;
    justify-content: center;
    gap: 20px;
    font-size: 14px;
    color: #555;
  }
  .legend-box {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .color-box {
    width: 18px;
    height: 18px;
    border-radius: 3px;
  }
  .color-compare { background-color: #f39c12; }
  .color-merge { background-color: #27ae60; }
  .color-sorted { background-color: #2ecc71; }
</style>
</head>
<body>
<h1>Merge Sort Visualization</h1>

<div id="inputArea">
  <input type="text" id="arrayInput" placeholder="Enter numbers separated by commas" value="38,27,43,3,9,82,10" />
  <button id="sortBtn">Sort</button>
</div>

<div id="visualization"></div>

<div id="status"></div>

<div id="legend">
  <div class="legend-box"><div class="color-box color-compare"></div> Comparing</div>
  <div class="legend-box"><div class="color-box color-merge"></div> Merging</div>
  <div class="legend-box"><div class="color-box color-sorted"></div> Sorted</div>
</div>

<div id="codeArea">
// Merge Sort Algorithm - JavaScript

function mergeSort(arr) {
    if (arr.length <= 1) {
        return arr;
    }
    const mid = Math.floor(arr.length / 2);
    const left = mergeSort(arr.slice(0, mid));
    const right = mergeSort(arr.slice(mid));
    return merge(left, right);
}

function merge(left, right) {
    let result = [];
    let i = 0, j = 0;
    while(i < left.length && j < right.length) {
        if (left[i] < right[j]) {
            result.push(left[i]);
            i++;
        } else {
            result.push(right[j]);
            j++;
        }
    }
    return result.concat(left.slice(i)).concat(right.slice(j));
}
</div>

<script>
(() => {
  const input = document.getElementById('arrayInput');
  const btn = document.getElementById('sortBtn');
  const visualization = document.getElementById('visualization');
  const status = document.getElementById('status');

  let array = [];

  const delay = ms => new Promise(res => setTimeout(res, ms));

  function createBars(arr) {
    visualization.innerHTML = '';
    // normalize bar heights for display
    const maxVal = Math.max(...arr);
    arr.forEach(value => {
      const bar = document.createElement('div');
      bar.classList.add('bar');
      // height relative to maxVal, min height 10px for visibility
      const height = (value / maxVal) * 250 + 10;
      bar.style.height = height + 'px';
      bar.title = value;
      bar.dataset.value = value;
      visualization.appendChild(bar);
    });
  }

  async function mergeSortVisual(arr, leftIndex=0) {
    // Base case
    if(arr.length <= 1) {
      return arr;
    }
    const mid = Math.floor(arr.length / 2);

    // Recursive calls for left and right halves
    status.textContent = `Splitting array at index ${mid} (length: ${arr.length})`;
    let left = await mergeSortVisual(arr.slice(0, mid), leftIndex);
    let right = await mergeSortVisual(arr.slice(mid), leftIndex + mid);

    // Merge the sorted halves
    let merged = [];
    let i = 0, j = 0;

    while(i < left.length && j < right.length) {
      // Highlight bars being compared
      highlightBars(leftIndex + i, rightIndex = leftIndex + mid + j, 'compare');
      status.textContent = `Comparing ${left[i]} and ${right[j]}`;
      await delay(600);

      if(left[i] < right[j]) {
        merged.push(left[i]);
        i++;
      } else {
        merged.push(right[j]);
        j++;
      }
      clearHighlights();
      highlightRange(leftIndex, leftIndex + merged.length - 1, 'merge');
      updateArrayDisplay(globalArray, leftIndex, merged, i, j);
      await delay(600);
    }

    // Remaining left elements
    while(i < left.length) {
      merged.push(left[i]);
      highlightRange(leftIndex + i, leftIndex + i, 'merge');
      status.textContent = `Appending remaining left element: ${left[i]}`;
      updateArrayDisplay(globalArray, leftIndex, merged, i + 1, j);
      i++;
      await delay(400);
    }

    // Remaining right elements
    while(j < right.length) {
      merged.push(right[j]);
      highlightRange(leftIndex + merged.length - 1, leftIndex + merged.length - 1, 'merge');
      status.textContent = `Appending remaining right element: ${right[j]}`;
      updateArrayDisplay(globalArray, leftIndex, merged, i, j+1);
      j++;
      await delay(400);
    }

    // Set global array's relevant part to merged result
    for(let k = 0; k < merged.length; k++) {
      globalArray[leftIndex + k] = merged[k];
    }
    updateBars(globalArray);

    // Mark merged section as sorted
    highlightRange(leftIndex, leftIndex + merged.length - 1, 'sorted');
    status.textContent = `Merged: [${merged.join(', ')}]`;
    await delay(700);

    clearHighlights();
    return merged;
  }

  // Highlight two bars by indices with a class
  function highlightBars(i1, i2, className) {
    const bars = visualization.children;
    if(bars[i1]) bars[i1].classList.add(className);
    if(bars[i2]) bars[i2].classList.add(className);
  }

  // Highlight a range of bars by class
  function highlightRange(start, end, className) {
    clearHighlights();
    const bars = visualization.children;
    for(let i = start; i <= end; i++) {
      if(bars[i]) bars[i].classList.add(className);
    }
  }

  // Remove all highlight classes
  function clearHighlights() {
    Array.from(visualization.children).forEach(bar => {
      bar.classList.remove('compare', 'merge', 'sorted');
    });
  }

  // Update the visual bars with globalArray values
  function updateBars(arr) {
    const bars = visualization.children;
    const maxVal = Math.max(...arr);
    for(let i = 0; i < arr.length; i++) {
      const height = (arr[i] / maxVal) * 250 + 10;
      bars[i].style.height = height + 'px';
      bars[i].title = arr[i];
      bars[i].dataset.value = arr[i];
    }
  }

  // Update the global array displayed in bars during merge step (for smooth transitions)
  function updateArrayDisplay(globalArr, startIndex, mergedPart, leftDone, rightDone) {
    // This function updates the bars for the section being merged to show partial merged progress.
    // We update the bars from startIndex up to startIndex+mergedPart.length with mergedPart values
    // Bars outside merged section remain unchanged.
    const bars = visualization.children;
    const maxVal = Math.max(...globalArr);
    for(let i = 0; i < mergedPart.length; i++) {
      const idx = startIndex + i;
      if(bars[idx]) {
        const height = (mergedPart[i] / maxVal) * 250 + 10;
        bars[idx].style.height = height + 'px';
        bars[idx].title = mergedPart[i];
        bars[idx].dataset.value = mergedPart[i];
        bars[idx].classList.add('merge');
      }
    }
  }

  let globalArray = [];

  btn.addEventListener('click', async () => {
    let values = input.value.split(',').map(s => s.trim()).filter(s => s !== '').map(Number);
    if(values.length === 0 || values.some(v => isNaN(v))) {
      alert('Please enter a valid list of numbers separated by commas.');
      return;
    }

    globalArray = values.slice();
    createBars(globalArray);
    status.textContent = 'Starting merge sort...';
    btn.disabled = true;
    input.disabled = true;

    await mergeSortVisual(globalArray);

    status.textContent = 'Array sorted!';
    btn.disabled = false;
    input.disabled = false;

    highlightRange(0, globalArray.length - 1, 'sorted');
  });

  // Initialize the display with default input
  (() => {
    globalArray = input.value.split(',').map(s => s.trim()).filter(s => s !== '').map(Number);
    if(globalArray.length && !globalArray.some(isNaN)) {
      createBars(globalArray);
    }
  })();

})();
</script>

</body>
</html>