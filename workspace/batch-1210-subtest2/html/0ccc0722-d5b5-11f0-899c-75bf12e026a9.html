<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Quick Sort Visualization</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 30px;
    background: #f5f7fa;
    color: #333;
  }
  h1 {
    text-align: center;
  }
  #inputArea {
    margin-bottom: 20px;
    text-align: center;
  }
  input[type="text"] {
    width: 300px;
    padding: 8px;
    font-size: 16px;
  }
  button {
    padding: 8px 16px;
    font-size: 16px;
    margin-left: 10px;
    cursor: pointer;
  }
  #arrayContainer {
    margin-top: 25px;
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 8px;
    min-height: 60px;
  }
  .bar {
    background-color: #4a90e2;
    color: #fff;
    font-weight: bold;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 40px;
    width: 40px;
    border-radius: 4px;
    user-select: none;
    transition: background-color 0.3s ease;
  }
  .bar.pivot {
    background-color: #e94e77;
  }
  .bar.comparing {
    background-color: #f5a623;
  }
  .bar.swapping {
    background-color: #7ed6df;
  }
  #steps {
    margin-top: 30px;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
    font-family: monospace;
    white-space: pre-wrap;
    background: #222;
    color: #ddd;
    padding: 15px;
    border-radius: 8px;
    min-height: 150px;
    overflow-y: auto;
  }
</style>
</head>
<body>
<h1>Quick Sort Visualization</h1>
<div id="inputArea">
  <input type="text" id="inputArray" placeholder="Enter numbers separated by commas" value="8,3,7,4,9,2,6,5" />
  <button id="sortButton">Sort</button>
</div>
<div id="arrayContainer"></div>
<div id="steps"></div>

<script>
  const inputArray = document.getElementById('inputArray');
  const sortButton = document.getElementById('sortButton');
  const arrayContainer = document.getElementById('arrayContainer');
  const steps = document.getElementById('steps');

  // Utility: pause function for animation delays
  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  // Render array bars
  function renderArray(arr, highlight = {}) {
    // highlight = {pivot: index, comparing: [i,j], swapping: [i,j]}
    arrayContainer.innerHTML = '';
    arr.forEach((value, idx) => {
      const bar = document.createElement('div');
      bar.classList.add('bar');
      bar.textContent = value;

      if (highlight.pivot === idx) {
        bar.classList.add('pivot');
      }
      if (highlight.comparing && highlight.comparing.includes(idx)) {
        bar.classList.add('comparing');
      }
      if (highlight.swapping && highlight.swapping.includes(idx)) {
        bar.classList.add('swapping');
      }

      arrayContainer.appendChild(bar);
    });
  }

  // Append step text
  function logStep(text) {
    steps.textContent += text + '\n';
    steps.scrollTop = steps.scrollHeight;
  }

  // Quick Sort with visualization
  async function quickSort(arr, left = 0, right = arr.length -1) {
    if (left >= right) return;

    logStep(`QuickSort called on arr[${left}...${right}]: [${arr.slice(left, right+1).join(', ')}]`);
    let pivotIndex = right;
    let pivotValue = arr[pivotIndex];

    logStep(`Choosing pivot arr[${pivotIndex}] = ${pivotValue}`);
    renderArray(arr, {pivot: pivotIndex});
    await sleep(800);

    let storeIndex = left;
    for (let i = left; i < right; i++) {
      logStep(`Comparing arr[${i}] = ${arr[i]} with pivot ${pivotValue}`);
      renderArray(arr, {pivot: pivotIndex, comparing: [i]});
      await sleep(600);

      if (arr[i] < pivotValue) {
        logStep(`Since ${arr[i]} < ${pivotValue}, swapping arr[${i}] and arr[${storeIndex}]`);
        renderArray(arr, {pivot: pivotIndex, swapping: [i, storeIndex]});
        await sleep(800);

        [arr[i], arr[storeIndex]] = [arr[storeIndex], arr[i]];

        renderArray(arr, {pivot: pivotIndex});
        await sleep(500);

        storeIndex++;
      } else {
        logStep(`${arr[i]} >= ${pivotValue}, no swap`);
      }
    }

    // Place pivot in its final place
    logStep(`Swapping pivot arr[${pivotIndex}] and arr[${storeIndex}] to put pivot in place`);
    renderArray(arr, {pivot: pivotIndex, swapping: [pivotIndex, storeIndex]});
    await sleep(800);

    [arr[storeIndex], arr[pivotIndex]] = [arr[pivotIndex], arr[storeIndex]];
    renderArray(arr);
    await sleep(600);

    logStep(`Pivot is now at index ${storeIndex}\n`);

    // Recurse on left and right partitions
    await quickSort(arr, left, storeIndex - 1);
    await quickSort(arr, storeIndex + 1, right);
  }

  sortButton.addEventListener('click', async () => {
    let rawInput = inputArray.value.trim();
    if (!rawInput) {
      alert('Please enter some numbers separated by commas.');
      return;
    }

    // Parse input into array of numbers
    let arr = rawInput.split(',').map(x => x.trim()).filter(x => x !== '').map(Number);
    if (arr.some(isNaN)) {
      alert('Invalid input detected. Please enter only numbers separated by commas.');
      return;
    }

    steps.textContent = '';
    renderArray(arr);
    logStep('Starting Quick Sort...\n');
    sortButton.disabled = true;
    inputArray.disabled = true;

    await quickSort(arr);

    logStep('Array sorted: [' + arr.join(', ') + ']');
    sortButton.disabled = false;
    inputArray.disabled = false;
  });

  // Initial render
  renderArray([8,3,7,4,9,2,6,5]);
</script>
</body>
</html>