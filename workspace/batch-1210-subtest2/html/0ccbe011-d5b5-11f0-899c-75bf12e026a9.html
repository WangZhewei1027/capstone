<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bubble Sort Demonstration</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f0f0f0;
  }
  h1 {
    text-align: center;
  }
  #inputArea {
    margin-bottom: 10px;
    text-align: center;
  }
  input[type="text"] {
    width: 300px;
    font-size: 1.1em;
    padding: 5px;
  }
  button {
    padding: 6px 15px;
    font-size: 1em;
    margin-left: 10px;
    cursor: pointer;
  }
  #output {
    background: white;
    border-radius: 5px;
    padding: 15px;
    min-height: 150px;
    max-width: 600px;
    margin: 0 auto;
    box-shadow: 0 0 10px #ccc;
    font-family: monospace;
    white-space: pre-wrap;
  }
  .array-row {
    margin: 5px 0;
  }
  .highlight {
    font-weight: bold;
    color: #d33;
  }
  .sorted {
    color: #277a0f;
    font-weight: bold;
  }
  #speedControl {
    margin-top: 15px;
    text-align: center;
  }
  label {
    font-weight: bold;
  }
</style>
</head>
<body>
<h1>Bubble Sort Visualization</h1>
<div id="inputArea">
  <input type="text" id="arrayInput" placeholder="Enter numbers separated by commas" value="5,3,8,4,2" />
  <button id="startBtn">Start Sorting</button>
</div>
<div id="speedControl">
  <label for="speedRange">Animation Speed (ms per step): </label>
  <input type="range" id="speedRange" min="100" max="2000" value="500" step="100" />
  <span id="speedValue">500</span> ms
</div>
<div id="output" aria-live="polite" aria-atomic="true"></div>

<script>
(() => {
  const input = document.getElementById('arrayInput');
  const startBtn = document.getElementById('startBtn');
  const output = document.getElementById('output');
  const speedRange = document.getElementById('speedRange');
  const speedValue = document.getElementById('speedValue');

  let animationSpeed = parseInt(speedRange.value, 10);
  speedValue.textContent = animationSpeed;

  speedRange.addEventListener('input', () => {
    animationSpeed = parseInt(speedRange.value, 10);
    speedValue.textContent = animationSpeed;
  });
  
  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  // Helper to format array display, highlight indices i and j if given
  function formatArray(arr, i = -1, j = -1, sortedBoundary = arr.length) {
    return arr
      .map((v, idx) => {
        let cls = '';
        if (idx >= sortedBoundary) cls = 'sorted';
        if (idx === i || idx === j) cls = 'highlight';
        return `<span class="${cls}">${v}</span>`;
      })
      .join(', ');
  }

  async function bubbleSortVisualizer(arr) {
    output.innerHTML = "Starting Bubble Sort on:<br>" + formatArray(arr) + "\n\n";
    const n = arr.length;
    for (let i = 0; i < n - 1; i++) {
      output.innerHTML += `Pass ${i + 1}:\n`;
      let swapped = false;
      for (let j = 0; j < n - 1 - i; j++) {
        output.innerHTML += `Comparing indices ${j} and ${j + 1}: `;
        // Show array with highlight on j and j+1 and sorted part distinguished
        output.innerHTML += formatArray(arr, j, j + 1, n - i) + "\n";
        await sleep(animationSpeed);

        if (arr[j] > arr[j + 1]) {
          output.innerHTML += `Swap ${arr[j]} and ${arr[j + 1]}.\n`;
          // Swap
          [arr[j], arr[j + 1]] = [arr[j + 1], arr[j]];
          swapped = true;
          output.innerHTML += formatArray(arr, j, j + 1, n - i) + "\n";
          await sleep(animationSpeed);
        } else {
          output.innerHTML += `No swap needed.\n`;
          await sleep(animationSpeed/2);
        }
      }
      output.innerHTML += `End of pass ${i + 1}, element at index ${n - 1 - i} is sorted.\n\n`;
      // Show array with sorted portion marked
      output.innerHTML += `Current array state:<br>` + formatArray(arr, -1, -1, n - i - 1) + "\n\n";
      if (!swapped) {
        output.innerHTML += "No swaps done in this pass, array is sorted early.\n";
        break;
      }
    }
    // All sorted indication
    output.innerHTML += "Sorting complete!\nFinal sorted array:<br>" + formatArray(arr, -1, -1, 0) + "\n";
  }

  function parseInput(text) {
    let parts = text.split(',');
    let numArr = parts.map(v => v.trim()).filter(v => v.length > 0).map(Number);
    if (numArr.some(isNaN)) return null;
    return numArr;
  }

  startBtn.addEventListener('click', async () => {
    startBtn.disabled = true;
    input.disabled = true;
    speedRange.disabled = true;
    output.innerHTML = "";
    let arr = parseInput(input.value);
    if (!arr || arr.length === 0) {
      output.textContent = "Invalid input. Please enter a comma separated list of numbers.";
      startBtn.disabled = false;
      input.disabled = false;
      speedRange.disabled = false;
      return;
    }
    await bubbleSortVisualizer(arr);
    startBtn.disabled = false;
    input.disabled = false;
    speedRange.disabled = false;
  });
})();
</script>
</body>
</html>