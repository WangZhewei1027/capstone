<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bubble Sort Visualizer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent: #60a5fa;
      --accent-2: #34d399;
      --danger: #f87171;
      --warn: #f59e0b;
      --bar: #60a5fa;
      --bar-compare: #f59e0b;
      --bar-swap: #f43f5e;
      --bar-sorted: #34d399;
      --btn: #1f2937;
      --btn-border: #374151;
      --code-bg: #0b1220;
      --code-active: #1e293b;
      --focus: #7dd3fc;
    }
    * { box-sizing: border-box; }
    html, body { margin: 0; height: 100%; }
    body {
      background: radial-gradient(1200px 600px at 80% -10%, rgba(96,165,250,0.18), transparent 70%) no-repeat,
                  radial-gradient(1000px 700px at -20% 30%, rgba(52,211,153,0.12), transparent 60%) no-repeat,
                  linear-gradient(180deg, #0b1023, #0f172a 30% 70%, #0b1023);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      line-height: 1.45;
      padding: 24px;
    }
    header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 16px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }
    h1 {
      margin: 0;
      font-size: 28px;
      letter-spacing: 0.2px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .badge {
      font-size: 12px;
      color: var(--muted);
      border: 1px solid var(--btn-border);
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(255,255,255,0.02);
    }

    .container {
      display: grid;
      grid-template-columns: 1.5fr 1fr;
      gap: 16px;
      align-items: start;
    }
    @media (max-width: 1000px) {
      .container {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      border: 1px solid rgba(148,163,184,0.15);
      border-radius: 14px;
      padding: 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25), inset 0 1px 0 rgba(255,255,255,0.03);
    }

    .controls {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin-bottom: 10px;
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px 14px;
      align-items: center;
    }
    .row > .group {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--btn-border);
      padding: 10px;
      border-radius: 10px;
    }
    .group label {
      font-size: 12px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    input[type="range"] {
      appearance: none;
      height: 4px;
      background: #1f2937;
      border-radius: 999px;
      outline: none;
      width: 180px;
    }
    input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      width: 16px; height: 16px;
      background: linear-gradient(180deg, #93c5fd, #60a5fa);
      border-radius: 50%;
      border: 1px solid rgba(255,255,255,0.4);
      box-shadow: 0 2px 6px rgba(96,165,250,0.35);
    }
    .val {
      min-width: 36px;
      text-align: right;
      font-variant-numeric: tabular-nums;
      color: var(--text);
    }
    .btn {
      background: linear-gradient(180deg, #0f172a, #0b1220);
      color: var(--text);
      border: 1px solid var(--btn-border);
      padding: 10px 12px;
      border-radius: 10px;
      cursor: pointer;
      user-select: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: transform 0.05s ease, background 0.2s ease, border-color 0.2s ease;
    }
    .btn:hover { border-color: #4b5563; }
    .btn:active { transform: translateY(1px); }
    .btn.primary {
      background: linear-gradient(180deg, #1e293b, #0f172a);
      border-color: #334155;
    }
    .btn.soft {
      background: rgba(96,165,250,0.1);
      border-color: rgba(96,165,250,0.4);
    }
    .btn.warn {
      background: rgba(245,158,11,0.1);
      border-color: rgba(245,158,11,0.4);
    }
    .btn.danger {
      background: rgba(244,63,94,0.08);
      border-color: rgba(244,63,94,0.35);
    }
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .spacer { flex: 1; }

    .toggle {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid var(--btn-border);
      background: rgba(255,255,255,0.02);
      cursor: pointer;
      user-select: none;
    }
    .toggle input { accent-color: var(--accent); width: 16px; height: 16px; }

    .stats {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .stat {
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--btn-border);
      border-radius: 10px;
      padding: 10px 12px;
      min-width: 110px;
    }
    .stat .k { font-size: 11px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; }
    .stat .v { font-size: 18px; font-variant-numeric: tabular-nums; }

    .viz {
      height: 360px;
      border-radius: 14px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border: 1px solid rgba(148,163,184,0.15);
      padding: 14px;
      display: flex;
      align-items: end;
      overflow: hidden;
      position: relative;
    }
    .bars {
      position: absolute;
      inset: 14px;
      display: flex;
      align-items: end;
      gap: 2px;
    }
    .bar {
      flex: 1 1 0;
      height: 10px;
      background: linear-gradient(180deg, #93c5fd, #60a5fa);
      border-radius: 4px 4px 0 0;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.5);
      transition: height 140ms ease, background 120ms ease, transform 120ms ease, opacity 120ms ease;
      position: relative;
    }
    .bar::after {
      content: attr(data-val);
      position: absolute;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 10px;
      color: var(--muted);
      opacity: 0.0;
      transition: opacity 0.2s ease;
      pointer-events: none;
    }
    .viz:hover .bar::after {
      opacity: 0.85;
    }
    .bar.comparing {
      background: linear-gradient(180deg, #fcd34d, #f59e0b);
      box-shadow: 0 0 0 1px rgba(245,158,11,0.3), inset 0 1px 0 rgba(255,255,255,0.4);
    }
    .bar.swapping {
      background: linear-gradient(180deg, #fb7185, #f43f5e);
      box-shadow: 0 0 0 1px rgba(244,63,94,0.35), inset 0 1px 0 rgba(255,255,255,0.4);
      transform: translateY(-2px);
    }
    .bar.sorted {
      background: linear-gradient(180deg, #6ee7b7, #34d399);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.5);
      opacity: 0.95;
    }

    .legend {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 8px;
    }
    .legend .dot {
      width: 14px; height: 14px; border-radius: 3px;
      border: 1px solid rgba(148,163,184,0.35);
    }
    .legend .dot.compare { background: linear-gradient(180deg, #fcd34d, #f59e0b); }
    .legend .dot.swap { background: linear-gradient(180deg, #fb7185, #f43f5e); }
    .legend .dot.sorted { background: linear-gradient(180deg, #6ee7b7, #34d399); }
    .legend span { color: var(--muted); font-size: 12px; }

    .code {
      background: var(--code-bg);
      border-radius: 12px;
      border: 1px solid rgba(148,163,184,0.18);
      overflow: hidden;
    }
    .code header {
      padding: 10px 12px;
      border-bottom: 1px solid rgba(148,163,184,0.18);
      display: flex;
      align-items: baseline;
      justify-content: space-between;
    }
    .code header .title { font-size: 14px; color: var(--muted); }
    .code pre {
      margin: 0; padding: 12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 13px;
      color: #d1d5db;
      white-space: pre;
    }
    .line { padding: 4px 8px; border-left: 3px solid transparent; }
    .line .ln { color: #64748b; width: 24px; display: inline-block; }
    .line.active {
      background: var(--code-active);
      border-left-color: var(--accent);
      color: #e5e7eb;
    }
    .desc {
      font-size: 14px;
      color: var(--muted);
      margin-top: 10px;
    }
    .input-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: stretch;
    }
    .input-row input[type="text"] {
      flex: 1 1 240px;
      min-width: 150px;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--btn-border);
      background: rgba(255,255,255,0.02);
      color: var(--text);
      outline: none;
    }
    .input-row input[type="text"]:focus {
      border-color: var(--focus);
      box-shadow: 0 0 0 3px rgba(125, 211, 252, 0.15);
    }
    .hint { color: var(--muted); font-size: 12px; }
    .footer-note {
      margin-top: 8px;
      color: var(--muted);
      font-size: 12px;
    }
  </style>
</head>
<body>
  <header>
    <h1>
      Bubble Sort Visualizer
      <span class="badge">Adjacent swaps • Stable • O(n^2)</span>
    </h1>
  </header>

  <div class="container">
    <section class="panel">
      <div class="controls">
        <div class="row">
          <div class="group">
            <label>Size</label>
            <input id="size" type="range" min="5" max="120" value="30" />
            <div id="sizeVal" class="val">30</div>
          </div>
          <div class="group">
            <label>Speed (ms/step)</label>
            <input id="speed" type="range" min="20" max="1200" value="200" />
            <div id="speedVal" class="val">200</div>
          </div>
          <label class="toggle" title="Stop early if a pass makes no swaps">
            <input id="opt" type="checkbox" checked />
            Early exit optimization
          </label>
          <div class="spacer"></div>
          <button id="shuffle" class="btn soft" title="Generate a new random array">
            Randomize
          </button>
          <button id="start" class="btn primary">
            Start
          </button>
          <button id="pause" class="btn warn" disabled>
            Pause
          </button>
          <button id="step" class="btn" title="Advance one algorithm step">
            Step
          </button>
          <button id="reset" class="btn danger" title="Restore the initial array">
            Reset
          </button>
        </div>

        <div class="row">
          - Custom values (comma-separated):
        </div>
        <div class="input-row">
          <input id="custom" type="text" placeholder="Example: 5, 1, 4, 2, 8" />
          <button id="applyCustom" class="btn">Apply</button>
          <span class="hint">Values are normalized and scaled to bar heights. Up to 200 numbers.</span>
        </div>

        <div class="stats">
          <div class="stat">
            <div class="k">Comparisons</div>
            <div id="cmp" class="v">0</div>
          </div>
          <div class="stat">
            <div class="k">Swaps</div>
            <div id="swp" class="v">0</div>
          </div>
          <div class="stat">
            <div class="k">Passes</div>
            <div id="pas" class="v">0</div>
          </div>
          <div class="stat">
            <div class="k">Status</div>
            <div id="status" class="v">Ready</div>
          </div>
        </div>
      </div>

      <div class="viz">
        <div id="bars" class="bars" aria-label="Bars visualization"></div>
      </div>
      <div class="legend">
        <span class="dot compare"></span><span>Compare</span>
        <span class="dot swap"></span><span>Swap</span>
        <span class="dot sorted"></span><span>Sorted</span>
      </div>
      <div class="desc">
        Bubble sort repeatedly steps through the list, compares adjacent elements and swaps them if they are in the wrong order. After each pass, the largest remaining element “bubbles” to its final position at the end.
      </div>
      <div class="footer-note">
        Tip: Use Step to advance one comparison/swap at a time, or Start/Pause to animate. Early exit stops when a full pass makes no swaps.
      </div>
    </section>

    <section class="panel code">
      <header>
        <div class="title">Bubble Sort pseudocode</div>
      </header>
      <pre id="code">
<span class="line" data-ln="1"><span class="ln">1</span> for i from 0 to n - 2:</span>
<span class="line" data-ln="2"><span class="ln">2</span>   swapped = false</span>
<span class="line" data-ln="3"><span class="ln">3</span>   for j from 0 to n - 2 - i:</span>
<span class="line" data-ln="4"><span class="ln">4</span>     if a[j] > a[j + 1]:</span>
<span class="line" data-ln="5"><span class="ln">5</span>       swap(a[j], a[j + 1]); swapped = true</span>
<span class="line" data-ln="6"><span class="ln">6</span>   if not swapped: break  // early exit</span>
      </pre>
    </section>
  </div>

  <script>
    // State
    let arr = [];
    let initialArr = [];
    let maxVal = 100;
    let generator = null;
    let running = false;
    let speed = 200;
    let stats = { cmp: 0, swp: 0, pas: 0 };
    let sortedUntil = null; // track last sorted index from end
    let lastCompared = null;

    // Elements
    const barsEl = document.getElementById('bars');
    const sizeEl = document.getElementById('size');
    const speedEl = document.getElementById('speed');
    const sizeValEl = document.getElementById('sizeVal');
    const speedValEl = document.getElementById('speedVal');
    const optEl = document.getElementById('opt');
    const shuffleBtn = document.getElementById('shuffle');
    const startBtn = document.getElementById('start');
    const pauseBtn = document.getElementById('pause');
    const stepBtn = document.getElementById('step');
    const resetBtn = document.getElementById('reset');
    const cmpEl = document.getElementById('cmp');
    const swpEl = document.getElementById('swp');
    const pasEl = document.getElementById('pas');
    const statusEl = document.getElementById('status');
    const customEl = document.getElementById('custom');
    const applyCustomBtn = document.getElementById('applyCustom');

    const codeEl = document.getElementById('code');
    const codeLines = [...codeEl.querySelectorAll('.line')];

    function randInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }
    function sleep(ms) { return new Promise(res => setTimeout(res, ms)); }

    function setStatus(text) { statusEl.textContent = text; }

    function resetStats() {
      stats = { cmp: 0, swp: 0, pas: 0 };
      cmpEl.textContent = '0';
      swpEl.textContent = '0';
      pasEl.textContent = '0';
    }

    function highlightLines(lines) {
      codeLines.forEach(l => l.classList.remove('active'));
      if (!lines) return;
      lines.forEach(ln => {
        const el = codeEl.querySelector(`.line[data-ln="${ln}"]`);
        if (el) el.classList.add('active');
      });
    }

    function generateRandom(size) {
      const out = new Array(size).fill(0).map(() => randInt(5, 100));
      return out;
    }

    function cloneArray(a) { return a.slice(); }

    function computeMaxVal(a) {
      const m = Math.max(...a);
      return Math.max(m, 1);
    }

    function renderBars() {
      barsEl.innerHTML = '';
      const n = arr.length;
      for (let i = 0; i < n; i++) {
        const bar = document.createElement('div');
        bar.className = 'bar';
        bar.style.height = `${Math.round((arr[i] / maxVal) * 100)}%`;
        bar.dataset.val = arr[i];
        bar.title = String(arr[i]);
        barsEl.appendChild(bar);
      }
    }

    function updateBar(i) {
      const bar = barsEl.children[i];
      if (!bar) return;
      bar.style.height = `${Math.round((arr[i] / maxVal) * 100)}%`;
      bar.dataset.val = arr[i];
      bar.title = String(arr[i]);
    }

    function clearHighlights() {
      [...barsEl.children].forEach(b => {
        b.classList.remove('comparing', 'swapping');
      });
    }

    function clearSortedMarks() {
      [...barsEl.children].forEach(b => b.classList.remove('sorted'));
      sortedUntil = null;
    }

    function markSortedIndex(index) {
      const bar = barsEl.children[index];
      if (bar) bar.classList.add('sorted');
    }

    function markAllSorted() {
      [...barsEl.children].forEach(b => {
        b.classList.remove('comparing', 'swapping');
        b.classList.add('sorted');
      });
    }

    function disableDuringRun(disabled) {
      sizeEl.disabled = disabled;
      customEl.disabled = disabled;
      applyCustomBtn.disabled = disabled;
      shuffleBtn.disabled = disabled;
    }

    function newGenerator() {
      generator = bubbleSort(arr, optEl.checked);
    }

    function* bubbleSort(a, earlyExit) {
      const n = a.length;
      if (n <= 1) { yield { type: 'done' }; return; }
      for (let i = 0; i < n - 1; i++) {
        let swapped = false;
        yield { type: 'outer', i };
        for (let j = 0; j < n - 1 - i; j++) {
          yield { type: 'inner', i, j };
          yield { type: 'compare', j, j1: j + 1, i };
          if (a[j] > a[j + 1]) {
            const tmp = a[j]; a[j] = a[j + 1]; a[j + 1] = tmp;
            swapped = true;
            yield { type: 'swap', j, j1: j + 1, i };
          }
        }
        yield { type: 'pass-end', i, swapped };
        if (earlyExit && !swapped) {
          yield { type: 'no-swap-break', i };
          break;
        }
      }
      yield { type: 'done' };
    }

    function updateStats(ev) {
      if (ev.type === 'compare') {
        stats.cmp++; cmpEl.textContent = String(stats.cmp);
      } else if (ev.type === 'swap') {
        stats.swp++; swpEl.textContent = String(stats.swp);
      } else if (ev.type === 'pass-end') {
        stats.pas++; pasEl.textContent = String(stats.pas);
      }
    }

    function highlightForEvent(ev) {
      switch (ev.type) {
        case 'outer': highlightLines([1,2]); break;
        case 'inner': highlightLines([3]); break;
        case 'compare': highlightLines([4]); break;
        case 'swap': highlightLines([5]); break;
        case 'pass-end':
        case 'no-swap-break': highlightLines([6]); break;
        case 'done': highlightLines([]); break;
        default: break;
      }
    }

    function handleEvent(ev) {
      updateStats(ev);
      highlightForEvent(ev);
      switch (ev.type) {
        case 'outer': {
          setStatus(`Pass ${ev.i + 1} / ${arr.length - 1}`);
          // could clear comparison highlights at new pass
          clearHighlights();
          break;
        }
        case 'inner': {
          // nothing visual here beyond code highlight
          break;
        }
        case 'compare': {
          clearHighlights();
          const b1 = barsEl.children[ev.j];
          const b2 = barsEl.children[ev.j1];
          if (b1 && b2) {
            b1.classList.add('comparing');
            b2.classList.add('comparing');
          }
          lastCompared = [ev.j, ev.j1];
          break;
        }
        case 'swap': {
          const b1 = barsEl.children[ev.j];
          const b2 = barsEl.children[ev.j1];
          if (b1 && b2) {
            b1.classList.remove('comparing');
            b2.classList.remove('comparing');
            b1.classList.add('swapping');
            b2.classList.add('swapping');
          }
          // update bar heights to reflect swap in arr
          updateBar(ev.j);
          updateBar(ev.j1);
          break;
        }
        case 'pass-end': {
          // mark the largest element bubbled to its final position
          const idx = arr.length - 1 - ev.i;
          markSortedIndex(idx);
          clearHighlights();
          if (!ev.swapped && optEl.checked) {
            setStatus('No swaps this pass: early exit');
          }
          break;
        }
        case 'no-swap-break': {
          // Mark all as sorted since array is sorted early
          markAllSorted();
          break;
        }
        case 'done': {
          setStatus('Sorted');
          // Make sure everything is marked sorted
          markAllSorted();
          break;
        }
      }
    }

    async function doOneStep() {
      if (!generator) newGenerator();
      const { value, done } = generator.next();
      if (done) {
        handleEvent({ type: 'done' }); // ensure UI shows done
        running = false;
        startBtn.textContent = 'Start';
        pauseBtn.disabled = true;
        disableDuringRun(false);
        return false;
      }
      handleEvent(value);
      return true;
    }

    async function run() {
      if (running) return;
      running = true;
      startBtn.textContent = 'Running...';
      pauseBtn.disabled = false;
      disableDuringRun(true);
      while (running) {
        const cont = await doOneStep();
        if (!cont) break;
        await sleep(speed);
      }
    }

    function pause() {
      running = false;
      pauseBtn.disabled = true;
      startBtn.textContent = 'Resume';
      disableDuringRun(false);
      setStatus('Paused');
    }

    function resetToInitial() {
      running = false;
      pauseBtn.disabled = true;
      startBtn.textContent = 'Start';
      disableDuringRun(false);
      arr = cloneArray(initialArr);
      maxVal = computeMaxVal(arr);
      resetStats();
      renderBars();
      clearSortedMarks();
      highlightLines([]);
      generator = null;
      setStatus('Reset');
    }

    function applyNewArray(newArr) {
      running = false;
      pauseBtn.disabled = true;
      startBtn.textContent = 'Start';
      disableDuringRun(false);
      arr = newArr.slice();
      initialArr = newArr.slice();
      maxVal = computeMaxVal(arr);
      resetStats();
      renderBars();
      clearSortedMarks();
      highlightLines([]);
      generator = null;
      setStatus('Ready');
    }

    function parseCustomInput(text) {
      if (!text) return null;
      // Split on commas, spaces, or semicolons
      const tokens = text.split(/[\s,;]+/).filter(Boolean);
      if (tokens.length === 0) return null;
      const nums = [];
      for (let i = 0; i < tokens.length && nums.length < 200; i++) {
        const v = Number(tokens[i]);
        if (!isFinite(v)) continue;
        nums.push(v);
      }
      if (nums.length === 0) return null;
      // Normalize: If numbers vary a lot, just keep their values; we scale by maxVal later
      return nums;
    }

    // Event bindings
    sizeEl.addEventListener('input', () => {
      sizeValEl.textContent = sizeEl.value;
    });
    sizeEl.addEventListener('change', () => {
      const size = Number(sizeEl.value);
      const a = generateRandom(size);
      applyNewArray(a);
    });

    speedEl.addEventListener('input', () => {
      speed = Number(speedEl.value);
      speedValEl.textContent = String(speed);
    });

    shuffleBtn.addEventListener('click', () => {
      const size = Number(sizeEl.value);
      applyNewArray(generateRandom(size));
    });

    startBtn.addEventListener('click', () => {
      run();
    });
    pauseBtn.addEventListener('click', () => {
      pause();
    });
    stepBtn.addEventListener('click', async () => {
      if (running) return; // prevent double stepping while running
      const cont = await doOneStep();
      if (cont) {
        setStatus('Stepped');
      }
    });
    resetBtn.addEventListener('click', () => {
      resetToInitial();
    });

    applyCustomBtn.addEventListener('click', () => {
      const parsed = parseCustomInput(customEl.value);
      if (!parsed) {
        setStatus('Invalid input');
        return;
      }
      sizeEl.value = String(parsed.length);
      sizeValEl.textContent = String(parsed.length);
      applyNewArray(parsed);
    });

    // Initialize
    (function init() {
      sizeValEl.textContent = sizeEl.value;
      speedValEl.textContent = speedEl.value;
      speed = Number(speedEl.value);
      const initial = generateRandom(Number(sizeEl.value));
      applyNewArray(initial);
    })();
  </script>
</body>
</html>