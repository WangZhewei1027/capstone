<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Divide and Conquer Explorer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f1420;
      --panel: #141a29;
      --accent: #4ea1ff;
      --accent2: #f865b0;
      --combine: #53d77a;
      --warn: #ffb54e;
      --text: #e8eefb;
      --muted: #9fb0c8;
      --bar: #2b3955;
      --barBorder: #3a4a72;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 15% 10%, #27324d 0%, var(--bg) 60%), var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      padding: 18px 24px;
      border-bottom: 1px solid #1f2840;
      background: linear-gradient(180deg, rgba(30,40,70,.6), rgba(20,26,41,.6));
      backdrop-filter: blur(6px);
      position: sticky; top: 0; z-index: 5;
    }
    header .title {
      font-weight: 700; font-size: 20px; letter-spacing: .3px;
    }
    header .subtitle {
      font-size: 13px; color: var(--muted);
    }
    .container {
      padding: 16px;
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 16px;
    }
    @media (max-width: 980px) {
      .container { grid-template-columns: 1fr; }
    }
    .panel {
      background: var(--panel);
      border: 1px solid #223052;
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 16px 40px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.04);
    }
    .panel h2 {
      font-size: 14px; margin: 4px 0 8px; color: var(--muted); font-weight: 600; text-transform: uppercase; letter-spacing: .15em;
    }
    .controls .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-bottom: 8px;
    }
    .controls label {
      font-size: 12px; color: var(--muted); margin-bottom: 4px; display: block;
    }
    select, input[type="number"], input[type="text"] {
      width: 100%; padding: 8px 10px; border-radius: 8px; border: 1px solid #2a3860;
      background: #101628; color: var(--text);
      outline: none;
    }
    .sliderWrap { display: grid; grid-template-columns: auto 1fr auto; align-items: center; gap: 8px; }
    input[type="range"] { width: 100%; }
    .btnRow {
      display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 8px;
    }
    button {
      border: 1px solid #2a3860;
      background: #101628;
      color: var(--text);
      padding: 10px 12px;
      border-radius: 10px;
      cursor: pointer;
      transition: transform .05s ease, background .2s ease, border-color .2s ease;
      font-weight: 600; letter-spacing: .02em;
    }
    button:hover { background: #162038; border-color: #38508b; }
    button:active { transform: translateY(1px); }
    button.primary {
      background: linear-gradient(180deg, #1a2746, #102037);
      border-color: #416fb8;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06), 0 8px 20px rgba(67,140,255,.15);
    }
    button.warn {
      border-color: #7a5322; background: linear-gradient(180deg, #2b1f12, #1b140c);
    }
    .legend {
      display: grid; gap: 6px; margin-top: 10px;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      font-size: 12px;
    }
    .legend .item { display: flex; align-items: center; gap: 8px; padding: 6px 8px; border-radius: 8px; border: 1px dashed #334466; background: #0d1426; }
    .swatch { width: 16px; height: 16px; border-radius: 4px; border: 1px solid rgba(255,255,255,.15); }
    .viz {
      display: grid; grid-template-rows: auto 1fr auto; gap: 8px;
    }
    .barArea {
      height: 340px;
      border-radius: 12px;
      border: 1px solid #223052;
      background: linear-gradient(180deg, rgba(18,24,40,.9), rgba(16,22,38,.9));
      padding: 12px;
      overflow: hidden;
      display: grid;
      align-items: end;
    }
    .bars {
      display: flex; align-items: end; gap: 6px; width: 100%; height: 100%;
    }
    .bar {
      flex: 1;
      background: var(--bar);
      border: 1px solid var(--barBorder);
      border-radius: 6px 6px 0 0;
      position: relative;
      transition: height .25s ease, background .25s ease, border-color .25s ease, transform .1s ease;
      min-width: 8px;
    }
    .bar span {
      position: absolute;
      bottom: -22px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 11px;
      color: var(--muted);
      user-select: none;
    }
    .bar:hover { transform: translateY(-2px); }
    .statusRow {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items: center;
      margin-top: 6px;
    }
    .statusRow .text { font-size: 13px; color: var(--muted); }
    .statusRow .clock { font-size: 12px; color: #8fb3ff; }
    .msg {
      font-size: 13px; padding: 8px 10px; border-radius: 8px; background: #11182b; border: 1px dashed #2a3e6e;
    }
    .footerNote { font-size: 12px; color: var(--muted); }
    /* Highlights */
    .hl-range { background: linear-gradient(180deg, #1f2e4e, #15223e); border-color: #4567a8; }
    .hl-left { background: linear-gradient(180deg, rgba(78,161,255,.25), rgba(78,161,255,.1)); border-color: #4ea1ff; }
    .hl-right { background: linear-gradient(180deg, rgba(248,101,176,.25), rgba(248,101,176,.1)); border-color: #f865b0; }
    .hl-merge { background: linear-gradient(180deg, rgba(83,215,122,.25), rgba(83,215,122,.1)); border-color: #53d77a; }
    .hl-mid { background: linear-gradient(180deg, rgba(255,181,78,.35), rgba(255,181,78,.15)); border-color: #ffb54e; }
    .hl-target { outline: 2px solid #ffb54e; }
    .hl-found { background: linear-gradient(180deg, rgba(83,215,122,.35), rgba(83,215,122,.15)); border-color: #53d77a; box-shadow: 0 0 0 2px rgba(83,215,122,.35); }
    .small {
      font-size: 12px; color: var(--muted);
    }
    .kbd {
      border: 1px solid #2a3860; background: #0f1527; padding: 2px 6px; border-radius: 6px; font-size: 12px;
    }
  </style>
</head>
<body>
  <header>
    <div class="title">Divide and Conquer Explorer</div>
    <div class="subtitle">Interactively visualize how problems are split, solved, and combined.</div>
  </header>

  <div class="container">
    <!-- Controls -->
    <div class="panel controls">
      <h2>Controls</h2>

      <div class="row">
        <div>
          <label for="algoSelect">Algorithm</label>
          <select id="algoSelect">
            <option value="merge">Merge Sort (Sort by dividing)</option>
            <option value="binary">Binary Search (Search by dividing)</option>
          </select>
        </div>
        <div>
          <label for="sizeRange">Array Size</label>
          <div class="sliderWrap">
            <span class="small">8</span>
            <input type="range" id="sizeRange" min="8" max="48" step="2" value="16">
            <span id="sizeVal" class="small">16</span>
          </div>
        </div>
      </div>

      <div class="row">
        <div>
          <label for="speedRange">Speed</label>
          <div class="sliderWrap">
            <span class="small">Slow</span>
            <input type="range" id="speedRange" min="1" max="5" step="1" value="3">
            <span id="speedVal" class="small">3x</span>
          </div>
        </div>
        <div id="targetWrap" style="display:none;">
          <label for="targetInput">Target (Binary Search)</label>
          <input id="targetInput" type="number" min="0" max="999" placeholder="Click a bar or enter a value">
        </div>
      </div>

      <div class="btnRow">
        <button id="genBtn">Generate Array</button>
        <button id="runBtn" class="primary">Run</button>
        <button id="stepBtn">Step</button>
        <button id="resetBtn">Reset</button>
      </div>

      <div class="legend">
        <div class="item"><div class="swatch" style="background:#1f2e4e;border-color:#4567a8"></div><div>Current range</div></div>
        <div class="item"><div class="swatch" style="background:#4ea1ff"></div><div>Left subproblem</div></div>
        <div class="item"><div class="swatch" style="background:#f865b0"></div><div>Right subproblem</div></div>
        <div class="item"><div class="swatch" style="background:#53d77a"></div><div>Combining</div></div>
      </div>

      <div class="msg" id="explain">
        Divide and Conquer breaks a problem into smaller subproblems (divide), solves them (conquer), and combines the results (combine).
        Try Merge Sort or Binary Search and step through each decision.
      </div>
    </div>

    <!-- Visualization -->
    <div class="panel viz">
      <h2>Visualization</h2>
      <div class="barArea">
        <div id="bars" class="bars"></div>
      </div>
      <div class="statusRow">
        <div id="status" class="text">Ready.</div>
        <div class="clock"><span id="framePos">0</span>/<span id="frameTotal">0</span></div>
      </div>
      <div class="small">Tip: In Binary Search, click a bar to set the target quickly.</div>
      <div class="footerNote" style="margin-top:8px;">
        Each frame highlights one step:
        - Divide: split the problem (blue/pink ranges).
        - Conquer: solve base cases.
        - Combine: merge results (green).
      </div>
    </div>
  </div>

  <script>
    // State
    const state = {
      algorithm: 'merge',
      size: 16,
      speed: 3,
      baseArray: [],
      frames: [],
      frameIndex: 0,
      playing: false,
      timer: null,
      target: null,
    };

    // Elements
    const algoSelect = document.getElementById('algoSelect');
    const sizeRange = document.getElementById('sizeRange');
    const sizeVal = document.getElementById('sizeVal');
    const speedRange = document.getElementById('speedRange');
    const speedVal = document.getElementById('speedVal');
    const genBtn = document.getElementById('genBtn');
    const runBtn = document.getElementById('runBtn');
    const stepBtn = document.getElementById('stepBtn');
    const resetBtn = document.getElementById('resetBtn');
    const targetWrap = document.getElementById('targetWrap');
    const targetInput = document.getElementById('targetInput');
    const barsEl = document.getElementById('bars');
    const statusEl = document.getElementById('status');
    const framePosEl = document.getElementById('framePos');
    const frameTotalEl = document.getElementById('frameTotal');
    const explainEl = document.getElementById('explain');

    // Utils
    const randInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    function generateArray(n) {
      const arr = Array.from({ length: n }, () => randInt(5, 95));
      return arr;
    }
    function msPerFrame(speed) {
      // 1..5 -> 900..150 ms
      return 1050 - speed * 180;
    }
    function clone(arr) {
      return arr.slice();
    }

    // Rendering bars with highlights
    function renderBars(values, highlight = {}) {
      barsEl.innerHTML = '';
      const maxVal = Math.max(...values, 100);
      const n = values.length;
      for (let i = 0; i < n; i++) {
        const v = values[i];
        const h = Math.max(12, Math.round((v / maxVal) * 300));
        const bar = document.createElement('div');
        bar.className = 'bar';
        bar.style.height = h + 'px';

        // Highlight logic
        const { mode, operation } = highlight;
        if (mode === 'merge') {
          const { range, leftRange, rightRange, mergeRange, k, baseRange } = highlight;
          if (range && i >= range[0] && i <= range[1]) bar.classList.add('hl-range');
          if (leftRange && i >= leftRange[0] && i <= leftRange[1]) bar.classList.add('hl-left');
          if (rightRange && i >= rightRange[0] && i <= rightRange[1]) bar.classList.add('hl-right');
          if (mergeRange && i >= mergeRange[0] && i <= mergeRange[1]) bar.classList.add('hl-merge');
          if (typeof k === 'number' && i === k) {
            bar.style.outline = '2px solid #8bf5ac';
          }
          if (baseRange && i >= baseRange[0] && i <= baseRange[1]) bar.style.opacity = 0.9;
        } else if (mode === 'binary') {
          const { lo, hi, mid, targetIndex, foundIndex } = highlight;
          if (typeof lo === 'number' && typeof hi === 'number' && i >= lo && i <= hi) bar.classList.add('hl-range');
          if (typeof mid === 'number' && i === mid) bar.classList.add('hl-mid');
          if (typeof targetIndex === 'number' && i === targetIndex) bar.classList.add('hl-target');
          if (typeof foundIndex === 'number' && i === foundIndex) bar.classList.add('hl-found');
        }

        const label = document.createElement('span');
        label.textContent = v;
        bar.appendChild(label);

        // Click to set target for binary search
        bar.addEventListener('click', () => {
          if (state.algorithm === 'binary') {
            const sorted = clone(state.baseArray).sort((a,b) => a - b);
            const val = v;
            targetInput.value = val;
            state.target = val;
            // Precompute target index in sorted array for highlight convenience
            const idx = sorted.indexOf(val);
            renderBars(sorted, { mode: 'binary', lo: 0, hi: sorted.length - 1, mid: null, targetIndex: idx });
            statusEl.textContent = 'Target set to ' + val + '. Click Run to search.';
          }
        });

        barsEl.appendChild(bar);
      }
    }

    function pushFrame(arr, highlight, message) {
      state.frames.push({ arr: clone(arr), highlight: highlight ? { ...highlight } : null, message: message || '' });
    }
    function updateFrameInfo() {
      framePosEl.textContent = Math.min(state.frameIndex, Math.max(0, state.frames.length));
      frameTotalEl.textContent = state.frames.length;
    }
    function renderFrame() {
      if (state.frames.length === 0) return;
      const idx = Math.max(0, Math.min(state.frameIndex, state.frames.length - 1));
      const frame = state.frames[idx];
      renderBars(frame.arr, frame.highlight);
      statusEl.textContent = frame.message || `Step ${idx + 1}/${state.frames.length}`;
      updateFrameInfo();
    }
    function resetPlayback() {
      clearInterval(state.timer);
      state.playing = false;
      runBtn.textContent = 'Run';
    }
    function play() {
      if (state.frames.length === 0) return;
      state.playing = true;
      runBtn.textContent = 'Pause';
      clearInterval(state.timer);
      state.timer = setInterval(() => {
        if (state.frameIndex >= state.frames.length - 1) {
          resetPlayback();
          return;
        }
        state.frameIndex++;
        renderFrame();
      }, msPerFrame(state.speed));
    }
    function pause() {
      resetPlayback();
    }
    function step() {
      if (state.frames.length === 0) return;
      state.frameIndex = Math.min(state.frameIndex + 1, state.frames.length - 1);
      renderFrame();
    }

    // Merge Sort frames
    function buildMergeSortFrames() {
      state.frames = [];
      const arr = clone(state.baseArray);

      function mergeSort(l, r) {
        if (l >= r) {
          pushFrame(arr, { mode: 'merge', baseRange: [l, r] }, `Conquer: base case at index ${l}`);
          return;
        }
        const m = Math.floor((l + r) / 2);
        pushFrame(arr, { mode: 'merge', range: [l, r], leftRange: [l, m], rightRange: [m+1, r] }, `Divide: split [${l}, ${r}] into [${l}, ${m}] and [${m+1}, ${r}]`);
        mergeSort(l, m);
        mergeSort(m + 1, r);
        // Merge step
        const left = arr.slice(l, m + 1);
        const right = arr.slice(m + 1, r + 1);
        let i = 0, j = 0, k = l;
        while (i < left.length || j < right.length) {
          const chooseLeft = j >= right.length || (i < left.length && left[i] <= right[j]);
          arr[k] = chooseLeft ? left[i++] : right[j++];
          pushFrame(arr, { mode: 'merge', mergeRange: [l, r], leftRange: [l, m], rightRange: [m+1, r], k },
            `Combine: placing ${arr[k]} into position ${k}`);
          k++;
        }
        pushFrame(arr, { mode: 'merge', mergeRange: [l, r] }, `Combined: merged sorted range [${l}, ${r}]`);
      }

      mergeSort(0, arr.length - 1);
      state.frameIndex = 0;
      explainEl.textContent = 'Merge Sort: Divide the array into halves, recursively sort each half, then combine by merging.';
    }

    // Binary Search frames
    function buildBinarySearchFrames() {
      state.frames = [];
      const arr = clone(state.baseArray).sort((a, b) => a - b);

      let lo = 0, hi = arr.length - 1;
      let target = state.target;

      // If no target set, pick a random existing value to ensure "found" possibility
      if (target === null || target === undefined || target === '') {
        target = arr[randInt(0, arr.length - 1)];
        state.target = target;
        targetInput.value = target;
      }
      const targetIndex = arr.indexOf(target);

      pushFrame(arr, { mode: 'binary', lo, hi, mid: null, targetIndex }, `Start: search for ${target} in sorted array.`);

      while (lo <= hi) {
        const mid = Math.floor((lo + hi) / 2);
        pushFrame(arr, { mode: 'binary', lo, hi, mid, targetIndex }, `Divide: check middle index ${mid} (value ${arr[mid]})`);
        if (arr[mid] === target) {
          pushFrame(arr, { mode: 'binary', lo, hi, mid, targetIndex, foundIndex: mid }, `Conquer: found ${target} at index ${mid}`);
          break;
        } else if (arr[mid] < target) {
          lo = mid + 1;
          pushFrame(arr, { mode: 'binary', lo, hi, targetIndex }, `Reduce: target greater than middle, search right half [${lo}, ${hi}]`);
        } else {
          hi = mid - 1;
          pushFrame(arr, { mode: 'binary', lo, hi, targetIndex }, `Reduce: target less than middle, search left half [${lo}, ${hi}]`);
        }
      }
      if (lo > hi) {
        pushFrame(arr, { mode: 'binary', lo, hi, targetIndex }, `Conquer: ${target} not found (empty range).`);
      }
      state.frameIndex = 0;
      explainEl.textContent = 'Binary Search: Divide the search space by checking the middle; narrow to the half that could contain the target.';
    }

    // Initialize
    function refreshBaseArray() {
      state.baseArray = generateArray(state.size);
      if (state.algorithm === 'binary') {
        const sorted = clone(state.baseArray).sort((a,b) => a - b);
        renderBars(sorted, { mode: 'binary', lo: 0, hi: sorted.length - 1 });
        statusEl.textContent = 'Generated new array (sorted for binary search). Choose a target or click a bar.';
      } else {
        renderBars(state.baseArray, { mode: 'merge' });
        statusEl.textContent = 'Generated new array. Click Run to visualize Merge Sort.';
      }
      state.frames = [];
      state.frameIndex = 0;
      updateFrameInfo();
    }

    // Event handlers
    algoSelect.addEventListener('change', () => {
      state.algorithm = algoSelect.value;
      targetWrap.style.display = state.algorithm === 'binary' ? '' : 'none';
      resetPlayback();
      refreshBaseArray();
      explainEl.textContent = state.algorithm === 'merge'
        ? 'Merge Sort: Divide the array into halves, recursively sort each half, then combine by merging.'
        : 'Binary Search: Divide the search space by checking the middle; narrow to the half that could contain the target.';
    });

    sizeRange.addEventListener('input', () => {
      state.size = parseInt(sizeRange.value, 10);
      sizeVal.textContent = state.size;
      resetPlayback();
      refreshBaseArray();
    });

    speedRange.addEventListener('input', () => {
      state.speed = parseInt(speedRange.value, 10);
      speedVal.textContent = `${state.speed}x`;
      if (state.playing) {
        clearInterval(state.timer);
        play();
      }
    });

    genBtn.addEventListener('click', () => {
      resetPlayback();
      refreshBaseArray();
    });

    runBtn.addEventListener('click', () => {
      if (state.playing) {
        pause();
        return;
      }
      if (state.frames.length === 0) {
        if (state.algorithm === 'merge') buildMergeSortFrames();
        else buildBinarySearchFrames();
        updateFrameInfo();
        renderFrame();
      }
      play();
    });

    stepBtn.addEventListener('click', () => {
      if (state.frames.length === 0) {
        if (state.algorithm === 'merge') buildMergeSortFrames();
        else buildBinarySearchFrames();
        updateFrameInfo();
        renderFrame();
        return;
      }
      pause();
      step();
    });

    resetBtn.addEventListener('click', () => {
      resetPlayback();
      state.frameIndex = 0;
      renderFrame();
    });

    targetInput.addEventListener('input', () => {
      const val = targetInput.value.trim();
      if (val === '') {
        state.target = null;
        statusEl.textContent = 'Target cleared. Click a bar or type a value.';
        return;
      }
      state.target = parseInt(val, 10);
      const sorted = clone(state.baseArray).sort((a,b) => a - b);
      const idx = sorted.indexOf(state.target);
      renderBars(sorted, { mode: 'binary', lo: 0, hi: sorted.length - 1, targetIndex: idx >= 0 ? idx : null });
      statusEl.textContent = `Target set to ${state.target}.`;
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.key === ' ') {
        e.preventDefault();
        runBtn.click();
      } else if (e.key.toLowerCase() === 'n' || e.key === 'ArrowRight') {
        e.preventDefault();
        stepBtn.click();
      } else if (e.key.toLowerCase() === 'r') {
        e.preventDefault();
        genBtn.click();
      }
    });

    // Boot
    (function init() {
      refreshBaseArray();
      updateFrameInfo();
      explainEl.textContent = 'Select an algorithm and click Run or Step to walk through Divide and Conquer in action.';
    })();
  </script>
</body>
</html>