<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Heap Sort Visualization (Single File)</title>
<style>
  :root{
    --bg: #0f172a;          /* slate-900 */
    --panel: #111827;       /* gray-900 */
    --panel-2: #0b1222;     /* dark bluish */
    --text: #e5e7eb;        /* gray-200 */
    --muted: #9ca3af;       /* gray-400 */
    --primary: #60a5fa;     /* blue-400 */
    --accent: #f59e0b;      /* amber-500 */
    --danger: #f87171;      /* red-400 */
    --success: #34d399;     /* emerald-400 */
    --outline: #334155;     /* slate-600 */
    --swap: #ef4444;        /* red-500 */
    --compare: #f59e0b;     /* amber-500 */
    --heap: #60a5fa;        /* blue-400 */
    --out: #334155;         /* slate-600 */
    --focus: #a78bfa;       /* violet-400 */
  }
  * { box-sizing: border-box; }
  html, body {
    height: 100%;
    background: radial-gradient(1200px 600px at 20% -10%, #1e293b 0%, #0f172a 60%);
    color: var(--text);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    margin: 0;
  }
  .app {
    max-width: 1100px;
    margin: 0 auto;
    padding: 18px 14px 30px;
  }
  h1 {
    font-weight: 700;
    font-size: 1.6rem;
    letter-spacing: 0.2px;
    margin: 6px 0 14px 0;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  h1 .badge {
    font-size: 0.74rem;
    background: linear-gradient(180deg, #1f2937, #0f172a);
    border: 1px solid var(--outline);
    color: var(--muted);
    border-radius: 999px;
    padding: 4px 8px;
  }
  .panel {
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.18));
    border: 1px solid rgba(148,163,184,0.15);
    border-radius: 14px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.04);
  }
  .controls {
    display: grid;
    grid-template-columns: 1.1fr 1fr 1fr 1.6fr;
    gap: 10px;
    padding: 12px;
  }
  @media (max-width: 880px){
    .controls { grid-template-columns: 1fr 1fr; }
  }
  @media (max-width: 520px){
    .controls { grid-template-columns: 1fr; }
  }

  .field {
    display: flex;
    flex-direction: column;
    gap: 6px;
    padding: 10px;
    border-radius: 12px;
    background: rgba(2,6,23,0.35);
    border: 1px solid rgba(148,163,184,0.12);
  }
  .field label {
    font-size: 0.78rem;
    color: var(--muted);
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .row {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
  }
  input[type="text"]{
    width: 100%;
    background: rgba(2,6,23,0.5);
    color: var(--text);
    border: 1px solid rgba(148,163,184,0.18);
    border-radius: 10px;
    padding: 10px 12px;
    outline: none;
    transition: border-color .15s, box-shadow .15s;
  }
  input[type="text"]:focus{
    border-color: var(--focus);
    box-shadow: 0 0 0 3px rgba(167,139,250,.15);
  }
  .chip {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 10px;
    border-radius: 999px;
    font-size: 0.78rem;
    color: var(--muted);
    border: 1px dashed rgba(148,163,184,0.28);
    background: rgba(2,6,23,0.35);
  }
  input[type="range"]{
    width: 100%;
    accent-color: var(--primary);
  }
  .btn {
    appearance: none;
    border: 1px solid rgba(148,163,184,0.2);
    background: linear-gradient(180deg, rgba(59,130,246,0.18), rgba(59,130,246,0.08));
    color: #e6f1ff;
    padding: 10px 12px;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: transform .05s ease, background .15s ease, border-color .15s ease, box-shadow .15s;
    user-select: none;
  }
  .btn.secondary{
    background: linear-gradient(180deg, rgba(2,6,23,0.35), rgba(2,6,23,0.2));
    color: var(--text);
  }
  .btn.danger{
    background: linear-gradient(180deg, rgba(248,113,113,0.22), rgba(248,113,113,0.08));
    border-color: rgba(248,113,113,0.35);
  }
  .btn:active{ transform: translateY(1px); }
  .btn[disabled]{ opacity: 0.55; cursor: not-allowed; }

  .status {
    margin-top: 12px;
    padding: 12px 14px;
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
  }
  .status .message {
    flex: 1 1 auto;
    background: rgba(2,6,23,0.45);
    border: 1px solid rgba(148,163,184,0.16);
    padding: 10px 12px;
    border-radius: 10px;
    min-height: 40px;
    display: flex;
    align-items: center;
  }
  .pill {
    padding: 8px 10px;
    border-radius: 999px;
    border: 1px solid rgba(148,163,184,0.2);
    background: rgba(2,6,23,0.45);
    font-size: 0.84rem;
    color: var(--muted);
  }

  .viz {
    margin-top: 16px;
    padding: 14px 10px 18px;
  }
  .bars {
    height: 340px;
    display: flex;
    align-items: flex-end;
    gap: 4px;
    padding: 10px;
    border-radius: 12px;
    border: 1px solid rgba(148,163,184,0.14);
    background: linear-gradient(180deg, rgba(2,6,23,0.35), rgba(2,6,23,0.1));
    position: relative;
    overflow: hidden;
  }
  .bars::after{
    content:"";
    position:absolute;
    inset:0;
    background: radial-gradient(800px 300px at 80% -20%, rgba(96,165,250,0.10), transparent 60%),
                radial-gradient(600px 240px at 10% -20%, rgba(79,70,229,0.09), transparent 60%);
    pointer-events: none;
  }
  .bar {
    flex: 1 1 0;
    min-width: 8px;
    position: relative;
    border-radius: 8px 8px 2px 2px;
    background: linear-gradient(180deg, rgba(37,99,235,0.85), rgba(37,99,235,0.55));
    border: 1px solid rgba(59,130,246,0.45);
    transition: height .25s ease, background .15s ease, border-color .15s ease, transform .2s ease, opacity .2s ease;
    display: flex;
    align-items: flex-end;
    justify-content: center;
  }
  .bar .val {
    position: absolute;
    bottom: 6px;
    font-size: 11px;
    color: #e6f1ff;
    text-shadow: 0 1px 0 rgba(0,0,0,0.25);
    opacity: 0.85;
    user-select: none;
    pointer-events: none;
  }
  .bar .idx {
    position: absolute;
    bottom: -18px;
    color: var(--muted);
    font-size: 10px;
    user-select: none;
    pointer-events: none;
  }
  .bar.compare {
    background: linear-gradient(180deg, rgba(245,158,11,0.9), rgba(245,158,11,0.6));
    border-color: rgba(245,158,11,0.6);
    box-shadow: 0 0 0 2px rgba(245,158,11,0.18);
  }
  .bar.swap {
    background: linear-gradient(180deg, rgba(239,68,68,0.95), rgba(239,68,68,0.7));
    border-color: rgba(239,68,68,0.6);
    box-shadow: 0 0 0 2px rgba(239,68,68,0.18);
    transform: translateY(-4px);
  }
  .bar.sorted {
    background: linear-gradient(180deg, rgba(16,185,129,0.95), rgba(16,185,129,0.6));
    border-color: rgba(16,185,129,0.55);
  }
  .bar.out {
    background: linear-gradient(180deg, rgba(100,116,139,0.5), rgba(51,65,85,0.35));
    border-color: rgba(100,116,139,0.35);
    opacity: 0.7;
  }
  .legend {
    margin-top: 10px;
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    padding: 10px;
  }
  .legend .k {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 6px 10px;
    background: rgba(2,6,23,0.45);
    border: 1px solid rgba(148,163,184,0.18);
    border-radius: 999px;
    font-size: 12px;
    color: var(--muted);
  }
  .dot {
    width: 14px;
    height: 14px;
    border-radius: 4px;
    display: inline-block;
  }
  .dot.heap { background: linear-gradient(180deg, rgba(37,99,235,0.85), rgba(37,99,235,0.55)); border: 1px solid rgba(59,130,246,0.45); }
  .dot.compare { background: linear-gradient(180deg, rgba(245,158,11,0.9), rgba(245,158,11,0.6)); border: 1px solid rgba(245,158,11,0.6); }
  .dot.swap { background: linear-gradient(180deg, rgba(239,68,68,0.95), rgba(239,68,68,0.7)); border: 1px solid rgba(239,68,68,0.6); }
  .dot.sorted { background: linear-gradient(180deg, rgba(16,185,129,0.95), rgba(16,185,129,0.6)); border: 1px solid rgba(16,185,129,0.55); }
  .dot.out { background: linear-gradient(180deg, rgba(100,116,139,0.5), rgba(51,65,85,0.35)); border: 1px solid rgba(100,116,139,0.35); }

  details.explain {
    margin-top: 14px;
    padding: 10px 12px;
  }
  details.explain summary {
    cursor: pointer;
    list-style: none;
  }
  details.explain summary::-webkit-details-marker { display: none; }
  .explain .content {
    color: var(--muted);
    font-size: 0.95rem;
    line-height: 1.45;
    margin-top: 8px;
  }

  .footer {
    margin-top: 18px;
    color: var(--muted);
    font-size: 12px;
    text-align: center;
  }
</style>
</head>
<body>
  <div class="app">
    <h1>
      Heap Sort Visualizer
      <span class="badge">In-place, O(n log n)</span>
    </h1>

    <div class="panel controls">
      <div class="field" style="grid-column: span 2;">
        <label>
          Custom array (comma or space separated)
          <span class="chip">Example: 5, 1, 9, 3, 7</span>
        </label>
        <div class="row">
          <input id="customInput" type="text" placeholder="Enter numbers, e.g., 12, 7, 3, 19, 2" />
          <button id="applyCustom" class="btn secondary">Apply</button>
        </div>
      </div>

      <div class="field">
        <label>
          Size
          <span class="chip"><span id="sizeOut">20</span></span>
        </label>
        <input id="size" type="range" min="5" max="80" value="20" />
        <div class="row">
          <button id="randomize" class="btn">Randomize</button>
          <button id="shuffle" class="btn secondary">Shuffle</button>
        </div>
      </div>

      <div class="field">
        <label>
          Speed
          <span class="chip"><span id="speedOut">1.0x</span></span>
        </label>
        <input id="speed" type="range" min="0" max="100" value="60" />
        <div class="row">
          <label style="font-size: 0.76rem; color: var(--muted);">Show values
            <input id="showValues" type="checkbox" style="margin-left:8px" checked />
          </label>
        </div>
      </div>

      <div class="field">
        <label>Controls</label>
        <div class="row">
          <button id="start" class="btn">Start</button>
          <button id="step" class="btn secondary">Step</button>
          <button id="pause" class="btn secondary">Pause</button>
          <button id="reset" class="btn danger">Reset</button>
        </div>
      </div>
    </div>

    <div class="panel status">
      <div class="message" id="message">Ready. Generate data or start sorting.</div>
      <div class="pill">Heap size: <span id="heapSizeOut" style="margin-left:6px; color:#fff;">0</span></div>
      <div class="pill">Comparisons: <span id="compOut" style="margin-left:6px; color:#fff;">0</span></div>
      <div class="pill">Swaps: <span id="swapOut" style="margin-left:6px; color:#fff;">0</span></div>
    </div>

    <div class="panel viz">
      <div id="bars" class="bars"></div>
      <div class="legend">
        <span class="k"><span class="dot heap"></span> In-heap</span>
        <span class="k"><span class="dot out"></span> Out of heap</span>
        <span class="k"><span class="dot compare"></span> Comparing</span>
        <span class="k"><span class="dot swap"></span> Swapping</span>
        <span class="k"><span class="dot sorted"></span> Sorted</span>
      </div>
    </div>

    <details class="panel explain">
      <summary><strong>What is Heap Sort?</strong></summary>
      <div class="content">
        Heap Sort is a comparison-based sorting algorithm that turns the array into a max-heap, then repeatedly extracts the maximum element (the root) to the end of the array, shrinking the heap each time. It runs in O(n log n) time and sorts in place with O(1) extra space.
        Steps:
        - Build a max-heap from the array (siftDown from the last parent to the root).
        - Swap the root (maximum) with the last element of the heap; mark it sorted (out of the heap).
        - Restore heap property by sifting the new root down.
        - Repeat until the heap size is 1.
      </div>
    </details>

    <div class="footer">
      Tip: Use Step to advance one operation at a time, or Start to animate automatically. Adjust Speed for faster or slower animations.
    </div>
  </div>

<script>
(function(){
  // State
  const state = {
    array: [],
    original: [],
    gen: null,
    playing: false,
    delayMs: 300,
    sorted: new Set(),
    heapSize: 0,
    highlights: { compare: null, swap: null },
    message: 'Ready.',
    comparisons: 0,
    swaps: 0,
    showValues: true,
    runningToken: 0
  };

  // Elements
  const el = {
    bars: document.getElementById('bars'),
    message: document.getElementById('message'),
    heapSizeOut: document.getElementById('heapSizeOut'),
    compOut: document.getElementById('compOut'),
    swapOut: document.getElementById('swapOut'),
    size: document.getElementById('size'),
    sizeOut: document.getElementById('sizeOut'),
    speed: document.getElementById('speed'),
    speedOut: document.getElementById('speedOut'),
    showValues: document.getElementById('showValues'),
    randomize: document.getElementById('randomize'),
    shuffle: document.getElementById('shuffle'),
    start: document.getElementById('start'),
    step: document.getElementById('step'),
    pause: document.getElementById('pause'),
    reset: document.getElementById('reset'),
    customInput: document.getElementById('customInput'),
    applyCustom: document.getElementById('applyCustom'),
  };

  // Utilities
  function randInt(min, max){
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }
  function generateRandomArray(n){
    const arr = new Array(n);
    for (let i=0;i<n;i++) arr[i] = randInt(5, 100);
    return arr;
  }
  function shuffleArray(arr){
    for (let i=arr.length-1; i>0; i--){
      const j = Math.floor(Math.random() * (i+1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
  }
  function sleep(ms){
    return new Promise(res=>setTimeout(res, ms));
  }
  function setMessage(msg){
    state.message = msg;
    el.message.textContent = msg;
  }
  function setDelayFromSpeedSlider(){
    // Map slider 0..100 to delay 800ms..20ms (exponential-ish curve)
    const v = Number(el.speed.value);
    const t = v/100; // 0..1
    // Use an exponential mapping for better control at high speeds
    const min = 20, max = 800;
    const k = 4; // curvature
    const factor = Math.pow(1 - t, k);
    const delay = Math.round(min + (max - min) * factor);
    state.delayMs = delay;
    const speedFactor = (max / delay).toFixed(1);
    el.speedOut.textContent = speedFactor + 'x';
  }

  // Visualization
  function render(){
    const arr = state.array;
    const n = arr.length;
    const maxVal = Math.max(100, ...arr, 1);
    const heapSize = state.heapSize ?? n;

    // Build bars
    el.bars.innerHTML = '';
    for (let i=0;i<n;i++){
      const v = arr[i];
      const bar = document.createElement('div');
      bar.className = 'bar';
      const heightPct = (v / maxVal) * 100;
      bar.style.height = Math.max(4, heightPct) + '%';

      // Classes
      const isSorted = state.sorted.has(i);
      const inHeap = i < heapSize && !isSorted;
      if (isSorted) {
        bar.classList.add('sorted');
      } else if (!inHeap) {
        bar.classList.add('out');
      }
      if (state.highlights.compare && (i === state.highlights.compare[0] || i === state.highlights.compare[1])){
        bar.classList.remove('out');
        bar.classList.add('compare');
      }
      if (state.highlights.swap && (i === state.highlights.swap[0] || i === state.highlights.swap[1])){
        bar.classList.remove('out');
        bar.classList.add('swap');
      }

      // Labels
      if (state.showValues){
        const val = document.createElement('div');
        val.className = 'val';
        val.textContent = v;
        bar.appendChild(val);
      }
      const idx = document.createElement('div');
      idx.className = 'idx';
      idx.textContent = i;
      bar.appendChild(idx);

      el.bars.appendChild(bar);
    }

    // Status
    el.heapSizeOut.textContent = String(heapSize);
    el.compOut.textContent = String(state.comparisons);
    el.swapOut.textContent = String(state.swaps);
  }

  // Heap Sort step generator
  function* heapifySteps(arr, heapSize, i){
    while (true){
      let largest = i;
      const left = 2*i + 1;
      const right = 2*i + 2;

      if (left < heapSize){
        yield { type: 'compare', i: largest, j: left, heapSize, message: `Compare parent (${i}) and left child (${left})` };
        if (arr[left] > arr[largest]) largest = left;
      }
      if (right < heapSize){
        yield { type: 'compare', i: largest, j: right, heapSize, message: `Compare current largest (${largest}) and right child (${right})` };
        if (arr[right] > arr[largest]) largest = right;
      }
      if (largest !== i){
        yield { type: 'swap', i, j: largest, heapSize, message: `Swap to restore heap property: ${i} â‡„ ${largest}` };
        [arr[i], arr[largest]] = [arr[largest], arr[i]];
        i = largest;
      } else {
        break;
      }
    }
    yield { type: 'heapifyDone', heapSize, message: `Heapify path complete` };
  }

  function* heapSortSteps(arr){
    const n = arr.length;
    yield { type: 'info', heapSize: n, message: 'Build max heap' };
    for (let i = Math.floor(n/2) - 1; i >= 0; i--){
      yield { type: 'heapifyStart', idx: i, heapSize: n, message: `Sift down from index ${i}` };
      yield* heapifySteps(arr, n, i);
    }
    yield { type: 'info', heapSize: n, message: 'Max heap built. Extract max and sort.' };

    for (let end = n - 1; end > 0; end--){
      yield { type: 'swap', i: 0, j: end, heapSize: end + 1, message: `Swap max at root (0) with end (${end})` };
      [arr[0], arr[end]] = [arr[end], arr[0]];
      yield { type: 'markSorted', index: end, heapSize: end, message: `Position ${end} fixed (sorted)` };
      yield* heapifySteps(arr, end, 0);
    }
    if (n > 0){
      yield { type: 'markSorted', index: 0, heapSize: 0, message: `All done` };
    }
    yield { type: 'done', heapSize: 0, message: 'Array is sorted.' };
  }

  // Step handling
  function clearHighlights(){
    state.highlights.compare = null;
    state.highlights.swap = null;
  }
  function applyStep(step){
    clearHighlights();

    if (typeof step.heapSize === 'number'){
      state.heapSize = step.heapSize;
    }

    switch(step.type){
      case 'info':
        setMessage(step.message);
        break;
      case 'heapifyStart':
        setMessage(step.message);
        break;
      case 'compare':
        state.comparisons++;
        state.highlights.compare = [step.i, step.j];
        setMessage(step.message);
        break;
      case 'swap':
        state.swaps++;
        state.highlights.swap = [step.i, step.j];
        setMessage(step.message);
        break;
      case 'markSorted':
        state.sorted.add(step.index);
        setMessage(step.message || 'Marked sorted');
        break;
      case 'heapifyDone':
        setMessage(step.message);
        break;
      case 'done':
        setMessage(step.message);
        break;
    }

    render();
  }

  async function runGeneratorAuto(){
    const token = ++state.runningToken;
    state.playing = true;
    updateButtons();

    while (state.playing && state.gen){
      const { value, done } = state.gen.next();
      if (token !== state.runningToken) return; // superseded
      if (done){
        state.playing = false;
        updateButtons();
        setMessage('Array is sorted.');
        state.heapSize = 0;
        render();
        break;
      }
      applyStep(value);

      // Delay
      let d = state.delayMs;
      if (value.type === 'swap') d = Math.round(state.delayMs * 1.25);
      await sleep(d);

      // While paused, wait loop
      while (!state.playing){
        if (token !== state.runningToken) return;
        await sleep(60);
      }
    }
  }

  function stepOnce(){
    if (!state.gen) {
      state.gen = heapSortSteps(state.array);
      state.runningToken++;
      state.sorted.clear();
      state.comparisons = 0;
      state.swaps = 0;
      state.heapSize = state.array.length;
    }
    const { value, done } = state.gen.next();
    if (done){
      setMessage('Array is sorted.');
      state.heapSize = 0;
      render();
      state.playing = false;
      updateButtons();
      return;
    }
    applyStep(value);
  }

  // Buttons and inputs
  function updateButtons(){
    el.pause.textContent = state.playing ? 'Pause' : 'Resume';
    el.start.disabled = state.playing;
    el.step.disabled = state.playing;
    el.randomize.disabled = state.playing;
    el.shuffle.disabled = state.playing;
    el.applyCustom.disabled = state.playing;
    el.customInput.disabled = state.playing;
    el.size.disabled = state.playing;
  }

  function setArray(arr){
    state.array = arr.slice();
    state.original = arr.slice();
    state.gen = null;
    state.playing = false;
    state.sorted.clear();
    state.heapSize = arr.length;
    state.comparisons = 0;
    state.swaps = 0;
    clearHighlights();
    setMessage('Ready.');
    updateButtons();
    render();
  }

  function parseCustomInput(str){
    // Accept commas and/or spaces
    const parts = str.split(/[\s,]+/).map(s=>s.trim()).filter(Boolean);
    if (parts.length === 0) return null;
    const nums = parts.map(x => Number(x));
    if (nums.some(n => !Number.isFinite(n))) return null;
    return nums;
  }

  // Initial setup
  function init(){
    el.sizeOut.textContent = el.size.value;
    el.size.addEventListener('input', ()=>{
      el.sizeOut.textContent = el.size.value;
    });
    el.randomize.addEventListener('click', ()=>{
      const n = Number(el.size.value);
      const arr = generateRandomArray(n);
      setArray(arr);
    });
    el.shuffle.addEventListener('click', ()=>{
      const arr = state.array.slice();
      shuffleArray(arr);
      setArray(arr);
    });
    el.applyCustom.addEventListener('click', ()=>{
      const nums = parseCustomInput(el.customInput.value);
      if (!nums || nums.length === 0){
        setMessage('Invalid input. Please enter numbers separated by commas or spaces.');
        return;
      }
      setArray(nums);
      el.size.value = Math.min(Math.max(nums.length, Number(el.size.min)), Number(el.size.max));
      el.sizeOut.textContent = el.size.value;
    });
    el.speed.addEventListener('input', setDelayFromSpeedSlider);
    el.showValues.addEventListener('change', ()=>{
      state.showValues = el.showValues.checked;
      render();
    });

    el.start.addEventListener('click', ()=>{
      if (!state.gen){
        state.gen = heapSortSteps(state.array);
        state.sorted.clear();
        state.comparisons = 0;
        state.swaps = 0;
        state.heapSize = state.array.length;
        clearHighlights();
      }
      state.playing = true;
      runGeneratorAuto();
      updateButtons();
    });
    el.step.addEventListener('click', ()=>{
      state.playing = false;
      updateButtons();
      stepOnce();
    });
    el.pause.addEventListener('click', ()=>{
      if (!state.gen){
        // If not started, start paused -> single step
        state.gen = heapSortSteps(state.array);
        state.heapSize = state.array.length;
      }
      state.playing = !state.playing;
      updateButtons();
      if (state.playing){
        runGeneratorAuto();
      }
    });
    el.reset.addEventListener('click', ()=>{
      setArray(state.original);
    });

    // Defaults
    setDelayFromSpeedSlider();
    const defaultArr = generateRandomArray(Number(el.size.value));
    setArray(defaultArr);
  }

  init();
})();
</script>
</body>
</html>