<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Red-Black Tree Visualization</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        #tree {
            margin: 20px auto;
            display: inline-block;
        }
        .node {
            border: 2px solid;
            border-radius: 5px;
            padding: 10px;
            margin: 5px;
            display: inline-block;
            position: relative;
        }
        .red {
            border-color: red;
            color: red;
        }
        .black {
            border-color: black;
            color: black;
        }
        .link {
            position: relative;
            height: 30px;
            width: 0;
            border-left: 1px solid black;
            margin: auto;
        }
        .link::after {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            border-bottom: 10px solid transparent;
            border-top: 10px solid black;
            border-left: 10px solid transparent;
        }
    </style>
</head>
<body>

<h1>Red-Black Tree Visualization</h1>
<div id="tree"></div>
<input type="number" id="valueInput" placeholder="Enter a number">
<button onclick="insert()">Insert</button>

<script>
    class Node {
        constructor(data) {
            this.data = data;
            this.color = 'red'; // New node must be red
            this.left = null;
            this.right = null;
            this.parent = null;
        }
    }

    class RedBlackTree {
        constructor() {
            this.root = null;
        }

        insert(data) {
            let newNode = new Node(data);
            this.root = this.insertNode(this.root, newNode);
            this.fixViolation(newNode);
        }

        insertNode(root, newNode) {
            if (root === null) return newNode;

            if (newNode.data < root.data) {
                root.left = this.insertNode(root.left, newNode);
                root.left.parent = root;
            } else if (newNode.data > root.data) {
                root.right = this.insertNode(root.right, newNode);
                root.right.parent = root;
            }
            return root;
        }

        fixViolation(node) {
            while (node !== this.root && node.parent.color === 'red') {
                let parent = node.parent;
                let grandparent = parent.parent;

                if (parent === grandparent.left) {
                    let uncle = grandparent.right;
                    if (uncle && uncle.color === 'red') {
                        parent.color = 'black';
                        uncle.color = 'black';
                        grandparent.color = 'red';
                        node = grandparent;
                    } else {
                        if (node === parent.right) {
                            this.rotateLeft(parent);
                            node = parent;
                            parent = node.parent;
                        }
                        this.rotateRight(grandparent);
                        let temp = parent.color;
                        parent.color = grandparent.color;
                        grandparent.color = temp;
                        node = parent;
                    }
                } else {
                    let uncle = grandparent.left;
                    if (uncle && uncle.color === 'red') {
                        parent.color = 'black';
                        uncle.color = 'black';
                        grandparent.color = 'red';
                        node = grandparent;
                    } else {
                        if (node === parent.left) {
                            this.rotateRight(parent);
                            node = parent;
                            parent = node.parent;
                        }
                        this.rotateLeft(grandparent);
                        let temp = parent.color;
                        parent.color = grandparent.color;
                        grandparent.color = temp;
                        node = parent;
                    }
                }
            }
            this.root.color = 'black'; // Ensure the root is black
        }

        rotateLeft(node) {
            let rightChild = node.right;
            node.right = rightChild.left;
            if (node.right !== null) {
                node.right.parent = node;
            }
            rightChild.parent = node.parent;
            if (node.parent === null) {
                this.root = rightChild;
            } else if (node === node.parent.left) {
                node.parent.left = rightChild;
            } else {
                node.parent.right = rightChild;
            }
            rightChild.left = node;
            node.parent = rightChild;
        }

        rotateRight(node) {
            let leftChild = node.left;
            node.left = leftChild.right;
            if (node.left !== null) {
                node.left.parent = node;
            }
            leftChild.parent = node.parent;
            if (node.parent === null) {
                this.root = leftChild;
            } else if (node === node.parent.right) {
                node.parent.right = leftChild;
            } else {
                node.parent.left = leftChild;
            }
            leftChild.right = node;
            node.parent = leftChild;
        }

        render() {
            const container = document.getElementById('tree');
            container.innerHTML = '';
            this.displayNode(this.root, container);
        }

        displayNode(node, container) {
            if (node === null) return;

            const nodeDiv = document.createElement('div');
            nodeDiv.className = `node ${node.color}`;
            nodeDiv.textContent = node.data;

            container.appendChild(nodeDiv);

            const linksDiv = document.createElement('div');
            linksDiv.className = 'link';

            if (node.left) {
                this.displayNode(node.left, container);
                linksDiv.appendChild(document.createElement('div'));
            }
            if (node.right) {
                this.displayNode(node.right, container);
                linksDiv.appendChild(document.createElement('div'));
            }

            container.appendChild(linksDiv);
        }
    }

    const rbTree = new RedBlackTree();

    function insert() {
        const value = parseInt(document.getElementById('valueInput').value);
        if (!isNaN(value)) {
            rbTree.insert(value);
            rbTree.render();
            document.getElementById('valueInput').value = '';
        }
    }
</script>

</body>
</html>