<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <title>短除法教学 | 交互式演示与练习</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --bg: #f8f9fb;
      --panel: #ffffff;
      --text: #222;
      --muted: #666;
      --accent: #2b7cff;
      --accent-2: #ff7c2b;
      --good: #2bbf60;
      --bad: #ff4d4f;
      --line: #dadde3;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans SC", "PingFang SC", "Microsoft YaHei", sans-serif;
      background: linear-gradient(180deg, var(--bg), #eef2f7);
      color: var(--text);
    }
    .app {
      max-width: 1080px; margin: 24px auto; padding: 16px;
    }
    .header {
      display: flex; align-items: center; justify-content: space-between; gap: 12px;
      margin-bottom: 12px;
    }
    .title {
      font-weight: 700; font-size: 24px; letter-spacing: 0.5px;
    }
    .desc {
      color: var(--muted); font-size: 13px;
    }
    .card {
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 12px;
      box-shadow: 0 8px 28px rgba(18, 38, 63, 0.08);
      overflow: hidden;
    }
    .layout {
      display: grid; grid-template-columns: 320px 1fr; gap: 0; min-height: 560px;
    }
    .left {
      border-right: 1px solid var(--line);
      padding: 16px 16px 20px 16px;
    }
    .right {
      padding: 16px;
    }
    .section-title {
      font-weight: 600; font-size: 14px; margin: 12px 0 8px;
    }
    .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px; }
    label { font-size: 12px; color: var(--muted); display: block; margin-bottom: 4px; }
    input[type="text"], input[type="number"] {
      width: 100%; padding: 10px 12px; border: 1px solid var(--line); border-radius: 8px; font-size: 16px; outline: none;
      transition: border-color .2s, box-shadow .2s;
      background: #fafbff;
    }
    input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(43,124,255,0.15); background: #fff; }
    .mode-row { display: flex; gap: 8px; margin: 8px 0 12px; }
    .pill {
      padding: 8px 12px; border-radius: 999px; border: 1px solid var(--line); background: #fafbff;
      font-size: 13px; cursor: pointer; user-select: none;
    }
    .pill.active { border-color: var(--accent); color: var(--accent); background: #eef5ff; }
    .btn {
      display: inline-flex; align-items: center; gap: 8px;
      border: none; border-radius: 8px; padding: 10px 14px; font-size: 14px; cursor: pointer;
      background: var(--accent); color: #fff; box-shadow: 0 4px 12px rgba(43,124,255,0.25);
    }
    .btn.secondary { background: #eef2f7; color: #2b3a46; box-shadow: none; border: 1px solid var(--line); }
    .btn.warn { background: var(--bad); }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; }
    .examples { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; }
    .ex { border: 1px dashed var(--line); border-radius: 8px; padding: 8px 10px; font-size: 13px; cursor: pointer; background: #fafbff; }
    .ex:hover { border-color: var(--accent); color: var(--accent); }
    .controls { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; }
    .row { display: flex; align-items: center; gap: 8px; }
    .slider { width: 140px; }
    .hint { font-size: 12px; color: var(--muted); margin-top: 4px; }

    /* Board (short division layout) */
    .board {
      display: inline-block; padding: 16px; border: 1px solid var(--line); border-radius: 12px; background: #fff;
    }
    .board .quotient {
      display: flex; align-items: center; margin-left: 60px; min-height: 34px;
    }
    .qcell {
      width: 40px; height: 34px; border-bottom: 2px solid #111; margin-right: 2px;
      display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 600; color: #111;
    }
    .qcell.input { border-bottom-style: dashed; }
    .qcell input {
      width: 32px; height: 28px; border: none; border-bottom: 2px solid transparent; text-align: center; font-size: 18px; outline: none;
      background: transparent;
    }
    .qcell input:focus { border-bottom-color: var(--accent); }
    .main-row {
      display: flex; align-items: flex-start; margin-top: 4px;
    }
    .divisor {
      width: 44px; height: 44px; border: 2px solid #111; border-right: none; border-radius: 8px 0 0 8px;
      display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 700; margin-right: 0;
    }
    .bar {
      width: 4px; height: 56px; background: #111; border-radius: 2px; margin-right: 8px;
    }
    .digits {
      display: flex; align-items: center;
    }
    .digit {
      position: relative;
      width: 40px; height: 42px; margin-right: 2px;
      display: flex; align-items: center; justify-content: center;
      font-size: 22px; font-weight: 700; color: #111;
      border-bottom: 2px solid transparent;
      transition: transform .2s, background-color .2s, border-color .2s;
      border-radius: 6px;
    }
    .digit.active { background: #fff7e6; border-color: #ffb866; }
    .digit.done { background: #f5fff8; border-color: #a9efc4; }
    .bubble {
      position: absolute; top: -18px; left: 50%; transform: translateX(-50%);
      padding: 2px 6px; font-size: 12px; color: #fff; background: var(--muted); border-radius: 8px;
      white-space: nowrap;
    }
    .bubble.accent { background: var(--accent-2); }
    .bubble.good { background: var(--good); }
    .bubble.bad { background: var(--bad); }
    .eq {
      margin-top: 12px; padding: 10px 12px; border: 1px solid var(--line); border-radius: 8px; background: #fafbff;
      font-size: 14px; color: #2b3a46;
    }
    .eq b { color: #111; }
    .status {
      margin-top: 8px; font-size: 13px; color: var(--muted);
    }
    .footer {
      margin-top: 12px; display: flex; justify-content: space-between; align-items: center; gap: 12px;
    }
    .progress {
      font-size: 13px; color: var(--muted);
    }
    .result {
      margin-top: 8px; padding: 10px 12px; border-left: 4px solid var(--accent); background: #eef5ff; border-radius: 8px;
      font-size: 14px;
    }
    .error {
      color: var(--bad); font-size: 13px; margin-top: 6px;
    }
    .ok { color: var(--good); }
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <div>
        <div class="title">短除法教学</div>
        <div class="desc">把上一步的余数当作下一位的十位，逐位相除得到商与余数。适合用多位数除以一位数的计算。</div>
      </div>
      <button class="btn" id="resetBtn" title="重置页面">重置</button>
    </div>

    <div class="card layout">
      <div class="left">
        <div class="section-title">输入数字</div>
        <div class="input-row">
          <div>
            <label for="dividendInput">被除数（多位整数）</label>
            <input id="dividendInput" type="text" placeholder="如：948 或 1206" inputmode="numeric" />
          </div>
          <div>
            <label for="divisorInput">除数（一位整数）</label>
            <input id="divisorInput" type="number" placeholder="如：6" min="1" max="9" />
          </div>
        </div>
        <div class="hint">提示：短除法通常用于除数为一位数（2~9）。除数为 1 时商即为被除数，余数为 0。</div>

        <div class="section-title">模式</div>
        <div class="mode-row">
          <div id="modeExplain" class="pill active">讲解模式（自动给出商）</div>
          <div id="modePractice" class="pill">练习模式（逐位填商）</div>
        </div>

        <div class="section-title">示例</div>
        <div class="examples">
          <div class="ex" data-example="948|6">948 ÷ 6</div>
          <div class="ex" data-example="1206|3">1206 ÷ 3</div>
          <div class="ex" data-example="5325|5">5325 ÷ 5</div>
          <div class="ex" data-example="70704|8">70704 ÷ 8</div>
          <div class="ex" data-example="10005|9">10005 ÷ 9</div>
        </div>

        <div class="section-title">操作</div>
        <div class="controls">
          <button class="btn" id="startBtn">开始演示</button>
          <button class="btn secondary" id="prevBtn" disabled>上一步</button>
          <button class="btn secondary" id="nextBtn" disabled>下一步</button>
          <button class="btn secondary" id="autoBtn" disabled>自动播放</button>
        </div>
        <div class="row" style="margin-top:8px;">
          <label>速度</label>
          <input id="speedSlider" class="slider" type="range" min="0.3" max="2.0" step="0.1" value="1.0">
          <span id="speedLabel" class="hint">1.0x</span>
        </div>

        <div id="errorBox" class="error" style="display:none;"></div>
      </div>

      <div class="right">
        <div id="boardContainer" class="board" aria-live="polite">
          <div style="color:#888;">请输入被除数和除数，点击“开始演示”。</div>
        </div>
        <div id="equationBox" class="eq" style="display:none;"></div>
        <div id="statusBox" class="status"></div>
        <div id="resultBox" class="result" style="display:none;"></div>
        <div class="footer">
          <div id="progressText" class="progress"></div>
          <div class="row">
            <button class="btn secondary" id="hintBtn" style="display:none;">提示</button>
            <button class="btn secondary" id="revealBtn" style="display:none;">显示答案</button>
            <button class="btn" id="finishBtn" style="display:none;">完成</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // State
    const state = {
      mode: 'explain', // 'explain' or 'practice'
      divisor: null,
      digits: [],
      steps: [], // {i,d,priorR,m,q,r}
      quotient: '',
      finalR: 0,
      pos: -1,
      playing: false,
      playTimer: null,
      speed: 1.0
    };

    // Elements
    const dividendInput = document.getElementById('dividendInput');
    const divisorInput = document.getElementById('divisorInput');
    const modeExplain = document.getElementById('modeExplain');
    const modePractice = document.getElementById('modePractice');
    const examples = document.querySelectorAll('.ex');

    const startBtn = document.getElementById('startBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const autoBtn = document.getElementById('autoBtn');
    const finishBtn = document.getElementById('finishBtn');
    const hintBtn = document.getElementById('hintBtn');
    const revealBtn = document.getElementById('revealBtn');
    const resetBtn = document.getElementById('resetBtn');

    const speedSlider = document.getElementById('speedSlider');
    const speedLabel = document.getElementById('speedLabel');

    const errorBox = document.getElementById('errorBox');
    const boardContainer = document.getElementById('boardContainer');
    const equationBox = document.getElementById('equationBox');
    const statusBox = document.getElementById('statusBox');
    const resultBox = document.getElementById('resultBox');
    const progressText = document.getElementById('progressText');

    // Utils
    const cleanIntString = s => (s || '').replace(/[^\d]/g, '');
    function validate(dividendStr, divisor) {
      if (!dividendStr) return '请输入被除数（正整数）。';
      if (!/^\d+$/.test(dividendStr)) return '被除数仅支持数字。';
      if (/^0+$/.test(dividendStr)) return '被除数不能为 0。';
      if (String(dividendStr).length > 20) return '被除数过长（最多 20 位）。';
      if (!divisor) return '请输入除数。';
      if (!Number.isInteger(divisor)) return '除数必须是整数。';
      if (divisor <= 0) return '除数必须为正整数（≥ 1）。';
      if (divisor >= 10) return '短除法教学建议除数为一位数（1~9）。';
      return null;
    }

    function computeSteps(dividendStr, divisor) {
      const digits = dividendStr.split('').map(d => Number(d));
      const steps = [];
      let r = 0, qStr = '';
      for (let i = 0; i < digits.length; i++) {
        const d = digits[i];
        const m = r * 10 + d;
        const q = Math.floor(m / divisor);
        const nr = m % divisor;
        steps.push({ i, d, priorR: r, m, q, r: nr });
        qStr += String(q);
        r = nr;
      }
      return { digits, steps, quotientRaw: qStr, finalR: r };
    }

    function buildBoard(digits, divisor, mode) {
      const quotientRow = document.createElement('div');
      quotientRow.className = 'quotient';
      digits.forEach((_, idx) => {
        const qc = document.createElement('div');
        qc.className = 'qcell' + (mode === 'practice' ? ' input' : '');
        qc.dataset.index = idx;
        if (mode === 'practice') {
          const inp = document.createElement('input');
          inp.type = 'text';
          inp.maxLength = 2;
          inp.inputMode = 'numeric';
          inp.placeholder = '';
          inp.addEventListener('keydown', e => {
            if (e.key === 'Enter') {
              // Try to commit this step
              tryCommitPractice(idx);
            }
          });
          qc.appendChild(inp);
        } else {
          qc.textContent = '';
        }
        quotientRow.appendChild(qc);
      });

      const mainRow = document.createElement('div');
      mainRow.className = 'main-row';

      const divBox = document.createElement('div');
      divBox.className = 'divisor';
      divBox.textContent = String(divisor);

      const bar = document.createElement('div');
      bar.className = 'bar';

      const digitsRow = document.createElement('div');
      digitsRow.className = 'digits';

      digits.forEach((d, idx) => {
        const cell = document.createElement('div');
        cell.className = 'digit';
        cell.dataset.index = idx;
        cell.textContent = String(d);
        digitsRow.appendChild(cell);
      });

      mainRow.appendChild(divBox);
      mainRow.appendChild(bar);
      mainRow.appendChild(digitsRow);

      const container = document.createElement('div');
      container.appendChild(quotientRow);
      container.appendChild(mainRow);
      return container;
    }

    function renderBoard() {
      boardContainer.innerHTML = '';
      const board = buildBoard(state.digits, state.divisor, state.mode);
      boardContainer.appendChild(board);
      equationBox.style.display = 'none';
      statusBox.textContent = '';
      resultBox.style.display = 'none';
      progressText.textContent = '';
      updateActiveStyles();
      updateControls();
      if (state.mode === 'practice') {
        hintBtn.style.display = 'inline-flex';
        revealBtn.style.display = 'inline-flex';
      } else {
        hintBtn.style.display = 'none';
        revealBtn.style.display = 'none';
      }
    }

    function updateActiveStyles() {
      const digitCells = boardContainer.querySelectorAll('.digit');
      digitCells.forEach(c => c.classList.remove('active', 'done'));
      for (let i = 0; i <= state.pos && i < digitCells.length; i++) {
        digitCells[i].classList.add('done');
      }
      if (state.pos >= 0 && state.pos < digitCells.length) {
        digitCells[state.pos].classList.remove('done');
        digitCells[state.pos].classList.add('active');
      }

      // Bubble labels: show remainder above current, and next carry
      digitCells.forEach(c => {
        const idx = Number(c.dataset.index);
        // clear bubbles
        c.querySelectorAll('.bubble').forEach(b => b.remove());
        const step = state.steps[idx];
        if (!step) return;
        if (idx === state.pos) {
          // Show current m as bubble
          const b = document.createElement('div');
          b.className = 'bubble accent';
          b.textContent = step.priorR > 0 ? `${step.priorR}×10+${step.d}=${step.m}` : `${step.d}`;
          c.appendChild(b);
        }
        if (idx === state.pos - 1) {
          // Show carried remainder going to this step
          const prev = state.steps[idx];
          if (prev) {
            const b2 = document.createElement('div');
            b2.className = 'bubble';
            b2.textContent = `余数 ${prev.r}`;
            c.appendChild(b2);
          }
        }
        if (idx <= state.pos) {
          // After finishing, show remainder above done cell
          const st = state.steps[idx];
          if (st) {
            const b3 = document.createElement('div');
            b3.className = 'bubble';
            b3.textContent = `余 ${st.r}`;
            c.appendChild(b3);
          }
        }
      });
    }

    function showEquation(i) {
      const s = state.steps[i];
      if (!s) {
        equationBox.style.display = 'none';
        return;
      }
      equationBox.style.display = 'block';
      const descCarry = s.priorR > 0
        ? `先把上一步的余数 ${s.priorR} 当作下一位的十位，与当前位 ${s.d} 组成 ${s.priorR}×10+${s.d}=${s.m}`
        : `当前位是 ${s.d}，上一步余数为 0，所以直接用 ${s.d}`;
      const eq = `<b>${s.m}</b> ÷ <b>${state.divisor}</b> = <b>${s.q}</b> … 余 <b>${s.r}</b>`;
      equationBox.innerHTML = `${descCarry}。然后：${eq}`;
    }

    function updateProgress() {
      const total = state.digits.length;
      const at = state.pos < 0 ? 0 : state.pos + 1;
      progressText.textContent = `步骤：${at} / ${total}`;
    }

    function updateControls() {
      const ready = state.steps.length > 0;
      prevBtn.disabled = !ready || state.pos <= 0;
      nextBtn.disabled = !ready || state.pos >= state.steps.length - 1;
      autoBtn.disabled = !ready;
      autoBtn.textContent = state.playing ? '暂停' : '自动播放';
      finishBtn.style.display = ready && state.pos >= state.steps.length - 1 ? 'inline-flex' : 'none';
    }

    function fillQuotientCell(i, value, ok=true) {
      const cell = boardContainer.querySelector(`.qcell[data-index="${i}"]`);
      if (!cell) return;
      if (state.mode === 'practice') {
        const inp = cell.querySelector('input');
        if (inp) {
          inp.value = value ?? '';
          inp.style.color = ok ? 'inherit' : 'var(--bad)';
        }
      } else {
        cell.textContent = String(value);
      }
      const digitCell = boardContainer.querySelector(`.digit[data-index="${i}"]`);
      if (digitCell) {
        digitCell.classList.remove('active');
        digitCell.classList.add('done');
      }
    }

    function showFinalResult() {
      const rawQ = state.steps.map(s => String(s.q)).join('');
      const trimmedQ = String(Number(rawQ)); // remove leading zeros
      resultBox.style.display = 'block';
      resultBox.innerHTML = `最终商：<b>${trimmedQ}</b>，余数：<b>${state.finalR}</b>`;
      statusBox.textContent = '提示：若余数不为 0，可继续除以 10（小数部分），本示例仅演示整数部分的短除法。';
    }

    // Step navigation
    function gotoStep(i, reveal=false) {
      if (i < 0) i = 0;
      if (i >= state.steps.length) i = state.steps.length - 1;
      state.pos = i;
      updateActiveStyles();
      showEquation(i);
      updateProgress();
      updateControls();

      const step = state.steps[i];
      const q = step.q;

      if (state.mode === 'explain') {
        fillQuotientCell(i, q, true);
      } else {
        const cell = boardContainer.querySelector(`.qcell[data-index="${i}"]`);
        const inp = cell?.querySelector('input');
        if (inp) {
          if (reveal) {
            inp.value = q;
            inp.style.color = 'inherit';
            fillQuotientCell(i, q, true);
          } else {
            // focus for user input
            inp.focus();
            inp.select?.();
          }
        }
      }

      if (i === state.steps.length - 1) {
        showFinalResult();
      } else {
        resultBox.style.display = 'none';
      }
    }

    function nextStep() {
      if (state.pos < state.steps.length - 1) {
        gotoStep(state.pos + 1);
      }
    }
    function prevStep() {
      if (state.pos > 0) {
        state.pos -= 1;
        // revert quotient cell if practice mode and user had filled wrong
        updateActiveStyles();
        showEquation(state.pos);
        updateProgress();
        updateControls();
      }
    }

    function startAuto() {
      state.playing = true;
      updateControls();
      const tick = () => {
        if (!state.playing) return;
        if (state.pos >= state.steps.length - 1) {
          state.playing = false;
          updateControls();
          return;
        }
        nextStep();
        const base = 1000; // ms
        const delay = base / state.speed;
        state.playTimer = setTimeout(tick, delay);
      };
      tick();
    }
    function stopAuto() {
      state.playing = false;
      clearTimeout(state.playTimer);
      state.playTimer = null;
      updateControls();
    }

    // Practice helpers
    function tryCommitPractice(idx) {
      if (idx !== state.pos) return;
      const step = state.steps[idx];
      const cell = boardContainer.querySelector(`.qcell[data-index="${idx}"]`);
      const inp = cell?.querySelector('input');
      if (!inp) return;
      const valStr = inp.value.trim();
      if (!valStr || !/^\d+$/.test(valStr)) {
        statusBox.textContent = '请输入该位的商（0~9）。';
        return;
      }
      const val = Number(valStr);
      if (val === step.q) {
        statusBox.innerHTML = `<span class="ok">✅ 正确：</span> ${step.m} ÷ ${state.divisor} = ${step.q} … 余 ${step.r}`;
        fillQuotientCell(idx, val, true);
        if (state.pos < state.steps.length - 1) {
          gotoStep(state.pos + 1);
        } else {
          showFinalResult();
        }
      } else {
        statusBox.innerHTML = `<span style="color:var(--bad);">❌ 再想想：</span> ${step.m} ÷ ${state.divisor} 不等于 ${val}`;
        // subtle shake animation
        inp.style.transition = 'transform .1s';
        inp.style.transform = 'translateX(4px)';
        setTimeout(() => { inp.style.transform = 'translateX(0)'; }, 120);
      }
    }

    // Initialization and interactions
    modeExplain.addEventListener('click', () => {
      state.mode = 'explain';
      modeExplain.classList.add('active');
      modePractice.classList.remove('active');
    });
    modePractice.addEventListener('click', () => {
      state.mode = 'practice';
      modePractice.classList.add('active');
      modeExplain.classList.remove('active');
    });

    examples.forEach(el => {
      el.addEventListener('click', () => {
        const [a, b] = el.dataset.example.split('|');
        dividendInput.value = a;
        divisorInput.value = b;
      });
    });

    startBtn.addEventListener('click', () => {
      stopAuto();
      errorBox.style.display = 'none';
      resultBox.style.display = 'none';
      statusBox.textContent = '';
      equationBox.style.display = 'none';

      const dividendStr = cleanIntString(dividendInput.value);
      const divisor = Number(divisorInput.value);
      const err = validate(dividendStr, divisor);
      if (err) {
        errorBox.textContent = err;
        errorBox.style.display = 'block';
        return;
      }
      const { digits, steps, quotientRaw, finalR } = computeSteps(dividendStr, divisor);
      Object.assign(state, { divisor, digits, steps, quotient: quotientRaw, finalR, pos: -1 });
      renderBoard();
      // start at step 0
      gotoStep(0);
    });

    prevBtn.addEventListener('click', prevStep);
    nextBtn.addEventListener('click', () => {
      if (state.mode === 'practice') {
        // In practice mode, ensure current input is correct before auto moving next
        const idx = state.pos;
        const cell = boardContainer.querySelector(`.qcell[data-index="${idx}"]`);
        const inp = cell?.querySelector('input');
        const val = inp?.value?.trim();
        if (!val) {
          statusBox.textContent = '请先填写该位的商。';
          inp?.focus();
          return;
        }
        tryCommitPractice(idx);
      } else {
        nextStep();
      }
    });

    autoBtn.addEventListener('click', () => {
      if (!state.steps.length) return;
      if (state.playing) stopAuto();
      else startAuto();
    });

    finishBtn.addEventListener('click', () => {
      showFinalResult();
    });

    hintBtn.addEventListener('click', () => {
      if (state.mode !== 'practice') return;
      const s = state.steps[state.pos];
      if (!s) return;
      statusBox.innerHTML = `提示：先算 <b>${s.priorR}×10+${s.d}=${s.m}</b>，再除以 <b>${state.divisor}</b>。`;
    });

    revealBtn.addEventListener('click', () => {
      if (state.mode !== 'practice') return;
      gotoStep(state.pos, true);
      statusBox.innerHTML = `本位答案：<b>${state.steps[state.pos].q}</b>`;
    });

    resetBtn.addEventListener('click', () => {
      stopAuto();
      dividendInput.value = '';
      divisorInput.value = '';
      Object.assign(state, {
        mode: state.mode, divisor: null, digits: [], steps: [], quotient: '', finalR: 0, pos: -1, playing: false
      });
      boardContainer.innerHTML = '<div style="color:#888;">请输入被除数和除数，点击“开始演示”。</div>';
      equationBox.style.display = 'none';
      statusBox.textContent = '';
      resultBox.style.display = 'none';
      errorBox.style.display = 'none';
      prevBtn.disabled = true;
      nextBtn.disabled = true;
      autoBtn.disabled = true;
      finishBtn.style.display = 'none';
      progressText.textContent = '';
    });

    speedSlider.addEventListener('input', () => {
      const v = Number(speedSlider.value);
      state.speed = v;
      speedLabel.textContent = `${v.toFixed(1)}x`;
    });

    // Keyboard support
    document.addEventListener('keydown', e => {
      if (!state.steps.length) return;
      if (e.key === 'ArrowRight') {
        nextBtn.click();
      } else if (e.key === 'ArrowLeft') {
        prevBtn.click();
      } else if (e.key === ' ') {
        e.preventDefault();
        autoBtn.click();
      }
    });

    // Initial guidance text
    statusBox.textContent = '说明：短除法每一步都会用“上一步的余数×10 + 当前位”来得到一个新的数，再用除数相除得到该位的商与新的余数。';
  </script>
</body>
</html>