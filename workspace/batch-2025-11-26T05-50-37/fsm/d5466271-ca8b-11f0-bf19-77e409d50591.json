{
  "topic": "Stack",
  "description": "Finite State Machine for the interactive Stack Visualizer application (array-backed and linked-list implementations). Models user-driven operations (push/pop/peek/clear), mode switching, batch/auto demos, history stepping and undo, and transient warning states for overflow/underflow.",
  "states": [
    {
      "name": "idle",
      "onEnter": "update",
      "onExit": "noop",
      "on": {
        "PUSH_CLICKED": "pushing",
        "POP_CLICKED": "popping",
        "PEEK_CLICKED": "peeking",
        "CLEAR_CLICKED": "clearing",
        "RAND_CLICKED": "pushing",
        "CAPACITY_CHANGED": "capacitySetting",
        "BULK_PUSH_CLICKED": "bulkPushing",
        "AUTO_DEMO_CLICKED": "autoDemoRunning",
        "MODE_SWITCHED": "modeSwitching",
        "STEP_PREV_CLICKED": "historyViewing",
        "STEP_NEXT_CLICKED": "historyViewing",
        "UNDO_CLICKED": "undoing",
        "ENTER_PRESSED_ON_VALUE": "pushing",
        "CTRL_PRESSED_P": "popping"
      }
    },
    {
      "name": "pushing",
      "onEnter": "push(valueInput.value.trim()) // if empty => flash('warn') & log",
      "onExit": "update, saveSnapshot (on successful push)",
      "on": {
        "OP_SUCCESS": "idle",
        "OP_OVERFLOW": "warning",
        "OP_FAILURE": "idle"
      }
    },
    {
      "name": "popping",
      "onEnter": "pop()",
      "onExit": "update, saveSnapshot (on successful pop)",
      "on": {
        "OP_SUCCESS": "idle",
        "OP_UNDERFLOW": "warning",
        "OP_FAILURE": "idle"
      }
    },
    {
      "name": "peeking",
      "onEnter": "peek()",
      "onExit": "update",
      "on": {
        "OP_SUCCESS": "idle",
        "OP_EMPTY": "warning"
      }
    },
    {
      "name": "clearing",
      "onEnter": "clearAll()",
      "onExit": "update, saveSnapshot",
      "on": {
        "OP_SUCCESS": "idle"
      }
    },
    {
      "name": "bulkPushing",
      "onEnter": "for (i=0..Number(#bulkInput.value)) push(random) (skips invalid n => flash('warn'))",
      "onExit": "update, saveSnapshot",
      "on": {
        "OP_COMPLETE": "idle",
        "OP_OVERFLOW": "warning"
      }
    },
    {
      "name": "autoDemoRunning",
      "onEnter": "autoDemo() // runs async sequence of push/pop/peek with delays",
      "onExit": "update",
      "on": {
        "AUTO_DEMO_STEP": "autoDemoRunning",
        "AUTO_DEMO_COMPLETE": "idle",
        "OP_OVERFLOW": "warning",
        "OP_UNDERFLOW": "warning"
      }
    },
    {
      "name": "modeSwitching",
      "onEnter": "setMode(mode) // UI toggle, set capacity behavior and saveSnapshot('modeSwitch')",
      "onExit": "update",
      "on": {
        "OP_SUCCESS": "idle"
      }
    },
    {
      "name": "capacitySetting",
      "onEnter": "capInput change handler -> set capacity, saveSnapshot('setCapacity')",
      "onExit": "update",
      "on": {
        "OP_SUCCESS": "idle",
        "OP_INVALID_CAPACITY": "warning"
      }
    },
    {
      "name": "historyViewing",
      "onEnter": "restoreSnapshot(historyIndex) // triggered by Prev/Next stepping",
      "onExit": "update",
      "on": {
        "STEP_PREV_CLICKED": "historyViewing",
        "STEP_NEXT_CLICKED": "historyViewing",
        "STEP_END_REACHED": "idle",
        "OP_FAILURE": "idle"
      }
    },
    {
      "name": "undoing",
      "onEnter": "undo (pop last snapshot, restore previous, update)",
      "onExit": "update",
      "on": {
        "UNDO_SUCCESS": "idle",
        "UNDO_INVALID": "warning"
      }
    },
    {
      "name": "warning",
      "onEnter": "flash('warn'), log warning message",
      "onExit": "update",
      "on": {
        "ACK": "idle"
      }
    }
  ],
  "events": [
    "PUSH_CLICKED",
    "POP_CLICKED",
    "PEEK_CLICKED",
    "CLEAR_CLICKED",
    "RAND_CLICKED",
    "CAPACITY_CHANGED",
    "BULK_PUSH_CLICKED",
    "AUTO_DEMO_CLICKED",
    "MODE_SWITCHED",
    "STEP_PREV_CLICKED",
    "STEP_NEXT_CLICKED",
    "UNDO_CLICKED",
    "ENTER_PRESSED_ON_VALUE",
    "CTRL_PRESSED_P",
    "OP_SUCCESS",
    "OP_FAILURE",
    "OP_OVERFLOW",
    "OP_UNDERFLOW",
    "OP_EMPTY",
    "OP_COMPLETE",
    "AUTO_DEMO_STEP",
    "AUTO_DEMO_COMPLETE",
    "STEP_END_REACHED",
    "UNDO_SUCCESS",
    "UNDO_INVALID",
    "ACK"
  ],
  "triggers": {
    "PUSH_CLICKED": "#pushBtn, #valueInput (Enter key triggers #pushBtn)",
    "POP_CLICKED": "#popBtn, (Ctrl+P mapped to pop action)",
    "PEEK_CLICKED": "#peekBtn",
    "CLEAR_CLICKED": "#clearBtn",
    "RAND_CLICKED": "#randBtn",
    "CAPACITY_CHANGED": "#capInput",
    "BULK_PUSH_CLICKED": "#bulkPush",
    "AUTO_DEMO_CLICKED": "#autoDemo",
    "MODE_SWITCHED": "#modeToggle button[data-mode=\"array\"], #modeToggle button[data-mode=\"linked\"]",
    "STEP_PREV_CLICKED": "#stepPrev",
    "STEP_NEXT_CLICKED": "#stepNext",
    "UNDO_CLICKED": "#undoBtn",
    "ENTER_PRESSED_ON_VALUE": "#valueInput",
    "CTRL_PRESSED_P": "#popBtn"
  },
  "notes": "Triggers map UI interactions to FSM events. Exact selectors extracted from HTML: #modeToggle button[data-mode=\"array\"], #modeToggle button[data-mode=\"linked\"], #pushBtn, #popBtn, #peekBtn, #clearBtn, #randBtn, #capInput, #bulkInput, #bulkPush, #autoDemo, #stepPrev, #stepNext, #undoBtn, #valueInput. Transient 'warning' state corresponds to flash('warn') calls (overflow/underflow/invalid input). History stepping/undo operate over saved snapshots via saveSnapshot()/restoreSnapshot(). Auto demo runs an async sequence (autoDemo())."
}