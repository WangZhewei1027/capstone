<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Bubble Sort Visualizer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#0f1724;
      --panel:#0b1220;
      --accent:#38bdf8;
      --muted:#94a3b8;
      --good:#34d399;
      --bad:#fb7185;
      --bar-gap:4px;
    }
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);color:#e6eef6}
    .app{display:flex;flex-direction:column;height:100%;padding:16px;box-sizing:border-box;gap:12px}
    header{display:flex;align-items:center;gap:12px}
    h1{font-size:18px;margin:0}
    .controls{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .panel{background:linear-gradient(180deg,var(--panel),#071025);padding:12px;border-radius:8px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .row{display:flex;gap:8px;align-items:center}
    label{font-size:13px;color:var(--muted)}
    input[type=range]{width:160px}
    button{background:var(--accent);border:none;color:#042033;padding:8px 12px;border-radius:6px;cursor:pointer;font-weight:600}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);padding:8px 10px}
    button:disabled{opacity:.4;cursor:not-allowed}
    .main{display:flex;gap:12px;flex:1;min-height:0}
    .visual{flex:1;display:flex;flex-direction:column;gap:12px}
    .bars{flex:1;background:linear-gradient(180deg,#071428,#071428);display:flex;align-items:end;padding:12px;border-radius:8px;gap:var(--bar-gap);overflow:hidden}
    .bar{background:linear-gradient(180deg,var(--accent),#0ea5b7);flex:1;border-radius:4px 4px 2px 2px;transition:height 300ms ease, background-color 200ms ease;display:flex;align-items:end;justify-content:center;color:rgba(255,255,255,0.9);font-size:11px}
    .bar.small{font-size:10px}
    .bar.compare{background:linear-gradient(180deg,#f97316,#fb923c)}
    .bar.swap{background:linear-gradient(180deg,#fb7185,#f43f5e)}
    .bar.sorted{background:linear-gradient(180deg,var(--good),#10b981)}
    .info{width:320px;display:flex;flex-direction:column;gap:12px}
    pre{margin:0;background:transparent;color:var(--muted);font-size:13px;line-height:1.4}
    .pseudocode{background:linear-gradient(180deg,#071022,#081227);padding:8px;border-radius:6px;min-height:120px}
    .line{padding:6px;border-radius:4px}
    .line.current{background:linear-gradient(90deg,rgba(56,189,248,0.08),transparent);color:var(--accent);font-weight:600}
    .stats{display:flex;flex-direction:column;gap:6px}
    .stat{display:flex;justify-content:space-between;color:var(--muted);font-size:13px}
    footer{display:flex;justify-content:space-between;align-items:center}
    .small{font-size:12px;color:var(--muted)}
    @media (max-width:900px){
      .main{flex-direction:column}
      .info{width:auto}
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Bubble Sort Visualizer</h1>
      <div class="small">Demonstrates step-by-step bubble sort with animated swaps, comparisons, and counters.</div>
    </header>

    <div class="controls panel row">
      <div class="row">
        <label>Size</label>
        <input id="size" type="range" min="5" max="60" value="30">
        <div id="sizeVal" class="small">30</div>
      </div>

      <div class="row">
        <label>Speed</label>
        <input id="speed" type="range" min="1" max="100" value="50">
        <div id="speedVal" class="small">Medium</div>
      </div>

      <div class="row">
        <button id="shuffleBtn">Generate</button>
        <button id="playBtn">Play</button>
        <button id="stepBackBtn" class="secondary">Step ◀</button>
        <button id="stepFwdBtn" class="secondary">Step ▶</button>
        <button id="resetBtn" class="secondary">Reset</button>
      </div>
    </div>

    <div class="main">
      <div class="visual">
        <div class="panel" style="display:flex;justify-content:space-between;align-items:center">
          <div class="small">Array visualization</div>
          <div class="small" id="status">Idle</div>
        </div>
        <div id="bars" class="bars panel" aria-hidden="false"></div>
        <div style="display:flex;gap:8px;justify-content:space-between">
          <div class="small">Comparisons: <strong id="compCount">0</strong></div>
          <div class="small">Swaps: <strong id="swapCount">0</strong></div>
          <div class="small">Step: <strong id="stepIdx">0</strong>/<strong id="totalSteps">0</strong></div>
        </div>
      </div>

      <div class="info">
        <div class="panel pseudocode">
          <div style="font-weight:700;margin-bottom:6px">Pseudocode</div>
          <div id="line1" class="line">1. for i = 0 to n-1</div>
          <div id="line2" class="line">2.   for j = 0 to n-i-2</div>
          <div id="line3" class="line">3.     if arr[j] &gt; arr[j+1]</div>
          <div id="line4" class="line">4.       swap arr[j], arr[j+1]</div>
        </div>

        <div class="panel stats">
          <div class="stat"><div>Array</div><div id="arrText" style="font-family:monospace"></div></div>
          <div class="stat"><div>Current i, j</div><div id="ijText">-</div></div>
          <div class="stat"><div>Time Complexity</div><div>O(n²) (worst/average), O(n) (best, already sorted)</div></div>
          <div class="stat"><div>Space Complexity</div><div>O(1)</div></div>
        </div>
      </div>
    </div>

    <footer>
      <div class="small">Tip: press Generate to create a new array. Use Play to animate all steps or Step to move one step at a time.</div>
      <div class="small">Bubble sort is stable and compares adjacent elements repeatedly.</div>
    </footer>
  </div>

  <script>
    // Bubble Sort Visualizer
    (function(){
      // DOM
      const barsEl = document.getElementById('bars');
      const sizeEl = document.getElementById('size');
      const sizeVal = document.getElementById('sizeVal');
      const speedEl = document.getElementById('speed');
      const speedVal = document.getElementById('speedVal');
      const shuffleBtn = document.getElementById('shuffleBtn');
      const playBtn = document.getElementById('playBtn');
      const stepBackBtn = document.getElementById('stepBackBtn');
      const stepFwdBtn = document.getElementById('stepFwdBtn');
      const resetBtn = document.getElementById('resetBtn');
      const compCountEl = document.getElementById('compCount');
      const swapCountEl = document.getElementById('swapCount');
      const stepIdxEl = document.getElementById('stepIdx');
      const totalStepsEl = document.getElementById('totalSteps');
      const arrText = document.getElementById('arrText');
      const ijText = document.getElementById('ijText');
      const statusEl = document.getElementById('status');
      const lineEls = [null, document.getElementById('line1'), document.getElementById('line2'), document.getElementById('line3'), document.getElementById('line4')];

      // State
      let array = [];
      let steps = []; // each step: {arr:[], type:'init'|'compare'|'swap'|'finish', i, j}
      let current = 0;
      let playing = false;
      let timer = null;
      let comparisons = 0, swaps = 0;

      // init
      sizeVal.textContent = sizeEl.value;
      updateSpeedLabel();

      function randomArray(n){
        const arr = [];
        for(let i=0;i<n;i++){
          arr.push(Math.floor(Math.random()*100)+1);
        }
        return arr;
      }

      function copyArr(a){ return a.slice(); }

      // build steps for bubble sort: we record a step for each comparison and each swap; we also store arr snapshot at each step
      function buildBubbleSteps(input){
        const a = input.slice();
        const n = a.length;
        const s = [];
        s.push({arr:copyArr(a), type:'init', i:-1, j:-1});
        for(let i=0;i<n;i++){
          let swapped = false;
          for(let j=0;j<n-i-1;j++){
            // comparison step
            s.push({arr:copyArr(a), type:'compare', i:i, j:j});
            if(a[j] > a[j+1]){
              // swap
              const tmp = a[j]; a[j]=a[j+1]; a[j+1]=tmp;
              swapped = true;
              s.push({arr:copyArr(a), type:'swap', i:i, j:j});
            }
          }
          // after each pass, optionally mark element as in-place (we'll use arr snapshot)
          if(!swapped){
            break; // early exit optimization recorded by final steps
          }
        }
        s.push({arr:copyArr(a), type:'finish', i:-1, j:-1});
        return s;
      }

      function renderBars(vals, highlightIndices = [], modeMap = {}) {
        // modeMap: index -> 'compare'|'swap'|'sorted'
        barsEl.innerHTML = '';
        const n = vals.length;
        const max = Math.max(...vals, 1);
        for(let i=0;i<n;i++){
          const v = vals[i];
          const bar = document.createElement('div');
          bar.className = 'bar';
          if(n>40) bar.classList.add('small');
          const h = Math.max(6, Math.round((v / max) * 100)); // percent-ish
          bar.style.height = h + '%';
          bar.style.transitionDuration = Math.max(40, 600 - speedEl.value*5) + 'ms';
          if(modeMap[i]) bar.classList.add(modeMap[i]);
          // show value if few bars
          if(n <= 30) bar.textContent = v;
          barsEl.appendChild(bar);
        }
      }

      function setStatus(t){
        statusEl.textContent = t;
      }

      function computeCountsUpTo(idx){
        let c=0,s=0;
        for(let k=0;k<=idx && k<steps.length;k++){
          if(steps[k].type === 'compare') c++;
          if(steps[k].type === 'swap') s++;
        }
        return {c,s};
      }

      function updateUIForStep(idx){
        const step = steps[idx];
        // display array snapshot
        renderBars(step.arr);
        arrText.textContent = '[' + step.arr.join(', ') + ']';
        stepIdxEl.textContent = idx;
        totalStepsEl.textContent = steps.length - 1;
        // highlight pseudocode
        lineEls.forEach((el,i)=>{ if(el) el.classList.remove('current'); });
        if(step.type === 'compare'){
          lineEls[3].classList.add('current'); // if arr[j] > arr[j+1]
          highlightBars(step.arr, step.j, step.j+1, 'compare');
          ijText.textContent = 'i=' + step.i + ', j=' + step.j;
        } else if(step.type === 'swap'){
          lineEls[4].classList.add('current'); // swap
          highlightBars(step.arr, step.j, step.j+1, 'swap');
          ijText.textContent = 'i=' + step.i + ', j=' + step.j;
        } else if(step.type === 'init'){
          lineEls[1].classList.add('current'); // for i...
          ijText.textContent = '-';
        } else if(step.type === 'finish'){
          lineEls[1].classList.add('current');
          // mark all sorted
          renderBars(step.arr, [], createSortedMap(step.arr.length));
          ijText.textContent = '-';
        }
        const counts = computeCountsUpTo(idx);
        comparisons = counts.c;
        swaps = counts.s;
        compCountEl.textContent = comparisons;
        swapCountEl.textContent = swaps;
        // status
        setStatus(playing ? 'Playing' : 'Paused');
      }

      function createSortedMap(n){
        const map = {};
        for(let i=0;i<n;i++) map[i] = 'sorted';
        return map;
      }

      function highlightBars(arr, i, j, cls){
        const mode = {};
        mode[i] = cls;
        mode[j] = cls;
        renderBars(arr, [i,j], mode);
      }

      function goToStep(idx){
        current = Math.max(0, Math.min(idx, steps.length-1));
        updateUIForStep(current);
      }

      function playAll(){
        if(playing) return;
        if(current >= steps.length-1){
          setStatus('Already finished');
          return;
        }
        playing = true;
        playBtn.textContent = 'Pause';
        setStatus('Playing');
        scheduleNext();
      }

      function pause(){
        playing = false;
        playBtn.textContent = 'Play';
        setStatus('Paused');
        if(timer) clearTimeout(timer);
        timer = null;
      }

      function scheduleNext(){
        if(!playing) return;
        if(current >= steps.length-1){
          playing = false;
          playBtn.textContent = 'Play';
          setStatus('Finished');
          updateUIForStep(steps.length-1);
          return;
        }
        const step = steps[current+1];
        // set transition delay according to speed
        const durationMs = Math.max(40, 600 - speedEl.value*5);
        // advance
        timer = setTimeout(()=>{
          current++;
          updateUIForStep(current);
          // continue
          scheduleNext();
        }, durationMs + 60);
      }

      function reset(){
        pause();
        if(steps.length){
          current = 0;
          comparisons = 0; swaps = 0;
          updateUIForStep(0);
        }
      }

      // build initial
      function generateAndPrepare(){
        pause();
        array = randomArray(parseInt(sizeEl.value,10));
        steps = buildBubbleSteps(array);
        current = 0;
        comparisons = 0; swaps = 0;
        updateUIForStep(0);
      }

      // Event handlers
      shuffleBtn.addEventListener('click', ()=>{ generateAndPrepare(); });
      sizeEl.addEventListener('input', ()=>{
        sizeVal.textContent = sizeEl.value;
      });
      speedEl.addEventListener('input', ()=>{
        updateSpeedLabel();
      });

      function updateSpeedLabel(){
        const v = parseInt(speedEl.value,10);
        let label = 'Medium';
        if(v < 30) label = 'Slow';
        else if(v > 70) label = 'Fast';
        speedVal.textContent = label;
      }

      playBtn.addEventListener('click', ()=>{
        if(!steps.length) generateAndPrepare();
        if(playing) pause(); else playAll();
      });

      stepFwdBtn.addEventListener('click', ()=>{
        pause();
        if(!steps.length) generateAndPrepare();
        if(current < steps.length-1){ current++; updateUIForStep(current); }
      });

      stepBackBtn.addEventListener('click', ()=>{
        pause();
        if(!steps.length) generateAndPrepare();
        if(current > 0){ current--; updateUIForStep(current); }
      });

      resetBtn.addEventListener('click', ()=>{
        generateAndPrepare();
      });

      // initial generate
      generateAndPrepare();

      // keyboard shortcuts
      document.addEventListener('keydown', (e)=>{
        if(e.code === 'Space'){ e.preventDefault(); playBtn.click(); }
        if(e.code === 'ArrowRight'){ stepFwdBtn.click(); }
        if(e.code === 'ArrowLeft'){ stepBackBtn.click(); }
      });

      // ensure window resizes keep bars transition reasonable
      window.addEventListener('resize', ()=> updateUIForStep(current));
    })();
  </script>
</body>
</html>