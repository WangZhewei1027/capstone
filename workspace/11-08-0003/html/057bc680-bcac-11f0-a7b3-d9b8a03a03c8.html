<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heap Sort Interactive Module</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 24px;
        }
        h1 {
            text-align: center;
        }
        #input-section, #heap-visualization, #controls {
            display: inline-block;
            vertical-align: top;
            margin-top: 16px;
        }
        #input-section {
            width: 30%;
        }
        #heap-visualization {
            width: 40%;
            border: 1px solid #ccc;
            height: 300px;
            position: relative;
        }
        #controls {
            width: 25%;
        }
        button, input[type="text"] {
            width: 100%;
            margin: 8px 0;
        }
        .heap-node {
            position: absolute;
            padding: 5px;
            background-color: lightblue;
            border-radius: 4px;
            transition: transform 0.3s;
            text-align: center;
        }
        .sorted {
            background-color: lightgreen;
        }
    </style>
</head>
<body>
    <h1>Understanding Heap Sort</h1>
    <div id="input-section">
        <h2>Input Array</h2>
        <input type="text" id="arrayInput" placeholder="Enter numbers separated by commas">
        <button id="createHeap">Create Heap</button>
        <button id="randomArray">Random Array</button>
        <button id="ascendingArray">Ascending Array</button>
        <button id="descendingArray">Descending Array</button>
    </div>
    <div id="heap-visualization"></div>
    <div id="controls">
        <h2>Controls</h2>
        <button id="sort">Sort</button>
        <input type="range" id="speedControl" min="100" max="2000" value="1000">
        <label for="speedControl">Animation Speed (ms)</label>
        <div id="output"></div>
    </div>

    <script>
        const createHeapBtn = document.getElementById('createHeap');
        const arrayInput = document.getElementById('arrayInput');
        const heapDiv = document.getElementById('heap-visualization');
        const sortBtn = document.getElementById('sort');
        const outputDiv = document.getElementById('output');
        const speedControl = document.getElementById('speedControl');

        let array = [];
        
        createHeapBtn.addEventListener('click', () => {
            const input = arrayInput.value.split(',').map(num => parseInt(num.trim())).filter(num => !isNaN(num));
            array = input;
            buildHeap();
        });

        function buildHeap() {
            heapDiv.innerHTML = '';
            const heap = new MinHeap(array);
            renderHeap(heap);
        }

        function renderHeap(heap) {
            const nodes = heap.heap;
            const height = Math.ceil(Math.log2(nodes.length + 1));
            const levels = Array.from({length: height}, (_, i) => []);

            nodes.forEach((value, index) => {
                const level = Math.floor(Math.log2(index + 1));
                levels[level].push(value);
            });

            let left = 50, top = 20;
            levels.forEach(level => {
                let width = (100 / level.length) / (levels.length - 1);
                let x = left;
                level.forEach(value => {
                    const nodeDiv = document.createElement('div');
                    nodeDiv.className = 'heap-node';
                    nodeDiv.textContent = value;

                    nodeDiv.style.left = `${x}%`;
                    nodeDiv.style.top = `${top}px`;
                    heapDiv.appendChild(nodeDiv);
                    x += width;
                });
                top += 50;
            });
        }

        class MinHeap {
            constructor(array) {
                this.heap = [];
                this.buildHeap(array);
            }

            buildHeap(array) {
                this.heap = array.slice();
                for (let i = Math.floor(this.heap.length / 2) - 1; i >= 0; i--) {
                    this.heapifyDown(i);
                }
            }

            heapifyDown(index) {
                let left = 2 * index + 1;
                let right = 2 * index + 2;
                let smallest = index;
                
                if (left < this.heap.length && this.heap[left] < this.heap[smallest]) {
                    smallest = left;
                }
                if (right < this.heap.length && this.heap[right] < this.heap[smallest]) {
                    smallest = right;
                }
                if (smallest !== index) {
                    [this.heap[index], this.heap[smallest]] = [this.heap[smallest], this.heap[index]];
                    this.heapifyDown(smallest);
                }
            }
        }

        sortBtn.addEventListener('click', () => {
            outputDiv.innerHTML = '';
            const heap = new MinHeap(array);
            heapSort(heap);
        });

        function heapSort(heap) {
            const sortedArray = [];
            while (heap.heap.length > 0) {
                // Move the root to the end of the sorted array
                sortedArray.push(heap.heap[0]);
                heap.heap[0] = heap.heap.pop();
                renderHeap(heap);
                heap.heapifyDown(0);
            }
            displayOutput(sortedArray);
        }

        function displayOutput(sortedArray) {
            outputDiv.innerHTML = `<h3>Sorted Array: ${sortedArray.join(', ')}</h3>`;
        }
        
        // Additional handlers for random and predefined arrays can be added here

    </script>
</body>
</html>