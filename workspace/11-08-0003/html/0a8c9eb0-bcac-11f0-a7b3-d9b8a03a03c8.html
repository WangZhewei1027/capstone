<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merge Sort Visualization</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 24px;
            background-color: #f0f0f0;
        }
        h1 {
            margin-bottom: 16px;
        }
        #inputArea {
            margin-bottom: 16px;
        }
        input {
            padding: 8px;
            font-size: 16px;
            width: 300px;
        }
        button {
            padding: 10px 16px;
            margin: 8px;
            cursor: pointer;
            font-size: 16px;
        }
        #canvas {
            width: 100%;
            height: 300px;
            background-color: #fff;
            border: 1px solid #ccc;
            margin-top: 16px;
        }
    </style>
</head>
<body>

<h1>Understanding Merge Sort: A Visual Guide</h1>

<div id="inputArea">
    <input type="text" id="numbers" placeholder="Enter numbers (e.g., 38,27,43,3)" />
    <button id="generate">Generate Random Numbers</button>
</div>

<div>
    <button id="start">Start Sort</button>
    <button id="step">Step Through</button>
    <button id="reset">Reset</button>
</div>

<canvas id="canvas"></canvas>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let numbers = [];
    let sortedStep = 0;

    document.getElementById('generate').onclick = function() {
        numbers = Array.from({length: 10}, () => Math.floor(Math.random() * 100));
        document.getElementById('numbers').value = numbers.join(',');
        drawCanvas();
    }

    document.getElementById('start').onclick = async function() {
        numbers = document.getElementById('numbers').value.split(',').map(Number);
        await mergeSort(numbers, 0, numbers.length - 1);
    }

    document.getElementById('step').onclick = async function() {
        if (sortedStep < numbers.length) {
            await mergeSort(numbers, 0, numbers.length - 1, true);
        }
    }

    document.getElementById('reset').onclick = function() {
        numbers = [];
        sortedStep = 0;
        drawCanvas();
    }

    async function mergeSort(arr, left, right, isStepping=false) {
        if (left < right) {
            const mid = Math.floor((left + right) / 2);
            await mergeSort(arr, left, mid, isStepping);
            await mergeSort(arr, mid + 1, right, isStepping);
            await merge(arr, left, mid, right, isStepping);
            return isStepping ? new Promise(resolve => setTimeout(resolve, 500)) : null;
        }
    }

    async function merge(arr, left, mid, right, isStepping) {
        let leftArray = arr.slice(left, mid + 1);
        let rightArray = arr.slice(mid + 1, right + 1);
        let i = 0, j = 0, k = left;
        
        while (i < leftArray.length && j < rightArray.length) {
            if (leftArray[i] <= rightArray[j]) {
                arr[k++] = leftArray[i++];
            } else {
                arr[k++] = rightArray[j++];
            }
            sortedStep++;
            drawCanvas();
            if (isStepping) await new Promise(resolve => setTimeout(resolve, 500));
        }
        
        while (i < leftArray.length) arr[k++] = leftArray[i++];
        while (j < rightArray.length) arr[k++] = rightArray[j++];
        
        if (!isStepping) drawCanvas();
    }

    function drawCanvas() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        let width = canvas.width / numbers.length;
        numbers.forEach((num, index) => {
            ctx.fillStyle = 'lightblue';
            ctx.fillRect(index * width, canvas.height - num * 3, width - 2, num * 3);
        });
    }
</script>
</body>
</html>