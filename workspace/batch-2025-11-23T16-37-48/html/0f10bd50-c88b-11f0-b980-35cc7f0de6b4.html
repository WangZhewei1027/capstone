<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>队列 (Queue) 交互式可视化演示</title>
<style>
  body {
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    margin: 20px;
    background: #f0f4f8;
    color: #333;
  }
  h1 {
    text-align: center;
    margin-bottom: 10px;
  }
  #queue-container {
    margin: 20px auto;
    width: 80%;
    max-width: 800px;
    height: 120px;
    border: 2px solid #333;
    border-radius: 8px;
    background-color: #fff;
    display: flex;
    align-items: center;
    padding: 10px;
    overflow-x: auto;
  }

  .node {
    min-width: 60px;
    height: 60px;
    background-color: #4a90e2;
    color: white;
    margin-right: 12px;
    font-weight: bold;
    font-size: 20px;
    line-height: 60px;
    border-radius: 8px;
    position: relative;
    user-select: none;
    box-shadow: 0 3px 6px rgb(74 144 226 / 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
  }

  /* Tail and Head labels */
  .node::after {
    content: "";
    position: absolute;
    top: -20px;
    right: 5px;
    font-weight: normal;
    font-size: 12px;
    color: #222;
  }
  .node.head::after {
    content: "Front";
    color: #e94e77;
  }
  .node.tail::after {
    content: "Rear";
    color: #27ae60;
    right: auto;
    left: 5px;
  }

  #controls {
    margin: 0 auto;
    max-width: 800px;
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 15px;
  }
  #controls input[type="number"] {
    width: 100px;
    font-size: 18px;
    padding: 5px 10px;
    border-radius: 6px;
    border: 2px solid #ccc;
    transition: border-color 0.3s ease;
  }
  #controls input[type="number"]:focus {
    outline: none;
    border-color: #4a90e2;
  }
  button {
    background-color: #4a90e2;
    border: none;
    color: white;
    padding: 10px 18px;
    font-size: 18px;
    cursor: pointer;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgb(74 144 226 / 0.6);
    transition: background-color 0.3s ease;
    user-select: none;
  }
  button:hover:not(:disabled) {
    background-color: #357ABD;
  }
  button:disabled {
    background-color: #a4c1f9;
    cursor: default;
    box-shadow: none;
  }
  #message {
    max-width: 800px;
    margin: 15px auto;
    font-size: 18px;
    text-align: center;
    min-height: 28px;
    color: #e94e77;
    font-weight: bold;
    user-select: none;
  }
  /* Animation */
  .enqueue-animation {
    animation: enqueueMove 0.7s ease forwards;
  }
  .dequeue-animation {
    animation: dequeueMove 0.7s ease forwards;
  }
  @keyframes enqueueMove {
    0% {
      transform: translateY(-50px) scale(1.2);
      opacity: 0;
    }
    100% {
      transform: translateY(0) scale(1);
      opacity: 1;
    }
  }
  @keyframes dequeueMove {
    0% {
      transform: translateX(0) scale(1);
      opacity: 1;
    }
    100% {
      transform: translateX(50px) scale(1.3);
      opacity: 0;
    }
  }

  /* Scrollbar for queue container */
  #queue-container::-webkit-scrollbar {
    height: 8px;
  }
  #queue-container::-webkit-scrollbar-track {
    background: #eee;
    border-radius: 4px;
  }
  #queue-container::-webkit-scrollbar-thumb {
    background: #4a90e2;
    border-radius: 4px;
  }

  /* Responsive */
  @media (max-width: 500px) {
    .node {
      min-width: 50px;
      height: 50px;
      font-size: 16px;
      line-height: 50px;
      margin-right: 8px;
    }
    #controls {
      flex-direction: column;
      gap: 12px;
    }
    #controls input[type="number"], button {
      width: 100%;
      max-width: 300px;
      font-size: 16px;
      padding: 8px 12px;
    }
  }
</style>
</head>
<body>
  <h1>队列 (Queue) 交互式可视化演示</h1>

  <div id="queue-container" aria-label="队列可视化区域" role="list"></div>

  <div id="message" aria-live="polite" aria-atomic="true"></div>

  <div id="controls" role="region" aria-label="队列操作控制面板">
    <input id="enqueue-input" type="number" aria-label="输入要入队的数字" placeholder="输入数字" />
    <button id="enqueue-btn" aria-describedby="enqueue-desc">入队 (Enqueue)</button>
    <button id="dequeue-btn" aria-describedby="dequeue-desc">出队 (Dequeue)</button>
    <button id="clear-btn" aria-describedby="clear-desc">清空队列 (Clear)</button>
  </div>

  <div style="width:80%; max-width:800px; margin:15px auto; font-size:14px; color:#555; text-align:center;">
    <p id="enqueue-desc">将输入的数字添加到队列的尾部。</p>
    <p id="dequeue-desc">移除队列头部的元素。</p>
    <p id="clear-desc">清空整个队列。</p>
  </div>

<script>
  (function(){
    const queueContainer = document.getElementById("queue-container");
    const enqueueBtn = document.getElementById("enqueue-btn");
    const dequeueBtn = document.getElementById("dequeue-btn");
    const clearBtn = document.getElementById("clear-btn");
    const enqueueInput = document.getElementById("enqueue-input");
    const message = document.getElementById("message");

    // 队列数据结构（用数组实现）
    let queue = [];

    // 动画时长(ms)
    const ANIMATION_DURATION = 700;

    // 更新UI显示队列内容
    function renderQueue(animatedNode = null, action = '') {
      // 清空容器，重新生成
      queueContainer.innerHTML = "";
      queue.forEach((value, index) => {
        const node = document.createElement("div");
        node.classList.add("node");
        node.textContent = value;
        node.setAttribute("role", "listitem");

        // 头尾节点标记
        if (index === 0) node.classList.add("head");
        if (index === queue.length - 1) node.classList.add("tail");
        queueContainer.appendChild(node);
      });

      // 动画处理
      if (animatedNode) {
        // Use absolute positioned clone during animation
        const animNode = animatedNode.cloneNode(true);
        animNode.style.position = "absolute";
        animNode.style.zIndex = 1000;
        animNode.style.width = animatedNode.offsetWidth + "px";
        animNode.style.height = animatedNode.offsetHeight + "px";

        // Calculate start position:
        // For enqueue: start above container center, move down into tail position
        // For dequeue: start at head node position, move right and fade

        if (action === "enqueue") {
          const containerRect = queueContainer.getBoundingClientRect();
          const tailNode = queueContainer.querySelector(".node.tail");
          let tailRect;
          if (tailNode) {
            tailRect = tailNode.getBoundingClientRect();
          } else {
            // Queue empty: put at left+some padding
            tailRect = { left: containerRect.left + 10, top: containerRect.top + 20, width: 60, height: 60 };
          }

          animNode.style.left = (tailRect.left) + "px";
          animNode.style.top = (tailRect.top - 80) + "px";
          animNode.style.opacity = "0";
          document.body.appendChild(animNode);
          animNode.classList.add("enqueue-animation");

          // After animation end, remove animNode and render normal
          animNode.addEventListener("animationend", () => {
            animNode.remove();
            // Just render again normal (already done)
          });
        } else if (action === "dequeue") {
          const headNode = animatedNode;
          const headRect = headNode.getBoundingClientRect();

          animNode.style.left = headRect.left + "px";
          animNode.style.top = headRect.top + "px";
          animNode.style.opacity = "1";
          document.body.appendChild(animNode);
          animNode.classList.add("dequeue-animation");

          animNode.addEventListener("animationend", () => {
            animNode.remove();
            // Render normal already done
          });
        }
      }
      updateButtons();
    }

    // 更新按钮状态
    function updateButtons() {
      enqueueBtn.disabled = false;
      dequeueBtn.disabled = queue.length === 0;
      clearBtn.disabled = queue.length === 0;
    }

    // 显示提示信息
    function setMessage(text, isError = false) {
      if (isError) {
        message.style.color = "#e94e77";
      } else {
        message.style.color = "#27ae60";
      }
      message.textContent = text;
      // Clear message after 3 seconds if not error
      if (!isError) {
        clearTimeout(message._timeout);
        message._timeout = setTimeout(() => {
          message.textContent = "";
        }, 3000);
      }
    }

    // 入队操作
    enqueueBtn.addEventListener("click", () => {
      const valRaw = enqueueInput.value.trim();
      if (valRaw === "") {
        setMessage("请输入一个数字！", true);
        enqueueInput.focus();
        return;
      }
      // Check if number
      const valNum = Number(valRaw);
      if (Number.isNaN(valNum) || !Number.isFinite(valNum)) {
        setMessage("请输入有效数字！", true);
        enqueueInput.focus();
        return;
      }
      // Optional: Limit number range or size? For demo no limit

      enqueueInput.value = "";
      enqueueInput.focus();

      // Animate enqueue:
      // Create a temp node for animation start point
      const animNode = document.createElement("div");
      animNode.classList.add("node");
      animNode.textContent = valNum;
      animNode.style.position = "absolute";
      animNode.style.pointerEvents = "none";

      // Start animation from above container center
      const containerRect = queueContainer.getBoundingClientRect();
      animNode.style.left = (containerRect.left + containerRect.width / 2 - 30) + "px";
      animNode.style.top = (containerRect.top - 80) + "px";
      animNode.style.opacity = "0";

      document.body.appendChild(animNode);

      // Trigger animation frame to apply animation:
      requestAnimationFrame(() => {
        animNode.style.transition = `transform ${ANIMATION_DURATION}ms ease, opacity ${ANIMATION_DURATION}ms ease`;
        animNode.style.transform = `translateY(80px) scale(1)`;
        animNode.style.opacity = "1";
      });

      setTimeout(() => {
        animNode.remove();
        queue.push(valNum);
        renderQueue();
        setMessage(`元素 ${valNum} 已入队。`);
      }, ANIMATION_DURATION);

      updateButtons();
    });

    // 出队操作
    dequeueBtn.addEventListener("click", () => {
      if (queue.length === 0) {
        setMessage("队列为空，无法出队！", true);
        return;
      }
      dequeueBtn.disabled = true;
      enqueueBtn.disabled = true;
      clearBtn.disabled = true;
      const value = queue[0];

      // Animate dequeue the head node from the displayed queue nodes
      const headNode = queueContainer.querySelector(".node.head");
      if (!headNode) {
        // Fallback: just dequeue
        queue.shift();
        renderQueue();
        setMessage(`元素 ${value} 已出队。`);
        updateButtons();
        return;
      }

      // Clone node for animation
      const animNode = headNode.cloneNode(true);
      const headRect = headNode.getBoundingClientRect();

      animNode.style.position = "absolute";
      animNode.style.left = headRect.left + "px";
      animNode.style.top = headRect.top + "px";
      animNode.style.width = headRect.width + "px";
      animNode.style.height = headRect.height + "px";
      animNode.style.margin = 0;
      animNode.style.zIndex = 1000;
      animNode.style.userSelect = "none";
      document.body.appendChild(animNode);

      // Remove the first item from the queue immediately but re-render without the first
      queue.shift();

      // Trigger animation
      requestAnimationFrame(() => {
        animNode.style.transition = `transform ${ANIMATION_DURATION}ms ease, opacity ${ANIMATION_DURATION}ms ease`;
        animNode.style.transform = "translateX(50px) scale(1.3)";
        animNode.style.opacity = "0";
      });

      // Also update queue container UI immediately
      renderQueue();

      setTimeout(() => {
        animNode.remove();
        setMessage(`元素 ${value} 已出队。`);
        updateButtons();
        enqueueBtn.disabled = false;
        clearBtn.disabled = queue.length === 0;
      }, ANIMATION_DURATION);
    });

    // 清空队列操作
    clearBtn.addEventListener("click", () => {
      if (queue.length === 0) {
        setMessage("队列已为空。");
        return;
      }
      queue = [];
      renderQueue();
      setMessage("队列已清空。");
      updateButtons();
      enqueueInput.focus();
    });

    // 支持输入回车入队
    enqueueInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        enqueueBtn.click();
      }
    });

    // 初始渲染
    renderQueue();

  })();
</script>

</body>
</html>