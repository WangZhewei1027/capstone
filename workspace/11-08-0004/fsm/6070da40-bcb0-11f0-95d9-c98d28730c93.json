{
  "topic": "Queue Interactive Module",
  "description": "FSM modeling user interactions, animations and data-state changes for the Queue (FIFO) interactive module (enqueue, dequeue, peek, clear, demo fill, capacity and animation speed).",
  "states": [
    {
      "name": "idle",
      "onEnter": "updateBadgesAndMarkers",
      "on": {
        "ENQUEUE_REQUEST": "enqueuing",
        "ENQUEUE_FAIL_CAPACITY": "capacity_error_flash",
        "DEQUEUE_REQUEST": "dequeueing",
        "DEQUEUE_FAIL_EMPTY": "idle",
        "PEEK_REQUEST": "peeking",
        "CLEAR_REQUEST": "cleared",
        "DEMO_FILL_START": "demo_filling",
        "SET_CAPACITY": "idle",
        "SET_SPEED": "idle",
        "INPUT_ENTER": "enqueuing"
      }
    },
    {
      "name": "enqueuing",
      "onEnter": "createNodeAndStartArrivalAnimation",
      "onExit": "finalizeEnqueue",
      "on": {
        "ENQUEUE_ARRIVAL_COMPLETE": "idle",
        "ENQUEUE_REQUEST": "enqueuing",
        "ENQUEUE_FAIL_CAPACITY": "capacity_error_flash",
        "DEMO_FILL_START": "demo_filling",
        "CLEAR_REQUEST": "cleared"
      }
    },
    {
      "name": "dequeueing",
      "onEnter": "startDepartAnimationForHead",
      "onExit": "finalizeDequeue",
      "on": {
        "DEQUEUE_DEPART_COMPLETE": "idle",
        "DEQUEUE_REQUEST": "dequeueing",
        "DEQUEUE_FAIL_EMPTY": "idle",
        "CLEAR_REQUEST": "cleared"
      }
    },
    {
      "name": "peeking",
      "onEnter": "setPeekResultAndPulseHeadVisual",
      "onExit": "clearPeekVisuals",
      "on": {
        "PEEK_COMPLETE": "idle",
        "PEEK_REQUEST": "peeking",
        "CLEAR_REQUEST": "cleared"
      }
    },
    {
      "name": "demo_filling",
      "onEnter": "startDemoFillSequence",
      "onExit": "endDemoFillSequence",
      "on": {
        "DEMO_FILL_STEP": "enqueuing",
        "DEMO_FILL_FINISH": "idle",
        "ENQUEUE_FAIL_CAPACITY": "capacity_error_flash",
        "CLEAR_REQUEST": "cleared",
        "DEMO_FILL_CANCEL": "idle"
      }
    },
    {
      "name": "capacity_error_flash",
      "onEnter": "flashCapacityErrorAndAnnounce",
      "onExit": "updateBadgesAndMarkers",
      "on": {
        "CAPACITY_FLASH_COMPLETE": "idle",
        "ENQUEUE_REQUEST": "capacity_error_flash",
        "SET_CAPACITY": "idle",
        "CLEAR_REQUEST": "cleared"
      }
    },
    {
      "name": "cleared",
      "onEnter": "clearQueueDomAndAnnounce",
      "onExit": "updateBadgesAndMarkers",
      "on": {
        "CLEAR_COMPLETE": "idle",
        "ENQUEUE_REQUEST": "enqueuing",
        "DEMO_FILL_START": "demo_filling",
        "SET_CAPACITY": "idle"
      }
    }
  ],
  "events": [
    "ENQUEUE_REQUEST",
    "ENQUEUE_FAIL_CAPACITY",
    "ENQUEUE_ARRIVAL_COMPLETE",
    "DEQUEUE_REQUEST",
    "DEQUEUE_FAIL_EMPTY",
    "DEQUEUE_DEPART_COMPLETE",
    "PEEK_REQUEST",
    "PEEK_COMPLETE",
    "CLEAR_REQUEST",
    "CLEAR_COMPLETE",
    "DEMO_FILL_START",
    "DEMO_FILL_STEP",
    "DEMO_FILL_FINISH",
    "DEMO_FILL_CANCEL",
    "SET_CAPACITY",
    "SET_SPEED",
    "INPUT_ENTER",
    "CAPACITY_FLASH_COMPLETE"
  ],
  "notes": "This FSM models logical interactions and visual/animation lifecycle in the queue module. Actions referenced in onEnter/onExit map to implementation responsibilities found in the script: updateBadgesAndMarkers (update size/capacity badges and HEAD/TAIL markers), createNodeAndStartArrivalAnimation (create DOM node with .incoming then add .arrived; schedule ENQUEUE_ARRIVAL_COMPLETE after CSS duration * speedFactor), finalizeEnqueue (post-arrival tasks: updateMarkers, updateBadges, announce and clear peek), startDepartAnimationForHead (add .depart to head DOM element; schedule DEQUEUE_DEPART_COMPLETE after CSS duration * speedFactor), finalizeDequeue (remove DOM node, update badges/markers and announce), setPeekResultAndPulseHeadVisual (set peekResult text, animate head pulse, schedule PEEK_COMPLETE after pulse duration), clearQueueDomAndAnnounce (empty logical queue, remove DOM nodes, update UI and announce), startDemoFillSequence (enqueue sequence A..E with delays, dispatch DEMO_FILL_STEP for each and DEMO_FILL_FINISH when done), flashCapacityErrorAndAnnounce (temporarily style capacity badge and announce; schedule CAPACITY_FLASH_COMPLETE after ~600ms). Timers and transition timings are driven by CSS durations multiplied by speedFactor (user-controlled). The real code allows overlapping animations (multiple enqueues/dequeues in flight); this FSM treats each operation as a transient state but allows repeated event requests (self-loops) so multiple operations can proceed. Guard conditions (capacity checks, empty checks) are represented as separate events (ENQUEUE_FAIL_CAPACITY, DEQUEUE_FAIL_EMPTY) that are emitted synchronously by the implementation when conditions block the requested operation."
}