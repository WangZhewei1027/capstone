{
  "topic": "Merge Sort Interactive Module",
  "description": "Models the interactive states of a Merge Sort visualization app: array setup, action recording, playback (play/pause), stepping forward/back, editing values, and completion. Includes transient animation/action application states for compares/overwrites/splits/done.",
  "states": [
    {
      "name": "idle",
      "onEnter": "stopPlaying; renderArray(workingArray); updateStepCounter",
      "onExit": "",
      "on": {
        "PLAY": "playing",
        "STEP_FORWARD": "applying_action_manual_forward",
        "STEP_BACK": "applying_action_manual_reverse",
        "SET_ARRAY": "recording_actions",
        "RANDOMIZE": "recording_actions",
        "SIZE_CHANGE": "recording_actions",
        "RESET": "recording_actions",
        "EDIT_BAR_OPEN": "editing"
      }
    },
    {
      "name": "playing",
      "onEnter": "startPlaying (set playing=true; runPlayLoop)",
      "onExit": "stopPlaying (clear timer; set playing=false)",
      "on": {
        "PAUSE": "idle",
        "STOP": "idle",
        "ACTIONS_EXHAUSTED": "completed",
        "STEP_FORWARD": "applying_action_manual_forward",
        "STEP_BACK": "applying_action_manual_reverse",
        "SET_ARRAY": "recording_actions",
        "RANDOMIZE": "recording_actions",
        "SIZE_CHANGE": "recording_actions",
        "RESET": "recording_actions"
      }
    },
    {
      "name": "applying_action_automatic",
      "onEnter": "apply current action forward; increment stepIndex; update counters/UI; schedule next ACTION_APPLIED_AUTOMATIC after getStepDuration",
      "onExit": "",
      "on": {
        "ACTION_APPLIED_AUTOMATIC": "playing",
        "ACTIONS_EXHAUSTED": "completed"
      }
    },
    {
      "name": "applying_action_manual_forward",
      "onEnter": "applyAction(action at stepIndex, forward=true); stepIndex++; update counters/UI; updateStepCounter",
      "onExit": "",
      "on": {
        "ACTION_APPLIED_MANUAL": "idle",
        "ACTIONS_EXHAUSTED": "completed"
      }
    },
    {
      "name": "applying_action_manual_reverse",
      "onEnter": "stepIndex--; applyAction(action at stepIndex, forward=false); update counters/UI; updateStepCounter",
      "onExit": "",
      "on": {
        "ACTION_REVERTED_MANUAL": "idle"
      }
    },
    {
      "name": "editing",
      "onEnter": "promptEditBar (synchronous prompt); if saved -> apply edit to baseArray and workingArray; resetActions",
      "onExit": "",
      "on": {
        "EDIT_SAVE": "recording_actions",
        "EDIT_CANCEL": "idle"
      }
    },
    {
      "name": "recording_actions",
      "onEnter": "recordActionsForMergeSort(baseArray.slice()) (generates actions array, resets comp/write counters and stepIndex); renderArray(baseArray); clear recursion UI",
      "onExit": "",
      "on": {
        "ACTIONS_GENERATED": "idle"
      }
    },
    {
      "name": "completed",
      "onEnter": "stopPlaying; ensure all sorted visuals applied; update counters; updateStepCounter",
      "onExit": "",
      "on": {
        "RESET": "recording_actions",
        "SET_ARRAY": "recording_actions",
        "RANDOMIZE": "recording_actions",
        "SIZE_CHANGE": "recording_actions",
        "PLAY": "playing"
      }
    }
  ],
  "events": [
    "PLAY",
    "PAUSE",
    "PLAY_TOGGLE",
    "STEP_FORWARD",
    "STEP_BACK",
    "ACTION_APPLIED_AUTOMATIC",
    "ACTION_APPLIED_MANUAL",
    "ACTION_REVERTED_MANUAL",
    "ACTIONS_EXHAUSTED",
    "ACTIONS_GENERATED",
    "SET_ARRAY",
    "RANDOMIZE",
    "SIZE_CHANGE",
    "SPEED_CHANGE",
    "RESET",
    "EDIT_BAR_OPEN",
    "EDIT_SAVE",
    "EDIT_CANCEL",
    "WINDOW_RESIZE",
    "KEY_PRESS_SPACE",
    "KEY_PRESS_RIGHT",
    "KEY_PRESS_LEFT"
  ],
  "notes": "High-level FSM captures user-driven transitions and automated playback. Implementation details in the app: recordActionsForMergeSort synchronously generates a list of actions (split, compare, overwrite, done). applyAction executes each action immediately and uses timeouts for visual highlight cleanup; runPlayLoop schedules repeated stepForward calls using getStepDuration (speed slider affects duration). The 'applying_action_*' states represent transient action application (forward/back, manual or automatic). 'recording_actions' corresponds to regenerating the recorded action sequence after edits/randomize/size/set. 'editing' corresponds to the synchronous prompt used to edit a bar; on save the module resets recorded actions. 'completed' is reached when stepIndex >= actions.length and playing stops. Keyboard shortcuts map to PLAY/PAUSE and STEP events. Visual micro-states managed by actions: split -> pushRec/popRec, compare -> compare highlight, overwrite -> animate and update value, done -> mark range sorted."
}