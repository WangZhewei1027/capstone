{
  "topic": "Interactive Binary Tree (BST) Explorer",
  "description": "Models the interactive states of the BST explorer UI: inserting/removing nodes, rendering/layout updates, traversal animations (play/step/stop), and related UI control behavior.",
  "states": [
    {
      "name": "idle",
      "onEnter": "render_and_update_stats",
      "onExit": "none",
      "on": {
        "INSERT": "idle",
        "RANDOMIZE": "idle",
        "RESET": "idle",
        "PLAY": "playing",
        "STEP": "stepping",
        "NODE_CLICK": "confirming_delete",
        "CENTER": "idle",
        "SPEED_CHANGE": "idle",
        "TRAVERSAL_SELECT_CHANGE": "idle"
      }
    },
    {
      "name": "playing",
      "onEnter": "start_traversal (set animating=true; abortTraversal=false; compute sequence; begin sequential node+edge highlights based on speed)",
      "onExit": "end_traversal (set animating=false; abortTraversal=false)",
      "on": {
        "STOP": "aborting",
        "TRAVERSAL_COMPLETE": "idle",
        "NODE_CLICK": "confirming_delete",
        "INSERT": "playing",
        "SPEED_CHANGE": "playing",
        "TRAVERSAL_SELECT_CHANGE": "playing",
        "CENTER": "playing"
      }
    },
    {
      "name": "stepping",
      "onEnter": "step_traversal (set animating=true; highlight single next node; await small delay)",
      "onExit": "end_traversal (set animating=false)",
      "on": {
        "TRAVERSAL_STEP_DONE": "idle",
        "NODE_CLICK": "confirming_delete",
        "INSERT": "stepping",
        "STOP": "aborting",
        "CENTER": "stepping",
        "SPEED_CHANGE": "stepping"
      }
    },
    {
      "name": "aborting",
      "onEnter": "set_abort_flag (abortTraversal=true) -- traversal loop will notice and stop",
      "onExit": "clear_abort_flag (abortTraversal=false)",
      "on": {
        "TRAVERSAL_ABORTED": "idle",
        "TRAVERSAL_COMPLETE": "idle"
      }
    },
    {
      "name": "confirming_delete",
      "onEnter": "show_confirm_dialog (synchronous window.confirm in code)",
      "onExit": "none",
      "on": {
        "CONFIRM_DELETE_YES": "idle",
        "CONFIRM_DELETE_NO": "idle"
      }
    }
  ],
  "events": [
    "INSERT",
    "RANDOMIZE",
    "RESET",
    "PLAY",
    "STOP",
    "STEP",
    "TRAVERSAL_COMPLETE",
    "TRAVERSAL_STEP_DONE",
    "TRAVERSAL_ABORTED",
    "NODE_CLICK",
    "CONFIRM_DELETE_YES",
    "CONFIRM_DELETE_NO",
    "SPEED_CHANGE",
    "TRAVERSAL_SELECT_CHANGE",
    "CENTER",
    "INSERT_ANIMATION_END",
    "UPDATE_COMPLETE"
  ],
  "notes": "Key behavioral details (from code):\n- 'animating' boolean indicates a traversal/step is active. When animating==true, some controls are intentionally blocked (randomize/reset check animating and do nothing; step/play handlers guard against animating in most handlers). Insert and node deletion are allowed in code (insert does not check animating; clicking a node prompts removal regardless).\n- Traversal actions: 'start_traversal' iterates the chosen sequence (inorder/preorder/postorder/level) and for each node highlights node and its parent edge for the configured delay (speedRange). 'stop' sets abortTraversal=true; the traversal loop checks the flag and exits gracefully, then animating is cleared.\n- 'stepping' highlights exactly one node and returns to idle.\n- Node deletion uses window.confirm (synchronous). CONFIRM_DELETE_YES triggers removal (BST.remove) and update/render; CONFIRM_DELETE_NO cancels.\n- Rendering/layout: computeLayout assigns x/y per inorder order and depth; render() rebuilds the SVG and applies small pop/scale animations for nodes. Node insertion triggers a brief pulse on the inserted node.\n- Implementation note / observed bug: playBtn event handler in the source appears to be miswritten (it checks 'if (animating) return startTraversal();') which would make Play only call startTraversal when animating is already true; intended behavior is likely the opposite. The FSM above models the intended/observable traversal lifecycle (idle -> playing -> idle) rather than this probable typo.",
  "description_short": "FSM for BST explorer interactions (insert/remove/random/reset/traverse/play/stop/step/center/render)."
}