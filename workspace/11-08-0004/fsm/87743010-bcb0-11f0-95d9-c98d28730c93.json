{
  "topic": "Kruskalâ€™s Algorithm Interactive Module",
  "description": "Models the interactive UI and Kruskal algorithm stepper: user modes (browse, add-node, add-edge, delete), node/edge creation & dragging, and the Kruskal process (inspect -> accept/reject -> play/pause -> finished).",
  "states": [
    {
      "name": "browse",
      "onEnter": "setMode('browse')",
      "on": {
        "CLICK_ADD_NODE": "add_node",
        "CLICK_ADD_EDGE": "add_edge_waiting_first",
        "CLICK_DELETE": "delete",
        "CLICK_STEP": "kruskal_inspecting",
        "CLICK_PLAY": "kruskal_playing",
        "CLICK_RESET": "kruskal_idle",
        "CLICK_SAMPLE1": "browse",
        "CLICK_SAMPLE2": "browse",
        "CLICK_RANDOM": "browse",
        "CLICK_SHUFFLE": "browse",
        "CLICK_TOGGLE_WEIGHTS": "browse",
        "DRAG_START": "browse",
        "DRAG_MOVE": "browse",
        "DRAG_END": "browse",
        "ESCAPE_KEY": "browse"
      }
    },
    {
      "name": "add_node",
      "onEnter": "setMode('add-node')",
      "onExit": "commitRender()",
      "on": {
        "CLICK_ADD_NODE": "browse",
        "CLICK_CANVAS": "add_node",
        "CLICK_STEP": "kruskal_inspecting",
        "CLICK_PLAY": "kruskal_playing",
        "ESCAPE_KEY": "browse"
      }
    },
    {
      "name": "add_edge_waiting_first",
      "onEnter": "setMode('add-edge'); state.selection=null",
      "onExit": "commitRender()",
      "on": {
        "NODE_CLICK": "add_edge_waiting_second",
        "CLICK_ADD_EDGE": "browse",
        "ESCAPE_KEY": "browse",
        "CLICK_STEP": "kruskal_inspecting",
        "CLICK_PLAY": "kruskal_playing"
      }
    },
    {
      "name": "add_edge_waiting_second",
      "onEnter": "state.selection = <firstNodeId>",
      "onExit": "state.selection = null; commitRender()",
      "on": {
        "NODE_CLICK": "add_edge_waiting_first",
        "ENTER_WEIGHT": "add_edge_waiting_first",
        "CLICK_ADD_EDGE": "browse",
        "ESCAPE_KEY": "browse"
      }
    },
    {
      "name": "delete",
      "onEnter": "setMode('delete')",
      "onExit": "commitRender()",
      "on": {
        "CLICK_DELETE": "browse",
        "NODE_CLICK": "delete",
        "EDGE_CLICK_DELETE": "delete",
        "ESCAPE_KEY": "browse",
        "CLICK_STEP": "kruskal_inspecting",
        "CLICK_PLAY": "kruskal_playing"
      }
    },
    {
      "name": "kruskal_idle",
      "onEnter": "resetKruskal()",
      "on": {
        "CLICK_STEP": "kruskal_inspecting",
        "CLICK_PLAY": "kruskal_playing",
        "CLICK_RESET": "kruskal_idle",
        "CLICK_SAMPLE1": "kruskal_idle",
        "CLICK_SAMPLE2": "kruskal_idle",
        "CLICK_RANDOM": "kruskal_idle"
      }
    },
    {
      "name": "kruskal_inspecting",
      "onEnter": "prepareKruskalIfNeeded(); highlightInspectEdge(currentEdgeId); // start inspect timer",
      "onExit": "clear inspect highlight (if any)",
      "on": {
        "INSPECT_DECISION_ACCEPT": "kruskal_accepting",
        "INSPECT_DECISION_REJECT": "kruskal_rejecting",
        "CLICK_PLAY": "kruskal_playing",
        "CLICK_STEP": "kruskal_inspecting",
        "CLICK_RESET": "kruskal_idle"
      }
    },
    {
      "name": "kruskal_accepting",
      "onEnter": "unionFind.union(edge.a,edge.b); state.kruskal.acceptedEdgeIds.add(eid); animateAcceptEdge(eid); updateAcceptedDisplay(); updateUnionDisplay(); updateMSTWeight()",
      "onExit": "commitRender()",
      "on": {
        "ANIMATION_DONE": [
          "kruskal_inspecting",
          "kruskal_finished"
        ],
        "CLICK_PLAY": "kruskal_playing",
        "CLICK_RESET": "kruskal_idle"
      }
    },
    {
      "name": "kruskal_rejecting",
      "onEnter": "state.kruskal.rejectedEdgeIds.add(eid); animateRejectEdge(eid); updateAcceptedDisplay(); updateUnionDisplay()",
      "onExit": "commitRender()",
      "on": {
        "ANIMATION_DONE": [
          "kruskal_inspecting",
          "kruskal_finished"
        ],
        "CLICK_PLAY": "kruskal_playing",
        "CLICK_RESET": "kruskal_idle"
      }
    },
    {
      "name": "kruskal_playing",
      "onEnter": "prepareKruskalIfNeeded(); state.kruskal.playing = true; btnPlay.textContent = 'Pause'; stepKruskalOnce()",
      "onExit": "state.kruskal.playing = false; btnPlay.textContent = 'Play'",
      "on": {
        "INSPECT_DECISION_ACCEPT": "kruskal_accepting",
        "INSPECT_DECISION_REJECT": "kruskal_rejecting",
        "CLICK_PLAY": "kruskal_idle",
        "CLICK_RESET": "kruskal_idle",
        "ANIMATION_DONE": "kruskal_playing"
      }
    },
    {
      "name": "kruskal_finished",
      "onEnter": "state.kruskal.playing = false; btnPlay.textContent = 'Play'; // final state after last edge inspected",
      "on": {
        "CLICK_RESET": "kruskal_idle",
        "CLICK_PLAY": "kruskal_playing"
      }
    }
  ],
  "events": [
    "CLICK_ADD_NODE",
    "CLICK_ADD_EDGE",
    "CLICK_DELETE",
    "CLICK_CANVAS",
    "NODE_CLICK",
    "EDGE_CLICK_DELETE",
    "CLICK_STEP",
    "CLICK_PLAY",
    "CLICK_RESET",
    "CLICK_SAMPLE1",
    "CLICK_SAMPLE2",
    "CLICK_RANDOM",
    "CLICK_SHUFFLE",
    "CLICK_TOGGLE_WEIGHTS",
    "ENTER_WEIGHT",
    "DRAG_START",
    "DRAG_MOVE",
    "DRAG_END",
    "INSPECT_DECISION_ACCEPT",
    "INSPECT_DECISION_REJECT",
    "INSPECT_DECISION",
    "ANIMATION_DONE",
    "ESCAPE_KEY"
  ],
  "notes": "This FSM models two orthogonal concerns: user interaction modes (browse, add-node, add-edge, delete) and the Kruskal algorithm state machine (prepare -> inspecting -> accept/reject -> finished). Many UI actions (sample loading, shuffling, toggling weights) do not change mode and keep the UI in the current interaction state. 'NODE_CLICK' behaves differently depending on mode: in add-edge it selects nodes for an edge; in delete it removes the node; otherwise it can start drag behavior (DRAG_START/DRAG_MOVE/DRAG_END) which does not change mode. Kruskal 'inspect' uses a timed inspect -> decision -> animation sequence: INSPECT_DECISION_* events are emitted after the inspection timeout and lead to accepting/rejecting states; ANIMATION_DONE signals the end of accept/reject animation and either continues playing or returns to idle/finished. Some actions are parameterized (addNodeAt(x,y), addEdge(a,b,w), highlightInspectEdge(eid), animateAcceptEdge(eid), animateRejectEdge(eid)); these are represented as onEnter/onExit side-effect calls in states above. The UI allows toggling between modes (buttons or keyboard shortcuts)."
}