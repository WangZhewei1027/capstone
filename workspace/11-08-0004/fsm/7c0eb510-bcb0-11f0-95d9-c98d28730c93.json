{
  "topic": "Prim's Algorithm Interactive Module",
  "description": "Models the interactive states and user/algorithm-driven transitions of a Prim's algorithm visualization: node/edge creation, dragging, algorithm initialization, single stepping, autoplay, and completion.",
  "states": [
    {
      "name": "idle",
      "onEnter": "updateGraph",
      "onExit": "none",
      "on": {
        "SVG_CLICK": "idle",
        "NODE_CLICK": "creating_edge",
        "NODE_MOUSEDOWN": "dragging_node",
        "BTN_STEP": "stepping",
        "BTN_PLAY": "playing",
        "BTN_RESET": "idle",
        "BTN_CLEAR": "idle",
        "BTN_RANDOM_GRAPH": "idle",
        "BTN_SET_START": "ready",
        "ESCAPE": "idle",
        "SPACE_KEY": "stepping",
        "ENTER_KEY": "playing"
      }
    },
    {
      "name": "creating_edge",
      "onEnter": "highlightTempNode(selectedNode)",
      "onExit": "highlightTempNode(null)",
      "on": {
        "NODE_CLICK": "idle",
        "NODE_CLICK_SAME": "idle",
        "SVG_CLICK": "idle",
        "ESCAPE": "idle",
        "NODE_MOUSEDOWN": "dragging_node",
        "BTN_SET_START": "ready",
        "BTN_CLEAR": "idle",
        "BTN_RESET": "idle"
      }
    },
    {
      "name": "dragging_node",
      "onEnter": "startDrag(node); updateGraph",
      "onExit": "clearDrag; updateGraph",
      "on": {
        "MOUSE_MOVE": "dragging_node",
        "TOUCH_MOVE": "dragging_node",
        "MOUSE_UP": "idle",
        "TOUCH_END": "idle",
        "ESCAPE": "idle"
      }
    },
    {
      "name": "ready",
      "onEnter": "initPrim; updateGraph",
      "onExit": "none",
      "on": {
        "BTN_STEP": "stepping",
        "BTN_PLAY": "playing",
        "NODE_CLICK": "creating_edge",
        "NODE_MOUSEDOWN": "dragging_node",
        "BTN_RESET": "idle",
        "BTN_CLEAR": "idle",
        "BTN_RANDOM_GRAPH": "idle",
        "BTN_SET_START": "ready",
        "SPACE_KEY": "stepping",
        "ENTER_KEY": "playing",
        "ESCAPE": "idle"
      }
    },
    {
      "name": "stepping",
      "onEnter": "stepPrim (mark edge considered -> animate -> mark edge inMST; update frontier; updateGraph)",
      "onExit": "updateGraph",
      "on": {
        "STEP_COMPLETE_MANUAL": "ready",
        "STEP_COMPLETE_AUTO": "playing",
        "FINISHED": "finished",
        "BTN_PLAY": "playing",
        "BTN_RESET": "idle",
        "BTN_CLEAR": "idle"
      }
    },
    {
      "name": "playing",
      "onEnter": "startPlay (setInterval timer using speed value)",
      "onExit": "stopPlay (clearInterval)",
      "on": {
        "TIMER_TICK": "stepping",
        "BTN_PLAY": "ready",
        "BTN_RESET": "idle",
        "BTN_CLEAR": "idle",
        "FINISHED": "finished",
        "ESCAPE": "playing"
      }
    },
    {
      "name": "finished",
      "onEnter": "stopPlay; flashMessage('Algorithm finished'); updateGraph",
      "onExit": "none",
      "on": {
        "BTN_RESET": "idle",
        "BTN_CLEAR": "idle",
        "BTN_SET_START": "ready",
        "BTN_PLAY": "playing",
        "BTN_RANDOM_GRAPH": "idle"
      }
    }
  ],
  "events": [
    "SVG_CLICK",
    "NODE_CLICK",
    "NODE_CLICK_SAME",
    "NODE_MOUSEDOWN",
    "MOUSE_MOVE",
    "MOUSE_UP",
    "TOUCH_MOVE",
    "TOUCH_END",
    "ESCAPE",
    "SPACE_KEY",
    "ENTER_KEY",
    "BTN_STEP",
    "BTN_PLAY",
    "BTN_RESET",
    "BTN_CLEAR",
    "BTN_RANDOM_GRAPH",
    "BTN_SET_START",
    "RAND_WEIGHT_TOGGLE",
    "EDGE_WEIGHT_INPUT",
    "AUTO_WEIGHT_TOGGLE",
    "SPEED_CHANGE",
    "TIMER_TICK",
    "TIMER_START",
    "TIMER_STOP",
    "STEP_COMPLETE_MANUAL",
    "STEP_COMPLETE_AUTO",
    "FINISHED",
    "ADD_NODE",
    "ADD_EDGE",
    "CANCEL_EDGE_CREATION"
  ],
  "notes": "State semantics and actions:\n- idle: default non-running state. SVG_CLICK triggers adding a node (ADD_NODE) and remains in idle (self-loop). NODE_CLICK starts edge-creation mode (creating_edge). BTN_STEP triggers a single algorithm step (stepping); if the algorithm has not been initialized this will initialize (initPrim) as part of stepPrim.\n- creating_edge: user has clicked a node to start an edge. onEnter highlights the temporary source node. NODE_CLICK on another node creates an edge (ADD_EDGE) and returns to idle. Clicking the same node or pressing ESC cancels creation. Clicking empty canvas (SVG_CLICK) adds a node and cancels creation.\n- dragging_node: entered on node mousedown/touchstart. onEnter records drag state; MOUSE_MOVE/TOUCH_MOVE update node coordinates and call updateGraph. On MOUSE_UP or TOUCH_END returns to idle/previous interactive state (implementation clears drag state). Dragging can occur while in creating_edge (user can start dragging instead of finishing an edge).\n- ready: algorithm has been initialized (start node set and visited contains start). Step and Play behave as usual from this state.\n- stepping: represents executing one Prim step. onEnter executes stepPrim: clean frontier, pick min candidate, mark edge.considered, wait (~450ms) then mark edge.inMST, mark new node visited, add new frontier edges and updateGraph. After the animation completes the module emits STEP_COMPLETE_MANUAL if it was a manual step (transitions to ready) or STEP_COMPLETE_AUTO if it was triggered by autoplay (remains/returns to playing). If no valid frontier remains the module emits FINISHED.\n- playing: autoplay mode. onEnter starts a timer (startPlay) that dispatches TIMER_TICK periodically (speedInput value). Each TIMER_TICK triggers a stepping transition. onExit clears the timer.\n- finished: algorithm has completed (all nodes visited or no connecting edges). onEnter stops autoplay, shows a brief flashMessage, and updates visuals. From finished the user can reset, clear the graph, generate a new graph, or set a new start to return to ready.\n\nActions performed by transitions (not exhaustively encoded in transitions map):\n- ADD_NODE: addNode(x,y,label), updateGraph\n- ADD_EDGE: addEdge(u,v,w), updateGraph\n- initPrim: clear visited/frontier, mark start visited and populate frontier from start\n- resetAlgorithm: clear visited/frontier and MST markings, stopPlay\n- startPlay/stopPlay: control setInterval/clearInterval and change button UI\n- stepPrim: implements one step and triggers the considered->inMST animation (uses setTimeout ~450ms)\n\nAccessibility/keyboard mappings (events): Space -> BTN_STEP (STEP), Enter -> BTN_PLAY (PLAY_TOGGLE), Escape -> ESCAPE (cancel edge creation). RAND_WEIGHT_TOGGLE, EDGE_WEIGHT_INPUT, AUTO_WEIGHT_TOGGLE, and SPEED_CHANGE are UI events that modify weight-selection and playback speed but do not change high-level FSM state (they may restart timer when changed during autoplay)."
}