{
  "topic": "Adjacency List Interactive Module",
  "description": "FSM modeling the interactive states of the adjacency-list graph builder (modes, selection, dragging, pending edge creation, animation, tooltip and clear confirmation).",
  "states": [
    {
      "name": "mode_add_node",
      "onEnter": "setMode('add-node')",
      "onExit": "none",
      "on": {
        "MODE_CHANGE_ADD_EDGE": "mode_add_edge_idle",
        "MODE_CHANGE_SELECT": "mode_select_idle",
        "SVG_CLICK_EMPTY": "mode_add_node",
        "BTN_ADD_CLICK": "mode_add_node",
        "NODE_POINTERDOWN_ON_NODE": "mode_add_node",
        "NODE_CREATED": "mode_add_node"
      }
    },
    {
      "name": "mode_add_edge_idle",
      "onEnter": "setMode('add-edge'); pendingEdgeSource = null",
      "onExit": "none",
      "on": {
        "NODE_POINTERDOWN_ON_NODE": "mode_add_edge_pending",
        "SVG_CLICK_EMPTY": "mode_add_edge_idle",
        "MODE_CHANGE_ADD_NODE": "mode_add_node",
        "MODE_CHANGE_SELECT": "mode_select_idle"
      }
    },
    {
      "name": "mode_add_edge_pending",
      "onEnter": "pendingEdgeSource = <NODE_ID>; highlightNode(<NODE_ID>, true); showTooltip(<CLIENT_X>, <CLIENT_Y>, 'Source selected')",
      "onExit": "highlightNode(pendingEdgeSource, false); pendingEdgeSource = null; hideTooltip()",
      "on": {
        "NODE_POINTERDOWN_ON_SAME_NODE": "mode_add_edge_idle",
        "NODE_POINTERDOWN_ON_TARGET_NODE": "animating_edge_creation",
        "SVG_CLICK_EMPTY": "mode_add_edge_idle",
        "EDGE_WEIGHT_ENTER": "mode_add_edge_idle",
        "MODE_CHANGE_ADD_NODE": "mode_add_node",
        "MODE_CHANGE_SELECT": "mode_select_idle"
      }
    },
    {
      "name": "mode_select_idle",
      "onEnter": "setMode('select'); selectedNode = null; selectedEdge = null; markSelection()",
      "onExit": "none",
      "on": {
        "NODE_POINTERDOWN_START_DRAG": "dragging",
        "NODE_POINTERUP_CLICK": "node_selected",
        "EDGE_CLICK": "edge_selected",
        "SVG_CLICK_EMPTY": "mode_select_idle",
        "MODE_CHANGE_ADD_NODE": "mode_add_node",
        "MODE_CHANGE_ADD_EDGE": "mode_add_edge_idle"
      }
    },
    {
      "name": "dragging",
      "onEnter": "startDrag(<NODE_ID>); selectedNode = <NODE_ID>; markSelection()",
      "onExit": "endDrag(<NODE_ID>); updateEdgesForNode(<NODE_ID>)",
      "on": {
        "POINTER_MOVE": "dragging",
        "POINTER_UP": "mode_select_idle",
        "MODE_CHANGE_ADD_NODE": "mode_add_node",
        "MODE_CHANGE_ADD_EDGE": "mode_add_edge_idle",
        "DELETE_KEY": "mode_select_idle"
      }
    },
    {
      "name": "node_selected",
      "onEnter": "selectedNode = <NODE_ID>; selectedEdge = null; markSelection(); pulseNode(<NODE_ID>)",
      "onExit": "selectedNode = null; markSelection()",
      "on": {
        "DELETE_KEY": "mode_select_idle",
        "BTN_DELETE_CLICK": "mode_select_idle",
        "SVG_CLICK_EMPTY": "mode_select_idle",
        "NODE_POINTERDOWN_ON_OTHER": "node_selected",
        "MODE_CHANGE_ADD_NODE": "mode_add_node",
        "MODE_CHANGE_ADD_EDGE": "mode_add_edge_idle"
      }
    },
    {
      "name": "edge_selected",
      "onEnter": "selectedEdge = <EDGE_ID>; selectedNode = null; markSelection()",
      "onExit": "selectedEdge = null; markSelection()",
      "on": {
        "DELETE_KEY": "mode_select_idle",
        "BTN_DELETE_CLICK": "mode_select_idle",
        "EDGE_CLICK_OTHER": "edge_selected",
        "MODE_CHANGE_ADD_NODE": "mode_add_node",
        "MODE_CHANGE_ADD_EDGE": "mode_add_edge_idle"
      }
    },
    {
      "name": "animating_edge_creation",
      "onEnter": "createEdge(pendingEdgeSource, <TARGET_NODE_ID>, <WEIGHT>, directedCheckbox.checked); // edge line animation started; updateAdjList()",
      "onExit": "clear temporary animation styles if any",
      "on": {
        "ANIMATION_END": "mode_add_edge_idle",
        "MODE_CHANGE_ADD_NODE": "mode_add_node",
        "MODE_CHANGE_SELECT": "mode_select_idle"
      }
    },
    {
      "name": "tooltip_shown",
      "onEnter": "showTooltipAtNode(<NODE_ID>, <TEXT>)",
      "onExit": "hideTooltip()",
      "on": {
        "POINTER_LEAVE": "tooltip_hidden",
        "HIDE_TOOLTIP": "tooltip_hidden"
      }
    },
    {
      "name": "tooltip_hidden",
      "onEnter": "hideTooltip()",
      "onExit": "none",
      "on": {
        "POINTER_ENTER_NODE": "tooltip_shown"
      }
    },
    {
      "name": "clearing_confirmation",
      "onEnter": "showConfirm('Clear the graph?')",
      "onExit": "none",
      "on": {
        "CONFIRM_OK": "mode_add_node",
        "CONFIRM_CANCEL": "mode_add_node"
      }
    }
  ],
  "events": [
    "MODE_CHANGE_ADD_NODE",
    "MODE_CHANGE_ADD_EDGE",
    "MODE_CHANGE_SELECT",
    "BTN_ADD_CLICK",
    "BTN_EDGE_CLICK",
    "BTN_SELECT_CLICK",
    "SVG_CLICK_EMPTY",
    "NODE_POINTERDOWN_ON_NODE",
    "NODE_POINTERDOWN_ON_SAME_NODE",
    "NODE_POINTERDOWN_ON_TARGET_NODE",
    "NODE_POINTERDOWN_START_DRAG",
    "NODE_POINTERUP_CLICK",
    "POINTER_MOVE",
    "POINTER_UP",
    "EDGE_CLICK",
    "EDGE_CLICK_OTHER",
    "NODE_CREATED",
    "EDGE_CREATED",
    "ANIMATION_END",
    "TOOLTIP_SHOW",
    "POINTER_ENTER_NODE",
    "POINTER_LEAVE",
    "HIDE_TOOLTIP",
    "BTN_DELETE_CLICK",
    "DELETE_KEY",
    "BTN_EXPORT_CLICK",
    "COPY_ADJ_CLICK",
    "RESET_POSITIONS_CLICK",
    "CLEAR_BTN_CLICK",
    "CONFIRM_OK",
    "CONFIRM_CANCEL",
    "EDGE_WEIGHT_ENTER",
    "MODE_CHANGE"
  ],
  "notes": "This FSM models the primary interactive modes (add-node, add-edge with pending source, select/drag) and common transient states (dragging, node/edge selected, edge creation animation, tooltip visibility, clear confirmation). Some actions (e.g., creation coordinates, node/edge ids) are parameterized (<NODE_ID>, <TARGET_NODE_ID>, <WEIGHT>, <CLIENT_X>) and correspond to functions used in the code: setMode(...), createNodeAt(...), createEdge(...), highlightNode(...), markSelection(), updateAdjList(), showTooltip(...), hideTooltip(), startDrag()/endDrag(), pulseNode(), deleteNode(), deleteEdgeById(), clearGraph(). Mode-change events are emitted by button clicks and top-bar controls; selection and pending-edge are represented by variables (selectedNode, pendingEdgeSource) in the implementation. The FSM intentionally keeps selection persistence simple: selection changes can occur in any mode via explicit events. Some UI actions are blocking (confirm()) and are represented as a clearing_confirmation state."
}