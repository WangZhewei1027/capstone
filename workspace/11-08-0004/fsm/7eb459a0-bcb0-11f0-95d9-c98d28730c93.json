{
  "topic": "Interactive Binary Search Module",
  "description": "Models the interactive states and transitions of a binary-search visualizer: array generation, target selection, stepping / auto-playing the algorithm, comparisons, narrowing ranges, and completion states.",
  "states": [
    {
      "name": "idle",
      "onEnter": "generateArray (prepare sorted array, set low=0, high=n-1, mid=-1, clear target and history, update UI, highlightPseudocode(-1))",
      "onExit": "none",
      "on": {
        "GENERATE_ARRAY": "idle",
        "GENERATE_WITH_DUPLICATES": "idle",
        "SET_TARGET_BY_CLICK": "target_set",
        "SET_TARGET_BY_INPUT": "target_set",
        "CLICK_STEP": "computing_mid",
        "CLICK_PLAY": "playing",
        "CLICK_FAST": "fast_playing",
        "CLICK_RESET": "idle",
        "KEY_S": "computing_mid",
        "KEY_SPACE": "playing",
        "KEY_R": "resetting"
      }
    },
    {
      "name": "target_set",
      "onEnter": "resetSearchBounds (low=0, high=n-1, mid=-1, history=[]; removeAllCellStates; stopPlaying); highlightPseudocode(1); writeStatus('Target set ...')",
      "onExit": "none",
      "on": {
        "CLICK_STEP": "computing_mid",
        "INPUT_TARGET_ENTER": "computing_mid",
        "CLICK_PLAY": "playing",
        "CLICK_FAST": "fast_playing",
        "CLICK_RESET": "resetting",
        "GENERATE_ARRAY": "idle",
        "GENERATE_WITH_DUPLICATES": "idle",
        "KEY_S": "computing_mid",
        "KEY_SPACE": "playing",
        "KEY_R": "resetting"
      }
    },
    {
      "name": "computing_mid",
      "onEnter": "computeMid (mid = floor((low+high)/2)); highlightPseudocode(4); updatePointers; pulseCell(mid); start timer to proceed to comparing (approx 480ms)",
      "onExit": "cancel compute timer if any",
      "on": {
        "TIMER_EXPIRED": "comparing",
        "CLICK_RESET": "resetting",
        "STOP_PLAY": "paused"
      }
    },
    {
      "name": "comparing",
      "onEnter": "highlightPseudocode(5); compareMidToTarget (read A[mid] and target) -> emit COMPARE_RESULT_EQUAL | COMPARE_RESULT_LESS | COMPARE_RESULT_GREATER; writeStatus for comparison",
      "onExit": "none",
      "on": {
        "COMPARE_RESULT_EQUAL": "found",
        "COMPARE_RESULT_LESS": "narrow_right",
        "COMPARE_RESULT_GREATER": "narrow_left",
        "CLICK_RESET": "resetting"
      }
    },
    {
      "name": "narrow_right",
      "onEnter": "highlightPseudocode(6); writeStatus('A[mid] < target ... narrowing to right half'); eliminateRange(low, mid) (animate eliminated cells); low = mid + 1; updatePointers(); push history entry; then CHECK_RANGE -> if low>high emit RANGE_EMPTY else emit RANGE_OK",
      "onExit": "none",
      "on": {
        "RANGE_OK": "target_set",
        "RANGE_EMPTY": "not_found",
        "CLICK_RESET": "resetting"
      }
    },
    {
      "name": "narrow_left",
      "onEnter": "highlightPseudocode(7); writeStatus('A[mid] > target ... narrowing to left half'); eliminateRange(mid, high) (animate eliminated cells); high = mid - 1; updatePointers(); push history entry; then CHECK_RANGE -> if low>high emit RANGE_EMPTY else emit RANGE_OK",
      "onExit": "none",
      "on": {
        "RANGE_OK": "target_set",
        "RANGE_EMPTY": "not_found",
        "CLICK_RESET": "resetting"
      }
    },
    {
      "name": "found",
      "onEnter": "highlightPseudocode(5); writeStatus('Found target at index mid'); focusCell(mid) (scroll + temporary highlight); stopPlaying",
      "onExit": "none",
      "on": {
        "CLICK_RESET": "resetting",
        "GENERATE_ARRAY": "idle",
        "GENERATE_WITH_DUPLICATES": "idle",
        "CLICK_PLAY": "playing",
        "KEY_R": "resetting"
      }
    },
    {
      "name": "not_found",
      "onEnter": "highlightPseudocode(8); writeStatus('Search complete: target not found'); stopPlaying",
      "onExit": "none",
      "on": {
        "CLICK_RESET": "resetting",
        "GENERATE_ARRAY": "idle",
        "GENERATE_WITH_DUPLICATES": "idle",
        "CLICK_PLAY": "playing",
        "KEY_R": "resetting"
      }
    },
    {
      "name": "playing",
      "onEnter": "startPlaying(false) (set playing=true; setInterval -> emit PLAY_TICK at normalDelay); playBtn aria-pressed=true; fastBtn aria-pressed=false",
      "onExit": "stopPlaying (clear interval; set playing=false; unset aria-pressed flags)",
      "on": {
        "PLAY_TICK": "computing_mid",
        "CLICK_PLAY": "paused",
        "CLICK_FAST": "fast_playing",
        "CLICK_RESET": "resetting",
        "STOP_PLAY": "paused",
        "KEY_SPACE": "paused"
      }
    },
    {
      "name": "fast_playing",
      "onEnter": "startPlaying(true) (set fastMode=true; start interval with fastDelay; playBtn and fastBtn aria-pressed=true)",
      "onExit": "stopPlaying (clear interval; fastMode=false; unset aria-pressed flags)",
      "on": {
        "PLAY_TICK": "computing_mid",
        "CLICK_FAST": "paused",
        "CLICK_PLAY": "paused",
        "CLICK_RESET": "resetting",
        "STOP_PLAY": "paused",
        "KEY_SPACE": "paused"
      }
    },
    {
      "name": "paused",
      "onEnter": "stopPlaying(); writeStatus('Paused / playback stopped')",
      "onExit": "none",
      "on": {
        "CLICK_PLAY": "playing",
        "CLICK_FAST": "fast_playing",
        "CLICK_STEP": "computing_mid",
        "CLICK_RESET": "resetting",
        "KEY_S": "computing_mid",
        "KEY_SPACE": "playing"
      }
    },
    {
      "name": "resetting",
      "onEnter": "resetSearch (low=0; high=n-1; mid=-1; history=[]; removeAllCellStates; updatePointers; highlightPseudocode(-1); writeStatus('Search reset. Target remains ...')); stopPlaying",
      "onExit": "none",
      "on": {
        "CLICK_STEP": "computing_mid",
        "CLICK_PLAY": "playing",
        "CLICK_FAST": "fast_playing",
        "GENERATE_ARRAY": "idle",
        "GENERATE_WITH_DUPLICATES": "idle"
      }
    },
    {
      "name": "error_no_array",
      "onEnter": "writeStatus('No array present. Generate an array first.')",
      "onExit": "none",
      "on": {
        "GENERATE_ARRAY": "idle",
        "GENERATE_WITH_DUPLICATES": "idle",
        "CLICK_RESET": "idle"
      }
    },
    {
      "name": "error_no_target",
      "onEnter": "writeStatus('Choose a target (click a cell or type a number).')",
      "onExit": "none",
      "on": {
        "SET_TARGET_BY_CLICK": "target_set",
        "SET_TARGET_BY_INPUT": "target_set",
        "CLICK_RESET": "resetting"
      }
    },
    {
      "name": "error_invalid_target",
      "onEnter": "writeStatus('Target must be a number.')",
      "onExit": "none",
      "on": {
        "SET_TARGET_BY_INPUT": "target_set",
        "CLICK_RESET": "resetting"
      }
    }
  ],
  "events": [
    "GENERATE_ARRAY",
    "GENERATE_WITH_DUPLICATES",
    "SET_TARGET_BY_CLICK",
    "SET_TARGET_BY_INPUT",
    "INPUT_TARGET_ENTER",
    "CLICK_STEP",
    "CLICK_PLAY",
    "CLICK_FAST",
    "CLICK_RESET",
    "PLAY_TICK",
    "TIMER_EXPIRED",
    "COMPARE_RESULT_EQUAL",
    "COMPARE_RESULT_LESS",
    "COMPARE_RESULT_GREATER",
    "RANGE_OK",
    "RANGE_EMPTY",
    "STOP_PLAY",
    "KEY_SPACE",
    "KEY_S",
    "KEY_R",
    "VALIDATION_NO_ARRAY",
    "VALIDATION_NO_TARGET",
    "VALIDATION_INVALID_TARGET"
  ],
  "notes": "State machine models user-driven transitions (button clicks, target selection, keyboard shortcuts) and internal timing/comparison steps. 'computing_mid' models the immediate calculation + visual pulse and a short delay (timer) before comparison. 'comparing' performs the comparison and deterministically routes to 'found', 'narrow_right', or 'narrow_left'. 'narrow_right' and 'narrow_left' animate eliminations, update low/high, push to history, then transition to either 'target_set' (continue) or 'not_found' (if low>high). 'playing' and 'fast_playing' use periodic PLAY_TICK events; entering 'playing' starts a repeating auto-step (normalDelay) and 'fast_playing' uses a shorter delay. Validation error states are transient user-feedback states that return to a state where the user can set or generate an array. Actions referenced in onEnter/onExit (e.g., generateArray, resetSearchBounds, computeMid, pulseCell, eliminateRange, updatePointers, highlightPseudocode, writeStatus, startPlaying, stopPlaying, focusCell) map to the functions implemented in the page script."
}