{
  "topic": "BFS Visualizer Interactive FSM",
  "description": "Finite state machine modeling UI modes, BFS algorithm playback, node/edge interactions, and transient actions (dragging, connecting) in the BFS visualizer web application.",
  "states": [
    {
      "name": "mode_move",
      "onEnter": "setMode('move')",
      "onExit": "clearConnectSource",
      "on": {
        "MODE_ADD": "mode_add",
        "MODE_CONNECT": "mode_connect",
        "MODE_DELETE": "mode_delete",
        "NODE_POINTER_DOWN": "dragging",
        "NODE_DOUBLE_CLICK": "bfs_ready",
        "CANVAS_CLICK": "mode_move"
      }
    },
    {
      "name": "mode_add",
      "onEnter": "setMode('add')",
      "onExit": "clearConnectSource",
      "on": {
        "MODE_MOVE": "mode_move",
        "MODE_CONNECT": "mode_connect",
        "MODE_DELETE": "mode_delete",
        "CANVAS_CLICK": "CREATE_NODE",
        "NODE_POINTER_DOWN": "connect_selected",
        "NODE_DOUBLE_CLICK": "bfs_ready"
      }
    },
    {
      "name": "mode_connect",
      "onEnter": "setMode('connect')",
      "onExit": "clearConnectSource",
      "on": {
        "MODE_MOVE": "mode_move",
        "MODE_ADD": "mode_add",
        "MODE_DELETE": "mode_delete",
        "NODE_POINTER_DOWN": "connect_selected",
        "NODE_DOUBLE_CLICK": "bfs_ready",
        "CANVAS_CLICK": "mode_connect"
      }
    },
    {
      "name": "mode_delete",
      "onEnter": "setMode('delete')",
      "onExit": "clearConnectSource",
      "on": {
        "MODE_MOVE": "mode_move",
        "MODE_ADD": "mode_add",
        "MODE_CONNECT": "mode_connect",
        "NODE_POINTER_DOWN": "NODE_DELETED",
        "EDGE_POINTER_DOWN": "EDGE_DELETED",
        "CANVAS_CLICK": "mode_delete"
      }
    },
    {
      "name": "connect_selected",
      "description": "A node has been selected as connect-source; awaiting a target node (occurs inside add or connect modes)",
      "onEnter": "selectConnectSource",
      "onExit": "clearConnectSource",
      "on": {
        "NODE_POINTER_DOWN": "EDGE_CREATED",
        "NODE_POINTER_DOWN_SAME": "CONNECT_CANCEL",
        "MODE_MOVE": "mode_move",
        "MODE_ADD": "mode_add",
        "MODE_CONNECT": "mode_connect",
        "MODE_DELETE": "mode_delete"
      }
    },
    {
      "name": "dragging",
      "description": "User is dragging a node to reposition it",
      "onEnter": "startDrag (capture pointer, add dragging class)",
      "onExit": "endDrag (release pointer, remove dragging class, update edges)",
      "on": {
        "DRAG_MOVE": "dragging",
        "NODE_POINTER_UP": "mode_move",
        "MODE_DELETE": "mode_delete",
        "MODE_ADD": "mode_add",
        "MODE_CONNECT": "mode_connect"
      }
    },
    {
      "name": "bfs_idle",
      "description": "No start node set; BFS state cleared",
      "onEnter": "resetBFSState (clear queue/visited/visuals); setStatus('Idle')",
      "onExit": "none",
      "on": {
        "BUTTON_RANDOM": "bfs_idle",
        "BUTTON_CLEAR": "bfs_idle",
        "BUTTON_RESET": "bfs_idle",
        "SET_START": "bfs_ready",
        "NODE_DOUBLE_CLICK": "SET_START",
        "MODE_*": "mode_move"
      }
    },
    {
      "name": "bfs_ready",
      "description": "Start node set; queue initialized; BFS paused/ready for steps",
      "onEnter": "resetBFSState (initialize queue from start); setStatus('Ready')",
      "onExit": "none",
      "on": {
        "BUTTON_STEP": "bfs_inspecting",
        "BUTTON_PLAY_TOGGLE": "bfs_playing",
        "BUTTON_RESET": "bfs_idle",
        "SET_START": "bfs_ready",
        "BUTTON_RANDOM": "bfs_ready",
        "BUTTON_CLEAR": "bfs_idle",
        "TOGGLE_DIRECTED": "bfs_ready",
        "MODE_*": "mode_move"
      }
    },
    {
      "name": "bfs_inspecting",
      "description": "Single BFS step: dequeue node, inspect neighbors asynchronously, enqueue new frontier nodes, update visuals",
      "onEnter": "dequeueNodeAndStartInspect (mark exploring, add 'explore' class to inspected edges, call inspectNext loop)",
      "onExit": "finishInspect (mark visited, remove exploring visuals, renderQueue/renderVisited)",
      "on": {
        "BFS_INSPECT_NEXT": "bfs_inspecting",
        "BFS_ENQUEUE": "bfs_inspecting",
        "BFS_STEP_COMPLETE": "bfs_ready",
        "BFS_QUEUE_EMPTY": "bfs_complete",
        "BUTTON_PLAY_TOGGLE": "bfs_playing",
        "BUTTON_RESET": "bfs_idle",
        "MODE_*": "mode_move"
      }
    },
    {
      "name": "bfs_playing",
      "description": "Automatic playback: interval timer triggers step operations repeatedly",
      "onEnter": "startPlay (setInterval using speedSlider; setStatus('Playing'); btnPlay shows Pause)",
      "onExit": "stopPlay (clearInterval; btnPlay shows Play; setStatus accordingly)",
      "on": {
        "PLAY_TIMER_TICK": "bfs_inspecting",
        "BUTTON_PLAY_TOGGLE": "bfs_ready",
        "BFS_PLAY_COMPLETE": "bfs_complete",
        "BFS_QUEUE_EMPTY": "bfs_complete",
        "BUTTON_RESET": "bfs_idle",
        "TOGGLE_DIRECTED": "bfs_playing",
        "MODE_*": "mode_move"
      }
    },
    {
      "name": "bfs_complete",
      "description": "BFS finished (queue empty); visuals show final visited order",
      "onEnter": "setStatus('BFS complete'); stopPlayIfRunning",
      "onExit": "none",
      "on": {
        "SET_START": "bfs_ready",
        "BUTTON_RESET": "bfs_idle",
        "BUTTON_RANDOM": "bfs_ready",
        "BUTTON_CLEAR": "bfs_idle",
        "MODE_*": "mode_move"
      }
    }
  ],
  "events": [
    "MODE_ADD",
    "MODE_CONNECT",
    "MODE_MOVE",
    "MODE_DELETE",
    "CANVAS_CLICK",
    "NODE_POINTER_DOWN",
    "NODE_POINTER_DOWN_SAME",
    "NODE_POINTER_UP",
    "NODE_DOUBLE_CLICK",
    "NODE_KEY_ENTER",
    "EDGE_POINTER_DOWN",
    "BUTTON_SET_START",
    "BUTTON_STEP",
    "BUTTON_PLAY_TOGGLE",
    "BUTTON_RESET",
    "BUTTON_RANDOM",
    "BUTTON_CLEAR",
    "BUTTON_HELP",
    "TOGGLE_DIRECTED",
    "SPEED_CHANGE",
    "WINDOW_RESIZE",
    "CONNECT_SOURCE_SELECTED",
    "CONNECT_CANCEL",
    "EDGE_CREATED",
    "NODE_DELETED",
    "EDGE_DELETED",
    "DRAG_START",
    "DRAG_MOVE",
    "DRAG_END",
    "CREATE_NODE",
    "DEQUEUE_NODE",
    "BFS_INSPECT_NEXT",
    "BFS_ENQUEUE",
    "BFS_DEQUEUE",
    "BFS_STEP_COMPLETE",
    "BFS_QUEUE_EMPTY",
    "PLAY_TIMER_TICK",
    "BFS_PLAY_COMPLETE",
    "PLAY_STARTED",
    "PLAY_STOPPED",
    "RESET_BFS",
    "SET_START"
  ],
  "notes": "This FSM models two orthogonal concerns: UI interaction modes (move/add/connect/delete and transient dragging/connecting) and BFS algorithm playback states (idle, ready, inspecting one step, playing, complete). onEnter/onExit actions correspond to the named functions or behaviors in the script (e.g., setMode(...), resetBFSState, startPlay/stopPlay, dequeueNodeAndStartInspect, selectConnectSource, startDrag/endDrag). Events like NODE_POINTER_DOWN may carry context (which node) and the implementation relies on guarded transitions (e.g., NODE_POINTER_DOWN behaves differently depending on current mode). Asynchronous neighbor inspection in bfs_inspecting is represented by BFS_INSPECT_NEXT / BFS_ENQUEUE events and ends with BFS_STEP_COMPLETE or BFS_QUEUE_EMPTY. Mode transitions can occur while BFS is in any BFS state; some mode changes clear provisional connect selection. Render actions (renderAll/renderQueue/renderVisited) are invoked as side-effects in many onEnter/onExit actions."
}