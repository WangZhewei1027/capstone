{
  "topic": "Interactive DFS Explorer",
  "description": "Models the interactive states and transitions of a Depth‑First Search (DFS) exploration web app: graph editing modes, node dragging, traversal preparation, stepping/playing the DFS generator, micro-step animations (push/pop/visit/edge/etc.), and completion/reset flows.",
  "states": [
    {
      "name": "idle",
      "onEnter": "logStatus('Idle')",
      "onExit": null,
      "on": {
        "CLICK_TOGGLE_ADD": "add_mode",
        "CLICK_TOGGLE_CONNECT": "connect_mode_idle",
        "CANVAS_CLICK": "idle",
        "NODE_CLICK": "idle",
        "CLICK_PLAY": "traversal_prepared_or_playing",
        "CLICK_STEP": "traversal_prepared_or_stepping",
        "CLICK_RESET_TRAVERSAL": "idle",
        "CLICK_RESET_GRAPH": "idle",
        "LOAD_SAMPLE": "idle",
        "CLEAR_GRAPH": "idle",
        "SET_START_NODE": "idle",
        "KEY_SPACE": "traversal_prepared_or_playing",
        "KEY_ARROW_RIGHT": "traversal_prepared_or_stepping",
        "KEY_ESCAPE": "idle",
        "NODE_MOUSEDOWN": "dragging"
      }
    },
    {
      "name": "add_mode",
      "onEnter": "set addMode = true; toggleAdd.classList.add('primary'); statusMsg = 'Add mode: click canvas to add nodes.'",
      "onExit": "set addMode = false; toggleAdd.classList.remove('primary')",
      "on": {
        "CLICK_TOGGLE_ADD": "idle",
        "CANVAS_CLICK": "add_mode",
        "CANVAS_CLICK_ADD_NODE": "add_mode",
        "CLICK_PLAY": "traversal_prepared_or_playing",
        "CLICK_STEP": "traversal_prepared_or_stepping",
        "CLICK_TOGGLE_CONNECT": "connect_mode_idle",
        "NODE_MOUSEDOWN": "dragging",
        "LOAD_SAMPLE": "add_mode",
        "CLEAR_GRAPH": "add_mode"
      }
    },
    {
      "name": "connect_mode_idle",
      "onEnter": "set connectMode = true; selectedForConnect = null; toggleConnect.classList.add('primary'); statusMsg = 'Connect mode: click two nodes to create an edge.'",
      "onExit": "set connectMode = false; selectedForConnect = null; toggleConnect.classList.remove('primary')",
      "on": {
        "CLICK_TOGGLE_CONNECT": "idle",
        "NODE_CLICK": "connect_mode_selected",
        "CLICK_PLAY": "traversal_prepared_or_playing",
        "NODE_MOUSEDOWN": "dragging"
      }
    },
    {
      "name": "connect_mode_selected",
      "onEnter": "selectedForConnect = EVENT.nodeId; statusMsg = 'Select node to connect with Node ' + selectedForConnect",
      "onExit": "selectedForConnect = null",
      "on": {
        "NODE_CLICK_SAME": "connect_mode_idle",
        "NODE_CLICK_DIFFERENT": "connect_mode_idle",
        "CLICK_TOGGLE_CONNECT": "idle",
        "CLICK_PLAY": "traversal_prepared_or_playing",
        "NODE_MOUSEDOWN": "dragging"
      }
    },
    {
      "name": "dragging",
      "onEnter": "startDragging(EVENT.nodeId); /* set dragging variable, attach move/up handlers */",
      "onExit": "stopDragging(); /* remove move/up handlers */",
      "on": {
        "MOUSE_MOVE": "dragging",
        "TOUCH_MOVE": "dragging",
        "MOUSE_UP": "idle",
        "TOUCH_END": "idle"
      }
    },
    {
      "name": "traversal_prepared",
      "onEnter": "prepareTraversal(startSelect.value); traversal exists; highlightPseudocode(null); updateStackView()",
      "onExit": null,
      "on": {
        "CLICK_PLAY": "traversing_playing",
        "CLICK_STEP": "animating_step",
        "CLICK_RESET_TRAVERSAL": "idle",
        "CLICK_TOGGLE_ADD": "add_mode",
        "CLICK_TOGGLE_CONNECT": "connect_mode_idle",
        "NODE_MOUSEDOWN": "dragging"
      }
    },
    {
      "name": "traversing_playing",
      "onEnter": "if(!traversal) prepareTraversal(startSelect.value); playing = true; startPlaying(); playPauseBtn.textContent='Pause'",
      "onExit": "playing = false; stopPlaying(); playPauseBtn.textContent='Play'",
      "on": {
        "TIMER_TICK": "animating_step",
        "CLICK_PAUSE": "idle",
        "CLICK_STEP": "animating_step",
        "CLICK_RESET_TRAVERSAL": "idle",
        "TRAVERSAL_DONE": "traversal_complete",
        "NODE_MOUSEDOWN": "dragging",
        "CLICK_TOGGLE_ADD": "add_mode",
        "CLICK_TOGGLE_CONNECT": "connect_mode_idle"
      }
    },
    {
      "name": "animating_step",
      "onEnter": "stepTraversal() -> (res = traversal.next()); if (res.done) emit TRAVERSAL_DONE ; else handleStep(res.value) (highlight pseudocode, apply visuals, update stack/visited and run animations like animateEdgePulse/animateNodePulse/animateNodeVisit/flashNode)",
      "onExit": "applyTraversalVisuals(); updateStackView(); updateVisitedView(); highlightPseudocode(null)",
      "on": {
        "STEP_COMPLETE_KEEP_PLAYING": "traversing_playing",
        "STEP_COMPLETE_PAUSED": "traversal_prepared",
        "TRAVERSAL_DONE": "traversal_complete",
        "CLICK_RESET_TRAVERSAL": "idle",
        "NODE_MOUSEDOWN": "dragging"
      }
    },
    {
      "name": "traversal_complete",
      "onEnter": "stopPlaying(); traversal = null; logStatus('Traversal complete'); highlightPseudocode(null)",
      "onExit": null,
      "on": {
        "CLICK_RESET_TRAVERSAL": "idle",
        "CLICK_PLAY": "traversal_prepared_or_playing",
        "CLICK_STEP": "traversal_prepared_or_stepping",
        "CLICK_TOGGLE_ADD": "add_mode",
        "CLICK_TOGGLE_CONNECT": "connect_mode_idle",
        "NODE_MOUSEDOWN": "dragging"
      }
    }
  ],
  "events": [
    "CLICK_TOGGLE_ADD",
    "CLICK_TOGGLE_CONNECT",
    "CANVAS_CLICK",
    "CANVAS_CLICK_ADD_NODE",
    "NODE_CLICK",
    "NODE_CLICK_SAME",
    "NODE_CLICK_DIFFERENT",
    "NODE_MOUSEDOWN",
    "MOUSE_MOVE",
    "TOUCH_MOVE",
    "MOUSE_UP",
    "TOUCH_END",
    "CLICK_PLAY",
    "CLICK_PAUSE",
    "CLICK_STEP",
    "TIMER_TICK",
    "STEP_COMPLETE_KEEP_PLAYING",
    "STEP_COMPLETE_PAUSED",
    "TRAVERSAL_DONE",
    "CLICK_RESET_TRAVERSAL",
    "CLICK_RESET_GRAPH",
    "LOAD_SAMPLE",
    "CLEAR_GRAPH",
    "SET_START_NODE",
    "MODE_CHANGE_ITERATIVE",
    "MODE_CHANGE_RECURSIVE",
    "ORDER_CHANGE_ID",
    "ORDER_CHANGE_ANGLE",
    "KEY_SPACE",
    "KEY_ARROW_RIGHT",
    "KEY_ESCAPE"
  ],
  "notes": "This FSM models two orthogonal concerns (editing modes vs traversal lifecycle) in a flattened state space. The real app maintains flags (addMode, connectMode, playing, traversal generator, selectedForConnect, dragging) rather than a single hierarchical FSM; many transitions in the UI are implemented by toggling these flags and calling functions. Micro-step types emitted by the traversal generator (iterativeDFSGenerator and recursiveDFSGenerator) are: push, pop, visit, mark, edge, skip, aftercall, exit, skipvisited, already — these are handled inside the 'animating_step' state's onEnter via handleStep(...) which performs: highlightPseudocode(line), update visitedSet/visitedSequence, update stackState, updateStackView(), updateVisitedView(), animateEdgePulse(), animateNodePulse(), animateNodeVisit(), flashNode(), and set statusMsg. Dragging is transient and can occur from most states — it is modeled as its own state with start/stop actions. Many user interactions (mode toggles, sample load, clear, start select change) do not force traversal state changes in code; they are represented here as transitions that preserve user intent by calling the corresponding functions (loadSample, clearGraph, addNode, addEdge, resetTraversalState, prepareTraversal, startPlaying, stopPlaying)."
}