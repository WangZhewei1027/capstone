{
  "topic": "KNN Interactive Application",
  "description": "Finite state machine modeling the interactive behaviors of the K-Nearest Neighbors (KNN) classifier web module: tool selection, canvas pointer interactions (placing, dragging, deleting), UI control changes, background decision-field computation, and continuous animation/drawing.",
  "states": [
    {
      "name": "idle",
      "onEnter": "clearToolButtons",
      "onExit": null,
      "on": {
        "CLICK_TOOL_A": "tool-A",
        "CLICK_TOOL_B": "tool-B",
        "CLICK_TOOL_DELETE": "tool-DELETE",
        "KEY_TOOL_A": "tool-A",
        "KEY_TOOL_B": "tool-B",
        "KEY_TOOL_DELETE": "tool-DELETE",
        "POINTER_DOWN_ON_POINT": "dragging-point",
        "POINTER_DOWN_ON_QUERY": "dragging-query",
        "POINTER_DOWN_EMPTY_CANVAS": "idle",
        "ADD_POINT_DEFAULT": "idle",
        "RANDOMIZE": "idle",
        "CLEAR_POINTS": "idle",
        "CENTER_QUERY": "idle",
        "K_CHANGED": "idle",
        "METRIC_CHANGED": "idle",
        "WEIGHT_TOGGLED": "idle",
        "SCHEDULE_BG_DEBOUNCE": "bg-debouncing",
        "SCHEDULE_BG_IMMEDIATE": "bg-computing"
      }
    },
    {
      "name": "tool-A",
      "onEnter": "selectToolA",
      "onExit": "clearToolButtons",
      "on": {
        "CLICK_TOOL_A": "idle",
        "CLICK_CANVAS": "tool-A",
        "POINTER_DOWN_ON_POINT": "dragging-point",
        "POINTER_DOWN_ON_QUERY": "dragging-query",
        "KEY_TOOL_B": "tool-B",
        "KEY_TOOL_DELETE": "tool-DELETE",
        "RANDOMIZE": "tool-A",
        "CLEAR_POINTS": "tool-A",
        "CENTER_QUERY": "tool-A",
        "K_CHANGED": "tool-A",
        "METRIC_CHANGED": "tool-A",
        "WEIGHT_TOGGLED": "tool-A",
        "SCHEDULE_BG_DEBOUNCE": "bg-debouncing",
        "SCHEDULE_BG_IMMEDIATE": "bg-computing"
      }
    },
    {
      "name": "tool-B",
      "onEnter": "selectToolB",
      "onExit": "clearToolButtons",
      "on": {
        "CLICK_TOOL_B": "idle",
        "CLICK_CANVAS": "tool-B",
        "POINTER_DOWN_ON_POINT": "dragging-point",
        "POINTER_DOWN_ON_QUERY": "dragging-query",
        "KEY_TOOL_A": "tool-A",
        "KEY_TOOL_DELETE": "tool-DELETE",
        "RANDOMIZE": "tool-B",
        "CLEAR_POINTS": "tool-B",
        "CENTER_QUERY": "tool-B",
        "K_CHANGED": "tool-B",
        "METRIC_CHANGED": "tool-B",
        "WEIGHT_TOGGLED": "tool-B",
        "SCHEDULE_BG_DEBOUNCE": "bg-debouncing",
        "SCHEDULE_BG_IMMEDIATE": "bg-computing"
      }
    },
    {
      "name": "tool-DELETE",
      "onEnter": "selectToolDelete",
      "onExit": "clearToolButtons",
      "on": {
        "CLICK_TOOL_DELETE": "idle",
        "CLICK_CANVAS_ON_POINT": "tool-DELETE",
        "CLICK_CANVAS_EMPTY": "tool-DELETE",
        "POINTER_DOWN_ON_POINT": "dragging-point",
        "POINTER_DOWN_ON_QUERY": "dragging-query",
        "KEY_TOOL_A": "tool-A",
        "KEY_TOOL_B": "tool-B",
        "RANDOMIZE": "tool-DELETE",
        "CLEAR_POINTS": "tool-DELETE",
        "CENTER_QUERY": "tool-DELETE",
        "K_CHANGED": "tool-DELETE",
        "METRIC_CHANGED": "tool-DELETE",
        "WEIGHT_TOGGLED": "tool-DELETE",
        "SCHEDULE_BG_DEBOUNCE": "bg-debouncing",
        "SCHEDULE_BG_IMMEDIATE": "bg-computing"
      }
    },
    {
      "name": "dragging-point",
      "onEnter": "startDragPoint",
      "onExit": "stopDragAndScheduleBg",
      "on": {
        "POINTER_MOVE": "dragging-point",
        "POINTER_UP": "idle",
        "POINTER_CANCEL": "idle",
        "KEY_ESC": "idle"
      }
    },
    {
      "name": "dragging-query",
      "onEnter": "startDragQuery",
      "onExit": "stopDragAndScheduleBg",
      "on": {
        "POINTER_MOVE": "dragging-query",
        "POINTER_UP": "idle",
        "POINTER_CANCEL": "idle",
        "KEY_ESC": "idle",
        "KEY_ARROW_NUDGE": "dragging-query"
      }
    },
    {
      "name": "bg-debouncing",
      "onEnter": "startBgDebounceTimer",
      "onExit": "clearBgDebounceTimer",
      "on": {
        "BG_DEBOUNCE_TIMER_EXPIRED": "bg-computing",
        "CANCEL_BG_DEBOUNCE": "bg-idle",
        "SCHEDULE_BG_IMMEDIATE": "bg-computing"
      }
    },
    {
      "name": "bg-computing",
      "onEnter": "computeBackground",
      "onExit": "bgComputeDone",
      "on": {
        "BG_COMPUTE_DONE": "bg-idle"
      }
    },
    {
      "name": "bg-idle",
      "onEnter": null,
      "onExit": null,
      "on": {
        "SCHEDULE_BG_DEBOUNCE": "bg-debouncing",
        "SCHEDULE_BG_IMMEDIATE": "bg-computing"
      }
    },
    {
      "name": "animating",
      "onEnter": "startAnimation",
      "onExit": "stopAnimation",
      "on": {
        "STOP_ANIMATION": "idle",
        "DRAW_FRAME": "animating"
      }
    }
  ],
  "events": [
    "CLICK_TOOL_A",
    "CLICK_TOOL_B",
    "CLICK_TOOL_DELETE",
    "KEY_TOOL_A",
    "KEY_TOOL_B",
    "KEY_TOOL_DELETE",
    "CLICK_CANVAS",
    "CLICK_CANVAS_ON_POINT",
    "CLICK_CANVAS_EMPTY",
    "POINTER_DOWN_ON_POINT",
    "POINTER_DOWN_ON_QUERY",
    "POINTER_DOWN_EMPTY_CANVAS",
    "POINTER_MOVE",
    "POINTER_UP",
    "POINTER_CANCEL",
    "ADD_POINT_DEFAULT",
    "ADD_POINT_CLASS_A",
    "ADD_POINT_CLASS_B",
    "DELETE_POINT",
    "START_DRAG",
    "STOP_DRAG",
    "KEY_ARROW_NUDGE",
    "KEY_ESC",
    "RANDOMIZE",
    "CLEAR_POINTS",
    "CENTER_QUERY",
    "K_CHANGED",
    "METRIC_CHANGED",
    "WEIGHT_TOGGLED",
    "SCHEDULE_BG_DEBOUNCE",
    "SCHEDULE_BG_IMMEDIATE",
    "BG_DEBOUNCE_TIMER_EXPIRED",
    "BG_COMPUTE_DONE",
    "DRAW_FRAME",
    "START_ANIMATION",
    "STOP_ANIMATION"
  ],
  "notes": "State actions map to code functions: selectToolA/selectToolB/selectToolDelete implement UI button primary toggles and set tool variable; clearToolButtons clears visual pressed state; ADD_POINT_CLASS_* and ADD_POINT_DEFAULT map to points.push(...) and scheduleBgCompute(); DELETE_POINT removes point and scheduleBgCompute(); startDragPoint/startDragQuery set dragging state; stopDragAndScheduleBg clears dragging and triggers scheduleBgCompute(); scheduleBgCompute debounced vs immediate correspond to SCHEDULE_BG_DEBOUNCE and SCHEDULE_BG_IMMEDIATE; computeBackground performs the heavy low-resolution decision-field calculation and emits BG_COMPUTE_DONE on completion; startBgDebounceTimer/clearBgDebounceTimer are the debounce timer logic used by scheduleBgComputeDebounced; animating is continuously active in the real app (startAnimation called at init). Many UI events (k/metric/weight changes, randomize, clear, center) trigger background recomputation and redraws but do not change tool/drag state. The FSM intentionally separates interaction-focused states (tool selection, dragging) from background-computation sub-states and a contiguous animation state."
}