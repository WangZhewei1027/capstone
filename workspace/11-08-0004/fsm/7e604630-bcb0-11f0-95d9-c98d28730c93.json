{
  "topic": "Counting Sort Interactive Module",
  "description": "Finite state machine modeling the interactive counting-sort visualization: configuration of input/range, stepping micro-operations (count, cumulative, place), playback (auto-run), visual animations (bucket pulses, bar highlights, placement animation), and completion/reset behaviors.",
  "states": [
    {
      "name": "idle",
      "onEnter": "renderReadyStatus",
      "on": {
        "APPLY": "applying",
        "RANDOMIZE": "randomizing",
        "SHUFFLE": "shuffling",
        "RESET_CONFIG": "resettingConfig",
        "FAST_RESET": "resetVisual",
        "STEP_CLICK": "stepping",
        "PLAY_CLICK": "playing",
        "SPEED_CHANGE": "idle",
        "KEY_SPACE": "playing",
        "KEY_ARROW_RIGHT": "stepping",
        "KEY_CTRL_R": "resettingConfig"
      }
    },
    {
      "name": "applying",
      "onEnter": "applyConfig",
      "on": {
        "COMPLETE": "idle"
      }
    },
    {
      "name": "randomizing",
      "onEnter": "randomizeArray",
      "on": {
        "COMPLETE": "idle"
      }
    },
    {
      "name": "shuffling",
      "onEnter": "shuffleArray",
      "on": {
        "COMPLETE": "idle"
      }
    },
    {
      "name": "resettingConfig",
      "onEnter": "resetToOriginal",
      "on": {
        "COMPLETE": "idle"
      }
    },
    {
      "name": "resetVisual",
      "onEnter": "resetVisualOnly",
      "on": {
        "COMPLETE": "idle"
      }
    },
    {
      "name": "stepping",
      "onEnter": "doStep",
      "on": {
        "STEP_DONE": "idle",
        "NEED_ANIMATION": "animatingPlacement",
        "CUMULATIVE_CALC": "computingCumulative",
        "PLACEMENT_PREP": "preparingPlacement",
        "FINISHED": "finished"
      }
    },
    {
      "name": "computingCumulative",
      "onEnter": "computeCumulativeMicroOps",
      "on": {
        "COMPLETE": "stepping"
      }
    },
    {
      "name": "preparingPlacement",
      "onEnter": "preparePlacementOps",
      "on": {
        "COMPLETE": "stepping"
      }
    },
    {
      "name": "animatingPlacement",
      "onEnter": "animatePlace",
      "onExit": "revealOriginalAndFillOutput",
      "on": {
        "ANIMATION_END": "stepping",
        "ANIMATION_ABORT": "stepping"
      }
    },
    {
      "name": "playing",
      "onEnter": "startPlaying",
      "onExit": "stopPlaying",
      "on": {
        "PLAY_CLICK": "idle",
        "PAUSE": "idle",
        "TIMER_TICK": "stepping",
        "FINISHED": "finished",
        "NEED_ANIMATION": "animatingPlacement",
        "SPEED_CHANGE": "playing"
      }
    },
    {
      "name": "finished",
      "onEnter": "setFinishedStatus",
      "on": {
        "RESET_CONFIG": "resettingConfig",
        "FAST_RESET": "resetVisual",
        "APPLY": "applying",
        "RANDOMIZE": "randomizing",
        "SHUFFLE": "shuffling",
        "STEP_CLICK": "stepping",
        "PLAY_CLICK": "playing"
      }
    }
  ],
  "events": [
    "APPLY",
    "RANDOMIZE",
    "SHUFFLE",
    "RESET_CONFIG",
    "FAST_RESET",
    "STEP_CLICK",
    "PLAY_CLICK",
    "SPEED_CHANGE",
    "KEY_SPACE",
    "KEY_ARROW_RIGHT",
    "KEY_CTRL_R",
    "COMPLETE",
    "STEP_DONE",
    "NEED_ANIMATION",
    "ANIMATION_END",
    "ANIMATION_ABORT",
    "CUMULATIVE_CALC",
    "PLACEMENT_PREP",
    "TIMER_TICK",
    "PAUSE",
    "FINISHED"
  ],
  "notes": "High-level mapping of UI and internal micro-operations to FSM states and events.\n- 'idle' models the Ready state where the UI awaits user actions. onEnter runs a simple status update (renderReadyStatus).\n- Configuration actions are modeled as short lived states (applying, randomizing, shuffling, resettingConfig, resetVisual). Each has an onEnter action that performs the synchronous operation (applyConfig, randomizeArray, shuffleArray, resetToOriginal, resetVisualOnly) and then produces COMPLETE to return to idle.\n- 'stepping' represents the execution of one micro-operation (doStep). doStep inspects the current micro-op (types: 'count', 'calc-cumulative-start', 'cumulative', 'place-start', 'place') and triggers internal transitions: CUMULATIVE_CALC to compute and inject cumulative micro-ops, PLACEMENT_PREP to create place micro-ops, or NEED_ANIMATION when a place micro-op requires animated movement.\n- 'computingCumulative' and 'preparingPlacement' are transient states that model synchronous construction/insertion of more micro-ops and immediately return to 'stepping'.\n- 'animatingPlacement' models the asynchronous placement animation (animatePlace). onEnter triggers animatePlace and on ANIMATION_END the FSM returns to 'stepping'. onExit performs cleanup (revealOriginalAndFillOutput) which corresponds to restoring visibility and filling output cell.\n- 'playing' runs the auto-loop (startPlaying). Its onExit stops the loop (stopPlaying). While playing, the same micro-ops are executed via stepping; when the stepIndex reaches the end the FINISHED event moves to 'finished'.\n- 'finished' sets the Status to Finished; user actions can reconfigure or restart from this state.\n- Events listed include user interactions (buttons, keys), internal micro-op signals (CUMULATIVE_CALC, PLACEMENT_PREP), animation lifecycle events (NEED_ANIMATION, ANIMATION_END) and lifecycle events (COMPLETE, STEP_DONE, FINISHED). \n- Action names correspond to functions in the source: applyConfig, randomizeArray, shuffleArray, resetToOriginal, resetVisualOnly, doStep, computeCumulativeMicroOps, preparePlacementOps, animatePlace, revealOriginalAndFillOutput, startPlaying, stopPlaying, setFinishedStatus, renderReadyStatus. Some operations are asynchronous (doStep, animatePlace, startPlaying) and produce events back into the FSM when they complete (STEP_DONE, ANIMATION_END, FINISHED)."
}