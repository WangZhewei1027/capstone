{
  "topic": "Interactive Graph Module",
  "description": "Models the interactive states of a graph drawing/traversal web application (node creation, edge creation/editing, dragging, picking start/end, traversal animation, and clearing).",
  "states": [
    {
      "name": "idle",
      "onEnter": "setStatusIdle",
      "onExit": null,
      "on": {
        "CANVAS_CLICK": "idle",
        "NODE_CLICK_WHILE_IDLE": "creating_edge",
        "PICK_START_CLICK": "pick_start",
        "PICK_END_CLICK": "pick_end",
        "EDGE_CLICK": "edge_selected",
        "NODE_MOUSEDOWN": "dragging",
        "RUN_TRAVERSAL": "animating",
        "CLEAR": "idle",
        "RESET_LAYOUT": "idle",
        "DELETE_KEY": "idle"
      }
    },
    {
      "name": "creating_edge",
      "onEnter": "highlightNode (creatingEdgeFrom)",
      "onExit": "unhighlightNode (creatingEdgeFrom)",
      "on": {
        "NODE_CLICK_AS_TARGET": "idle",
        "NODE_CLICK_SAME_AS_SOURCE": "idle",
        "CANVAS_CLICK": "idle",
        "NODE_MOUSEDOWN": "dragging",
        "DESELECT_BACKGROUND": "idle",
        "EDGE_CREATED": "idle"
      }
    },
    {
      "name": "dragging",
      "onEnter": "attachDragListeners (set draggingNode, compute dragOffset)",
      "onExit": "detachDragListeners (clear draggingNode)",
      "on": {
        "MOUSE_MOVE": "dragging",
        "TOUCH_MOVE": "dragging",
        "MOUSE_UP": "creating_edge_or_idle",
        "TOUCH_END": "creating_edge_or_idle"
      }
    },
    {
      "name": "edge_selected",
      "onEnter": "selectEdge (highlight edge, populate editor inputs)",
      "onExit": "deselectEdge (clear highlight, clear editor)",
      "on": {
        "SET_WEIGHT": "edge_selected",
        "REVERSE_EDGE": "edge_selected",
        "TOGGLE_DIRECTED": "edge_selected",
        "DELETE_EDGE": "idle",
        "DESELECT_BACKGROUND": "idle",
        "EDGE_DOUBLE_CLICK": "edge_selected"
      }
    },
    {
      "name": "pick_start",
      "onEnter": "setPickModeStart (pickMode='start', setStatus)",
      "onExit": "clearPickMode",
      "on": {
        "NODE_CLICK_WHILE_PICK": "idle",
        "CANVAS_CLICK": "idle",
        "CANCEL_PICK": "idle"
      }
    },
    {
      "name": "pick_end",
      "onEnter": "setPickModeEnd (pickMode='end', setStatus)",
      "onExit": "clearPickMode",
      "on": {
        "NODE_CLICK_WHILE_PICK": "idle",
        "CANVAS_CLICK": "idle",
        "CANCEL_PICK": "idle"
      }
    },
    {
      "name": "animating",
      "onEnter": "animateTraversal (compute BFS/DFS, highlight visited & path)",
      "onExit": "clearTraversalHighlights (remove temporary visited/highlight classes)",
      "on": {
        "TRAVERSAL_COMPLETE": "idle",
        "TRAVERSAL_NOT_FOUND": "idle",
        "CLEAR": "idle"
      }
    },
    {
      "name": "creating_edge_or_idle",
      "onEnter": "determineReturn (if creatingEdgeFrom exists => creating_edge else idle)",
      "onExit": null,
      "on": {
        "RESOLVE": "idle"
      }
    }
  ],
  "events": [
    "CANVAS_CLICK",
    "NODE_CLICK_WHILE_IDLE",
    "NODE_CLICK_AS_TARGET",
    "NODE_CLICK_SAME_AS_SOURCE",
    "NODE_CLICK_WHILE_PICK",
    "NODE_MOUSEDOWN",
    "MOUSE_MOVE",
    "MOUSE_UP",
    "TOUCH_MOVE",
    "TOUCH_END",
    "EDGE_CLICK",
    "EDGE_DOUBLE_CLICK",
    "DESELECT_BACKGROUND",
    "PICK_START_CLICK",
    "PICK_END_CLICK",
    "RUN_TRAVERSAL",
    "TRAVERSAL_COMPLETE",
    "TRAVERSAL_NOT_FOUND",
    "SET_WEIGHT",
    "REVERSE_EDGE",
    "TOGGLE_DIRECTED",
    "DELETE_EDGE",
    "CLEAR",
    "RESET_LAYOUT",
    "DELETE_KEY",
    "CANCEL_PICK"
  ],
  "notes": "This FSM models the primary interactive modes. Some behaviours depend on contextual flags/state variables (creatingEdgeFrom, pickMode, selectedEdge, draggingNode):\n- Clicking the canvas in idle creates a new node (implementation: createNode) and remains in idle. In this FSM that is modeled as CANVAS_CLICK -> idle (the create node side-effect occurs during handling).\n- NODE_CLICK_WHILE_IDLE means the user clicked a node when not in pick mode and no edge creation in progress; it enters creating_edge and stores creatingEdgeFrom. If the user clicks a second node (NODE_CLICK_AS_TARGET) an edge is created and the FSM returns to idle.\n- creating_edge has a highlight applied onEnter and removed onExit. Clicking the same node cancels creation.\n- dragging can be entered from idle or creating_edge; dragging preserves the creatingEdgeFrom context when entered from creating_edge. On MOUSE_UP/TOUCH_END the FSM returns to creating_edge if creatingEdgeFrom remains, otherwise to idle.\n- edge_selected models editing mode for a selected edge (weight changes, reverse, toggle directed, delete). delete transitions back to idle and removes the edge. Double-clicking an edge triggers reverseEdge (edge double-click handled in same state).\n- pick_start and pick_end are transient selection modes triggered by the Pick Start / Pick End buttons; clicking a node while in these modes sets the start/end node and returns to idle. Clicking the canvas cancels pick mode.\n- animating executes animateTraversal on enter (computes BFS/DFS respecting directed edges and animates visited nodes/edges). When animation finishes the TRAVERSAL_COMPLETE or TRAVERSAL_NOT_FOUND event returns to idle.\n- creating_edge_or_idle is an implementation helper state representing the logic to decide whether to return to creating_edge or idle after dragging finishes. The actual code retains creatingEdgeFrom when a drag began during creating_edge, hence re-entry to creating_edge is possible.\n- onEnter/onExit actions listed reference functions or conceptual actions implemented in the script (e.g., highlightNode, createNode, attachDragListeners, animateTraversal, updateAdjViews, selectEdge, deselectEdge). Guards and conditional transitions (for example clicking node behavior when pickMode is set vs. normal) are indicated in these notes rather than encoded as separate guarded transitions in the simplified FSM."
}