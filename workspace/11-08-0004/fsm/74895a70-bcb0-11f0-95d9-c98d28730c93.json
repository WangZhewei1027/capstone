{
  "topic": "Deque Interactive Module",
  "description": "Finite State Machine modeling user interactions, animations, drag-and-drop, data operations, and visual feedback for a double-ended queue visualizer.",
  "states": [
    {
      "name": "idle",
      "onEnter": "render / updateControls / updatePeek / logReady",
      "on": {
        "CLICK_PUSH_FRONT": "ADDING_FRONT",
        "CLICK_PUSH_BACK": "ADDING_BACK",
        "CLICK_POP_FRONT": "REMOVING_FRONT",
        "CLICK_POP_BACK": "REMOVING_BACK",
        "CLICK_PEEK": "PEEKING",
        "CLICK_CLEAR": "CLEARING",
        "CLICK_FILL": "FILLING",
        "INPUT_ENTER_PRESS": "ADDING_BACK",
        "DRAG_START": "DRAGGING",
        "CAPACITY_CHANGE": "CAPACITY_CHANGING",
        "CLICK_DROP_FRONT": "ADDING_FRONT",
        "CLICK_DROP_BACK": "ADDING_BACK",
        "ERROR_CAPACITY_FULL": "idle",
        "LOG_IGNORED_EMPTY": "idle"
      }
    },
    {
      "name": "ADDING_FRONT",
      "onEnter": "animateAdd(value, 'front')  // create node with adding-left class, schedule commit after ~360ms",
      "onExit": "renderFadeNodes / updateControls",
      "on": {
        "ANIMATION_ADD_COMPLETE": "idle",
        "ANIMATION_ADD_COMPLETE_FULL": "FULL"
      }
    },
    {
      "name": "ADDING_BACK",
      "onEnter": "animateAdd(value, 'back')  // create node with adding-right class, schedule commit after ~360ms",
      "onExit": "renderFadeNodes / updateControls",
      "on": {
        "ANIMATION_ADD_COMPLETE": "idle",
        "ANIMATION_ADD_COMPLETE_FULL": "FULL"
      }
    },
    {
      "name": "REMOVING_FRONT",
      "onEnter": "animateRemove('front')  // mark first node removing-left; model shift happens immediately; finish after ~320ms",
      "onExit": "renderFadeNodes / updateControls",
      "on": {
        "ANIMATION_REMOVE_COMPLETE": "idle",
        "ANIMATION_REMOVE_COMPLETE_EMPTY": "EMPTY"
      }
    },
    {
      "name": "REMOVING_BACK",
      "onEnter": "animateRemove('back')  // mark last node removing-right; model pop happens immediately; finish after ~320ms",
      "onExit": "renderFadeNodes / updateControls",
      "on": {
        "ANIMATION_REMOVE_COMPLETE": "idle",
        "ANIMATION_REMOVE_COMPLETE_EMPTY": "EMPTY"
      }
    },
    {
      "name": "PEEKING",
      "onEnter": "logPeek()  // logs front/back values; no model mutation",
      "on": {
        "PEEK_LOGGED": "idle"
      }
    },
    {
      "name": "CLEARING",
      "onEnter": "clearDeque() / render() / updateControls / logClear",
      "on": {
        "CLEARED": "idle"
      }
    },
    {
      "name": "FILLING",
      "onEnter": "startFillSequence()  // repeatedly animateAdd(back) until capacity reached; log 'Fill requested.'",
      "onExit": "updateControls / renderFadeNodes",
      "on": {
        "ANIMATION_ADD_COMPLETE": "FILLING",
        "FILL_SEQUENCE_COMPLETE": "idle",
        "FILL_SEQUENCE_COMPLETE_FULL": "FULL"
      }
    },
    {
      "name": "DRAGGING",
      "onEnter": "showDropOverlay()  // dropTarget pointerEvents=auto; reveal overlay",
      "onExit": "hideDropOverlay()  // remove active classes; pointerEvents=none",
      "on": {
        "DRAG_OVER_FRONT": "DRAG_OVER_FRONT",
        "DRAG_OVER_BACK": "DRAG_OVER_BACK",
        "DRAG_END": "idle"
      }
    },
    {
      "name": "DRAG_OVER_FRONT",
      "onEnter": "setDropFrontActive()  // add active-front class",
      "onExit": "clearDropFrontActive()",
      "on": {
        "DROP_ON_FRONT": "ADDING_FRONT",
        "DRAG_LEAVE_FRONT": "DRAGGING",
        "DRAG_END": "idle"
      }
    },
    {
      "name": "DRAG_OVER_BACK",
      "onEnter": "setDropBackActive()  // add active-back class",
      "onExit": "clearDropBackActive()",
      "on": {
        "DROP_ON_BACK": "ADDING_BACK",
        "DRAG_LEAVE_BACK": "DRAGGING",
        "DRAG_END": "idle"
      }
    },
    {
      "name": "CAPACITY_CHANGING",
      "onEnter": "updateCapacityFromInput() / if truncated then truncateModelAndRender() / logCapacityChange / updateControls",
      "on": {
        "CAPACITY_UPDATED": "idle",
        "CAPACITY_REDUCED_TRUNCATED": "idle",
        "CAPACITY_SET_FULL": "FULL"
      }
    },
    {
      "name": "FULL",
      "onEnter": "updateControls() / logCapacityFull()  // push controls disabled",
      "onExit": "updateControls()",
      "on": {
        "CLICK_POP_FRONT": "REMOVING_FRONT",
        "CLICK_POP_BACK": "REMOVING_BACK",
        "CLICK_PUSH_FRONT": "ERROR_CAPACITY_FULL",
        "CLICK_PUSH_BACK": "ERROR_CAPACITY_FULL",
        "ANIMATION_REMOVE_COMPLETE": "idle",
        "CAPACITY_CHANGE": "CAPACITY_CHANGING"
      }
    },
    {
      "name": "EMPTY",
      "onEnter": "updateControls() / logEmptyState()",
      "onExit": "updateControls()",
      "on": {
        "CLICK_PUSH_FRONT": "ADDING_FRONT",
        "CLICK_PUSH_BACK": "ADDING_BACK",
        "CLICK_FILL": "FILLING",
        "CLICK_POP_FRONT": "idle",
        "CLICK_POP_BACK": "idle",
        "INPUT_ENTER_PRESS": "ADDING_BACK"
      }
    }
  ],
  "events": [
    "CLICK_PUSH_FRONT",
    "CLICK_PUSH_BACK",
    "CLICK_POP_FRONT",
    "CLICK_POP_BACK",
    "CLICK_PEEK",
    "CLICK_CLEAR",
    "CLICK_FILL",
    "INPUT_ENTER_PRESS",
    "DRAG_START",
    "DRAG_END",
    "DRAG_OVER_FRONT",
    "DRAG_OVER_BACK",
    "DRAG_LEAVE_FRONT",
    "DRAG_LEAVE_BACK",
    "DROP_ON_FRONT",
    "DROP_ON_BACK",
    "CLICK_DROP_FRONT",
    "CLICK_DROP_BACK",
    "CAPACITY_CHANGE",
    "ANIMATION_ADD_COMPLETE",
    "ANIMATION_ADD_COMPLETE_FULL",
    "ANIMATION_REMOVE_COMPLETE",
    "ANIMATION_REMOVE_COMPLETE_EMPTY",
    "FILL_SEQUENCE_COMPLETE",
    "PEEK_LOGGED",
    "CLEARED",
    "CAPACITY_UPDATED",
    "CAPACITY_REDUCED_TRUNCATED",
    "ERROR_CAPACITY_FULL",
    "LOG_IGNORED_EMPTY"
  ],
  "notes": "State actions map to functions and behaviors in the script: animateAdd(value,end) (creates DOM node with adding-left/adding-right classes and schedules model commit after ~360ms), animateRemove(end) (adds removing-left/removing-right class; model shift/pop happens immediately; final re-render after ~320ms), render()/renderFadeNodes()/updateControls()/updatePeek() update UI and enable/disable buttons. Dragging shows the drop overlay (dropTarget pointerEvents toggled) and active classes are added/removed in DRAG_OVER_FRONT/BACK. Filling triggers repeated animateAdd calls until capacity reached. Capacity changes may truncate the model. Many invalid user actions (empty input push or push when full) log messages and keep the machine in its current state. Timing-dependent transitions (ANIMATION_ADD_COMPLETE / ANIMATION_REMOVE_COMPLETE) correspond to the timeouts used in the implementation."
}