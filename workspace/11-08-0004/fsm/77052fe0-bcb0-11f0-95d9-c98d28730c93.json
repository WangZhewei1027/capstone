{
  "topic": "Graph Interactive Application",
  "description": "Finite state machine modeling the interactive states and transitions of an SVG-based graph editor that supports adding/moving nodes, creating edges (shift+drag), toggling directed/weighted modes, editing weights (modal), reachability animation, and edge-draw animation.",
  "states": [
    {
      "name": "idle",
      "onEnter": "updateStats",
      "on": {
        "CLICK_CANVAS": "idle",
        "CLICK_ADD_NODE": "idle",
        "CLICK_CLEAR": "idle",
        "TOGGLE_DIRECTED": "idle",
        "TOGGLE_WEIGHTED": "idle",
        "NODE_MOUSEDOWN_NO_SHIFT": "node_dragging",
        "NODE_MOUSEDOWN_WITH_SHIFT": "edge_creating",
        "NODE_CLICK": "idle",
        "CANVAS_MOUSEDOWN": "idle",
        "DOUBLE_CLICK_EDGE": "modal_weight_prompt",
        "CLICK_REACHABLE": "animating_reachable",
        "CLICK_ANIMATE_DRAW": "animating_edge_draw",
        "KEY_ENTER_SVG": "idle",
        "KEY_DELETE": "idle",
        "RESIZE": "idle"
      }
    },
    {
      "name": "node_dragging",
      "onEnter": "startNodeDrag (set draggingNode, attach move/up listeners)",
      "onExit": "stopNodeDrag (clear draggingNode, detach listeners, update connected edges & stats)",
      "on": {
        "MOUSE_MOVE": "node_dragging",
        "MOUSE_UP": "idle",
        "TOGGLE_DIRECTED": "node_dragging",
        "TOGGLE_WEIGHTED": "node_dragging",
        "KEY_DELETE": "idle",
        "RESIZE": "node_dragging"
      }
    },
    {
      "name": "edge_creating",
      "onEnter": "startEdgePreview (set creatingEdge, create preview path)",
      "onExit": "endEdgePreview (remove preview; possibly createEdge if released on a different node)",
      "on": {
        "MOUSE_MOVE": "edge_creating",
        "MOUSE_UP_ON_NODE": "idle",
        "MOUSE_UP_ON_EMPTY": "idle",
        "CANCEL_EDGE_PREVIEW": "idle",
        "TOGGLE_DIRECTED": "edge_creating",
        "TOGGLE_WEIGHTED": "edge_creating",
        "RESIZE": "edge_creating"
      }
    },
    {
      "name": "modal_weight_prompt",
      "onEnter": "showWeightPrompt (render modal, focus input)",
      "onExit": "hideWeightPrompt (remove modal)",
      "on": {
        "CONFIRM_WEIGHT": "idle",
        "CANCEL_WEIGHT_PROMPT": "idle",
        "KEY_DELETE": "modal_weight_prompt"
      }
    },
    {
      "name": "animating_reachable",
      "onEnter": "runReachabilityAnimation (BFS compute visited, highlight reachable nodes, schedule pulses)",
      "onExit": "clearReachabilityHighlights",
      "on": {
        "ANIMATION_COMPLETE": "idle",
        "TOGGLE_DIRECTED": "animating_reachable",
        "TOGGLE_WEIGHTED": "animating_reachable",
        "KEY_DELETE": "animating_reachable",
        "RESIZE": "animating_reachable"
      }
    },
    {
      "name": "animating_edge_draw",
      "onEnter": "runEdgeDrawAnimation (replay stroke-dash animations for edges)",
      "onExit": "finishEdgeDrawAnimation (clear temporary transition styles)",
      "on": {
        "ANIMATION_COMPLETE": "idle",
        "TOGGLE_DIRECTED": "animating_edge_draw",
        "TOGGLE_WEIGHTED": "animating_edge_draw",
        "KEY_DELETE": "animating_edge_draw",
        "RESIZE": "animating_edge_draw"
      }
    }
  ],
  "events": [
    "CLICK_CANVAS",
    "CLICK_ADD_NODE",
    "CLICK_CLEAR",
    "TOGGLE_DIRECTED",
    "TOGGLE_WEIGHTED",
    "NODE_MOUSEDOWN_NO_SHIFT",
    "NODE_MOUSEDOWN_WITH_SHIFT",
    "NODE_CLICK",
    "CANVAS_MOUSEDOWN",
    "DOUBLE_CLICK_EDGE",
    "CLICK_REACHABLE",
    "CLICK_ANIMATE_DRAW",
    "MOUSE_MOVE",
    "MOUSE_UP",
    "MOUSE_UP_ON_NODE",
    "MOUSE_UP_ON_EMPTY",
    "CANCEL_EDGE_PREVIEW",
    "CONFIRM_WEIGHT",
    "CANCEL_WEIGHT_PROMPT",
    "KEY_ENTER_SVG",
    "KEY_DELETE",
    "ANIMATION_COMPLETE",
    "RESIZE"
  ],
  "notes": "This FSM models high-level interaction modes. Selection (selected node id) is an orthogonal piece of state that persists across modes and is updated on NODE_CLICK / CANVAS_MOUSEDOWN. Node dragging and edge creation are mutually exclusive transient modes driven by mousedown+modifier and mousemove/up events. The weight-edit prompt is a modal that blocks weight edits until closed. Animations (reachability pulses and edge-draw replay) are represented as blocking states for clarity even though the implementation allows some concurrent interactions; ANIMATION_COMPLETE is fired after scheduled timeouts to return to idle. Event names map to DOM interactions in the code: NODE_MOUSEDOWN_WITH_SHIFT corresponds to mousedown while shiftKey is true; NODE_MOUSEDOWN_NO_SHIFT to mousedown without shift; MOUSE_UP_ON_NODE indicates mouseup landed on another node and will cause createEdge; MOUSE_UP_ON_EMPTY indicates preview cancelled. onEnter/onExit actions reference implementation functions: createNode, startNodeDrag/stopNodeDrag, startEdgePreview/endEdgePreview, showWeightPrompt/hideWeightPrompt, runReachabilityAnimation/clearReachabilityHighlights, runEdgeDrawAnimation/finishEdgeDrawAnimation, updateStats, updateModeUI & updateEdgeVisuals, updateEdgePosition. The FSM intentionally abstracts touch equivalents (touchstart/touchmove/touchend) into the same events."
}