{
  "topic": "Interactive Priority Queue (Min-Heap) — Learning Module",
  "description": "Models the interactive states of a min-heap visualization app: inserting, extracting, animations (comparisons/swaps), step-mode pauses, bulk population, and control enable/disable behavior.",
  "states": [
    {
      "name": "idle",
      "onEnter": "enableControls; rebuildVisuals; updateCount",
      "onExit": "disableControls (when starting an operation)",
      "on": {
        "CLICK_INSERT": "inserting",
        "INPUT_ENTER": "inserting",
        "CLICK_RANDOM": "inserting",
        "CLICK_EXTRACT": "extracting",
        "CLICK_CLEAR": "cleared",
        "CLICK_POPULATE": "populating",
        "TOGGLE_STEP_MODE": "idle",
        "SPEED_CHANGE": "idle",
        "RESIZE": "idle"
      }
    },
    {
      "name": "inserting",
      "onEnter": "disableControls; pushValueToHeap; rebuildVisuals; logInsert; startSiftUpIfNeeded",
      "onExit": "",
      "on": {
        "SIFTUP_BEGIN": "sift_up",
        "OPERATION_FINISHED": "idle",
        "RESIZE": "inserting"
      }
    },
    {
      "name": "sift_up",
      "onEnter": "startSiftUpLoop (compare parent/child repeatedly); highlightComparison",
      "onExit": "clearHighlights",
      "on": {
        "SIFTUP_NEED_SWAP": "swapping",
        "SIFTUP_NO_SWAP": "idle",
        "STEP_REQUIRED": "waiting_for_step",
        "RESIZE": "sift_up"
      }
    },
    {
      "name": "extracting",
      "onEnter": "disableControls; logExtractAttempt; handleEmptyOrSingleOrStartSiftDown",
      "onExit": "",
      "on": {
        "SIFTDOWN_BEGIN": "sift_down",
        "OPERATION_FINISHED": "idle",
        "RESIZE": "extracting"
      }
    },
    {
      "name": "sift_down",
      "onEnter": "startSiftDownLoop (compare with children repeatedly); highlightComparison",
      "onExit": "clearHighlights",
      "on": {
        "SIFTDOWN_NEED_SWAP": "swapping",
        "SIFTDOWN_NO_SWAP": "idle",
        "STEP_REQUIRED": "waiting_for_step",
        "RESIZE": "sift_down"
      }
    },
    {
      "name": "swapping",
      "onEnter": "animateSwap (highlight nodes, set transform); disableInteractiveControlsForAnimation",
      "onExit": "rebuildVisuals; clearHighlights",
      "on": {
        "ANIMATION_FINISHED_SIFTUP": "sift_up",
        "ANIMATION_FINISHED_SIFTDOWN": "sift_down",
        "STEP_REQUIRED": "waiting_for_step",
        "RESIZE": "swapping"
      }
    },
    {
      "name": "indicate_no_swap",
      "onEnter": "highlightComparison; waitShortAnimation (no swap); clearHighlights",
      "onExit": "",
      "on": {
        "ANIMATION_FINISHED": "idle",
        "STEP_REQUIRED": "waiting_for_step",
        "RESIZE": "indicate_no_swap"
      }
    },
    {
      "name": "waiting_for_step",
      "onEnter": "enableStepButton; setPendingStepResolve; pauseAnimationTimers",
      "onExit": "disableStepButton; clearPendingStepResolve",
      "on": {
        "CLICK_STEP": "step_resumed",
        "TOGGLE_STEP_MODE": "idle"
      }
    },
    {
      "name": "step_resumed",
      "onEnter": "resolvePendingStep; resumeAnimation",
      "onExit": "",
      "on": {
        "ANIMATION_RESUMED_TO_SWAPPING": "swapping",
        "ANIMATION_RESUMED_TO_SIFTUP": "sift_up",
        "ANIMATION_RESUMED_TO_SIFTDOWN": "sift_down",
        "ANIMATION_RESUMED_TO_NO_SWAP": "indicate_no_swap",
        "RESIZE": "step_resumed"
      }
    },
    {
      "name": "populating",
      "onEnter": "disableControls; logPopulateStart; iterateSampleInserts (sequentially perform insertValue for each sample value)",
      "onExit": "enableControls; logPopulateComplete",
      "on": {
        "POPULATE_STEP_BEGIN": "inserting",
        "POPULATE_FINISHED": "idle",
        "RESIZE": "populating"
      }
    },
    {
      "name": "cleared",
      "onEnter": "clearHeap; rebuildVisuals; log('Cleared heap'); updateCount",
      "onExit": "",
      "on": {
        "OPERATION_FINISHED": "idle",
        "RESIZE": "cleared"
      }
    }
  ],
  "events": [
    "CLICK_INSERT",
    "CLICK_RANDOM",
    "CLICK_EXTRACT",
    "CLICK_CLEAR",
    "CLICK_POPULATE",
    "INPUT_ENTER",
    "TOGGLE_STEP_MODE",
    "SPEED_CHANGE",
    "RESIZE",
    "SIFTUP_BEGIN",
    "SIFTUP_NEED_SWAP",
    "SIFTUP_NO_SWAP",
    "SIFTDOWN_BEGIN",
    "SIFTDOWN_NEED_SWAP",
    "SIFTDOWN_NO_SWAP",
    "ANIMATION_STARTED",
    "ANIMATION_FINISHED",
    "ANIMATION_FINISHED_SIFTUP",
    "ANIMATION_FINISHED_SIFTDOWN",
    "STEP_REQUIRED",
    "CLICK_STEP",
    "ANIMATION_RESUMED_TO_SWAPPING",
    "ANIMATION_RESUMED_TO_SIFTUP",
    "ANIMATION_RESUMED_TO_SIFTDOWN",
    "ANIMATION_RESUMED_TO_NO_SWAP",
    "POPULATE_STEP_BEGIN",
    "POPULATE_FINISHED",
    "OPERATION_FINISHED"
  ],
  "notes": "Controls are disabled whenever an operation (insert, extract, populate) is in progress. Animations (compare highlight and swap) may pause if step mode is enabled — the app sets a pending resolver and enables the Step button. Speed slider adjusts animation durations (speedMultiplier). resize events cause rebuildVisuals to reposition nodes/lines. The FSM includes internal events (SIFTUP_/SIFTDOWN_*) used by the operation loops to move between comparing, swapping, and completion. 'swapping' routes back to either sift_up or sift_down depending on which loop requested the swap via ANIMATION_FINISHED_SIFTUP/ANIMATION_FINISHED_SIFTDOWN."
}