{
  "topic": "Interactive Weighted Graph Application",
  "description": "Models the interactive modes, overlays and animations of the weighted graph SVG editor: node/edge creation, dragging, selecting start/end, editing edge weights (overlay), running shortest-path animation (Dijkstra), and reset/confirm flows.",
  "states": [
    {
      "name": "add-node",
      "onEnter": "setModeAddNode",
      "onExit": "",
      "on": {
        "SET_MODE_ADD_EDGE": "add-edge",
        "SET_MODE_MOVE": "move",
        "SET_MODE_SELECT": "select",
        "CLICK_CANVAS": "add-node",
        "KEY_ENTER_CENTER": "add-node",
        "CLICK_NODE": "add-node"
      }
    },
    {
      "name": "add-edge",
      "onEnter": "setModeAddEdge (clears edgeCreating)",
      "onExit": "clearEdgeCreating",
      "on": {
        "SET_MODE_ADD_NODE": "add-node",
        "SET_MODE_MOVE": "move",
        "SET_MODE_SELECT": "select",
        "CLICK_NODE_FIRST": "edge-creating",
        "CLICK_CANVAS": "add-edge",
        "ESCAPE": "add-edge"
      }
    },
    {
      "name": "edge-creating",
      "onEnter": "markEdgeCreating(nodeId) + flashNode(nodeId)",
      "onExit": "clearEdgeCreating",
      "on": {
        "CLICK_NODE_SECOND": "weight-editor-new",
        "CLICK_NODE_SAME": "add-edge",
        "CLICK_CANVAS": "add-edge",
        "SET_MODE_ADD_NODE": "add-node",
        "SET_MODE_MOVE": "move",
        "SET_MODE_SELECT": "select",
        "ESCAPE": "add-edge"
      }
    },
    {
      "name": "move",
      "onEnter": "setModeMove",
      "onExit": "",
      "on": {
        "SET_MODE_ADD_NODE": "add-node",
        "SET_MODE_ADD_EDGE": "add-edge",
        "SET_MODE_SELECT": "select",
        "MOUSEDOWN_ON_NODE": "dragging",
        "CLICK_CANVAS": "move"
      }
    },
    {
      "name": "dragging",
      "onEnter": "startDrag (attach mousemove/mouseup handlers, record dragInfo)",
      "onExit": "endDrag (remove handlers, clear dragInfo)",
      "on": {
        "MOUSEMOVE": "dragging",
        "MOUSEUP": "move",
        "SET_MODE_ADD_NODE": "move",
        "SET_MODE_ADD_EDGE": "move",
        "SET_MODE_SELECT": "move"
      }
    },
    {
      "name": "select",
      "onEnter": "setModeSelect",
      "onExit": "",
      "on": {
        "SET_MODE_ADD_NODE": "add-node",
        "SET_MODE_ADD_EDGE": "add-edge",
        "SET_MODE_MOVE": "move",
        "CLICK_NODE": "select",
        "DBLCLICK_NODE": "select",
        "SELECT_FROM_DROPDOWN": "select",
        "CLICK_CANVAS": "select"
      }
    },
    {
      "name": "weight-editor-new",
      "onEnter": "openWeightEditorForNewEdge(aNode,bNode) (shows overlay, focus input)",
      "onExit": "closeEditor",
      "on": {
        "WEIGHT_OK": "mode-preserve",
        "WEIGHT_CANCEL": "mode-preserve",
        "OUTSIDE_CLICK_WEIGHT_INPUT": "mode-preserve",
        "ESCAPE": "mode-preserve",
        "WINDOW_RESIZE": "mode-preserve"
      }
    },
    {
      "name": "weight-editor-edit",
      "onEnter": "openWeightEditor(edge, mx,my) (shows overlay, focus input)",
      "onExit": "closeEditor",
      "on": {
        "WEIGHT_OK": "mode-preserve",
        "WEIGHT_CANCEL": "mode-preserve",
        "OUTSIDE_CLICK_WEIGHT_INPUT": "mode-preserve",
        "ESCAPE": "mode-preserve",
        "WINDOW_RESIZE": "mode-preserve"
      }
    },
    {
      "name": "mode-preserve",
      "onEnter": "restorePreviousMode (return UI to the mode that was active before the overlay/action)",
      "onExit": "",
      "on": {
        "SET_MODE_ADD_NODE": "add-node",
        "SET_MODE_ADD_EDGE": "add-edge",
        "SET_MODE_MOVE": "move",
        "SET_MODE_SELECT": "select"
      }
    },
    {
      "name": "animating",
      "onEnter": "startShortestPathAnimation (set animating=true, run Dijkstra, produce visitOrder and pathEdges; animate highlights)",
      "onExit": "finishAnimation (set animating=false)",
      "on": {
        "ANIMATION_COMPLETE": "mode-preserve",
        "SET_MODE_ADD_NODE": "animating",
        "SET_MODE_ADD_EDGE": "animating",
        "SET_MODE_MOVE": "animating",
        "SET_MODE_SELECT": "animating"
      }
    },
    {
      "name": "confirm-reset",
      "onEnter": "showResetConfirm (browser confirm prompt)",
      "onExit": "",
      "on": {
        "RESET_CONFIRM_YES": "mode-preserve",
        "RESET_CONFIRM_CANCEL": "mode-preserve"
      }
    }
  ],
  "events": [
    "SET_MODE_ADD_NODE",
    "SET_MODE_ADD_EDGE",
    "SET_MODE_MOVE",
    "SET_MODE_SELECT",
    "CLICK_CANVAS",
    "CLICK_NODE",
    "CLICK_NODE_FIRST",
    "CLICK_NODE_SECOND",
    "CLICK_NODE_SAME",
    "DBLCLICK_NODE",
    "MOUSEDOWN_ON_NODE",
    "MOUSEMOVE",
    "MOUSEUP",
    "KEY_ENTER_CENTER",
    "WEIGHT_OK",
    "WEIGHT_CANCEL",
    "OUTSIDE_CLICK_WEIGHT_INPUT",
    "ESCAPE",
    "WINDOW_RESIZE",
    "START_SHORTEST",
    "ANIMATION_COMPLETE",
    "SELECT_FROM_DROPDOWN",
    "CLICK_EDGE_DBL (opens editor)",
    "RESET_CLICK",
    "RESET_CONFIRM_YES",
    "RESET_CONFIRM_CANCEL"
  ],
  "notes": "This FSM models the visible interactive modes and modal overlays from the application JavaScript. Concrete behaviors: - setModeXXX are triggered by the four mode buttons and update visual button styles. - add-node: CLICK_CANVAS (or Enter) creates a node (addNode action) but the state remains add-node. - add-edge: first CLICK_NODE transitions to edge-creating; clicking a second node transitions to weight-editor-new which opens the weight overlay and on OK creates the edge. Clicking the same node or clicking empty space cancels edge creation. - weight-editor-new and weight-editor-edit represent the same overlay with different origins; after WEIGHT_OK/WEIGHT_CANCEL/OUTSIDE_CLICK/ESCAPE the FSM returns to the previously active editing mode (represented here as mode-preserve which restores the previous mode). The implementation keeps previous mode in memory â€” the FSM uses mode-preserve to indicate that behavior. - dragging: occurs only when in move mode and a mousedown on a node starts dragging; MOUSEMOVE updates node coordinates and MOUSEUP ends drag and returns to move. - animating: triggered by Find Shortest Path; onEnter runs Dijkstra and animates visited nodes/edges then highlights path; while animating new shortest requests are ignored. - confirm-reset is implemented with a blocking browser confirm() in code; it's modeled as a transient confirm state. - The transitions to mode-preserve and restore of previous mode are noted because the overlay/animation do not forcibly change the core mode (the UI returns to whatever mode was active before the overlay)."
}