{
  "topic": "Graph Editor Interactive Module",
  "description": "Finite State Machine modeling the interactive graph editor: node/edge creation, dragging, selection, directed/undirected mode toggling, animations and adjacency updates.",
  "states": [
    {
      "name": "idle",
      "onEnter": "updateAdjacencyDisplay",
      "onExit": "",
      "on": {
        "POINTER_DOWN_NODE": "node_pointer_down",
        "CLICK_CANVAS": "idle",
        "DOUBLE_CLICK_CANVAS": "creating_node",
        "ADD_NODE_CLICK": "creating_node",
        "RANDOM_CLICK": "generating_graph",
        "CLEAR_CLICK": "clearing_graph",
        "DELETE_CLICK": "deleting_selection",
        "DELETE_KEY": "deleting_selection",
        "TOGGLE_DIRECTED_ON": "directed_animating_show",
        "TOGGLE_DIRECTED_OFF": "directed_animating_hide",
        "SELECT_NODE": "node_selected",
        "SELECT_EDGE": "edge_selected",
        "SHOW_MATRIX_TOGGLE": "idle"
      }
    },
    {
      "name": "creating_node",
      "onEnter": "createNodeAtPointerOrCenter; updateAdjacencyDisplay",
      "onExit": "",
      "on": {
        "DONE": "idle",
        "CANCEL": "idle"
      }
    },
    {
      "name": "node_pointer_down",
      "onEnter": "pointerCaptureStart (store pointerState.start coords)",
      "onExit": "pointerCaptureEnd (clear pointerState if any)",
      "on": {
        "POINTER_MOVE_DECIDE_MOVE": "node_moving",
        "POINTER_MOVE_DECIDE_EDGE": "edge_dragging",
        "POINTER_UP_CLICK_SELECT": "node_selected",
        "POINTER_UP_CLICK_CREATE_EDGE": "edge_drawing",
        "POINTER_CANCEL": "idle"
      }
    },
    {
      "name": "node_moving",
      "onEnter": "startMove (set dragMode='move')",
      "onExit": "finalizeMove; updateAdjacencyDisplay",
      "on": {
        "POINTER_MOVE": "node_moving",
        "POINTER_UP": "idle",
        "POINTER_CANCEL": "idle"
      }
    },
    {
      "name": "edge_dragging",
      "onEnter": "startEdgeDrag (set dragMode='edge'; showTempLine)",
      "onExit": "hideTempLine",
      "on": {
        "POINTER_MOVE": "edge_dragging",
        "POINTER_UP_TARGET_NODE": "edge_drawing",
        "POINTER_UP_NO_TARGET": "idle",
        "POINTER_CANCEL": "idle"
      }
    },
    {
      "name": "edge_drawing",
      "onEnter": "createEdge (append path, set drawing class), updateAdjacencyDisplay",
      "onExit": "removeEdgeDrawingClass",
      "on": {
        "EDGE_ANIMATION_END": "idle",
        "IMMEDIATE_DONE": "idle"
      }
    },
    {
      "name": "node_selected",
      "onEnter": "selectNode (add visual selected class); updateSelectedInfo",
      "onExit": "deselectVisual (remove selected class)",
      "on": {
        "POINTER_DOWN_NODE": "node_pointer_down",
        "CLICK_CANVAS": "idle",
        "DELETE_CLICK": "deleting_selection",
        "DELETE_KEY": "deleting_selection",
        "KEY_ARROW": "node_nudge",
        "TOGGLE_DIRECTED_ON": "directed_animating_show",
        "TOGGLE_DIRECTED_OFF": "directed_animating_hide",
        "SELECT_EDGE": "edge_selected",
        "ADD_NODE_CLICK": "creating_node"
      }
    },
    {
      "name": "edge_selected",
      "onEnter": "selectEdge (add visual selected class); updateSelectedInfo",
      "onExit": "deselectVisual (remove selected class)",
      "on": {
        "CLICK_CANVAS": "idle",
        "DELETE_CLICK": "deleting_selection",
        "DELETE_KEY": "deleting_selection",
        "TOGGLE_DIRECTED_ON": "directed_animating_show",
        "TOGGLE_DIRECTED_OFF": "directed_animating_hide",
        "POINTER_DOWN_NODE": "node_pointer_down",
        "SELECT_NODE": "node_selected"
      }
    },
    {
      "name": "generating_graph",
      "onEnter": "clearGraph; generateRandomGraph (create nodes & edges); updateAdjacencyDisplay",
      "onExit": "",
      "on": {
        "DONE": "idle",
        "CANCEL": "idle"
      }
    },
    {
      "name": "clearing_graph",
      "onEnter": "clearGraph; updateAdjacencyDisplay",
      "onExit": "",
      "on": {
        "DONE": "idle"
      }
    },
    {
      "name": "deleting_selection",
      "onEnter": "deleteSelected; updateAdjacencyDisplay; updateSelectedInfo",
      "onExit": "",
      "on": {
        "DONE": "idle"
      }
    },
    {
      "name": "directed_animating_show",
      "onEnter": "setModeDirected(true); animateArrowheads(show=true); updateAdjacencyDisplay",
      "onExit": "finalizeArrowState",
      "on": {
        "ARROW_ANIMATION_END": "idle",
        "IMMEDIATE_DONE": "idle"
      }
    },
    {
      "name": "directed_animating_hide",
      "onEnter": "setModeDirected(false); normalizeEdgesToUndirected (merge opposite directed edges); animateArrowheads(show=false); updateAdjacencyDisplay",
      "onExit": "finalizeArrowState",
      "on": {
        "ARROW_ANIMATION_END": "idle",
        "IMMEDIATE_DONE": "idle"
      }
    },
    {
      "name": "node_nudge",
      "onEnter": "nudgeSelectedNode (arrow-key move); updateAdjacencyDisplay",
      "onExit": "",
      "on": {
        "DONE": "node_selected",
        "CANCEL": "node_selected"
      }
    }
  ],
  "events": [
    "POINTER_DOWN_NODE",
    "POINTER_MOVE_DECIDE_MOVE",
    "POINTER_MOVE_DECIDE_EDGE",
    "POINTER_MOVE",
    "POINTER_UP",
    "POINTER_UP_CLICK_SELECT",
    "POINTER_UP_CLICK_CREATE_EDGE",
    "POINTER_UP_TARGET_NODE",
    "POINTER_UP_NO_TARGET",
    "POINTER_CANCEL",
    "CLICK_CANVAS",
    "DOUBLE_CLICK_CANVAS",
    "ADD_NODE_CLICK",
    "RANDOM_CLICK",
    "CLEAR_CLICK",
    "DELETE_CLICK",
    "DELETE_KEY",
    "TOGGLE_DIRECTED_ON",
    "TOGGLE_DIRECTED_OFF",
    "ARROW_ANIMATION_END",
    "EDGE_ANIMATION_END",
    "IMMEDIATE_DONE",
    "SELECT_NODE",
    "SELECT_EDGE",
    "SHOW_MATRIX_TOGGLE",
    "KEY_ARROW",
    "DONE",
    "CANCEL"
  ],
  "notes": "This FSM models the user-visible interactive behaviors. Implementation details: selection (selected variable) is reflected via node_selected/edge_selected states and visual classes. pointerState (set on pointerdown) drives transitions from node_pointer_down into node_moving (drag to move) or edge_dragging (drag-to-create-edge, shown with tempLine). Edge creation triggers an edge_drawing state while the SVG drawing animation (stroke-dasharray + animation) plays; EDGE_ANIMATION_END or a timeout returns to idle. Toggling directed mode flips modeDirected and runs a short arrowhead animation handled by directed_animating_show/hide states; when switching to undirected the code merges opposite directed edges. Actions performed on enter/exit are named to map to the functions in code (e.g., createNodeAtPointerOrCenter -> createNode, clearGraph, createEdge, animateArrowheads, updateAdjacencyDisplay, deleteSelected, updateNodePosition). Events like POINTER_UP_CLICK_CREATE_EDGE are conceptually emitted when pointerup after an edge drag finishes on a valid target; POINTER_UP_CLICK_SELECT occurs for clicks (small move) and will select or create an edge from a previously-selected node to the clicked node (per code). Some transitions (e.g., immediate returns) are represented with IMMEDIATE_DONE or DONE to indicate the synchronous completion of the action and return to idle."
}