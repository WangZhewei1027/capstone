{
  "topic": "Binary Tree Traversal Explorer",
  "description": "Models the interactive states of a binary tree traversal visualizer: tree editing, traversal simulation (play/pause/step), UI toolbars, and tree operations (random/reset/clear). Captures playback, animation, and toolbar interactions.",
  "states": [
    {
      "name": "ready",
      "onEnter": "resetSimulation; render",
      "onExit": "clearAllHighlights",
      "on": {
        "PLAY": "playing",
        "PLAY_PAUSE_TOGGLE": "playing",
        "STEP_FORWARD": "ready",
        "STEP_BACKWARD": "rebuilding",
        "TOGGLE_EDIT": "editing",
        "SELECT_TRAVERSAL": "ready",
        "RANDOM_TREE": "ready",
        "RESET_TREE": "ready",
        "CLEAR_TREE": "empty",
        "NODE_CLICK": "ready",
        "PLACEHOLDER_ADD_LEFT": "ready",
        "PLACEHOLDER_ADD_RIGHT": "ready"
      }
    },
    {
      "name": "playing",
      "onEnter": "play (start play timer)",
      "onExit": "pause (stop play timer)",
      "on": {
        "PLAY": "paused",
        "PLAY_PAUSE_TOGGLE": "paused",
        "PAUSE": "paused",
        "SPEED_CHANGE": "playing",
        "EVENT_TICK": "playing",
        "EVENTS_COMPLETE": "done",
        "STEP_FORWARD": "paused",
        "STEP_BACKWARD": "rebuilding",
        "TOGGLE_EDIT": "editing",
        "RANDOM_TREE": "ready",
        "RESET_TREE": "ready",
        "CLEAR_TREE": "empty",
        "SELECT_TRAVERSAL": "ready"
      }
    },
    {
      "name": "paused",
      "onEnter": "pause",
      "onExit": null,
      "on": {
        "PLAY": "playing",
        "PLAY_PAUSE_TOGGLE": "playing",
        "STEP_FORWARD": "paused",
        "STEP_BACKWARD": "rebuilding",
        "SPEED_CHANGE": "paused",
        "TOGGLE_EDIT": "editing",
        "RANDOM_TREE": "ready",
        "RESET_TREE": "ready",
        "CLEAR_TREE": "empty",
        "SELECT_TRAVERSAL": "ready"
      }
    },
    {
      "name": "rebuilding",
      "onEnter": "rebuildToIndex (replay events up to eventIndex to restore prior state)",
      "onExit": null,
      "on": {
        "REBUILD_DONE": "paused",
        "TOGGLE_EDIT": "editing",
        "RANDOM_TREE": "ready",
        "RESET_TREE": "ready",
        "CLEAR_TREE": "empty",
        "SELECT_TRAVERSAL": "ready"
      }
    },
    {
      "name": "editing",
      "onEnter": "set editMode = true; render",
      "onExit": "set editMode = false; hideNodeToolbar; render",
      "on": {
        "TOGGLE_EDIT": "ready",
        "NODE_CLICK": "toolbar_open",
        "PLACEHOLDER_ADD_LEFT": "editing",
        "PLACEHOLDER_ADD_RIGHT": "editing",
        "APPLY_NODE": "editing",
        "REMOVE_NODE": "editing",
        "RANDOM_TREE": "editing",
        "RESET_TREE": "editing",
        "CLEAR_TREE": "empty",
        "SELECT_TRAVERSAL": "editing"
      }
    },
    {
      "name": "toolbar_open",
      "onEnter": "showNodeToolbar (position toolbar; populate input)",
      "onExit": "hideNodeToolbar",
      "on": {
        "APPLY_NODE": "editing",
        "REMOVE_NODE": "editing",
        "CLICK_OUTSIDE_HIDE_TOOLBAR": "editing",
        "TOGGLE_EDIT": "editing",
        "RANDOM_TREE": "editing",
        "RESET_TREE": "editing",
        "CLEAR_TREE": "empty",
        "SELECT_TRAVERSAL": "editing"
      }
    },
    {
      "name": "done",
      "onEnter": "pause; mark simulation complete",
      "onExit": null,
      "on": {
        "PLAY": "playing",
        "PLAY_PAUSE_TOGGLE": "playing",
        "STEP_FORWARD": "done",
        "STEP_BACKWARD": "rebuilding",
        "TOGGLE_EDIT": "editing",
        "RANDOM_TREE": "ready",
        "RESET_TREE": "ready",
        "CLEAR_TREE": "empty",
        "SELECT_TRAVERSAL": "ready"
      }
    },
    {
      "name": "empty",
      "onEnter": "clearTree visuals; resetSimulation; render",
      "onExit": null,
      "on": {
        "RANDOM_TREE": "ready",
        "RESET_TREE": "ready",
        "CLEAR_TREE": "empty",
        "TOGGLE_EDIT": "editing",
        "SELECT_TRAVERSAL": "empty",
        "PLAY": "empty",
        "STEP_FORWARD": "empty",
        "NODE_CLICK": "empty",
        "PLACEHOLDER_ADD_LEFT": "empty",
        "PLACEHOLDER_ADD_RIGHT": "empty"
      }
    }
  ],
  "events": [
    "PLAY",
    "PAUSE",
    "PLAY_PAUSE_TOGGLE",
    "STEP_FORWARD",
    "STEP_BACKWARD",
    "EVENT_TICK",
    "EVENTS_COMPLETE",
    "REBUILD_DONE",
    "SPEED_CHANGE",
    "SELECT_TRAVERSAL",
    "RANDOM_TREE",
    "RESET_TREE",
    "CLEAR_TREE",
    "TOGGLE_EDIT",
    "NODE_CLICK",
    "PLACEHOLDER_ADD_LEFT",
    "PLACEHOLDER_ADD_RIGHT",
    "APPLY_NODE",
    "REMOVE_NODE",
    "CLICK_OUTSIDE_HIDE_TOOLBAR"
  ],
  "notes": "Actions map to functions or sequences in the code: resetSimulation (generateEvents + clear UI), render (layoutTree + draw), play (start interval timer), pause (clear interval), stepForward/stepBackward (handleEvent/rebuildToIndex), rebuildToIndex (replay events to previous index), showNodeToolbar/hideNodeToolbar (open/close contextual edit UI), addStackItem/addVisited/popStackItem (update stack and visited panels), clearAllHighlights (remove node/edge highlights), findParentEdge (highlight edge on visit), scrollToNode (bring node into view). Many transitions are self-transitions (e.g., STEP_FORWARD while paused/ready) that perform event handling without changing the top-level state. The FSM intentionally separates edit-mode UI states (editing, toolbar_open) from simulation states (ready, playing, paused, rebuilding, done) and a special empty/tree-absent state."
}