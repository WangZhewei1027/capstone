{
  "topic": "Floyd–Warshall Interactive Module",
  "description": "Models the interactive UI and visualization lifecycle for the Floyd–Warshall web module: graph/matrix editing, algorithm preparation, stepping through (k,i,j) comparisons, animation of comparisons/updates, auto-play, path reconstruction and UI controls.",
  "states": [
    {
      "name": "initializing",
      "onEnter": "init()",
      "on": {
        "INIT_COMPLETE": "idle",
        "ERROR": "idle"
      }
    },
    {
      "name": "preparing",
      "onEnter": "prepareAndRun()  // build dist/next, generate steps and set currentStep=0, render first snapshot",
      "onExit": "updateStepLabel()",
      "on": {
        "PREPARE_DONE": "idle"
      }
    },
    {
      "name": "idle",
      "onEnter": "renderStep(currentStep)  // render current snapshot and static UI",
      "onExit": "clearGraphHighlights()",
      "on": {
        "PLAY": "playing",
        "STEP_FORWARD": "steppingForward",
        "STEP_BACK": "steppingBackward",
        "APPLY_SIZE": "preparing",
        "RANDOMIZE": "preparing",
        "APPLY_MATRIX": "preparing",
        "CLEAR_MATRIX": "preparing",
        "EDIT_CELL": "editingCell",
        "EDIT_EDGE": "editingEdge",
        "SHOW_PATH": "path_shown",
        "RESET": "idle",
        "SPEED_CHANGE": "idle",
        "KEY_SPACE": "playing"
      }
    },
    {
      "name": "playing",
      "onEnter": "restartPlayTimer()  // start/continue auto-advance using playDelay",
      "onExit": "clearTimeout(playTimer)",
      "on": {
        "PAUSE": "idle",
        "STEP_FORWARD": "steppingForward",
        "STEP_BACK": "steppingBackward",
        "TIMER_TICK": "steppingForward",
        "END_OF_STEPS": "done",
        "EDIT_CELL": "editingCell",
        "EDIT_EDGE": "editingEdge",
        "SPEED_CHANGE": "playing",
        "KEY_SPACE": "idle"
      }
    },
    {
      "name": "steppingForward",
      "onEnter": "advanceStep(1)  // increments currentStep, then renderStep(currentStep). This will result in either a comparison snapshot or an update snapshot being rendered",
      "onExit": "",
      "on": {
        "ADVANCE_COMPLETE": "idle",
        "ADVANCE_COMPLETE_WHILE_PLAYING": "playing",
        "END_OF_STEPS": "done"
      }
    },
    {
      "name": "steppingBackward",
      "onEnter": "advanceStep(-1)  // decrements currentStep, then renderStep(currentStep)",
      "onExit": "",
      "on": {
        "ADVANCE_COMPLETE": "idle",
        "ADVANCE_COMPLETE_WHILE_PLAYING": "playing"
      }
    },
    {
      "name": "comparing",
      "onEnter": "highlightComparisonNodes(k,i,j)  // visual highlight of nodes k,i,j and edges i->k, k->j; auto-clear after short timeout based on playDelay",
      "onExit": "clearGraphHighlights()",
      "on": {
        "ANIMATION_DONE": "idle",
        "ANIMATION_DONE_WHILE_PLAYING": "playing",
        "USER_STEP": "steppingForward"
      }
    },
    {
      "name": "updating",
      "onEnter": "animateCellUpdate(i,j); animateEdgeUpdate(i,j)  // flash updated matrix cell, pulse edges along reconstructed path",
      "onExit": "clearGraphHighlights()",
      "on": {
        "ANIMATION_DONE": "idle",
        "ANIMATION_DONE_WHILE_PLAYING": "playing"
      }
    },
    {
      "name": "editingCell",
      "onEnter": "editMatrixCell(i,j)  // open prompt to set weight, update initialAdj on confirm, re-render matrix & graph",
      "onExit": "renderDistanceGrid(initialAdj); drawGraph(initialAdj)",
      "on": {
        "EDIT_DONE": "idle",
        "EDIT_DONE_AND_APPLY": "preparing",
        "CANCEL_EDIT": "idle"
      }
    },
    {
      "name": "editingEdge",
      "onEnter": "prompt edge weight edit (edge i→j)  // update initialAdj on confirm and redraw",
      "onExit": "renderDistanceGrid(initialAdj); drawGraph(initialAdj)",
      "on": {
        "EDIT_DONE": "idle",
        "EDIT_DONE_AND_APPLY": "preparing",
        "CANCEL_EDIT": "idle"
      }
    },
    {
      "name": "path_shown",
      "onEnter": "showPathFromSelection()  // compute path using current step.next; set pathOutput and visually highlight edges",
      "onExit": "clearPathHighlight()",
      "on": {
        "CLEAR_PATH": "idle",
        "RESET": "idle",
        "PLAY": "playing",
        "STEP_FORWARD": "steppingForward"
      }
    },
    {
      "name": "done",
      "onEnter": "playing=false; playPauseBtn.textContent='Play ▶'  // playback reached final step",
      "onExit": "clearPathHighlight()",
      "on": {
        "RESET": "idle",
        "STEP_BACK": "idle",
        "APPLY_MATRIX": "preparing",
        "PLAY": "playing"
      }
    }
  ],
  "events": [
    "INIT_COMPLETE",
    "PREPARE_DONE",
    "APPLY_SIZE",
    "RANDOMIZE",
    "APPLY_MATRIX",
    "CLEAR_MATRIX",
    "EDIT_CELL",
    "EDIT_EDGE",
    "EDIT_DONE",
    "EDIT_DONE_AND_APPLY",
    "CANCEL_EDIT",
    "PLAY",
    "PAUSE",
    "STEP_FORWARD",
    "STEP_BACK",
    "RESET",
    "SPEED_CHANGE",
    "SHOW_PATH",
    "CLEAR_PATH",
    "KEY_SPACE",
    "TIMER_TICK",
    "ADVANCE_COMPLETE",
    "ADVANCE_COMPLETE_WHILE_PLAYING",
    "ANIMATION_DONE",
    "ANIMATION_DONE_WHILE_PLAYING",
    "END_OF_STEPS",
    "USER_STEP",
    "ERROR"
  ],
  "notes": "This FSM models the primary interactive flows of the module. Several states (comparing, updating, editing) are transient: they are entered on renderStep(snapshot) or user prompts and automatically return to idle or playing after animations/timeouts or when the user completes/cancels edits. 'preparing' represents building the full sequence of algorithm snapshots (prepareAndRun) and immediately transitions to 'idle'. 'steppingForward' and 'steppingBackward' represent single-step advances; after the step completes they may transition back to idle, or to playing if auto-play is active. Events ending with _WHILE_PLAYING or conditional transitions represent the real implementation's conditional behavior (the code inspects the 'playing' flag and either restarts the play timer or stays paused). Path display/highlight (path_shown) is orthogonal to playing/idle in the concrete UI but represented here as a separate state for clarity. Timeouts and DOM animation completions are modeled with ANIMATION_DONE / TIMER_TICK events (the code uses setTimeouts to clear highlights and to trigger the next step when playing)."
}