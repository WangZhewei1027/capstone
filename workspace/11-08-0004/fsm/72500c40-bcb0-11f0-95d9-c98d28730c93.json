{
  "topic": "K-Means Interactive Explorer",
  "description": "Finite state machine modeling the interactive behavior of the K-Means clustering visualizer: user interactions (click/drag), algorithm steps/animations, run loop, and UI control actions.",
  "states": [
    {
      "name": "uninitialized",
      "onEnter": "clearStateAndUI",
      "on": {
        "INIT_CLICK": "initialized",
        "ADD_RANDOM": "uninitialized",
        "RESET_CLICK": "uninitialized"
      }
    },
    {
      "name": "initialized",
      "onEnter": "initCentroids_and_updateUI",
      "onExit": "persistCentroids",
      "on": {
        "STEP_CLICK": "stepping",
        "RUN_CLICK": "running",
        "POINTER_DOWN_ON_POINT": "dragging_point",
        "POINTER_DOWN_ON_CENTROID": "dragging_centroid",
        "CLICK_CANVAS_ADD_POINT": "initialized",
        "ADD_RANDOM": "initialized",
        "CLEAR_CLICK": "initialized",
        "RESET_CLICK": "uninitialized",
        "K_CHANGE": "initialized",
        "SPEED_CHANGE": "initialized",
        "TOGGLE_LINES": "initialized",
        "TOGGLE_TRAILS": "initialized",
        "WINDOW_RESIZE": "initialized"
      }
    },
    {
      "name": "dragging_point",
      "onEnter": "startPointDrag",
      "onExit": "endPointDrag",
      "on": {
        "POINTER_MOVE": "dragging_point",
        "POINTER_UP": "initialized",
        "RESET_CLICK": "uninitialized"
      }
    },
    {
      "name": "dragging_centroid",
      "onEnter": "startCentroidDrag",
      "onExit": "endCentroidDrag",
      "on": {
        "POINTER_MOVE": "dragging_centroid",
        "POINTER_UP": "initialized",
        "RESET_CLICK": "uninitialized"
      }
    },
    {
      "name": "stepping",
      "onEnter": "stepOnce (assignClusters -> computeInertia -> updateCentroids -> animateMoves -> reassign -> computeInertia -> incrementIter -> draw)",
      "onExit": "finalizeStep",
      "on": {
        "STEP_SUCCESS_CHANGED": "initialized",
        "STEP_SUCCESS_NO_CHANGE": "converged",
        "RUN_CLICK": "running",
        "RESET_CLICK": "uninitialized"
      }
    },
    {
      "name": "running",
      "onEnter": "runUntilConverged (set animation.running=true; update Run button to 'Stop')",
      "onExit": "stopRunLoop (set animation.running=false; update Run button to 'Run')",
      "on": {
        "RUN_CLICK": "initialized",
        "RUN_COMPLETE": "converged",
        "RESET_CLICK": "uninitialized"
      }
    },
    {
      "name": "converged",
      "onEnter": "onConverged (stopRunLoop; update UI to indicate convergence)",
      "on": {
        "STEP_CLICK": "stepping",
        "RUN_CLICK": "running",
        "RESET_CLICK": "uninitialized",
        "INIT_CLICK": "initialized",
        "ADD_RANDOM": "converged",
        "CLICK_CANVAS_ADD_POINT": "converged"
      }
    }
  ],
  "events": [
    "POINTER_DOWN_ON_POINT",
    "POINTER_DOWN_ON_CENTROID",
    "POINTER_MOVE",
    "POINTER_UP",
    "CLICK_CANVAS_ADD_POINT",
    "INIT_CLICK",
    "STEP_CLICK",
    "RUN_CLICK",
    "RUN_COMPLETE",
    "STEP_SUCCESS_CHANGED",
    "STEP_SUCCESS_NO_CHANGE",
    "ADD_RANDOM",
    "CLEAR_CLICK",
    "RESET_CLICK",
    "K_CHANGE",
    "SPEED_CHANGE",
    "TOGGLE_LINES",
    "TOGGLE_TRAILS",
    "WINDOW_RESIZE",
    "KEY_SPACE",
    "KEY_RIGHT",
    "KEY_R"
  ],
  "notes": "Actions listed in onEnter/onExit map to JavaScript functions and behaviors in the app:\n- initCentroids_and_updateUI -> initCentroids(method), updateLegend(), iter=0, draw()\n- stepOnce -> assignClusters(), computeInertia(), updateCentroids(), animateMoves(duration), assignClusters(), computeInertia(), iter++ and draw(); this async action emits STEP_SUCCESS_CHANGED if at least one assignment changed during assignClusters, otherwise STEP_SUCCESS_NO_CHANGE.\n- runUntilConverged -> sets animation.running=true and repeatedly performs stepOnce until STEP_SUCCESS_NO_CHANGE (then emit RUN_COMPLETE) or animation.running set false by user; Run button text toggled in enter/exit.\n- startPointDrag / endPointDrag -> capture/release pointer, update dragged point coordinates in POINTER_MOVE, live re-assignment (assignClusters + computeInertia) while dragging.\n- startCentroidDrag / endCentroidDrag -> capture/release pointer, update centroid coordinates in POINTER_MOVE and draw immediately.\n- clearStateAndUI -> points=[], centroids=[], iter=0, update counters and draw.\n- finalizeStep / persistCentroids -> housekeeping after step/run including updating iter count and UI.\n\nKeyboard shortcuts map to events: Space -> RUN_CLICK (toggle start/stop), ArrowRight -> STEP_CLICK, 'r' -> RESET_CLICK. UI controls (K slider/number, init selection, speed, toggles) fire K_CHANGE, INIT_CLICK, SPEED_CHANGE, TOGGLE_LINES, TOGGLE_TRAILS respectively. Pointer interactions are normalized to canvas coordinates; pointerdown will detect proximity and dispatch POINTER_DOWN_ON_POINT, POINTER_DOWN_ON_CENTROID, or CLICK_CANVAS_ADD_POINT as appropriate. The FSM abstracts conditionals: the stepping state emits either STEP_SUCCESS_CHANGED or STEP_SUCCESS_NO_CHANGE based on assignment changes to drive transitions to initialized or converged."
}