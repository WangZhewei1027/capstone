{
  "topic": "Interactive Array Module",
  "description": "Models the interactive states and transitions of a visual array editor (push, insert, pop, remove, clear, select, edit, drag/swap, animations, and validation feedback).",
  "states": [
    {
      "name": "idle",
      "onEnter": "renderIdleUI",
      "onExit": "storePreviousState",
      "on": {
        "CLICK_TILE": "selected",
        "CLICK_PUSH_VALID": "animating",
        "CLICK_PUSH_INVALID": "error",
        "CLICK_INSERT_VALID": "animating",
        "CLICK_INSERT_INVALID_INDEX": "error",
        "CLICK_INSERT_INVALID_VALUE": "error",
        "CLICK_POP_VALID": "animating",
        "CLICK_POP_EMPTY": "error",
        "CLICK_REMOVE_VALID": "animating",
        "CLICK_REMOVE_INVALID": "error",
        "CLICK_CLEAR_VALID": "animating",
        "CLICK_CLEAR_EMPTY": "error",
        "START_DRAG": "dragging",
        "KEY_ARROW_NAV": "selected"
      }
    },
    {
      "name": "selected",
      "onEnter": "showInspector_and_highlightSelected",
      "onExit": "hideInspector_and_clearHighlight",
      "on": {
        "CLICK_TILE": "selected",
        "START_EDIT": "editing",
        "SAVE_EDIT": "animating",
        "CANCEL_EDIT": "selected",
        "CLICK_PUSH_VALID": "animating",
        "CLICK_PUSH_INVALID": "error",
        "CLICK_INSERT_VALID": "animating",
        "CLICK_INSERT_INVALID_INDEX": "error",
        "CLICK_POP_VALID": "animating",
        "CLICK_POP_EMPTY": "error",
        "CLICK_REMOVE_VALID": "animating",
        "CLICK_REMOVE_INVALID": "error",
        "CLICK_CLEAR_VALID": "animating",
        "CLICK_CLEAR_EMPTY": "error",
        "START_DRAG": "dragging",
        "KEY_ARROW_NAV": "selected"
      }
    },
    {
      "name": "editing",
      "onEnter": "showInspectorControls_and_focusEditInput",
      "onExit": "blurEditInput_and_hideTransientUI",
      "on": {
        "SAVE_EDIT": "animating",
        "CANCEL_EDIT": "selected",
        "KEY_ENTER_IN_EDIT": "SAVE_EDIT",
        "KEY_ESCAPE_IN_EDIT": "CANCEL_EDIT"
      }
    },
    {
      "name": "dragging",
      "onEnter": "setDraggingVisualState_and_storeDragSource",
      "onExit": "clearDraggingVisualState",
      "on": {
        "DROP_ON_TILE_VALID": "animating",
        "DROP_ON_TILE_INVALID": "idle",
        "DRAG_END": "idle",
        "DRAG_CANCEL": "idle"
      }
    },
    {
      "name": "animating",
      "onEnter": "mutateArray_then_renderArray_with_FLIP_and_log (renderArray(true))",
      "onExit": "cleanupAnimationStyles_and_updateInspector",
      "on": {
        "ANIMATION_END_SELECTED": "selected",
        "ANIMATION_END_NO_SELECTION": "idle",
        "ANIMATION_END": "selected"
      }
    },
    {
      "name": "error",
      "onEnter": "flashInvalidInput_visualFeedback",
      "onExit": "clearFlashStyles",
      "on": {
        "ERROR_TIMEOUT": "idle",
        "ERROR_DISMISS": "idle",
        "ERROR_RETURN_TO_SELECTED": "selected"
      }
    }
  ],
  "events": [
    "CLICK_TILE",
    "CLICK_PUSH_VALID",
    "CLICK_PUSH_INVALID",
    "CLICK_INSERT_VALID",
    "CLICK_INSERT_INVALID_INDEX",
    "CLICK_INSERT_INVALID_VALUE",
    "CLICK_POP_VALID",
    "CLICK_POP_EMPTY",
    "CLICK_REMOVE_VALID",
    "CLICK_REMOVE_INVALID",
    "CLICK_CLEAR_VALID",
    "CLICK_CLEAR_EMPTY",
    "START_DRAG",
    "DROP_ON_TILE_VALID",
    "DROP_ON_TILE_INVALID",
    "DRAG_END",
    "DRAG_CANCEL",
    "START_EDIT",
    "SAVE_EDIT",
    "CANCEL_EDIT",
    "KEY_ENTER_IN_EDIT",
    "KEY_ESCAPE_IN_EDIT",
    "KEY_ARROW_NAV",
    "ANIMATION_END",
    "ANIMATION_END_SELECTED",
    "ANIMATION_END_NO_SELECTION",
    "ERROR_TIMEOUT",
    "ERROR_DISMISS",
    "ERROR_RETURN_TO_SELECTED"
  ],
  "notes": "This FSM models the principal interactive flows from the implementation. Concrete UI handlers in the code perform validation synchronously and either flash invalid inputs (treated here as ERROR transitions) or mutate the array and call renderArray(true) which performs FLIP animations. The 'animating' state represents the period where renderArray(true) runs and DOM transforms/enter/remove animations occur; the implementation uses requestAnimationFrame/transitionend and a MutationObserver to know when to scroll/finish. The code does conditional transitions after animation: if a selection is present the module behaves like 'selected', otherwise it returns to 'idle'. To keep the FSM concise we expose both ANIMATION_END_SELECTED and ANIMATION_END_NO_SELECTION events and also a generic ANIMATION_END (treated as selected by default) â€” in practice the module decides which one to fire based on selectedIndex. The 'error' state is transient and returns to the previous usable UI (idle or selected) after a short timeout; the real code simply calls flash(...) and returns immediately (no long-lived state), but we model it here as a distinct state for clarity. Event names that end with _VALID/_INVALID reflect validation outcomes that the code checks before mutating state (e.g., empty value or out-of-range index)."
}