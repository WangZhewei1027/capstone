{
  "topic": "Adjacency List Interactive App",
  "description": "Models the interactive states and transitions of a browser-based adjacency-list graph editor (node creation, dragging, add/remove edge modes, import/export, visual feedback).",
  "states": [
    {
      "name": "idle",
      "onEnter": "announce('Ready') (optional)",
      "on": {
        "ADD_NODE_CLICK": "creating_node",
        "CANVAS_DBLCLICK": "creating_node_at_pointer",
        "SHORTCUT_CREATE_NODE": "creating_node",
        "MODE_EDGE_ON": "adding_edge_waiting",
        "MODE_REMOVE_ON": "removing",
        "DIRECTED_TOGGLE": "toggling_directed",
        "EXPORT_CLICK": "exporting",
        "IMPORT_CLICK": "importing",
        "NODE_CLICK": "focused",
        "NODE_POINTER_DOWN": "dragging",
        "DELETE_KEY_ON_NODE": "removing_node"
      }
    },
    {
      "name": "creating_node",
      "onEnter": "createNode(name?:string) -> updateAdjList; redrawEdges; announce('Node created')",
      "on": {
        "CREATION_DONE": "idle"
      }
    },
    {
      "name": "creating_node_at_pointer",
      "onEnter": "createNodeAtPointer(name?:string, x:number, y:number) -> updateAdjList; redrawEdges; announce('Node created')",
      "on": {
        "CREATION_DONE": "idle"
      }
    },
    {
      "name": "adding_edge_waiting",
      "onEnter": "setModeAddEdge(true); status.text = 'Edge mode on: click source then target'",
      "onExit": "setModeAddEdge(false); clearPendingEdgeSource()",
      "on": {
        "NODE_CLICK": "adding_edge_source_selected",
        "MODE_EDGE_OFF": "idle",
        "CANCEL_PENDING_EDGE": "idle"
      }
    },
    {
      "name": "adding_edge_source_selected",
      "onEnter": "setPendingSource(id); highlightNode(sourceId, true); status.text = 'Selected source \"<name>\"'",
      "onExit": "highlightNode(sourceId, false); clearPendingEdgeSource()",
      "on": {
        "NODE_CLICK_TARGET": "creating_edge",
        "NODE_CLICK_SAME": "adding_edge_source_selected",
        "CANVAS_CLICK": "adding_edge_waiting",
        "MODE_EDGE_OFF": "idle",
        "CANCEL_PENDING_EDGE": "adding_edge_waiting"
      }
    },
    {
      "name": "creating_edge",
      "onEnter": "addEdgeById(srcId,dstId) -> animateEdgeDraw(src,dst); updateAdjList(); announce('Edge added' or 'Edge already exists')",
      "onExit": "clearPendingEdgeSource()",
      "on": {
        "EDGE_CREATED": "adding_edge_waiting",
        "EDGE_EXISTS": "adding_edge_waiting",
        "MODE_EDGE_OFF": "idle"
      }
    },
    {
      "name": "removing",
      "onEnter": "setModeRemove(true); status.text = 'Remove mode on'",
      "onExit": "setModeRemove(false)",
      "on": {
        "NODE_CLICK": "removing_node",
        "MODE_REMOVE_OFF": "idle",
        "DELETE_KEY_ON_NODE": "removing_node"
      }
    },
    {
      "name": "removing_node",
      "onEnter": "removeNode(nodeId) -> updateAdjList(); redrawEdges(); announce('Vertex removed')",
      "on": {
        "REMOVE_DONE": "removing"
      }
    },
    {
      "name": "dragging",
      "onEnter": "capturePointer(); setDragState(); (node follows pointer); disableTransitionAnimationsOnNode()",
      "onExit": "releasePointer(); clearDragState(); redrawEdges(); announce('Node moved')",
      "on": {
        "DRAG_MOVE": "dragging",
        "DRAG_END": "idle"
      }
    },
    {
      "name": "focused",
      "onEnter": "pulseNode(nodeId); highlightAdjRow(nodeName); announce('Vertex selected and neighbors pulsed')",
      "onExit": "stopPulse(nodeId); clearAdjHighlights()",
      "on": {
        "CLICK_OUTSIDE": "idle",
        "NODE_BLUR": "idle",
        "NEIGHBOR_CHIP_CLICK": "focused_neighbor_pulse",
        "DELETE_KEY_ON_NODE": "removing_node"
      }
    },
    {
      "name": "focused_neighbor_pulse",
      "onEnter": "pulseNode(neighborId) (temporary)",
      "onExit": "stopPulse(neighborId)",
      "on": {
        "PULSE_DONE": "focused"
      }
    },
    {
      "name": "importing",
      "onEnter": "parseJSONAndImport(text) -> (on success create nodes & edges via ensureNodeWithName/addEdgeNames; updateAdjList(); redrawEdges(); announce('Imported'))",
      "on": {
        "IMPORT_SUCCESS": "idle",
        "IMPORT_ERROR": "import_error"
      }
    },
    {
      "name": "import_error",
      "onEnter": "announce('Invalid JSON. Please correct.')",
      "on": {
        "ACK_ERROR": "idle"
      }
    },
    {
      "name": "exporting",
      "onEnter": "exportAdjacencyToTextarea(); announce('Exported adjacency list to textarea')",
      "on": {
        "EXPORT_DONE": "idle"
      }
    },
    {
      "name": "toggling_directed",
      "onEnter": "toggleDirectedFlag(); if toggled -> enforceSymmetryWhenUndirected(); redrawEdges(); updateAdjList(); announce('Graph mode changed')",
      "on": {
        "TOGGLE_DONE": "idle"
      }
    }
  ],
  "events": [
    "ADD_NODE_CLICK",
    "CANVAS_DBLCLICK",
    "SHORTCUT_CREATE_NODE",
    "MODE_EDGE_ON",
    "MODE_EDGE_OFF",
    "MODE_REMOVE_ON",
    "MODE_REMOVE_OFF",
    "DIRECTED_TOGGLE",
    "EXPORT_CLICK",
    "EXPORT_DONE",
    "IMPORT_CLICK",
    "IMPORT_SUCCESS",
    "IMPORT_ERROR",
    "ACK_ERROR",
    "NODE_CLICK",
    "NODE_CLICK_TARGET",
    "NODE_CLICK_SAME",
    "NODE_POINTER_DOWN",
    "DRAG_MOVE",
    "DRAG_END",
    "DELETE_KEY_ON_NODE",
    "NODE_BLUR",
    "CLICK_OUTSIDE",
    "NEIGHBOR_CHIP_CLICK",
    "PULSE_DONE",
    "EDGE_CREATED",
    "EDGE_EXISTS",
    "CANVAS_CLICK",
    "CANCEL_PENDING_EDGE",
    "TOGGLE_DONE",
    "CREATION_DONE"
  ],
  "notes": "This FSM captures the major interactive modes and transient actions of the app: idle editing, a toggleable Add-Edge mode with a substate for a selected source, a Remove mode, transient node-dragging, node-focused visual feedback, and import/export flows. Transition actions referenced (createNode, createNodeAtPointer, setModeAddEdge, clearPendingEdgeSource, highlightNode, addEdgeById, animateEdgeDraw, updateAdjList, redrawEdges, announce, setModeRemove, removeNode, parseJSONAndImport, exportAdjacencyToTextarea, toggleDirectedFlag, enforceSymmetryWhenUndirected, pulseNode) correspond to the functions and UI updates implemented in the provided code. Some transient transitions (e.g., creation_done/export_done) represent immediate returns to idle after the operation completes. Dragging returns to idle for simplicity (in implementation the previous mode continues)."
}