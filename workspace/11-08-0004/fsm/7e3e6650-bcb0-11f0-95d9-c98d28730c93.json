{
  "topic": "Insertion Sort Interactive Module",
  "description": "Models the interactive states of an insertion-sort visualization web application: building arrays, stepping through precomputed snapshots (pick key, compare, shift, place), playing/auto-advancing, and UI/control interactions.",
  "states": [
    {
      "name": "idle",
      "onEnter": "showIdleMessage",
      "onExit": "clearIdleMessage",
      "on": {
        "RANDOM_ARRAY": "action-start",
        "SET_VALUES": "action-start",
        "INIT": "action-start"
      }
    },
    {
      "name": "action-start",
      "onEnter": "buildAndRenderInitialSnapshot (buildStepsFromArray + renderInitialBars + applyStepVisual for step 0)",
      "on": {
        "STEP_FORWARD": "goto-next",
        "STEP_BACK": "goto-prev",
        "PLAY_PRESS": "playing",
        "RANDOM_ARRAY": "action-start",
        "SET_VALUES": "action-start",
        "RESET": "action-start",
        "SPEED_CHANGE": "action-start",
        "RESIZE": "action-start"
      }
    },
    {
      "name": "action-pick-key",
      "onEnter": "applyStepVisual (snapshot where meta.action === 'pick-key')",
      "onExit": "clearTransientHighlights",
      "on": {
        "STEP_FORWARD": "goto-next",
        "STEP_BACK": "goto-prev",
        "PLAY_PRESS": "playing",
        "RANDOM_ARRAY": "action-start",
        "SET_VALUES": "action-start",
        "RESET": "action-start",
        "SPEED_CHANGE": "action-pick-key",
        "RESIZE": "action-pick-key"
      }
    },
    {
      "name": "action-compare",
      "onEnter": "applyStepVisual (snapshot where meta.action === 'compare')",
      "onExit": "clearTransientHighlights",
      "on": {
        "STEP_FORWARD": "goto-next",
        "STEP_BACK": "goto-prev",
        "PLAY_PRESS": "playing",
        "RANDOM_ARRAY": "action-start",
        "SET_VALUES": "action-start",
        "RESET": "action-start",
        "SPEED_CHANGE": "action-compare",
        "RESIZE": "action-compare"
      }
    },
    {
      "name": "action-shift",
      "onEnter": "applyStepVisual (snapshot where meta.action === 'shift')",
      "onExit": "clearTransientHighlights",
      "on": {
        "STEP_FORWARD": "goto-next",
        "STEP_BACK": "goto-prev",
        "PLAY_PRESS": "playing",
        "RANDOM_ARRAY": "action-start",
        "SET_VALUES": "action-start",
        "RESET": "action-start",
        "SPEED_CHANGE": "action-shift",
        "RESIZE": "action-shift"
      }
    },
    {
      "name": "action-compare-false",
      "onEnter": "applyStepVisual (snapshot where meta.action === 'compare-false')",
      "onExit": "clearTransientHighlights",
      "on": {
        "STEP_FORWARD": "goto-next",
        "STEP_BACK": "goto-prev",
        "PLAY_PRESS": "playing",
        "RANDOM_ARRAY": "action-start",
        "SET_VALUES": "action-start",
        "RESET": "action-start",
        "SPEED_CHANGE": "action-compare-false",
        "RESIZE": "action-compare-false"
      }
    },
    {
      "name": "action-compare-end",
      "onEnter": "applyStepVisual (snapshot where meta.action === 'compare-end')",
      "onExit": "clearTransientHighlights",
      "on": {
        "STEP_FORWARD": "goto-next",
        "STEP_BACK": "goto-prev",
        "PLAY_PRESS": "playing",
        "RANDOM_ARRAY": "action-start",
        "SET_VALUES": "action-start",
        "RESET": "action-start",
        "SPEED_CHANGE": "action-compare-end",
        "RESIZE": "action-compare-end"
      }
    },
    {
      "name": "action-place-key",
      "onEnter": "applyStepVisual (snapshot where meta.action === 'place-key' â€” mark sorted prefix)",
      "onExit": "clearTransientHighlights",
      "on": {
        "STEP_FORWARD": "goto-next",
        "STEP_BACK": "goto-prev",
        "PLAY_PRESS": "playing",
        "RANDOM_ARRAY": "action-start",
        "SET_VALUES": "action-start",
        "RESET": "action-start",
        "SPEED_CHANGE": "action-place-key",
        "RESIZE": "action-place-key"
      }
    },
    {
      "name": "action-done",
      "onEnter": "applyStepVisual (snapshot where meta.action === 'done') / setPlayingFalse",
      "onExit": "clearFinalHighlights",
      "on": {
        "STEP_FORWARD": "action-done",
        "STEP_BACK": "goto-prev",
        "PLAY_PRESS": "playing",
        "RANDOM_ARRAY": "action-start",
        "SET_VALUES": "action-start",
        "RESET": "action-start",
        "SPEED_CHANGE": "action-done",
        "RESIZE": "action-done"
      }
    },
    {
      "name": "goto-next",
      "onEnter": "advanceStepAndApply (increment stepIndex; compute next snapshot; applyStepVisual)",
      "onExit": "cancelTransientTimersIfAny",
      "on": {
        "COMPLETE": "action-done"
      }
    },
    {
      "name": "goto-prev",
      "onEnter": "retreatStepAndApply (decrement stepIndex; compute previous snapshot; applyStepVisual)",
      "onExit": "cancelTransientTimersIfAny",
      "on": {}
    },
    {
      "name": "playing",
      "onEnter": "startPlaybackTimer (setInterval with interval = clamp(700/playSpeed,120,1200))",
      "onExit": "stopPlaybackTimer (clearInterval)",
      "on": {
        "PLAY_PRESS": "paused-current",
        "PLAY_TICK": "goto-next",
        "RANDOM_ARRAY": "action-start",
        "SET_VALUES": "action-start",
        "RESET": "action-start",
        "SPEED_CHANGE": "playing",
        "RESIZE": "playing"
      }
    },
    {
      "name": "paused-current",
      "onEnter": "stopPlaybackTimer; (remain showing current step snapshot)",
      "onExit": "none",
      "on": {
        "PLAY_PRESS": "playing",
        "STEP_FORWARD": "goto-next",
        "STEP_BACK": "goto-prev",
        "RANDOM_ARRAY": "action-start",
        "SET_VALUES": "action-start",
        "RESET": "action-start",
        "SPEED_CHANGE": "paused-current",
        "RESIZE": "paused-current"
      }
    }
  ],
  "events": [
    "INIT",
    "RANDOM_ARRAY",
    "SET_VALUES",
    "STEP_FORWARD",
    "STEP_BACK",
    "PLAY_PRESS",
    "PLAY_TICK",
    "RESET",
    "SPEED_CHANGE",
    "RESIZE",
    "COMPLETE"
  ],
  "notes": "High-level explanation and implementation notes:\n- The module precomputes a linear sequence of snapshots (steps). Each step's meta.action is one of: 'start', 'pick-key', 'compare', 'shift', 'compare-false', 'compare-end', 'place-key', 'done'. The 'action-*' states represent viewing a snapshot whose meta.action matches the state name.\n- The transient states 'goto-next' and 'goto-prev' encapsulate the imperative logic to advance/retreat the precomputed stepIndex and applyStepVisual(). Their onEnter handlers should compute the new stepIndex and then transition control back to the appropriate 'action-*' state that corresponds to the new snapshot's meta.action. In a concrete implementation this is an internal/dynamic transition (advanceStepAndApply chooses the next action-state).\n- 'playing' starts an interval timer. Each timer tick dispatches PLAY_TICK which triggers 'goto-next'. When the final snapshot (meta.action === 'done') is reached the code sets playing=false and remains in 'action-done'. This is represented by the 'COMPLETE' / setPlayingFalse behavior.\n- 'paused-current' is a generic paused/viewing state that represents 'not auto-playing' while showing whatever current snapshot is active. The specific snapshot is still represented by the action-* state currently active (UI remains showing that snapshot). Implementations may treat 'paused-current' as a superstate with action-* as nested substates.\n- onEnter/onExit action names map to concrete functions in the application (examples provided in parentheses):\n    - buildAndRenderInitialSnapshot -> buildStepsFromArray(arr); renderInitialBars(arr); applyStepVisual(steps[0])\n    - applyStepVisual -> update DOM (bar positions, classes), update pseudo-code highlight and status text\n    - advanceStepAndApply -> stepIndex++ (clamped), applyStepVisual(steps[stepIndex]), if meta.action === 'done' dispatch COMPLETE\n    - retreatStepAndApply -> stepIndex-- (clamped), applyStepVisual(steps[stepIndex])\n    - startPlaybackTimer / stopPlaybackTimer -> setInterval/clearInterval used by play() in the code\n    - setPlayingFalse -> clearInterval, set playing=false, update Play button label\n- Keyboard interactions (Space/ArrowRight/ArrowLeft) and control button clicks map to STEP_FORWARD / STEP_BACK / PLAY_PRESS / RANDOM_ARRAY / SET_VALUES events.\n- SPEED_CHANGE adjusts playSpeed used when computing the timer interval; it does not change the logical step index but affects playback timing.\n- RESIZE triggers recalculation of bar layout and re-application of the current snapshot visual (applyStepVisual).\n- The FSM intentionally separates the conceptual 'viewing a snapshot' states (action-*) from the 'playing' mode and from transient step-advance operations (goto-next/goto-prev) to reflect both visual states (comparing, shifting, key lifted, sorted prefix) and control-mode states (paused vs playing)."
}