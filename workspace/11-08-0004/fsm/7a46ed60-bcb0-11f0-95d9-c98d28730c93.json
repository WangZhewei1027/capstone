{
  "topic": "Interactive Application",
  "description": "Finite state machine modelling the interactive states and user-driven transitions of the Weighted Graph interactive module (modes, editing, selection, animation, and operations).",
  "states": [
    {
      "name": "add",
      "onEnter": "SET_MODE_ADD (updateStatusForMode, set UI button styles, connectSource = null)",
      "onExit": "NONE",
      "on": {
        "CLICK_MODE_CONNECT": "connect_idle",
        "CLICK_MODE_MOVE": "move_idle",
        "CLICK_MODE_DELETE": "delete",
        "CLICK_SVG_EMPTY": "add",
        "NODE_CLICK": "add",
        "EDGE_DOUBLECLICK": "edge_editing",
        "CLICK_PRESET": "add",
        "CLICK_CLEAR": "add",
        "TOGGLE_SHOW_WEIGHTS": "add",
        "TOGGLE_DIRECTED": "add"
      }
    },
    {
      "name": "connect_idle",
      "onEnter": "SET_MODE_CONNECT (updateStatusForMode, clear connectSource, update UI)",
      "onExit": "CLEAR_CONNECT_SOURCE (clear highlight if any)",
      "on": {
        "CLICK_MODE_ADD": "add",
        "CLICK_MODE_MOVE": "move_idle",
        "CLICK_MODE_DELETE": "delete",
        "NODE_CLICK": "connect_selecting_target",
        "ESCAPE": "connect_idle",
        "EDGE_DOUBLECLICK": "edge_editing",
        "CLICK_PRESET": "connect_idle",
        "CLICK_CLEAR": "connect_idle"
      }
    },
    {
      "name": "connect_selecting_target",
      "onEnter": "HIGHLIGHT_CONNECT_SOURCE (set connectSource, highlight node, updateStatus)",
      "onExit": "CLEAR_CONNECT_SOURCE (remove highlight, connectSource=null)",
      "on": {
        "NODE_CLICK_SAME": "connect_idle",
        "NODE_CLICK_DIFFERENT": "connect_idle",
        "ESCAPE": "connect_idle",
        "CLICK_MODE_ADD": "add",
        "CLICK_MODE_MOVE": "move_idle",
        "CLICK_MODE_DELETE": "delete",
        "EDGE_DOUBLECLICK": "edge_editing"
      }
    },
    {
      "name": "move_idle",
      "onEnter": "SET_MODE_MOVE (updateStatusForMode, UI update)",
      "onExit": "NONE",
      "on": {
        "CLICK_MODE_ADD": "add",
        "CLICK_MODE_CONNECT": "connect_idle",
        "CLICK_MODE_DELETE": "delete",
        "NODE_MOUSEDOWN": "dragging",
        "EDGE_DOUBLECLICK": "edge_editing",
        "CLICK_PRESET": "move_idle",
        "CLICK_CLEAR": "move_idle"
      }
    },
    {
      "name": "dragging",
      "onEnter": "START_DRAG (selectedNode = node, capture dragOffset)",
      "onExit": "END_DRAG (selectedNode = null)",
      "on": {
        "MOUSEMOVE": "dragging",
        "MOUSEUP": "move_idle",
        "ESCAPE": "move_idle",
        "EDGE_DOUBLECLICK": "edge_editing"
      }
    },
    {
      "name": "delete",
      "onEnter": "SET_MODE_DELETE (updateStatusForMode, UI update)",
      "onExit": "NONE",
      "on": {
        "CLICK_MODE_ADD": "add",
        "CLICK_MODE_CONNECT": "connect_idle",
        "CLICK_MODE_MOVE": "move_idle",
        "NODE_CLICK": "delete",
        "EDGE_CLICK": "delete",
        "EDGE_DOUBLECLICK": "edge_editing",
        "CLICK_PRESET": "delete",
        "CLICK_CLEAR": "delete"
      }
    },
    {
      "name": "awaiting_source_selection",
      "onEnter": "ATTACH_TEMP_NODE_LISTENERS_FOR_SOURCE (updateStatus, attach node click handlers)",
      "onExit": "DETACH_TEMP_NODE_LISTENERS (remove temporary listeners)",
      "on": {
        "NODE_SELECTED_FOR_SOURCE": "RETURN_TO_PREVIOUS_MODE",
        "ESCAPE": "RETURN_TO_PREVIOUS_MODE",
        "EDGE_DOUBLECLICK": "edge_editing",
        "CLICK_PRESET": "awaiting_source_selection",
        "CLICK_CLEAR": "awaiting_source_selection"
      }
    },
    {
      "name": "awaiting_target_selection",
      "onEnter": "ATTACH_TEMP_NODE_LISTENERS_FOR_TARGET (updateStatus, attach node click handlers)",
      "onExit": "DETACH_TEMP_NODE_LISTENERS (remove temporary listeners)",
      "on": {
        "NODE_SELECTED_FOR_TARGET": "RETURN_TO_PREVIOUS_MODE",
        "ESCAPE": "RETURN_TO_PREVIOUS_MODE",
        "EDGE_DOUBLECLICK": "edge_editing",
        "CLICK_PRESET": "awaiting_target_selection",
        "CLICK_CLEAR": "awaiting_target_selection"
      }
    },
    {
      "name": "edge_editing",
      "onEnter": "OPEN_EDGE_EDITOR (edgeBeingEdited = edge, position editor, focus input)",
      "onExit": "CLOSE_EDGE_EDITOR (hide editor, edgeBeingEdited = null)",
      "on": {
        "EDGE_EDITOR_SAVE": "RETURN_TO_PREVIOUS_MODE",
        "EDGE_EDITOR_CANCEL": "RETURN_TO_PREVIOUS_MODE",
        "CLICK_SVG_EMPTY": "RETURN_TO_PREVIOUS_MODE",
        "ESCAPE": "RETURN_TO_PREVIOUS_MODE"
      }
    },
    {
      "name": "search_animating",
      "onEnter": "START_SEARCH_ANIMATION (stopAnimation, compute dijkstra result, animateSearch, set animTimer)",
      "onExit": "STOP_SEARCH_ANIMATION (clear animTimer, reset temporary visual styles)",
      "on": {
        "SEARCH_STEP_COMPLETE": "search_animating",
        "SEARCH_COMPLETE": "search_done",
        "CLICK_MODE_ADD": "add",
        "CLICK_MODE_CONNECT": "connect_idle",
        "CLICK_MODE_MOVE": "move_idle",
        "CLICK_MODE_DELETE": "delete",
        "CLICK_CLEAR": "add",
        "ESCAPE": "add",
        "EDGE_DOUBLECLICK": "edge_editing"
      }
    },
    {
      "name": "search_done",
      "onEnter": "HIGHLIGHT_PATH (apply path-highlight classes, updateStatus with dist)",
      "onExit": "CLEAR_PATH_HIGHLIGHT (remove highlight classes)",
      "on": {
        "CLICK_MODE_ADD": "add",
        "CLICK_MODE_CONNECT": "connect_idle",
        "CLICK_MODE_MOVE": "move_idle",
        "CLICK_MODE_DELETE": "delete",
        "CLICK_CLEAR": "add",
        "EDGE_DOUBLECLICK": "edge_editing",
        "ESCAPE": "add"
      }
    }
  ],
  "events": [
    "CLICK_MODE_ADD",
    "CLICK_MODE_CONNECT",
    "CLICK_MODE_MOVE",
    "CLICK_MODE_DELETE",
    "CLICK_SVG_EMPTY",
    "NODE_CLICK",
    "NODE_CLICK_SAME",
    "NODE_CLICK_DIFFERENT",
    "NODE_MOUSEDOWN",
    "MOUSEMOVE",
    "MOUSEUP",
    "EDGE_CLICK",
    "EDGE_DOUBLECLICK",
    "EDGE_EDITOR_SAVE",
    "EDGE_EDITOR_CANCEL",
    "CLICK_SET_SOURCE",
    "CLICK_SET_TARGET",
    "NODE_SELECTED_FOR_SOURCE",
    "NODE_SELECTED_FOR_TARGET",
    "CLICK_FIND_PATH",
    "SEARCH_STEP_COMPLETE",
    "SEARCH_COMPLETE",
    "CLICK_PRESET",
    "CLICK_CLEAR",
    "TOGGLE_SHOW_WEIGHTS",
    "TOGGLE_DIRECTED",
    "ESCAPE",
    "CLICK_SVG_AREA (hides editor)"
  ],
  "notes": "High-level modeling notes:\n- Modes (add, connect, move, delete) are primary interactive states driven by mode buttons and keyboard shortcuts. Each mode updates UI and status text on enter.\n- 'connect_selecting_target' is a sub-state of connect mode while a source node (connectSource) is chosen; clicking a different node creates an edge; clicking the same node or pressing Escape cancels.\n- 'dragging' is entered from move mode when a node mousedown occurs and exited on mouseup. While dragging, mousemove updates node positions and edges.\n- Edge editing is modeled as a modal 'edge_editing' state entered by double-clicking an edge or its label. EDGE_EDITOR_SAVE or clicking away returns to the previous mode. The special next-state token RETURN_TO_PREVIOUS_MODE indicates restoring whatever mode the app was in before opening the editor.\n- Source/target selection are transient states ('awaiting_source_selection' / 'awaiting_target_selection') that attach temporary node-click listeners; on selection they set sourceNode/targetNode and return to the previous mode.\n- Searching runs Dijkstra then enters 'search_animating' to step through visited nodes (animTimer). When steps finish it transitions to 'search_done' where the final path is visually highlighted. Starting a new mode or clearing the graph stops the animation and returns to the chosen mode.\n- Many UI changes (updateStatus, updateCounts, updateEdgeVisual, highlightNode, create/remove node/edge, etc.) are modelled as onEnter/onExit actions or as actions tied to events. Some events (TOGGLE_SHOW_WEIGHTS, TOGGLE_DIRECTED, CLICK_PRESET, CLICK_CLEAR) perform actions but generally do not change the current interaction mode.\n- This FSM uses the token RETURN_TO_PREVIOUS_MODE to indicate that the UI should resume whatever primary mode (add/connect/move/delete) was active before entering the transient modal or selection state."
}