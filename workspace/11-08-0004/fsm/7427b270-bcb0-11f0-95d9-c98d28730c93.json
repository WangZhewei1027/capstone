{
  "topic": "Knapsack Interactive Module",
  "description": "Finite state machine modeling user interactions in the knapsack interactive app: dragging/adding/removing items, capacity changes, greedy preview, DP animation/solve and applying results, and visual feedback (highlight, shake, progress).",
  "states": [
    {
      "name": "idle",
      "onEnter": "renderIdleUI",
      "onExit": "clearTransientVisuals",
      "on": {
        "DRAG_START": "dragging",
        "CLICK_ADD_ITEM_ATTEMPT": "try_add",
        "DOUBLE_CLICK_ITEM": "try_add",
        "CLICK_REMOVE_ITEM": "bag_updated",
        "CLICK_RANDOMIZE": "dp_cleared",
        "CLICK_RESET": "dp_cleared",
        "CHANGE_CAPACITY": "dp_cleared",
        "KEY_PRESS_G": "showing_greedy",
        "KEY_PRESS_D": "dp_animating",
        "CLICK_SHOW_GREEDY": "showing_greedy",
        "CLICK_ANIMATE_DP": "dp_animating",
        "CLICK_SOLVE": "dp_ready",
        "CLICK_APPLY_OPTIMAL": "apply_optimal_attempt"
      }
    },
    {
      "name": "dragging",
      "onEnter": "addDragGhost",
      "onExit": "removeDragGhost",
      "on": {
        "DRAG_OVER_BAG": "dragover_bag",
        "DRAG_LEAVE_BAG": "dragging",
        "DRAG_END": "idle",
        "DROP_IN_BAG_ATTEMPT": "try_add"
      }
    },
    {
      "name": "dragover_bag",
      "onEnter": "highlightBagBorder",
      "onExit": "unhighlightBagBorder",
      "on": {
        "DRAG_LEAVE_BAG": "dragging",
        "DROP_IN_BAG_ATTEMPT": "try_add",
        "DRAG_END": "idle"
      }
    },
    {
      "name": "try_add",
      "onEnter": "attemptAddToBag",
      "onExit": "clearAddAttemptVisuals",
      "on": {
        "ADD_SUCCESS": "bag_updated",
        "ADD_OVERWEIGHT": "overweight_rejected",
        "ADD_FAIL": "idle"
      }
    },
    {
      "name": "bag_updated",
      "onEnter": "renderBagAndStats",
      "onExit": "clearTransientVisuals",
      "on": {
        "CLICK_REMOVE_ITEM": "bag_updated",
        "DOUBLE_CLICK_ITEM": "toggleAddRemove",
        "DROP_OUT_BANK": "remove_from_bag",
        "CLICK_RANDOMIZE": "dp_cleared",
        "CLICK_RESET": "dp_cleared",
        "CHANGE_CAPACITY": "dp_cleared",
        "CLICK_ANIMATE_DP": "dp_animating",
        "CLICK_SOLVE": "dp_ready",
        "CLICK_APPLY_OPTIMAL": "apply_optimal_attempt"
      }
    },
    {
      "name": "remove_from_bag",
      "onEnter": "removeFromBagAndRender",
      "onExit": "clearTransientVisuals",
      "on": {
        "DONE": "idle",
        "DROP_IN_BANK": "idle"
      }
    },
    {
      "name": "overweight_rejected",
      "onEnter": "visualShakeAndReject",
      "onExit": "clearShake",
      "on": {
        "SHAKE_COMPLETE": "idle",
        "USER_DISMISS": "idle"
      }
    },
    {
      "name": "showing_greedy",
      "onEnter": "runGreedyAndHighlight",
      "onExit": "clearGreedyHighlights",
      "on": {
        "GREEDY_HIGHLIGHT_DONE": "idle",
        "USER_DISMISS": "idle"
      }
    },
    {
      "name": "dp_cleared",
      "onEnter": "clearDP",
      "onExit": "none",
      "on": {
        "INIT_COMPLETE": "idle"
      }
    },
    {
      "name": "dp_animating",
      "onEnter": "startDPAnimation",
      "onExit": "finishDPAnimation",
      "on": {
        "DP_ANIMATION_COMPLETE": "dp_ready",
        "DP_ANIMATION_CANCEL": "dp_cleared",
        "CLICK_ANIMATE_DP": "dp_animating"
      }
    },
    {
      "name": "dp_ready",
      "onEnter": "storeDPResultEnableApply",
      "onExit": "clearDPResultTransient",
      "on": {
        "CLICK_APPLY_OPTIMAL": "apply_optimal_attempt",
        "CHANGE_CAPACITY": "dp_cleared",
        "CLICK_RANDOMIZE": "dp_cleared",
        "CLICK_RESET": "dp_cleared",
        "CLICK_ANIMATE_DP": "dp_animating",
        "CLICK_SOLVE": "dp_ready"
      }
    },
    {
      "name": "apply_optimal_attempt",
      "onEnter": "applyOptimalSelectionToBag",
      "onExit": "clearTransientVisuals",
      "on": {
        "APPLY_SUCCESS": "bag_updated",
        "APPLY_FAIL_NO_DP": "dp_ready",
        "APPLY_COMPLETE": "bag_updated"
      }
    }
  ],
  "events": [
    "DRAG_START",
    "DRAG_END",
    "DRAG_OVER_BAG",
    "DRAG_LEAVE_BAG",
    "DROP_IN_BAG_ATTEMPT",
    "DROP_IN_BAG_SUCCESS",
    "DROP_IN_BAG_OVERWEIGHT",
    "DROP_OUT_BANK",
    "DROP_IN_BANK",
    "CLICK_ADD_ITEM_ATTEMPT",
    "CLICK_ADD_ITEM_SUCCESS",
    "CLICK_ADD_ITEM_OVERWEIGHT",
    "CLICK_REMOVE_ITEM",
    "CLICK_RANDOMIZE",
    "CLICK_RESET",
    "CHANGE_CAPACITY",
    "CLICK_SHOW_GREEDY",
    "GREEDY_HIGHLIGHT_DONE",
    "CLICK_ANIMATE_DP",
    "DP_ANIMATION_COMPLETE",
    "DP_ANIMATION_CANCEL",
    "CLICK_SOLVE",
    "DP_RESULT_AVAILABLE",
    "CLICK_APPLY_OPTIMAL",
    "APPLY_SUCCESS",
    "APPLY_FAIL_NO_DP",
    "APPLY_COMPLETE",
    "DP_CLEARED",
    "OVERWEIGHT_DETECTED",
    "SHAKE_COMPLETE",
    "KEY_PRESS_G",
    "KEY_PRESS_D",
    "DOUBLE_CLICK_ITEM",
    "USER_DISMISS",
    "INIT_COMPLETE"
  ],
  "notes": "This FSM models the main interactive flows and visual feedback in the app. Many actions in the real implementation are asynchronous (animations, alerts, timeouts). To express success/failure results of conditional attempts (e.g., adding an item), the FSM uses explicit outcome events (ADD_SUCCESS / ADD_OVERWEIGHT represented here as ADD_SUCCESS/ADD_OVERWEIGHT via ADD_* events; mapped as DROP_IN_BAG_SUCCESS / DROP_IN_BAG_OVERWEIGHT / CLICK_ADD_ITEM_OVERWEIGHT). Key onEnter/onExit actions correspond to DOM updates found in the code: renderItems/renderBag/updateStats, add/remove CSS classes (ghost, highlight, shake), enabling/disabling controls (animate button), running DP computation (knapsackDP) or animated DP (animateDP), showing alerts and greedy highlights, and clearing DP on capacity/randomize/reset. Some UI regions are effectively orthogonal (drag lifecycle vs DP lifecycle) â€” this FSM flattens them into states and transitions for clarity; an implementation may use parallel/orthogonal state machines for drag vs solver domains."
}