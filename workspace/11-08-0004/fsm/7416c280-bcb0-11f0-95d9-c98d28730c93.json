{
  "topic": "Prim's Algorithm â€” Interactive Module",
  "description": "Models the UI and algorithm flow for an interactive Prim's algorithm visualizer: canvas modes (add/connect/drag), node/edge creation, drag interactions, starting/stepping/auto-playing Prim, neighbor relaxation, edge candidate/MST highlights, and completion/reset flows.",
  "states": [
    {
      "name": "mode_add",
      "onEnter": "setModeAdd;updateModeButtons",
      "onExit": "clearConnectFrom",
      "on": {
        "CLICK_SVG": "mode_add",
        "CLICK_NODE_IN_ADD_MODE": "mode_add",
        "CLICK_MODE_CONNECT": "mode_connect",
        "CLICK_MODE_DRAG": "mode_drag",
        "CLICK_RANDOM_GRAPH": "mode_add",
        "CLICK_RESET": "idle",
        "CLICK_START_PRIM": "prim_initialized"
      }
    },
    {
      "name": "mode_connect",
      "onEnter": "setModeConnect;updateModeButtons",
      "onExit": "clearConnectFrom;render",
      "on": {
        "POINTER_DOWN_NODE": "maybe_start_drag",
        "CLICK_NODE_FIRST": "connect_selected",
        "CLICK_NODE_SECOND": "mode_connect",
        "CANCEL_CONNECT": "mode_connect",
        "CLICK_MODE_ADD": "mode_add",
        "CLICK_MODE_DRAG": "mode_drag",
        "CLICK_RANDOM_GRAPH": "mode_connect",
        "CLICK_RESET": "idle",
        "CLICK_START_PRIM": "prim_initialized"
      }
    },
    {
      "name": "connect_selected",
      "onEnter": "setConnectFrom;highlightNode",
      "onExit": "clearConnectFrom;render",
      "on": {
        "CLICK_SAME_NODE": "mode_connect",
        "CLICK_OTHER_NODE": "edge_create_prompt",
        "CANCEL_CONNECT": "mode_connect",
        "CLICK_MODE_ADD": "mode_add",
        "CLICK_MODE_DRAG": "mode_drag",
        "CLICK_RESET": "idle",
        "CLICK_START_PRIM": "prim_initialized"
      }
    },
    {
      "name": "edge_create_prompt",
      "onEnter": "promptEdgeWeight",
      "onExit": "render",
      "on": {
        "EDGE_WEIGHT_ENTERED": "mode_connect",
        "EDGE_WEIGHT_INVALID": "mode_connect",
        "EDGE_WEIGHT_CANCEL": "mode_connect",
        "CLICK_RESET": "idle"
      }
    },
    {
      "name": "mode_drag",
      "onEnter": "setModeDrag;updateModeButtons",
      "onExit": "releasePointerCapture",
      "on": {
        "POINTER_DOWN_ON_NODE_IN_DRAG_MODE": "dragging",
        "CLICK_MODE_ADD": "mode_add",
        "CLICK_MODE_CONNECT": "mode_connect",
        "CLICK_RANDOM_GRAPH": "mode_drag",
        "CLICK_RESET": "idle",
        "CLICK_START_PRIM": "prim_initialized"
      }
    },
    {
      "name": "dragging",
      "onEnter": "capturePointer;startDragging",
      "onExit": "stopDragging;render",
      "on": {
        "POINTER_MOVE": "dragging",
        "POINTER_UP": "mode_drag",
        "CLICK_RESET": "idle"
      }
    },
    {
      "name": "idle",
      "onEnter": "render;updateModeButtons",
      "on": {
        "CLICK_MODE_ADD": "mode_add",
        "CLICK_MODE_CONNECT": "mode_connect",
        "CLICK_MODE_DRAG": "mode_drag",
        "CLICK_RANDOM_GRAPH": "idle",
        "CLICK_START_PRIM": "prim_initialized",
        "CLICK_RESET": "idle"
      }
    },
    {
      "name": "prim_initialized",
      "onEnter": "initializePrim;render;highlightCodeLines_1_to_3",
      "onExit": "clearPseudocodeHighlight",
      "on": {
        "CLICK_STEP_PRIM": "prim_extract",
        "CLICK_PLAY_PRIM": "prim_autoplay",
        "CLICK_RESET": "idle",
        "CLICK_MODE_ADD": "prim_initialized",
        "CLICK_MODE_CONNECT": "prim_initialized",
        "CLICK_MODE_DRAG": "prim_initialized",
        "SPEED_CHANGE": "prim_initialized",
        "SELECT_START_NODE": "prim_initialized"
      }
    },
    {
      "name": "prim_extract",
      "onEnter": "highlightCodeLine_4_5;extractMin_u;mark_u_inMST;if_parent_mark_edge_mst;render",
      "onExit": "render",
      "on": {
        "EXTRACTION_DONE": "prim_relax_prepare",
        "CLICK_RESET": "idle"
      }
    },
    {
      "name": "prim_relax_prepare",
      "onEnter": "highlightCodeLine_6;collect_neighbors_set_candidate;render",
      "onExit": "render",
      "on": {
        "START_RELAX_SEQUENCE": "prim_relaxing",
        "NO_NEIGHBORS": "prim_post_relax"
      }
    },
    {
      "name": "prim_relaxing",
      "onEnter": "startRelaxIterator (iterative per-neighbor)",
      "onExit": "cleanupCandidateMarks;render",
      "on": {
        "RELAX_STEP": "prim_relaxing",
        "RELAX_DONE": "prim_post_relax",
        "CLICK_RESET": "idle"
      }
    },
    {
      "name": "prim_post_relax",
      "onEnter": "clearCandidateMarks;render;highlightCodeLine_null",
      "onExit": "render",
      "on": {
        "PRIM_QUEUE_EMPTY": "prim_complete",
        "PRIM_QUEUE_NONEMPTY_MANUAL": "prim_initialized",
        "PRIM_QUEUE_NONEMPTY_AUTOPLAY": "prim_extract",
        "CLICK_PLAY_PRIM": "prim_autoplay",
        "CLICK_RESET": "idle"
      }
    },
    {
      "name": "prim_autoplay",
      "onEnter": "setPrimAutoPlayTrue;startPrimTimer(setInterval(runPrimStep))",
      "onExit": "clearInterval;setPrimAutoPlayFalse",
      "on": {
        "TIMER_TICK": "prim_extract",
        "CLICK_PLAY_PRIM": "prim_initialized",
        "SPEED_CHANGE": "prim_autoplay",
        "CLICK_RESET": "idle",
        "PRIM_COMPLETE": "prim_complete"
      }
    },
    {
      "name": "prim_complete",
      "onEnter": "clearInterval;setPrimRunningFalse;alert_completion;highlightCodeLine_null",
      "onExit": "render",
      "on": {
        "CLICK_RESET": "idle",
        "CLICK_MODE_ADD": "mode_add",
        "CLICK_RANDOM_GRAPH": "idle"
      }
    }
  ],
  "events": [
    "CLICK_MODE_ADD",
    "CLICK_MODE_CONNECT",
    "CLICK_MODE_DRAG",
    "CLICK_RANDOM_GRAPH",
    "CLICK_START_PRIM",
    "CLICK_STEP_PRIM",
    "CLICK_PLAY_PRIM",
    "CLICK_RESET",
    "SPEED_CHANGE",
    "SELECT_START_NODE",
    "CLICK_SET_START",
    "CLICK_SVG",
    "CLICK_NODE_IN_ADD_MODE",
    "POINTER_DOWN_NODE",
    "POINTER_DOWN_ON_NODE_IN_DRAG_MODE",
    "POINTER_MOVE",
    "POINTER_UP",
    "CLICK_NODE_FIRST",
    "CLICK_NODE_SECOND",
    "CLICK_SAME_NODE",
    "EDGE_CREATE_PROMPT",
    "EDGE_WEIGHT_ENTERED",
    "EDGE_WEIGHT_INVALID",
    "EDGE_WEIGHT_CANCEL",
    "CANCEL_CONNECT",
    "POINTER_CAPTURED",
    "RELEASE_POINTER_CAPTURE",
    "EXTRACTION_DONE",
    "START_RELAX_SEQUENCE",
    "RELAX_STEP",
    "RELAX_DONE",
    "PRIM_QUEUE_EMPTY",
    "PRIM_QUEUE_NONEMPTY_MANUAL",
    "PRIM_QUEUE_NONEMPTY_AUTOPLAY",
    "TIMER_TICK",
    "PRIM_COMPLETE",
    "KEYBOARD_STEP",
    "WINDOW_KEY_R"
  ],
  "notes": "This FSM models the visible interactive states and transitions in the provided code. 'Mode' states (mode_add, mode_connect, mode_drag) represent canvas interaction modes. 'connect_selected' models the intermediate state when the user has chosen a first node to connect. 'edge_create_prompt' represents the synchronous prompt; its result (EDGE_WEIGHT_ENTERED / CANCEL) returns to connect mode. 'dragging' models pointer capture and continuous node moves. Prim algorithm states: prim_initialized (after Start), prim_extract (extract-min animation + marking), prim_relax_prepare (collect and mark neighbor candidate edges), prim_relaxing (iterative per-neighbor relaxation with delays), prim_post_relax (cleanup and decide next step), prim_autoplay (autoplay timer active), prim_complete (algorithm finished). OnEnter/OnExit actions are mapped to the major functions and UI updates in the code (initializePrim, render, highlightCodeLine, set/clear intervals, set node/edge states). Timing behaviors (setTimeout/setInterval) and the per-neighbor sequencing are represented by events like EXTRACTION_DONE, START_RELAX_SEQUENCE, RELAX_STEP, RELAX_DONE and TIMER_TICK. Some UI interactions (e.g., changing mode while Prim is running) are allowed by the code; the FSM permits mode changes during Prim but primary algorithm states are preserved. Edge state transitions: normal -> candidate during relax visualization -> mst when an edge is added to the MST. The FSM abstracts prompt/alert flows as synchronous events (EDGE_WEIGHT_ENTERED / EDGE_WEIGHT_CANCEL) and completion alert as part of prim_complete onEnter."
}