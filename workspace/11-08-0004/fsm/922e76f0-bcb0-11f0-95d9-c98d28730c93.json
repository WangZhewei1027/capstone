{
  "topic": "Interactive Prim's Algorithm Module",
  "description": "Models the interactive states and transitions of a browser-based Prim's algorithm teaching module (graph editing, start selection, step/run/auto execution, and visual feedback).",
  "states": [
    {
      "name": "idle",
      "onEnter": "resetAll",
      "on": {
        "CLICK_ADD_NODE_TOGGLE": "add_node",
        "CLICK_ADD_EDGE_TOGGLE": "add_edge_pick_first",
        "RANDOM_GRAPH": "normal_edit",
        "CLEAR_CONFIRMED": "idle",
        "WINDOW_RESIZE": "idle"
      }
    },
    {
      "name": "normal_edit",
      "onEnter": "render_and_update_status_idle",
      "onExit": "clear_temp_picks",
      "on": {
        "CLICK_ADD_NODE_TOGGLE": "add_node",
        "CLICK_ADD_EDGE_TOGGLE": "add_edge_pick_first",
        "CANVAS_CLICK": "normal_edit",
        "NODE_CLICK": "normal_edit",
        "NODE_SELECT_AS_START": "normal_edit",
        "CHOOSE_START_SUCCESS": "prim_manual",
        "CHOOSE_START_FAIL": "normal_edit",
        "RANDOM_GRAPH": "normal_edit",
        "CLEAR_CONFIRMED": "idle",
        "RESET_PRIM": "normal_edit",
        "WINDOW_RESIZE": "normal_edit",
        "PQ_ITEM_CLICK": "normal_edit"
      }
    },
    {
      "name": "add_node",
      "onEnter": "setModeAddNode",
      "onExit": "clearMode",
      "on": {
        "CANVAS_CLICK": "add_node",
        "CLICK_ADD_NODE_TOGGLE": "normal_edit",
        "CLICK_ADD_EDGE_TOGGLE": "add_edge_pick_first",
        "WINDOW_RESIZE": "add_node",
        "NODE_POINTER_DOWN": "dragging"
      }
    },
    {
      "name": "add_edge_pick_first",
      "onEnter": "setModeAddEdge",
      "onExit": "clearMode",
      "on": {
        "NODE_CLICK": "add_edge_pick_second",
        "CLICK_ADD_EDGE_TOGGLE": "normal_edit",
        "CLICK_ADD_NODE_TOGGLE": "add_node",
        "WINDOW_RESIZE": "add_edge_pick_first"
      }
    },
    {
      "name": "add_edge_pick_second",
      "onEnter": "recordFirstEdgePick_and_flash",
      "onExit": "clearEdgePick",
      "on": {
        "NODE_CLICK_SAME": "add_edge_pick_first",
        "NODE_CLICK_DIFFERENT": "awaiting_weight_input",
        "EDGE_ALREADY_EXISTS": "add_edge_pick_first",
        "CLICK_ADD_EDGE_TOGGLE": "normal_edit",
        "CLICK_ADD_NODE_TOGGLE": "add_node"
      }
    },
    {
      "name": "awaiting_weight_input",
      "onEnter": "promptForEdgeWeight",
      "onExit": "clearEdgePrompt",
      "on": {
        "EDGE_WEIGHT_ENTER": "normal_edit",
        "EDGE_WEIGHT_CANCEL": "add_edge_pick_first"
      }
    },
    {
      "name": "prim_manual",
      "onEnter": "startPrim_and_seed_start_node",
      "onExit": "stopAuto_if_running",
      "on": {
        "STEP": "prim_manual",
        "STEP_RESULT_COMPLETE": "prim_complete",
        "STEP_RESULT_DISCONNECTED": "prim_disconnected",
        "AUTO_TOGGLE_ON": "prim_auto",
        "RUN_TO_END": "prim_run_to_end",
        "RESET_PRIM": "normal_edit",
        "PQ_ITEM_CLICK": "prim_manual",
        "WINDOW_RESIZE": "prim_manual"
      }
    },
    {
      "name": "prim_auto",
      "onEnter": "startAuto (startAutoTimer)",
      "onExit": "stopAuto (clearAutoTimer)",
      "on": {
        "AUTO_TOGGLE_OFF": "prim_manual",
        "AUTO_TICK": "prim_auto",
        "AUTO_TICK_RESULT_COMPLETE": "prim_complete",
        "AUTO_TICK_RESULT_DISCONNECTED": "prim_disconnected",
        "RESET_PRIM": "normal_edit",
        "WINDOW_RESIZE": "prim_auto"
      }
    },
    {
      "name": "prim_run_to_end",
      "onEnter": "runToEnd_startInterval",
      "onExit": "runToEnd_clearInterval",
      "on": {
        "RUN_STEP": "prim_run_to_end",
        "RUN_RESULT_COMPLETE": "prim_complete",
        "RUN_RESULT_DISCONNECTED": "prim_disconnected",
        "RESET_PRIM": "normal_edit",
        "WINDOW_RESIZE": "prim_run_to_end"
      }
    },
    {
      "name": "prim_complete",
      "onEnter": "onPrimComplete (updateStatus_and_stopAuto)",
      "on": {
        "CLICK_ADD_EDGE_TOGGLE": "add_edge_pick_first",
        "CLICK_ADD_NODE_TOGGLE": "add_node",
        "RESET_PRIM": "normal_edit",
        "RANDOM_GRAPH": "normal_edit",
        "CLEAR_CONFIRMED": "idle"
      }
    },
    {
      "name": "prim_disconnected",
      "onEnter": "onPrimDisconnected (updateStatus_and_stopAuto)",
      "on": {
        "RESET_PRIM": "normal_edit",
        "CLICK_ADD_EDGE_TOGGLE": "add_edge_pick_first",
        "CLICK_ADD_NODE_TOGGLE": "add_node",
        "RANDOM_GRAPH": "normal_edit",
        "CLEAR_CONFIRMED": "idle"
      }
    },
    {
      "name": "dragging",
      "onEnter": "startDrag",
      "onExit": "endDrag_and_updateEdgeShapes",
      "on": {
        "NODE_POINTER_MOVE": "dragging",
        "NODE_POINTER_UP": "restore_previous_edit_state",
        "WINDOW_RESIZE": "dragging"
      }
    }
  ],
  "events": [
    "CLICK_ADD_NODE_TOGGLE",
    "CLICK_ADD_EDGE_TOGGLE",
    "CANVAS_CLICK",
    "NODE_CLICK",
    "NODE_CLICK_SAME",
    "NODE_CLICK_DIFFERENT",
    "NODE_POINTER_DOWN",
    "NODE_POINTER_MOVE",
    "NODE_POINTER_UP",
    "NODE_SELECT_AS_START",
    "NODE_KEY_ACTIVATE",
    "RANDOM_GRAPH",
    "CLEAR_CONFIRMED",
    "CHOOSE_START_SUCCESS",
    "CHOOSE_START_FAIL",
    "RESET_PRIM",
    "STEP",
    "STEP_RESULT_COMPLETE",
    "STEP_RESULT_DISCONNECTED",
    "RUN_TO_END",
    "RUN_STEP",
    "RUN_RESULT_COMPLETE",
    "RUN_RESULT_DISCONNECTED",
    "AUTO_TOGGLE_ON",
    "AUTO_TOGGLE_OFF",
    "AUTO_TICK",
    "AUTO_TICK_RESULT_COMPLETE",
    "AUTO_TICK_RESULT_DISCONNECTED",
    "PQ_ITEM_CLICK",
    "EDGE_WEIGHT_ENTER",
    "EDGE_WEIGHT_CANCEL",
    "EDGE_ALREADY_EXISTS",
    "WINDOW_RESIZE",
    "EDGE_CREATED",
    "EDGE_CREATION_CANCELLED",
    "restore_previous_edit_state"
  ],
  "notes": "This FSM models high-level interactive behavior. Implementation details: many actions are implemented as immediate function calls (e.g. addNode, createEdge, updateCandidatesForNode, animateEdgeSelection, refreshPQ, render). The browser prompt for edge weight blocks JS, represented as awaiting_weight_input. 'prim_manual' handles STEP calls which may emit conditional results (STEP_RESULT_COMPLETE or STEP_RESULT_DISCONNECTED) depending on the graph; similarly auto (AUTO_TICK) and run-to-end loop produce the same conditional outcomes. 'dragging' is a transient parallel/ephemeral interaction that returns to the previous edit state on pointer up. Timers (auto-play and run-to-end) are represented by start/stop actions (startAuto/stopAuto and runToEnd_startInterval/runToEnd_clearInterval). Some UI toggles (button toggle on/off) control mode values rather than separate FSM states in the code; they are modeled as explicit transitions here. The PQ item click focuses/animates an edge but does not change algorithmic state."
}