{
  "topic": "Merge Sort Interactive Visualization",
  "description": "Models the user-visible states and transitions of a Merge Sort divide-and-conquer visualization: loading/generating arrays, stepping through recorded actions (split/base/merge/done), playing automatic playback, and visual/animation updates.",
  "states": [
    {
      "name": "initializing",
      "onEnter": "init()",
      "onExit": null,
      "on": {
        "INIT_COMPLETE": "paused",
        "NO_ACTIONS": "idle"
      }
    },
    {
      "name": "idle",
      "description": "No actions / no array available",
      "onEnter": "renderEmpty()",
      "onExit": null,
      "on": {
        "RANDOMIZE_CLICK": "paused",
        "APPLY_CLICK": "paused",
        "SHUFFLE_CLICK": "paused",
        "RESET_CLICK": "paused",
        "SIZE_CHANGE": "idle",
        "SPEED_CHANGE": "idle"
      }
    },
    {
      "name": "paused",
      "description": "Timeline loaded, playback paused, current action rendered",
      "onEnter": "pause(); applyAction(current)",
      "onExit": null,
      "on": {
        "PLAY_CLICK": "playing",
        "KEY_PLAY_PAUSE": "playing",
        "STEP_FORWARD_CLICK": "applying",
        "KEY_STEP_FORWARD": "applying",
        "STEP_BACK_CLICK": "applying",
        "KEY_STEP_BACK": "applying",
        "RANDOMIZE_CLICK": "paused",
        "SHUFFLE_CLICK": "paused",
        "RESET_CLICK": "paused",
        "APPLY_CLICK": "paused",
        "SPEED_CHANGE": "paused",
        "SIZE_CHANGE": "paused",
        "WINDOW_RESIZE": "paused"
      }
    },
    {
      "name": "playing",
      "description": "Automatic playback scheduling steps forward",
      "onEnter": "play(); scheduleNext()",
      "onExit": "pause()",
      "on": {
        "TIMER_TICK": "applying",
        "PAUSE_CLICK": "paused",
        "KEY_PLAY_PAUSE": "paused",
        "REACH_END": "done",
        "RANDOMIZE_CLICK": "paused",
        "SHUFFLE_CLICK": "paused",
        "RESET_CLICK": "paused",
        "APPLY_CLICK": "paused",
        "SPEED_CHANGE": "playing",
        "SIZE_CHANGE": "playing",
        "WINDOW_RESIZE": "playing"
      }
    },
    {
      "name": "applying",
      "description": "Transient state: applying a specific action (split/base/merge/done) to the UI; triggers render/animation",
      "onEnter": "applyAction(targetIndex) // includes: actionDesc.update, renderStackForAction(), showRangeOverlay(), animateToArray() when type=merge/done or highlightRange() for split/base",
      "onExit": null,
      "on": {
        "ACTION_APPLIED": [
          "playing",
          "paused",
          "done"
        ],
        "WINDOW_RESIZE": "applying"
      }
    },
    {
      "name": "done",
      "description": "Final sorted state reached (last action is 'done'); UI is paused and shows completed snapshot",
      "onEnter": "pause(); applyAction(lastIndex) // animate final snapshot",
      "onExit": null,
      "on": {
        "RANDOMIZE_CLICK": "paused",
        "SHUFFLE_CLICK": "paused",
        "RESET_CLICK": "paused",
        "APPLY_CLICK": "paused",
        "PLAY_CLICK": "playing",
        "SPEED_CHANGE": "done",
        "SIZE_CHANGE": "done",
        "WINDOW_RESIZE": "done",
        "STEP_BACK_CLICK": "paused"
      }
    }
  ],
  "events": [
    "INIT_COMPLETE",
    "NO_ACTIONS",
    "RANDOMIZE_CLICK",
    "SHUFFLE_CLICK",
    "RESET_CLICK",
    "APPLY_CLICK",
    "PLAY_CLICK",
    "PAUSE_CLICK",
    "STEP_FORWARD_CLICK",
    "STEP_BACK_CLICK",
    "KEY_PLAY_PAUSE",
    "KEY_STEP_FORWARD",
    "KEY_STEP_BACK",
    "SPEED_CHANGE",
    "SIZE_CHANGE",
    "WINDOW_RESIZE",
    "TIMER_TICK",
    "REACH_END",
    "ACTION_APPLIED"
  ],
  "notes": "Mapping of states to concrete implementation actions: init() = initial setup (randArray, renderArray, recordMergeSort, applyAction(0)). play()/pause()/scheduleNext() correspond to starting/clearing the playback timer. applyAction(index) updates stepCounter, actionDesc, actionDetail, renderStackForAction(), showRangeOverlay(), and either animateToArray() for 'merge'/'done' actions or highlightRange() for 'split'/'base' actions. The 'applying' state is transient: after applyAction completes, an ACTION_APPLIED event implicitly routes to playing (if playback is active and not at end), paused (if playback was paused), or done (if action.type === 'done' and index is last). Events STEP_FORWARD_CLICK and STEP_BACK_CLICK call pause() first in the implementation; this FSM models that by transitioning to 'applying' from 'paused' and from 'playing' the UI first transitions to 'paused' then to 'applying'. Some transitions carry a payload (targetIndex) â€” e.g., applying uses targetIndex=current+1 or current-1 depending on event. Window resize triggers recalculation of overlay via showRangeOverlay()."
}