{
  "topic": "Red-Black Tree Insertion Interactive",
  "description": "Models the interactive UI states of the Red-Black Tree insertion visualization: inserting values, stepping through recorded fixup actions, auto-playing animations, rendering snapshots, and handling input/errors.",
  "states": [
    {
      "name": "empty",
      "onEnter": "renderEmpty",
      "onExit": "prepareForInsert",
      "on": {
        "INSERT_CLICK_VALID": "inserting",
        "INSERT_CLICK_INVALID": "error",
        "RESET_CLICK": "empty",
        "AUTO_TOGGLE": "empty",
        "RESIZE": "empty"
      }
    },
    {
      "name": "inserting",
      "onEnter": "validateInput -> recordSteps (tree.insertWithSteps) -> setCurrentStepToLatest -> renderCurrentStep",
      "onExit": "finalizeInsert (clear input, update status text)",
      "on": {
        "INSERT_COMPLETE": "viewing_at_end",
        "INSERT_DUPLICATE": "viewing_at_end",
        "ERROR_DETECTED": "error",
        "RESET_CLICK": "empty",
        "RESIZE": "inserting"
      }
    },
    {
      "name": "viewing_at_start",
      "onEnter": "renderStep(0) -> updateStatus",
      "onExit": "updateCurrentIndex",
      "on": {
        "NEXT_CLICK": "viewing_mid_or_end",
        "STEP_CLICK": "viewing_mid_or_end",
        "PREV_CLICK": "viewing_at_start",
        "INSERT_CLICK_VALID": "inserting",
        "RESET_CLICK": "empty",
        "AUTO_TOGGLE": "auto_playing",
        "RESIZE": "viewing_at_start"
      }
    },
    {
      "name": "viewing_mid",
      "onEnter": "renderCurrentStep -> updateStatus",
      "onExit": "updateCurrentIndex",
      "on": {
        "NEXT_CLICK": "viewing_mid_or_end",
        "STEP_CLICK": "viewing_mid_or_end",
        "PREV_CLICK": "viewing_mid_or_start",
        "INSERT_CLICK_VALID": "inserting",
        "RESET_CLICK": "empty",
        "AUTO_TOGGLE": "auto_playing",
        "RESIZE": "viewing_mid"
      }
    },
    {
      "name": "viewing_at_end",
      "onEnter": "renderStep(latest) -> updateStatus",
      "onExit": "updateCurrentIndex",
      "on": {
        "NEXT_CLICK": "viewing_at_end",
        "STEP_CLICK": "viewing_at_end",
        "PREV_CLICK": "viewing_mid_or_start",
        "INSERT_CLICK_VALID": "inserting",
        "RESET_CLICK": "empty",
        "AUTO_TOGGLE": "auto_playing",
        "RESIZE": "viewing_at_end"
      }
    },
    {
      "name": "auto_playing",
      "onEnter": "startAutoTimer -> disableControls -> advanceAndRender(700ms)",
      "onExit": "stopAutoTimer -> enableControls",
      "on": {
        "TIMER_TICK": "auto_playing",
        "AUTO_FINISHED": "viewing_at_end",
        "AUTO_STOP": "viewing_current",
        "RESET_CLICK": "empty",
        "RESIZE": "auto_playing"
      }
    },
    {
      "name": "error",
      "onEnter": "showErrorMessage (explainEl.textContent) -> keepControlsEnabled",
      "onExit": "clearErrorMessage",
      "on": {
        "INPUT_CHANGED": "error",
        "INSERT_CLICK_VALID": "inserting",
        "RESET_CLICK": "empty",
        "RESIZE": "error"
      }
    }
  ],
  "events": [
    "INSERT_CLICK_VALID",
    "INSERT_CLICK_INVALID",
    "INSERT_COMPLETE",
    "INSERT_DUPLICATE",
    "ERROR_DETECTED",
    "STEP_CLICK",
    "NEXT_CLICK",
    "PREV_CLICK",
    "RESET_CLICK",
    "AUTO_TOGGLE",
    "AUTO_STARTED",
    "AUTO_STOP",
    "AUTO_FINISHED",
    "TIMER_TICK",
    "INPUT_CHANGED",
    "RESIZE",
    "KEY_ENTER",
    "KEY_ARROW_RIGHT",
    "KEY_ARROW_LEFT",
    "RENDER_COMPLETE"
  ],
  "notes": "This FSM models the interactive modes in the app and abstracts over the step index into viewing substates: viewing_at_start (currentStep==0), viewing_mid (0<currentStep<last), viewing_at_end (currentStep==last). Transitions named viewing_mid_or_end and viewing_mid_or_start are conditional: the actual next state depends on the runtime currentStep after advancing/retreating. onEnter/onExit actions are described as high-level action names that map to the concrete functions in the code: validateInput (reading and checking input), recordSteps (RBTree.insertWithSteps), renderCurrentStep/renderStep(index) (drawing snapshot to SVG), startAutoTimer/stopAutoTimer (manage autoTimer interval and disabling controls), disableControls/enableControls, showErrorMessage/clearErrorMessage, renderEmpty (clear SVG and explanatory text), setCurrentStepToLatest/updateCurrentIndex (manage currentStepIndex variable). Events like TIMER_TICK and AUTO_FINISHED are generated by the autoTimer internal behavior; INPUT_CHANGED corresponds to typing or focus actions that clear errors. Some transitions are conditional on runtime values (number of steps, currentStepIndex) rather than purely external events."
}