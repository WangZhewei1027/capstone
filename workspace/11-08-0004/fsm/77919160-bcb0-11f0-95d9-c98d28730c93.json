{
  "topic": "Weighted Graph Interactive Module",
  "description": "Models the interactive states and transitions of a weighted-graph visualizer: modes (select / addEdge / delete), node/edge creation & editing, dragging, Dijkstra animation, and UI controls (zoom, start/end selection).",
  "states": [
    {
      "name": "idle_select",
      "onEnter": "setMode('select')",
      "onExit": "",
      "on": {
        "MODE_ADD_EDGE": "idle_addEdge",
        "MODE_DELETE": "idle_delete",
        "MODE_SELECT": "idle_select",
        "CLICK_EMPTY": "idle_select",
        "CLICK_NODE": "idle_select",
        "NODE_POINTER_DOWN": "dragging_node",
        "CLICK_EDGE_LABEL": "editing_weight",
        "CLICK_EDGE_LINE": "idle_select",
        "SET_START": "idle_select",
        "SET_END": "idle_select",
        "RUN_DIJKSTRA": "animating",
        "ZOOM_IN": "idle_select",
        "ZOOM_OUT": "idle_select",
        "ADD_SAMPLE": "idle_select",
        "CLEAR": "idle_select",
        "RESET_VIEW": "idle_select",
        "KEY_DELETE": "idle_select"
      }
    },
    {
      "name": "idle_addEdge",
      "onEnter": "setMode('addEdge')",
      "onExit": "clearHighlights()",
      "on": {
        "MODE_SELECT": "idle_select",
        "MODE_DELETE": "idle_delete",
        "CLICK_NODE": "adding_edge",
        "CLICK_EMPTY": "idle_addEdge",
        "CANCEL_ADDING": "idle_addEdge",
        "RUN_DIJKSTRA": "animating",
        "KEY_DELETE": "idle_addEdge",
        "ADD_SAMPLE": "idle_addEdge",
        "CLEAR": "idle_addEdge"
      }
    },
    {
      "name": "adding_edge",
      "onEnter": "state.addingEdgeFrom set; highlightTemp(node)",
      "onExit": "clearHighlights()",
      "on": {
        "CLICK_NODE_SAME": "idle_addEdge",
        "CLICK_NODE_DIFFERENT": "editing_weight",
        "CLICK_EMPTY": "idle_addEdge",
        "CANCEL_ADDING": "idle_addEdge",
        "MODE_SELECT": "idle_select",
        "MODE_DELETE": "idle_delete",
        "RUN_DIJKSTRA": "animating"
      }
    },
    {
      "name": "editing_weight",
      "onEnter": "openWeightEditor / showFloat(x,y); focus weightInput",
      "onExit": "hideFloat()",
      "on": {
        "EDGE_WEIGHT_COMMIT_NEW": "idle_addEdge",
        "EDGE_WEIGHT_COMMIT_EDIT": "idle_select",
        "EDGE_WEIGHT_CANCEL": "idle_select",
        "MODE_SELECT": "idle_select",
        "MODE_ADD_EDGE": "idle_addEdge",
        "MODE_DELETE": "idle_delete",
        "KEY_DELETE": "editing_weight"
      }
    },
    {
      "name": "dragging_node",
      "onEnter": "start drag (capture pointer); set drag.active=true",
      "onExit": "stop drag; drag.active=false",
      "on": {
        "POINTER_MOVE": "dragging_node",
        "POINTER_UP": "idle_select",
        "POINTER_CANCEL": "idle_select",
        "MODE_DELETE": "idle_delete"
      }
    },
    {
      "name": "idle_delete",
      "onEnter": "setMode('delete')",
      "onExit": "",
      "on": {
        "CLICK_NODE": "idle_delete",
        "CLICK_EMPTY": "idle_delete",
        "MODE_SELECT": "idle_select",
        "MODE_ADD_EDGE": "idle_addEdge",
        "RUN_DIJKSTRA": "animating",
        "KEY_DELETE": "idle_delete",
        "CLEAR": "idle_delete"
      }
    },
    {
      "name": "animating",
      "onEnter": "runDijkstraAnimated() (build order array; start animation timeouts)",
      "onExit": "animation cleanup (clear timeouts / leave highlights as-is)",
      "on": {
        "ANIMATION_STEP": "animating",
        "ANIMATION_COMPLETE": "animation_done",
        "MODE_SELECT": "animating",
        "MODE_ADD_EDGE": "animating",
        "MODE_DELETE": "animating"
      }
    },
    {
      "name": "animation_done",
      "onEnter": "highlightPath(); distanceSum update; log completion",
      "onExit": "",
      "on": {
        "MODE_SELECT": "idle_select",
        "MODE_ADD_EDGE": "idle_addEdge",
        "MODE_DELETE": "idle_delete",
        "CLICK_NODE": "idle_select",
        "CLICK_EMPTY": "idle_select",
        "KEY_DELETE": "idle_select"
      }
    }
  ],
  "events": [
    "MODE_SELECT",
    "MODE_ADD_EDGE",
    "MODE_DELETE",
    "CLICK_EMPTY",
    "CLICK_NODE",
    "CLICK_NODE_SAME",
    "CLICK_NODE_DIFFERENT",
    "NODE_POINTER_DOWN",
    "POINTER_MOVE",
    "POINTER_UP",
    "POINTER_CANCEL",
    "CLICK_EDGE_LABEL",
    "CLICK_EDGE_LINE",
    "EDGE_WEIGHT_COMMIT_NEW",
    "EDGE_WEIGHT_COMMIT_EDIT",
    "EDGE_WEIGHT_CANCEL",
    "CANCEL_ADDING",
    "RUN_DIJKSTRA",
    "ANIMATION_STEP",
    "ANIMATION_COMPLETE",
    "SET_START",
    "SET_END",
    "ZOOM_IN",
    "ZOOM_OUT",
    "KEY_DELETE",
    "ADD_SAMPLE",
    "CLEAR",
    "RESET_VIEW",
    "EDGE_CREATED",
    "EDGE_REMOVED",
    "NODE_ADDED",
    "NODE_REMOVED"
  ],
  "notes": "State machine models the interactive UI modes and important transient states. 'mode' (select/addEdge/delete) is encoded via idle_select / idle_addEdge / idle_delete. 'adding_edge' captures the sub-state where a source node has been selected and the user must choose a target or cancel. 'editing_weight' models the floating input shown for creating or editing an edge weight (commits either create a new edge or update an existing one). 'dragging_node' models pointer capture while moving a node; pointermove keeps the state until pointerup. 'animating' is the Dijkstra run: the implementation generates an ordered list of visual events and drives them with setTimeout; this FSM exposes ANIMATION_STEP and ANIMATION_COMPLETE; the real code does not expose a cancel path or explicit timeout ids, so canceling mid-animation is not modeled. Events like EDGE_WEIGHT_CANCEL should restore the UI to the previous mode; the code conditionally returns to addEdge if the editor was opened while creating an edge and to select after editing an existing edge. This conditional return is simplified in the FSM: EDGE_WEIGHT_COMMIT_NEW -> idle_addEdge, EDGE_WEIGHT_COMMIT_EDIT -> idle_select, EDGE_WEIGHT_CANCEL -> idle_select (see code comments). Selection (selectedNode / selectedEdge), startNode/endNode assignment, and summary/log updates are data-level effects that occur on transitions but do not form separate top-level states in this FSM."
}