{
  "topic": "Bubble Sort Interactive Module",
  "description": "Finite state machine modeling the interactive Bubble Sort visualizer: controls (step/play/reset), autoplay, per-comparison and per-swap animations, pass handling, manual-swap mode, and completion/early-exit optimization.",
  "states": [
    {
      "name": "ready",
      "onEnter": "setStatus('Ready'), highlightPseudo(null), stopAutoplayInterval",
      "onExit": null,
      "on": {
        "STEP": "stepping",
        "PLAY_TOGGLE": "autoplay",
        "SET_ARRAY": "ready",
        "RANDOMIZE": "ready",
        "RESET": "ready",
        "MANUAL_TOGGLE": "manual_mode",
        "KEY_SPACE": "stepping"
      }
    },
    {
      "name": "autoplay",
      "onEnter": "startAutoplayInterval, setStatus('Auto-playing')",
      "onExit": "stopAutoplayInterval",
      "on": {
        "AUTO_TICK": "stepping",
        "PLAY_TOGGLE": "paused",
        "RESET": "ready",
        "SET_ARRAY": "ready",
        "RANDOMIZE": "ready"
      }
    },
    {
      "name": "paused",
      "onEnter": "setStatus('Paused'), stopAutoplayInterval",
      "onExit": null,
      "on": {
        "PLAY_TOGGLE": "autoplay",
        "STEP": "stepping",
        "MANUAL_TOGGLE": "manual_mode",
        "RESET": "ready",
        "SET_ARRAY": "ready",
        "RANDOMIZE": "ready",
        "KEY_SPACE": "stepping"
      }
    },
    {
      "name": "stepping",
      "onEnter": "startStep (initialize pass if j==0, set swapped=false when needed)",
      "onExit": null,
      "on": {
        "COMPARE": "comparing",
        "FINISH": "finished",
        "CANCEL": "ready"
      }
    },
    {
      "name": "comparing",
      "onEnter": "markCompare(a,b), incrementComparisons, highlightPseudo(line 4)",
      "onExit": "clearHighlights",
      "on": {
        "COMPARE_GREATER": "swapping",
        "COMPARE_LESS_EQUAL": "pass_check",
        "CANCEL": "ready"
      }
    },
    {
      "name": "swapping",
      "onEnter": "swapElements(a,b,manual?), apply swap classes, incrementSwaps, highlightPseudo(line 5-6)",
      "onExit": "removeSwapHighlights, markSortedPositions",
      "on": {
        "SWAP_COMPLETE": "pass_check",
        "CANCEL": "ready"
      }
    },
    {
      "name": "pass_check",
      "onEnter": "incrementPassIfEndOfInnerLoop (i++ if j reached limit), markSortedPositions, highlightPseudo(line 7)",
      "onExit": null,
      "on": {
        "EARLY_EXIT": "finished",
        "CONTINUE": "ready",
        "STEP": "stepping",
        "PLAY_TOGGLE": "autoplay",
        "RESET": "ready",
        "SET_ARRAY": "ready",
        "RANDOMIZE": "ready"
      }
    },
    {
      "name": "manual_mode",
      "onEnter": "enableManualSwapUI, setStatus('Manual swap: select two bars'), clear any firstIndex",
      "onExit": "disableManualSwapUI, clearSelection",
      "on": {
        "BAR_CLICK_FIRST": "manual_selected",
        "MANUAL_TOGGLE": "ready",
        "RESET": "ready",
        "SET_ARRAY": "ready",
        "RANDOMIZE": "ready"
      }
    },
    {
      "name": "manual_selected",
      "onEnter": "highlightSelected(index), setStatus('Selected index X â€” choose second to swap')",
      "onExit": "clearSelection",
      "on": {
        "BAR_CLICK_SAME": "manual_mode",
        "BAR_CLICK_SECOND": "swapping",
        "MANUAL_TOGGLE": "ready",
        "RESET": "ready",
        "SET_ARRAY": "ready",
        "RANDOMIZE": "ready"
      }
    },
    {
      "name": "finished",
      "onEnter": "markAllSorted, setStatus('Array sorted' or 'Finished'), highlightPseudo(null), stopAutoplayInterval",
      "onExit": null,
      "on": {
        "RESET": "ready",
        "SET_ARRAY": "ready",
        "RANDOMIZE": "ready"
      }
    }
  ],
  "events": [
    "STEP",
    "PLAY_TOGGLE",
    "AUTO_TICK",
    "SET_ARRAY",
    "RANDOMIZE",
    "RESET",
    "SPEED_CHANGE",
    "OPTIMIZE_TOGGLE",
    "MANUAL_TOGGLE",
    "BAR_CLICK_FIRST",
    "BAR_CLICK_SECOND",
    "BAR_CLICK_SAME",
    "COMPARE",
    "COMPARE_GREATER",
    "COMPARE_LESS_EQUAL",
    "SWAP_COMPLETE",
    "PASS_COMPLETE",
    "EARLY_EXIT",
    "KEY_SPACE",
    "SWAP_ANIMATION_END",
    "FINISH",
    "CANCEL",
    "CONTINUE"
  ],
  "notes": "This FSM models the main interactive flows implemented in the page script. The implementation uses an async step() that sequences comparison, optional swap, pass-end checks and early-exit; those internal sequencing points are represented here as stepped states (stepping -> comparing -> swapping -> pass_check). Autoplay is represented as a separate state that triggers STEP via AUTO_TICK; toggling play moves between autoplay and paused. Manual swap is an orthogonal mode in the code; here it is represented as two explicit states (manual_mode and manual_selected). UI side-effects (status text, pseudocode highlighting, bar classes, counters, animations) are modeled as onEnter/onExit actions. Events like SPEED_CHANGE and OPTIMIZE_TOGGLE are controls that update parameters but do not by themselves transition core sorting states (they are included for completeness). The FSM intentionally simplifies concurrent aspects (manual mode and autoplay can coexist in implementation) by modeling manual mode transitions from major states where user interaction is expected."
}