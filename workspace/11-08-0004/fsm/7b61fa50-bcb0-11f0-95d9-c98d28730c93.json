{
  "topic": "Heap Sort Interactive Module",
  "description": "Models the interactive states and transitions of an in-browser heap-sort visualization: loading arrays, generating logical steps, stepping (forward/back), play/pause autoplay, animations for comparisons and swaps, and completion.",
  "states": [
    {
      "name": "idle",
      "onEnter": "setStatusIdle",
      "onExit": "clearVisuals",
      "on": {
        "LOAD_ARRAY": "loading",
        "RESET": "idle",
        "PLAY": "idle",
        "STEP_FORWARD": "idle",
        "STEP_BACK": "idle"
      }
    },
    {
      "name": "loading",
      "onEnter": "loadArray_buildVisuals_generateSteps",
      "onExit": "updateStats",
      "on": {
        "LOAD_COMPLETE": "ready",
        "LOAD_FAILED": "idle",
        "RESET": "idle"
      }
    },
    {
      "name": "ready",
      "onEnter": "setStatusReady_snapshotInitial",
      "onExit": "clearHighlights",
      "on": {
        "PLAY": "playing",
        "STEP_FORWARD": "executing_step",
        "STEP_BACK": "stepping_back",
        "LOAD_ARRAY": "loading",
        "RESET": "idle"
      }
    },
    {
      "name": "playing",
      "onEnter": "startAutoPlay (start timer, set playing=true, status 'Playing')",
      "onExit": "stopAutoPlay (clear timer, set playing=false)",
      "on": {
        "PAUSE": "paused",
        "TIMER_TICK": "executing_step",
        "STEP_FINISHED": "playing",
        "STEP_FINISHED_AT_END": "done",
        "STEP_BACK": "stepping_back",
        "RESET": "idle",
        "LOAD_ARRAY": "loading"
      }
    },
    {
      "name": "paused",
      "onEnter": "setStatusPaused (playing=false)",
      "onExit": "clearHighlights",
      "on": {
        "PLAY": "playing",
        "STEP_FORWARD": "executing_step",
        "STEP_BACK": "stepping_back",
        "RESET": "idle",
        "LOAD_ARRAY": "loading"
      }
    },
    {
      "name": "executing_step",
      "onEnter": "executeStep_action (perform logical step: compare/sift-start/swap/heap-shrink/done); if step involves animation => start animation",
      "onExit": "updateStats_snapshot_and_clearTempHighlights",
      "on": {
        "ANIMATION_COMPLETE": "STEP_DONE_HANDLER",
        "STEP_COMPLETE": "STEP_DONE_HANDLER",
        "RESET": "idle"
      }
    },
    {
      "name": "stepping_back",
      "onEnter": "pause_then_restoreSnapshot (restore previous history snapshot)",
      "onExit": "updateStats_clearHighlights",
      "on": {
        "RESTORE_COMPLETE": "paused",
        "RESET": "idle",
        "LOAD_ARRAY": "loading"
      }
    },
    {
      "name": "done",
      "onEnter": "finalizeSorting (snapshot done, set status 'Done', clear highlights)",
      "onExit": "clearHighlights",
      "on": {
        "STEP_BACK": "stepping_back",
        "LOAD_ARRAY": "loading",
        "RESET": "idle",
        "PLAY": "done"
      }
    }
  ],
  "events": [
    "LOAD_ARRAY",
    "LOAD_COMPLETE",
    "LOAD_FAILED",
    "RESET",
    "PLAY",
    "PAUSE",
    "STEP_FORWARD",
    "STEP_BACK",
    "TIMER_TICK",
    "EXECUTE_STEP",
    "STEP_COMPLETE",
    "STEP_FINISHED",
    "STEP_FINISHED_AT_END",
    "ANIMATION_COMPLETE",
    "RESTORE_COMPLETE",
    "GENERATE_STEPS",
    "GENERATE_STEPS_DONE",
    "ERROR_INVALID_ACTION"
  ],
  "notes": "State machine maps user interactions and internal async activity. Key action names correspond to JS functions / behaviors in the app: loadArray_buildVisuals_generateSteps = loadArray() -> buildVisuals() -> generateSteps(); startAutoPlay/stopAutoPlay = play()/pause() and timer scheduling; executing_step = executeStep() which may trigger animations (swap -> animateSwap) or simple timeouts (compare/sift events). 'ANIMATION_COMPLETE' represents the end of an animated swap or highlight (animateSwap callback or timeout). The transition from executing_step after a step completes is contextual: if playing flag is true the STEP_COMPLETE leads back to playing (auto-advance via timer), otherwise it leads to paused/ready. The placeholder transition 'STEP_DONE_HANDLER' denotes a conditional: go to 'playing' when autoplay active, otherwise 'paused' (or 'done' if final step). Invalid operations (e.g., PLAY with no array loaded) produce an alert and remain in the current state (modeled as ERROR_INVALID_ACTION -> stay). History snapshots are taken after each logical step and used by stepping_back/RESTORE_COMPLETE to restore previous states. Visual highlight/edge styles are cleared on many onExit actions (clearHighlights)."
}