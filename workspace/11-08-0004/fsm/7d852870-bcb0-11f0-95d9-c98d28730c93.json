{
  "topic": "Heap Sort Interactive Module",
  "description": "Models the interactive lifecycle of the Heap Sort visualization: array generation/input, recording of algorithm actions (build / full sort), stepping through recorded actions, animated comparisons/swaps, autoplay, view toggles, and completion.",
  "states": [
    {
      "name": "idle",
      "onEnter": "renderAll(), updateButtons(), clear log state; playing=false",
      "onExit": "none",
      "on": {
        "SIZE_CHANGE": "idle",
        "RANDOMIZE_CLICK": "idle",
        "APPLY_ARRAY_CLICK": "idle",
        "BUILD_HEAP_CLICK": "ready",
        "RUN_SORT_CLICK": "ready",
        "PLAY_PAUSE_CLICK": "playing",
        "STEP_FORWARD_CLICK": "idle",
        "STEP_BACK_CLICK": "idle",
        "RESET_CLICK": "idle",
        "VIEW_ARRAY_CLICK": "idle",
        "VIEW_TREE_CLICK": "idle",
        "TOGGLE_SHOW_INDICES": "idle",
        "WINDOW_RESIZE": "idle",
        "KEY_PLAY_PAUSE": "playing",
        "KEY_STEP_RIGHT": "idle",
        "KEY_STEP_LEFT": "idle"
      }
    },
    {
      "name": "ready",
      "onEnter": "renderAll(), updateButtons(), actions recorded and actionIndex = 0 (log cleared)",
      "onExit": "none",
      "on": {
        "STEP_FORWARD_CLICK": "animating",
        "STEP_BACK_CLICK": "animating",
        "PLAY_PAUSE_CLICK": "playing",
        "RESET_CLICK": "idle",
        "BUILD_HEAP_CLICK": "ready",
        "RUN_SORT_CLICK": "ready",
        "RANDOMIZE_CLICK": "idle",
        "APPLY_ARRAY_CLICK": "idle",
        "SIZE_CHANGE": "idle",
        "VIEW_ARRAY_CLICK": "ready",
        "VIEW_TREE_CLICK": "ready",
        "TOGGLE_SHOW_INDICES": "ready",
        "WINDOW_RESIZE": "ready",
        "KEY_PLAY_PAUSE": "playing",
        "KEY_STEP_RIGHT": "animating",
        "KEY_STEP_LEFT": "animating"
      }
    },
    {
      "name": "playing",
      "onEnter": "startPlayTimer() (togglePlay sets playing=true, update play button text, set interval based on speed)",
      "onExit": "stopPlayTimer() (clear interval, set playing=false, update play button text)",
      "on": {
        "PLAY_TIMER_TICK": "animating",
        "PLAY_PAUSE_CLICK": "ready",
        "STEP_FORWARD_CLICK": "animating",
        "STEP_BACK_CLICK": "animating",
        "ACTIONS_EXHAUSTED": "completed",
        "RESET_CLICK": "idle",
        "BUILD_HEAP_CLICK": "ready",
        "RUN_SORT_CLICK": "ready",
        "VIEW_ARRAY_CLICK": "playing",
        "VIEW_TREE_CLICK": "playing",
        "TOGGLE_SHOW_INDICES": "playing",
        "WINDOW_RESIZE": "playing",
        "KEY_PLAY_PAUSE": "ready",
        "KEY_STEP_RIGHT": "animating",
        "KEY_STEP_LEFT": "animating"
      }
    },
    {
      "name": "animating",
      "onEnter": "performActionVisual(currentAction) (this triggers highlightCompare/highlightSwap, animateSwap or short pauses); (applyActionsUpTo increments or decrements actionIndex as appropriate) ; appendLog on completion",
      "onExit": "clearHighlights(), renderAll(), updateButtons()",
      "on": {
        "ANIMATION_COMPLETE": [
          "playing -> playing",
          "otherwise -> ready",
          "if actionIndex >= actions.length -> completed"
        ],
        "PLAY_PAUSE_CLICK": "playing",
        "RESET_CLICK": "idle",
        "VIEW_ARRAY_CLICK": "animating",
        "VIEW_TREE_CLICK": "animating",
        "WINDOW_RESIZE": "animating"
      }
    },
    {
      "name": "completed",
      "onEnter": "highlightSorted(), currentAction='done', updateButtons()",
      "onExit": "none",
      "on": {
        "RESET_CLICK": "idle",
        "STEP_BACK_CLICK": "animating",
        "PLAY_PAUSE_CLICK": "playing",
        "BUILD_HEAP_CLICK": "ready",
        "RUN_SORT_CLICK": "ready",
        "RANDOMIZE_CLICK": "idle",
        "APPLY_ARRAY_CLICK": "idle",
        "VIEW_ARRAY_CLICK": "completed",
        "VIEW_TREE_CLICK": "completed",
        "TOGGLE_SHOW_INDICES": "completed",
        "WINDOW_RESIZE": "completed",
        "KEY_PLAY_PAUSE": "playing",
        "KEY_STEP_LEFT": "animating"
      }
    }
  ],
  "events": [
    "SIZE_CHANGE",
    "RANDOMIZE_CLICK",
    "APPLY_ARRAY_CLICK",
    "BUILD_HEAP_CLICK",
    "RUN_SORT_CLICK",
    "STEP_FORWARD_CLICK",
    "STEP_BACK_CLICK",
    "PLAY_PAUSE_CLICK",
    "RESET_CLICK",
    "SPEED_CHANGE",
    "VIEW_ARRAY_CLICK",
    "VIEW_TREE_CLICK",
    "TOGGLE_SHOW_INDICES",
    "WINDOW_RESIZE",
    "KEY_PLAY_PAUSE",
    "KEY_STEP_RIGHT",
    "KEY_STEP_LEFT",
    "PLAY_TIMER_TICK",
    "PLAY_TIMER_START",
    "PLAY_TIMER_STOP",
    "ANIMATION_COMPLETE",
    "ACTIONS_EXHAUSTED"
  ],
  "notes": "High-level mapping of application logic to an FSM. The implementation uses an actions[] recording (compare, swap, heapifyStart, heapifyEnd, done). Recording actions (recordBuildHeap or recordHeapSort) transitions the UI from idle to ready. Stepping/playing triggers performActionVisual which performs highlights and animateSwap; during animation the UI is in a transient 'animating' state. Playback is implemented via a timer (startPlayTimer/stopPlayTimer) which fires ticks that request step/animation; when actionIndex reaches actions.length the module moves to 'completed' and highlights all elements as sorted. View mode (Array vs Tree) and showIndices are orthogonal UI toggles and do not change algorithmic state. Stepping back is implemented by replaying actions from initialArray up to the requested actionIndex (deterministic rollback). Button enable/disable behavior is handled by updateButtons() in each state. Events named above map to DOM events and internal timers/animation completions in the code."
}