{
  "topic": "Interactive Linear Regression Module",
  "description": "Models the interactive UI states and transitions for the linear regression canvas app: point manipulation, manual parameter adjustments, OLS fit, and animated gradient descent.",
  "states": [
    {
      "name": "idle",
      "onEnter": "draw (ensure canvas reflects current params/points)",
      "onExit": "none",
      "on": {
        "POINTER_DOWN_ON_POINT": "dragging",
        "POINTER_DOWN_ON_CANVAS": "idle",
        "ADD_POINT_BUTTON_CLICK": "idle",
        "ADD_POINT_CANVAS": "idle",
        "RESET_DATA_CLICK": "idle",
        "APPLY_MANUAL_CLICK": "idle",
        "FIT_OLS_CLICK": "idle",
        "SLOPE_RANGE_INPUT": "idle",
        "INTERCEPT_RANGE_INPUT": "idle",
        "GD_START_CLICK": "gd_running",
        "GD_PAUSE_CLICK": "gd_paused",
        "GD_RESET_CLICK": "gd_paused",
        "CLICK_POINT_SELECT": "point_selected",
        "RESIZE": "idle",
        "TICK": "idle"
      }
    },
    {
      "name": "dragging",
      "onEnter": "capture pointer & set dragging point (pointerIdToPoint mapping)",
      "onExit": "release pointer capture for that pointer; recomputeStats(); draw()",
      "on": {
        "POINTER_MOVE": "dragging",
        "POINTER_UP": "idle",
        "POINTER_CANCEL": "idle",
        "GD_START_CLICK": "dragging",
        "GD_PAUSE_CLICK": "dragging",
        "GD_RESET_CLICK": "dragging"
      }
    },
    {
      "name": "point_selected",
      "onEnter": "highlightSelectedPoint(index); draw()",
      "onExit": "draw() (clear highlight)",
      "on": {
        "KEY_ARROW_PRESS": "point_selected",
        "CLICK_OUTSIDE": "idle",
        "POINTER_DOWN_ON_POINT": "dragging",
        "POINTER_DOWN_ON_CANVAS": "idle",
        "APPLY_MANUAL_CLICK": "point_selected",
        "FIT_OLS_CLICK": "point_selected",
        "GD_START_CLICK": "gd_running",
        "GD_PAUSE_CLICK": "gd_paused",
        "GD_RESET_CLICK": "gd_paused"
      }
    },
    {
      "name": "gd_running",
      "onEnter": "gdStart(): set gdRunning=true, gdPaused=false, init gdState to current params, start animation (stepLoop -> requestAnimationFrame)",
      "onExit": "gdPause(): set gdPaused=true, gdRunning=false; cancelAnimationFrame",
      "on": {
        "GD_PAUSE_CLICK": "gd_paused",
        "GD_RESET_CLICK": "gd_paused",
        "GD_CONVERGED": "gd_paused",
        "POINTER_DOWN_ON_POINT": "dragging",
        "POINTER_DOWN_ON_CANVAS": "gd_running",
        "APPLY_MANUAL_CLICK": "gd_running",
        "FIT_OLS_CLICK": "gd_running",
        "SLOPE_RANGE_INPUT": "gd_running",
        "INTERCEPT_RANGE_INPUT": "gd_running",
        "ADD_POINT_BUTTON_CLICK": "gd_running",
        "RESET_DATA_CLICK": "gd_paused",
        "RESIZE": "gd_running",
        "TICK": "gd_running"
      }
    },
    {
      "name": "gd_paused",
      "onEnter": "gdPause() or gdReset(): cancelAnimationFrame; set gdPaused=true; if reset then reset gdState to params, recomputeStats(); draw()",
      "onExit": "none",
      "on": {
        "GD_START_CLICK": "gd_running",
        "GD_RESET_CLICK": "gd_paused",
        "GD_PAUSE_CLICK": "gd_paused",
        "APPLY_MANUAL_CLICK": "gd_paused",
        "FIT_OLS_CLICK": "gd_paused",
        "ADD_POINT_BUTTON_CLICK": "gd_paused",
        "RESET_DATA_CLICK": "gd_paused",
        "POINTER_DOWN_ON_POINT": "dragging",
        "POINTER_DOWN_ON_CANVAS": "gd_paused",
        "RESIZE": "gd_paused",
        "TICK": "gd_paused"
      }
    }
  ],
  "events": [
    "POINTER_DOWN_ON_POINT",
    "POINTER_DOWN_ON_CANVAS",
    "POINTER_MOVE",
    "POINTER_UP",
    "POINTER_CANCEL",
    "CLICK_POINT_SELECT",
    "CLICK_OUTSIDE",
    "KEY_ARROW_PRESS",
    "SLOPE_RANGE_INPUT",
    "INTERCEPT_RANGE_INPUT",
    "APPLY_MANUAL_CLICK",
    "FIT_OLS_CLICK",
    "ADD_POINT_BUTTON_CLICK",
    "ADD_POINT_CANVAS",
    "RESET_DATA_CLICK",
    "GD_START_CLICK",
    "GD_PAUSE_CLICK",
    "GD_RESET_CLICK",
    "GD_CONVERGED",
    "RESIZE",
    "TICK"
  ],
  "notes": "This FSM models the primary interactive behaviors. There are two partially orthogonal concerns: direct point manipulation (dragging / point_selected) and gradient descent animation (gd_running / gd_paused). Dragging is implemented as a transient state that can occur while gradient descent is running or paused (the implementation allows concurrent interactions). Key onEnter/onExit actions map to functions in the code: dragging onEnter captures pointer and begins updating a point on pointermove; dragging onExit releases the pointer and recomputes stats/draws. gd_running onEnter starts the iterative animation loop (gdStart/stepLoop) and onExit cancels animation (gdPause/gdReset). Immediate UI actions (APPLY_MANUAL_CLICK, FIT_OLS_CLICK, ADD_POINT_BUTTON_CLICK, RESET_DATA_CLICK) perform state-preserving updates (update params, compute OLS, recomputeStats(), draw()) and therefore generally transition to the same nominal state (idle or current GD mode). The RESIZE and periodic TICK events trigger resizeCanvasToDisplaySize() and draw() but do not change logical interaction state."
}