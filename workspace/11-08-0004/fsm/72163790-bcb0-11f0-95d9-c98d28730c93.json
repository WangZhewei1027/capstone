{
  "topic": "Adjacency List Interactive Module",
  "description": "Models the interactive states of a graph canvas / adjacency-list application (nodes, edges, drag, selection, add/remove, randomize, export, help).",
  "states": [
    {
      "name": "init",
      "onEnter": "init() — create example nodes and edges, update views",
      "on": {
        "LOAD_COMPLETE": "idle",
        "NO_NODES": "empty"
      }
    },
    {
      "name": "empty",
      "description": "No nodes present in the graph",
      "onEnter": "renderAdjList() (shows 'No nodes yet'), updateStatus()",
      "on": {
        "ADD_NODE_CLICK": "creating_node",
        "ADD_NODE_DBLCLICK": "creating_node",
        "RANDOM_CLICK": "randomizing",
        "EXPORT_CLICK": "exporting"
      }
    },
    {
      "name": "idle",
      "description": "Graph present, no node selected, not dragging",
      "onEnter": "renderAdjList(null), updateStatus()",
      "onExit": "none",
      "on": {
        "ADD_NODE_CLICK": "creating_node",
        "ADD_NODE_DBLCLICK": "creating_node",
        "SELECT_NODE_CLICK": "selected",
        "START_DRAG": "dragging",
        "ADD_EDGE_CLICK": "adding_edge",
        "RANDOM_CLICK": "randomizing",
        "CLEAR_CLICK": "confirm_clear",
        "EXPORT_CLICK": "exporting",
        "TOGGLE_HELP": "help_visible",
        "RESIZE": "idle"
      }
    },
    {
      "name": "creating_node",
      "description": "Transient: creating a node at an indicated position or center",
      "onEnter": "createNodeAt(x,y) or create centered node; refreshSelects(); updateEdgesVisual(); renderAdjList(selectedNodeId); liveRegion update",
      "on": {
        "CREATE_COMPLETE": "idle",
        "CREATE_COMPLETE_WITH_SELECTION": "selected"
      }
    },
    {
      "name": "selected",
      "description": "A node is selected / highlighted (via click or keyboard focus)",
      "onEnter": "selectNode(nodeId) — highlight node, renderAdjList(nodeId), update live region",
      "onExit": "clearSelection() — remove highlight, renderAdjList(null)",
      "on": {
        "CLEAR_SELECTION": "idle",
        "CLICK_CANVAS": "idle",
        "START_DRAG": "dragging",
        "ADD_EDGE_CLICK": "adding_edge",
        "EDGE_CLICK_REMOVE": "removing_edge",
        "KEY_NUDGE": "selected",
        "TOGGLE_HELP": "help_visible",
        "RANDOM_CLICK": "randomizing",
        "CLEAR_CLICK": "confirm_clear",
        "EXPORT_CLICK": "exporting",
        "BLUR_NODE": "idle"
      }
    },
    {
      "name": "dragging",
      "description": "Pointer-driven drag of a node is active",
      "onEnter": "startDrag(node) — setPointerCapture, remove transitions, bring node to front",
      "onExit": "endDrag(node) — release pointer, restore transition/z-index, updateEdgesVisual(), renderAdjList(selectedNodeId)",
      "on": {
        "MOVE_DRAG": "dragging",
        "END_DRAG": "selected",
        "DRAG_CANCEL": "idle",
        "RESIZE": "dragging"
      }
    },
    {
      "name": "adding_edge",
      "description": "User requested to add an edge (via selects + button)",
      "onEnter": "addEdge(fromId,toId,directed, animate=true) — create SVG line with 'new' class, update edges list, updateStatus(), renderAdjList(selectedNodeId), liveRegion update",
      "onExit": "none",
      "on": {
        "EDGE_ADDED": "edge_animating",
        "EDGE_ADD_FAILED": "idle"
      }
    },
    {
      "name": "edge_animating",
      "description": "New edge visual animation playing (CSS 'drawEdge')",
      "onEnter": "CSS animation runs (line has 'new' class). Optional timer ~420ms. updateEdgesVisual()",
      "onExit": "remove 'new' class (implicit) if desired",
      "on": {
        "EDGE_ANIMATION_END": "idle",
        "EDGE_CLICK_REMOVE": "removing_edge"
      }
    },
    {
      "name": "removing_edge",
      "description": "Transient: removing an edge after user clicked an edge",
      "onEnter": "removeEdge(edgeId) — remove from edges array and DOM, updateStatus(), renderAdjList(selectedNodeId), liveRegion update",
      "on": {
        "REMOVE_COMPLETE": "idle"
      }
    },
    {
      "name": "randomizing",
      "description": "Transient: build a small random graph (clears existing then adds nodes/edges)",
      "onEnter": "randomGraph() — clearAll(); create N nodes; add random edges; updateStatus(); renderAdjList(); liveRegion update",
      "on": {
        "RANDOM_COMPLETE": "idle"
      }
    },
    {
      "name": "confirm_clear",
      "description": "Waiting for user confirmation to clear all nodes/edges (browser confirm dialog)",
      "onEnter": "present confirm() dialog",
      "on": {
        "CONFIRM_CLEAR": "clearing",
        "CANCEL_CLEAR": "idle"
      }
    },
    {
      "name": "clearing",
      "description": "Clearing all nodes and edges from the graph",
      "onEnter": "clearAll() — remove DOM nodes/edges, reset idCounter, selectedNodeId, updateStatus(), renderAdjList(), refreshSelects(), liveRegion update",
      "on": {
        "CLEAR_COMPLETE": "empty"
      }
    },
    {
      "name": "exporting",
      "description": "Transient: export adjacency map as JSON (alerts JSON)",
      "onEnter": "exportAdjacency() — buildAdjacency(), translate ids to labels, alert(JSON)",
      "on": {
        "EXPORT_DONE": "idle",
        "EXPORT_DONE_FROM_EMPTY": "empty"
      }
    },
    {
      "name": "help_visible",
      "description": "Help/explain box is toggled visible",
      "onEnter": "show explainBox (explainBox.style.display='block')",
      "onExit": "hide explainBox (explainBox.style.display='none')",
      "on": {
        "TOGGLE_HELP": "idle",
        "CLOSE_HELP": "idle"
      }
    }
  ],
  "events": [
    "LOAD_COMPLETE",
    "NO_NODES",
    "ADD_NODE_CLICK",
    "ADD_NODE_DBLCLICK",
    "CREATING_NODE",
    "CREATE_COMPLETE",
    "CREATE_COMPLETE_WITH_SELECTION",
    "SELECT_NODE_CLICK",
    "CLICK_CANVAS",
    "CLEAR_SELECTION",
    "START_DRAG",
    "MOVE_DRAG",
    "END_DRAG",
    "DRAG_CANCEL",
    "KEY_NUDGE",
    "ADD_EDGE_CLICK",
    "EDGE_ADDED",
    "EDGE_ADD_FAILED",
    "EDGE_ANIMATION_END",
    "EDGE_CLICK_REMOVE",
    "REMOVE_COMPLETE",
    "RANDOM_CLICK",
    "RANDOM_COMPLETE",
    "CLEAR_CLICK",
    "CONFIRM_CLEAR",
    "CANCEL_CLEAR",
    "CLEAR_COMPLETE",
    "EXPORT_CLICK",
    "EXPORT_DONE",
    "TOGGLE_HELP",
    "CLOSE_HELP",
    "RESIZE",
    "BLUR_NODE",
    "LOAD_INIT"
  ],
  "notes": "This FSM models the high-level interactive flows in the provided module. Implementation-specific actions referenced in onEnter/onExit map to functions in the script: init(), createNodeAt(), selectNode(), makeDraggable()/startDrag(), setNodePosition(), addEdge(), removeEdge(), randomGraph(), clearAll(), exportAdjacency(), updateEdgesVisual(), renderAdjList(), refreshSelects(), and liveRegion updates. Edge creation triggers a CSS animation (~420ms) by adding the 'new' class; an EDGE_ANIMATION_END event is implied after that duration. The help/explain panel is modeled as a toggle state; in the real UI it acts as a non-blocking overlay and does not prevent other effects (here simplified). Confirmation for clear uses the synchronous browser confirm() and drives CONFIRM_CLEAR/CANCEL_CLEAR transitions. Resizing updates edge visuals but otherwise leaves the state unchanged."
}