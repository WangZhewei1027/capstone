{
  "topic": "Interactive Sets Application",
  "description": "Models the interactive behaviors of a web app that allows adding, removing, dragging/dropping, shuffling and comparing two sets (Set A and Set B). Captures user actions, animation-driven transitions, duplicate handling and equality-check feedback.",
  "states": [
    {
      "name": "preloading",
      "onEnter": "preloadTokens",
      "onExit": "announcePreloadComplete",
      "on": {
        "PRELOAD_COMPLETE": "idle"
      }
    },
    {
      "name": "idle",
      "onEnter": "clearTransientVisuals",
      "on": {
        "CLICK_ADD": "adding",
        "ENTER_KEY_ADD": "adding",
        "DOUBLE_CLICK_TOKEN": "adding_duplicate_attempt",
        "CLICK_REMOVE": "removing",
        "KEY_REMOVE": "removing",
        "DRAG_START": "dragging",
        "FOCUS_ZONE": "zone_focused_by_keyboard",
        "CLICK_SHUFFLE_A": "shuffling",
        "CLICK_SHUFFLE_B": "shuffling",
        "CLICK_CHECK": "checking",
        "CLICK_CLEAR": "clearing",
        "DROP_ON_ZONE": "drop_handling"
      }
    },
    {
      "name": "adding",
      "onEnter": "addToken",
      "onExit": "updateCounts",
      "on": {
        "ADD_SUCCEEDED": "idle",
        "ADD_DUPLICATE": "adding_duplicate_handled",
        "ADD_INVALID": "idle"
      }
    },
    {
      "name": "adding_duplicate_attempt",
      "onEnter": "addToken (duplicate path)",
      "on": {
        "ADD_DUPLICATE": "adding_duplicate_handled",
        "ADD_SUCCEEDED": "idle"
      }
    },
    {
      "name": "adding_duplicate_handled",
      "onEnter": "pulseExistingAndAnnounceDuplicate",
      "on": {
        "DUPLICATE_ANIM_DONE": "idle",
        "ACK": "idle"
      }
    },
    {
      "name": "removing",
      "onEnter": "removeTokenByElement",
      "onExit": "updateCounts",
      "on": {
        "REMOVED": "idle"
      }
    },
    {
      "name": "dragging",
      "onEnter": "setDragFlag",
      "onExit": "clearDragFlag",
      "on": {
        "DRAG_OVER_ZONE": "drop_zone_focused",
        "DRAG_LEAVE_ZONE": "dragging",
        "DRAG_END": "idle",
        "DROP_ON_ZONE": "drop_handling",
        "DRAG_CANCEL": "idle"
      }
    },
    {
      "name": "drop_zone_focused",
      "onEnter": "addZoneFocusedVisual",
      "onExit": "removeZoneFocusedVisual",
      "on": {
        "DRAG_LEAVE_ZONE": "dragging",
        "DROP_ON_ZONE": "drop_handling",
        "DRAG_END": "idle"
      }
    },
    {
      "name": "drop_handling",
      "onEnter": "handleDrop",
      "onExit": "updateCounts",
      "on": {
        "DROP_MOVED": "idle",
        "DROP_DUPLICATE": "drop_duplicate_handled",
        "DROP_CREATED_NEW": "idle"
      }
    },
    {
      "name": "drop_duplicate_handled",
      "onEnter": "pulseExistingOnDropAndAnnounceDuplicate",
      "on": {
        "DROP_DUPLICATE_ANIM_DONE": "idle"
      }
    },
    {
      "name": "shuffling",
      "onEnter": "shuffleSet",
      "onExit": "updateCounts",
      "on": {
        "SHUFFLE_DONE": "idle"
      }
    },
    {
      "name": "checking",
      "onEnter": "checkEquality",
      "onExit": "clearComparisonVisuals",
      "on": {
        "CHECK_EQUAL": "equal_state",
        "CHECK_NOT_EQUAL": "not_equal_state"
      }
    },
    {
      "name": "equal_state",
      "onEnter": "highlightEqualAndPulseTokens",
      "onExit": "removeEqualHighlights",
      "on": {
        "EQUAL_ANIM_DONE": "idle",
        "ACK": "idle"
      }
    },
    {
      "name": "not_equal_state",
      "onEnter": "shakeDifferingTokensAndAnnounce",
      "onExit": "clearShakeVisuals",
      "on": {
        "NOT_EQUAL_ANIM_DONE": "idle",
        "ACK": "idle"
      }
    },
    {
      "name": "clearing",
      "onEnter": "clearBoth",
      "onExit": "updateCounts",
      "on": {
        "CLEAR_DONE": "idle"
      }
    },
    {
      "name": "zone_focused_by_keyboard",
      "onEnter": "addZoneFocusedVisual",
      "onExit": "removeZoneFocusedVisual",
      "on": {
        "BLUR_ZONE": "idle",
        "CLICK_REMOVE": "removing",
        "KEY_REMOVE": "removing",
        "DOUBLE_CLICK_TOKEN": "adding_duplicate_attempt"
      }
    }
  ],
  "events": [
    "PRELOAD_COMPLETE",
    "CLICK_ADD",
    "ENTER_KEY_ADD",
    "ADD_SUCCEEDED",
    "ADD_DUPLICATE",
    "ADD_INVALID",
    "DUPLICATE_ANIM_DONE",
    "DOUBLE_CLICK_TOKEN",
    "CLICK_REMOVE",
    "KEY_REMOVE",
    "REMOVED",
    "DRAG_START",
    "DRAG_OVER_ZONE",
    "DRAG_LEAVE_ZONE",
    "DROP_ON_ZONE",
    "DROP_MOVED",
    "DROP_DUPLICATE",
    "DROP_CREATED_NEW",
    "DROP_DUPLICATE_ANIM_DONE",
    "DRAG_END",
    "DRAG_CANCEL",
    "FOCUS_ZONE",
    "BLUR_ZONE",
    "CLICK_SHUFFLE_A",
    "CLICK_SHUFFLE_B",
    "SHUFFLE_DONE",
    "CLICK_CHECK",
    "CHECK_EQUAL",
    "CHECK_NOT_EQUAL",
    "EQUAL_ANIM_DONE",
    "NOT_EQUAL_ANIM_DONE",
    "CLICK_CLEAR",
    "CLEAR_DONE",
    "ACK"
  ],
  "notes": "State actions map to functions and visual behaviors found in the code. Important action mappings:\n- preloadTokens: adds example tokens (examplesA/examplesB) without announcements; triggers PRELOAD_COMPLETE.\n- addToken: performs validation, duplicate detection (ADD_DUPLICATE) or creation (ADD_SUCCEEDED). On duplicate it pulses existing token and announces an error.\n- removeTokenByElement: animates removal (220ms) then emits REMOVED and updates counts.\n- setDragFlag / clearDragFlag: set/clear dataset drag attribute and visual dragging state.\n- addZoneFocusedVisual / removeZoneFocusedVisual: toggle .focused class on a drop zone for dragover or keyboard focus.\n- handleDrop: when DROP_ON_ZONE occurs, if target already has value -> DROP_DUPLICATE; else if movedNode exists -> DROP_MOVED; else create new token -> DROP_CREATED_NEW.\n- pulseExistingOnDropAndAnnounceDuplicate / pulseExistingAndAnnounceDuplicate: apply 'pulse' and 'burst' animations (~520ms) and announce duplicate behavior.\n- shuffleSet: reorders tokens and applies small translateY animations; emits SHUFFLE_DONE.\n- checkEquality: compares sorted key arrays; emits CHECK_EQUAL or CHECK_NOT_EQUAL. CHECK_EQUAL leads to equal_state (equal highlight + pulsing tokens, ~1s), CHECK_NOT_EQUAL leads to not_equal_state (shake animations, ~520ms) and announces differences.\n- clearBoth: removes all tokens from DOM and model then emits CLEAR_DONE.\nAnimation/visual timing hints taken from code: fly-in 320–420ms, pulse/burst ~520–1000ms, removal 220ms, shuffle stagger ~320ms. All transient animation states return to idle after animations complete. \"ACK\" is a generic external acknowledgement event that can also return various transient states to idle (e.g., user reading message)."
}