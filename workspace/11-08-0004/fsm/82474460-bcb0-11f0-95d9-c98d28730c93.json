{
  "topic": "Floyd–Warshall Interactive Explorer",
  "description": "Models the interactive states of the Floyd–Warshall visualization app: graph editing (nodes/edges), inline editing, computing algorithm snapshots, stepping/autoplay through snapshots, path selection and animation.",
  "states": [
    {
      "name": "editing",
      "onEnter": "renderAll",
      "onExit": "",
      "on": {
        "CLICK_CANVAS_ADD_NODE": "editing",
        "START_DRAG_NODE": "dragging",
        "CLICK_NODE": "nodeSelected",
        "CLICK_EDGE_LABEL": "edgeEditing",
        "CLICK_MATRIX_CELL": "matrixEditing",
        "CLICK_COMPUTE": "computing",
        "CLEAR_SNAPSHOTS": "editing",
        "RESET_GRAPH": "editing",
        "RANDOM_GRAPH": "editing",
        "TOGGLE_UNDIRECTED": "editing"
      }
    },
    {
      "name": "nodeSelected",
      "onEnter": "selectNodeForEdge (sets selectedNodeForEdge, highlightNode)",
      "onExit": "clearNodeSelection (clear highlight, selectedNodeForEdge)",
      "on": {
        "CLICK_NODE_SAME": "editing",
        "CLICK_NODE_OTHER": "editing",
        "START_DRAG_NODE": "dragging",
        "CLICK_EDGE_LABEL": "edgeEditing",
        "CLICK_COMPUTE": "computing",
        "RESET_GRAPH": "editing",
        "RANDOM_GRAPH": "editing",
        "TOGGLE_UNDIRECTED": "nodeSelected"
      }
    },
    {
      "name": "dragging",
      "onEnter": "startDrag (nodePointerDown sets dragState and installs pointermove/pointerup)",
      "onExit": "endDrag (remove pointer listeners, clear dragState, renderAll)",
      "on": {
        "MOVE_DRAG_NODE": "dragging",
        "END_DRAG_NODE": "editing",
        "RESET_GRAPH": "editing",
        "RANDOM_GRAPH": "editing"
      }
    },
    {
      "name": "edgeEditing",
      "onEnter": "openEdgeEditor (showEdgeWeightEditor, create foreignObject input)",
      "onExit": "cleanupEdgeEditor (remove overlay)",
      "on": {
        "EDGE_EDITOR_APPLY": "editing",
        "EDGE_EDITOR_CANCEL": "editing",
        "RESET_GRAPH": "editing",
        "RANDOM_GRAPH": "editing",
        "TOGGLE_UNDIRECTED": "edgeEditing"
      }
    },
    {
      "name": "matrixEditing",
      "onEnter": "openMatrixEditor (editMatrixCell prompt)",
      "onExit": "cleanupMatrixEditor",
      "on": {
        "MATRIX_EDIT_APPLY": "editing",
        "MATRIX_EDIT_CANCEL": "editing",
        "RESET_GRAPH": "editing",
        "RANDOM_GRAPH": "editing",
        "TOGGLE_UNDIRECTED": "matrixEditing"
      }
    },
    {
      "name": "computing",
      "onEnter": "computeSnapshots (runs Floyd–Warshall, fills currentSnapshots, set currentK=0, renderSnapshot)",
      "onExit": "",
      "on": {
        "COMPUTE_DONE": "snapshots",
        "COMPUTE_ERROR": "editing",
        "RESET_GRAPH": "editing",
        "RANDOM_GRAPH": "editing"
      }
    },
    {
      "name": "snapshots",
      "onEnter": "renderSnapshot(currentK) ; updateStepInfo",
      "onExit": "",
      "on": {
        "STEP_FORWARD": "snapshots",
        "STEP_BACK": "snapshots",
        "GOTO_K": "snapshots",
        "PLAY_TOGGLE_START": "playing",
        "CLICK_SHOW_PATH": "pathSelecting",
        "CLEAR_SNAPSHOTS": "editing",
        "RESET_GRAPH": "editing",
        "RANDOM_GRAPH": "editing",
        "CLICK_NODE": "nodeSelected",
        "CLICK_EDGE_LABEL": "edgeEditing",
        "CLICK_MATRIX_CELL": "matrixEditing"
      }
    },
    {
      "name": "playing",
      "onEnter": "startPlayTimer (startPlayTimer, set playing=true, btn text->Pause)",
      "onExit": "stopPlayTimer (clearInterval, set playing=false, btn text->Auto Play)",
      "on": {
        "TIMER_TICK": "playing",
        "TIMER_STEP": "snapshots",
        "PLAY_TOGGLE_STOP": "snapshots",
        "SPEED_CHANGE": "playing",
        "REACHED_END": "snapshots",
        "RESET_GRAPH": "editing",
        "RANDOM_GRAPH": "editing",
        "CLEAR_SNAPSHOTS": "editing"
      }
    },
    {
      "name": "pathSelecting",
      "onEnter": "activatePathSelection (set awaitingPathSelection = true, awaitingStartNode = null, alert user)",
      "onExit": "clearPathSelectionState (awaitingPathSelection=false, awaitingStartNode=null)",
      "on": {
        "PATH_SRC_SELECTED": "pathSelectingDest",
        "CANCEL_PATH_SELECTION": "snapshots",
        "RESET_GRAPH": "editing",
        "RANDOM_GRAPH": "editing"
      }
    },
    {
      "name": "pathSelectingDest",
      "onEnter": "recordPathSource (awaitingStartNode set, highlight source node)",
      "onExit": "clearPathSourceHighlight",
      "on": {
        "PATH_DST_SELECTED": "pathAnimating",
        "CANCEL_PATH_SELECTION": "snapshots",
        "RESET_GRAPH": "editing",
        "RANDOM_GRAPH": "editing"
      }
    },
    {
      "name": "pathAnimating",
      "onEnter": "showPath (reconstruct path using currentSnapshots[currentK].next) ; animatePathEdges (animate path highlights on SVG)",
      "onExit": "clearPathHighlights (remove path-highlight classes, remove temporary node highlights)",
      "on": {
        "PATH_ANIMATION_DONE": "snapshots",
        "RESET_GRAPH": "editing",
        "RANDOM_GRAPH": "editing"
      }
    }
  ],
  "events": [
    "CLICK_CANVAS_ADD_NODE",
    "START_DRAG_NODE",
    "MOVE_DRAG_NODE",
    "END_DRAG_NODE",
    "CLICK_NODE",
    "CLICK_NODE_SAME",
    "CLICK_NODE_OTHER",
    "CLICK_EDGE_LABEL",
    "EDGE_EDITOR_APPLY",
    "EDGE_EDITOR_CANCEL",
    "CLICK_MATRIX_CELL",
    "MATRIX_EDIT_APPLY",
    "MATRIX_EDIT_CANCEL",
    "CLICK_COMPUTE",
    "COMPUTE_DONE",
    "COMPUTE_ERROR",
    "STEP_FORWARD",
    "STEP_BACK",
    "GOTO_K",
    "PLAY_TOGGLE_START",
    "PLAY_TOGGLE_STOP",
    "TIMER_TICK",
    "TIMER_STEP",
    "SPEED_CHANGE",
    "REACHED_END",
    "CLICK_SHOW_PATH",
    "PATH_SRC_SELECTED",
    "PATH_DST_SELECTED",
    "PATH_ANIMATION_DONE",
    "CANCEL_PATH_SELECTION",
    "CLEAR_SNAPSHOTS",
    "RESET_GRAPH",
    "RANDOM_GRAPH",
    "TOGGLE_UNDIRECTED"
  ],
  "notes": "State names map to UI modes in the code. Key onEnter/onExit actions reference the functions implemented in the script: addNode (canvas click), nodePointerDown/nodePointerMove/nodePointerUp (dragging), showEdgeWeightEditor (edgeEditing), editMatrixCell (matrixEditing), computeSnapshots (computing), renderSnapshot/updateStepInfo/renderMatricesPreview (snapshots), startPlayTimer/stopPlayTimer (playing), activatePathSelection/handlePathNodeSelection/showPath/animatePathEdges (path selection and animation). Many UI actions (prompt/alert) are blocking in the code (synchronous); those are represented as transitions that return to the editing or snapshots state after the prompt resolves. When snapshots are computed currentSnapshots is populated and stepping/play operate on currentK. Clearing the graph or editing weights clears snapshots (clearSnapshots) and returns to editing mode."
}