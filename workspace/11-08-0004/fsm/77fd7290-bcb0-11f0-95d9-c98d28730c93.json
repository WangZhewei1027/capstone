{
  "topic": "Priority Queue Visualizer (Interactive Heap)",
  "description": "Models the interactive states and transitions for a binary-heap (priority queue) visualizer web app (insert, extract, peek, clear, randomize, edit node priority, toggle min/max). Captures user actions, prompt/confirm flows, heap rebuilds, and animated bubble-up / bubble-down sequences.",
  "states": [
    {
      "name": "initialize",
      "onEnter": "initializeModule (render, log 'Module loaded â€” ready', randomize example)",
      "on": {
        "ACTION_COMPLETE": "idle"
      }
    },
    {
      "name": "idle",
      "onEnter": "render (update tree, array, top badge)",
      "on": {
        "INSERT_CLICK": "inserting",
        "EXTRACT_CLICK": "extracting",
        "PEEK_CLICK": "peeking",
        "CLEAR_CLICK": "clearing_confirm",
        "RANDOMIZE_CLICK": "randomize_prompt",
        "NODE_CLICK": "editing_prompt",
        "HEAP_TYPE_CHANGE": "rebuilding",
        "HINT_CLICK": "hinting",
        "MODULE_LOAD": "initialize",
        "PRIORITY_ENTER_KEY": "inserting"
      }
    },
    {
      "name": "inserting",
      "onEnter": "doInsert (validate inputs, push element, render, add 'new' pop class, log insertion, then invoke bubbleUp)",
      "onExit": "",
      "on": {
        "BUBBLE_UP_START": "bubbling_up",
        "ACTION_COMPLETE": "idle"
      }
    },
    {
      "name": "extracting",
      "onEnter": "doExtract (if heap empty: log and emit ACTION_COMPLETE; else remove root, replace with last, render, log, then invoke bubbleDown if heap not empty)",
      "on": {
        "BUBBLE_DOWN_START": "bubbling_down",
        "ACTION_COMPLETE": "idle"
      }
    },
    {
      "name": "peeking",
      "onEnter": "doPeek (log top or empty)",
      "on": {
        "ACTION_COMPLETE": "idle"
      }
    },
    {
      "name": "clearing_confirm",
      "onEnter": "showClearConfirm (window.confirm dialog)",
      "on": {
        "CLEAR_CONFIRM": "clearing",
        "CLEAR_CANCEL": "idle"
      }
    },
    {
      "name": "clearing",
      "onEnter": "doClear (if not animating: empty heap, reset idCounter, render, log 'Cleared heap'; if animating: no-op)",
      "on": {
        "ACTION_COMPLETE": "idle"
      }
    },
    {
      "name": "randomize_prompt",
      "onEnter": "showRandomizePrompt (prompt for count)",
      "on": {
        "RANDOMIZE_SUBMIT": "randomizing",
        "RANDOMIZE_CANCEL": "idle"
      }
    },
    {
      "name": "randomizing",
      "onEnter": "randomize(n) (generate items, heapify synchronously, render, log)",
      "on": {
        "ACTION_COMPLETE": "idle"
      }
    },
    {
      "name": "editing_prompt",
      "onEnter": "editNodePriorityPrompt (prompt for new numeric priority for clicked node)",
      "on": {
        "EDIT_PROMPT_SUBMIT": "evaluate_edit",
        "EDIT_PROMPT_CANCEL": "idle"
      }
    },
    {
      "name": "evaluate_edit",
      "onEnter": "applyNewPriorityAndRender (update priority, render, log; decide direction based on old/new and heap type and then either start bubble-up, start bubble-down, or complete immediately)",
      "on": {
        "BUBBLE_UP_START": "bubbling_up",
        "BUBBLE_DOWN_START": "bubbling_down",
        "ACTION_COMPLETE": "idle"
      }
    },
    {
      "name": "bubbling_up",
      "onEnter": "bubbleUp (set animInProgress=true, perform swaps with render + waits to animate each swap)",
      "onExit": "set animInProgress=false",
      "on": {
        "BUBBLE_UP_DONE": "idle"
      }
    },
    {
      "name": "bubbling_down",
      "onEnter": "bubbleDown (set animInProgress=true, perform swaps with render + waits to animate each swap)",
      "onExit": "set animInProgress=false",
      "on": {
        "BUBBLE_DOWN_DONE": "idle"
      }
    },
    {
      "name": "rebuilding",
      "onEnter": "rebuildHeap (on heap type change: run synchronous heapify loop, render, log 'Switched heap type')",
      "on": {
        "ACTION_COMPLETE": "idle"
      }
    },
    {
      "name": "hinting",
      "onEnter": "showHint (alert explaining how the heap operations work)",
      "on": {
        "ACTION_COMPLETE": "idle"
      }
    }
  ],
  "events": [
    "MODULE_LOAD",
    "INSERT_CLICK",
    "EXTRACT_CLICK",
    "PEEK_CLICK",
    "CLEAR_CLICK",
    "CLEAR_CONFIRM",
    "CLEAR_CANCEL",
    "RANDOMIZE_CLICK",
    "RANDOMIZE_SUBMIT",
    "RANDOMIZE_CANCEL",
    "NODE_CLICK",
    "EDIT_PROMPT_SUBMIT",
    "EDIT_PROMPT_CANCEL",
    "HEAP_TYPE_CHANGE",
    "HINT_CLICK",
    "PRIORITY_ENTER_KEY",
    "BUBBLE_UP_START",
    "BUBBLE_UP_DONE",
    "BUBBLE_DOWN_START",
    "BUBBLE_DOWN_DONE",
    "ACTION_COMPLETE"
  ],
  "notes": "Important behavioral notes: - The implementation uses a single animInProgress flag to block starting new interactive actions while bubbleUp/bubbleDown animations run. bubbleUp and bubbleDown set animInProgress=true on start and false on completion; they animate by swapping and waiting (~420ms) between swaps. - Insert always appends and then invokes bubbleUp (so insertion flows into a bubbling_up animation state). - Extract replaces root with last element and, if the heap is non-empty afterward, invokes bubbleDown. - Editing a node opens a modal prompt; after applying a numeric change, the code decides whether to bubble up or down depending on heap type and old/new priorities. - Randomize and heap-type change run synchronous heapify (rebuild) operations (no animated intermediate swaps) then render. - Clear and other prompts/alerts use browser confirm/prompt/alert (modal, synchronous) in the code; those are modeled as prompt/confirm states here (CLEAR_CONFIRM, RANDOMIZE_PROMPT, EDIT_PROMPT). - Events like BUBBLE_UP_DONE / BUBBLE_DOWN_DONE and ACTION_COMPLETE represent internal completion notifications (used to transition back to idle)."
}