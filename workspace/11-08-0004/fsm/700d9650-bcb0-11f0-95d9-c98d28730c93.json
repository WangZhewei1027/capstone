{
  "topic": "Merge Sort Interactive Module",
  "description": "Models the interactive states and transitions of the Merge Sort visualization: array setup, recording algorithm actions, stepping/playing through actions, animating comparisons/merges, dragging to reorder initial array, and UI toggles.",
  "states": [
    {
      "name": "idle",
      "onEnter": "setIdleUI",
      "onExit": "clearIdleUI",
      "on": {
        "RANDOMIZE": "idle",
        "APPLY": "idle",
        "CLEAR_INPUT": "idle",
        "SIZE_CHANGE": "idle",
        "SPEED_CHANGE": "idle",
        "TOGGLE_LOG": "idle",
        "TOGGLE_RECURSION": "idle",
        "DRAG_START": "dragging",
        "START": "playing",
        "STEP": "executing",
        "RESET": "idle"
      }
    },
    {
      "name": "dragging",
      "onEnter": "beginDrag (set dragging=true; add dragging class; capture pointer)",
      "onExit": "endDrag (release pointer; snapping; createBars; clearActions)",
      "on": {
        "DRAG_MOVE": "dragging",
        "DRAG_END": "idle",
        "DRAG_CANCEL": "idle",
        "RANDOMIZE": "idle",
        "APPLY": "idle",
        "RESET": "idle",
        "START": "dragging",
        "STEP": "dragging"
      }
    },
    {
      "name": "playing",
      "onEnter": "recordIfNeededAndStartPlayback (if actions empty -> recordMergeSort; set playing=true; call step())",
      "onExit": "stopPlayback (clear timer; set playing=false)",
      "on": {
        "PAUSE": "paused",
        "STEP_TRIGGER": "executing",
        "ACTION_COMPLETE": "playing",
        "ACTIONS_FINISHED": "done",
        "RANDOMIZE": "idle",
        "APPLY": "idle",
        "RESET": "idle",
        "TOGGLE_LOG": "playing",
        "TOGGLE_RECURSION": "playing"
      }
    },
    {
      "name": "paused",
      "onEnter": "setPausedUI (set actionBox to 'Paused' and stop timer)",
      "onExit": "clearPausedUI",
      "on": {
        "START": "playing",
        "TOGGLE_PLAY": "playing",
        "STEP": "executing",
        "RANDOMIZE": "idle",
        "APPLY": "idle",
        "RESET": "idle",
        "TOGGLE_LOG": "paused",
        "TOGGLE_RECURSION": "paused"
      }
    },
    {
      "name": "executing",
      "onEnter": "performCurrentAction (performAction(actions[actionIndex]); set actionBox; highlight pseudocode; run animations)",
      "onExit": "postActionUpdate (increment actionIndex; clear transient highlights)",
      "on": {
        "ACTION_PERFORMED": "playing",
        "ACTION_PERFORMED_PAUSED": "paused",
        "ACTIONS_FINISHED": "done",
        "RANDOMIZE": "idle",
        "APPLY": "idle",
        "RESET": "idle"
      }
    },
    {
      "name": "done",
      "onEnter": "setDoneUI (set actionBox to 'Done'; playing=false)",
      "onExit": "clearDoneUI",
      "on": {
        "RESET": "idle",
        "RANDOMIZE": "idle",
        "APPLY": "idle",
        "START": "done",
        "TOGGLE_LOG": "done",
        "TOGGLE_RECURSION": "done"
      }
    }
  ],
  "events": [
    "RANDOMIZE",
    "START",
    "PAUSE",
    "STEP",
    "STEP_TRIGGER",
    "RESET",
    "APPLY",
    "CLEAR_INPUT",
    "TOGGLE_LOG",
    "TOGGLE_RECURSION",
    "SPEED_CHANGE",
    "SIZE_CHANGE",
    "DRAG_START",
    "DRAG_MOVE",
    "DRAG_END",
    "DRAG_CANCEL",
    "ACTION_PERFORMED",
    "ACTION_COMPLETE",
    "ACTIONS_FINISHED",
    "ACTIONS_RECORDED",
    "ACTION_PERFORMED_PAUSED",
    "TOGGLE_PLAY",
    "KEY_PLAY_PAUSE",
    "KEY_STEP_FORWARD",
    "KEY_STEP_BACKWARD",
    "WINDOW_RESIZE"
  ],
  "notes": "States model the major interactive modes: idle (array ready), dragging to reorder the initial array, playing (automatic playback), paused (playback stopped), executing (a single action being animated), and done (playback reached the end). OnEnter/OnExit actions are high-level names mapping to the JavaScript behaviors: renderArray/createBars, clearActions, recordMergeSort (synchronous generation of actions array), performAction (handles 'range', 'compare', 'take', 'overwrite' action types and associated animations), startPlayback/stopPlayback (timer management), and UI updates (actionBox text, pseudocode highlights, log entries). Some transitions are triggered internally by the playback engine (STEP_TRIGGER -> executing, ACTION_COMPLETE/ACTION_PERFORMED -> playing/paused), and the code prevents starting playback while dragging. Backward stepping is not supported; prev-step attempts only log a message. Window resize triggers re-layout (WINDOW_RESIZE handled while in idle/dragging to recompute bar widths). The FSM intentionally abstracts implementation details (e.g., animation promises) into named onEnter/onExit actions."
}