{
  "topic": "Interactive Venn Diagram (Set Operations)",
  "description": "Models the interactive states of a draggable-token Venn diagram application that supports creating/removing tokens, dragging, keyboard nudging, selecting set operations (union, intersection, difference, etc.), randomizing/resetting tokens, animating results, and simple explanatory UI.",
  "states": [
    {
      "name": "idle",
      "onEnter": "enterIdle (updateCircles, highlight current operation, set status 'Drag tokens into regions')",
      "onExit": "exitIdle (none)",
      "on": {
        "POINTER_DOWN": "dragging",
        "TOKEN_FOCUS": "focused",
        "ADD_TOKEN": "creating_token",
        "RANDOMIZE": "shuffling",
        "RESET": "seeding",
        "SHOW_RESULT": "animating_result",
        "SHOW_RESULT_EMPTY": "idle",
        "EXPLAIN": "explaining",
        "TOGGLE_LABELS": "idle",
        "OP_SELECT": "idle",
        "WINDOW_RESIZE": "idle",
        "LOAD": "idle"
      }
    },
    {
      "name": "dragging",
      "onEnter": "startDrag (pointer capture, set isDragging=true, disable element transition, set cursor grabbing)",
      "onExit": "endDrag (release pointer capture, set isDragging=false, restore transitions, set cursor grab, updateCounts, refresh highlight)",
      "on": {
        "POINTER_MOVE": "dragging",
        "POINTER_UP": "idle",
        "DRAG_END": "idle",
        "TOKEN_FOCUS": "focused"
      }
    },
    {
      "name": "focused",
      "onEnter": "enterFocused (show focusedToken pill with label)",
      "onExit": "exitFocused (hide focusedToken pill)",
      "on": {
        "KEY_NUDGE": "focused",
        "KEY_DELETE": "idle",
        "TOKEN_BLUR": "idle",
        "POINTER_DOWN": "dragging",
        "OP_SELECT": "focused"
      }
    },
    {
      "name": "creating_token",
      "onEnter": "createToken (synchronously create DOM token, set label/color/position, attach pointer & keyboard handlers, updateCounts, highlight)",
      "onExit": "none",
      "on": {
        "CREATE_DONE": "idle",
        "OP_SELECT": "creating_token"
      }
    },
    {
      "name": "shuffling",
      "onEnter": "shuffleTokens (set random positions for all tokens, updateCounts, refresh highlight)",
      "onExit": "none",
      "on": {
        "SHUFFLE_DONE": "idle",
        "OP_SELECT": "shuffling"
      }
    },
    {
      "name": "seeding",
      "onEnter": "seedTokens (remove existing tokens, create initial tokens, place some in overlap, updateCounts, refresh highlight)",
      "onExit": "none",
      "on": {
        "SEED_DONE": "idle",
        "OP_SELECT": "seeding"
      }
    },
    {
      "name": "animating_result",
      "onEnter": "animateResult (compute members for current operation, if none raise SHOW_RESULT_EMPTY, otherwise set status 'Animating result...' and run per-token animation sequence)",
      "onExit": "finishResult (clear temporary transforms, set status to 'Result: <labels>')",
      "on": {
        "SHOW_RESULT_DONE": "idle",
        "OP_SELECT": "animating_result"
      }
    },
    {
      "name": "explaining",
      "onEnter": "showExplain (blocking alert with explanation of membership rules)",
      "onExit": "none",
      "on": {
        "EXPLAIN_DONE": "idle",
        "OP_SELECT": "explaining"
      }
    }
  ],
  "events": [
    "LOAD",
    "WINDOW_RESIZE",
    "POINTER_DOWN",
    "POINTER_MOVE",
    "POINTER_UP",
    "DRAG_END",
    "DRAG_CANCEL",
    "TOKEN_FOCUS",
    "TOKEN_BLUR",
    "KEY_NUDGE",
    "KEY_DELETE",
    "ADD_TOKEN",
    "CREATE_DONE",
    "RANDOMIZE",
    "SHUFFLE_DONE",
    "RESET",
    "SEED_DONE",
    "SHOW_RESULT",
    "SHOW_RESULT_EMPTY",
    "SHOW_RESULT_DONE",
    "EXPLAIN",
    "EXPLAIN_DONE",
    "TOGGLE_LABELS",
    "OP_SELECT"
  ],
  "notes": "Implementation notes and mappings to app behavior:\n- Operation selection (currentOp: 'members'|'union'|'intersection'|'AdiffB'|'BdiffA'|'symdiff') is treated as application state (mutating highlight and membership test) but modeled here as events that do not necessarily change the top-level interaction state (they are handled as self-transitions in many states).\n- Dragging and pointer capture are token-local in the code; this FSM models a generic global 'dragging' state that is entered on a token pointer-down and exited on pointer-up.\n- Keyboard interactions (focus, arrow nudges, Delete/Backspace to remove) are handled via the 'focused' state. Arrow nudges are KEY_NUDGE events; Delete/Backspace dispatch KEY_DELETE which removes the token and returns to idle.\n- SHOW_RESULT event is split into SHOW_RESULT (non-empty result path) and SHOW_RESULT_EMPTY (empty set path) to reflect the code branching: the app shows 'âˆ…' for empty results and otherwise enters an animation sequence. After the animation completes the SHOW_RESULT_DONE event transitions back to idle and sets a status summary.\n- Creating, shuffling and seeding are modeled as transient states ('creating_token','shuffling','seeding') that perform synchronous DOM operations and then return to idle (CREATE_DONE/SHUFFLE_DONE/SEED_DONE). In the actual code those operations run synchronously (or immediately schedule transitions via timeouts); the FSM exposes the lifecycle explicitly.\n- The 'explaining' state corresponds to the user-triggered alert; it's a blocking UI action in the implementation, modeled as onEnter showExplain followed by EXPLAIN_DONE returning to idle.\n- Periodic background behavior (avoidOverlap interval, updateCounts interval) is not modeled as separate states but is considered part of the environment actions executed while in idle/dragging/focused states.\n- The 'idle' state's onEnter action represents the default UI setup (update circles, apply current highlights, set status text)."
}