{
  "topic": "K-Means Interactive Application",
  "description": "Finite state machine modeling the interactive K‑Means demo: point/centroid management, two-step iteration (assignment + centroid update), animations, play/pause, dragging and data generation.",
  "states": [
    {
      "name": "no_centroids",
      "onEnter": "draw; updateMetrics; updateStatus('Ready. Click canvas to add points. Drag centroids to initialize manually.')",
      "onExit": null,
      "on": {
        "INIT_CENTROIDS_CLICK": "waiting_for_assignment",
        "K_CHANGE": "waiting_for_assignment",
        "RANDOMIZE_POINTS_CLICK": "no_centroids",
        "GEN_UNIFORM_CLICK": "no_centroids",
        "GEN_CLUSTERED_CLICK": "no_centroids",
        "CLEAR_POINTS_CLICK": "no_centroids",
        "RESET_CLICK": "no_centroids",
        "POINTER_DOWN_ADD_POINT": "no_centroids"
      }
    },
    {
      "name": "waiting_for_assignment",
      "onEnter": "draw; updateMetrics",
      "onExit": null,
      "on": {
        "STEP_CLICK": "waiting_for_update",
        "SPACE_KEY": "waiting_for_update",
        "PLAY_CLICK": "playing",
        "PLAY_TOGGLE": "playing",
        "INIT_CENTROIDS_CLICK": "waiting_for_assignment",
        "K_CHANGE": "waiting_for_assignment",
        "RANDOMIZE_POINTS_CLICK": "waiting_for_assignment",
        "GEN_UNIFORM_CLICK": "waiting_for_assignment",
        "GEN_CLUSTERED_CLICK": "waiting_for_assignment",
        "CLEAR_POINTS_CLICK": "no_centroids",
        "RESET_CLICK": "no_centroids",
        "POINTER_DOWN_ON_CENTROID": "dragging_centroid",
        "POINTER_DOWN_ON_POINT": "dragging_point",
        "POINTER_DOWN_ADD_POINT": "waiting_for_assignment",
        "TOGGLE_SHOW_LINES": "waiting_for_assignment",
        "TOGGLE_DRAG_POINTS": "waiting_for_assignment",
        "SPEED_CHANGE": "waiting_for_assignment"
      }
    },
    {
      "name": "waiting_for_update",
      "onEnter": "assignPoints; updateStatus('Assigned points to nearest centroids. Press Step to update centroids.')",
      "onExit": null,
      "on": {
        "STEP_CLICK": "animating_update",
        "SPACE_KEY": "animating_update",
        "PLAY_CLICK": "playing",
        "PLAY_TOGGLE": "playing",
        "POINTER_DOWN_ON_CENTROID": "dragging_centroid",
        "POINTER_DOWN_ON_POINT": "dragging_point",
        "CLEAR_POINTS_CLICK": "no_centroids",
        "RESET_CLICK": "no_centroids"
      }
    },
    {
      "name": "animating_update",
      "onEnter": "updateCentroidsAnimated (on complete -> ANIMATION_END)",
      "onExit": null,
      "on": {
        "ANIMATION_END": "waiting_for_assignment",
        "PLAY_CLICK": "playing",
        "PLAY_TOGGLE": "playing",
        "POINTER_DOWN_ON_CENTROID": "dragging_centroid",
        "POINTER_DOWN_ON_POINT": "dragging_point",
        "CLEAR_POINTS_CLICK": "no_centroids",
        "RESET_CLICK": "no_centroids"
      }
    },
    {
      "name": "playing",
      "onEnter": "startPlaying (sets playing=true; updates UI text; runs assign+anim loop)",
      "onExit": "stopPlaying (clears timers; sets playing=false; updateStatus('Paused.'))",
      "on": {
        "PLAY_CLICK": "waiting_for_assignment",
        "PLAY_TOGGLE": "waiting_for_assignment",
        "P_KEY": "waiting_for_assignment",
        "PLAY_CONVERGED": "waiting_for_assignment",
        "POINTER_DOWN_ON_CENTROID": "dragging_centroid",
        "POINTER_DOWN_ON_POINT": "dragging_point",
        "CLEAR_POINTS_CLICK": "no_centroids",
        "RESET_CLICK": "no_centroids",
        "SPEED_CHANGE": "playing",
        "TOGGLE_SHOW_LINES": "playing",
        "TOGGLE_DRAG_POINTS": "playing"
      }
    },
    {
      "name": "dragging_point",
      "onEnter": "startDraggingPoint (set dragging={type:'point', index:...}; updateStatus('Dragging point'))",
      "onExit": "stopDragging (dragging=null; updateStatus('Drag ended.'); draw)",
      "on": {
        "POINTER_MOVE": "dragging_point",
        "POINTER_UP": "waiting_for_assignment",
        "CLEAR_POINTS_CLICK": "no_centroids",
        "RESET_CLICK": "no_centroids"
      }
    },
    {
      "name": "dragging_centroid",
      "onEnter": "startDraggingCentroid (set dragging={type:'centroid', index:...}; updateStatus('Dragging centroid n'))",
      "onExit": "stopDragging (dragging=null; updateStatus('Drag ended.'); draw)",
      "on": {
        "POINTER_MOVE": "dragging_centroid",
        "POINTER_UP": "waiting_for_assignment",
        "CLEAR_POINTS_CLICK": "no_centroids",
        "RESET_CLICK": "no_centroids"
      }
    }
  ],
  "events": [
    "INIT_CENTROIDS_CLICK",
    "RANDOMIZE_POINTS_CLICK",
    "CLEAR_POINTS_CLICK",
    "STEP_CLICK",
    "PLAY_CLICK",
    "PLAY_TOGGLE",
    "RESET_CLICK",
    "SPEED_CHANGE",
    "TOGGLE_SHOW_LINES",
    "TOGGLE_DRAG_POINTS",
    "GEN_CLUSTERED_CLICK",
    "GEN_UNIFORM_CLICK",
    "K_CHANGE",
    "POINTER_DOWN_ON_POINT",
    "POINTER_DOWN_ON_CENTROID",
    "POINTER_DOWN_ADD_POINT",
    "POINTER_MOVE",
    "POINTER_UP",
    "ANIMATION_END",
    "PLAY_CONVERGED",
    "SPACE_KEY",
    "P_KEY"
  ],
  "notes": "This FSM models the interactive control flow of the K‑Means demo. The demo internally maintains a 'stage' variable (either 'assign' or 'update') and a 'playing' boolean; this FSM represents those modes as explicit states: waiting_for_assignment (stage='assign'), waiting_for_update (stage='update' after an assignment), animating_update (centroid movement animation), and playing (automatic loop). Dragging is modeled as separate transient states (dragging_point, dragging_centroid) that return to waiting_for_assignment on release. Key actions referenced in onEnter/onExit map to the functions from the script: genRandomPoints, genClustered, initCentroidsRandom, assignPoints, updateCentroidsAnimated, startPlaying, stopPlaying, draw, updateMetrics, updateStatus, startDraggingPoint/startDraggingCentroid and stopDragging. Some interactions (e.g. pointer events during playing) are permitted in the app; for simplicity dragging returns to waiting_for_assignment after release. Convergence detection and internal play-loop scheduling are represented by PLAY_CONVERGED and the playing state's internal loop."
}