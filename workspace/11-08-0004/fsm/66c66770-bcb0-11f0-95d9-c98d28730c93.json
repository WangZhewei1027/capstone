{
  "topic": "Insertion Sort Interactive Module",
  "description": "Models the interactive states and transitions of a step-by-step insertion sort visualizer (controls: randomize, shuffle, apply, step, play/pause, fast-forward, stop, step-back; visual snapshots produced by a generator).",
  "states": [
    {
      "name": "idle",
      "onEnter": "renderSnapshot(0), updateStatus('Ready'), gen = null, playing = false, clearPlayTimer(), updatePlayButton()",
      "onExit": "",
      "on": {
        "RANDOMIZE": "idle",
        "SHUFFLE": "idle",
        "APPLY_ARRAY": "idle",
        "RESET_RANDOM": "idle",
        "STEP_FORWARD": "sorting",
        "STEP_BACK": "idle",
        "PLAY_TOGGLE": "playing",
        "PLAY_START": "playing",
        "FAST_FORWARD": "done",
        "STOP_RESET": "idle",
        "EDIT_ITEM": "idle",
        "RESIZE": "idle",
        "SPEED_CHANGE": "idle",
        "SIZE_CHANGE": "idle",
        "KEY_PLAY_TOGGLE": "playing",
        "KEY_STEP_FORWARD": "sorting",
        "KEY_STEP_BACK": "idle"
      }
    },
    {
      "name": "sorting",
      "onEnter": "ensureGenerator(), updateStatusFromSnapshot(currentSnapshot)",
      "onExit": "",
      "on": {
        "STEP_FORWARD": "sorting",
        "STEP_BACK": "sorting",
        "PLAY_TOGGLE": "playing",
        "PLAY_START": "playing",
        "FAST_FORWARD": "done",
        "STOP_RESET": "idle",
        "RANDOMIZE": "idle",
        "SHUFFLE": "idle",
        "APPLY_ARRAY": "idle",
        "RESET_RANDOM": "idle",
        "EDIT_ITEM": "idle",
        "RESIZE": "sorting",
        "SPEED_CHANGE": "sorting",
        "SIZE_CHANGE": "sorting",
        "KEY_PLAY_TOGGLE": "playing",
        "KEY_STEP_FORWARD": "sorting",
        "KEY_STEP_BACK": "sorting"
      }
    },
    {
      "name": "playing",
      "onEnter": "ensureGenerator(), startPlaying() (playing=true, updatePlayButton(), scheduleNextStep())",
      "onExit": "stopPlaying() (clearPlayTimer(), playing=false, updatePlayButton())",
      "on": {
        "PLAY_TOGGLE": "sorting",
        "PAUSE_PLAY": "sorting",
        "STEP_FORWARD": "sorting",
        "STEP_BACK": "sorting",
        "FAST_FORWARD": "done",
        "STOP_RESET": "idle",
        "RANDOMIZE": "idle",
        "SHUFFLE": "idle",
        "APPLY_ARRAY": "idle",
        "RESET_RANDOM": "idle",
        "EDIT_ITEM": "idle",
        "RESIZE": "playing",
        "SPEED_CHANGE": "playing",
        "SIZE_CHANGE": "playing",
        "KEY_PLAY_TOGGLE": "sorting",
        "KEY_STEP_FORWARD": "sorting",
        "KEY_STEP_BACK": "sorting"
      }
    },
    {
      "name": "done",
      "onEnter": "renderSnapshot(last), updateStatus('Sorted'), stopPlaying()",
      "onExit": "",
      "on": {
        "RANDOMIZE": "idle",
        "SHUFFLE": "idle",
        "APPLY_ARRAY": "idle",
        "RESET_RANDOM": "idle",
        "STEP_FORWARD": "done",
        "STEP_BACK": "sorting",
        "PLAY_TOGGLE": "playing",
        "FAST_FORWARD": "done",
        "STOP_RESET": "idle",
        "EDIT_ITEM": "idle",
        "RESIZE": "done",
        "SPEED_CHANGE": "done",
        "SIZE_CHANGE": "done",
        "KEY_PLAY_TOGGLE": "playing",
        "KEY_STEP_FORWARD": "done",
        "KEY_STEP_BACK": "sorting"
      }
    }
  ],
  "events": [
    "RANDOMIZE",
    "SHUFFLE",
    "APPLY_ARRAY",
    "RESET_RANDOM",
    "STEP_FORWARD",
    "STEP_BACK",
    "PLAY_TOGGLE",
    "PLAY_START",
    "PAUSE_PLAY",
    "FAST_FORWARD",
    "STOP_RESET",
    "SPEED_CHANGE",
    "SIZE_CHANGE",
    "EDIT_ITEM",
    "RESIZE",
    "KEY_PLAY_TOGGLE",
    "KEY_STEP_FORWARD",
    "KEY_STEP_BACK"
  ],
  "notes": "Implementation details captured: the UI maintains an array of items and a snapshots history. A generator (insertionSortGen) is created on demand (ensureGenerator) and yields fine-grained snapshots ('select','compare','shift','insert','done'). 'idle' represents a loaded initial array (Ready). 'sorting' means a generator exists and the user can step through snapshots (history navigation supported). 'playing' auto-advances using scheduleNextStep() (onEnter starts timer; onExit clears it). 'done' indicates the final snapshot (sorted). Actions invoked on transitions: applyNewArray()/buildInitialSnapshot()/renderSnapshot(), stepForward() (pulls next from generator and appends snapshot), stepBack() (render previous snapshot), startPlaying()/stopPlaying(), fastForward() (exhaust generator and render last snapshot). Controls such as speed and size adjust playback/display; editing a bar edits the underlying item and rebuilds the initial snapshot. Keyboard shortcuts map to PLAY_TOGGLE / STEP_FORWARD / STEP_BACK. The generator may be created while in idle or sorting; when exhausted transitions to done. The FSM abstracts transient UI rendering and animation details into onEnter/onExit and action names above."
}