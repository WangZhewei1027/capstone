{
  "topic": "Dijkstra Interactive Visualizer",
  "description": "Finite state machine modeling UI modes, user interactions, and the Dijkstra algorithm runtime (step / auto-run) for the interactive graph visualizer.",
  "states": [
    {
      "name": "idle",
      "onEnter": "setModeNone",
      "onExit": null,
      "on": {
        "ADD_NODE_PRESS": "add_node_mode",
        "CONNECT_PRESS": "connect_mode",
        "SET_START_PRESS": "set_start_mode",
        "DELETE_PRESS": "delete_mode",
        "START_DRAG": "dragging",
        "STEP_PRESS": "stepping",
        "PLAY_PRESS": "auto_running",
        "RESET_PRESS": "dijkstra_uninitialized",
        "CLEAR_PRESS": "idle",
        "KEY_SHORTCUT_A": "add_node_mode",
        "KEY_SHORTCUT_C": "connect_mode",
        "KEY_SHORTCUT_S": "set_start_mode",
        "KEY_SHORTCUT_D": "delete_mode",
        "KEY_SPACE": "auto_running",
        "KEY_ENTER": "stepping"
      }
    },
    {
      "name": "add_node_mode",
      "onEnter": "toggleMode('addNode')",
      "onExit": "setModeNone",
      "on": {
        "CLICK_CANVAS": "add_node_mode",
        "ADD_NODE_PRESS": "idle",
        "KEY_SHORTCUT_A": "idle"
      }
    },
    {
      "name": "connect_mode",
      "onEnter": "toggleMode('connect')",
      "onExit": "clearConnectSource",
      "on": {
        "NODE_CLICK": "connect_source_selected",
        "CONNECT_PRESS": "idle",
        "CANCEL_WEIGHT": "connect_mode",
        "CONFIRM_WEIGHT": "connect_mode",
        "KEY_SHORTCUT_C": "idle"
      }
    },
    {
      "name": "connect_source_selected",
      "onEnter": "setConnectSource(highlightNode)",
      "onExit": "clearConnectSource",
      "on": {
        "NODE_CLICK": "weight_popup",
        "NODE_CLICK_SAME": "connect_mode",
        "CONNECT_PRESS": "idle",
        "CANCEL_SELECTION": "connect_mode"
      }
    },
    {
      "name": "weight_popup",
      "onEnter": "showWeightPopup",
      "onExit": "hideWeightPopup",
      "on": {
        "CONFIRM_WEIGHT": "connect_mode",
        "CANCEL_WEIGHT": "connect_mode",
        "CONNECT_PRESS": "idle"
      }
    },
    {
      "name": "set_start_mode",
      "onEnter": "toggleMode('setStart')",
      "onExit": "setModeNone",
      "on": {
        "NODE_CLICK": "idle",
        "CLICK_CANVAS": "idle",
        "SET_START_PRESS": "idle",
        "KEY_SHORTCUT_S": "idle"
      }
    },
    {
      "name": "delete_mode",
      "onEnter": "toggleMode('delete')",
      "onExit": "setModeNone",
      "on": {
        "NODE_CLICK": "delete_mode",
        "DELETE_PRESS": "idle",
        "KEY_SHORTCUT_D": "idle"
      }
    },
    {
      "name": "dragging",
      "onEnter": "startDrag",
      "onExit": "endDrag",
      "on": {
        "END_DRAG": "idle",
        "WINDOW_RESIZE": "dragging"
      }
    },
    {
      "name": "dijkstra_uninitialized",
      "onEnter": "clearDijkstraState",
      "onExit": null,
      "on": {
        "INITIALIZE_DIJKSTRA": "dijkstra_initialized",
        "STEP_PRESS": "stepping",
        "PLAY_PRESS": "auto_running",
        "RESET_PRESS": "dijkstra_uninitialized",
        "CLEAR_PRESS": "idle"
      }
    },
    {
      "name": "dijkstra_initialized",
      "onEnter": "initializeDijkstra",
      "onExit": null,
      "on": {
        "STEP_PRESS": "stepping",
        "PLAY_PRESS": "auto_running",
        "RESET_PRESS": "dijkstra_uninitialized",
        "ALGORITHM_FINISHED": "dijkstra_finished"
      }
    },
    {
      "name": "stepping",
      "onEnter": "stepDijkstra",
      "onExit": null,
      "on": {
        "STEP_COMPLETE": "dijkstra_initialized",
        "ALGORITHM_FINISHED": "dijkstra_finished",
        "PLAY_PRESS": "auto_running"
      }
    },
    {
      "name": "auto_running",
      "onEnter": "startAuto",
      "onExit": "stopAuto",
      "on": {
        "PAUSE_PRESS": "dijkstra_initialized",
        "STOP_AUTO": "dijkstra_initialized",
        "ALGORITHM_FINISHED": "dijkstra_finished",
        "RESET_PRESS": "dijkstra_uninitialized",
        "CLEAR_PRESS": "idle"
      }
    },
    {
      "name": "dijkstra_finished",
      "onEnter": "finalizeAlgorithm",
      "onExit": null,
      "on": {
        "RESET_PRESS": "dijkstra_uninitialized",
        "CLEAR_PRESS": "idle"
      }
    }
  ],
  "events": [
    "ADD_NODE_PRESS",
    "CONNECT_PRESS",
    "SET_START_PRESS",
    "DELETE_PRESS",
    "CLICK_CANVAS",
    "NODE_CLICK",
    "NODE_CLICK_SAME",
    "NODE_CLICK_OTHER",
    "NODE_KEY_ENTER",
    "START_DRAG",
    "END_DRAG",
    "CONFIRM_WEIGHT",
    "CANCEL_WEIGHT",
    "CREATE_EDGE",
    "EDGE_CREATED",
    "DELETE_NODE",
    "STEP_PRESS",
    "PLAY_PRESS",
    "PAUSE_PRESS",
    "AUTO_STEP_TICK",
    "INITIALIZE_DIJKSTRA",
    "DIJKSTRA_INITIALIZED",
    "ALGORITHM_FINISHED",
    "STEP_COMPLETE",
    "RESET_PRESS",
    "CLEAR_PRESS",
    "WINDOW_RESIZE",
    "KEY_SHORTCUT_A",
    "KEY_SHORTCUT_C",
    "KEY_SHORTCUT_S",
    "KEY_SHORTCUT_D",
    "KEY_SPACE",
    "KEY_ENTER",
    "CANCEL_SELECTION",
    "STOP_AUTO"
  ],
  "notes": "This FSM captures two orthogonal categories of state: UI interaction modes (idle, add_node_mode, connect_mode, set_start_mode, delete_mode, dragging, weight_popup) and Dijkstra runtime states (dijkstra_uninitialized, dijkstra_initialized, stepping, auto_running, dijkstra_finished). Practical behavior / conditional details: \n- Mode toggling is exclusive: entering any mode sets other modes to false (toggleMode in code). OnExit and onEnter actions reflect that.\n- add_node_mode: CLICK_CANVAS triggers a createNode(x,y) action and remains in add_node_mode. ADD_NODE_PRESS toggles off to idle.\n- connect_mode: clicking a node when no source is selected moves to connect_source_selected (set connectSource and highlight). If a second different node is clicked while connectSource exists, the app shows the weight_popup (state weight_popup) at the midpoint (showWeightPopup). Confirming weight (CONFIRM_WEIGHT) runs createEdgeWithWeight(weight) and returns to connect_mode with connectSource cleared. Clicking the same node cancels selection (NODE_CLICK_SAME).\n- weight_popup: confirming calls createEdgeWithWeight and hides the popup; cancel hides popup and returns to connect_mode without creating an edge.\n- set_start_mode: NODE_CLICK sets the chosen node as startNodeId, calls resetAlgorithm (dijkstra state reset) and then toggles out of set_start_mode (returns to idle).\n- delete_mode: clicking a node calls deleteNode(id) and stays in delete_mode until toggled off.\n- dragging: started by mousedown on a node when not in any exclusive mode; onEnter runs startDrag and onExit runs endDrag. While dragging, node position and connected edges are updated; END_DRAG returns to idle.\n- Dijkstra runtime: initialize occurs automatically when STEP_PRESS is invoked if uninitialized (initializeDijkstra). stepDijkstra implements a full step including animations (highlightCurrent, flashEdge, pulseNode); stepping is asynchronous â€” on completion it emits STEP_COMPLETE (returns to dijkstra_initialized) or ALGORITHM_FINISHED if no reachable nodes remain. startAuto initializes if needed and repeatedly calls stepDijkstra on an interval; entering auto_running runs startAuto and exiting runs stopAuto.\n- Keyboard shortcuts map to their button equivalents (A/C/S/D for modes, Space to toggle Play/Pause, Enter to step).\n- CLEAR_PRESS clears graph and resets all algorithm state (clearAll). RESET_PRESS resets the algorithm (resetAlgorithm) but preserves the graph.\n- Certain event outcomes are conditional (e.g., NODE_CLICK in connect_mode depends on whether connectSource exists and whether the clicked node is the same). Those conditions are represented as separate event variants in the events list (NODE_CLICK_SAME, NODE_CLICK_OTHER) and described above.\n\nImplementation action names referenced in onEnter/onExit correspond to the functions in the source: toggleMode(...), setModeNone, setConnectSource/highlightNode, clearConnectSource, showWeightPopup, hideWeightPopup, createEdgeWithWeight (triggered by CONFIRM_WEIGHT), createNode (triggered by CLICK_CANVAS in add_node_mode), deleteNode, startDrag, endDrag, initializeDijkstra, stepDijkstra, startAuto, stopAuto, resetAlgorithm, clearAll, finalizeAlgorithm (marks remaining nodes visited / stops auto-run / refreshes UI)."
}