{
  "topic": "Array Visualizer — Interactive Application",
  "description": "Models the interactive states of an array visualizer UI: user-driven array mutations (push/pop/shift/unshift/set/remove/clear), transient animations (FLIP insert/remove/shift), iteration (automated index traversal), temporary highlighting, and error/flash feedback.",
  "states": [
    {
      "name": "idle",
      "onEnter": "renderArray(false if initial seed else true) & updateMeta",
      "onExit": "none",
      "on": {
        "PUSH": "animating",
        "POP": "animating",
        "UNSHIFT": "animating",
        "SHIFT": "animating",
        "SET": "highlighting",
        "REMOVE_AT": "animating",
        "CLEAR": "animating",
        "ITERATE_TOGGLE": "iterating",
        "STEP_ONCE": "highlighting",
        "KEY_PUSH_SHORTCUT": "animating",
        "KEY_POP_SHORTCUT": "animating"
      }
    },
    {
      "name": "animating",
      "onEnter": "apply model mutation (push/pop/shift/unshift/remove/clear/set) & call renderArray(true) & start removal/pop/shift timed removal when node removal animation is used (300ms)",
      "onExit": "cleanup transition inline styles & remove 'removing' classes if any",
      "on": {
        "ANIMATION_END": "idle",
        "ITERATE_TOGGLE": "iterating",
        "ERROR_SHOWN": "error"
      }
    },
    {
      "name": "highlighting",
      "onEnter": "perform required model change (for SET/STEP) if needed, call renderArray(true) & highlightIndex(index) (adds .highlight & focus) and schedule removal of highlight (700ms)",
      "onExit": "remove highlight class & restore focus state",
      "on": {
        "HIGHLIGHT_END": "idle"
      }
    },
    {
      "name": "iterating",
      "onEnter": "startIteration(): set isIterating=true, iterIndex=0, model.lastOp='iterate(start)' and invoke iterateStep(); schedule repeated highlights based on speedInput (uses setTimeout delays)",
      "onExit": "stopIteration(): clear iterTimer if present, set isIterating=false, update model.lastOp and renderArray(true)",
      "on": {
        "ITERATE_STEP": "iterating",
        "ITERATE_STOP": "idle",
        "ITERATE_COMPLETE": "idle",
        "STEP_ONCE": "highlighting",
        "ANIMATION_END": "iterating",
        "ERROR_SHOWN": "error"
      }
    },
    {
      "name": "error",
      "onEnter": "flashMessage(message, 'danger') (temporarily set op text/color and schedule revert ~900ms)",
      "onExit": "restore op display to model.lastOp & clear danger color",
      "on": {
        "ERROR_ACK": "idle",
        "TIMEOUT_EXPIRED": "idle"
      }
    }
  ],
  "events": [
    "PUSH",
    "POP",
    "UNSHIFT",
    "SHIFT",
    "SET",
    "REMOVE_AT",
    "CLEAR",
    "ITERATE_TOGGLE",
    "ITERATE_START",
    "ITERATE_STEP",
    "ITERATE_STOP",
    "ITERATE_COMPLETE",
    "STEP_ONCE",
    "ANIMATION_END",
    "HIGHLIGHT_END",
    "ERROR_SHOWN",
    "ERROR_ACK",
    "TIMEOUT_EXPIRED",
    "KEY_PUSH_SHORTCUT",
    "KEY_POP_SHORTCUT",
    "SEED_INIT"
  ],
  "notes": "High-level mapping of UI behaviors to FSM states. Implementation details / guards in code: operations that remove nodes (pop/shift/removeAt) run a 300ms CSS removal animation then mutate model and call renderArray(true) — represented by ANIMATION_END returning to idle. setAt validates index and flashes error if invalid; that is modeled as ERROR_SHOWN -> error -> idle. Iteration runs entirely inside the 'iterating' state: it highlights elements in index order on a timer controlled by speed input; when iteration reaches end it sets model.lastOp='iterate(end)' and transitions to idle (ITERATE_COMPLETE). Single-step (Step button) triggers a transient highlight (highlighting state). Keyboard shortcuts (Ctrl/Cmd+Enter and Ctrl/Cmd+Backspace) map to PUSH/POP events. Timeouts: highlight duration ≈700ms, removal animation ≈300ms, flash message revert ≈900ms. The initial seed of sample items occurs at startup and places the FSM in idle after render (SEED_INIT -> idle). Guards (e.g., ignoring pop on empty array) are handled in code and will result in no state change or an ERROR_SHOWN event depending on the operation; the FSM abstracts these as conditional transitions to animating or error states."
}