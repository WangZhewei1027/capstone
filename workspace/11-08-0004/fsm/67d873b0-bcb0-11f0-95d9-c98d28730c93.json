{
  "topic": "Singly Linked List — Insertion & Deletion (Interactive)",
  "description": "Models the interactive states of a browser-based singly linked list visualization: user controls, pointer traversal animations, insertion and deletion animations, and short visual feedback (flash). Tracks when controls are enabled/disabled and when animations are running.",
  "states": [
    {
      "name": "idle",
      "onEnter": "setStatus('idle'); pointer.style.display = 'none'; disableControls(false)",
      "onExit": "none",
      "on": {
        "CLICK_INSERT_EMPTY": "flashing",
        "CLICK_INSERT_NEEDS_TRAVERSE": "traversingInsert",
        "CLICK_INSERT_NO_TRAVERSE": "inserting",
        "CLICK_DELETE_EMPTY_OR_INVALID": "flashing",
        "CLICK_DELETE_NEEDS_TRAVERSE": "traversingDelete",
        "CLICK_DELETE_NO_TRAVERSE": "deleting",
        "CLICK_RESET": "resetting",
        "CLICK_RANDOM": "randomizing",
        "NODE_CLICK": "idle",
        "ENTER_KEY": "CLICK_INSERT_NEEDS_TRAVERSE"
      }
    },
    {
      "name": "traversingInsert",
      "onEnter": "disableControls(true); pointer.style.display = 'block'; start traverseToIndex(targetIndexForInsert) (highlights nodes sequentially)",
      "onExit": "unhighlight any highlighted nodes (cleanup); // pointer remains visible until insertion completes",
      "on": {
        "TRAVERSE_COMPLETE": "inserting",
        "CANCEL": "idle"
      }
    },
    {
      "name": "traversingDelete",
      "onEnter": "disableControls(true); pointer.style.display = 'block'; start traverseToIndex(targetIndexForDelete) (highlights nodes sequentially)",
      "onExit": "unhighlight any highlighted nodes (cleanup); // pointer remains visible until deletion completes",
      "on": {
        "TRAVERSE_COMPLETE": "deleting",
        "CANCEL": "idle"
      }
    },
    {
      "name": "inserting",
      "onEnter": "perform data-model splice to insert node; renderList(); find new DOM node; add classes 'inserting' and 'target' to new node; await pop-in animation; remove 'inserting'/'target'; pointer.style.display = 'none';",
      "onExit": "disableControls(false); setStatus('idle')",
      "on": {
        "INSERT_ANIMATION_COMPLETE": "idle"
      }
    },
    {
      "name": "deleting",
      "onEnter": "highlight target node; add 'removing' class; await removal pause; remove node from data model; renderList(); pointer.style.display = 'none';",
      "onExit": "disableControls(false); setStatus('idle')",
      "on": {
        "DELETE_ANIMATION_COMPLETE": "idle"
      }
    },
    {
      "name": "flashing",
      "onEnter": "flashStage() (brief box-shadow change) to indicate invalid input or invalid action; (controls remain enabled unless animating flag set elsewhere)",
      "onExit": "restore stage styling",
      "on": {
        "FLASH_DONE": "idle"
      }
    },
    {
      "name": "resetting",
      "onEnter": "if(animating) ignore; else list = []; nodeId = 0; renderList();",
      "onExit": "setStatus('idle')",
      "on": {
        "RESET_DONE": "idle"
      }
    },
    {
      "name": "randomizing",
      "onEnter": "if(animating) ignore; else resetList(); populate list with random nodes; renderList();",
      "onExit": "setStatus('idle')",
      "on": {
        "RANDOM_DONE": "idle"
      }
    }
  ],
  "events": [
    "CLICK_INSERT_EMPTY",
    "CLICK_INSERT_NEEDS_TRAVERSE",
    "CLICK_INSERT_NO_TRAVERSE",
    "TRAVERSE_COMPLETE",
    "INSERT_ANIMATION_COMPLETE",
    "CLICK_DELETE_EMPTY_OR_INVALID",
    "CLICK_DELETE_NEEDS_TRAVERSE",
    "CLICK_DELETE_NO_TRAVERSE",
    "DELETE_ANIMATION_COMPLETE",
    "CLICK_RESET",
    "CLICK_RANDOM",
    "RESET_DONE",
    "RANDOM_DONE",
    "FLASH_DONE",
    "NODE_CLICK",
    "ENTER_KEY",
    "CANCEL"
  ],
  "notes": "This FSM describes high-level interactive behavior driven by user actions and internal animation completions. The real implementation evaluates conditions on a raw user action (e.g., a single Insert button click) to produce one of the conditional events used here: CLICK_INSERT_EMPTY (value missing → flash), CLICK_INSERT_NEEDS_TRAVERSE (insertion requires pointer traversal to predecessor), or CLICK_INSERT_NO_TRAVERSE (no traversal required, e.g., empty list head insertion). Similarly for delete: CLICK_DELETE_EMPTY_OR_INVALID (empty list or invalid index triggers flash), CLICK_DELETE_NEEDS_TRAVERSE (pointer must traverse to index), CLICK_DELETE_NO_TRAVERSE (rare direct delete). Traversal states set animating=true via disableControls(true) and show the pointer dot while sequentially highlighting nodes; on traversal completion TRAVERSE_COMPLETE is emitted and the next animation (inserting/deleting) starts. Inserting and deleting states perform data-model updates, call renderList(), apply CSS classes for 'inserting' and 'removing' animations, and hide the pointer before returning to idle. Flashing is a brief visual feedback (flashStage) for invalid operations. Resetting and randomizing are synchronous operations that update data and re-render. The DOM MutationObserver and click-on-node behavior are treated as actions that do not change the FSM state (NODE_CLICK simply updates the index input while remaining in idle)."
}