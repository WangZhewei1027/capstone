{
  "topic": "Selection Sort Interactive Module",
  "description": "Models the interactive lifecycle of the selection-sort visualization: loading arrays, user edits/dragging, stepping and autoplay of the algorithm, animations for comparisons/min updates/swaps, pausing/resuming, and completion.",
  "states": [
    {
      "name": "idle",
      "onEnter": "renderBars; highlightPseudocode(null); hintReady",
      "onExit": "clearHints",
      "on": {
        "CLICK_PLAY": "playing",
        "CLICK_STEP": "stepping",
        "CLICK_RUN_TO_END": "playing_fast",
        "CLICK_RANDOM": "loading",
        "CLICK_SHUFFLE": "loading",
        "CLICK_RESET": "loading",
        "CLICK_LOAD": "loading",
        "DOUBLE_CLICK_BAR": "editing",
        "DRAG_START": "dragging",
        "KEY_SPACE": "playing",
        "KEY_RIGHT": "stepping"
      }
    },
    {
      "name": "loading",
      "onEnter": "stopExecution; validateAndLoadArray; renderBars; updateStats; highlightPseudocode(null); hintReady",
      "onExit": "clearValidation",
      "on": {
        "INPUT_VALID": "idle",
        "INPUT_INVALID": "idle",
        "STOP": "idle"
      }
    },
    {
      "name": "playing",
      "onEnter": "setRunning(true); setPaused(false); playBtnLabel('Pause'); hintPlaying; startSelectionGenerator(fast=false)",
      "onExit": "clearPlayHints",
      "on": {
        "CLICK_PLAY": "paused",
        "KEY_SPACE": "paused",
        "PAUSE_REQUEST": "paused",
        "COMPARISON_ANIM_START": "animating_comparison",
        "MIN_UPDATE_ANIM_START": "animating_min_update",
        "SWAP_ANIM_START": "animating_swap",
        "GENERATOR_FINISHED": "completed",
        "STOP": "stopped",
        "DRAG_START": "dragging",
        "DOUBLE_CLICK_BAR": "editing"
      }
    },
    {
      "name": "playing_fast",
      "onEnter": "setRunning(true); setPaused(false); playBtnLabel('Pause'); hintRunningFast; startSelectionGenerator(fast=true)",
      "onExit": "clearPlayHints",
      "on": {
        "CLICK_PLAY": "paused",
        "GENERATOR_FINISHED": "completed",
        "STOP": "stopped"
      }
    },
    {
      "name": "paused",
      "onEnter": "setPaused(true); playBtnLabel('Play'); hintPaused",
      "onExit": "hintClearPaused",
      "on": {
        "CLICK_PLAY": "playing",
        "KEY_SPACE": "playing",
        "CLICK_STEP": "stepping",
        "KEY_RIGHT": "stepping",
        "STOP": "stopped",
        "DRAG_START": "dragging",
        "DOUBLE_CLICK_BAR": "editing"
      }
    },
    {
      "name": "stepping",
      "onEnter": "createGeneratorIfNeeded; generatorNextStep(); hintStepping",
      "onExit": "clearStepHints",
      "on": {
        "STEP_COMPLETED": "paused",
        "GENERATOR_FINISHED": "completed",
        "STOP": "stopped",
        "CLICK_PLAY": "playing"
      }
    },
    {
      "name": "animating_comparison",
      "onEnter": "highlightBarsForComparison; incrementComparisons; updateStats; startCompareDelay",
      "onExit": "unhighlightComparison",
      "on": {
        "COMPARISON_ANIM_END": "playing",
        "MIN_UPDATE_ANIM_START": "animating_min_update",
        "PAUSE_REQUEST": "paused",
        "STOP": "stopped"
      }
    },
    {
      "name": "animating_min_update",
      "onEnter": "highlightNewMin; startMinUpdateDelay; updateStats",
      "onExit": "clearMinTemporaryHighlight",
      "on": {
        "MIN_UPDATE_ANIM_END": "playing",
        "PAUSE_REQUEST": "paused",
        "STOP": "stopped"
      }
    },
    {
      "name": "animating_swap",
      "onEnter": "highlightSwapPair; startSwapAnimation; performArraySwap; renderBars; markFixedPosition; incrementSwaps; updateStats",
      "onExit": "clearSwapHighlights",
      "on": {
        "SWAP_ANIM_END": "playing",
        "GENERATOR_FINISHED": "completed",
        "PAUSE_REQUEST": "paused",
        "STOP": "stopped"
      }
    },
    {
      "name": "dragging",
      "onEnter": "createDragClone; hideOriginalBar; trackPointer",
      "onExit": "removeClone; reorderArrayIfDropped; renderBars",
      "on": {
        "DRAG_MOVE": "dragging",
        "DRAG_END": "idle",
        "STOP": "stopped",
        "DOUBLE_CLICK_BAR": "editing"
      }
    },
    {
      "name": "editing",
      "onEnter": "promptEditValue; validateEdit; applyEditToArray; renderBars; setInitialArray",
      "onExit": "clearEditState",
      "on": {
        "EDIT_APPLY": "idle",
        "EDIT_CANCEL": "idle",
        "INPUT_INVALID": "idle",
        "STOP": "stopped"
      }
    },
    {
      "name": "completed",
      "onEnter": "markAllFixed; highlightPseudocode(null); hintCompleted; setRunning(false); setPaused(true); playBtnLabel('Play')",
      "onExit": "clearCompletionHint",
      "on": {
        "CLICK_RANDOM": "loading",
        "CLICK_SHUFFLE": "loading",
        "CLICK_RESET": "loading",
        "CLICK_PLAY": "playing",
        "CLICK_STEP": "stepping",
        "DOUBLE_CLICK_BAR": "editing",
        "DRAG_START": "dragging"
      }
    },
    {
      "name": "stopped",
      "onEnter": "setRunning(false); setPaused(true); resolvePendingStep; playBtnLabel('Play'); hintStopped",
      "onExit": "clearStopHints",
      "on": {
        "CLICK_RANDOM": "loading",
        "CLICK_SHUFFLE": "loading",
        "CLICK_RESET": "loading",
        "CLICK_LOAD": "loading",
        "CLICK_PLAY": "playing",
        "CLICK_STEP": "stepping",
        "DOUBLE_CLICK_BAR": "editing"
      }
    }
  ],
  "events": [
    "CLICK_PLAY",
    "CLICK_PAUSE",
    "CLICK_STEP",
    "CLICK_RUN_TO_END",
    "CLICK_RANDOM",
    "CLICK_SHUFFLE",
    "CLICK_RESET",
    "CLICK_LOAD",
    "INPUT_VALID",
    "INPUT_INVALID",
    "DOUBLE_CLICK_BAR",
    "DRAG_START",
    "DRAG_MOVE",
    "DRAG_END",
    "KEY_SPACE",
    "KEY_RIGHT",
    "COMPARISON_ANIM_START",
    "COMPARISON_ANIM_END",
    "MIN_UPDATE_ANIM_START",
    "MIN_UPDATE_ANIM_END",
    "SWAP_ANIM_START",
    "SWAP_ANIM_END",
    "GENERATOR_FINISHED",
    "STEP_COMPLETED",
    "STOP",
    "EDIT_APPLY",
    "EDIT_CANCEL"
  ],
  "notes": "This FSM models the user-facing interactive states and the algorithm/animation microstates. Implementation actions refer to functions or side-effects in the script: renderBars, startSelectionGenerator (selectionSortAnimated), createGeneratorIfNeeded, generatorNextStep, startCompareDelay/animDelay, startSwapAnimation/animateSwap, highlight/unhighlight functions, markFixed, updateStats, promptEditValue, and drag clone management. 'playing_fast' is a variant of 'playing' where the generator is executed with fast=true (no delays). Pausing resolves a waiting promise (stepResolver) and prevents the generator loop from advancing until resumed. Loading operations stop any running execution. Stepping executes a single generator.next() and returns to paused (or completed) state."
}