<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bubble Sort — Interactive Module</title>
  <style>
    :root{
      --safe-padding:24px;
      --gap:16px;
      --bg:#0f1720;
      --panel:#0b1220;
      --muted:#9aa6b2;
      --primary:#60a5fa;
      --accent:#f97316;
      --success:#34d399;
      --danger:#fb7185;
      --bar-bg:#1f2937;
      --bar-color:#cbd5e1;
    }
    html,body{
      height:100%;
      margin:0;
      background:linear-gradient(180deg,#071025 0%, #0b1523 100%);
      color:var(--bar-color);
      font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
    }
    body{
      padding:var(--safe-padding);
      box-sizing:border-box;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    .container{
      display:flex;
      flex-direction:column;
      gap:var(--gap);
      min-height:calc(100vh - (var(--safe-padding) * 2));
    }

    header{
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    h1{
      margin:0;
      font-size:1.3rem;
      color:var(--primary);
    }
    p.lead{
      margin:0;
      color:var(--muted);
      font-size:0.95rem;
    }

    main{
      display:grid;
      grid-template-columns:1fr 360px;
      gap:var(--gap);
      align-items:start;
    }

    /* Responsive: stack on narrow screens */
    @media (max-width:940px){
      main{
        grid-template-columns:1fr;
      }
    }

    /* Left: Visualization panel */
    .visual-panel{
      background:linear-gradient(180deg,#061022, #071226);
      border-radius:12px;
      padding:16px;
      min-height:360px;
      box-shadow:0 6px 18px rgba(2,6,23,0.6);
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .viz-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
    }
    .viz-title{
      color:var(--bar-color);
      font-weight:600;
    }
    .viz-sub{
      color:var(--muted);
      font-size:0.9rem;
    }

    .array-area{
      position:relative;
      height:260px;
      border-radius:8px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      padding:12px;
      overflow:hidden;
    }

    .bars{
      position:relative;
      height:100%;
      width:100%;
      min-height:140px;
    }

    .bar{
      position:absolute;
      bottom:12px;
      width:48px;
      border-radius:6px 6px 4px 4px;
      background:var(--bar-bg);
      color:var(--bar-color);
      display:flex;
      align-items:flex-end;
      justify-content:center;
      padding-bottom:6px;
      box-sizing:border-box;
      transition:left 400ms cubic-bezier(.23,.9,.27,1), transform 220ms ease, background-color 160ms;
      box-shadow:0 4px 10px rgba(2,6,23,0.55);
      font-weight:700;
      font-size:0.85rem;
      user-select:none;
    }
    .bar .label{
      transform:translateY(6px);
      font-size:0.8rem;
      color:var(--bar-color);
    }
    .bar.compare{
      background:linear-gradient(180deg, rgba(96,165,250,0.12), rgba(96,165,250,0.06));
      border:2px solid rgba(96,165,250,0.22);
      transform:translateY(-8px) scale(1.02);
      z-index:5;
    }
    .bar.swap-flash{
      box-shadow:0 10px 30px rgba(249,115,22,0.14);
      border:2px solid rgba(249,115,22,0.24);
    }
    .indices{
      display:flex;
      justify-content:flex-start;
      gap:12px;
      color:var(--muted);
      font-size:0.85rem;
      padding-left:8px;
    }

    /* Right: Controls and pseudocode */
    .controls-panel{
      background:linear-gradient(180deg,#071225, #06131d);
      border-radius:12px;
      padding:16px;
      min-height:360px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .control-row{
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
    }
    label{ color:var(--muted); font-size:0.9rem; }
    input[type="text"]{
      flex:1;
      min-width:0;
      padding:8px 10px;
      background:transparent;
      border:1px solid rgba(255,255,255,0.06);
      color:var(--bar-color);
      border-radius:8px;
      outline:none;
    }
    input[type="range"]{ width:100%; }
    .btn{
      background:linear-gradient(180deg,var(--primary), #2b8cf3);
      color:#02203a;
      border:none;
      padding:8px 12px;
      border-radius:8px;
      font-weight:700;
      cursor:pointer;
      min-width:44px;
    }
    .btn.secondary{
      background:transparent;
      border:1px solid rgba(255,255,255,0.06);
      color:var(--bar-color);
    }
    .btn.ghost{
      background:transparent;
      color:var(--muted);
      border:1px solid rgba(255,255,255,0.03);
    }
    .btn:disabled{ opacity:0.5; cursor:not-allowed; }

    .big-controls{
      display:flex;
      gap:12px;
      align-items:center;
    }
    .stat-row{
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
    }
    .stat{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      padding:8px 10px;
      border-radius:8px;
      font-size:0.9rem;
      color:var(--muted);
      min-width:80px;
      text-align:center;
    }

    .pseudocode{
      margin-top:8px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      padding:8px;
      border-radius:8px;
      font-family:ui-monospace,SFMono-Regular,Menlo,monospace;
      font-size:0.9rem;
      color:var(--muted);
      line-height:1.6;
    }
    .code-line{
      padding:6px 8px;
      border-radius:6px;
      display:flex;
      gap:8px;
      align-items:center;
    }
    .code-line .num{ color:#3b82f6; width:24px; text-align:right; font-weight:700; }
    .code-line.active{
      background:linear-gradient(90deg, rgba(99,102,241,0.06), rgba(96,165,250,0.03));
      color:var(--bar-color);
      box-shadow:inset 0 0 0 1px rgba(96,165,250,0.03);
    }

    footer{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      color:var(--muted);
      font-size:0.9rem;
    }
    .shortcuts{ color:var(--muted); }
    .status{
      color:var(--muted);
      text-align:right;
      min-width:240px;
    }

    /* small responsive adjustments */
    @media (max-width:560px){
      .indices{ display:none; }
      .bar{ width:40px; }
    }
  </style>
</head>
<body>
  <div class="container" role="application" aria-labelledby="title">
    <header>
      <h1 id="title">Bubble Sort — Animated Step-through</h1>
      <p class="lead">Visualize adjacent comparisons and swaps. Step, play, or customize an array to explore how Bubble Sort orders elements.</p>
    </header>

    <main>
      <section class="visual-panel" aria-labelledby="vizTitle">
        <div class="viz-header">
          <div>
            <div id="vizTitle" class="viz-title">Array visualization</div>
            <div class="viz-sub">Heights reflect numeric value. Compared items lift and highlight.</div>
          </div>
          <div style="color:var(--muted); font-size:0.9rem;" id="passInfo">Pass: 0</div>
        </div>

        <div class="array-area" aria-live="polite" aria-atomic="true">
          <div class="bars" id="barsContainer" aria-hidden="false"></div>
        </div>

        <div class="indices" id="indicesBar" aria-hidden="true"></div>
      </section>

      <aside class="controls-panel" aria-labelledby="controlsTitle">
        <div id="controlsTitle" style="display:none;">Controls</div>

        <div class="control-row" style="gap:12px;">
          <input type="text" id="arrayInput" placeholder="e.g. 5,1,4,2,8" aria-label="Array values input">
          <button class="btn" id="setArrayBtn" title="Set array from input">Set Array</button>
        </div>

        <div class="control-row">
          <button class="btn secondary" id="randomBtn">Randomize</button>
          <label style="display:flex;align-items:center;gap:8px;color:var(--muted);">
            Size
            <input id="sizeRange" type="range" min="2" max="16" value="8" aria-label="Array size">
          </label>
          <div style="min-width:60px;color:var(--muted);text-align:right;" id="sizeDisplay">8</div>
        </div>

        <div class="control-row big-controls" role="group" aria-label="Playback controls">
          <button class="btn ghost" id="stepBackBtn" title="Step backward (Left Arrow)">⟲</button>
          <button class="btn" id="playPauseBtn" title="Play or pause (Space)">▶</button>
          <button class="btn ghost" id="stepFwdBtn" title="Step forward (Right Arrow)">⟳</button>
          <button class="btn secondary" id="resetBtn" title="Reset to initial array">Reset</button>
        </div>

        <div class="control-row" style="align-items:center;">
          <label style="display:flex;gap:8px;align-items:center;color:var(--muted);">Speed
            <input id="speedRange" type="range" min="200" max="1200" value="600" aria-label="Playback speed (ms per step)">
          </label>
          <div style="color:var(--muted); min-width:60px; text-align:right;" id="speedDisplay">600ms</div>
        </div>

        <div class="control-row" style="align-items:center;">
          <label style="display:flex;gap:8px; align-items:center;">
            <input id="optimizedCheckbox" type="checkbox" aria-label="Enable optimized early exit"> Optimized (early-exit)
          </label>
          <div style="flex:1"></div>
          <div class="stat" id="compStat" aria-live="polite">Comparisons: 0</div>
          <div class="stat" id="swapStat" aria-live="polite">Swaps: 0</div>
        </div>

        <div class="pseudocode" id="pseudocode" aria-hidden="false">
          <div class="code-line" data-line="1"><span class="num">1</span> for i = 0 to n-2</div>
          <div class="code-line" data-line="2"><span class="num">2</span>   swapped = false</div>
          <div class="code-line" data-line="3"><span class="num">3</span>   for j = 0 to n-i-2</div>
          <div class="code-line" data-line="4"><span class="num">4</span>     if A[j] &gt; A[j+1]</div>
          <div class="code-line" data-line="5"><span class="num">5</span>       swap A[j], A[j+1]; swapped = true</div>
          <div class="code-line" data-line="6"><span class="num">6</span>   if not swapped: break</div>
        </div>

      </aside>
    </main>

    <footer>
      <div class="shortcuts">Keyboard: ← step back / → step forward / Space play/pause</div>
      <div class="status" id="status" aria-live="polite">Ready — set or randomize an array to begin.</div>
    </footer>
  </div>

  <script>
    (function(){
      // Utilities
      const $ = (sel, parent=document) => parent.querySelector(sel);
      const $$ = (sel, parent=document) => Array.from(parent.querySelectorAll(sel));

      // DOM
      const barsContainer = $('#barsContainer');
      const indicesBar = $('#indicesBar');
      const arrayInput = $('#arrayInput');
      const setArrayBtn = $('#setArrayBtn');
      const randomBtn = $('#randomBtn');
      const sizeRange = $('#sizeRange');
      const sizeDisplay = $('#sizeDisplay');
      const stepBackBtn = $('#stepBackBtn');
      const stepFwdBtn = $('#stepFwdBtn');
      const playPauseBtn = $('#playPauseBtn');
      const resetBtn = $('#resetBtn');
      const speedRange = $('#speedRange');
      const speedDisplay = $('#speedDisplay');
      const optimizedCheckbox = $('#optimizedCheckbox');
      const compStat = $('#compStat');
      const swapStat = $('#swapStat');
      const passInfo = $('#passInfo');
      const status = $('#status');
      const pseudocode = $('#pseudocode');
      const codeLines = {};
      $$('.code-line', pseudocode).forEach(el => codeLines[el.dataset.line] = el);

      // State
      let initialArray = []; // array of {id,value}
      let currentSnapshotIndex = -1;
      let snapshots = []; // array of {arr: [objects], op: {type,i,j,pass,desc}}
      let playing = false;
      let playTimer = null;
      let speed = parseInt(speedRange.value,10);
      let comparisons = 0, swaps = 0;
      let size = parseInt(sizeRange.value,10);
      let optimized = optimizedCheckbox.checked;

      // Accessibility: generate unique IDs for elements
      let uidCounter = 1;
      function uniqueId(){ return 'e' + (uidCounter++); }

      // Default initial array
      function randomArray(n){
        const arr = [];
        for(let i=0;i<n;i++){
          const v = Math.floor(Math.random()*90) + 10; // 10..99
          arr.push({ id: uniqueId(), value: v });
        }
        return arr;
      }

      // Build operation sequence (snapshots) by simulating Bubble Sort
      function buildSnapshots(arr, opt){
        // Clone objects so we preserve ids
        const a = arr.map(o => ({ id: o.id, value: o.value }));
        const n = a.length;
        const ops = [];
        let compCount = 0, swapCount=0;
        for(let i=0;i<n-1;i++){
          let swapped = false;
          for(let j=0;j<n-i-1;j++){
            // record compare (snapshot before swap)
            ops.push({
              type: 'compare',
              i, j,
              pass: i+1,
              desc: `Compare indices ${j} and ${j+1}`,
              arr: a.map(x => ({ id: x.id, value: x.value }))
            });
            compCount++;
            if(a[j].value > a[j+1].value){
              // swap in simulation
              const tmp = a[j];
              a[j] = a[j+1];
              a[j+1] = tmp;
              swapped = true;
              swapCount++;
              ops.push({
                type: 'swap',
                i, j,
                pass: i+1,
                desc: `Swap indices ${j} and ${j+1}`,
                arr: a.map(x => ({ id: x.id, value: x.value }))
              });
            }
          }
          // end of pass marker: record pass snapshot
          ops.push({
            type: 'pass',
            i, j: null,
            pass: i+1,
            desc: `Pass ${i+1} complete`,
            arr: a.map(x => ({ id: x.id, value: x.value })),
            swapped
          });
          if(opt && !swapped){
            break;
          }
        }
        return ops;
      }

      // Render bars for initial array
      function renderInitialBars(arr){
        barsContainer.innerHTML = '';
        indicesBar.innerHTML = '';
        // compute width per bar based on available container width
        const containerWidth = barsContainer.clientWidth;
        const maxVisible = arr.length;
        const gap = 12;
        // dynamic width
        const barWidth = Math.max(36, Math.floor((containerWidth - (maxVisible-1)*gap) / maxVisible));
        arr.forEach((obj, idx) => {
          const el = document.createElement('div');
          el.className = 'bar';
          el.dataset.id = obj.id;
          el.dataset.value = obj.value;
          el.style.width = barWidth + 'px';
          const h = computeHeight(obj.value);
          el.style.height = h + 'px';
          el.style.left = (idx * (barWidth + gap)) + 'px';
          el.style.transition = 'left 400ms cubic-bezier(.23,.9,.27,1), transform 220ms';
          el.innerHTML = `<div class="label">${obj.value}</div>`;
          barsContainer.appendChild(el);

          const idxEl = document.createElement('div');
          idxEl.textContent = idx;
          indicesBar.appendChild(idxEl);
        });
      }

      // compute height from value relative to current array max
      function computeHeight(value){
        // map 10..99 to 40..220
        const minH = 48, maxH = 220;
        const minV = 10, maxV = 99;
        const v = Math.max(minV, Math.min(maxV, Number(value)));
        const t = (v - minV) / (maxV - minV);
        return Math.round(minH + t * (maxH - minH));
      }

      // Apply a snapshot (arr state) visually
      function applySnapshot(snapshot, animate = true){
        // snapshot.arr is array of {id,value}
        const arr = snapshot.arr;
        // map id -> element
        const elMap = {};
        $$('.bar', barsContainer).forEach(b => elMap[b.dataset.id] = b);

        const containerWidth = barsContainer.clientWidth;
        const gap = 12;
        const barEls = $$('.bar', barsContainer);
        const barWidth = barEls.length ? parseInt(barEls[0].style.width,10) : Math.max(36, Math.floor((containerWidth - (arr.length-1)*gap) / arr.length));

        // Update indices display
        indicesBar.innerHTML = '';
        arr.forEach((o, i) => {
          const d = document.createElement('div');
          d.textContent = i;
          indicesBar.appendChild(d);
        });

        // Update element positioning and height/label. If new elements (rare), create them.
        arr.forEach((o, idx) => {
          let el = elMap[o.id];
          if(!el){
            el = document.createElement('div');
            el.className = 'bar';
            el.dataset.id = o.id;
            barsContainer.appendChild(el);
          }
          el.dataset.value = o.value;
          el.style.width = barWidth + 'px';
          const h = computeHeight(o.value);
          el.style.height = h + 'px';
          el.style.left = (idx * (barWidth + gap)) + 'px';
          // update label
          el.innerHTML = `<div class="label">${o.value}</div>`;
        });

        // remove any extra DOM bars (if array got smaller)
        $$('.bar', barsContainer).forEach(b => {
          if(!arr.find(x => x.id === b.dataset.id)){
            b.remove();
          }
        });

        // remove highlight classes (we will add for the op)
        $$('.bar.compare', barsContainer).forEach(b => b.classList.remove('compare'));
        $$('.bar.swap-flash', barsContainer).forEach(b => b.classList.remove('swap-flash'));
      }

      // Highlight according to op
      function highlightOperation(op){
        // Clear previous
        $$('.bar', barsContainer).forEach(b => b.classList.remove('compare','swap-flash'));
        clearCodeHighlight();
        if(!op) return;

        if(op.type === 'compare'){
          // op.i and op.j indicate indices in op.arr
          const a = op.arr;
          const idA = a[op.j] ? a[op.j].id : null;
          const idB = a[op.j+1] ? a[op.j+1].id : null;
          if(idA) {
            const elA = $(`.bar[data-id="${idA}"]`, barsContainer);
            if(elA) elA.classList.add('compare');
          }
          if(idB) {
            const elB = $(`.bar[data-id="${idB}"]`, barsContainer);
            if(elB) elB.classList.add('compare');
          }
          // highlight compare line
          setCodeHighlight(3);
          setCodeHighlight(4, true);
          status.textContent = `Comparing positions ${op.j} and ${op.j+1} (pass ${op.pass})`;
        } else if(op.type === 'swap'){
          const a = op.arr;
          const idA = a[op.j] ? a[op.j].id : null;
          const idB = a[op.j+1] ? a[op.j+1].id : null;
          if(idA){
            const elA = $(`.bar[data-id="${idA}"]`, barsContainer);
            if(elA) elA.classList.add('swap-flash');
          }
          if(idB){
            const elB = $(`.bar[data-id="${idB}"]`, barsContainer);
            if(elB) elB.classList.add('swap-flash');
          }
          setCodeHighlight(4);
          setCodeHighlight(5, true);
          status.textContent = `Swapping positions ${op.j} and ${op.j+1} (pass ${op.pass})`;
        } else if(op.type === 'pass'){
          setCodeHighlight(1);
          setCodeHighlight(2);
          if(op.swapped === false){
            setCodeHighlight(6, true);
            status.textContent = `Pass ${op.pass} complete — no swaps (early exit)`;
          } else {
            status.textContent = `Pass ${op.pass} complete`;
          }
        }
      }

      function setCodeHighlight(line, secondary=false){
        const el = codeLines[line];
        if(el){
          el.classList.add('active');
          if(secondary){
            el.style.boxShadow = 'inset 0 0 0 1px rgba(249,115,22,0.06)';
          }
        }
      }
      function clearCodeHighlight(){
        Object.values(codeLines).forEach(el => {
          el.classList.remove('active');
          el.style.boxShadow = '';
        });
      }

      // Compute snapshots from initialArray using current optimization setting
      function computeAllSnapshots(){
        snapshots = buildSnapshots(initialArray, optimized);
        // Insert an initial snapshot representing the starting array before any operations
        snapshots.unshift({
          type: 'start',
          i: null, j:null,
          pass:0,
          desc: 'Start',
          arr: initialArray.map(x => ({ id:x.id, value:x.value }))
        });
        currentSnapshotIndex = 0;
        comparisons = 0;
        swaps = 0;
        updateStatsUI();
        applySnapshot(snapshots[0]);
        highlightOperation(snapshots[0]);
        passInfo.textContent = `Pass: 0`;
      }

      // Update statistics UI
      function updateStatsUI(){
        compStat.textContent = `Comparisons: ${comparisons}`;
        swapStat.textContent = `Swaps: ${swaps}`;
      }

      // Step forward/back controls
      function stepTo(index){
        if(index < 0) index = 0;
        if(index >= snapshots.length) index = snapshots.length - 1;
        currentSnapshotIndex = index;
        const snap = snapshots[currentSnapshotIndex];
        // Count comps and swaps up to this index
        let c=0,s=0, pass=0;
        for(let k=0;k<=currentSnapshotIndex;k++){
          const op = snapshots[k];
          if(op.type === 'compare') c++;
          if(op.type === 'swap') s++;
          if(op.type === 'pass') pass = op.pass;
        }
        comparisons = c;
        swaps = s;
        updateStatsUI();
        passInfo.textContent = `Pass: ${pass}`;
        applySnapshot(snap);
        highlightOperation(snap);
      }

      function stepForward(){
        if(currentSnapshotIndex < snapshots.length - 1){
          stepTo(currentSnapshotIndex + 1);
        } else {
          playing = false;
          playPauseBtn.textContent = '▶';
          status.textContent = 'Completed.';
        }
      }
      function stepBack(){
        if(currentSnapshotIndex > 0){
          stepTo(currentSnapshotIndex - 1);
        }
      }

      function play(){
        if(playing) return;
        playing = true;
        playPauseBtn.textContent = '⏸';
        const tick = () => {
          if(!playing) return;
          if(currentSnapshotIndex < snapshots.length - 1){
            stepForward();
            playTimer = setTimeout(tick, speed);
          } else {
            playing = false;
            playPauseBtn.textContent = '▶';
            status.textContent = 'Completed.';
            playTimer = null;
          }
        };
        playTimer = setTimeout(tick, speed);
      }
      function pause(){
        playing = false;
        playPauseBtn.textContent = '▶';
        if(playTimer) { clearTimeout(playTimer); playTimer = null; }
      }
      function togglePlay(){
        if(playing) pause(); else play();
      }

      // Reset to initial snapshot
      function resetToStart(){
        pause();
        if(snapshots && snapshots.length){
          stepTo(0);
          status.textContent = 'Reset to start.';
        }
      }

      // Event handlers
      setArrayBtn.addEventListener('click', () => {
        const raw = arrayInput.value.trim();
        let parsed = [];
        if(raw.length){
          const parts = raw.split(',').map(s => s.trim()).filter(s => s.length);
          for(const p of parts){
            const v = Number(p);
            if(Number.isFinite(v)) parsed.push({ id: uniqueId(), value: Math.round(v) });
          }
        }
        if(parsed.length < 2){
          status.textContent = 'Please enter at least two valid numbers (comma-separated) or randomize.';
          return;
        }
        initialArray = parsed;
        uidCounter = Math.max(uidCounter, parsed.reduce((m,o)=>Math.max(m, parseInt(o.id.slice(1))+1),1)+1);
        computeAllSnapshots();
        status.textContent = 'Array set from input.';
      });

      randomBtn.addEventListener('click', () => {
        const n = Math.max(2, Math.min(16, parseInt(sizeRange.value,10)));
        sizeDisplay.textContent = n;
        initialArray = randomArray(n);
        computeAllSnapshots();
        status.textContent = 'Randomized array.';
      });

      sizeRange.addEventListener('input', () => {
        size = parseInt(sizeRange.value,10);
        sizeDisplay.textContent = size;
      });

      stepFwdBtn.addEventListener('click', () => {
        pause();
        stepForward();
      });
      stepBackBtn.addEventListener('click', () => {
        pause();
        stepBack();
      });
      playPauseBtn.addEventListener('click', togglePlay);
      resetBtn.addEventListener('click', () => {
        resetToStart();
      });

      speedRange.addEventListener('input', () => {
        speed = parseInt(speedRange.value,10);
        speedDisplay.textContent = speed + 'ms';
      });

      optimizedCheckbox.addEventListener('change', () => {
        optimized = optimizedCheckbox.checked;
        if(initialArray.length){
          computeAllSnapshots();
        }
      });

      // Keyboard shortcuts
      window.addEventListener('keydown', (e) => {
        if(e.code === 'ArrowRight'){
          e.preventDefault();
          pause();
          stepForward();
        } else if(e.code === 'ArrowLeft'){
          e.preventDefault();
          pause();
          stepBack();
        } else if(e.code === 'Space'){
          e.preventDefault();
          togglePlay();
        }
      });

      // Responsive: recompute positions on resize
      let resizeTimer;
      window.addEventListener('resize', () => {
        if(resizeTimer) clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => {
          // rerender current snapshot to adjust bar widths/positions
          if(snapshots && snapshots.length){
            applySnapshot(snapshots[currentSnapshotIndex]);
          }
        }, 120);
      });

      // Initialize with random array
      initialArray = randomArray(size);
      computeAllSnapshots();

      // Expose status to screen readers initially
      status.textContent = 'Ready — use controls to step through Bubble Sort.';
    })();
  </script>
</body>
</html>