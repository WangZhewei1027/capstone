<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Interactive: 0/1 Knapsack Problem</title>
  <style>
    :root{
      --safe-pad: 24px;
      --gap: 16px;
      --accent: #2468f2;
      --muted: #6b6f76;
      --bg: #fbfdff;
      --card: #ffffff;
      --danger: #ff6b6b;
      --success: #2fb86f;
      --max-table-width: 100%;
      --radius: 10px;
    }

    /* Safe area margins */
    html,body{
      height:100%;
      margin:0;
      background: linear-gradient(180deg,#f7fbff 0%, #eef6ff 100%);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color:#122034;
      padding: var(--safe-pad);
      box-sizing: border-box;
    }
    *{box-sizing:inherit}

    /* Container */
    .container{
      display:flex;
      gap:var(--gap);
      align-items:flex-start;
      justify-content:center;
      width:100%;
      min-height: calc(100vh - (var(--safe-pad) * 2));
    }

    /* Responsive columns */
    .panel-left, .panel-right{
      background: linear-gradient(180deg, rgba(255,255,255,0.8), rgba(255,255,255,0.95));
      border-radius: var(--radius);
      padding:18px;
      box-shadow: 0 6px 20px rgba(17,24,39,0.06);
    }
    .panel-left{ flex:0 0 360px; min-width:300px; max-width:420px;}
    .panel-right{ flex:1 1 720px; min-width:320px; }

    header .title{
      font-size:20px;
      font-weight:700;
      margin:0 0 6px 0;
    }
    header .subtitle{
      margin:0 0 12px 0;
      color:var(--muted);
      font-size:13px;
    }

    /* Sections */
    .section{
      margin-bottom:18px;
      display:block;
    }
    .section h3{
      margin:0 0 10px 0;
      font-size:14px;
    }
    .note{
      font-size:13px;
      color:var(--muted);
      line-height:1.4;
    }

    /* Form controls */
    label{
      display:block;
      font-size:13px;
      margin-bottom:6px;
    }
    input[type="number"], input[type="text"], select{
      width:100%;
      padding:8px 10px;
      border-radius:8px;
      border:1px solid #e6eefb;
      background:white;
      font-size:13px;
      margin-bottom:12px;
    }
    .row{
      display:flex;
      gap:var(--gap);
      align-items:center;
    }
    .small{
      flex:1;
    }
    button{
      background:var(--accent);
      color:white;
      border:0;
      padding:9px 12px;
      border-radius:8px;
      font-weight:600;
      cursor:pointer;
      transition: transform .08s ease, box-shadow .12s ease;
    }
    button:active{ transform: translateY(1px) }
    .muted-btn{
      background:transparent;
      color:var(--accent);
      border:1px solid rgba(36,104,242,0.12);
      font-weight:600;
    }
    .danger-btn{
      background:var(--danger);
      color:white;
      border:0;
    }

    /* Item list */
    .items-list{
      display:flex;
      flex-direction:column;
      gap:12px;
      max-height:260px;
      overflow:auto;
      padding-right:6px;
    }
    .item-card{
      display:flex;
      align-items:center;
      gap:12px;
      padding:10px;
      border-radius:10px;
      background:var(--card);
      border:1px solid #eef6ff;
      box-shadow: 0 2px 6px rgba(17,24,39,0.03);
    }
    .item-left{
      width:44px;
      height:44px;
      border-radius:8px;
      display:flex;
      align-items:center;
      justify-content:center;
      background:linear-gradient(180deg,#eef6ff, #f7fbff);
      color:var(--accent);
      font-weight:700;
      font-size:15px;
    }
    .item-meta{
      flex:1;
      min-width:0;
    }
    .meta-title{ font-weight:700; font-size:14px; margin:0;}
    .meta-sub{ font-size:13px; color:var(--muted); margin-top:4px; }

    .item-actions{
      display:flex;
      gap:8px;
      align-items:center;
    }
    .tiny-btn{
      padding:6px 8px;
      background:transparent;
      border-radius:8px;
      border:1px solid rgba(36,104,242,0.08);
      color:var(--accent);
      cursor:pointer;
      font-weight:700;
      font-size:13px;
    }

    /* Visual right side */
    .knapsack-area{
      background: linear-gradient(180deg,#ffffff, #fbfdff);
      border-radius:12px;
      padding:18px;
      border:1px solid #e9f3ff;
      margin-bottom:var(--gap);
    }
    .knap-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      margin-bottom:12px;
    }
    .capacity-pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
    }
    .cap-bar{
      width:220px;
      height:14px;
      border-radius:999px;
      background:#eef6ff;
      overflow:hidden;
      display:inline-block;
      vertical-align:middle;
      box-shadow: inset 0 -2px 6px rgba(36,104,242,0.06);
    }
    .cap-fill{
      height:100%;
      width:0%;
      background:linear-gradient(90deg,var(--accent), #3fb0ff);
      transition: width 420ms cubic-bezier(.2,.9,.23,1);
    }
    .cap-text{
      font-weight:700;
      font-size:13px;
      color:var(--muted);
    }

    .knap-body{
      display:flex;
      gap:16px;
      align-items:flex-start;
    }
    .knap-dropzone{
      flex:1;
      min-height:140px;
      border-radius:10px;
      border:2px dashed rgba(36,104,242,0.12);
      background:linear-gradient(180deg, rgba(36,104,242,0.03), rgba(255,255,255,0.01));
      position:relative;
      padding:12px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-content:flex-start;
      transition: box-shadow .18s ease, border-color .18s ease;
    }
    .knap-dropzone.dragover{
      border-color: var(--accent);
      box-shadow: 0 8px 30px rgba(36,104,242,0.06);
    }
    .knap-item{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:8px;
      border-radius:9px;
      background:white;
      border:1px solid #eef6ff;
      box-shadow: 0 3px 10px rgba(17,24,39,0.04);
      cursor:grab;
      transform-origin:center;
      transition: transform .18s ease, box-shadow .12s ease;
    }
    .knap-item:active{ cursor:grabbing; transform:scale(.99) }
    .knap-item.over-cap{ opacity:0.45; filter:grayscale(.4); }

    .stats{
      min-width:160px;
      padding:8px;
      border-radius:10px;
      background:linear-gradient(180deg,#fff,#fbfeff);
      border:1px solid #eef6ff;
      font-size:13px;
    }
    .stat-line{ display:flex; justify-content:space-between; margin-bottom:6px; color:var(--muted); }
    .stat-line strong{ color:#09203a; font-weight:800; }

    /* DP Table */
    .dp-area{
      margin-top:12px;
      padding:12px;
      border-radius:10px;
      background:linear-gradient(180deg,#ffffff,#f9fbff);
      border:1px solid #eef6ff;
      overflow:auto;
    }
    table.dp-table{
      border-collapse:collapse;
      width:100%;
      max-width:var(--max-table-width);
      font-size:13px;
    }
    table.dp-table th, table.dp-table td{
      border:1px solid rgba(15,23,42,0.04);
      padding:6px 8px;
      text-align:center;
      min-width:36px;
      transition: background .24s ease, color .18s ease, transform .18s ease;
    }
    table.dp-table th{
      background:linear-gradient(180deg,#f7fbff,#eef6ff);
      color:#0f1724;
      font-weight:700;
      position:sticky;
      top:0;
      z-index:1;
    }
    .dp-highlight{
      background: linear-gradient(90deg,#fff7cc,#fff2d6);
      transform:scale(1.02);
      color:#815700;
      font-weight:800;
      box-shadow: 0 6px 16px rgba(255,191,61,0.08);
    }
    .dp-chosen{
      background: linear-gradient(90deg,#e6ffef,#d7ffe6);
      color:#046936;
      font-weight:800;
    }

    /* Explanation / steps */
    .log{
      margin-top:12px;
      font-size:13px;
      color:var(--muted);
      background:linear-gradient(180deg,#fff,#fbfeff);
      padding:10px;
      border-radius:8px;
      border:1px solid #eef6ff;
      max-height:160px;
      overflow:auto;
    }

    /* Footer controls */
    .controls{
      display:flex;
      gap:var(--gap);
      align-items:center;
      margin-top:12px;
      flex-wrap:wrap;
    }

    /* Small screens */
    @media (max-width:980px){
      .container{ flex-direction:column; }
      .panel-left, .panel-right{ width:100%; }
      .cap-bar{ width:160px; }
    }
  </style>
</head>
<body>
  <div class="container" role="main">
    <!-- LEFT PANEL: Explanation + Inputs -->
    <aside class="panel-left" aria-labelledby="module-title">
      <header>
        <h1 id="module-title" class="title">0/1 Knapsack — Interactive Module</h1>
        <p class="subtitle">Drag items into the knapsack, compare greedy choices with the exact dynamic programming solution.</p>
      </header>

      <section class="section" aria-labelledby="objective-title">
        <h3 id="objective-title">Learning Objective</h3>
        <p class="note">
          After using this module you will:
          1) understand the trade-off between weight and value in the 0/1 knapsack,
          2) see how a greedy ratio heuristic can fail,
          and 3) observe how dynamic programming computes the optimal subset.
        </p>
      </section>

      <section class="section" aria-labelledby="interaction-title">
        <h3 id="interaction-title">Interaction Design</h3>
        <p class="note">
          - Add items (name, weight, value) and set knapsack capacity. <br>
          - Drag items into the knapsack zone or click "Add" to toggle them. Dropping animates a fill bar and updates totals. <br>
          - Click "Solve: Greedy (value/weight)" to select items quickly (animation shows picks). <br>
          - Click "Solve: DP (exact)" to animate building the DP table and highlight the optimal items. <br>
          - Use "Random example" for a counterexample where greedy fails.
        </p>
      </section>

      <section class="section" aria-labelledby="controls-title">
        <h3 id="controls-title">Controls</h3>

        <label for="capacity">Knapsack capacity (max 60)</label>
        <input id="capacity" type="number" min="1" max="60" value="20" aria-label="Knapsack capacity"/>

        <div style="display:flex; gap:var(--gap);">
          <input id="it-name" type="text" placeholder="Item name (e.g., A)" aria-label="Item name" style="flex:1"/>
        </div>

        <div class="row" style="margin-top:8px;">
          <input id="it-weight" class="small" type="number" min="1" max="60" placeholder="Weight" aria-label="Item weight"/>
          <input id="it-value" class="small" type="number" min="1" max="1000" placeholder="Value" aria-label="Item value"/>
        </div>

        <div class="row">
          <button id="add-item">Add item</button>
          <button id="random-ex" class="muted-btn" title="Add a demonstration set">Random example</button>
        </div>

        <div style="margin-top:12px;">
          <h3 style="margin:0 0 8px 0;">Items (drag or click Add)</h3>
          <div class="items-list" id="items-list" aria-live="polite" aria-label="Available items">
            <!-- item cards inserted here -->
          </div>
        </div>

        <div style="margin-top:10px;">
          <div class="controls">
            <button id="solve-greedy" title="Run greedy heuristic">Solve: Greedy (v/w)</button>
            <button id="solve-dp" title="Run dynamic programming">Solve: DP (exact)</button>
            <button id="reset" class="muted-btn">Reset</button>
            <button id="clear-knap" class="muted-btn">Clear knapsack</button>
          </div>
        </div>
      </section>

      <section class="section" aria-labelledby="layout-title">
        <h3 id="layout-title">Layout & Accessibility Notes</h3>
        <p class="note">
          The page keeps a 24px safe margin, at least 16px spacing between interactive elements, and supports keyboard controls (Add/Remove buttons) for accessibility. The DP table is capped to capacity ≤ 60 to keep rendering smooth.
        </p>
      </section>
    </aside>

    <!-- RIGHT PANEL: Visual interactive area -->
    <main class="panel-right" aria-live="polite">
      <div class="knapsack-area" role="application" aria-label="Knapsack visualization">
        <div class="knap-header">
          <div>
            <strong>Knapsack</strong>
            <div class="note" style="margin-top:4px;">Place items here to build a candidate solution.</div>
          </div>
          <div class="capacity-pill" aria-hidden="false">
            <div class="cap-text" id="cap-summary">0 / 20 weight</div>
            <div class="cap-bar" aria-hidden="true" style="margin-left:12px;">
              <div class="cap-fill" id="cap-fill" style="width:0%"></div>
            </div>
          </div>
        </div>

        <div class="knap-body">
          <div id="dropzone" class="knap-dropzone" tabindex="0" aria-label="Knapsack drop zone" role="listbox">
            <!-- dropped items appear here -->
            <div id="dropzone-hint" style="color:var(--muted); font-size:13px;">Drop items here or click "Add" on an item card.</div>
          </div>

          <aside class="stats" aria-label="Knapsack statistics">
            <div class="stat-line"><span>Used weight</span><strong id="used-w">0</strong></div>
            <div class="stat-line"><span>Total value</span><strong id="total-v">0</strong></div>
            <div class="stat-line"><span>Capacity</span><strong id="cap-val">20</strong></div>
            <div style="height:8px"></div>
            <div class="note" style="font-size:13px;">
              Visual feedback:
              <ul style="margin:6px 0 0 18px; padding:0;">
                <li>Capacity bar animates width</li>
                <li>Over-capacity items fade and block dropping</li>
                <li>DP solver highlights table cells and chosen items</li>
              </ul>
            </div>
          </aside>
        </div>

        <div class="dp-area" aria-label="Dynamic programming area">
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <strong>Dynamic Programming Table</strong>
            <div class="note">Capacity columns are 0..C, rows are items (0 means none)</div>
          </div>

          <div style="margin-top:10px;">
            <div id="dp-container" style="overflow:auto;"></div>
          </div>

          <div class="log" id="log" aria-live="polite" style="margin-top:10px;">
            Actions and solver logs will appear here.
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // Data model
    (function(){
      // DOM elements
      const capacityInput = document.getElementById('capacity');
      const capSummary = document.getElementById('cap-summary');
      const capFill = document.getElementById('cap-fill');
      const capVal = document.getElementById('cap-val');
      const usedW = document.getElementById('used-w');
      const totalV = document.getElementById('total-v');
      const itemsList = document.getElementById('items-list');
      const addItemBtn = document.getElementById('add-item');
      const randomBtn = document.getElementById('random-ex');
      const itName = document.getElementById('it-name');
      const itWeight = document.getElementById('it-weight');
      const itValue = document.getElementById('it-value');
      const dropzone = document.getElementById('dropzone');
      const dropzoneHint = document.getElementById('dropzone-hint');
      const solveGreedyBtn = document.getElementById('solve-greedy');
      const solveDPBtn = document.getElementById('solve-dp');
      const resetBtn = document.getElementById('reset');
      const clearKnapBtn = document.getElementById('clear-knap');
      const dpContainer = document.getElementById('dp-container');
      const logEl = document.getElementById('log');

      // State
      let capacity = Math.min(60, Math.max(1, parseInt(capacityInput.value || 20)));
      let items = []; // {id,name,w,v}
      let inKnapsack = new Set(); // ids
      let nextId = 1;

      // Initialize with a default set
      function seedExample(){
        items = [
          makeItem('A', 12, 4),
          makeItem('B', 2, 2),
          makeItem('C', 1, 1),
          makeItem('D', 1, 2),
          makeItem('E', 4, 10),
        ];
        nextId = 100;
        renderItems();
        updateAll();
        log('Loaded default items.');
      }

      function makeItem(name, w, v){
        return { id: (nextId++).toString(), name: name || ('I' + Math.floor(Math.random()*100)), w: Number(w), v: Number(v) };
      }

      // Utilities
      function clamp(x,min,max){ return Math.max(min, Math.min(max, x)); }
      function log(msg){
        const p = document.createElement('div');
        p.textContent = msg;
        logEl.appendChild(p);
        logEl.scrollTop = logEl.scrollHeight;
      }

      // Render item cards
      function renderItems(){
        itemsList.innerHTML = '';
        items.forEach(it => {
          const card = document.createElement('div');
          card.className = 'item-card';
          card.draggable = true;
          card.setAttribute('data-id', it.id);
          card.setAttribute('role','option');
          card.setAttribute('aria-selected', inKnapsack.has(it.id) ? 'true' : 'false');

          card.addEventListener('dragstart', e => {
            e.dataTransfer.setData('text/plain', it.id);
            // small custom drag image
            const crt = card.cloneNode(true);
            crt.style.width = '160px';
            crt.style.boxShadow = '0 8px 30px rgba(0,0,0,.12)';
            document.body.appendChild(crt);
            e.dataTransfer.setDragImage(crt, 20, 20);
            setTimeout(()=> document.body.removeChild(crt), 0);
          });

          const left = document.createElement('div');
          left.className = 'item-left';
          left.textContent = it.name.substring(0,2).toUpperCase();

          const meta = document.createElement('div');
          meta.className = 'item-meta';
          const title = document.createElement('div');
          title.className = 'meta-title';
          title.textContent = `${it.name}`;
          const sub = document.createElement('div');
          sub.className = 'meta-sub';
          sub.textContent = `w:${it.w}  v:${it.v}  (ratio:${(it.v/it.w).toFixed(2)})`;
          meta.appendChild(title);
          meta.appendChild(sub);

          const actions = document.createElement('div');
          actions.className = 'item-actions';
          const addBtn = document.createElement('button');
          addBtn.className = 'tiny-btn';
          addBtn.textContent = inKnapsack.has(it.id) ? 'Remove' : 'Add';
          addBtn.title = 'Toggle in knapsack';
          addBtn.addEventListener('click', () => {
            toggleInKnapsack(it.id, { animate:true });
          });
          const delBtn = document.createElement('button');
          delBtn.className = 'tiny-btn';
          delBtn.style.border = '1px solid rgba(255,100,100,0.08)';
          delBtn.style.color = '#d04b4b';
          delBtn.textContent = 'X';
          delBtn.title = 'Delete item';
          delBtn.addEventListener('click', () => {
            if (confirm('Delete "'+it.name+'"?')) {
              removeItem(it.id);
            }
          });

          actions.appendChild(addBtn);
          actions.appendChild(delBtn);

          card.appendChild(left);
          card.appendChild(meta);
          card.appendChild(actions);

          itemsList.appendChild(card);
        });
      }

      function removeItem(id){
        items = items.filter(i => i.id !== id);
        inKnapsack.delete(id);
        renderItems();
        renderKnapsackItems();
        updateAll();
        log('Removed item.');
      }

      // Toggle an item in knapsack
      function toggleInKnapsack(id, opts = {}){
        if (inKnapsack.has(id)){
          inKnapsack.delete(id);
          log('Removed item from knapsack.');
        } else {
          // check capacity if adding
          const it = items.find(x=>x.id===id);
          if (!it) return;
          const newWeight = currentWeight() + it.w;
          if (newWeight > capacity){
            // animate rejection
            log(`Cannot add "${it.name}" — would exceed capacity.`);
            flashOvercap();
            return;
          }
          inKnapsack.add(id);
          if (opts.animate) animateAddToKnapsack(id);
          log(`Added "${it.name}" to knapsack.`);
        }
        renderItems();
        renderKnapsackItems();
        updateAll();
      }

      // Visual: render items inside dropzone
      function renderKnapsackItems(){
        // Clear except hint
        dropzone.innerHTML = '';
        if (inKnapsack.size === 0){
          dropzone.appendChild(dropzoneHint);
        }
        items.filter(i => inKnapsack.has(i.id)).forEach(it => {
          const el = document.createElement('div');
          el.className = 'knap-item';
          el.setAttribute('data-id', it.id);
          el.setAttribute('role','listitem');
          el.innerHTML = `<div style="font-weight:700; color:var(--accent); width:34px; height:34px; border-radius:7px; display:flex; align-items:center; justify-content:center; background:linear-gradient(180deg,#eef6ff,#fff); margin-right:6px">${it.name.substring(0,2).toUpperCase()}</div>
                          <div style="min-width:80px"><div style="font-weight:700">${it.name}</div><div style="font-size:12px;color:var(--muted)">w:${it.w} v:${it.v}</div></div>
                          <button class="tiny-btn" title="Remove" style="margin-left:8px">−</button>`;
          el.querySelector('button').addEventListener('click', ()=> { toggleInKnapsack(it.id); });
          dropzone.appendChild(el);
        });
      }

      // Update capacity & stats
      function currentWeight(){
        return items.filter(i => inKnapsack.has(i.id)).reduce((s,it)=>s+it.w,0);
      }
      function currentValue(){
        return items.filter(i => inKnapsack.has(i.id)).reduce((s,it)=>s+it.v,0);
      }

      function updateAll(){
        capacity = clamp(parseInt(capacityInput.value || 20), 1, 60);
        capVal.textContent = capacity;
        const w = currentWeight();
        const v = currentValue();
        usedW.textContent = w;
        totalV.textContent = v;
        capSummary.textContent = `${w} / ${capacity} weight`;
        const pct = Math.round( Math.min(100, (w / capacity) * 100) );
        capFill.style.width = pct + '%';
        // visually dim items that if present would cause overflow
        document.querySelectorAll('.knap-item').forEach(el => {
          el.classList.toggle('over-cap', currentWeight() > capacity);
        });
      }

      // Drag & drop
      dropzone.addEventListener('dragover', e => {
        e.preventDefault();
        dropzone.classList.add('dragover');
      });
      dropzone.addEventListener('dragleave', e => {
        dropzone.classList.remove('dragover');
      });
      dropzone.addEventListener('drop', e => {
        e.preventDefault();
        dropzone.classList.remove('dragover');
        const id = e.dataTransfer.getData('text/plain');
        const it = items.find(x=>x.id===id);
        if (!it) return;
        // attempt to add
        if (currentWeight() + it.w > capacity){
          log(`Drop rejected: "${it.name}" would exceed capacity.`);
          flashOvercap();
          return;
        }
        inKnapsack.add(id);
        renderItems();
        renderKnapsackItems();
        updateAll();
        animateAddToKnapsack(id, e.clientX, e.clientY);
        log(`Dropped "${it.name}" into knapsack.`);
      });

      // Keyboard support: focus dropzone and press Enter to clear?
      dropzone.addEventListener('keydown', e => {
        if (e.key === 'Delete' || e.key === 'Backspace'){
          clearKnapsack();
        }
      });

      // Animations
      function animateAddToKnapsack(id, clientX, clientY){
        const item = items.find(i=>i.id===id);
        if (!item) return;
        // Create a floating token that moves to dropzone
        const token = document.createElement('div');
        token.className = 'item-card';
        token.style.position = 'fixed';
        token.style.zIndex = 9999;
        token.style.pointerEvents = 'none';
        token.style.width = '170px';
        token.style.left = (clientX ? clientX - 80 : window.innerWidth/2 - 80) + 'px';
        token.style.top = (clientY ? clientY - 24 : window.innerHeight/3) + 'px';
        token.innerHTML = `<div style="width:44px;height:44px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#eef6ff,#fff);color:var(--accent);font-weight:700">${item.name.substring(0,2).toUpperCase()}</div>
                           <div style="margin-left:12px"><div style="font-weight:700">${item.name}</div><div style="font-size:12px;color:#6b6f76">w:${item.w} v:${item.v}</div></div>`;
        document.body.appendChild(token);
        const destRect = dropzone.getBoundingClientRect();
        const destX = destRect.left + 20 + Math.random()*80;
        const destY = destRect.top + 20 + Math.random()*40;
        token.animate([
          { transform: 'translateY(0) scale(1)', opacity:1 },
          { transform: 'translate('+ (destX - parseFloat(token.style.left)) +'px,'+ (destY - parseFloat(token.style.top)) +'px) scale(.9)', opacity:0.95 },
          { transform: 'translate('+ (destX - parseFloat(token.style.left)) +'px,'+ (destY - parseFloat(token.style.top)) +'px) scale(.6)', opacity:0.0 }
        ], { duration: 700, easing:'cubic-bezier(.22,.9,.13,1)' });
        setTimeout(()=> {
          if (token && token.parentNode) token.parentNode.removeChild(token);
          updateAll();
        }, 720);
      }

      function flashOvercap(){
        dropzone.animate([
          { boxShadow:'0 0 0px rgba(255,0,0,0)', borderColor:'rgba(36,104,242,0.12)' },
          { boxShadow:'0 10px 40px rgba(255,80,80,0.14)', borderColor:'rgba(255,80,80,0.9)' },
          { boxShadow:'0 0 0px rgba(255,0,0,0)', borderColor:'rgba(36,104,242,0.12)' }
        ], { duration: 600 });
      }

      // Solvers
      function greedySolve(){
        // Sort by value/weight ratio descending
        const sorted = [...items].sort((a,b) => (b.v/b.w) - (a.v/a.w));
        const selection = new Set();
        let w=0, v=0;
        // Animate picks one by one
        log('Greedy solver started (by v/w).');
        dpContainer.innerHTML = ''; // clear DP view
        let idx = 0;
        function pickNext(){
          if (idx >= sorted.length) {
            log(`Greedy finished: weight=${w}, value=${v}`);
            inKnapsack = selection;
            renderItems();
            renderKnapsackItems();
            updateAll();
            return;
          }
          const it = sorted[idx++];
          // animate highlight card
          highlightItemCard(it.id);
          if (w + it.w <= capacity){
            selection.add(it.id);
            w += it.w;
            v += it.v;
            log(`Greedy picked "${it.name}" (w:${it.w}, v:${it.v}) — totals w:${w}, v:${v}`);
            animateAddToKnapsack(it.id);
          } else {
            log(`Greedy skipped "${it.name}" — would exceed capacity.`);
          }
          setTimeout(pickNext, 420);
        }
        pickNext();
      }

      function highlightItemCard(id){
        const el = document.querySelector('.item-card[data-id="'+id+'"]');
        if (!el) return;
        el.animate([
          { transform:'scale(1)', boxShadow:'0 2px 6px rgba(0,0,0,0.04)' },
          { transform:'scale(1.03)', boxShadow:'0 12px 40px rgba(36,104,242,0.08)' },
          { transform:'scale(1)', boxShadow:'0 2px 6px rgba(0,0,0,0.04)' }
        ], { duration: 380 });
      }

      function dpSolve(){
        // Build DP table w/ animation
        if (capacity > 60){
          alert('Capacity too large to display DP table. Reduce capacity to <= 60.');
          return;
        }
        log('DP solver started.');
        const n = items.length;
        const C = capacity;
        // dp[i][c] = max value using first i items with capacity c (i from 0..n)
        // we'll build as 2D array
        const dp = Array.from({length:n+1}, ()=> Array(C+1).fill(0));
        dpContainer.innerHTML = '';
        // create HTML table
        const table = document.createElement('table');
        table.className = 'dp-table';
        const thead = document.createElement('thead');
        const trHead = document.createElement('tr');
        const th0 = document.createElement('th'); th0.textContent = 'i\\cap';
        trHead.appendChild(th0);
        for (let c=0;c<=C;c++){
          const th = document.createElement('th');
          th.textContent = c;
          trHead.appendChild(th);
        }
        thead.appendChild(trHead);
        table.appendChild(thead);
        const tbody = document.createElement('tbody');
        for (let i=0;i<=n;i++){
          const tr = document.createElement('tr');
          const th = document.createElement('th');
          th.textContent = i===0 ? '0 (none)' : `${i}: ${items[i-1].name}`;
          tr.appendChild(th);
          for (let c=0;c<=C;c++){
            const td = document.createElement('td');
            td.textContent = '0';
            td.setAttribute('data-i', i);
            td.setAttribute('data-c', c);
            tr.appendChild(td);
          }
          tbody.appendChild(tr);
        }
        table.appendChild(tbody);
        dpContainer.appendChild(table);

        // Animate table building row by row
        let i = 1;
        function processRow(){
          if (i > n) {
            // finished; backtrack to find chosen items
            const chosen = [];
            let c = C;
            for (let k = n; k >= 1; k--){
              const it = items[k-1];
              if (dp[k][c] !== dp[k-1][c]){
                chosen.push(it);
                c -= it.w;
              }
            }
            // mark chosen in table
            markChosen(chosen);
            inKnapsack = new Set(chosen.map(x=>x.id));
            renderItems();
            renderKnapsackItems();
            updateAll();
            log(`DP finished: value=${dp[n][C]}. Selected ${chosen.length} item(s).`);
            return;
          }
          const it = items[i-1];
          let c = 0;
          function processCell(){
            if (c > C){
              i++;
              setTimeout(processRow, 120);
              return;
            }
            // compute dp[i][c]
            let without = dp[i-1][c];
            let withV = -Infinity;
            if (it.w <= c) withV = dp[i-1][c - it.w] + it.v;
            dp[i][c] = Math.max(without, withV);
            // update cell visually
            const td = table.querySelector('td[data-i="'+i+'"][data-c="'+c+'"]');
            td.textContent = dp[i][c];
            // highlight the computation step briefly
            td.classList.add('dp-highlight');
            setTimeout(()=> td.classList.remove('dp-highlight'), 240);
            // small log for interesting steps (when value changes)
            if (dp[i][c] !== without){
              log(`Item ${it.name} included at cap ${c} => dp[${i}][${c}] = ${dp[i][c]}`);
            }
            c++;
            setTimeout(processCell, 40);
          }
          processCell();
        }
        processRow();
      }

      function markChosen(chosen){
        // highlight chosen items in dp table cells and list
        const chosenIds = new Set(chosen.map(x=>x.id));
        // shade chosen table cells (where taking occurred)
        const table = dpContainer.querySelector('.dp-table');
        if (!table) return;
        // For simplicity, mark cells equal to dp[n][c] that were part of final solution by scanning back
        const n = items.length;
        const C = capacity;
        // Recompute dp quickly to find exact cells to mark
        const dp = Array.from({length:n+1}, ()=> Array(C+1).fill(0));
        for (let i=1;i<=n;i++){
          const it = items[i-1];
          for (let c=0;c<=C;c++){
            dp[i][c] = dp[i-1][c];
            if (it.w <= c) dp[i][c] = Math.max(dp[i][c], dp[i-1][c - it.w] + it.v);
          }
        }
        let c = C;
        for (let k=n;k>=1;k--){
          const row = table.querySelectorAll('tr')[k];
          if (!row) continue;
          const it = items[k-1];
          const td = row.querySelector('td[data-i="'+k+'"][data-c="'+c+'"]');
          if (dp[k][c] !== dp[k-1][c]){
            // item k used
            // mark backtracked path
            row.querySelectorAll('td').forEach(cell => cell.classList.remove('dp-chosen'));
            const chosenCell = table.querySelector('td[data-i="'+k+'"][data-c="'+c+'"]');
            if (chosenCell) chosenCell.classList.add('dp-chosen');
            c -= it.w;
          }
        }
        // highlight chosen items in the items list
        // small pulse on chosen item cards
        chosen.forEach(it => {
          const el = document.querySelector('.item-card[data-id="'+it.id+'"]');
          if (el){
            el.animate([
              { boxShadow: '0 2px 6px rgba(0,0,0,0.04)' },
              { boxShadow: '0 12px 40px rgba(47,184,111,0.12)' }
            ], { duration: 600 });
          }
        });
      }

      // UI actions
      addItemBtn.addEventListener('click', () => {
        const name = itName.value.trim() || ('I' + (Math.floor(Math.random()*90)+10));
        let w = parseInt(itWeight.value);
        let v = parseInt(itValue.value);
        if (!w || w <= 0) { alert('Please enter a positive integer weight.'); return; }
        if (!v || v <= 0) { alert('Please enter a positive integer value.'); return; }
        if (w > 60) { alert('Weight must be <= 60.'); return; }
        const it = makeItem(name, w, v);
        items.push(it);
        itName.value = ''; itWeight.value = ''; itValue.value = '';
        renderItems();
        log('Added item "'+name+'".');
      });

      randomBtn.addEventListener('click', () => {
        // Generate a counterexample where greedy fails often
        // Example: capacity 20, items with high ratio small items and one heavy high-value
        capacityInput.value = 20;
        items = [
          makeItem('Big', 12, 24),
          makeItem('X1', 6, 7),
          makeItem('X2', 6, 7),
          makeItem('X3', 6, 7),
          makeItem('Snack', 3, 5),
        ];
        inKnapsack.clear();
        renderItems();
        renderKnapsackItems();
        updateAll();
        log('Random example loaded (try Greedy vs DP).');
      });

      solveGreedyBtn.addEventListener('click', () =>{
        inKnapsack.clear();
        renderKnapsackItems();
        updateAll();
        greedySolve();
      });

      solveDPBtn.addEventListener('click', () =>{
        inKnapsack.clear();
        renderKnapsackItems();
        updateAll();
        dpSolve();
      });

      resetBtn.addEventListener('click', () =>{
        if (!confirm('Reset module to default items and clear knapsack?')) return;
        seedExample();
        inKnapsack.clear();
        renderKnapsackItems();
        dpContainer.innerHTML = '';
        logEl.innerHTML = '';
      });

      clearKnapBtn.addEventListener('click', () =>{
        clearKnapsack();
      });

      function clearKnapsack(){
        inKnapsack.clear();
        renderKnapsackItems();
        updateAll();
        log('Cleared knapsack.');
      }

      // Initial
      seedExample();

      // keep UI reactive to capacity changes
      capacityInput.addEventListener('input', () => {
        let v = parseInt(capacityInput.value || 0);
        if (isNaN(v)) v = 1;
        v = clamp(v, 1, 60);
        capacityInput.value = v;
        updateAll();
      });

      // ensure minimal spacing and accessible tab order
      // focus outline improvements (prefers keyboard)
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Tab') document.body.classList.add('show-focus');
      });

    })();
  </script>
</body>
</html>