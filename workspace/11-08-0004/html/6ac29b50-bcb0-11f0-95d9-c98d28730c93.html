<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Knapsack Problem ‚Äî Interactive DP Explorer</title>
  <style>
    /* Safe area: 24px on all sides */
    :root {
      --safe-padding: 24px;
      --gap: 16px;
      --accent: #2b7cff;
      --muted: #6b7280;
      --bg: #f7f9fc;
      --card: #ffffff;
      --success: #16a34a;
      --danger: #ef4444;
      --cell-size: 56px;
      --radius: 10px;
      --shadow: 0 6px 18px rgba(19,24,40,0.06);
      --font-sans: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    html, body {
      height: 100%;
      margin: 0;
      font-family: var(--font-sans);
      background: linear-gradient(180deg, #f7fbff 0%, var(--bg) 100%);
      color: #0f172a;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    main {
      padding: var(--safe-padding);
      box-sizing: border-box;
      min-height: 100vh;
    }

    /* Top narrative */
    .header {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: var(--gap);
      max-width: 1100px;
    }
    h1 {
      margin: 0;
      font-size: 20px;
      letter-spacing: -0.2px;
    }
    .sub {
      margin: 0;
      color: var(--muted);
      font-size: 14px;
    }

    .module {
      display: grid;
      grid-template-columns: 360px 1fr;
      gap: var(--gap);
      max-width: 1200px;
      align-items: start;
    }

    /* Left controls */
    .controls {
      background: var(--card);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      gap: var(--gap);
    }

    .controls h2 {
      margin: 0;
      font-size: 15px;
    }

    label {
      font-size: 13px;
      color: var(--muted);
      display: block;
      margin-bottom: 8px;
    }

    .row {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    input[type="number"],
    input[type="range"],
    button,
    select {
      font: inherit;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #e6eef8;
      background: white;
      outline: none;
    }

    input[type="number"]:focus,
    input[type="range"]:focus,
    button:focus {
      box-shadow: 0 0 0 4px rgba(43,124,255,0.12);
      border-color: var(--accent);
    }

    .small {
      width: 100%;
      max-width: 120px;
    }

    .btn-primary {
      background: linear-gradient(180deg, var(--accent), #145ed6);
      color: white;
      border: none;
      cursor: pointer;
    }

    .btn-ghost {
      background: transparent;
      color: var(--accent);
      border: 1px solid rgba(43,124,255,0.12);
      cursor: pointer;
    }

    .controls .actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    /* Item list */
    .items {
      background: linear-gradient(180deg, #ffffff, #fbfdff);
      border-radius: 10px;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      border: 1px solid rgba(13,42,76,0.04);
    }

    .item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px;
      border-radius: 8px;
      background: #ffffff;
      border: 1px solid rgba(15,23,42,0.03);
    }

    .badge {
      min-width: 44px;
      height: 44px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(180deg,#f0f6ff,#e6f1ff);
      color: #06357a;
      font-weight: 700;
      font-size: 14px;
    }

    .item-meta {
      display: flex;
      flex-direction: column;
      gap: 2px;
      font-size: 13px;
    }

    .item-actions {
      margin-left: auto;
      display: flex;
      gap: 8px;
    }

    .icon-btn {
      background: transparent;
      border: none;
      color: var(--muted);
      cursor: pointer;
      padding: 6px;
      border-radius: 6px;
    }

    /* Right visualization */
    .visual {
      background: var(--card);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      gap: var(--gap);
      min-width: 0;
    }

    .controls-row {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    .table-wrap {
      overflow: auto;
      padding: 8px;
      border-radius: 8px;
      background: linear-gradient(180deg,#ffffff,#fbfdff);
      border: 1px solid rgba(13,42,76,0.03);
    }

    /* DP table */
    table.dp {
      border-collapse: collapse;
      font-size: 13px;
      margin: 8px;
      min-width: 100%;
    }

    table.dp th,
    table.dp td {
      width: var(--cell-size);
      height: var(--cell-size);
      min-width: 48px;
      padding: 6px;
      text-align: center;
      border: 1px solid rgba(13,42,76,0.06);
      background: linear-gradient(180deg,#ffffff,#f8fbff);
      position: relative;
    }

    table.dp th {
      background: linear-gradient(180deg,#f1f6ff,#eef6ff);
      font-weight: 700;
      color: #08336a;
    }

    .cell-updated {
      animation: flash 700ms ease;
      background: linear-gradient(180deg,#fff4e6,#fff1dc);
    }

    @keyframes flash {
      0% { transform: scale(1); box-shadow: 0 0 0 rgba(255,198,0,0.0); }
      50% { transform: scale(1.03); box-shadow: 0 6px 18px rgba(255,198,0,0.18); }
      100% { transform: scale(1); box-shadow: none; }
    }

    .cell-calc {
      font-size: 11px;
      color: var(--muted);
      position: absolute;
      left: 6px;
      bottom: 6px;
    }

    /* Backpack area */
    .backpack {
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .backpack-visual {
      flex: 1;
      min-height: 120px;
      border-radius: 8px;
      background: linear-gradient(180deg,#f1f8ff,#ffffff);
      border: 1px dashed rgba(43,124,255,0.08);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .bp-item {
      position: absolute;
      width: 64px;
      height: 36px;
      border-radius: 6px;
      background: linear-gradient(180deg,#fff,#eefaff);
      border: 1px solid rgba(11,66,140,0.06);
      display: flex;
      align-items: center;
      justify-content: space-around;
      gap: 6px;
      padding: 6px;
      font-size: 12px;
      color: #093058;
      box-shadow: 0 4px 12px rgba(9,48,88,0.06);
    }

    .result {
      min-width: 220px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      align-items: flex-end;
      font-size: 14px;
    }

    .result .value {
      font-weight: 700;
      color: var(--accent);
      font-size: 18px;
    }

    .explain {
      color: var(--muted);
      font-size: 13px;
      line-height: 1.4;
      margin-top: 6px;
    }

    /* Footer instructions */
    .notes {
      margin-top: 12px;
      font-size: 13px;
      color: var(--muted);
    }

    /* Responsive */
    @media (max-width: 980px) {
      .module {
        grid-template-columns: 1fr;
      }
      .controls {
        order: 2;
      }
      .visual {
        order: 1;
      }
    }
  </style>
</head>
<body>
  <main>
    <section class="header" aria-labelledby="title">
      <h1 id="title">Knapsack Problem ‚Äî 0/1 Knapsack Dynamic Programming Explorer</h1>
      <p class="sub">
        Interactively build items (weight & value), set a backpack capacity, and watch the dynamic programming table
        fill step by step. Visualize how the algorithm decides which items to include for maximum value under a weight limit.
      </p>
    </section>

    <section class="module" aria-label="Interactive knapsack module">
      <!-- Left controls -->
      <aside class="controls" aria-label="Controls panel">
        <h2>Learning Objective</h2>
        <div class="explain" style="margin:0">
          After interacting you should be able to:
          <ul style="margin:8px 0 0 18px; padding:0; color:var(--muted)">
            <li>Understand how the DP table builds using previous item states.</li>
            <li>See how decisions (take / not take) lead to the optimal selection.</li>
            <li>Reconstruct the chosen items from the completed table.</li>
          </ul>
        </div>

        <div aria-hidden="true" style="height:8px"></div>

        <div>
          <label for="capInput">Backpack Capacity (W)</label>
          <div class="row">
            <input id="capInput" type="number" class="small" min="1" value="10" aria-label="Backpack capacity" />
            <input id="capRange" type="range" min="1" max="50" value="10" aria-label="Capacity slider" style="flex:1" />
          </div>
        </div>

        <div>
          <label>New Item (Weight, Value)</label>
          <div class="row">
            <input id="newWeight" type="number" min="1" value="3" aria-label="New item weight" />
            <input id="newValue" type="number" min="1" value="4" aria-label="New item value" />
            <button id="addBtn" class="btn-primary" aria-label="Add item">Add</button>
          </div>
        </div>

        <div>
          <label>Item Presets & Management</label>
          <div class="row actions">
            <select id="presets" aria-label="Select preset items">
              <option value="">Choose preset</option>
              <option value="classic">Classic small set (3,4,6 weight)</option>
              <option value="random5">Random 5 items</option>
              <option value="random8">Random 8 items</option>
            </select>
            <button id="rndBtn" class="btn-ghost" aria-label="Add random item">Add Random</button>
            <button id="clearBtn" class="btn-ghost" aria-label="Clear items">Clear</button>
          </div>
        </div>

        <div>
          <label>Playback Controls</label>
          <div class="row actions">
            <button id="stepBtn" class="btn-ghost" aria-label="Step algorithm">Step</button>
            <button id="playBtn" class="btn-primary" aria-label="Play algorithm">Play</button>
            <button id="resetBtn" class="btn-ghost" aria-label="Reset algorithm">Reset</button>
            <input id="speed" type="range" min="100" max="2000" value="700" aria-label="Animation speed" />
          </div>
        </div>

        <div>
          <label>Items (click trash to remove)</label>
          <div id="itemsList" class="items" role="list" aria-label="Items list">
            <!-- Items inserted here -->
          </div>
        </div>

        <div class="notes" aria-hidden="false">
          Tips: Use Step to see each table cell computed. Play runs automatically. When the table completes, selected items animate into the backpack.
        </div>
      </aside>

      <!-- Right visualization -->
      <section class="visual" aria-live="polite">
        <div class="controls-row" style="justify-content:space-between; align-items:center;">
          <div>
            <strong>DP Table Visualization</strong>
            <div class="explain">Rows are items (including 0), columns are capacities 0..W. Each cell dp[i][w] = max(not take, take).</div>
          </div>
          <div class="explain" id="status" style="text-align:right">Status: Ready</div>
        </div>

        <div class="table-wrap" id="tableWrap" tabindex="0" aria-label="DP table area">
          <!-- DP table inserted here -->
          <table id="dpTable" class="dp" aria-hidden="false"></table>
        </div>

        <div class="backpack" aria-label="Backpack and result">
          <div class="backpack-visual" id="backpack" aria-label="Backpack area">
            <div style="position:absolute;top:12px;left:12px;color:var(--muted);font-size:12px">Backpack (capacity displayed left)</div>
            <!-- animated items will be absolutely positioned -->
          </div>

          <div class="result" aria-live="polite">
            <div>Max Value: <span id="maxValue" class="value">0</span></div>
            <div class="explain" id="selectedText">Selected items: ‚Äî</div>
            <div class="explain" id="calcText">Calculation: ‚Äî</div>
          </div>
        </div>

        <div class="explain" id="explanation">
          Explanation: The algorithm uses previous item results to build a table where each entry dp[i][w] represents
          the maximum value achievable with the first i items and capacity w. When finished, we reconstruct the chosen items
          by walking back through the table.
        </div>
      </section>
    </section>

    <script>
      // Strict mode
      (function () {
        // UI elements
        const capInput = document.getElementById('capInput');
        const capRange = document.getElementById('capRange');
        const newWeight = document.getElementById('newWeight');
        const newValue = document.getElementById('newValue');
        const addBtn = document.getElementById('addBtn');
        const rndBtn = document.getElementById('rndBtn');
        const clearBtn = document.getElementById('clearBtn');
        const presets = document.getElementById('presets');

        const itemsList = document.getElementById('itemsList');
        const stepBtn = document.getElementById('stepBtn');
        const playBtn = document.getElementById('playBtn');
        const resetBtn = document.getElementById('resetBtn');
        const speed = document.getElementById('speed');

        const dpTable = document.getElementById('dpTable');
        const tableWrap = document.getElementById('tableWrap');
        const status = document.getElementById('status');
        const maxValueEl = document.getElementById('maxValue');
        const selectedText = document.getElementById('selectedText');
        const calcText = document.getElementById('calcText');
        const backpack = document.getElementById('backpack');
        const explanation = document.getElementById('explanation');

        // Data model
        let items = []; // each item: {w, v, id}
        let capacity = parseInt(capInput.value, 10) || 10;

        // DP state
        let dp = []; // 2D array (n+1) x (capacity+1)
        let iStep = 0; // current item row index we're processing (1..n)
        let wStep = 0; // current capacity column index processing (0..capacity)
        let playing = false;
        let timer = null;

        // Helpers
        function uid() {
          return Math.random().toString(36).slice(2, 9);
        }

        function clampCap(x) {
          return Math.max(1, Math.min(50, Math.floor(x)));
        }

        function updateCapacityFromRange() {
          const val = clampCap(capRange.value);
          capInput.value = val;
          capacity = val;
          rebuildDP();
        }

        function updateCapacityFromInput() {
          const val = clampCap(capInput.value);
          capRange.value = val;
          capacity = val;
          rebuildDP();
        }

        capRange.addEventListener('input', updateCapacityFromRange);
        capInput.addEventListener('change', updateCapacityFromInput);

        // Item UI
        function renderItems() {
          itemsList.innerHTML = '';
          items.forEach((it, idx) => {
            const el = document.createElement('div');
            el.className = 'item';
            el.setAttribute('role', 'listitem');
            el.innerHTML = `
              <div class="badge">#${idx+1}</div>
              <div class="item-meta"><strong>Weight: ${it.w}</strong><span style="color:var(--muted)">Value: ${it.v}</span></div>
              <div class="item-actions">
                <button class="icon-btn" title="Remove item" aria-label="Remove item ${idx+1}" data-id="${it.id}">üóëÔ∏è</button>
              </div>
            `;
            itemsList.appendChild(el);
          });

          // attach remove handlers
          itemsList.querySelectorAll('.icon-btn').forEach(btn => {
            btn.addEventListener('click', () => {
              const id = btn.getAttribute('data-id');
              items = items.filter(x => x.id !== id);
              rebuildDP();
              renderItems();
            });
          });
        }

        addBtn.addEventListener('click', () => {
          const w = Math.max(1, Math.floor(Number(newWeight.value) || 1));
          const v = Math.max(1, Math.floor(Number(newValue.value) || 1));
          items.push({w, v, id: uid()});
          renderItems();
          rebuildDP();
        });

        rndBtn.addEventListener('click', () => {
          const w = 1 + Math.floor(Math.random() * Math.min(10, capacity));
          const v = 1 + Math.floor(Math.random() * 15);
          items.push({w, v, id: uid()});
          renderItems();
          rebuildDP();
        });

        clearBtn.addEventListener('click', () => {
          items = [];
          renderItems();
          rebuildDP();
        });

        presets.addEventListener('change', () => {
          const v = presets.value;
          if (!v) return;
          if (v === 'classic') {
            items = [{w:3,v:4,id:uid()},{w:4,v:5,id:uid()},{w:2,v:3,id:uid()}];
            capacity = 7;
          } else if (v === 'random5') {
            items = Array.from({length:5}).map(()=>({w:1+Math.floor(Math.random()*9), v:1+Math.floor(Math.random()*15), id:uid()}));
            capacity = 15;
          } else if (v === 'random8') {
            items = Array.from({length:8}).map(()=>({w:1+Math.floor(Math.random()*12), v:1+Math.floor(Math.random()*18), id:uid()}));
            capacity = 20;
          }
          capInput.value = capacity;
          capRange.value = Math.min(50,capacity);
          renderItems();
          rebuildDP();
          presets.value = '';
        });

        // DP management
        function rebuildDP() {
          stopPlaying();
          iStep = 0;
          wStep = 0;
          // create (n+1) x (capacity+1) zero matrix
          const n = items.length;
          dp = Array.from({length: n+1}, () => Array.from({length: capacity+1}, () => ({val:0, from:null})));
          renderTable();
          status.textContent = 'Status: Ready';
          maxValueEl.textContent = '0';
          selectedText.textContent = 'Selected items: ‚Äî';
          calcText.textContent = 'Calculation: ‚Äî';
          // clear backpack visuals
          backpack.querySelectorAll('.bp-item').forEach(el => el.remove());
        }

        // Table rendering
        function renderTable() {
          // Build header row: first column is items, then capacities
          dpTable.innerHTML = '';
          const n = items.length;
          const header = document.createElement('tr');
          const th0 = document.createElement('th');
          th0.textContent = 'i\\w';
          header.appendChild(th0);

          for (let w = 0; w <= capacity; w++) {
            const th = document.createElement('th');
            th.textContent = w;
            header.appendChild(th);
          }
          dpTable.appendChild(header);

          // rows
          for (let i = 0; i <= n; i++) {
            const tr = document.createElement('tr');
            const th = document.createElement('th');
            th.textContent = i === 0 ? '0 (no items)' : `i=${i} (w=${items[i-1].w}, v=${items[i-1].v})`;
            tr.appendChild(th);

            for (let w = 0; w <= capacity; w++) {
              const td = document.createElement('td');
              td.setAttribute('data-i', i);
              td.setAttribute('data-w', w);
              td.innerHTML = `<div class="cell-val">${dp[i][w].val}</div><div class="cell-calc"></div>`;
              tr.appendChild(td);
            }
            dpTable.appendChild(tr);
          }
        }

        // Update a single cell with animation and small calc text
        function updateCell(i, w, newVal, from) {
          dp[i][w].val = newVal;
          dp[i][w].from = from; // 'take' or 'not'
          const td = dpTable.querySelector(`td[data-i="${i}"][data-w="${w}"]`);
          if (!td) return;
          const valDiv = td.querySelector('.cell-val');
          const calcDiv = td.querySelector('.cell-calc');
          valDiv.textContent = newVal;
          calcDiv.textContent = from && from.desc ? from.desc : '';
          // animate
          td.classList.remove('cell-updated');
          // Force reflow to restart animation
          void td.offsetWidth;
          td.classList.add('cell-updated');
          // clear the animation class after it ends to allow future animations
          setTimeout(() => td.classList.remove('cell-updated'), 800);
        }

        // Step computation: compute the next dp[i][w]
        function stepOnce() {
          const n = items.length;
          if (n === 0) {
            status.textContent = 'Status: Add items to start.';
            stopPlaying();
            return;
          }

          // move to next cell
          if (iStep === 0 && wStep === 0) {
            // start at (1,0)
            iStep = 1;
            wStep = 0;
          }

          if (iStep > n) {
            // computation finished
            finalize();
            stopPlaying();
            return;
          }

          // compute dp[iStep][wStep]
          const i = iStep;
          const w = wStep;
          const it = items[i-1];
          const prevVal = dp[i-1][w].val;
          let candidate = prevVal;
          let from = {desc: `not take (${prevVal})`, choice:'not'};

          if (it && it.w <= w) {
            const takeVal = dp[i-1][w - it.w].val + it.v;
            if (takeVal > candidate) {
              candidate = takeVal;
              from = {desc: `take (dp[${i-1}][${w-it.w}] + ${it.v} = ${takeVal})`, choice:'take', fromIndex: w - it.w};
            } else {
              from = {desc: `not take (${prevVal})`, choice:'not'};
            }
          } else {
            from = {desc: `not take (${prevVal})`, choice:'not'};
          }

          updateCell(i, w, candidate, from);

          // update calculation text live
          calcText.textContent = `Computing dp[${i}][${w}]: ${from.desc}`;

          // advance step counters
          if (wStep < capacity) {
            wStep++;
          } else {
            // move to next item row
            iStep++;
            wStep = 0;
          }

          // if we processed past n, finalize
          if (iStep > n) {
            finalize();
            stopPlaying();
          } else {
            status.textContent = `Status: Processing item ${Math.min(iStep, n)} / ${n}`;
          }
        }

        function finalize() {
          status.textContent = 'Status: Completed ‚Äî reconstructing solution';
          // show final max value
          const n = items.length;
          const maxVal = dp[n][capacity].val;
          maxValueEl.textContent = String(maxVal);
          // reconstruct chosen items
          const chosen = [];
          let w = capacity;
          for (let i = n; i > 0; i--) {
            const cell = dp[i][w];
            const prev = dp[i-1][w];
            // If value differs from previous row, it must have been taken
            if (cell.val !== prev.val) {
              // determine which item was taken using recorded 'from' chain if present
              chosen.push({index: i-1, ...items[i-1]});
              w = w - items[i-1].w;
            } else {
              // not taken, move up
            }
          }
          chosen.reverse();
          selectedText.textContent = chosen.length ? `Selected items: ${chosen.map((c,i)=>`#${c.index+1}(w${c.w},v${c.v})`).join(', ')}` : 'Selected items: ‚Äî (none)';
          animateBackpack(chosen);
        }

        // Animate selected items into backpack area
        function animateBackpack(chosen) {
          // clear existing
          backpack.querySelectorAll('.bp-item').forEach(e => e.remove());
          // calculate positions: spread items horizontally in backpack
          const containerRect = backpack.getBoundingClientRect();
          const cnt = chosen.length;
          if (cnt === 0) return;
          const spacing = Math.max(12, Math.min((containerRect.width - 40) / cnt, 80));
          chosen.forEach((c, idx) => {
            const el = document.createElement('div');
            el.className = 'bp-item';
            el.innerHTML = `<strong>W:${c.w}</strong><span style="opacity:.7">V:${c.v}</span>`;
            backpack.appendChild(el);
            // start the element off-screen top-right and animate into position
            el.style.left = (containerRect.width + 40) + 'px';
            el.style.top  = (-40) + (idx*8) + 'px';
            // force layout
            void el.offsetWidth;
            // final position centered-ish
            const targetLeft = Math.max(12, 12 + idx * spacing);
            const targetTop = 30 + (Math.random()*24 - 12); // slight jitter
            el.style.transition = 'transform 700ms cubic-bezier(.2,.9,.3,1), left 700ms cubic-bezier(.2,.9,.3,1), top 700ms cubic-bezier(.2,.9,.3,1)';
            el.style.left = targetLeft + 'px';
            el.style.top = targetTop + 'px';
            // make accessible label
            el.setAttribute('role','img');
            el.setAttribute('aria-label', `Selected item ${idx+1}, weight ${c.w}, value ${c.v}`);
          });
        }

        // Play/pause
        function startPlaying() {
          if (playing) return;
          playing = true;
          playBtn.textContent = 'Pause';
          playBtn.setAttribute('aria-pressed','true');
          status.textContent = 'Status: Playing...';
          const interval = Math.max(100, Number(speed.value) || 700);
          timer = setInterval(() => {
            stepOnce();
          }, interval);
        }

        function stopPlaying() {
          if (timer) {
            clearInterval(timer);
            timer = null;
          }
          playing = false;
          playBtn.textContent = 'Play';
          playBtn.setAttribute('aria-pressed','false');
        }

        playBtn.addEventListener('click', () => {
          if (playing) stopPlaying();
          else startPlaying();
        });

        stepBtn.addEventListener('click', () => {
          stopPlaying();
          stepOnce();
        });

        resetBtn.addEventListener('click', () => {
          stopPlaying();
          rebuildDP();
          status.textContent = 'Status: Reset';
        });

        speed.addEventListener('input', () => {
          if (playing) {
            // restart timer with new speed
            stopPlaying();
            startPlaying();
          }
        });

        // Initialize with sample
        function initSample() {
          items = [{w:3,v:4,id:uid()},{w:4,v:5,id:uid()},{w:2,v:3,id:uid()}];
          capacity = 7;
          capInput.value = capacity;
          capRange.value = Math.min(50, capacity);
          renderItems();
          rebuildDP();
        }

        // Accessibility: keyboard shortcuts
        window.addEventListener('keydown', (e) => {
          if (e.key === ' ') { // space toggles play/pause when focused outside inputs
            if (document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') {
              e.preventDefault();
              if (playing) stopPlaying(); else startPlaying();
            }
          }
          if (e.key === 'ArrowRight') {
            if (document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') {
              e.preventDefault();
              stepOnce();
            }
          }
        });

        // Initial load
        initSample();

        // Expose a simple trace for screen reader: announce table progress
        const observer = new MutationObserver(() => {
          // Announce the top-right cell updated value for screen readers
          const n = items.length;
          if (n >= 0) {
            const last = dp[n] ? dp[n][capacity] : null;
            if (last) {
              status.setAttribute('aria-live','polite');
            }
          }
        });
        observer.observe(dpTable, { childList: true, subtree: true });
      })();
    </script>
  </main>
</body>
</html>