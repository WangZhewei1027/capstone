<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bubble Sort Interactive Module</title>
  <style>
    :root{
      --safe-margin: 24px;
      --gap: 16px;
      --bg: #0f1720;
      --panel: #0b1220;
      --muted: #98a0ad;
      --accent: #38bdf8;
      --good: #34d399;
      --bad: #fb7185;
      --highlight: #fde68a;
      --radius: 10px;
      --font-sans: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    html,body{
      height:100%;
      margin:0;
      background: linear-gradient(180deg,#06101a 0%, #071422 100%);
      color:#e6eef6;
      font-family: var(--font-sans);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Container follows safe margins */
    .container{
      padding: var(--safe-margin);
      box-sizing:border-box;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      gap: var(--gap);
    }

    header{
      display:flex;
      gap: var(--gap);
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    .title{
      display:flex;
      gap:12px;
      align-items:baseline;
    }

    h1{
      margin:0;
      font-size:22px;
    }

    .subtitle{
      margin:0;
      color:var(--muted);
      font-size:13px;
    }

    /* Two-column main area */
    .main{
      display:grid;
      grid-template-columns: 1fr 380px;
      gap: var(--gap);
      align-items:start;
    }

    /* Left: interactive visualization */
    .module{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.02);
      min-height:360px;
    }

    /* Controls row */
    .controls{
      display:flex;
      gap: var(--gap);
      flex-wrap:wrap;
      margin-bottom: 12px;
      align-items:center;
    }

    .controls > *{ min-width: 0; }

    .control-group{
      display:flex;
      gap:8px;
      align-items:center;
    }

    label{
      font-size:13px;
      color:var(--muted);
    }

    input[type="text"]{
      padding:8px 10px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.06);
      background: rgba(255,255,255,0.02);
      color:inherit;
      outline:none;
      min-width:220px;
    }

    input[type="range"]{
      accent-color: var(--accent);
      width:140px;
    }

    button{
      padding:8px 12px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.06);
      background: rgba(255,255,255,0.03);
      color:inherit;
      cursor:pointer;
      font-weight:600;
    }

    button.primary{
      background: linear-gradient(90deg,var(--accent), #60a5fa);
      border: none;
      color:#04293a;
      box-shadow: 0 6px 14px rgba(56,189,248,0.12);
    }

    button:disabled{ opacity:0.45; cursor:not-allowed; }

    /* Visualization area */
    .viz{
      border-radius:8px;
      padding:12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height:220px;
    }

    .bars{
      display:flex;
      gap:8px;
      align-items:end;
      height:220px;
      padding:12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.0), rgba(255,255,255,0.0));
      border-radius:6px;
      justify-content:center;
    }

    .bar{
      --h: 50%;
      width:36px;
      height:var(--h);
      background:linear-gradient(180deg,#1e293b,#0f1720);
      border-radius:6px 6px 2px 2px;
      display:flex;
      align-items:flex-end;
      justify-content:center;
      position:relative;
      transition: height 320ms cubic-bezier(.2,.9,.3,1), background-color 220ms;
      box-shadow: 0 2px 6px rgba(2,6,23,0.6);
      color: #e6eef6;
      font-size:12px;
      user-select:none;
    }

    .bar .label{
      background: rgba(0,0,0,0.35);
      padding:2px 4px;
      border-radius:4px;
      margin-bottom:8px;
      font-weight:700;
      font-size:12px;
    }

    .bar.compare{ background: linear-gradient(180deg,#ffedd5,#ffb4a2); color:#2b1a0f; }
    .bar.swap{ background: linear-gradient(180deg,#fecaca,#fca5a5); color:#2b1a0f; }
    .bar.sorted{ background: linear-gradient(180deg,#bbf7d0,#86efac); color:#053018; }
    .bar.selected{ outline:3px solid rgba(96,165,250,0.12); }

    /* Right panel: info and pseudocode */
    .info{
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      border-radius: var(--radius);
      padding:16px;
      min-height:360px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .counters{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
    }

    .counter{
      background: rgba(255,255,255,0.02);
      padding:10px;
      border-radius:8px;
      min-width:110px;
      text-align:center;
    }

    .counter .num{ font-size:18px; font-weight:800; }
    .counter .label{ font-size:12px; color:var(--muted); }

    pre.pseudo{
      background: rgba(2,6,23,0.6);
      padding:12px;
      border-radius:8px;
      overflow:auto;
      font-size:13px;
      line-height:1.5;
      margin:0;
    }

    .pseudo-line{
      display:block;
      padding:3px 6px;
      border-radius:6px;
    }

    .pseudo-line.current{
      background: linear-gradient(90deg, rgba(56,189,248,0.12), rgba(96,165,250,0.06));
      border-left:4px solid rgba(56,189,248,0.18);
    }

    .legend{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }

    .legend .chip{
      display:flex;
      gap:8px;
      align-items:center;
      font-size:13px;
      color:var(--muted);
    }

    .chip .swatch{
      width:14px;
      height:14px;
      border-radius:3px;
      border:1px solid rgba(255,255,255,0.04);
    }

    /* footer instructions */
    .notes{
      color:var(--muted);
      font-size:13px;
      margin-top:4px;
    }

    /* Responsiveness */
    @media (max-width:980px){
      .main{ grid-template-columns: 1fr; }
      .info{ order:2; }
    }

    /* Focus styles */
    button:focus, input:focus{
      outline: 3px solid rgba(96,165,250,0.12);
      outline-offset:2px;
    }

  </style>
</head>
<body>
  <div class="container" role="main">
    <header>
      <div class="title">
        <div>
          <h1>Bubble Sort — Step-by-step Visualizer</h1>
          <p class="subtitle">An interactive module to explore comparisons, swaps, and pass structure of Bubble Sort.</p>
        </div>
      </div>

      <div style="min-width:240px;">
        <div style="background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;text-align:right;">
          <div style="font-size:13px;color:var(--muted)">Concept</div>
          <div style="font-weight:700">Bubble Sort</div>
        </div>
      </div>
    </header>

    <!-- Design plan section (brief) -->
    <section style="display:flex;gap:var(--gap);flex-direction:column;">
      <div style="background:rgba(255,255,255,0.01);padding:12px;border-radius:10px;">
        <strong>Learning Objective:</strong>
        <div class="notes" style="margin-top:8px;">
          After interacting with this module, you will be able to:
          - Explain how Bubble Sort compares adjacent elements and moves larger elements to the end each pass.
          - Predict number of comparisons and swaps in a pass.
          - Observe the early-exit optimization (detecting already-sorted arrays).
        </div>
      </div>

      <div style="display:flex;gap:var(--gap);flex-wrap:wrap;">
        <div style="flex:1; min-width:300px; background:rgba(255,255,255,0.01); padding:12px; border-radius:10px;">
          <strong>Interaction Design</strong>
          <p class="notes" style="margin-top:8px;">
            - Users can enter a custom array (comma-separated) or generate a random array. Use Step to advance a single comparison (and possible swap), or Auto-play to run continuously.  
            - Visual feedback: when two adjacent elements are compared, their bars change color; swaps animate by changing bar heights and values. After each pass, the rightmost sorted bar is marked.  
            - Pseudocode on the right highlights the currently executed line to map visual actions to algorithm steps. Counters display comparisons, swaps, and current pass.
          </p>
        </div>

        <div style="flex:1; min-width:300px; background:rgba(255,255,255,0.01); padding:12px; border-radius:10px;">
          <strong>Layout Description</strong>
          <p class="notes" style="margin-top:8px;">
            - Safe area margin: 24px on all sides; min spacing 16px between controls.  
            - Left column: controls and visualization (bars). Right column: stats and pseudocode. On narrow screens it stacks vertically.  
            - Controls grouped logically (input, generation, playback). Buttons sized for keyboard focus and touch. Colors and contrast chosen for accessibility; semantic labels and keyboard shortcuts (Space = step) are supported.
          </p>
        </div>
      </div>
    </section>

    <!-- Main interactive area -->
    <div class="main" aria-label="Bubble Sort Module">
      <!-- Left: module -->
      <section class="module" aria-labelledby="module-title">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div id="module-title" style="font-weight:800;">Interact with the array</div>
          <div style="color:var(--muted);font-size:13px;">Tip: Press Space to Step</div>
        </div>

        <div class="controls" role="region" aria-label="Controls">
          <div class="control-group">
            <label for="array-input">Array (comma-separated)</label>
            <input id="array-input" type="text" aria-label="Array input" placeholder="e.g. 5,3,8,1,7"/>
            <button id="set-array" title="Set array from input">Set</button>
          </div>

          <div class="control-group">
            <label for="size-range">Size</label>
            <input id="size-range" type="range" min="4" max="12" value="8" aria-label="Array size"/>
            <button id="randomize">Randomize</button>
          </div>

          <div style="margin-left:auto;display:flex;gap:8px;">
            <button id="step-btn" class="primary" title="Step one comparison">Step</button>
            <button id="play-btn" title="Auto play (toggle)">Play</button>
            <button id="reset-btn" title="Reset to original array">Reset</button>
          </div>
        </div>

        <div class="controls" style="align-items:center;">
          <div class="control-group">
            <label for="speed-range">Speed</label>
            <input id="speed-range" type="range" min="50" max="1200" value="450" aria-label="Speed (ms per step)"/>
            <span style="color:var(--muted);font-size:13px;">ms/step</span>
          </div>

          <div class="control-group">
            <input type="checkbox" id="optimize" checked />
            <label for="optimize" style="margin:0">Optimized early-exit</label>
          </div>

          <div style="margin-left:auto;color:var(--muted);font-size:13px;">
            <strong id="status">Ready</strong>
          </div>
        </div>

        <div class="viz" aria-live="polite">
          <div class="bars" id="bars" role="list" aria-label="Array bars">
            <!-- bars inserted here -->
          </div>

          <div style="display:flex;justify-content:space-between;align-items:center;">
            <div class="notes">Click a bar to toggle "select" for manual swaps (click second to swap).</div>
            <div style="display:flex;gap:8px;align-items:center;">
              <button id="manual-swap-btn" title="Toggle manual swap mode">Manual Swap Mode</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Right: info -->
      <aside class="info" aria-labelledby="info-title">
        <div id="info-title" style="font-weight:800;">Algorithm Details & Counters</div>

        <div class="counters" aria-hidden="false">
          <div class="counter" aria-label="comparisons">
            <div class="num" id="comp-count">0</div>
            <div class="label">Comparisons</div>
          </div>
          <div class="counter">
            <div class="num" id="swap-count">0</div>
            <div class="label">Swaps</div>
          </div>
          <div class="counter">
            <div class="num" id="pass-num">0</div>
            <div class="label">Current Pass</div>
          </div>
          <div class="counter">
            <div class="num" id="remaining">—</div>
            <div class="label">Remaining (unsorted)</div>
          </div>
        </div>

        <div>
          <div style="font-weight:700;margin-bottom:6px;">Pseudocode</div>
          <pre class="pseudo" id="pseudocode" tabindex="0" aria-label="Pseudocode">
<span class="pseudo-line" data-line="1">for i = 0 to n-2</span>
<span class="pseudo-line" data-line="2">  swapped = false</span>
<span class="pseudo-line" data-line="3">  for j = 0 to n-2-i</span>
<span class="pseudo-line" data-line="4">    if A[j] &gt; A[j+1]</span>
<span class="pseudo-line" data-line="5">      swap(A[j], A[j+1])</span>
<span class="pseudo-line" data-line="6">      swapped = true</span>
<span class="pseudo-line" data-line="7">  if not swapped</span>
<span class="pseudo-line" data-line="8">    break</span>
          </pre>
        </div>

        <div style="margin-top:6px;">
          <div style="font-weight:700;margin-bottom:6px;">Legend</div>
          <div class="legend">
            <div class="chip"><div class="swatch" style="background:linear-gradient(180deg,#fecaca,#fca5a5)"></div> Comparing / Swapping</div>
            <div class="chip"><div class="swatch" style="background:linear-gradient(180deg,#bbf7d0,#86efac)"></div> Sorted position</div>
            <div class="chip"><div class="swatch" style="background:linear-gradient(180deg,#1e293b,#0f1720)"></div> Unprocessed</div>
          </div>
        </div>

        <div style="margin-top:auto;font-size:13px;color:var(--muted);">
          Controls map: Step = Space (when page focused). Use Manual Swap to try swapping elements directly for experimentation.
        </div>
      </aside>
    </div>

    <footer style="margin-top:8px;color:var(--muted);font-size:13px;">
      This interactive module focuses on one concept: Bubble Sort. It is self-contained and uses only HTML, CSS, and JavaScript.
    </footer>
  </div>

  <script>
    (function(){
      // Utility
      const qs = s => document.querySelector(s);
      const qsa = s => Array.from(document.querySelectorAll(s));
      const sleep = ms => new Promise(r => setTimeout(r, ms));

      // Elements
      const barsEl = qs('#bars');
      const arrayInput = qs('#array-input');
      const setArrayBtn = qs('#set-array');
      const randomizeBtn = qs('#randomize');
      const sizeRange = qs('#size-range');
      const stepBtn = qs('#step-btn');
      const playBtn = qs('#play-btn');
      const resetBtn = qs('#reset-btn');
      const speedRange = qs('#speed-range');
      const optimizeChk = qs('#optimize');
      const compCountEl = qs('#comp-count');
      const swapCountEl = qs('#swap-count');
      const passNumEl = qs('#pass-num');
      const remainingEl = qs('#remaining');
      const statusEl = qs('#status');
      const pseudoLines = qsa('.pseudo-line');
      const manualSwapBtn = qs('#manual-swap-btn');
      const manualSwapState = {on:false, firstIndex:null};

      // State
      let array = [];
      let original = [];
      let n = 0;
      let i = 0; // pass
      let j = 0; // inner index
      let swapped = false;
      let comparisons = 0;
      let swaps = 0;
      let running = false;
      let autoplayInterval = null;
      let speed = Number(speedRange.value);
      let optimized = optimizeChk.checked;
      let status = 'Ready';

      function setStatus(s){
        status = s;
        statusEl.textContent = s;
      }

      function clamp(v, a, b){ return Math.min(b, Math.max(a, v)); }

      // Initialize with random array
      function randomArray(size){
        const arr = [];
        for(let k=0;k<size;k++){
          arr.push(Math.floor(Math.random() * 90) + 10); // values 10..99
        }
        return arr;
      }

      function renderBars(){
        barsEl.innerHTML = '';
        const max = Math.max(...array, 1);
        array.forEach((val, idx) => {
          const bar = document.createElement('div');
          bar.className = 'bar';
          bar.setAttribute('role','listitem');
          bar.setAttribute('data-index', idx);
          bar.tabIndex = 0;
          const heightPercent = Math.round((val / max) * 100);
          bar.style.setProperty('--h', heightPercent + '%');
          bar.innerHTML = `<div class="label" aria-hidden="true">${val}</div>`;
          // event: click to select for manual swap
          bar.addEventListener('click', () => {
            if(!manualSwapState.on) return;
            handleManualSelect(idx, bar);
          });
          barsEl.appendChild(bar);
        });
        markSortedPositions();
      }

      function handleManualSelect(idx, barEl){
        if(manualSwapState.firstIndex === null){
          manualSwapState.firstIndex = idx;
          barEl.classList.add('selected');
          setStatus('Selected index ' + idx + ' — choose second to swap');
        } else if(manualSwapState.firstIndex === idx){
          // deselect
          manualSwapState.firstIndex = null;
          barEl.classList.remove('selected');
          setStatus('Selection cleared');
        } else {
          // perform swap
          const a = manualSwapState.firstIndex;
          const b = idx;
          manualSwapState.firstIndex = null;
          // remove selected class from any
          qsa('.bar.selected').forEach(el => el.classList.remove('selected'));
          swapElements(a,b,true);
          setStatus(`Manual swap ${a} ↔ ${b}`);
        }
      }

      function swapElements(a,b,manual=false){
        // swap values and animate height change
        if(a<0||b<0||a>=n||b>=n) return;
        swaps++;
        swapCountEl.textContent = swaps;
        // mark swap visually
        const barA = barsEl.querySelector(`.bar[data-index="${a}"]`);
        const barB = barsEl.querySelector(`.bar[data-index="${b}"]`);
        if(barA) barA.classList.add('swap');
        if(barB) barB.classList.add('swap');

        // swap in array
        const tmp = array[a];
        array[a] = array[b];
        array[b] = tmp;
        // update DOM labels and heights
        requestAnimationFrame(() => {
          const max = Math.max(...array, 1);
          if(barA){
            barA.style.setProperty('--h', Math.round((array[a]/max)*100) + '%');
            barA.querySelector('.label').textContent = array[a];
          }
          if(barB){
            barB.style.setProperty('--h', Math.round((array[b]/max)*100) + '%');
            barB.querySelector('.label').textContent = array[b];
          }
        });

        // remove swap class after animation
        setTimeout(() => {
          if(barA) barA.classList.remove('swap');
          if(barB) barB.classList.remove('swap');
          markSortedPositions();
        }, 360);
      }

      function markCompare(a,b){
        clearHighlights();
        const barA = barsEl.querySelector(`.bar[data-index="${a}"]`);
        const barB = barsEl.querySelector(`.bar[data-index="${b}"]`);
        if(barA) barA.classList.add('compare');
        if(barB) barB.classList.add('compare');
      }

      function clearHighlights(){
        qsa('.bar.compare').forEach(el => el.classList.remove('compare'));
        qsa('.bar.swap').forEach(el => el.classList.remove('swap'));
      }

      function markSortedPositions(){
        // After each pass i, positions from n-i to end are sorted
        qsa('.bar').forEach(el => el.classList.remove('sorted'));
        for(let k = n - i; k < n; k++){
          if(k >= 0 && k < n){
            const el = barsEl.querySelector(`.bar[data-index="${k}"]`);
            if(el) el.classList.add('sorted');
          }
        }
        remainingEl.textContent = Math.max(0, n - i);
      }

      function resetState(toOriginal=false){
        if(toOriginal){
          array = original.slice();
        }
        i = 0; j = 0; swapped = false;
        comparisons = 0; swaps = 0;
        compCountEl.textContent = comparisons;
        swapCountEl.textContent = swaps;
        passNumEl.textContent = i;
        remainingEl.textContent = n;
        setStatus('Ready');
        running = false;
        clearInterval(autoplayInterval);
        playBtn.textContent = 'Play';
        clearHighlights();
        renderBars();
        highlightPseudo(null);
      }

      function highlightPseudo(line){
        pseudoLines.forEach(l => {
          l.classList.toggle('current', l.getAttribute('data-line') === String(line));
        });
      }

      // Step logic: advances by one comparison (and swap if necessary)
      let stepInProgress = false;
      async function step(){
        if(stepInProgress) return;
        if(i >= n-1){
          setStatus('Array sorted');
          highlightPseudo(null);
          markAllSorted();
          return;
        }
        stepInProgress = true;
        setStatus('Stepping');
        passNumEl.textContent = i+1;
        // Start inner loop if j at 0 => new pass
        if(j === 0){
          swapped = false;
          highlightPseudo(2); // swapped = false
          await sleep(120);
        }
        highlightPseudo(3); // inner for
        // compare A[j] and A[j+1]
        highlightPseudo(4);
        markCompare(j, j+1);
        comparisons++;
        compCountEl.textContent = comparisons;
        await sleep( Math.max(120, speed * 0.5) );

        if(array[j] > array[j+1]){
          // swap
          highlightPseudo(5);
          markCompare(j, j+1);
          swapElements(j, j+1);
          swapped = true;
          await sleep( Math.max(180, speed * 0.6) );
          highlightPseudo(6);
          await sleep(100);
        }
        clearHighlights();
        j++;
        // end of pass
        if(j >= n-1-i){
          // mark last element of this pass as sorted
          i++;
          passNumEl.textContent = i;
          markSortedPositions();
          highlightPseudo(7);
          await sleep(80);
          if(!swapped && optimized){
            // already sorted, finish
            highlightPseudo(8);
            setStatus('Early exit — array sorted');
            // mark everything sorted
            markAllSorted();
            stepInProgress = false;
            running = false;
            clearInterval(autoplayInterval);
            playBtn.textContent = 'Play';
            return;
          }
          j = 0;
        }
        // check if done
        if(i >= n-1){
          setStatus('Array sorted');
          markAllSorted();
        } else {
          setStatus('Ready');
        }
        stepInProgress = false;
      }

      function markAllSorted(){
        qsa('.bar').forEach(el => el.classList.add('sorted'));
        highlightPseudo(null);
      }

      // Autoplay toggle
      function togglePlay(){
        if(running){
          running = false;
          clearInterval(autoplayInterval);
          playBtn.textContent = 'Play';
          setStatus('Paused');
        } else {
          running = true;
          playBtn.textContent = 'Pause';
          setStatus('Auto-playing');
          autoplayInterval = setInterval(async () => {
            if(!running) return;
            await step();
            if(i >= n-1){
              running = false;
              clearInterval(autoplayInterval);
              playBtn.textContent = 'Play';
              setStatus('Finished');
            }
          }, Math.max(60, speed));
        }
      }

      // Attach events
      setArrayBtn.addEventListener('click', () => {
        const text = arrayInput.value.trim();
        if(!text) return;
        const parts = text.split(',').map(s => parseInt(s.trim(),10)).filter(x=>!Number.isNaN(x));
        if(parts.length < 2) { alert('Enter at least two numbers'); return; }
        array = parts.slice();
        original = array.slice();
        n = array.length;
        sizeRange.value = clamp(n, 4, 12);
        resetState(true);
      });

      randomizeBtn.addEventListener('click', () => {
        const size = parseInt(sizeRange.value,10);
        array = randomArray(size);
        original = array.slice();
        n = array.length;
        arrayInput.value = array.join(',');
        resetState(true);
      });

      sizeRange.addEventListener('input', () => {
        const size = parseInt(sizeRange.value,10);
        // update but don't overwrite current unless randomize clicked
      });

      stepBtn.addEventListener('click', async () => {
        if(running) return;
        await step();
      });

      playBtn.addEventListener('click', () => {
        togglePlay();
      });

      resetBtn.addEventListener('click', () => {
        resetState(true);
      });

      speedRange.addEventListener('input', () => {
        speed = Number(speedRange.value);
      });

      optimizeChk.addEventListener('change', () => {
        optimized = optimizeChk.checked;
      });

      manualSwapBtn.addEventListener('click', () => {
        manualSwapState.on = !manualSwapState.on;
        manualSwapState.firstIndex = null;
        qsa('.bar.selected').forEach(el => el.classList.remove('selected'));
        manualSwapBtn.textContent = manualSwapState.on ? 'Manual Swap: ON' : 'Manual Swap Mode';
        setStatus(manualSwapState.on ? 'Manual swap: select two bars' : 'Manual swap: off');
      });

      // Keyboard: Space to step
      window.addEventListener('keydown', (e) => {
        if(e.code === 'Space' && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA'){
          e.preventDefault();
          if(!running) step();
        }
      });

      // Initialize default array
      function init(){
        array = randomArray(Number(sizeRange.value));
        original = array.slice();
        n = array.length;
        arrayInput.value = array.join(',');
        resetState(true);
      }

      init();

      // Expose to console for debugging (optional)
      window._bubble = {
        get array(){ return array.slice(); },
        step,
        reset: () => resetState(true)
      };
    })();
  </script>
</body>
</html>