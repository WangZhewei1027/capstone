<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Binary Search — Interactive Module</title>
  <style>
    :root{
      --safe-margin: 24px;
      --gap: 16px;
      --bg: #0f1724;
      --card: #0b1220;
      --accent: #06b6d4;
      --muted: #94a3b8;
      --good: #10b981;
      --bad: #ef4444;
      --glass: rgba(255,255,255,0.04);
      --radius: 10px;
      --transition: 300ms cubic-bezier(.2,.9,.3,1);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color-scheme: dark;
    }

    /* Layout safe area & spacing */
    html,body{
      height:100%;
      margin:0;
      background: linear-gradient(180deg,#041224 0%, #071827 60%);
      color: #e6eef8;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    .app{
      box-sizing:border-box;
      padding: var(--safe-margin);
      min-height:100vh;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      gap:var(--gap);
    }

    /* Container */
    .module{
      width: min(1200px, 100%);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border: 1px solid rgba(255,255,255,0.03);
      border-radius: 14px;
      padding: 20px;
      box-shadow: 0 6px 30px rgba(2,6,23,0.6);
      display:flex;
      gap:var(--gap);
      flex-wrap:wrap;
      align-items:stretch;
    }

    /* Left panel: controls & descriptions */
    .panel-left{
      flex: 0 1 360px;
      min-width: 280px;
      display:flex;
      flex-direction:column;
      gap:var(--gap);
    }
    .panel-right{
      flex:1 1 600px;
      display:flex;
      flex-direction:column;
      gap:var(--gap);
      min-width:300px;
    }

    .card{
      background: var(--card);
      border-radius: var(--radius);
      padding: 14px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.02);
    }

    h1{
      font-size:18px;
      margin:0 0 6px 0;
      color: #dff9ff;
    }
    p.lead{
      margin:0;
      color:var(--muted);
      font-size:13px;
    }

    /* Controls */
    .controls{
      display:flex;
      flex-direction:column;
      gap:var(--gap);
    }
    .row{
      display:flex;
      gap:var(--gap);
      align-items:center;
      flex-wrap:wrap;
    }
    label{
      font-size:13px;
      color:var(--muted);
    }
    input[type="range"]{
      width:100%;
    }
    input[type="text"], textarea{
      width:100%;
      background:var(--glass);
      border:1px solid rgba(255,255,255,0.03);
      color:inherit;
      padding:8px 10px;
      border-radius:8px;
      font-size:13px;
      outline:none;
      transition: box-shadow var(--transition);
    }
    input[type="text"]:focus, textarea:focus{
      box-shadow:0 4px 18px rgba(6,182,212,0.12);
      border-color: rgba(6,182,212,0.25);
    }

    .btn{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.04);
      color:inherit;
      padding:8px 12px;
      border-radius:8px;
      font-weight:600;
      cursor:pointer;
      transition: transform var(--transition), box-shadow var(--transition), background var(--transition);
    }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      background: linear-gradient(180deg, rgba(6,182,212,0.12), rgba(6,182,212,0.06));
      border: 1px solid rgba(6,182,212,0.18);
      color: #e6fbff;
      box-shadow: 0 6px 18px rgba(6,182,212,0.06);
    }
    .btn.ghost{
      background:transparent;
      border:1px dashed rgba(255,255,255,0.04);
    }

    .tog{
      display:inline-flex;
      align-items:center;
      gap:8px;
    }

    /* Visualizer */
    .visual{
      display:flex;
      flex-direction:column;
      gap:var(--gap);
      align-items:stretch;
    }

    .array-row{
      display:flex;
      gap:12px;
      justify-content:center;
      align-items:end;
      padding:12px;
      flex-wrap:wrap;
    }
    .cell{
      width:56px;
      height:56px;
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius:10px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.03);
      font-weight:700;
      font-size:15px;
      color: #e9f7fb;
      position:relative;
      transition: transform var(--transition), opacity var(--transition), box-shadow var(--transition), background var(--transition);
      user-select:none;
      cursor:pointer;
    }
    .cell:focus{ outline:2px solid rgba(6,182,212,0.12); }
    .cell.eliminated{
      opacity:0.24;
      transform: translateY(6px) scale(0.96);
      filter: grayscale(60%);
      background:linear-gradient(180deg, rgba(10,12,16,0.25), rgba(8,10,14,0.25));
      cursor:default;
    }
    .cell.mid{
      background: linear-gradient(180deg, #ffedd5 0%, #ffd5b1 100%);
      color:#2b1f0f;
      box-shadow: 0 8px 18px rgba(255,187,85,0.12);
      transform: translateY(-6px) scale(1.03);
    }
    .cell.left, .cell.right{
      box-shadow: 0 6px 14px rgba(6,182,212,0.06);
      transform: translateY(-4px);
      outline: 3px solid rgba(6,182,212,0.06);
    }
    .cell.left{ background: linear-gradient(180deg, rgba(6,182,212,0.08), rgba(6,182,212,0.04)); }
    .cell.right{ background: linear-gradient(180deg, rgba(16,185,129,0.06), rgba(16,185,129,0.03)); }

    .pointer{
      position:absolute;
      top:-22px;
      left:50%;
      transform:translateX(-50%);
      font-size:12px;
      padding:2px 6px;
      border-radius:6px;
      background:rgba(255,255,255,0.06);
      color:var(--muted);
    }

    /* Code pane */
    .code-pane{
      background: linear-gradient(180deg, rgba(2,6,23,0.4), rgba(3,9,27,0.36));
      color:#d7eef7;
      padding:12px;
      border-radius:10px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
      font-size:13px;
      line-height:1.5;
      border:1px solid rgba(255,255,255,0.03);
      min-width:240px;
    }
    .code-line{
      padding:4px 8px;
      border-radius:6px;
      transition: background var(--transition), color var(--transition);
    }
    .code-line.active{
      background: linear-gradient(90deg, rgba(6,182,212,0.12), rgba(6,182,212,0.06));
      color: #eaffff;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.02);
    }

    /* Stats */
    .stats{
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
    }
    .stat{
      padding:8px 12px;
      background:rgba(255,255,255,0.02);
      border-radius:10px;
      color:var(--muted);
      font-weight:700;
      min-width:120px;
      text-align:center;
    }
    .status{
      margin-top:6px;
      font-size:13px;
      color:var(--muted);
    }

    /* small screens */
    @media (max-width:900px){
      .panel-left{ flex-basis:100%; }
      .panel-right{ flex-basis:100%; }
      .array-row{ gap:10px; }
      .cell{ width:48px; height:48px; font-size:13px; }
    }
  </style>
</head>
<body>
  <div class="app" role="main">
    <div class="module" aria-labelledby="title">
      <div class="panel-left" aria-label="Controls and description">
        <div class="card" id="intro">
          <h1 id="title">Binary Search — Single Concept Module</h1>
          <p class="lead"><strong>Concept:</strong> Efficiently locate a target in a sorted array by repeatedly dividing the search interval in half.</p>
          <p class="lead" style="margin-top:8px;"><strong>Learning objective:</strong> After interacting, you will be able to (1) visualize how left/mid/right change over iterations, (2) see which elements are eliminated at each comparison, and (3) use stepping and autoplay to internalize the halving strategy and its O(log n) behavior.</p>
        </div>

        <div class="card" aria-labelledby="controls-title">
          <div class="row" style="justify-content:space-between;align-items:flex-end;">
            <div>
              <label id="controls-title">Array configuration</label>
              <div style="font-size:12px;color:var(--muted);margin-top:6px;">Create a sorted array or enter your own (comma separated)</div>
            </div>
            <div style="display:flex;gap:8px;align-items:center;">
              <button class="btn ghost" id="shuffleBtn" title="Shuffle & sort">New</button>
              <button class="btn" id="randomizeBtn" title="Random unique">Unique</button>
            </div>
          </div>

          <div style="margin-top:12px; display:flex; gap:var(--gap); flex-direction:column;">
            <div class="row" style="align-items:center;">
              <label for="sizeRange" style="min-width:80px;">Size</label>
              <input id="sizeRange" type="range" min="5" max="25" value="11" aria-label="Array size">
              <div style="width:45px;text-align:right;color:var(--muted);" id="sizeLabel">11</div>
            </div>

            <div class="row">
              <label style="min-width:80px;">Custom array</label>
              <input id="customArray" type="text" placeholder="e.g. 1,3,5,8,12">
            </div>

            <div class="row">
              <label style="min-width:80px;">Target</label>
              <input id="targetInput" type="text" placeholder="Click a value or type target">
            </div>

            <div class="row" style="justify-content:space-between;">
              <div style="display:flex;gap:8px;">
                <button class="btn primary" id="stepBtn" aria-live="polite">Step</button>
                <button class="btn" id="playBtn">Play</button>
                <button class="btn" id="resetBtn">Reset</button>
              </div>
              <div style="display:flex;gap:8px;align-items:center;">
                <label style="font-size:13px;color:var(--muted);">Speed</label>
                <input id="speedRange" type="range" min="200" max="1400" value="700" step="100" title="Playback speed ms">
              </div>
            </div>

            <div class="row" style="justify-content:space-between;align-items:center;">
              <label class="tog"><input id="allowEqualLeft" type="checkbox" style="accent-color:var(--accent)" checked> Prefer left on equals</label>
              <label class="tog"><input id="autoScroll" type="checkbox" style="accent-color:var(--accent)" checked> Auto-scroll steps</label>
            </div>
          </div>
        </div>

        <div class="card" aria-labelledby="design-title">
          <h1 id="design-title" style="font-size:15px;margin-bottom:8px;">Interaction Design & Layout</h1>
          <div style="font-size:13px;color:var(--muted);line-height:1.4;">
            <strong>Interaction flow:</strong>
            <ul style="margin:8px 0 0 18px;padding:0;color:var(--muted);">
              <li>Generate or enter a sorted array. Click any cell to set the target instantly.</li>
              <li>Use "Step" to perform a single comparison — mid is highlighted and compared to target; eliminated segments fade.</li>
              <li>"Play" runs automatically with adjustable speed; "Reset" returns to initial state.</li>
              <li>Pseudocode panel highlights the current algorithm line. Stats update in real time.</li>
            </ul>
            <strong style="display:block;margin-top:8px;">Layout decisions:</strong>
            <ul style="margin:8px 0 0 18px;padding:0;color:var(--muted);">
              <li>Left column: controls, configuration and description (fixed width for clarity).</li>
              <li>Right column: visual array, pointers, pseudo-code and stats (flexible width).</li>
              <li>Safe margins are 24px; interactive elements are separated by at least 16px for comfortable touch targets.</li>
              <li>Responsive: stacks vertically on narrow screens; keyboard-accessible controls and ARIA labels included.</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="panel-right" aria-label="Visualization and pseudocode">
        <div class="card visual" role="region" aria-labelledby="visual-title">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <div>
              <h1 id="visual-title" style="font-size:16px;margin:0;">Array Visualization</h1>
              <div class="status" id="statusText">Click a value to set the target or type and press Enter.</div>
            </div>
            <div style="display:flex;gap:8px;align-items:center;">
              <div class="stat" aria-live="polite" id="cmpStat">Comparisons: 0</div>
              <div class="stat" aria-live="polite" id="iterStat">Iterations: 0</div>
            </div>
          </div>

          <div class="array-row card" id="arrayRow" tabindex="0" aria-label="Array of sorted values">
            <!-- Cells injected here -->
          </div>

          <div style="display:flex;gap:var(--gap);flex-wrap:wrap;">
            <div class="code-pane" id="codePane" aria-label="Binary search pseudocode">
              <div class="code-line" data-line="1">1. left = 0</div>
              <div class="code-line" data-line="2">2. right = n - 1</div>
              <div class="code-line" data-line="3">3. while left <= right:</div>
              <div class="code-line" data-line="4">4. &nbsp;&nbsp;mid = (left + right) // 2</div>
              <div class="code-line" data-line="5">5. &nbsp;&nbsp;if A[mid] == target: return mid</div>
              <div class="code-line" data-line="6">6. &nbsp;&nbsp;elif A[mid] < target: left = mid + 1</div>
              <div class="code-line" data-line="7">7. &nbsp;&nbsp;else: right = mid - 1</div>
              <div class="code-line" data-line="8">8. return -1</div>
            </div>

            <div style="flex:1 1 260px; display:flex;flex-direction:column;gap:12px;">
              <div class="card" style="display:flex;flex-direction:column;gap:8px;">
                <label style="font-size:13px;color:var(--muted);">Legend</label>
                <div style="display:flex;gap:8px;flex-wrap:wrap;">
                  <div class="cell mid" style="width:auto;height:36px;padding:0 10px;transform:none;">mid</div>
                  <div class="cell left" style="width:auto;height:36px;padding:0 10px;transform:none;">left</div>
                  <div class="cell right" style="width:auto;height:36px;padding:0 10px;transform:none;">right</div>
                  <div class="cell eliminated" style="width:auto;height:36px;padding:0 10px;transform:none;">eliminated</div>
                </div>
              </div>

              <div class="card">
                <label style="font-size:13px;color:var(--muted);">Controls tip</label>
                <ul style="margin:8px 0 0 18px;color:var(--muted);font-size:13px;">
                  <li>Keyboard: Space = Step, P = Play/Pause, R = Reset.</li>
                  <li>Click a cell to set the target quickly.</li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <div style="display:flex;gap:var(--gap);flex-wrap:wrap;">
          <div class="card" style="flex:1 1 420px;">
            <h1 style="font-size:15px;margin:0 0 8px 0;">Narration</h1>
            <div id="narration" style="color:var(--muted);font-size:14px;line-height:1.5;">
              Use Step to see each comparison. When mid equals target the cell flashes green; if not, the side that can no longer contain the target fades. Iterations grow logarithmically with size.
            </div>
          </div>

          <div class="card" style="flex:0 1 220px;min-width:200px;">
            <h1 style="font-size:15px;margin:0 0 8px 0;">Result</h1>
            <div id="resultBox" style="font-size:14px;color:var(--muted);">No search yet.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Binary Search Interactive Module (vanilla JS)
    (function(){
      // Elements
      const sizeRange = document.getElementById('sizeRange');
      const sizeLabel = document.getElementById('sizeLabel');
      const customArray = document.getElementById('customArray');
      const arrayRow = document.getElementById('arrayRow');
      const targetInput = document.getElementById('targetInput');
      const stepBtn = document.getElementById('stepBtn');
      const playBtn = document.getElementById('playBtn');
      const resetBtn = document.getElementById('resetBtn');
      const shuffleBtn = document.getElementById('shuffleBtn');
      const randomizeBtn = document.getElementById('randomizeBtn');
      const cmpStat = document.getElementById('cmpStat');
      const iterStat = document.getElementById('iterStat');
      const statusText = document.getElementById('statusText');
      const codePane = document.getElementById('codePane');
      const codeLines = Array.from(codePane.querySelectorAll('.code-line'));
      const speedRange = document.getElementById('speedRange');
      const allowEqualLeft = document.getElementById('allowEqualLeft');
      const autoScroll = document.getElementById('autoScroll');
      const narration = document.getElementById('narration');
      const resultBox = document.getElementById('resultBox');

      // State
      let arr = [];
      let initialArr = [];
      let left = 0, right = 0, mid = -1;
      let target = null;
      let comparisons = 0, iterations = 0;
      let playing = false, autoplayId = null;
      let speed = parseInt(speedRange.value,10) || 700;
      let prefLeftOnEqual = allowEqualLeft.checked;
      let lastAction = '';

      // Utilities
      function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }
      function setStatus(text){ statusText.textContent = text; }
      function updateStats(){
        cmpStat.textContent = 'Comparisons: ' + comparisons;
        iterStat.textContent = 'Iterations: ' + iterations;
      }
      function parseCustomArray(txt){
        const parts = txt.split(',').map(s=>s.trim()).filter(Boolean);
        const nums = parts.map(p=>Number(p)).filter(n=>!Number.isNaN(n));
        return nums;
      }
      function generateSortedUnique(n){
        const base = [];
        let v = 1;
        for(let i=0;i<n;i++){ v += Math.floor(Math.random()*3) + 1; base.push(v); }
        return base;
      }

      // Rendering
      function renderArray(){
        arrayRow.innerHTML = '';
        arr.forEach((val, idx)=>{
          const cell = document.createElement('div');
          cell.className = 'cell';
          cell.tabIndex = 0;
          cell.setAttribute('role','button');
          cell.setAttribute('aria-label','Value '+val+' at index '+idx);
          cell.textContent = val;
          cell.dataset.index = idx;
          if (idx < left || idx > right){
            cell.classList.add('eliminated');
          } else {
            cell.classList.remove('eliminated');
          }
          if (idx === mid) cell.classList.add('mid'); else cell.classList.remove('mid');
          if (idx === left) cell.classList.add('left'); else cell.classList.remove('left');
          if (idx === right) cell.classList.add('right'); else cell.classList.remove('right');

          // pointer label for accessibility
          if (idx===left || idx===right || idx===mid){
            const p = document.createElement('div');
            p.className = 'pointer';
            p.textContent = idx===mid ? 'mid' : (idx===left ? 'left' : 'right');
            cell.appendChild(p);
          }

          // clicking sets target
          cell.addEventListener('click', ()=> {
            const v = Number(val);
            if (!Number.isNaN(v)) {
              setTarget(v);
              flashCell(idx, 'selected');
            }
          });
          cell.addEventListener('keydown',(e)=>{
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              cell.click();
            }
          });
          arrayRow.appendChild(cell);
        });
        if (autoScroll.checked){
          arrayRow.scrollIntoView({behavior:'smooth', block:'center'});
        }
      }

      function flashCell(idx, type){
        const c = arrayRow.querySelector('[data-index="'+idx+'"]');
        if (!c) return;
        const prev = c.style.transition;
        c.style.transition = 'transform 160ms ease';
        c.animate([{transform:'scale(1.04)'},{transform:'scale(1)'}],{duration:220});
        setTimeout(()=> c.style.transition = prev, 300);
      }

      // Pseudocode highlight
      function highlightLine(n){
        codeLines.forEach(line=>{
          const num = Number(line.dataset.line);
          line.classList.toggle('active', num === n);
        });
      }

      // Algorithm step
      function initializeSearch(){
        left = 0;
        right = arr.length - 1;
        mid = -1;
        comparisons = 0;
        iterations = 0;
        playing = false;
        clearInterval(autoplayId);
        autoplayId = null;
        playBtn.textContent = 'Play';
        updateStats();
        highlightLine(0);
        setStatus('Ready. Press Step or Play to begin.');
        resultBox.textContent = 'No search yet.';
        renderArray();
      }

      // single comparison step returns object with outcome
      function stepOnce(){
        if (target === null || Number.isNaN(Number(target))){
          setStatus('Set a numeric target first (click a cell or type and Enter).');
          return {done:true, reason:'no-target'};
        }
        if (left > right){
          // done not found
          highlightLine(8);
          setStatus('Target not found.');
          resultBox.textContent = 'Result: not found (-1)';
          return {done:true, reason:'not-found'};
        }
        iterations++;
        const oldLeft = left, oldRight = right;
        // compute mid
        highlightLine(3);
        mid = Math.floor((left + right)/2);
        highlightLine(4);
        renderArray();
        comparisons++;
        updateStats();

        // compare
        highlightLine(5);
        setStatus(`Comparing A[${mid}] = ${arr[mid]} to target ${target}...`);
        const midVal = arr[mid];
        if (midVal === target){
          // found
          highlightLine(5);
          renderArray();
          // flash found
          const cell = arrayRow.querySelector('[data-index="'+mid+'"]');
          if (cell){
            cell.animate([
              { boxShadow: '0 0 0 0 rgba(16,185,129,0.0)', background: cell.style.background },
              { boxShadow: '0 0 0 10px rgba(16,185,129,0.14)', background: cell.style.background }
            ],{ duration: 700, easing:'ease' });
          }
          setStatus(`Found target at index ${mid} after ${iterations} iterations.`);
          resultBox.textContent = 'Result: index ' + mid;
          highlightLine(5);
          return {done:true, reason:'found', index:mid};
        } else if (midVal < target){
          highlightLine(6);
          // target is right
          left = mid + 1;
          setStatus(`A[${mid}] < target; eliminating indices <= ${mid}.`);
          // animate eliminated block on left
          fadeEliminated(oldLeft, mid);
        } else {
          highlightLine(7);
          // midVal > target
          right = mid -1;
          setStatus(`A[${mid}] > target; eliminating indices >= ${mid}.`);
          fadeEliminated(mid, oldRight);
        }
        renderArray();
        updateStats();
        return {done:false};
      }

      function fadeEliminated(lo, hi){
        // fade visually eliminated range lo..hi
        for(let i=lo;i<=hi;i++){
          const c = arrayRow.querySelector('[data-index="'+i+'"]');
          if (c){
            c.classList.add('eliminated');
            c.animate([{opacity:1, transform:'translateY(0) scale(1)'},{opacity:0.28, transform:'translateY(6px) scale(.96)'}],{duration:420,easing:'ease'});
          }
        }
      }

      // Play controls
      function play(){
        if (playing){
          playing = false;
          clearInterval(autoplayId);
          autoplayId = null;
          playBtn.textContent = 'Play';
          setStatus('Paused.');
          return;
        }
        playing = true;
        playBtn.textContent = 'Pause';
        setStatus('Playing...');
        autoplayId = setInterval(()=>{
          const res = stepOnce();
          if (res.done){
            clearInterval(autoplayId);
            autoplayId = null;
            playing = false;
            playBtn.textContent = 'Play';
          }
        }, Math.max(150, speed));
      }

      // Reset to initial array & search state
      function reset(){
        arr = initialArr.slice();
        target = null;
        targetInput.value = '';
        initializeSearch();
      }

      // Set target
      function setTarget(v){
        target = Number(v);
        targetInput.value = String(v);
        setStatus(`Target set to ${target}.`);
      }

      // Build initial
      function buildFromControls(){
        let parsed = parseCustomArray(customArray.value || '');
        if (parsed.length >= 2){
          // sort numeric ascending
          parsed = Array.from(new Set(parsed)).sort((a,b)=>a-b);
          arr = parsed.slice();
        } else {
          const n = Number(sizeRange.value) || 11;
          arr = generateSortedUnique(n);
        }
        initialArr = arr.slice();
        initializeSearch();
      }

      // Events
      sizeRange.addEventListener('input', ()=>{
        sizeLabel.textContent = sizeRange.value;
      });
      sizeRange.addEventListener('change', ()=> buildFromControls());
      customArray.addEventListener('change', ()=> buildFromControls());
      shuffleBtn.addEventListener('click', ()=>{
        // generate new sorted with same size
        arr = generateSortedUnique(Number(sizeRange.value));
        initialArr = arr.slice();
        customArray.value = '';
        initializeSearch();
      });
      randomizeBtn.addEventListener('click', ()=>{
        // random unique numbers (not necessarily contiguous)
        const n = Number(sizeRange.value);
        let set = new Set();
        while(set.size < n){
          set.add(Math.floor(Math.random()*100)+1);
        }
        arr = Array.from(set).sort((a,b)=>a-b);
        initialArr = arr.slice();
        customArray.value = '';
        initializeSearch();
      });

      targetInput.addEventListener('keydown', (e)=>{
        if (e.key === 'Enter'){
          const v = Number(targetInput.value);
          if (!Number.isNaN(v)){
            setTarget(v);
          } else {
            setStatus('Enter a numeric target.');
          }
        }
      });

      stepBtn.addEventListener('click', ()=>{
        const res = stepOnce();
        if (res && res.done){
          // final state reached
        }
      });

      playBtn.addEventListener('click', play);
      resetBtn.addEventListener('click', reset);

      speedRange.addEventListener('input', ()=>{
        speed = parseInt(speedRange.value,10);
      });

      allowEqualLeft.addEventListener('change', ()=>{
        prefLeftOnEqual = allowEqualLeft.checked;
      });

      // Keyboard shortcuts
      window.addEventListener('keydown', (e)=>{
        if (e.target && (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA')) return;
        if (e.code === 'Space'){
          e.preventDefault();
          stepBtn.focus();
          stepBtn.click();
        } else if (e.key.toLowerCase() === 'p'){
          playBtn.click();
        } else if (e.key.toLowerCase() === 'r'){
          resetBtn.click();
        }
      });

      // Initialize
      sizeLabel.textContent = sizeRange.value;
      buildFromControls();

      // Add ARIA live for narration / updates
      const liveRegion = document.createElement('div');
      liveRegion.setAttribute('aria-live','polite');
      liveRegion.style.position='absolute';
      liveRegion.style.left='-9999px';
      liveRegion.style.width='1px'; liveRegion.style.height='1px'; liveRegion.style.overflow='hidden';
      document.body.appendChild(liveRegion);

      // Reflect narration updates on status changes
      const statusObserver = new MutationObserver(()=>{
        liveRegion.textContent = statusText.textContent;
      });
      statusObserver.observe(statusText, {childList:true, subtree:true, characterData:true});

      // Tie rendering to window resize for responsive clarity
      window.addEventListener('resize', ()=> renderArray());

      // Ensure initial render
      renderArray();

      // Expose minimal debug on window for testing (safe)
      window._binarySearchModule = {
        getState: ()=>({arr,left,right,mid,target,comparisons,iterations}),
        stepOnce, play, reset, setTarget
      };
    })();
  </script>
</body>
</html>