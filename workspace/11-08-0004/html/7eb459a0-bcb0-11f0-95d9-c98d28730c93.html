<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Binary Search — Interactive Module</title>
  <style>
    :root{
      --safe-padding: 24px;
      --gap: 16px;
      --bg: #0f1724;
      --panel: #0b1220;
      --accent: #38bdf8;
      --muted: #94a3b8;
      --good: #16a34a;
      --bad: #ef4444;
      --glass: rgba(255,255,255,0.03);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color-scheme: dark;
    }

    html,body{
      height:100%;
      margin:0;
      background: linear-gradient(180deg,#071023 0%, #091426 50%, #081022 100%);
      padding: var(--safe-padding);
      box-sizing: border-box;
      color: #e6eef8;
    }

    /* Container */
    .module {
      max-width: 1100px;
      margin: 0 auto;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 6px 30px rgba(2,6,23,0.7), inset 0 1px 0 rgba(255,255,255,0.02);
      display: grid;
      grid-template-columns: 1fr 380px;
      gap: var(--gap);
      min-height: 480px;
    }

    /* Responsive */
    @media (max-width: 980px) {
      .module{
        grid-template-columns: 1fr;
      }
    }

    header {
      grid-column: 1 / -1;
      display:flex;
      align-items:center;
      gap: 12px;
      padding-bottom:6px;
    }
    h1 {
      font-size:20px;
      margin:0;
      letter-spacing: -0.2px;
    }
    .subtitle {
      margin:0;
      color:var(--muted);
      font-size:13px;
    }

    /* Left column (interactive canvas) */
    .canvas {
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      border-radius: 10px;
      padding: 18px;
      display:flex;
      flex-direction:column;
      gap: var(--gap);
      min-height: 360px;
    }

    /* Right column (controls & explanations) */
    .sidebar {
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      border-radius: 10px;
      padding: 18px;
      display:flex;
      flex-direction:column;
      gap: var(--gap);
    }

    /* Controls row */
    .controls {
      display:flex;
      gap: var(--gap);
      align-items:center;
      flex-wrap:wrap;
    }

    label {
      display:block;
      font-size:12px;
      color:var(--muted);
      margin-bottom:6px;
    }

    input[type="number"], input[type="text"], select {
      background:transparent;
      border:1px solid rgba(255,255,255,0.06);
      padding:10px 12px;
      color: #e6eef8;
      border-radius:8px;
      outline:none;
      min-width:120px;
    }
    input[type="range"]{
      width:160px;
      accent-color: var(--accent);
    }

    .btn {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.06);
      color:#e6eef8;
      padding:10px 12px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
    }
    .btn:active{ transform: translateY(1px); }
    .btn[aria-pressed="true"] {
      box-shadow: 0 6px 20px rgba(56,189,248,0.12);
      border-color: rgba(56,189,248,0.3);
    }

    /* Array visualization */
    .array-wrap {
      overflow:auto;
      padding:12px;
      border-radius:8px;
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      border:1px dashed rgba(255,255,255,0.03);
    }

    .array {
      display:flex;
      gap:12px;
      padding:12px;
      min-height:120px;
      align-items:flex-end;
      justify-content:flex-start;
      width:100%;
      transition: all 240ms ease;
    }

    .cell {
      min-width:48px;
      min-height:56px;
      height:56px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.04);
      border-radius:8px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      font-size:14px;
      color:#dff7ff;
      position:relative;
      box-shadow: 0 6px 18px rgba(2,6,23,0.6);
      cursor:pointer;
      transition: transform 220ms cubic-bezier(.2,.9,.2,1), opacity 300ms ease, box-shadow 200ms;
    }

    .cell:focus {
      outline:2px solid rgba(56,189,248,0.18);
      outline-offset:4px;
    }

    .cell.pulse {
      animation: pulse 900ms ease;
      box-shadow: 0 10px 30px rgba(56,189,248,0.12);
      transform: translateY(-6px) scale(1.02);
    }

    @keyframes pulse {
      0% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-8px) scale(1.03); }
      100% { transform: translateY(0) scale(1); }
    }

    .cell.eliminated {
      opacity: 0.22;
      transform: translateY(12px) scale(0.92);
      filter: grayscale(0.5);
      pointer-events:none;
    }

    /* index labels and pointers */
    .pointer-row {
      display:flex;
      gap:12px;
      margin-top:8px;
      align-items:center;
      justify-content:flex-start;
      min-height:24px;
    }

    .pointer {
      min-width:48px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:12px;
      color:var(--muted);
      height:20px;
      position:relative;
    }
    .pointer .tag {
      position:absolute;
      top:-20px;
      font-size:12px;
      background: rgba(255,255,255,0.02);
      padding:2px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.03);
      color: var(--muted);
    }
    .pointer .arrow {
      width:0;
      height:0;
      border-left:8px solid transparent;
      border-right:8px solid transparent;
      border-top:10px solid rgba(255,255,255,0.06);
      margin-top:-2px;
    }

    /* status area */
    .status {
      padding:12px;
      border-radius:8px;
      background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.03);
      font-size:13px;
      color:var(--muted);
      min-height:70px;
    }
    .status strong { color:#dff7ff; font-weight:700; }

    /* pseudocode box */
    .pseudocode {
      padding:12px;
      background: rgba(255,255,255,0.01);
      border-radius:8px;
      border:1px dashed rgba(255,255,255,0.03);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
      font-size:13px;
      color:var(--muted);
      line-height:1.45;
      max-height:260px;
      overflow:auto;
    }
    .code-line {
      padding:6px 8px;
      border-radius:6px;
    }
    .code-line.active {
      background: linear-gradient(90deg, rgba(56,189,248,0.06), rgba(56,189,248,0.02));
      color: #e6f9ff;
      font-weight:700;
    }

    /* small helper text */
    .muted {
      color:var(--muted);
      font-size:13px;
    }

    /* layout spacing helpers */
    .row { display:flex; gap:var(--gap); align-items:center; flex-wrap:wrap; }
    .col { display:flex; flex-direction:column; gap:6px; }

    footer.note {
      grid-column: 1 / -1;
      color:var(--muted);
      font-size:13px;
      padding-top:6px;
    }

    /* Accessible focus for buttons */
    .btn:focus {
      outline: 2px solid rgba(56,189,248,0.16);
      outline-offset: 3px;
    }

    /* small badges */
    .badge {
      background: rgba(255,255,255,0.03);
      padding:6px 8px;
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
      border:1px solid rgba(255,255,255,0.02);
    }

    /* visual result labels */
    .result {
      font-size:14px;
      font-weight:700;
    }
  </style>
</head>
<body>
  <div class="module" role="application" aria-label="Interactive Binary Search module">
    <header>
      <div>
        <h1>Binary Search — Interactive Explorer</h1>
        <p class="subtitle">See, step through, and experiment with binary search on a sorted array.</p>
      </div>
    </header>

    <!-- LEFT: Interactive Canvas -->
    <section class="canvas" aria-labelledby="conceptTitle">
      <div class="col" style="gap:8px;">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div>
            <div id="conceptTitle" style="font-weight:700;">Concept</div>
            <div class="muted" style="font-size:13px;margin-top:4px;">Binary search finds a target in a sorted array by repeatedly halving the search range.</div>
          </div>
          <div style="display:flex;gap:12px;align-items:center;">
            <div class="badge" id="complexity">O(log n)</div>
            <div class="muted" style="font-size:13px;">Interactive</div>
          </div>
        </div>

        <!-- Array visualization -->
        <div class="array-wrap" aria-live="polite" aria-atomic="true" id="arrayWrap">
          <div id="array" class="array" tabindex="0" aria-label="Sorted array; click a value to select as target"></div>

          <!-- pointer row -->
          <div id="pointers" class="pointer-row" aria-hidden="true"></div>
        </div>

        <!-- status / steps -->
        <div class="status" id="status" role="status">
          <div><strong>Ready.</strong> Generate an array, choose a target, then press Step or Play.</div>
        </div>
      </div>

      <!-- pseudocode for algorithm -->
      <div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
          <div style="font-weight:700;">Pseudocode</div>
          <div class="muted" style="font-size:12px;">Current step highlighted</div>
        </div>
        <div class="pseudocode" aria-hidden="false" id="pseudocode">
          <div class="code-line" data-line="0">function binarySearch(A, target):</div>
          <div class="code-line" data-line="1">  low = 0</div>
          <div class="code-line" data-line="2">  high = A.length - 1</div>
          <div class="code-line" data-line="3">  while low <= high:</div>
          <div class="code-line" data-line="4">    mid = floor((low + high) / 2)</div>
          <div class="code-line" data-line="5">    if A[mid] == target: return mid</div>
          <div class="code-line" data-line="6">    else if A[mid] < target: low = mid + 1</div>
          <div class="code-line" data-line="7">    else: high = mid - 1</div>
          <div class="code-line" data-line="8">  return -1  // not found</div>
        </div>
      </div>
    </section>

    <!-- RIGHT: Controls and explanation -->
    <aside class="sidebar" aria-labelledby="controlsTitle">
      <div>
        <div id="controlsTitle" style="font-weight:700;">Controls & Interaction</div>
        <div class="muted" style="font-size:13px;margin-top:6px;">Create arrays, pick a target, and step through the algorithm. Accessible via keyboard.</div>
      </div>

      <div class="col">
        <div class="row controls" style="align-items:flex-end;">
          <div class="col">
            <label for="sizeRange">Array size</label>
            <input id="sizeRange" type="range" min="3" max="21" value="11" aria-label="Array size slider">
          </div>

          <div class="col">
            <label for="minInput">Min value</label>
            <input id="minInput" type="number" value="1" step="1" aria-label="Minimum value">
          </div>

          <div class="col">
            <label for="maxInput">Max value</label>
            <input id="maxInput" type="number" value="99" step="1" aria-label="Maximum value">
          </div>
        </div>

        <div class="row" style="margin-top:4px;">
          <button class="btn" id="generateBtn" aria-pressed="false">Generate Array</button>
          <button class="btn" id="shuffleBtn" aria-pressed="false">Generate with duplicates</button>
          <div style="flex:1"></div>
        </div>

        <div style="height:8px"></div>

        <div class="col">
          <label for="targetInput">Target value (or click an element)</label>
          <input id="targetInput" type="text" placeholder="Type a number or click a cell" aria-label="Target value">
        </div>

        <div class="row" style="margin-top:8px;">
          <button class="btn" id="stepBtn" aria-pressed="false">Step</button>
          <button class="btn" id="playBtn" aria-pressed="false">Play</button>
          <button class="btn" id="fastBtn" aria-pressed="false">Fast</button>
          <button class="btn" id="resetBtn">Reset</button>
        </div>

        <div style="height:8px"></div>

        <div class="status" style="min-height:100px;">
          <div style="font-weight:700;margin-bottom:8px;">Learning Objective</div>
          <div class="muted" style="font-size:13px;">
            - Observe how binary search repeatedly halves the search range by comparing the middle element to the target.<br>
            - See indices low, mid, and high update and how elements outside the search range are eliminated.<br>
            - Connect each visual action to the corresponding pseudocode line.
          </div>
        </div>

      </div>

      <div class="col" style="margin-top:6px;">
        <div style="font-weight:700;">Interaction Design</div>
        <div class="muted" style="font-size:13px;">
          - Click "Generate Array" to create a sorted array. Click any array cell to set the target. Type a value into the target field to set target manually.<br>
          - "Step" advances one binary-search operation: compute mid, compare, then narrow low/high. Each step highlights the mid cell and the pseudocode line.<br>
          - "Play" runs steps automatically with pauses; "Fast" runs faster. "Reset" clears progress.<br>
          - Visual feedback: the mid cell pulses; eliminated cells fade and slide; status text explains the action.
        </div>
      </div>

      <div class="col" style="margin-top:6px;">
        <div style="font-weight:700;">Layout Description</div>
        <div class="muted" style="font-size:13px;">
          - Safe area: 24px padding around viewport. Controls and visuals spaced at least 16px apart for clarity.<br>
          - Left panel: array visualization, pointers, status, and pseudocode to focus the user's attention on the algorithm flow.<br>
          - Right panel: controls, target input, and learning objective, stacked vertically for easy access.<br>
          - Responsive: two-column layout collapses to one column on narrow screens. Array scrolls horizontally if it overflows.
        </div>
      </div>

      <div style="flex:1"></div>

      <div style="display:flex;gap:12px;align-items:center;">
        <div class="muted" style="font-size:13px;">Tip:</div>
        <div class="muted" style="font-size:13px;">Use keyboard: Tab to buttons, Enter to activate.</div>
      </div>
    </aside>

    <footer class="note">
      This single focused module demonstrates binary search behavior visually and interactively. It uses only vanilla HTML, CSS, and JavaScript.
    </footer>
  </div>

  <script>
    // Interactive Binary Search Module
    // All code self-contained; no external libraries.
    (function () {
      // DOM references
      const arrayEl = document.getElementById('array');
      const pointersEl = document.getElementById('pointers');
      const statusEl = document.getElementById('status');
      const pseudocodeEl = document.getElementById('pseudocode');
      const sizeRange = document.getElementById('sizeRange');
      const minInput = document.getElementById('minInput');
      const maxInput = document.getElementById('maxInput');
      const generateBtn = document.getElementById('generateBtn');
      const shuffleBtn = document.getElementById('shuffleBtn');
      const targetInput = document.getElementById('targetInput');
      const stepBtn = document.getElementById('stepBtn');
      const playBtn = document.getElementById('playBtn');
      const fastBtn = document.getElementById('fastBtn');
      const resetBtn = document.getElementById('resetBtn');
      const complexityBadge = document.getElementById('complexity');

      // State
      let A = [];               // array values
      let low = 0, high = -1, mid = -1;
      let target = null;
      let playing = false;
      let playInterval = null;
      let fastMode = false;
      let history = [];
      let duplicatesAllowed = false;
      const normalDelay = 900;
      const fastDelay = 300;

      // Initialize
      function init() {
        generateArray();
        attachHandlers();
        updateUI();
      }

      // Generate sorted array
      function generateArray(allowDuplicates=false) {
        const n = parseInt(sizeRange.value, 10) || 11;
        const min = parseInt(minInput.value, 10) || 1;
        const max = parseInt(maxInput.value, 10) || 99;
        duplicatesAllowed = !!allowDuplicates;

        const span = Math.max(1, max - min);
        A = [];
        if (allowDuplicates) {
          for (let i=0;i<n;i++){
            const val = Math.floor(Math.random() * (span+1)) + min;
            A.push(val);
          }
          A.sort((a,b)=>a-b);
        } else {
          // create unique increasing values with random gaps
          let cur = min;
          for (let i=0;i<n;i++){
            A.push(cur);
            const gap = 1 + Math.floor(Math.random()*Math.ceil(span/n + 2));
            cur += gap;
            if (cur > max) cur = max; // clamp to max
          }
        }

        low = 0;
        high = A.length - 1;
        mid = -1;
        history = [];
        target = null;
        targetInput.value = '';
        playing = false;
        clearInterval(playInterval);
        playBtn.setAttribute('aria-pressed','false');
        stepBtn.setAttribute('aria-pressed','false');
        fastBtn.setAttribute('aria-pressed','false');
        updateArray();
        updatePointers();
        writeStatus('Generated a sorted array. Click a cell or enter a target value to begin.');
        highlightPseudocode(-1);
      }

      // Update array DOM
      function updateArray() {
        arrayEl.innerHTML = '';
        pointersEl.innerHTML = '';

        A.forEach((v, i) => {
          const cell = document.createElement('div');
          cell.className = 'cell';
          cell.tabIndex = 0;
          cell.setAttribute('role','button');
          cell.setAttribute('aria-label', 'Index '+i+', value '+v);
          cell.dataset.index = i;
          cell.textContent = v;

          // clicking a cell sets target
          cell.addEventListener('click', () => {
            setTargetByClick(i);
          });
          cell.addEventListener('keydown', (ev) => {
            if (ev.key === 'Enter' || ev.key === ' ') {
              ev.preventDefault();
              setTargetByClick(i);
            }
          });

          arrayEl.appendChild(cell);

          // pointer placeholder (aligned)
          const p = document.createElement('div');
          p.className = 'pointer';
          p.dataset.index = i;
          pointersEl.appendChild(p);
        });

        // make array scrollable and focusable
        arrayEl.style.paddingBottom = '6px';
      }

      // Set target when clicking a cell
      function setTargetByClick(index) {
        target = A[index];
        targetInput.value = String(target);
        writeStatus('Target set to ' + target + ' by clicking index ' + index + '. Press Step to begin.');
        resetSearchBounds();
        highlightPseudocode(1);
        updatePointers();
      }

      // Reset search bounds (prepare for a fresh search)
      function resetSearchBounds() {
        low = 0;
        high = A.length - 1;
        mid = -1;
        history = [];
        stopPlaying();
        removeAllCellStates();
      }

      // Remove visual states from cells
      function removeAllCellStates() {
        const cells = arrayEl.querySelectorAll('.cell');
        cells.forEach(c => {
          c.classList.remove('pulse','eliminated');
        });
      }

      // Update pointer markers (low, mid, high)
      function updatePointers() {
        const pointerDivs = pointersEl.querySelectorAll('.pointer');
        pointerDivs.forEach(p => {
          const i = Number(p.dataset.index);
          p.innerHTML = ''; // clear

          if (i === low && low <= high) {
            // low tag
            const tag = document.createElement('div');
            tag.className = 'tag';
            tag.textContent = 'low';
            tag.style.background = 'linear-gradient(90deg, rgba(16,185,129,0.06), transparent)';
            tag.style.color = '#9be9c8';
            p.appendChild(tag);
          }
          if (i === mid && mid >= 0 && mid <= high) {
            const tag = document.createElement('div');
            tag.className = 'tag';
            tag.textContent = 'mid';
            tag.style.background = 'linear-gradient(90deg, rgba(56,189,248,0.06), transparent)';
            tag.style.color = '#bff2ff';
            p.appendChild(tag);
          }
          if (i === high && low <= high) {
            const tag = document.createElement('div');
            tag.className = 'tag';
            tag.textContent = 'high';
            tag.style.background = 'linear-gradient(90deg, rgba(239,68,68,0.04), transparent)';
            tag.style.color = '#ffcfcf';
            p.appendChild(tag);
          }
        });

        // Update cell eliminated visuals
        const cells = arrayEl.querySelectorAll('.cell');
        cells.forEach(c => {
          const idx = Number(c.dataset.index);
          if (idx < low || idx > high) {
            c.classList.add('eliminated');
          } else {
            c.classList.remove('eliminated');
          }
        });
      }

      // Write status text
      function writeStatus(html) {
        statusEl.innerHTML = '<div>' + html + '</div>';
      }

      // Step through one iteration of binary search
      function stepOnce() {
        // Validate
        if (A.length === 0) {
          writeStatus('No array present. Generate an array first.');
          return;
        }
        const raw = targetInput.value.trim();
        if (raw === '') {
          writeStatus('Choose a target (click a cell or type a number).');
          return;
        }
        const parsed = Number(raw);
        if (Number.isNaN(parsed)) {
          writeStatus('Target must be a number.');
          return;
        }
        target = parsed;

        // If search already finished
        if (low > high) {
          writeStatus('Search complete: target not found.');
          highlightPseudocode(8);
          stopPlaying();
          return;
        }

        // Compute mid
        mid = Math.floor((low + high) / 2);
        highlightPseudocode(4);
        updatePointers();
        pulseCell(mid);

        // Compare after a short delay to allow pulse animation
        setTimeout(() => {
          // update pseudocode line for compare
          highlightPseudocode(5);
          const midVal = A[mid];
          if (midVal === target) {
            // Found
            highlightPseudocode(5);
            writeStatus(`Found target ${target} at index ${mid}.`);
            focusCell(mid);
            stopPlaying();
            return;
          } else if (midVal < target) {
            // go right
            highlightPseudocode(6);
            writeStatus(`A[mid] (${midVal}) < target (${target}). Narrowing to right half (mid+1 ... high).`);
            // eliminate left half visually
            eliminateRange(low, mid);
            low = mid + 1;
            updatePointers();
            history.push({low,high,mid,action:'right',comp:midVal});
          } else {
            // go left
            highlightPseudocode(7);
            writeStatus(`A[mid] (${midVal}) > target (${target}). Narrowing to left half (low ... mid-1).`);
            eliminateRange(mid, high);
            high = mid - 1;
            updatePointers();
            history.push({low,high,mid,action:'left',comp:midVal});
          }

          // If now out of range
          if (low > high) {
            setTimeout(() => {
              writeStatus(`Search complete: ${target} not found.`);
              highlightPseudocode(8);
              stopPlaying();
            }, 600);
          }
        }, 480);
      }

      // Animate a cell pulse (mid)
      function pulseCell(index) {
        const cell = arrayEl.querySelector('.cell[data-index="'+index+'"]');
        if (!cell) return;
        // Clear previous pulses
        arrayEl.querySelectorAll('.cell').forEach(c => c.classList.remove('pulse'));
        // Add pulse
        cell.classList.add('pulse');
        // Remove pulse after animation
        setTimeout(() => {
          cell.classList.remove('pulse');
        }, 900);
      }

      // Focus (scroll to) a cell visually
      function focusCell(index) {
        const cell = arrayEl.querySelector('.cell[data-index="'+index+'"]');
        if (!cell) return;
        cell.scrollIntoView({behavior:'smooth', block:'center', inline:'center'});
        // give a stronger highlight once found
        cell.style.boxShadow = '0 16px 40px rgba(22,163,74,0.12)';
        setTimeout(() => {
          cell.style.boxShadow = '';
        }, 1200);
      }

      // Eliminate range visually (inclusive)
      function eliminateRange(fromIdx, toIdx) {
        const cells = arrayEl.querySelectorAll('.cell');
        for (let i=0;i<cells.length;i++){
          const idx = Number(cells[i].dataset.index);
          if (idx >= fromIdx && idx <= toIdx) {
            // animate elimination only if outside new range after the update
            // Add eliminated class with stagger
            (function(el, delay){
              setTimeout(()=> {
                el.classList.add('eliminated');
              }, delay);
            })(cells[i], Math.min(400, Math.abs(mid - idx) * 40));
          }
        }
      }

      // Play/auto-step
      function play(autoFast=false) {
        if (playing) { stopPlaying(); return; }

        const delay = autoFast ? fastDelay : normalDelay;
        playing = true;
        playBtn.setAttribute('aria-pressed','true');
        fastBtn.setAttribute('aria-pressed', autoFast ? 'true' : 'false');
        let tick = () => {
          stepOnce();
        };
        playInterval = setInterval(tick, delay);
        // Run one immediately
        tick();
      }

      function stopPlaying() {
        playing = false;
        playBtn.setAttribute('aria-pressed','false');
        fastBtn.setAttribute('aria-pressed','false');
        if (playInterval) {
          clearInterval(playInterval);
          playInterval = null;
        }
      }

      // Reset to initial generated state (clear eliminations & bounds)
      function resetSearch() {
        low = 0;
        high = A.length - 1;
        mid = -1;
        history = [];
        removeAllCellStates();
        updatePointers();
        highlightPseudocode(-1);
        writeStatus('Search reset. Target remains ' + (target !== null ? target : '(not set)') + '.');
        stopPlaying();
      }

      // Highlight a specific pseudocode line (data-line value)
      function highlightPseudocode(line) {
        const lines = pseudocodeEl.querySelectorAll('.code-line');
        lines.forEach(l => {
          if (Number(l.dataset.line) === line) {
            l.classList.add('active');
            // scroll into view if needed
            l.scrollIntoView({behavior:'smooth',block:'nearest'});
          } else {
            l.classList.remove('active');
          }
        });
      }

      // UI update wrapper
      function updateUI() {
        updateArray();
        updatePointers();
      }

      // Attach event handlers
      function attachHandlers() {
        generateBtn.addEventListener('click', () => {
          generateArray(false);
        });

        shuffleBtn.addEventListener('click', () => {
          generateArray(true);
        });

        stepBtn.addEventListener('click', () => {
          stopPlaying();
          stepOnce();
        });

        playBtn.addEventListener('click', () => {
          if (playing) {
            stopPlaying();
          } else {
            play(false);
          }
        });

        fastBtn.addEventListener('click', () => {
          if (playing && fastMode) {
            // stop
            stopPlaying();
            fastMode = false;
          } else {
            stopPlaying();
            fastMode = true;
            play(true);
          }
        });

        resetBtn.addEventListener('click', () => {
          resetSearch();
        });

        // Enter key on target input triggers a single step
        targetInput.addEventListener('keydown', (ev) => {
          if (ev.key === 'Enter') {
            ev.preventDefault();
            stopPlaying();
            stepOnce();
          }
        });

        // Update array size display when sliding (generate on release)
        sizeRange.addEventListener('input', () => {
          // small visual feedback not needed; user clicks Generate to apply
        });

        // Accessibility: keyboard shortcuts
        document.addEventListener('keydown', (ev) => {
          if (ev.target && (ev.target.tagName === 'INPUT' || ev.target.isContentEditable)) return;
          if (ev.key === ' ') {
            // Space toggles play/pause
            ev.preventDefault();
            play(false);
          } else if (ev.key === 's' || ev.key === 'S') {
            stepOnce();
          } else if (ev.key === 'r' || ev.key === 'R') {
            resetSearch();
          }
        });

        // Allow clicking a cell to set target (handled in updateArray)
      }

      // Initialize module
      init();

      // Expose for debugging (not necessary)
      window._binarySearchModule = {
        getState: () => ({A,low,high,mid,target,history}),
        generateArray
      };
    })();
  </script>
</body>
</html>