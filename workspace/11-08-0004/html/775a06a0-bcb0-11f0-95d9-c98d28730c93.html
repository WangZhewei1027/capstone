<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Selection Sort — Interactive Module</title>
  <style>
    :root{
      --bg: #0f1720;
      --panel: #0b1220;
      --accent: #60a5fa;
      --muted: #9ca3af;
      --success: #34d399;
      --danger: #fb7185;
      --neutral: #e6eef8;
      --spacing: 16px;
      --margin: 24px;
      --min-gap: 16px;
      --max-width: 1100px;
    }

    /* Safe area margins: 24px on all sides */
    html,body{
      height:100%;
      margin:0;
      background:linear-gradient(180deg,#071026 0%, #081826 100%);
      color:var(--neutral);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .wrap{
      padding: var(--margin);
      box-sizing: border-box;
      min-height:100vh;
      display:flex;
      justify-content:center;
    }

    .container{
      width:100%;
      max-width:var(--max-width);
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:20px;
      box-sizing:border-box;
      box-shadow: 0 8px 30px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
      display:flex;
      flex-direction:column;
      gap:var(--spacing);
      outline: none;
    }

    header{
      display:flex;
      gap:16px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
      padding-bottom:4px;
      border-bottom:1px solid rgba(255,255,255,0.03);
    }

    h1{
      font-size:20px;
      margin:0;
      color:var(--neutral);
    }
    .sub{
      color:var(--muted);
      font-size:13px;
      margin-top:6px;
      line-height:1.3;
      max-width:720px;
    }

    main{
      display:flex;
      gap:var(--spacing);
      align-items:flex-start;
      margin-top:4px;
      flex-wrap:wrap;
    }

    /* Left: Visual area */
    .visual{
      flex:1 1 560px;
      min-width:260px;
      background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
      border-radius:10px;
      padding:18px;
      box-sizing:border-box;
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height:320px;
    }

    .viz-top{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
    }

    .legend{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }

    .legend .pill{
      display:flex;
      gap:8px;
      align-items:center;
      font-size:13px;
      color:var(--muted);
      background:rgba(255,255,255,0.02);
      padding:6px 8px;
      border-radius:8px;
    }
    .legend .swatch{
      width:12px;
      height:12px;
      border-radius:3px;
      border:1px solid rgba(0,0,0,0.2);
    }

    .canvas{
      background:linear-gradient(180deg, rgba(255,255,255,0.005), rgba(255,255,255,0.002));
      border-radius:8px;
      padding:12px;
      min-height:220px;
      display:flex;
      align-items:end;
      gap:12px; /* min spacing between bars */
      justify-content:center;
      overflow:hidden;
      position:relative;
    }

    /* Bars */
    .bars{
      display:flex;
      align-items:end;
      gap:12px;
      height:220px;
      width:100%;
      max-width:100%;
      padding:4px;
      box-sizing:border-box;
      justify-content:center;
    }

    .bar{
      --width: 28px;
      width:var(--width);
      display:flex;
      align-items:end;
      justify-content:center;
      position:relative;
      cursor:pointer;
      user-select:none;
      transition: transform 300ms ease;
    }

    .bar-inner{
      width:100%;
      border-radius:6px 6px 4px 4px;
      background: linear-gradient(180deg,var(--bar-color-start,#60a5fa), var(--bar-color-end,#3b82f6));
      box-shadow: 0 4px 10px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.06);
      transition: height 350ms ease, background-color 200ms linear;
      height: 40%;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding-top:6px;
      color: rgba(255,255,255,0.95);
      font-size:12px;
      font-weight:600;
    }

    /* highlights */
    .bar.current .bar-inner{
      box-shadow: 0 6px 18px rgba(34,197,94,0.12), 0 2px 6px rgba(2,6,23,0.4);
      outline: 3px solid rgba(52,211,153,0.12);
      transform: translateY(-6px);
    }

    .bar.min .bar-inner{
      outline: 3px solid rgba(251,113,133,0.12);
      transform: translateY(-6px);
      box-shadow: 0 6px 18px rgba(251,113,133,0.10);
    }

    .bar.compare .bar-inner{
      outline: 3px solid rgba(96,165,250,0.10);
      transform: translateY(-3px);
    }

    .controls{
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
    }

    button, input[type="range"], select{
      font:inherit;
      border-radius:8px;
    }

    .btn{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.04);
      color:var(--neutral);
      padding:8px 12px;
      cursor:pointer;
      min-height:40px;
      display:inline-flex;
      align-items:center;
      gap:8px;
      transition: transform 120ms ease, background 120ms ease;
    }

    .btn:active{ transform:translateY(1px); }
    .btn[aria-pressed="true"]{ background: linear-gradient(180deg, rgba(96,165,250,0.12), rgba(96,165,250,0.06)); border-color:rgba(96,165,250,0.16); }

    .btn.primary{
      background:linear-gradient(180deg,#60a5fa33,#3b82f633);
      border-color:rgba(96,165,250,0.14);
      color: #052029;
      font-weight:600;
    }

    .small{
      font-size:13px;
      padding:6px 10px;
      min-height:36px;
    }

    .right-panel{
      width:320px;
      min-width:260px;
      max-width:34%;
      background:transparent;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .panel{
      background: rgba(255,255,255,0.02);
      border-radius:10px;
      padding:12px;
      box-sizing:border-box;
    }

    label{
      display:block;
      font-size:13px;
      color:var(--muted);
      margin-bottom:8px;
    }

    .row{
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
    }

    input[type="number"], input[type="text"]{
      width:100%;
      box-sizing:border-box;
      padding:8px 10px;
      background:transparent;
      border:1px solid rgba(255,255,255,0.04);
      color:var(--neutral);
      border-radius:8px;
      min-height:36px;
    }

    input[type="range"]{
      -webkit-appearance:none;
      width:100%;
      height:6px;
      background:linear-gradient(90deg,#3b82f6,#60a5fa);
      border-radius:6px;
      outline:none;
    }

    .footer{
      font-size:13px;
      color:var(--muted);
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    .status{
      display:flex;
      gap:10px;
      align-items:center;
      color:var(--muted);
    }

    .status .dot{
      width:10px;
      height:10px;
      border-radius:50%;
      display:inline-block;
    }

    .finished .dot{ background:var(--success); box-shadow:0 2px 10px rgba(52,211,153,0.15); }
    .running .dot{ background:var(--accent); box-shadow:0 2px 10px rgba(96,165,250,0.12); }
    .idle .dot{ background:var(--muted); opacity:0.7; }

    /* small screens */
    @media (max-width:960px){
      main{ flex-direction:column; }
      .right-panel{ width:100%; max-width:none; }
    }

    /* Accessibility focus */
    .btn:focus, input:focus, select:focus, .bar:focus{
      outline: 3px solid rgba(96,165,250,0.12);
      outline-offset:2px;
    }

    /* help text */
    .meta{
      font-size:13px;
      color:var(--muted);
      line-height:1.45;
    }

    /* value labels above bars */
    .bar-value{
      position:absolute;
      top:-26px;
      left:50%;
      transform:translateX(-50%);
      font-size:12px;
      color:var(--muted);
    }

    /* finished state */
    .bar.finished .bar-inner{
      background: linear-gradient(180deg,#34d399,#10b981);
      transform: translateY(-4px);
    }

  </style>
</head>
<body>
  <div class="wrap">
    <div class="container" role="application" aria-label="Selection sort interactive module">
      <header>
        <div>
          <h1>Selection Sort — Visual, Step-by-Step</h1>
          <div class="sub">
            Watch how Selection Sort repeatedly selects the minimum element from the unsorted portion
            and swaps it into place. Use the controls to step through the algorithm, run it automatically,
            or try your own arrays.
          </div>
        </div>
        <div style="min-width:240px; text-align:right;">
          <div style="font-size:13px; color:var(--muted);">Learning objective</div>
          <div style="font-weight:600; color:var(--neutral); margin-top:6px;">
            Understand the selection, comparison, and swap phases of Selection Sort.
          </div>
        </div>
      </header>

      <main>
        <!-- Visualization -->
        <section class="visual" aria-live="polite">
          <div class="viz-top">
            <div class="legend" aria-hidden="false">
              <div class="pill"><span class="swatch" style="background:linear-gradient(180deg,#34d399,#10b981);"></span><span>Sorted position</span></div>
              <div class="pill"><span class="swatch" style="background:linear-gradient(180deg,#fb7185,#ef4444);"></span><span>Current minimum</span></div>
              <div class="pill"><span class="swatch" style="background:linear-gradient(180deg,#60a5fa,#3b82f6);"></span><span>Unsorted / scanning</span></div>
            </div>

            <div class="controls" role="group" aria-label="Playback controls">
              <button class="btn small" id="shuffleBtn" title="Shuffle (S)" aria-label="Shuffle array (S)">Shuffle</button>
              <button class="btn small" id="resetBtn" title="Reset" aria-label="Reset array">Reset</button>
              <button class="btn small primary" id="playBtn" aria-pressed="false" title="Play / Pause (Space)" aria-label="Play or pause (Space)">Play</button>
              <button class="btn small" id="stepBtn" title="Step (→)" aria-label="Step forward one operation">Step</button>
            </div>
          </div>

          <div class="canvas" id="canvas" tabindex="0" aria-describedby="helpText">
            <div class="bars" id="bars" role="list" aria-label="Array elements"></div>
          </div>

          <div class="footer">
            <div class="meta" id="helpText">
              Interaction design: Click any bar to edit its value. Use the controls above to shuffle,
              step, or play. Keyboard: Space = play/pause, Right Arrow = step, S = shuffle.
            </div>
            <div class="status idle" id="statusBox" aria-live="polite">
              <div class="dot"></div><div id="statusText">Idle</div>
            </div>
          </div>
        </section>

        <!-- Right panel: controls and explanation -->
        <aside class="right-panel">
          <div class="panel" aria-label="Algorithm configuration">
            <label for="sizeInput">Array size</label>
            <div class="row">
              <input id="sizeInput" type="range" min="4" max="12" value="8" aria-valuemin="4" aria-valuemax="12" />
              <div style="min-width:44px; text-align:right; color:var(--muted);" id="sizeLabel">8</div>
            </div>

            <div style="height:12px;"></div>

            <label for="speedInput">Speed (ms per step)</label>
            <div class="row">
              <input id="speedInput" type="range" min="100" max="1500" value="550" />
              <div style="min-width:64px; text-align:right; color:var(--muted);" id="speedLabel">550 ms</div>
            </div>

            <div style="height:12px;"></div>

            <label for="arrayText">Custom array (comma separated)</label>
            <div class="row">
              <input id="arrayText" type="text" placeholder="e.g. 5,3,8,1,4" aria-label="Custom array input" />
              <button class="btn small" id="applyArrBtn">Apply</button>
            </div>

            <div style="height:8px;"></div>

            <div class="meta" style="font-size:13px; color:var(--muted);">
              Tip: Values are clamped between 1 and 100. Click a bar to edit its value directly.
            </div>
          </div>

          <div class="panel" aria-label="Algorithm explanation">
            <strong style="display:block; margin-bottom:8px;">Interaction design</strong>
            <div class="meta">
              - Step mode: advances one comparison or swap at a time so you can observe decisions.<br>
              - Play mode: runs steps automatically at the chosen speed.<br>
              - Visual feedback: current index (green), current minimum (red), comparing (blue), and swaps animate via height transitions.<br>
              - Direct edits: click a bar to change its value and see how the algorithm responds.
            </div>
          </div>

          <div class="panel" aria-label="Algorithm description">
            <strong style="display:block; margin-bottom:8px;">What you will learn</strong>
            <div class="meta">
              After interacting you should be able to:
              <ul style="margin:8px 0 0 18px; padding:0; color:var(--muted);">
                <li>Identify the sorted and unsorted partitions.</li>
                <li>Follow how the minimum is found for each position.</li>
                <li>See when swaps occur and how many comparisons are made.</li>
              </ul>
            </div>
          </div>

        </aside>
      </main>
    </div>
  </div>

  <script>
    /* Selection Sort Interactive Module
       - No external libraries
       - Accessible controls and keyboard shortcuts
    */

    (function(){
      const DEFAULT_SIZE = 8;
      const BARS_EL = document.getElementById('bars');
      const playBtn = document.getElementById('playBtn');
      const stepBtn = document.getElementById('stepBtn');
      const shuffleBtn = document.getElementById('shuffleBtn');
      const resetBtn = document.getElementById('resetBtn');
      const sizeInput = document.getElementById('sizeInput');
      const sizeLabel = document.getElementById('sizeLabel');
      const speedInput = document.getElementById('speedInput');
      const speedLabel = document.getElementById('speedLabel');
      const arrayText = document.getElementById('arrayText');
      const applyArrBtn = document.getElementById('applyArrBtn');
      const statusBox = document.getElementById('statusBox');
      const statusText = document.getElementById('statusText');

      // State
      let arr = [];
      let initial = [];
      let n = DEFAULT_SIZE;
      let i = 0;
      let j = 1;
      let minIndex = 0;
      let running = false;
      let timer = null;
      let stepDelay = 550;
      let comparisons = 0;
      let phase = 'idle'; // 'compare' or 'swap' or 'idle' or 'finished'
      let finished = false;

      // Utility
      function randInt(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }
      function clamp(v,min,max){ return Math.max(min,Math.min(max,v)); }

      // Initialize
      function initArray(size){
        n = size;
        arr = Array.from({length:n}, ()=>randInt(5,100));
        initial = arr.slice();
        resetAlgorithmState();
        render();
      }

      function resetAlgorithmState(){
        i = 0;
        j = i+1;
        minIndex = 0;
        comparisons = 0;
        phase = 'idle';
        finished = false;
        stop();
        updateStatus('Idle', 'idle');
        playBtn.setAttribute('aria-pressed','false');
      }

      // Rendering
      function render(){
        BARS_EL.innerHTML = '';
        // spacing: we set bar width based on container width and n to keep legible
        const containerWidth = BARS_EL.clientWidth || 700;
        const gap = 12;
        const totalGap = gap * (n - 1);
        const barWidth = Math.max(20, Math.floor((containerWidth - totalGap - 40) / n));
        for(let idx=0; idx<n; idx++){
          const val = arr[idx];
          const bar = document.createElement('div');
          bar.className = 'bar';
          bar.setAttribute('role','listitem');
          bar.setAttribute('tabindex','0');
          bar.dataset.index = idx;
          bar.style.setProperty('--width', barWidth + 'px');

          const label = document.createElement('div');
          label.className = 'bar-value';
          label.textContent = val;
          bar.appendChild(label);

          const inner = document.createElement('div');
          inner.className = 'bar-inner';
          // height proportional to value (max 100)
          const h = Math.max(8, Math.round((val/100)*100));
          inner.style.height = h + '%';
          // default colors
          inner.style.setProperty('--bar-color-start','#60a5fa');
          inner.style.setProperty('--bar-color-end','#3b82f6');
          inner.textContent = val;
          bar.appendChild(inner);

          // Apply state classes
          if (finished || idx < i) {
            bar.classList.add('finished');
          }
          if (!finished) {
            if (idx === i) bar.classList.add('current'); // current index being placed
            if (idx === minIndex && j <= n) bar.classList.add('min');
            if (idx === j && phase === 'compare') bar.classList.add('compare');
          }

          // Click to edit value
          bar.addEventListener('click', ()=>editValue(idx));
          bar.addEventListener('keydown', (e)=>{
            if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); editValue(idx); }
          });

          BARS_EL.appendChild(bar);
        }
        updateStats();
      }

      // Edit value inline via prompt (accessible)
      function editValue(index){
        const current = arr[index];
        const input = prompt("Edit value (1-100):", String(current));
        if (input === null) return;
        let v = parseInt(input.trim(), 10);
        if (isNaN(v)) return;
        v = clamp(v,1,100);
        arr[index] = v;
        initial = arr.slice(); // treat as new initial
        resetAlgorithmState();
        render();
      }

      // Controls
      function shuffle(){
        for(let k=n-1;k>0;k--){
          const r = Math.floor(Math.random()*(k+1));
          [arr[k], arr[r]] = [arr[r], arr[k]];
        }
        initial = arr.slice();
        resetAlgorithmState();
        render();
      }

      function reset(){
        arr = initial.slice();
        resetAlgorithmState();
        render();
      }

      function updateStatus(text, cls){
        statusBox.classList.remove('idle','running','finished');
        statusBox.classList.add(cls||'idle');
        statusText.textContent = text;
      }

      // Step logic: perform ONE atomic step (compare or swap decision)
      function step(){
        if (finished) return;
        if (i >= n-1){
          finish();
          return;
        }

        // If j is within unsorted portion, compare arr[j] to arr[minIndex]
        if (j < n){
          phase = 'compare';
          comparisons++;
          // Visualize comparison
          render();
          // After slight delay we process comparison result (for auto-run it's immediate, but transition is visible)
          // We do not use setTimeout here for step() to remain atomic when called via user step.
          if (arr[j] < arr[minIndex]){
            minIndex = j;
            // mark changed min and render to show change
            render();
          }
          j++;
        } else {
          // finished scanning for this i -> swap if needed
          phase = 'swap';
          if (minIndex !== i){
            // swap values (animate by changing heights)
            [arr[i], arr[minIndex]] = [arr[minIndex], arr[i]];
          }
          // move to next position
          i++;
          minIndex = i;
          j = i + 1;
          // If we've placed all but last, we finish next
          if (i >= n-1){
            finish();
            return;
          }
        }
        render();
      }

      function finish(){
        finished = true;
        phase = 'finished';
        updateStatus('Finished — sorted', 'finished');
        stop();
        render();
      }

      function run(){
        if (running || finished) return;
        running = true;
        playBtn.setAttribute('aria-pressed','true');
        updateStatus('Running', 'running');
        timer = setInterval(()=>{
          // make one step and render; when finished, clear
          step();
          if (finished) stop();
        }, stepDelay);
      }

      function stop(){
        running = false;
        playBtn.setAttribute('aria-pressed','false');
        updateStatus(finished ? 'Finished — sorted' : 'Idle', finished ? 'finished' : 'idle');
        if (timer) { clearInterval(timer); timer = null; }
      }

      // UI wiring
      shuffleBtn.addEventListener('click', ()=>{ shuffle(); });
      resetBtn.addEventListener('click', ()=>{ reset(); });
      playBtn.addEventListener('click', ()=>{
        if (running) stop(); else run();
      });
      stepBtn.addEventListener('click', ()=>{
        stop();
        step();
      });

      sizeInput.addEventListener('input', (e)=>{
        const val = parseInt(e.target.value,10);
        sizeLabel.textContent = val;
        // Change size immediately but only recreate a random array if user releases? We'll apply on change.
      });
      sizeInput.addEventListener('change', (e)=>{
        const val = parseInt(e.target.value,10);
        sizeLabel.textContent = val;
        initArray(val);
      });

      speedInput.addEventListener('input', (e)=>{
        const val = parseInt(e.target.value,10);
        speedLabel.textContent = val + ' ms';
        stepDelay = val;
        if (running){
          // restart interval with new speed
          stop();
          run();
        }
      });

      applyArrBtn.addEventListener('click', ()=>{
        const text = arrayText.value.trim();
        if (!text) return;
        const parts = text.split(',').map(s=>parseInt(s.trim(),10)).filter(x=>!isNaN(x));
        if (parts.length < 2) return alert('Enter at least two numbers');
        const clamped = parts.map(v=>clamp(v,1,100));
        arr = clamped.slice(0, 30); // reasonable cap
        n = arr.length;
        sizeInput.value = n;
        sizeLabel.textContent = n;
        initial = arr.slice();
        resetAlgorithmState();
        render();
      });

      // Keyboard shortcuts
      window.addEventListener('keydown', (e)=>{
        if (e.target && (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA')) return;
        if (e.key === ' '){ e.preventDefault(); if (running) stop(); else run(); }
        if (e.key === 'ArrowRight'){ e.preventDefault(); stop(); step(); }
        if (e.key.toLowerCase() === 's'){ e.preventDefault(); shuffle(); }
      });

      // Keep stats (number of comparisons). updateStats prints comparisons
      function updateStats(){
        // set aria label on canvas to describe current state
        const canvas = document.getElementById('canvas');
        canvas.setAttribute('aria-label', `Selection sort visualization. Step ${i+1} of ${n}. Comparisons: ${comparisons}.`);
      }

      // Responsive: rerender on resize to recalc bar widths
      window.addEventListener('resize', ()=>{ render(); });

      // initialization
      initArray(DEFAULT_SIZE);

      // Expose for testing in console (optional)
      window.__selectionSortModule = {
        getState: ()=>({arr, i, j, minIndex, running, finished, comparisons})
      };
    })();
  </script>
</body>
</html>