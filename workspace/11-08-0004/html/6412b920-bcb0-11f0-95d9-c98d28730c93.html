<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Visual Stack — Push / Pop Explorer</title>
  <style>
    :root{
      --safe-padding: 24px;
      --gap: 20px;            /* >=16px */
      --min-gap: 16px;
      --stack-width: 220px;
      --block-height: 48px;
      --accent: #2563eb;
      --accent-2: #0ea5a4;
      --danger: #dc2626;
      --bg: #f8fafc;
      --card-bg: #ffffff;
      --muted: #6b7280;
      --radius: 10px;
    }

    /* Safe area margins */
    html,body{
      height:100%;
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background:linear-gradient(180deg,#f0f6ff 0%, var(--bg) 40%);
      color:#0f172a;
    }
    body{
      padding:var(--safe-padding);
      box-sizing:border-box;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Layout */
    .page{
      display:flex;
      gap:var(--gap);
      align-items:flex-start;
      justify-content:center;
      max-width:1100px;
      margin:0 auto;
    }

    /* Responsive stack -> column */
    @media (max-width:900px){
      .page{
        flex-direction:column-reverse;
        gap:18px;
      }
    }

    .panel{
      background:var(--card-bg);
      border-radius:var(--radius);
      padding:18px;
      box-shadow:0 6px 18px rgba(2,6,23,0.06);
    }

    .left{
      flex:1;
      min-width:240px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .right{
      width:420px;
      max-width:100%;
      display:flex;
      flex-direction:column;
      gap:var(--gap);
    }

    h1{
      font-size:20px;
      margin:0 0 6px 0;
    }
    .muted{
      color:var(--muted);
      font-size:13px;
      line-height:1.4;
    }

    .instruction{
      font-size:14px;
      line-height:1.5;
      color:#0b1220;
    }

    /* Interactive module layout */
    .module{
      display:flex;
      gap:var(--gap);
      align-items:flex-start;
      justify-content:space-between;
      padding:18px;
    }

    @media (max-width:900px){
      .module{flex-direction:column; padding:12px;}
    }

    /* Stack visual area */
    .visual{
      display:flex;
      gap:var(--gap);
      align-items:flex-start;
      justify-content:center;
      width:100%;
      flex-direction:column;
    }

    .controls{
      display:flex;
      gap:12px;
      align-items:center;
      margin-bottom:8px;
      flex-wrap:wrap;
    }

    .controls input[type="text"], .controls input[type="number"]{
      height:40px;
      padding:0 12px;
      border-radius:8px;
      border:1px solid #d1d5db;
      font-size:14px;
      outline:none;
    }
    .controls input[type="text"]:focus, .controls input[type="number"]:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 3px rgba(37,99,235,0.08);
    }

    .btn{
      background:var(--accent);
      color:white;
      border:none;
      height:40px;
      padding:0 14px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
      display:inline-flex;
      align-items:center;
      gap:8px;
      transition:transform .12s ease, box-shadow .12s ease;
    }
    .btn.secondary{
      background:#e6eefc;
      color:var(--accent);
    }
    .btn.ghost{
      background:transparent;
      color:var(--accent-2);
      border:1px solid #c7f0ec;
    }
    .btn:active{ transform:translateY(1px); }
    .btn:focus{ box-shadow:0 0 0 4px rgba(37,99,235,0.12); outline:none; }

    .stack-area{
      display:flex;
      gap:20px;
      align-items:flex-start;
      justify-content:center;
      flex-direction:row;
      flex-wrap:wrap;
    }

    .stack-card{
      width:var(--stack-width);
      min-height:var(--block-height);
      background:linear-gradient(#ffffff,#fbfdff);
      border-radius:10px;
      border:1px solid #e6eefc;
      padding:12px;
      box-sizing:border-box;
      position:relative;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:12px;
    }

    .stack-frame{
      width:100%;
      min-height:120px;
      max-height:420px;
      border-radius:8px;
      border:2px dashed #e6eefc;
      background:linear-gradient(180deg,#f8fbff, rgba(255,255,255,0.5));
      padding:8px;
      box-sizing:border-box;
      position:relative;
      display:flex;
      flex-direction:column;
      align-items:stretch;
      justify-content:flex-start; /* top is top */
      overflow:hidden;
    }

    .stack-block{
      height:var(--block-height);
      border-radius:8px;
      background:linear-gradient(180deg,#ffffff,#eff8ff);
      border:1px solid rgba(2,6,23,0.06);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 12px;
      margin-bottom:8px;
      box-sizing:border-box;
      font-weight:600;
      color:#06203a;
      transform-origin:center;
      transition:transform .25s ease, box-shadow .18s ease;
      box-shadow:0 6px 18px rgba(2,6,23,0.04);
    }
    .stack-block .label{ font-size:12px; color:var(--muted); font-weight:700; }
    .stack-block .value{ font-size:15px; }

    .stack-meta{
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:space-between;
      width:100%;
      margin-top:4px;
    }

    .capacity{
      font-size:13px;
      color:var(--muted);
    }

    .progress{
      height:8px;
      background:#eef2ff;
      border-radius:999px;
      overflow:hidden;
      flex:1;
    }
    .progress > i{
      display:block;
      height:100%;
      width:0%;
      background:linear-gradient(90deg,var(--accent),var(--accent-2));
      transition:width .3s ease;
    }

    /* Animations for push/pop */
    .transient{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      width:calc(var(--stack-width) - 36px);
      height:var(--block-height);
      border-radius:8px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 12px;
      box-sizing:border-box;
      box-shadow:0 14px 30px rgba(2,6,23,0.12);
      background:linear-gradient(180deg,#fff,#f2fbff);
      z-index:40;
    }

    @keyframes slideInFromTop{
      from{ transform:translate(-50%,-140%); opacity:0; }
      to{ transform:translate(-50%,0%); opacity:1; }
    }
    @keyframes slideOutRight{
      from{ transform:translateX(0); opacity:1; }
      to{ transform:translateX(120%); opacity:0; }
    }
    .slide-in{ animation: slideInFromTop .45s cubic-bezier(.2,.9,.3,1) forwards; }
    .slide-out{ animation: slideOutRight .35s ease forwards; }

    .pulse{
      animation: pulse .75s ease-in-out;
    }
    @keyframes pulse{
      0%{ box-shadow:0 6px 18px rgba(14,165,164,0.12); transform:scale(1); }
      50%{ box-shadow:0 10px 30px rgba(14,165,164,0.18); transform:scale(1.03); }
      100%{ box-shadow:0 6px 18px rgba(14,165,164,0.12); transform:scale(1); }
    }

    .shake{
      animation: shake .35s linear;
    }
    @keyframes shake{
      0%{ transform:translateX(0); }
      25%{ transform:translateX(-6px); }
      50%{ transform:translateX(6px); }
      75%{ transform:translateX(-4px); }
      100%{ transform:translateX(0); }
    }

    .error-outline{
      box-shadow:0 0 0 4px rgba(220,38,38,0.08);
      border-color: rgba(220,38,38,0.18);
    }

    .small{
      font-size:13px;
      color:var(--muted);
    }

    /* Pseudocode & history */
    .side{
      display:flex;
      gap:12px;
      flex-direction:column;
    }

    .code{
      background:#0f172a;
      color:#e6eefc;
      padding:12px;
      border-radius:8px;
      font-family:ui-monospace,SFMono-Regular,Menlo,monospace;
      font-size:13px;
      line-height:1.5;
      white-space:pre;
      max-height:150px;
      overflow:auto;
    }

    .code .line{ display:block; padding:2px 0; opacity:0.9; }
    .code .hl{ background:linear-gradient(90deg, rgba(99,102,241,0.16), rgba(14,165,164,0.06)); padding:2px 6px; border-radius:6px; color:#fff; }

    .history{
      background:#fff;
      border:1px solid #eef2ff;
      padding:8px;
      border-radius:8px;
      font-size:13px;
      color:var(--muted);
      max-height:150px;
      overflow:auto;
    }

    .aria-live{
      position:absolute;
      left:-9999px;
      width:1px;
      height:1px;
      overflow:hidden;
    }

    /* focus outline for blocks */
    .stack-block:focus{
      outline:3px solid rgba(37,99,235,0.14);
    }

    /* helper */
    .muted-small{ font-size:12px; color:var(--muted); }

  </style>
</head>
<body>
  <div class="page" role="main">
    <div class="left panel" aria-labelledby="title">
      <h1 id="title">Visual Stack — Push / Pop Explorer</h1>
      <div class="muted">A compact, interactive module demonstrating a stack’s LIFO behavior and basic operations.</div>
      <hr style="border:none;border-top:1px solid #eef2ff;margin:10px 0;">
      <div class="instruction">
        Use the controls to push values onto the top of the stack, pop the top item, peek at the top, and clear the stack.
        Watch animations and the pseudocode panel highlight lines that correspond to your actions.
      </div>

      <div style="margin-top:12px;">
        <strong>How to interact</strong>
        <ul style="margin:8px 0 0 18px">
          <li>Type a value and press Enter or click Push.</li>
          <li>Click Pop or click the top block to pop it.</li>
          <li>Adjust capacity to see overflow behavior (push when full) and underflow (pop when empty).</li>
        </ul>
      </div>

      <div style="margin-top:14px;">
        <strong>Learning objective recap</strong>
        <p class="muted-small" style="margin:6px 0 0;">
          After using this module you should be able to predict which item will be removed next (the most recently pushed item),
          know when push/pop are invalid (overflow/underflow), and associate each action with its pseudocode.
        </p>
      </div>
    </div>

    <div class="right panel">
      <div class="module" aria-live="polite">
        <div class="visual">
          <div class="controls" role="region" aria-label="Stack controls">
            <label for="value" class="muted-small" style="align-self:center;">Value</label>
            <input id="value" type="text" placeholder="e.g. 42 or 'apple'" aria-label="Value to push" />
            <button id="pushBtn" class="btn" aria-label="Push value">Push</button>
            <button id="popBtn" class="btn secondary" aria-label="Pop top">Pop</button>
            <button id="peekBtn" class="btn ghost" aria-label="Peek top">Peek</button>
            <button id="clearBtn" class="btn secondary" aria-label="Clear stack">Clear</button>
          </div>

          <div class="stack-area">
            <div class="stack-card" aria-labelledby="stacklabel">
              <div style="display:flex; justify-content:space-between; width:100%; align-items:center;">
                <div id="stacklabel" class="muted-small">Stack (top at top)</div>
                <div class="muted-small">Items: <span id="count">0</span></div>
              </div>

              <div id="frame" class="stack-frame" tabindex="0" aria-live="polite" aria-label="Stack contents">
                <!-- dynamic blocks go here -->
                <div id="emptyHint" class="muted-small" style="margin:auto; text-align:center; color:var(--muted);">Stack is empty. Push items to begin.</div>
              </div>

              <div class="stack-meta" style="margin-top:6px;">
                <div class="capacity">Capacity: <input id="capacity" type="number" min="1" step="1" value="6" aria-label="Stack capacity" style="width:64px; padding:6px; border-radius:6px; border:1px solid #e6eefc;"></div>
                <div class="progress" aria-hidden="true" title="Stack fill level">
                  <i id="progressBar"></i>
                </div>
              </div>
            </div>

            <div class="side" style="flex:1; min-width:200px;">
              <div>
                <div class="small muted-small" style="margin-bottom:8px;">Pseudocode (highlights the operation)</div>
                <div class="code" id="pseudocode" aria-hidden="false" role="region" aria-label="Pseudocode">
                  <div class="line" data-line="push">push(stack, value):</div>
                  <div class="line" data-line="push1">  if stack.size == capacity: error "overflow"</div>
                  <div class="line" data-line="push2">  stack[top+1] = value</div>
                  <div class="line" data-line="push3">  top = top + 1</div>

                  <div style="height:6px"></div>

                  <div class="line" data-line="pop">pop(stack):</div>
                  <div class="line" data-line="pop1">  if stack.size == 0: error "underflow"</div>
                  <div class="line" data-line="pop2">  value = stack[top]</div>
                  <div class="line" data-line="pop3">  top = top - 1</div>

                  <div style="height:6px"></div>

                  <div class="line" data-line="peek">peek(stack):</div>
                  <div class="line" data-line="peek1">  if stack.size == 0: return null</div>
                  <div class="line" data-line="peek2">  return stack[top]</div>
                </div>
              </div>

              <div style="margin-top:8px;">
                <div class="small muted-small" style="margin-bottom:6px;">History</div>
                <div id="history" class="history" role="log" aria-live="polite"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="muted-small" style="text-align:right;">Tip: Press Enter while focused on the value field to push quickly.</div>
    </div>
  </div>

  <div id="announcer" class="aria-live" aria-live="polite"></div>

  <script>
    (function(){
      // Data model
      const stack = [];
      let capacity = 6;

      // DOM refs
      const valueInput = document.getElementById('value');
      const pushBtn = document.getElementById('pushBtn');
      const popBtn = document.getElementById('popBtn');
      const peekBtn = document.getElementById('peekBtn');
      const clearBtn = document.getElementById('clearBtn');
      const frame = document.getElementById('frame');
      const countLabel = document.getElementById('count');
      const capacityInput = document.getElementById('capacity');
      const progressBar = document.getElementById('progressBar');
      const history = document.getElementById('history');
      const announcer = document.getElementById('announcer');
      const pseudocode = document.getElementById('pseudocode');

      const emptyHint = document.getElementById('emptyHint');

      // Utility: announce
      function announce(text){
        announcer.textContent = text;
      }

      // update UI
      function renderStack(){
        // clear
        // keep only block nodes (non-transient)
        frame.querySelectorAll('.stack-block').forEach(n => n.remove());

        if(stack.length === 0){
          emptyHint.style.display = 'block';
        } else {
          emptyHint.style.display = 'none';
        }

        // top at top: render from top to bottom
        for(let i = stack.length - 1; i >= 0; i--){
          const val = stack[i];
          const block = document.createElement('div');
          block.className = 'stack-block';
          block.setAttribute('tabindex','0');
          block.setAttribute('data-idx', i);
          block.innerHTML = '<div class="label">idx '+i+'</div><div class="value">'+escapeHtml(String(val))+'</div>';
          // click behavior
          block.addEventListener('click', (e) => {
            const idx = Number(block.getAttribute('data-idx'));
            if(idx === stack.length - 1){
              // top block
              doPop();
            } else {
              // non-top clicked
              flashNonTop(block);
              announce("Only the top item can be popped. Try popping the top.");
            }
          });

          // keyboard: Enter on block
          block.addEventListener('keydown', (e) => {
            if(e.key === 'Enter' || e.key === ' '){
              e.preventDefault();
              block.click();
            }
          });

          frame.appendChild(block);
        }

        countLabel.textContent = stack.length;
        const pct = Math.round((stack.length / capacity) * 100);
        progressBar.style.width = Math.min(100, pct) + '%';
      }

      // Escape HTML for values
      function escapeHtml(s){
        return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
      }

      // show transient push animation then finalize
      function doPush(value){
        if(stack.length >= capacity){
          // overflow
          flashError();
          logAction('overflow: push "'+value+'" blocked');
          announce('Overflow: stack is full.');
          highlightCode(['push','push1']);
          return;
        }
        const transient = document.createElement('div');
        transient.className = 'transient slide-in';
        transient.textContent = value;
        frame.appendChild(transient);

        // After animation completes (matching CSS duration)
        transient.addEventListener('animationend', () => {
          // add to model
          stack.push(value);
          // remove transient and render final blocks
          transient.remove();
          renderStack();
          // find new top block and briefly highlight it
          const newTop = frame.querySelector('.stack-block');
          if(newTop){
            newTop.style.transform = 'scale(1.02)';
            setTimeout(()=>{ newTop.style.transform='scale(1)'; }, 220);
          }
          logAction('push "'+value+'"');
          announce('Pushed ' + String(value) + ' onto the stack.');
          highlightCode(['push','push2','push3']);
        }, {once:true});
      }

      function doPop(){
        if(stack.length === 0){
          // underflow
          flashError();
          logAction('underflow: pop blocked');
          announce('Underflow: stack is empty.');
          highlightCode(['pop','pop1']);
          return;
        }
        // remove from model and animate the top out
        const value = stack.pop();
        // create transient block positioned at top
        const transient = document.createElement('div');
        transient.className = 'transient';
        transient.innerHTML = '<div style="font-weight:700;">'+escapeHtml(String(value))+'</div>';
        frame.appendChild(transient);
        // trigger slide out
        requestAnimationFrame(()=> {
          transient.classList.add('slide-out');
        });

        transient.addEventListener('animationend', () => {
          transient.remove();
          renderStack();
          logAction('pop "'+value+'"');
          announce('Popped ' + String(value) + ' from the stack.');
          highlightCode(['pop','pop2','pop3']);
        }, {once:true});
      }

      function doPeek(){
        if(stack.length === 0){
          logAction('peek -> null');
          announce('Peek: stack is empty.');
          highlightCode(['peek','peek1']);
          // brief shake to indicate nothing
          flashError();
          return;
        }
        const topVal = stack[stack.length-1];
        // highlight top block
        const topBlock = frame.querySelector('.stack-block');
        if(topBlock){
          topBlock.classList.add('pulse');
          setTimeout(()=> topBlock.classList.remove('pulse'), 800);
        }
        logAction('peek -> "'+topVal+'"');
        announce('Peek: top is ' + String(topVal));
        highlightCode(['peek','peek2']);
      }

      function doClear(){
        if(stack.length === 0){
          announce('Stack already empty.');
          logAction('clear -> already empty');
          return;
        }
        stack.length = 0;
        renderStack();
        logAction('clear');
        announce('Cleared the stack.');
      }

      // minor helpers
      function logAction(text){
        const el = document.createElement('div');
        const ts = new Date().toLocaleTimeString();
        el.textContent = ts + ' — ' + text;
        history.prepend(el);
        // trim history
        while(history.children.length > 50){ history.removeChild(history.lastChild); }
      }

      function flashError(){
        frame.classList.add('shake', 'error-outline');
        setTimeout(()=> frame.classList.remove('shake','error-outline'), 380);
      }

      function flashNonTop(node){
        node.style.boxShadow = '0 8px 20px rgba(220,38,38,0.12)';
        node.style.transform = 'translateX(-6px)';
        setTimeout(()=>{ node.style.boxShadow=''; node.style.transform=''; }, 320);
      }

      // code highlighting
      function highlightCode(lines){
        // accept array of data-line values
        const all = pseudocode.querySelectorAll('.line');
        all.forEach(l => l.classList.remove('hl'));
        lines.forEach(name => {
          const node = pseudocode.querySelector('[data-line="'+name+'"]');
          if(node) node.classList.add('hl');
        });
        setTimeout(()=> all.forEach(l=> l.classList.remove('hl')), 700);
      }

      // Event wiring
      pushBtn.addEventListener('click', () => {
        const v = valueInput.value.trim();
        if(v === ''){ valueInput.focus(); return; }
        doPush(v);
        valueInput.value = '';
        valueInput.focus();
      });

      popBtn.addEventListener('click', doPop);
      peekBtn.addEventListener('click', doPeek);
      clearBtn.addEventListener('click', doClear);

      // Enter key in input pushes
      valueInput.addEventListener('keydown', (e) => {
        if(e.key === 'Enter'){
          e.preventDefault();
          pushBtn.click();
        }
      });

      capacityInput.addEventListener('change', (e) => {
        let v = Number(e.target.value);
        if(!Number.isFinite(v) || v < 1) v = 1;
        capacity = Math.max(1, Math.floor(v));
        capacityInput.value = capacity;
        // if capacity decreased below current size, keep items but progress shows >100%
        renderStack();
        announce('Capacity set to ' + capacity);
      });

      // initial render
      renderStack();

      // small accessibility: keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        if(e.ctrlKey || e.metaKey) return;
        if(e.key === 'p' && document.activeElement === document.body){
          // let p = push? Avoid interfering with typing
        }
      });

      // expose for debugging (not necessary)
      window._visualStack = {
        push: doPush, pop: doPop, peek: doPeek, clear: doClear, get stack(){ return stack.slice(); }
      };

    })();
  </script>
</body>
</html>