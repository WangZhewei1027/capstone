<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Arrays — Interactive Module</title>
  <style>
    :root{
      --safe-margin: 24px;
      --gap: 16px;
      --bg: #0f1720;
      --panel: #0b1220;
      --muted: #94a3b8;
      --accent: #60a5fa;
      --success: #34d399;
      --danger: #fb7185;
      --glass: rgba(255,255,255,0.03);
      --round: 12px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color-scheme: dark;
    }

    html,body{
      height: 100%;
      margin: 0;
      background: linear-gradient(180deg,#071022 0%, #04111a 100%);
      color: #e6eef8;
    }

    /* Safe area margins: 24px on all sides */
    .safe-area{
      padding: var(--safe-margin);
      box-sizing: border-box;
      min-height: 100vh;
      display: flex;
      align-items: flex-start;
      justify-content: center;
    }

    .module{
      width: 100%;
      max-width: 1100px;
      border-radius: 16px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      padding: calc(var(--gap) * 1.5);
      box-shadow: 0 6px 30px rgba(2,6,23,0.7), inset 0 1px 0 rgba(255,255,255,0.02);
      box-sizing: border-box;
      display: grid;
      grid-template-columns: 380px 1fr;
      grid-column-gap: calc(var(--gap) * 1.5);
      align-items: start;
    }

    @media (max-width: 880px){
      .module{
        grid-template-columns: 1fr;
      }
    }

    /* Left column: info + controls */
    .side{
      background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
      padding: calc(var(--gap) * 1);
      border-radius: 12px;
      min-height: 200px;
      display: flex;
      flex-direction: column;
      gap: var(--gap);
    }

    h1{
      margin: 0;
      font-size: 20px;
      letter-spacing: -0.2px;
      display: flex;
      gap: 12px;
      align-items: center;
    }
    .title-badge{
      background: linear-gradient(90deg,#1e293b,#0ea5e9 70%);
      color: white;
      font-weight: 600;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
    }
    p.lead{
      margin: 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.4;
    }

    .section{
      background: rgba(255,255,255,0.02);
      padding: calc(var(--gap) * 0.75);
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    label{
      font-size: 13px;
      color: var(--muted);
    }

    .controls{
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    input[type="text"], input[type="number"], select{
      background: rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.04);
      padding: 10px 12px;
      border-radius: 8px;
      color: #e6eef8;
      outline: none;
      min-width: 120px;
    }
    input[type="number"]{ width: 90px; }

    button{
      background: var(--accent);
      color: #05203a;
      border: none;
      padding: 10px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: transform 0.12s ease, box-shadow 0.12s;
    }
    button.secondary{
      background: rgba(255,255,255,0.03);
      color: var(--muted);
      border: 1px solid rgba(255,255,255,0.03);
      font-weight: 600;
    }
    button:active{ transform: translateY(1px); }
    button:focus{ outline: 3px solid rgba(96,165,250,0.18); }

    .row{
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
    }

    .meta{
      display:flex;
      gap:12px;
      color:var(--muted);
      font-size:13px;
      align-items:center;
    }

    /* Right column: visual area */
    .visual{
      background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
      padding: calc(var(--gap) * 1);
      border-radius: 12px;
      min-height: 360px;
      display:flex;
      flex-direction:column;
      gap: var(--gap);
    }

    .toolbar{
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap:12px;
    }
    .toolbar .info{
      display:flex;
      gap:12px;
      align-items:center;
    }

    .array-stage{
      background: linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      border-radius: 10px;
      padding: calc(var(--gap) * 0.75);
      min-height: 180px;
      display:flex;
      align-items:center;
      justify-content:flex-start;
      overflow: auto;
      gap: 14px;
      position: relative;
    }

    /* Array boxes */
    .array {
      display:flex;
      gap: 14px;
      align-items:center;
      padding: 12px;
      min-height: 100px;
      flex-wrap: nowrap;
    }

    .item {
      min-width: 88px;
      max-width: 140px;
      height: 64px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius: 10px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      box-shadow: 0 4px 18px rgba(2,6,23,0.5);
      border: 1px solid rgba(255,255,255,0.03);
      position: relative;
      transition: transform 300ms cubic-bezier(.2,.9,.3,1), opacity 300ms ease;
      will-change: transform, opacity;
    }

    .item .value{
      font-weight: 700;
      font-size: 14px;
      word-break: break-word;
      text-align:center;
      padding: 0 6px;
    }

    .item .index{
      position: absolute;
      bottom: -18px;
      background: rgba(255,255,255,0.03);
      color: var(--muted);
      padding: 6px 8px;
      border-radius: 6px;
      font-size: 12px;
      border: 1px solid rgba(255,255,255,0.02);
    }

    .placeholder{
      color:var(--muted);
      font-size:14px;
      padding: 12px;
      border-radius:8px;
    }

    /* Highlight states */
    .item.highlight{
      box-shadow: 0 8px 30px rgba(96,165,250,0.12);
      transform: scale(1.03);
      border-color: rgba(96,165,250,0.4);
    }
    .item.removing{
      opacity:0;
      transform: translateY(-14px) scale(.98);
    }

    .status {
      color: var(--muted);
      font-size: 13px;
    }

    /* JSON view */
    .json-view{
      background: rgba(255,255,255,0.02);
      padding: 12px;
      border-radius: 8px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
      color: #bfe3ff;
      font-size: 13px;
      overflow:auto;
      max-height: 120px;
      border: 1px solid rgba(255,255,255,0.03);
    }

    /* iteration controls */
    .play{
      display:flex;
      gap:10px;
      align-items:center;
    }
    input[type="range"]{
      accent-color: var(--accent);
      width: 160px;
    }

    /* accessibility focus ring for items (keyboard iteration) */
    .item:focus{
      outline: 3px solid rgba(96,165,250,0.18);
    }

    footer.note{
      margin-top: 6px;
      font-size: 12px;
      color: var(--muted);
    }

  </style>
</head>
<body>
  <div class="safe-area">
    <main class="module" role="main" aria-labelledby="title">
      <aside class="side" aria-label="Controls and explanation">
        <div>
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <h1 id="title"><span class="title-badge">Array</span> Indexed collection (0..n-1)</h1>
          </div>
          <p class="lead">Interactive module to understand arrays: indexing, push/pop, shift/unshift, random access, and iteration. Watch how elements move and how length updates.</p>
        </div>

        <div class="section" aria-labelledby="objective-title">
          <strong id="objective-title">Learning Objective</strong>
          <p style="margin:0;color:var(--muted);font-size:13px;">
            After interacting you will intuitively understand:
            - arrays store items in contiguous indexed slots,
            - how operations (push, pop, shift, unshift, set) affect content and length,
            - how iteration visits elements in order.
          </p>
        </div>

        <div class="section" aria-labelledby="interaction-title">
          <strong id="interaction-title">Interaction Design</strong>
          <p style="margin:0;color:var(--muted);font-size:13px;line-height:1.4;">
            Use the form controls to mutate the array:
            - Type a value and Push to append (animated insert).
            - Pop removes the last item (animated removal).
            - Unshift/Shift operate at the front (boxes slide).
            - Set an index to replace a value.
            - Remove by index removes and reindexes.
            - Use "Iterate" to highlight each item step-by-step (speed slider).
            Visual animations show items shifting positions and the JSON view updates in real time.
          </p>
        </div>

        <div class="section" aria-labelledby="controls-title">
          <strong id="controls-title">Controls</strong>

          <div class="row" style="margin-bottom:6px;">
            <label for="value">Value</label>
            <input id="value" type="text" aria-label="Element value" placeholder="e.g. 42 or 'bob'">
            <button id="pushBtn" title="Push">Push</button>
            <button id="popBtn" class="secondary" title="Pop">Pop</button>
          </div>

          <div class="row" style="margin-bottom:6px;">
            <label for="index">Index</label>
            <input id="index" type="number" min="0" aria-label="Index (0-based)" placeholder="0">
            <button id="setBtn" class="secondary" title="Set value at index">Set</button>
            <button id="removeBtn" class="secondary" title="Remove at index">Remove</button>
          </div>

          <div class="row" style="margin-bottom:6px;">
            <button id="unshiftBtn" title="Unshift">Unshift</button>
            <button id="shiftBtn" class="secondary" title="Shift">Shift</button>
            <button id="clearBtn" class="secondary" title="Clear all">Clear</button>
          </div>

          <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
            <div class="meta">
              <span class="status">Length: <strong id="length">0</strong></span>
              <span class="status">Last operation: <span id="op" style="color:var(--muted)">—</span></span>
            </div>
          </div>
        </div>

        <div class="section" aria-labelledby="iterate-title">
          <strong id="iterate-title">Iteration</strong>
          <p style="margin:0;color:var(--muted);font-size:13px;">Run a live traversal that highlights each element in index order.</p>

          <div class="row" style="margin-top:6px;">
            <button id="iterateBtn">Iterate</button>
            <div style="display:flex;align-items:center;gap:8px;">
              <label for="speed" style="font-size:13px;color:var(--muted);margin:0;">Speed</label>
              <input id="speed" type="range" min="200" max="1200" step="50" value="600" aria-label="Iteration speed (ms)">
            </div>
          </div>
        </div>

        <div class="section" aria-labelledby="json-title">
          <strong id="json-title">Array (JSON view)</strong>
          <pre id="json" class="json-view" aria-live="polite">[]</pre>
          <footer class="note">Tip: use keyboard navigation. Controls are reachable by Tab.</footer>
        </div>
      </aside>

      <section class="visual" aria-label="Array visualization">
        <div class="toolbar">
          <div class="info">
            <div style="display:flex;flex-direction:column;">
              <span style="font-weight:700;font-size:14px;">Array visualizer</span>
              <span style="font-size:13px;color:var(--muted);">Boxes are indexed; watch movement on operations.</span>
            </div>
          </div>

          <div class="play">
            <div style="font-size:13px;color:var(--muted);">Index traversal</div>
            <button id="stepBtn" class="secondary" title="Step once">Step</button>
            <button id="stopBtn" class="secondary" title="Stop iteration">Stop</button>
          </div>
        </div>

        <div class="array-stage" id="stage" tabindex="0" aria-label="Array stage">
          <div id="array" class="array" role="list" aria-label="Array elements"></div>
        </div>

        <div style="display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap;">
          <div style="flex:1; min-width:220px;">
            <div class="section" style="padding:12px;">
              <strong>How this teaches arrays</strong>
              <p style="margin:0;color:var(--muted);font-size:13px;line-height:1.4;">
                The module visualizes each element slot with its index. Operations animate real positional changes so you can see shifting and reindexing. The JSON view keeps a textual representation synced with the visual array.
              </p>
            </div>
          </div>

          <div style="width:320px;min-width:220px;">
            <div class="section" style="padding:12px;">
              <strong>Notes</strong>
              <ul style="margin:8px 0 0 18px;color:var(--muted);font-size:13px;line-height:1.5;">
                <li>Arrays are 0-indexed.</li>
                <li>Push/Pop operate at the end. Unshift/Shift operate at the front.</li>
                <li>Setting a value replaces content but keeps the index.</li>
              </ul>
            </div>
          </div>
        </div>

      </section>
    </main>
  </div>

  <script>
    // Array model
    const model = {
      items: [], // stores values as strings
      lastOp: '—',
    };

    // DOM refs
    const arrayEl = document.getElementById('array');
    const jsonEl = document.getElementById('json');
    const lengthEl = document.getElementById('length');
    const opEl = document.getElementById('op');

    // Controls
    const valueInput = document.getElementById('value');
    const indexInput = document.getElementById('index');
    const pushBtn = document.getElementById('pushBtn');
    const popBtn = document.getElementById('popBtn');
    const unshiftBtn = document.getElementById('unshiftBtn');
    const shiftBtn = document.getElementById('shiftBtn');
    const setBtn = document.getElementById('setBtn');
    const removeBtn = document.getElementById('removeBtn');
    const clearBtn = document.getElementById('clearBtn');
    const iterateBtn = document.getElementById('iterateBtn');
    const stepBtn = document.getElementById('stepBtn');
    const stopBtn = document.getElementById('stopBtn');
    const speedInput = document.getElementById('speed');

    // Iteration state
    let iterTimer = null;
    let iterIndex = 0;
    let isIterating = false;

    // Utility: sanitize input to display nicely
    function sanitize(val){
      if (val === '') return '""';
      // if numeric-like keep as-is
      if (!isNaN(val) && val.trim() !== '') return String(val);
      // quoted representation
      return String(val);
    }

    // Render functions with FLIP animation
    function renderArray(animate = true){
      // capture first positions
      const oldRects = new Map();
      Array.from(arrayEl.children).forEach(child => {
        const id = child.dataset.idx;
        oldRects.set(id, child.getBoundingClientRect());
      });

      // Clear and re-create elements based on model.items
      // But we want to reuse nodes where possible to animate smoothly.
      // Strategy: create new node list; match by index string.
      const newNodes = [];
      for (let i = 0; i < model.items.length; i++){
        const existing = document.querySelector(`.item[data-idx="${i}"]`);
        let node;
        if (existing && existing.dataset.key === String(model.items[i].__key)) {
          // reuse
          node = existing;
          // update content if changed
          const v = node.querySelector('.value');
          v.textContent = String(model.items[i]);
        } else {
          // create new node
          node = makeItemNode(model.items[i], i);
        }
        node.dataset.idx = i;
        newNodes.push(node);
      }

      // Remove any leftover nodes not in newNodes
      // But we will update arrayEl children by replacing content.
      arrayEl.innerHTML = '';
      newNodes.forEach(n=>{
        arrayEl.appendChild(n);
      });

      // If no items show placeholder
      if (model.items.length === 0){
        const ph = document.createElement('div');
        ph.className = 'placeholder';
        ph.textContent = 'Array is empty — push to add elements';
        arrayEl.appendChild(ph);
      }

      // After DOM updated, compute new rects and apply FLIP
      if (animate){
        const newRects = new Map();
        Array.from(arrayEl.querySelectorAll('.item')).forEach(child => {
          const id = child.dataset.idx;
          newRects.set(id, child.getBoundingClientRect());
        });

        // For each node, compute delta and animate accordingly
        newRects.forEach((newRect, id) => {
          const oldRect = oldRects.get(id);
          const node = document.querySelector(`.item[data-idx="${id}"]`);
          if (!node) return;
          if (oldRect){
            const dx = oldRect.left - newRect.left;
            const dy = oldRect.top - newRect.top;
            if (dx !== 0 || dy !== 0){
              node.style.transition = 'none';
              node.style.transform = `translate(${dx}px, ${dy}px)`;
              requestAnimationFrame(()=>{
                node.style.transition = 'transform 320ms cubic-bezier(.2,.9,.3,1)';
                node.style.transform = '';
              });
            }
          } else {
            // New node: simple "pop in" animation
            node.style.opacity = '0';
            node.style.transform = 'translateY(-14px)';
            requestAnimationFrame(()=>{
              node.style.transition = 'transform 300ms cubic-bezier(.2,.9,.3,1), opacity 300ms ease';
              node.style.opacity = '1';
              node.style.transform = '';
            });
          }
        });
      }

      // Update JSON and meta
      updateMeta();
    }

    function makeItemNode(value, index){
      const wrapper = document.createElement('div');
      wrapper.className = 'item';
      wrapper.tabIndex = 0;
      wrapper.setAttribute('role','listitem');
      wrapper.dataset.idx = index;
      // attach unique key to identify identical values reuse (not necessary but helpful)
      wrapper.dataset.key = String(Math.random().toString(36).slice(2,9));
      const v = document.createElement('div');
      v.className = 'value';
      v.textContent = String(value);
      const idx = document.createElement('div');
      idx.className = 'index';
      idx.textContent = index;
      wrapper.appendChild(v);
      wrapper.appendChild(idx);

      // click to focus/inspect
      wrapper.addEventListener('click', ()=>{
        highlightIndex(index);
      });

      return wrapper;
    }

    function updateMeta(){
      lengthEl.textContent = String(model.items.length);
      opEl.textContent = model.lastOp;
      jsonEl.textContent = JSON.stringify(model.items.map(v => v), null, 2);
    }

    // Core operations: uses FLIP-enabled render
    function pushValue(raw){
      const val = raw === '' ? '' : raw;
      model.items.push(val);
      model.lastOp = `push("${val}")`;
      renderArray(true);
    }

    function popValue(){
      if (model.items.length === 0) return;
      // animate last item removal
      const idx = model.items.length - 1;
      const node = document.querySelector(`.item[data-idx="${idx}"]`);
      if (node){
        node.classList.add('removing');
        node.style.transition = 'transform 300ms ease, opacity 300ms ease';
        node.style.transform = 'translateY(-14px) scale(.98)';
        node.style.opacity = '0';
        setTimeout(()=>{
          model.items.pop();
          model.lastOp = 'pop()';
          renderArray(true);
        }, 300);
      } else {
        model.items.pop();
        model.lastOp = 'pop()';
        renderArray(true);
      }
    }

    function unshiftValue(raw){
      const val = raw === '' ? '' : raw;
      model.items.unshift(val);
      model.lastOp = `unshift("${val}")`;
      renderArray(true);
    }

    function shiftValue(){
      if (model.items.length === 0) return;
      // animate first item removal with shift of others
      const node = document.querySelector(`.item[data-idx="0"]`);
      if (node){
        node.classList.add('removing');
        node.style.transition = 'transform 300ms ease, opacity 300ms ease';
        node.style.transform = 'translateY(-14px) scale(.98)';
        node.style.opacity = '0';
        setTimeout(()=>{
          model.items.shift();
          model.lastOp = 'shift()';
          renderArray(true);
        }, 300);
      } else {
        model.items.shift();
        model.lastOp = 'shift()';
        renderArray(true);
      }
    }

    function setAt(index, raw){
      if (index < 0 || index >= model.items.length || !Number.isInteger(index)) {
        flashMessage('Invalid index', 'danger');
        return;
      }
      model.items[index] = raw;
      model.lastOp = `set(${index}, "${raw}")`;
      // highlight replaced index
      renderArray(true);
      highlightIndex(index);
    }

    function removeAt(index){
      if (index < 0 || index >= model.items.length || !Number.isInteger(index)) {
        flashMessage('Invalid index', 'danger');
        return;
      }
      // animate removal of node at index
      const node = document.querySelector(`.item[data-idx="${index}"]`);
      if (node){
        node.classList.add('removing');
        node.style.transition = 'transform 300ms ease, opacity 300ms ease';
        node.style.transform = 'translateY(-12px) scale(.98)';
        node.style.opacity = '0';
        setTimeout(()=>{
          model.items.splice(index,1);
          model.lastOp = `remove(${index})`;
          renderArray(true);
        }, 300);
      } else {
        model.items.splice(index,1);
        model.lastOp = `remove(${index})`;
        renderArray(true);
      }
    }

    function clearAll(){
      model.items = [];
      model.lastOp = 'clear()';
      renderArray(true);
    }

    // Highlight an index momentarily (used for iterate and set)
    function highlightIndex(idx){
      const node = document.querySelector(`.item[data-idx="${idx}"]`);
      if (!node) return;
      node.classList.add('highlight');
      node.focus();
      setTimeout(()=> node.classList.remove('highlight'), 700);
    }

    // Flash message in op area
    function flashMessage(text, type = 'info'){
      opEl.textContent = text;
      if (type === 'danger'){
        opEl.style.color = 'var(--danger)';
      } else {
        opEl.style.color = 'var(--accent)';
      }
      setTimeout(()=> {
        opEl.textContent = model.lastOp || '—';
        opEl.style.color = '';
      }, 900);
    }

    // Iteration: step through indices
    function startIteration(){
      if (isIterating) return;
      isIterating = true;
      iterIndex = 0;
      model.lastOp = 'iterate(start)';
      iterateStep();
    }

    function iterateStep(){
      if (!isIterating) return;
      if (model.items.length === 0){
        flashMessage('Array empty', 'danger');
        isIterating = false;
        return;
      }
      if (iterIndex >= model.items.length){
        // done
        isIterating = false;
        model.lastOp = 'iterate(end)';
        renderArray(true);
        return;
      }
      // highlight current
      const idx = iterIndex;
      highlightIndex(idx);
      model.lastOp = `iterate(index ${idx})`;
      iterIndex++;
      const delay = parseInt(speedInput.value, 10) || 600;
      iterTimer = setTimeout(iterateStep, delay);
    }

    function stopIteration(){
      isIterating = false;
      if (iterTimer) {
        clearTimeout(iterTimer);
        iterTimer = null;
      }
      model.lastOp = 'iterate(stop)';
      renderArray(true);
    }

    // Step single iteration
    function stepOnce(){
      if (model.items.length === 0) {
        flashMessage('Array empty', 'danger');
        return;
      }
      if (iterIndex >= model.items.length) iterIndex = 0;
      highlightIndex(iterIndex);
      model.lastOp = `step(${iterIndex})`;
      iterIndex++;
    }

    // Attach events
    pushBtn.addEventListener('click', ()=>{
      pushValue(valueInput.value);
      valueInput.focus();
    });
    popBtn.addEventListener('click', ()=> popValue());
    unshiftBtn.addEventListener('click', ()=> {
      unshiftValue(valueInput.value);
      valueInput.focus();
    });
    shiftBtn.addEventListener('click', ()=> shiftValue());
    setBtn.addEventListener('click', ()=>{
      const idx = Number(indexInput.value);
      if (String(indexInput.value) === '' || isNaN(idx)){
        flashMessage('Enter a valid index', 'danger');
        return;
      }
      setAt(idx, valueInput.value);
    });
    removeBtn.addEventListener('click', ()=>{
      const idx = Number(indexInput.value);
      if (String(indexInput.value) === '' || isNaN(idx)){
        flashMessage('Enter a valid index', 'danger');
        return;
      }
      removeAt(idx);
    });
    clearBtn.addEventListener('click', ()=> clearAll());

    iterateBtn.addEventListener('click', ()=> {
      if (isIterating) {
        stopIteration();
      } else {
        startIteration();
      }
    });
    stopBtn.addEventListener('click', ()=> stopIteration());
    stepBtn.addEventListener('click', ()=> stepOnce());

    // Keyboard shortcuts for convenience (accessible)
    document.addEventListener('keydown', (e)=>{
      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter'){
        // Ctrl/Cmd+Enter -> push
        pushBtn.click();
      }
      if ((e.ctrlKey || e.metaKey) && e.key === 'Backspace'){
        popBtn.click();
      }
    });

    // Initialize with a sample set to demonstrate
    (function seed(){
      model.items = ['10', '20', '30'];
      model.lastOp = 'init';
      renderArray(false);
    })();

    // Public helpers for dev (not necessary)
    window._model = model;
  </script>
</body>
</html>