<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Insertion Sort — Interactive Explorer</title>
  <style>
    :root{
      --safe-margin:24px;
      --gap:16px;
      --bg:#0f1720;
      --panel:#0b1220;
      --card:#0f1b2a;
      --muted:#9aa7b7;
      --accent:#3ea3ff;
      --accent-2:#7df0a4;
      --text:#e6eef6;
      --danger:#ff6b6b;
      --control-bg:#111827;
      --speed-default:400; /* ms */
    }
    /* Safe area and base */
    html,body{
      height:100%;
      margin:0;
      padding:0;
      background:linear-gradient(180deg,#071023 0%, #0b1622 100%);
      color:var(--text);
      font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    main{
      padding:var(--safe-margin);
      box-sizing:border-box;
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:flex-start;
    }
    .container{
      width:100%;
      max-width:1200px;
      display:flex;
      flex-direction:column;
      gap:var(--gap);
    }

    header{
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .title{
      font-size:20px;
      font-weight:700;
      letter-spacing:-0.2px;
    }
    .subtitle{
      font-size:13px;
      color:var(--muted);
    }

    /* Layout: two-column responsive */
    .module{
      display:flex;
      gap:var(--gap);
      align-items:flex-start;
      flex-wrap:wrap;
    }

    /* Left column: info + controls */
    .left{
      flex:1 1 340px;
      min-width:280px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:16px;
      box-sizing:border-box;
      border:1px solid rgba(255,255,255,0.03);
    }
    .panel-section{
      margin-bottom:12px;
    }
    .label{
      font-size:12px;
      color:var(--muted);
      margin-bottom:8px;
    }
    .desc{
      font-size:13px;
      color:var(--text);
      line-height:1.4;
    }
    .controls{
      display:flex;
      flex-wrap:wrap;
      gap:var(--gap);
      margin-top:8px;
      align-items:center;
    }
    .controls button, .controls input[type="text"], .controls select{
      background:var(--control-bg);
      color:var(--text);
      border:1px solid rgba(255,255,255,0.03);
      padding:10px 12px;
      border-radius:8px;
      min-height:40px;
      font-size:14px;
      cursor:pointer;
    }
    .controls button:active{ transform:translateY(1px);}
    .controls button[aria-pressed="true"]{
      outline:2px solid rgba(62,163,255,0.18);
      box-shadow:0 4px 18px rgba(62,163,255,0.06);
    }
    .controls input[type="text"]{
      flex:1 1 180px;
      min-width:120px;
    }
    .small{
      background:var(--panel);
      padding:8px;
      border-radius:8px;
      display:flex;
      gap:8px;
      align-items:center;
      font-size:13px;
      color:var(--muted);
    }
    .speed{
      display:flex;
      align-items:center;
      gap:8px;
    }
    .speed input[type="range"]{
      width:160px;
    }

    /* Right column: visual + pseudocode */
    .right{
      flex:2 1 560px;
      min-width:300px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .visual-card{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:16px;
      box-sizing:border-box;
      border:1px solid rgba(255,255,255,0.03);
      min-height:220px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .array-area{
      position:relative;
      height:120px;
      background:linear-gradient(90deg, rgba(255,255,255,0.006), transparent);
      border-radius:8px;
      padding:12px;
      box-sizing:border-box;
      overflow:hidden;
    }
    .bars{
      position:relative;
      height:100%;
      width:100%;
      box-sizing:border-box;
    }
    .bar{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      height:64px;
      min-width:44px;
      padding:6px;
      box-sizing:border-box;
      border-radius:8px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      color:var(--text);
      background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.04);
      transition: transform 400ms cubic-bezier(.2,.9,.3,1), background-color 180ms, box-shadow 180ms;
      will-change:transform, background-color;
      user-select:none;
    }
    .bar .value{
      font-size:14px;
      color:var(--text);
    }
    .index-label{
      position:absolute;
      top:6px;
      left:6px;
      font-size:11px;
      color:var(--muted);
    }
    .bar.key{
      background:linear-gradient(180deg, rgba(62,163,255,0.14), rgba(62,163,255,0.06));
      box-shadow:0 6px 18px rgba(62,163,255,0.06);
      transform:translateY(-65%) scale(1.03);
      z-index:20;
    }
    .bar.compare{
      background:linear-gradient(180deg, rgba(255,183,77,0.12), rgba(255,183,77,0.04));
      box-shadow:0 8px 20px rgba(255,183,77,0.06);
    }
    .bar.shifted{
      background:linear-gradient(180deg, rgba(125,240,164,0.08), rgba(125,240,164,0.02));
      box-shadow:0 6px 18px rgba(125,240,164,0.06);
    }

    .pseudocode{
      background:var(--panel);
      border-radius:8px;
      padding:12px;
      font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
      font-size:13px;
      color:var(--muted);
      overflow:auto;
      max-height:200px;
      border:1px solid rgba(255,255,255,0.02);
    }
    .code-line{
      padding:6px 8px;
      border-radius:6px;
    }
    .code-line.active{
      background:linear-gradient(90deg, rgba(62,163,255,0.08), rgba(62,163,255,0.04));
      color:var(--text);
      box-shadow:inset 0 0 0 1px rgba(62,163,255,0.06);
    }

    /* Footer info */
    .legend{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      font-size:13px;
      color:var(--muted);
    }
    .legend .item{
      display:flex;
      gap:8px;
      align-items:center;
      background:rgba(255,255,255,0.02);
      padding:8px;
      border-radius:8px;
    }
    .dot{
      width:14px;
      height:14px;
      border-radius:4px;
      background:var(--muted);
    }
    .dot.key{ background:linear-gradient(180deg, rgba(62,163,255,0.9), rgba(30,130,240,0.9));}
    .dot.compare{ background:linear-gradient(180deg, rgba(255,183,77,0.9), rgba(240,150,40,0.9));}
    .dot.shift{ background:linear-gradient(180deg, rgba(125,240,164,0.9), rgba(70,200,120,0.9));}

    /* small screens */
    @media (max-width:880px){
      .module{ flex-direction:column; }
      .right{ order:2; }
    }
  </style>
</head>
<body>
  <main>
    <div class="container" role="main">
      <header>
        <div class="title">Insertion Sort — Interactive Explorer</div>
        <div class="subtitle">Step through insertion sort with animated shifts, inspect pseudocode, and try your own arrays.</div>
      </header>

      <section class="module" aria-labelledby="module-title">
        <!-- Left: Info + Controls -->
        <aside class="left" aria-label="Controls and explanation">
          <div class="panel-section" aria-hidden="false">
            <div class="label">Concept Title</div>
            <div class="desc"><strong>Insertion Sort (in-place, stable)</strong> — build a sorted segment on the left by inserting the current element at its correct position.</div>
          </div>

          <div class="panel-section">
            <div class="label">Learning Objective</div>
            <div class="desc">
              After interacting you will be able to:
              <ul style="margin:8px 0 0 18px;">
                <li>Visualize how insertion sort shifts elements to make room for the key.</li>
                <li>Follow the algorithm step-by-step and map actions to pseudocode.</li>
                <li>Experiment with different input arrays and animation speeds.</li>
              </ul>
            </div>
          </div>

          <div class="panel-section">
            <div class="label">Interaction Design</div>
            <div class="desc">
              Controls and interactions:
              <ul style="margin:8px 0 0 18px;">
                <li>Enter a comma-separated list of numbers or press Randomize to create an array.</li>
                <li>Step Forward / Back through the prepared action list — every action animates (select key, compare, shift, place).</li>
                <li>Play will animate actions sequentially using the speed slider; Pause stops playback.</li>
                <li>Pseudocode lines are highlighted to link visual actions to code flow.</li>
              </ul>
            </div>
          </div>

          <div class="panel-section">
            <div class="label">Layout Description</div>
            <div class="desc">
              The page uses a responsive two-column layout:
              <ul style="margin:8px 0 0 18px;">
                <li>Left column: text, input form and controls (min-width 280px).</li>
                <li>Right column: visual array + pseudocode (flexible, larger area).</li>
                <li>Safe margins are 24px around the viewport and minimum spacing between interactive elements is 16px.</li>
              </ul>
            </div>
          </div>

          <div class="panel-section">
            <div class="label">Array Input</div>
            <div style="display:flex;gap:12px;align-items:center;">
              <input id="arrayInput" type="text" aria-label="Array input" placeholder="e.g. 5,3,8,1,4" />
              <button id="setArrayBtn" title="Set array">Set</button>
              <button id="randomBtn" title="Randomize">Randomize</button>
            </div>
            <div style="margin-top:10px;font-size:13px;color:var(--muted)">Elements will be clamped to integers between -999 and 999. Max length: 12.</div>
          </div>

          <div class="panel-section">
            <div class="label">Controls</div>
            <div class="controls" role="toolbar" aria-label="Playback controls">
              <button id="stepBack" title="Step Back" aria-label="Step Back">⟲ Back</button>
              <button id="stepForward" title="Step Forward" aria-label="Step Forward">Forward ⟳</button>
              <button id="playPause" title="Play" aria-pressed="false" aria-label="Play or pause">Play ▶</button>
              <button id="resetBtn" title="Reset">Reset</button>
            </div>
            <div style="margin-top:10px;display:flex;gap:12px;align-items:center;flex-wrap:wrap;">
              <div class="small" title="Current action index">
                <div style="font-weight:700" id="actionCounter">Action 0 / 0</div>
              </div>
              <div class="small" title="Array length">
                Length: <strong id="arrayLen" style="margin-left:6px">0</strong>
              </div>
            </div>
          </div>

          <div class="panel-section">
            <div class="label">Playback Speed</div>
            <div class="speed">
              <input id="speedRange" type="range" min="80" max="1200" value="400" aria-label="Animation speed" />
              <div class="small">Speed: <strong id="speedLabel" style="margin-left:8px">400ms</strong></div>
            </div>
          </div>

          <div class="panel-section">
            <div class="label">Legend</div>
            <div class="legend" aria-hidden="false">
              <div class="item"><div class="dot key" aria-hidden="true"></div><div>Key (being inserted)</div></div>
              <div class="item"><div class="dot compare" aria-hidden="true"></div><div>Comparing</div></div>
              <div class="item"><div class="dot shift" aria-hidden="true"></div><div>Shifted to the right</div></div>
            </div>
          </div>
        </aside>

        <!-- Right: Visual + Pseudocode -->
        <section class="right" aria-label="Visualization">
          <div class="visual-card" role="region" aria-label="Array visualization">
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <div style="font-weight:700">Array Visualization</div>
              <div style="color:var(--muted);font-size:13px">Insertion Sort — animated shifts</div>
            </div>

            <div class="array-area" id="arrayArea" aria-live="polite">
              <div class="index-label" id="indicesHint">Indices: 0 .. n-1</div>
              <div class="bars" id="barsContainer" aria-hidden="false"></div>
            </div>

            <div style="display:flex;justify-content:space-between;align-items:center;font-size:13px;color:var(--muted);">
              <div id="statusText">Status: Idle</div>
              <div id="timeEstimate" aria-hidden="true"></div>
            </div>
          </div>

          <div class="pseudocode" role="region" aria-label="Pseudocode">
            <!-- Simple insertion sort pseudocode with line ids -->
            <div id="line0" class="code-line">1  for i = 1 to n-1</div>
            <div id="line1" class="code-line">2    key = A[i]</div>
            <div id="line2" class="code-line">3    j = i - 1</div>
            <div id="line3" class="code-line">4    while j &gt;= 0 and A[j] &gt; key</div>
            <div id="line4" class="code-line">5      A[j+1] = A[j]   // shift right</div>
            <div id="line5" class="code-line">6      j = j - 1</div>
            <div id="line6" class="code-line">7    A[j+1] = key     // place key</div>
          </div>
        </section>
      </section>
    </div>
  </main>

  <script>
    // Insertion Sort Interactive — Vanilla JS
    (function(){
      // DOM elements
      const arrayInput = document.getElementById('arrayInput');
      const setArrayBtn = document.getElementById('setArrayBtn');
      const randomBtn = document.getElementById('randomBtn');
      const stepBackBtn = document.getElementById('stepBack');
      const stepForwardBtn = document.getElementById('stepForward');
      const playPauseBtn = document.getElementById('playPause');
      const resetBtn = document.getElementById('resetBtn');
      const speedRange = document.getElementById('speedRange');
      const speedLabel = document.getElementById('speedLabel');
      const barsContainer = document.getElementById('barsContainer');
      const actionCounter = document.getElementById('actionCounter');
      const arrayLen = document.getElementById('arrayLen');
      const statusText = document.getElementById('statusText');
      const indicesHint = document.getElementById('indicesHint');
      const pseudocodeLines = Array.from({length:7}, (_,i)=>document.getElementById('line'+i));

      // State
      let initialArray = [5,3,8,1,4];
      let actions = []; // precomputed actions list
      let currentActionIndex = 0; // how many actions have been applied
      let playing = false;
      let playTimer = null;

      // Visual parameters
      let transitionMs = parseInt(speedRange.value || 400, 10);

      // Constraints
      const MAX_LEN = 12;
      const MIN_VAL = -999;
      const MAX_VAL = 999;

      // Build initial UI
      arrayInput.value = initialArray.join(',');
      speedLabel.textContent = transitionMs + 'ms';
      setupFromInput();

      // Event listeners
      setArrayBtn.addEventListener('click', setupFromInput);
      randomBtn.addEventListener('click', () => {
        const n = 6 + Math.floor(Math.random()* (MAX_LEN - 6 + 1));
        const arr = Array.from({length:n}, ()=> Math.floor(Math.random()*41)-10);
        arrayInput.value = arr.join(',');
        setupFromInput();
      });
      stepForwardBtn.addEventListener('click', ()=> stepForward());
      stepBackBtn.addEventListener('click', ()=> stepBack());
      playPauseBtn.addEventListener('click', togglePlay);
      resetBtn.addEventListener('click', ()=> {
        stopPlay();
        currentActionIndex = 0;
        renderActions(currentActionIndex);
      });
      speedRange.addEventListener('input', ()=> {
        transitionMs = parseInt(speedRange.value,10);
        speedLabel.textContent = transitionMs + 'ms';
        updateAnimationSpeed();
      });

      // keyboard shortcuts: Space toggles play/pause
      window.addEventListener('keydown', (e)=>{
        if(e.code === 'Space'){
          e.preventDefault();
          togglePlay();
        } else if(e.key === 'ArrowRight'){
          stepForward();
        } else if(e.key === 'ArrowLeft'){
          stepBack();
        }
      });

      // Resize handling: recalc positions on resize
      window.addEventListener('resize', recalcPositions);

      // Helpers: clamp and parse
      function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
      function parseArrayInput(text){
        if(!text.trim()) return [];
        const tokens = text.split(',');
        const nums = [];
        for(const t of tokens){
          const v = parseInt(t.trim(),10);
          if(Number.isFinite(v)) nums.push(clamp(v,MIN_VAL,MAX_VAL));
        }
        return nums.slice(0,MAX_LEN);
      }

      // Create actions by simulating insertion sort
      // Action types: select(i), compare(j,i?), shift(from,to), place(index,value), done
      function buildActions(arr){
        const a = arr.slice();
        const acts = [];
        const n = a.length;
        for(let i=1;i<n;i++){
          acts.push({type:'select', i:i});
          const key = a[i];
          let j = i-1;
          acts.push({type:'setKeyValue', value:key}); // for clarity to UI
          while(j >= 0 && a[j] > key){
            acts.push({type:'compare', j:j, keyIndex:i});
            // shift a[j] to a[j+1]
            acts.push({type:'shift', from:j, to:j+1});
            a[j+1] = a[j];
            j = j-1;
            acts.push({type:'decrementJ', j:j});
          }
          if(j >= 0){
            // final comparison that fails (optional)
            acts.push({type:'compare', j:j, keyIndex:i, result:false});
          }
          acts.push({type:'place', index:j+1, value:key});
          a[j+1] = key;
        }
        acts.push({type:'done'});
        return acts;
      }

      // Render functions: set bars to positions according to an array state
      // For animation, we'll set transform: translateX(px) according to index position.
      let visualArray = []; // current values mapped to bars (array of values)
      let barElements = []; // DOM nodes for bars
      function renderInitialBars(arr){
        // remove existing
        barsContainer.innerHTML = '';
        barElements = [];
        visualArray = arr.slice();
        arrayLen.textContent = arr.length;
        indicesHint.textContent = (arr.length>0) ? `Indices: 0 .. ${arr.length-1}` : 'Indices: (empty)';
        // create bars
        for(let i=0;i<arr.length;i++){
          const b = document.createElement('div');
          b.className='bar';
          b.setAttribute('data-index', i);
          b.setAttribute('role','img');
          b.setAttribute('aria-label', `Value ${arr[i]} at index ${i}`);
          const v = document.createElement('div');
          v.className='value';
          v.textContent = String(arr[i]);
          b.appendChild(v);
          barsContainer.appendChild(b);
          barElements.push(b);
        }
        // position them
        recalcPositions(true);
      }

      function recalcPositions(noTransition){
        // Calculate available width and assign positions
        const container = barsContainer;
        const w = container.clientWidth - 12; // padding compensation
        const n = barElements.length;
        const gap = 12; // pixel gap between bars
        let barW = 96;
        if(n>0){
          barW = Math.max(44, Math.min(160, Math.floor((w - (n-1)*gap)/n)));
        }
        // set CSS vars for transition speed
        updateAnimationSpeed();
        for(let i=0;i<barElements.length;i++){
          const el = barElements[i];
          // calculate center positions so bars look evenly spaced
          const left = i * (barW + gap) + 6; // 6 px left padding
          if(noTransition){
            el.style.transition = 'none';
            requestAnimationFrame(()=> {
              el.style.transform = `translate(${left}px, -50%)`;
              // force reflow then restore transition
              void el.offsetWidth;
              el.style.transition = `transform ${transitionMs}ms cubic-bezier(.2,.9,.3,1), background-color 180ms, box-shadow 180ms`;
            });
          } else {
            el.style.transform = `translate(${left}px, -50%)`;
          }
        }
      }

      function updateAnimationSpeed(){
        // update CSS transition durations
        for(const el of barElements){
          el.style.transition = `transform ${transitionMs}ms cubic-bezier(.2,.9,.3,1), background-color 180ms, box-shadow 180ms`;
        }
        // update global
        speedLabel.textContent = transitionMs + 'ms';
      }

      // Apply actions up to index (0..actions.length). We rebuild the array from initial and apply actions sequentially to produce a deterministic state.
      function renderActions(upTo){
        // Reset bar classes
        for(const el of barElements){
          el.classList.remove('key','compare','shifted');
        }
        // Reconstruct array state by applying actions from scratch
        let arr = initialArray.slice();
        let keyValue = undefined;
        let highlighted = {keyIndex:-1, compareIndex:-1};
        // Apply actions sequentially (but we won't animate internal steps here; positions will animate using CSS)
        for(let k=0;k<upTo && k<actions.length;k++){
          const a = actions[k];
          switch(a.type){
            case 'select':
              highlighted.keyIndex = a.i;
              // keyValue will be set by setKeyValue action
              break;
            case 'setKeyValue':
              keyValue = a.value;
              break;
            case 'compare':
              highlighted.compareIndex = a.j;
              break;
            case 'shift':
              // move arr[from] to arr[to]
              arr[a.to] = arr[a.from];
              // mark shifted bar visually after we update DOM
              break;
            case 'decrementJ':
              // no direct change to array
              break;
            case 'place':
              arr[a.index] = a.value;
              // placing key
              break;
            case 'done':
              // nothing
              break;
          }
        }

        // Update visualArray values and text
        // If array size changed, re-create bars (shouldn't change length in insertion sort)
        if(arr.length !== visualArray.length){
          renderInitialBars(arr);
          visualArray = arr.slice();
        } else {
          visualArray = arr.slice();
          // update text inside bars and aria labels
          for(let i=0;i<visualArray.length;i++){
            const el = barElements[i];
            el.querySelector('.value').textContent = String(visualArray[i]);
            el.setAttribute('data-index', i);
            el.setAttribute('aria-label', `Value ${visualArray[i]} at index ${i}`);
            // clear classes
            el.classList.remove('key','compare','shifted');
          }
        }

        // Apply highlights based on the last action applied
        const lastAction = actions[Math.max(0, upTo-1)];
        if(lastAction){
          switch(lastAction.type){
            case 'select':
            case 'setKeyValue':
              if(highlighted.keyIndex >=0 && barElements[highlighted.keyIndex])
                barElements[highlighted.keyIndex].classList.add('key');
              setActiveLine(1); // key = A[i] line
              break;
            case 'compare':
              if(barElements[lastAction.j]) barElements[lastAction.j].classList.add('compare');
              if(barElements[lastAction.keyIndex]) barElements[lastAction.keyIndex].classList.add('key');
              setActiveLine(3);
              break;
            case 'shift':
              // The shift action already updated array values at this point; highlight the "to" index as shifted
              if(barElements[lastAction.to]) barElements[lastAction.to].classList.add('shifted');
              setActiveLine(4);
              break;
            case 'place':
              if(barElements[lastAction.index]) barElements[lastAction.index].classList.add('key');
              setActiveLine(6);
              break;
            case 'done':
              setActiveLine(-1);
              break;
            default:
              setActiveLine(-1);
          }
        } else {
          setActiveLine(-1);
        }

        // Update positions (CSS transitions will animate)
        recalcPositions(false);

        // Update UI counters and status
        actionCounter.textContent = `Action ${upTo} / ${actions.length}`;
        arrayLen.textContent = visualArray.length;
        statusText.textContent = (upTo >= actions.length) ? 'Status: Finished' : 'Status: Ready';
      }

      function setActiveLine(n){
        // map actions to pseudocode lines
        const mapping = {
          'select': 1,
          'setKeyValue': 1,
          'compare': 3,
          'shift': 4,
          'decrementJ': 5,
          'place': 6,
          'done': -1
        };
        // If n is -1 then clear
        pseudocodeLines.forEach(line => line.classList.remove('active'));
        if(typeof n === 'number' && n>=0 && n < pseudocodeLines.length){
          pseudocodeLines[n].classList.add('active');
        }
      }

      // Build actions and recreate visual elements
      function setupFromInput(){
        stopPlay();
        const arr = parseArrayInput(arrayInput.value);
        if(arr.length === 0){
          // default
          initialArray = [];
        } else {
          initialArray = arr;
        }
        // create visual bars and actions
        renderInitialBars(initialArray);
        actions = buildActions(initialArray);
        currentActionIndex = 0;
        renderActions(0);
      }

      // Step forward: increment currentActionIndex and animate
      function stepForward(){
        if(currentActionIndex >= actions.length){
          // already finished
          return;
        }
        currentActionIndex++;
        renderActions(currentActionIndex);
      }

      function stepBack(){
        if(currentActionIndex <= 0) return;
        stopPlay();
        currentActionIndex--;
        renderActions(currentActionIndex);
      }

      // Play/pause logic
      function togglePlay(){
        if(playing) stopPlay();
        else startPlay();
      }
      function startPlay(){
        if(playing) return;
        playing = true;
        playPauseBtn.setAttribute('aria-pressed','true');
        playPauseBtn.textContent = 'Pause ⏸';
        statusText.textContent = 'Status: Playing';
        scheduleNext();
      }
      function stopPlay(){
        playing = false;
        if(playTimer) { clearTimeout(playTimer); playTimer = null; }
        playPauseBtn.setAttribute('aria-pressed','false');
        playPauseBtn.textContent = 'Play ▶';
        statusText.textContent = 'Status: Paused';
      }
      function scheduleNext(){
        if(!playing) return;
        if(currentActionIndex >= actions.length){
          stopPlay();
          currentActionIndex = actions.length;
          renderActions(currentActionIndex);
          return;
        }
        // Step and schedule based on transitionMs
        stepForward();
        // Wait transitionMs + small buffer to allow user to see animation
        playTimer = setTimeout(()=> scheduleNext(), transitionMs + 80);
      }

      // Initialize UI with starting array
      // already called above

      // Accessibility: focus outlines and hover hints
      // (No additional code required — using native controls and ARIA attributes)

      // Expose some helpers on window for debugging (optional)
      window.__insertionSort = {
        getState: ()=> ({ initialArray, actions, currentActionIndex }),
      };
    })();
  </script>
</body>
</html>