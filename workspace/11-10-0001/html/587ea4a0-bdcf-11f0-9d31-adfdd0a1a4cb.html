<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Two Pointers — Interactive Module</title>
  <style>
    :root{
      --safe-margin: 24px;
      --gap: 16px;
      --bg: #0f1724;
      --card: #0b1220;
      --accent: #06b6d4;
      --muted: #98a2b3;
      --success: #16a34a;
      --danger: #ef4444;
      --glass: rgba(255,255,255,0.03);
      --radius: 10px;
      --font-sans: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    html,body{
      height: 100%;
      margin: 0;
      background: linear-gradient(180deg,#071025 0%, #081526 100%);
      font-family: var(--font-sans);
      color: #e6eef8;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Safe area margins */
    .app {
      box-sizing: border-box;
      padding: var(--safe-margin);
      min-height: 100%;
      display: flex;
      flex-direction: column;
      gap: var(--gap);
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--gap);
      flex-wrap: wrap;
    }

    .title {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    h1 {
      margin: 0;
      font-size: 20px;
      letter-spacing: -0.2px;
    }
    .subtitle {
      color: var(--muted);
      font-size: 13px;
      margin: 0;
    }

    /* Main layout */
    .main {
      display: grid;
      grid-template-columns: 360px 1fr;
      gap: var(--gap);
      align-items: start;
    }

    @media (max-width: 900px){
      .main {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: 0 6px 18px rgba(2,6,23,0.6);
      min-width: 0;
    }

    /* Controls column */
    .controls {
      display: flex;
      flex-direction: column;
      gap: var(--gap);
    }

    label { font-size: 13px; color: var(--muted); }
    input[type="text"], input[type="number"]{
      width: 100%;
      padding: 10px 12px;
      margin-top: 8px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.04);
      background: rgba(255,255,255,0.02);
      color: inherit;
      font-size: 14px;
      outline: none;
    }
    input[type="text"]::placeholder { color: rgba(255,255,255,0.25); }

    .row {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    .buttons {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    button {
      padding: 10px 12px;
      border-radius: 8px;
      border: none;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      color: #e6eef8;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      min-height: 40px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.35);
    }
    button.primary {
      background: linear-gradient(180deg, rgba(6,182,212,0.18), rgba(6,182,212,0.08));
      color: #063740;
      border: 1px solid rgba(6,182,212,0.14);
      min-width: 120px;
    }
    button.ghost {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.04);
      color: var(--muted);
    }
    button:disabled {
      opacity: 0.45;
      cursor: not-allowed;
    }

    .small {
      font-size: 13px;
      padding: 8px 10px;
      min-height: 36px;
    }

    .checkbox {
      display: inline-flex;
      gap: 8px;
      align-items: center;
      cursor: pointer;
      user-select: none;
    }

    .examples { display:flex; gap:8px; flex-wrap:wrap; }
    .chip {
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.02);
      cursor: pointer;
      font-size: 13px;
    }

    /* Visualization column */
    .viz {
      display: flex;
      flex-direction: column;
      gap: var(--gap);
    }

    .canvas {
      position: relative;
      min-height: 220px;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(180deg, rgba(255,255,255,0.012), rgba(255,255,255,0.01));
      border-radius: var(--radius);
      overflow: hidden;
    }

    .array-row {
      width: 100%;
      display: flex;
      gap: 12px;
      justify-content: center;
      align-items: flex-end;
      padding-bottom: 48px; /* space for pointer arrows */
      position: relative;
    }

    .cell {
      min-width: 56px;
      width: 56px;
      height: 56px;
      border-radius: 10px;
      background: var(--glass);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #dbeafe;
      font-size: 16px;
      position: relative;
      transition: transform 300ms ease, background 200ms ease, box-shadow 200ms;
      user-select: none;
    }

    .cell.highlight {
      background: linear-gradient(180deg, rgba(6,182,212,0.12), rgba(6,182,212,0.06));
      box-shadow: 0 10px 30px rgba(6,182,212,0.06);
      transform: translateY(-6px) scale(1.03);
    }

    .cell.match {
      background: linear-gradient(180deg, rgba(22,163,74,0.12), rgba(22,163,74,0.06));
      box-shadow: 0 10px 30px rgba(22,163,74,0.06);
      transform: translateY(-8px) scale(1.05);
    }

    /* Pointer handles */
    .pointer {
      position: absolute;
      top: 8px;
      transform: translateX(-50%);
      display:flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      cursor: grab;
      user-select: none;
      touch-action: none;
    }
    .pointer:active { cursor: grabbing; }

    .arrow {
      width: 0;
      height: 0;
      border-left: 10px solid transparent;
      border-right: 10px solid transparent;
      border-bottom: 14px solid var(--accent);
      filter: drop-shadow(0 6px 10px rgba(6,182,212,0.06));
      transition: transform 160ms ease;
    }

    .label {
      background: rgba(255,255,255,0.02);
      color: var(--muted);
      border-radius: 6px;
      padding: 6px 8px;
      font-size: 12px;
      border: 1px solid rgba(255,255,255,0.02);
    }

    .pointer.right .arrow {
      transform: rotate(180deg);
      border-bottom-color: var(--accent);
    }

    /* Info & log */
    .info {
      display: flex;
      gap: var(--gap);
      align-items: center;
      flex-wrap: wrap;
    }
    .status {
      padding: 10px 12px;
      border-radius: 8px;
      background: rgba(255,255,255,0.02);
      color: var(--muted);
      font-size: 13px;
      min-width: 120px;
    }
    .log {
      flex: 1;
      padding: 10px;
      border-radius: 8px;
      background: rgba(255,255,255,0.02);
      font-size: 13px;
      color: var(--muted);
      max-height: 88px;
      overflow:auto;
    }
    .log p { margin: 0 0 6px 0; font-size: 13px; }
    .legend { display:flex; gap:8px; align-items:center; color:var(--muted); font-size:13px; }

    /* Footer: algorithm explanation + layout description */
    .meta {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--gap);
    }
    @media (max-width:900px){ .meta { grid-template-columns: 1fr; } }

    .card-title { font-weight:700; margin-bottom:8px; }
    .card p { color:var(--muted); margin:0; line-height:1.45; font-size:13px; }

    /* accessibility focus */
    button:focus, .chip:focus {
      outline: 2px solid rgba(6,182,212,0.18);
      outline-offset: 2px;
      border-radius: 8px;
    }

    /* spacing helpers */
    .spacer { height: var(--gap); }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Two Pointers interactive module">
    <header>
      <div class="title">
        <h1>Two Pointers — Pair Sum on Sorted Array</h1>
        <p class="subtitle">Interactive visualization: find two numbers that add up to a target using the two-pointer technique.</p>
      </div>
      <div style="display:flex;gap:12px;align-items:center;">
        <div style="color:var(--muted);font-size:13px;">Safe margins: 24px · Min gap: 16px</div>
        <button class="ghost" id="helpToggle" aria-expanded="false">Show Design Plan</button>
      </div>
    </header>

    <div class="main">
      <!-- Controls column -->
      <section class="panel controls" aria-labelledby="controlsHeading">
        <h2 id="controlsHeading" style="margin:0 0 8px 0;font-size:15px;">Controls</h2>

        <div>
          <label for="arrayInput">Array (comma-separated)</label>
          <input id="arrayInput" type="text" placeholder="e.g. 1,2,3,4,6" value="1,2,3,4,6" />
        </div>

        <div>
          <label for="targetInput">Target Sum</label>
          <input id="targetInput" type="number" value="7" />
        </div>

        <div class="row">
          <label class="checkbox" title="Sort the input array before running">
            <input type="checkbox" id="sortToggle" checked />
            <span style="color:var(--muted);font-size:13px;">Sort input automatically</span>
          </label>
          <label style="margin-left:8px;color:var(--muted);font-size:13px;">Animation speed</label>
          <input id="speed" type="range" min="200" max="1600" value="800" style="width:100%;" aria-label="Animation speed" />
        </div>

        <div class="buttons">
          <button id="applyBtn" class="primary">Apply</button>
          <button id="resetBtn" class="small">Reset</button>
        </div>

        <div style="display:flex;gap:12px;align-items:center;margin-top:4px;">
          <button id="stepBack" class="small" title="Step backward">◀ Step</button>
          <button id="playPause" class="small" title="Play/Pause">Play ▶</button>
          <button id="stepForward" class="small" title="Step forward">Step ▶</button>
        </div>

        <div style="margin-top:8px;">
          <div style="font-size:13px;color:var(--muted);margin-bottom:8px;">Examples</div>
          <div class="examples" role="list">
            <button class="chip" data-arr="1,2,3,4,6" data-target="7">[1,2,3,4,6] t=7</button>
            <button class="chip" data-arr="2,3,4,7,11" data-target="9">[2,3,4,7,11] t=9</button>
            <button class="chip" data-arr="-3,-1,0,2,4,5" data-target="1">[-3,-1,0,2,4,5] t=1</button>
            <button class="chip" data-arr="1,2,3,4,5,6,7,8" data-target="15">1..8 t=15</button>
          </div>
        </div>

        <div class="spacer"></div>

        <div>
          <div class="card-title">Concept Title</div>
          <div class="card">
            <p>Two Pointers: Efficiently find a pair in a sorted array whose values sum to a target by moving one pointer from each end toward the center.</p>
          </div>
        </div>

        <div style="margin-top:10px;">
          <div class="card-title">Learning Objective</div>
          <div class="card">
            <p>After interacting with this module you will understand how two pointers (left & right) progressively narrow the search space on a sorted array, how comparisons guide pointer movement, and why this is O(n).</p>
          </div>
        </div>
      </section>

      <!-- Visualization column -->
      <section class="panel viz" aria-labelledby="vizHeading">
        <h2 id="vizHeading" style="margin:0 0 6px 0;font-size:15px;">Visualization</h2>

        <div class="canvas" id="canvas" aria-live="polite">
          <div class="array-row" id="arrayRow" role="list" aria-label="Array elements">
            <!-- Cells are inserted here -->
          </div>

          <!-- Left pointer -->
          <div class="pointer left" id="ptrLeft" data-side="left" role="slider" tabindex="0" aria-label="Left pointer" aria-valuemin="0" aria-valuemax="0" aria-valuenow="0" style="left:var(--leftPos,0px);">
            <div class="arrow" style="border-bottom-color: var(--accent);"></div>
            <div class="label">L</div>
          </div>

          <!-- Right pointer -->
          <div class="pointer right" id="ptrRight" data-side="right" role="slider" tabindex="0" aria-label="Right pointer" aria-valuemin="0" aria-valuemax="0" aria-valuenow="0" style="left:var(--rightPos,0px);">
            <div class="arrow" style="border-bottom-color: var(--accent); transform: rotate(180deg);"></div>
            <div class="label">R</div>
          </div>
        </div>

        <div class="info">
          <div class="status" id="statusText">Idle — press Apply</div>
          <div class="log" id="log" aria-live="polite"></div>
          <div class="legend">
            <div style="width:12px;height:12px;border-radius:3px;background:linear-gradient(180deg, rgba(6,182,212,0.12), rgba(6,182,212,0.06));"></div>
            <div style="color:var(--muted);font-size:13px;">Comparing</div>
            <div style="width:12px;height:12px;border-radius:3px;background:linear-gradient(180deg, rgba(22,163,74,0.12), rgba(22,163,74,0.06));margin-left:10px;"></div>
            <div style="color:var(--muted);font-size:13px;">Match</div>
          </div>
        </div>

        <div class="meta" style="margin-top:12px;">
          <div class="panel" style="background:transparent;padding:12px;">
            <div class="card-title">Interaction Design</div>
            <div class="card">
              <p>Users type or pick an example array and target. Press Apply to initialize (array sorted if enabled). Use Play/Pause to run automatically, Step to advance one comparison, or drag pointer handles to experiment manually. Visual highlights and animated pointer moves reveal decisions: sum &lt; target → move left; sum &gt; target → move right; sum = target → success.</p>
            </div>
          </div>

          <div class="panel" style="background:transparent;padding:12px;">
            <div class="card-title">Layout Description</div>
            <div class="card">
              <p>The left panel holds controls and learning objectives; the right panel centers the array visualization with pointer handles above. Safe margins are preserved (24px), controls have at least 16px spacing, and the layout is responsive: two-column on wide screens, stacked on narrow screens. Elements are keyboard-focusable for accessibility.</p>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Hidden detailed design plan popup -->
    <div id="helpPanel" style="display:none;position:fixed;inset:0;align-items:center;justify-content:center;">
      <div style="background:rgba(3,7,18,0.9);border-radius:12px;padding:20px;max-width:900px;margin:24px;border:1px solid rgba(6,182,212,0.06);">
        <div style="display:flex;justify-content:space-between;gap:12px;align-items:start;">
          <div>
            <h3 style="margin:0 0 8px 0;">Design Plan — Two Pointers Module</h3>
            <p style="color:var(--muted);margin-top:0;">This popup documents the required design plan and how the interactive page teaches the concept.</p>
          </div>
          <button id="closeHelp" class="small">Close</button>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:12px;">
          <div style="background:rgba(255,255,255,0.02);padding:12px;border-radius:8px;">
            <strong>Concept Title</strong>
            <p style="color:var(--muted);margin:8px 0 0 0;">Two Pointers — Pair Sum on Sorted Array</p>
            <strong style="margin-top:10px;display:block;">Learning Objective</strong>
            <p style="color:var(--muted);margin:8px 0 0 0;">Understand pointer initialization at array ends, how comparisons affect movement, and why this yields linear time.</p>
          </div>

          <div style="background:rgba(255,255,255,0.02);padding:12px;border-radius:8px;">
            <strong>Interaction Design</strong>
            <p style="color:var(--muted);margin:8px 0 0 0;">
              - Typing: Input array and target. <br>
              - Clicking: Apply, Play/Pause, Step controls to progress algorithm. <br>
              - Dragging: Move left/right pointer handles to explore manual states. <br>
              - Visual feedback: animated pointer transitions, cell highlighting for comparisons and matches, status log. <br>
              - Reinforcement: step-by-step guidance plus ability to experiment manually deepens intuition.
            </p>
          </div>

          <div style="background:rgba(255,255,255,0.02);padding:12px;border-radius:8px;">
            <strong>Layout Description</strong>
            <p style="color:var(--muted);margin:8px 0 0 0;">Top header, left control column (inputs, controls, examples, objectives), right visualization column (array row centered, pointers absolutely positioned above array, status/log beneath). Spacing respects 24px safe margin and 16px minimum between interactive items. Design is responsive and keyboard-friendly.</p>
          </div>

          <div style="background:rgba(255,255,255,0.02);padding:12px;border-radius:8px;">
            <strong>Accessibility & Responsiveness</strong>
            <p style="color:var(--muted);margin:8px 0 0 0;">Controls are keyboard-focusable, aria-live regions notify status changes, and pointer handles are accessible. The layout collapses to single column on small devices, preserving spacing and touch targets.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Two Pointers Interactive Module
    (function(){
      // Elements
      const arrayInput = document.getElementById('arrayInput');
      const targetInput = document.getElementById('targetInput');
      const sortToggle = document.getElementById('sortToggle');
      const applyBtn = document.getElementById('applyBtn');
      const resetBtn = document.getElementById('resetBtn');
      const stepForwardBtn = document.getElementById('stepForward');
      const stepBackBtn = document.getElementById('stepBack');
      const playPauseBtn = document.getElementById('playPause');
      const arrayRow = document.getElementById('arrayRow');
      const ptrLeft = document.getElementById('ptrLeft');
      const ptrRight = document.getElementById('ptrRight');
      const statusText = document.getElementById('statusText');
      const logEl = document.getElementById('log');
      const speedInput = document.getElementById('speed');
      const examples = document.querySelectorAll('.chip');
      const helpToggle = document.getElementById('helpToggle');
      const helpPanel = document.getElementById('helpPanel');
      const closeHelp = document.getElementById('closeHelp');

      // State
      let arr = [];
      let n = 0;
      let target = 0;
      let l = 0;
      let r = 0;
      let history = []; // stores states for stepping back
      let autoPlay = false;
      let autoTimer = null;
      let speed = Number(speedInput.value);
      let cells = [];
      let dragging = null; // 'left' or 'right' or null
      let boxCenters = []; // px centers of cells relative to arrayRow
      let isSorted = true;
      let found = false;

      // Utility helpers
      function log(msg){
        const p = document.createElement('p');
        p.textContent = msg;
        logEl.prepend(p);
      }
      function setStatus(msg, type){
        statusText.textContent = msg;
        // color hints could be added
      }

      function parseArrayInput(txt){
        // parse numbers, ignore empty entries
        return txt.split(',').map(s => s.trim()).filter(s => s!=='').map(Number).filter(n => !Number.isNaN(n));
      }

      function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

      // Render array cells
      function renderArray(){
        arrayRow.innerHTML = '';
        cells = [];
        boxCenters = [];
        for (let i=0;i<n;i++){
          const cell = document.createElement('div');
          cell.className = 'cell';
          cell.setAttribute('data-index', i);
          cell.setAttribute('role','listitem');
          cell.textContent = String(arr[i]);
          arrayRow.appendChild(cell);
          cells.push(cell);
        }
        // After DOM inserted, compute centers
        requestAnimationFrame(() => {
          boxCenters = cells.map(c => {
            const rect = c.getBoundingClientRect();
            const parentRect = arrayRow.getBoundingClientRect();
            return rect.left + rect.width/2 - parentRect.left;
          });
          // Initialize pointer positions visually
          updatePointerPosition('left', l, true);
          updatePointerPosition('right', r, true);
          ptrLeft.setAttribute('aria-valuemin', 0);
          ptrLeft.setAttribute('aria-valuemax', Math.max(0,n-1));
          ptrRight.setAttribute('aria-valuemin', 0);
          ptrRight.setAttribute('aria-valuemax', Math.max(0,n-1));
          ptrLeft.setAttribute('aria-valuenow', l);
          ptrRight.setAttribute('aria-valuenow', r);
        });
      }

      function updatePointerPosition(side, index, instant){
        if (!boxCenters.length) return;
        index = clamp(index, 0, Math.max(0,n-1));
        const leftPx = boxCenters[index] + arrayRow.getBoundingClientRect().left - arrayRow.getBoundingClientRect().left;
        // position relative to arrayRow left, but using percent left style
        const offset = boxCenters[index] + 'px';
        const el = side==='left' ? ptrLeft : ptrRight;
        if (instant){
          el.style.transition = 'none';
        } else {
          el.style.transition = 'left 300ms ease';
        }
        el.style.left = offset;
        el.setAttribute('aria-valuenow', index);
        // clear inline transition after frame
        if (instant){
          requestAnimationFrame(()=> el.style.transition = '');
        }
      }

      // Visual state update (highlight cells, etc.)
      function highlightCompare(i,j, action){
        // action: "compare" | "moveL" | "moveR" | "match"
        cells.forEach(c => c.classList.remove('highlight','match'));
        if (i>=0 && i<n) cells[i].classList.add(action==='match' ? 'match' : 'highlight');
        if (j>=0 && j<n) cells[j].classList.add(action==='match' ? 'match' : 'highlight');
      }

      // Initialize algorithm with current inputs
      function applySettings(){
        const parsed = parseArrayInput(arrayInput.value);
        if (parsed.length === 0){
          setStatus('Enter at least one number', 'warn');
          return;
        }
        isSorted = !!sortToggle.checked;
        arr = parsed.slice();
        if (isSorted){
          arr.sort((a,b)=>a-b);
        }
        n = arr.length;
        target = Number(targetInput.value);
        if (Number.isNaN(target)){
          setStatus('Invalid target', 'warn');
          return;
        }
        // init pointers
        l = 0;
        r = Math.max(0, n-1);
        history = [];
        found = false;
        setStatus('Initialized. Step or Play to run.');
        log(`Applied array (${isSorted? 'sorted':'as-is'}): [${arr.join(', ')}], target=${target}`);
        renderArray();
        refreshControls();
        clearHighlights();
      }

      function clearHighlights(){
        cells.forEach(c => c.classList.remove('highlight','match'));
      }

      // Perform one algorithm step forward
      function stepForward(){
        if (found || l >= r){
          setStatus('No more pairs to check');
          return false;
        }
        const sum = arr[l] + arr[r];
        history.push({l, r, sum});
        highlightCompare(l, r, 'compare');
        setStatus(`Comparing arr[${l}]=${arr[l]} + arr[${r}]=${arr[r]} -> ${sum}`);
        log(`Compare: ${arr[l]} + ${arr[r]} = ${sum}`);
        if (sum === target){
          highlightCompare(l, r, 'match');
          setStatus(`Found! arr[${l}] + arr[${r}] = ${target}`);
          log(`Match found at indices ${l} and ${r} -> values ${arr[l]}, ${arr[r]}`);
          found = true;
          refreshControls();
          return false;
        } else if (sum < target){
          // move left pointer right
          l = l + 1;
          animatePointers();
          setTimeout(()=> {
            highlightCompare(Math.max(0,l-1), r, 'moveL');
          }, 120);
        } else { // sum > target
          r = r - 1;
          animatePointers();
          setTimeout(()=> {
            highlightCompare(l, Math.min(n-1,r+1), 'moveR');
          }, 120);
        }
        refreshControls();
        return true;
      }

      // Step backward (revert last step)
      function stepBackward(){
        if (history.length === 0){
          setStatus('At initial state');
          return;
        }
        const prev = history.pop();
        // revert to prev.l, prev.r
        l = prev.l;
        r = prev.r;
        found = false;
        animatePointers();
        setStatus('Stepped back');
        log('Stepped back');
        clearHighlights();
        refreshControls();
      }

      // Animate pointer positions
      function animatePointers(){
        updatePointerPosition('left', l, false);
        updatePointerPosition('right', r, false);
        // update aria
        ptrLeft.setAttribute('aria-valuenow', l);
        ptrRight.setAttribute('aria-valuenow', r);
      }

      // Play/pause logic
      function togglePlay(){
        if (autoPlay){
          stopAuto();
        } else {
          startAuto();
        }
      }

      function startAuto(){
        if (found || l >= r){ setStatus('Nothing to play'); return; }
        autoPlay = true;
        playPauseBtn.textContent = 'Pause ⏸';
        speed = Number(speedInput.value);
        autoTimer = setInterval(()=> {
          const continuePlay = stepForward();
          if (!continuePlay || found || l >= r){
            stopAuto();
          }
        }, speed);
      }

      function stopAuto(){
        autoPlay = false;
        playPauseBtn.textContent = 'Play ▶';
        if (autoTimer) { clearInterval(autoTimer); autoTimer = null; }
      }

      function reset(){
        stopAuto();
        history = [];
        const parsed = parseArrayInput(arrayInput.value);
        if (parsed.length === 0) return;
        arr = parsed.slice();
        if (isSorted) arr.sort((a,b)=>a-b);
        n = arr.length;
        l = 0; r = Math.max(0,n-1);
        found = false;
        renderArray();
        setStatus('Reset to initial state');
        log('Reset');
        clearHighlights();
        refreshControls();
      }

      function refreshControls(){
        stepBackBtn.disabled = history.length === 0;
        stepForwardBtn.disabled = found || l >= r;
        playPauseBtn.disabled = found || l >= r;
      }

      // Dragging pointers
      function initPointerDrag(){
        let active = null;
        let startX = 0;
        let el = null;

        function getClosestIndex(clientX){
          if (!boxCenters.length) return 0;
          const parentRect = arrayRow.getBoundingClientRect();
          // find x relative to arrayRow
          const x = clientX - parentRect.left;
          // find closest center
          let bestIdx = 0;
          let bestDist = Infinity;
          for (let i=0;i<boxCenters.length;i++){
            const d = Math.abs(boxCenters[i] - x);
            if (d < bestDist){
              bestDist = d;
              bestIdx = i;
            }
          }
          return bestIdx;
        }

        function onPointerDown(e){
          if (autoPlay) return; // disable manual drag during autoplay
          const side = this.dataset.side;
          active = side;
          el = this;
          startX = (e.touches ? e.touches[0].clientX : e.clientX);
          dragging = side;
          el.classList.add('dragging');
          document.addEventListener('pointermove', onPointerMove);
          document.addEventListener('pointerup', onPointerUp);
          document.addEventListener('touchmove', onPointerMove, {passive:false});
          document.addEventListener('touchend', onPointerUp);
        }

        function onPointerMove(e){
          if (!active) return;
          e.preventDefault();
          const clientX = (e.touches ? e.touches[0].clientX : e.clientX);
          const idx = getClosestIndex(clientX);
          if (active === 'left'){
            // prevent crossing
            const safeIdx = Math.min(idx, r-1);
            if (safeIdx !== l){
              l = safeIdx;
              updatePointerPosition('left', l, true);
              setStatus(`Moved left pointer to index ${l}`);
              highlightCompare(l, r, 'compare');
            }
          } else {
            const safeIdx = Math.max(idx, l+1);
            if (safeIdx !== r){
              r = safeIdx;
              updatePointerPosition('right', r, true);
              setStatus(`Moved right pointer to index ${r}`);
              highlightCompare(l, r, 'compare');
            }
          }
        }

        function onPointerUp(e){
          if (!active) return;
          dragging = null;
          active = null;
          el.classList.remove('dragging');
          document.removeEventListener('pointermove', onPointerMove);
          document.removeEventListener('pointerup', onPointerUp);
          document.removeEventListener('touchmove', onPointerMove);
          document.removeEventListener('touchend', onPointerUp);
          // When user releases, evaluate current pair but do not push to history automatically
          const sum = arr[l] + arr[r];
          setStatus(`Manual: arr[${l}] + arr[${r}] = ${sum}`);
          log(`Manual move: indices ${l},${r} -> sum ${sum}`);
          highlightCompare(l, r, sum===target ? 'match':'compare');
          ptrLeft.setAttribute('aria-valuenow', l);
          ptrRight.setAttribute('aria-valuenow', r);
        }

        ptrLeft.addEventListener('pointerdown', onPointerDown);
        ptrRight.addEventListener('pointerdown', onPointerDown);
        // keyboard support for pointer handles
        function onKeyAdjust(e){
          const side = this.dataset.side;
          if (e.key === 'ArrowLeft' || e.key === 'ArrowRight'){
            const dir = e.key === 'ArrowLeft' ? -1 : 1;
            if (side === 'left'){
              l = clamp(l + dir, 0, Math.max(0, r-1));
              updatePointerPosition('left', l, false);
            } else {
              r = clamp(r + dir, Math.min(n-1, l+1), n-1);
              updatePointerPosition('right', r, false);
            }
            highlightCompare(l, r, 'compare');
            ptrLeft.setAttribute('aria-valuenow', l);
            ptrRight.setAttribute('aria-valuenow', r);
            e.preventDefault();
          }
          if (e.key === 'Enter'){
            // evaluate manual pair
            const sum = arr[l] + arr[r];
            setStatus(`Manual: arr[${l}] + arr[${r}] = ${sum}`);
            highlightCompare(l, r, sum===target ? 'match':'compare');
            log(`Manual key move: indices ${l},${r} -> sum ${sum}`);
          }
        }
        ptrLeft.addEventListener('keydown', onKeyAdjust);
        ptrRight.addEventListener('keydown', onKeyAdjust);
      }

      // Hook up controls
      applyBtn.addEventListener('click', e => {
        applySettings();
      });

      resetBtn.addEventListener('click', e => {
        reset();
      });

      stepForwardBtn.addEventListener('click', e => {
        stopAuto();
        stepForward();
      });

      stepBackBtn.addEventListener('click', e => {
        stopAuto();
        stepBackward();
      });

      playPauseBtn.addEventListener('click', e => {
        togglePlay();
      });

      speedInput.addEventListener('input', e => {
        speed = Number(speedInput.value);
        if (autoPlay){
          stopAuto();
          startAuto();
        }
      });

      examples.forEach(btn => {
        btn.addEventListener('click', e => {
          arrayInput.value = btn.dataset.arr;
          targetInput.value = btn.dataset.target;
          applySettings();
        });
      });

      // Help toggle
      helpToggle.addEventListener('click', () => {
        const expanded = helpToggle.getAttribute('aria-expanded') === 'true';
        helpToggle.setAttribute('aria-expanded', String(!expanded));
        helpPanel.style.display = expanded ? 'none' : 'flex';
      });
      closeHelp.addEventListener('click', () => {
        helpPanel.style.display = 'none';
        helpToggle.setAttribute('aria-expanded', 'false');
      });

      // Keyboard shortcuts
      document.addEventListener('keydown', e => {
        if (e.key === ' ' && document.activeElement.tagName.toLowerCase() !== 'input'){
          // space toggles play
          e.preventDefault();
          togglePlay();
        } else if (e.key === 'ArrowRight' && (e.ctrlKey || e.metaKey)){
          // Ctrl+Right step forward
          stepForward();
        } else if (e.key === 'ArrowLeft' && (e.ctrlKey || e.metaKey)){
          stepBackward();
        }
      });

      // Initial setup
      function init(){
        applySettings();
        initPointerDrag();
        refreshControls();
      }

      init();

      // Expose to window for debugging (optional)
      window._twoPointers = {
        get state(){ return {arr,l,r,target,history,found}; }
      };
    })();
  </script>
</body>
</html>