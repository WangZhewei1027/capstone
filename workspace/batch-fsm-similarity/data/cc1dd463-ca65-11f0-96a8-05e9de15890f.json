{
  "id": "cc1dd463-ca65-11f0-96a8-05e9de15890f",
  "timestamp": "2025-11-26T01:20:45.486Z",
  "model": "gpt-5-mini",
  "status": "success",
  "question": "Heap Sort",
  "answer": {
    "role": "assistant",
    "content": "<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\" />\n  <title>Heap Sort Visualization</title>\n  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n  <style>\n    :root{\n      --bg:#0f1724;\n      --panel:#0b1220;\n      --accent:#38bdf8;\n      --muted:#94a3b8;\n      --bar:#60a5fa;\n      --compare:#f59e0b;\n      --swap:#ef4444;\n      --sorted:#10b981;\n      --heap:#7c3aed;\n      --text:#e6eef8;\n    }\n    html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Arial;background:var(--bg);color:var(--text)}\n    .wrap{display:flex;flex-direction:column;gap:12px;padding:16px;max-width:1100px;margin:8px auto}\n    header{display:flex;align-items:center;gap:12px}\n    h1{font-size:18px;margin:0}\n    .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center}\n    button{background:linear-gradient(180deg,#1f2937,#111827);color:var(--text);border:1px solid rgba(255,255,255,0.04);padding:8px 12px;border-radius:8px;cursor:pointer}\n    button:active{transform:translateY(1px)}\n    input[type=range]{width:160px}\n    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:12px}\n    .vis{height:320px;background:linear-gradient(180deg,#071023,#071018);border-radius:10px;padding:12px;display:flex;align-items:end;gap:6px;overflow:hidden}\n    .bar{flex:1 1 auto;margin:0 2px;background:var(--bar);border-radius:4px;display:flex;align-items:flex-end;justify-content:center;color:#041025;font-weight:600;transition:height 250ms linear, background-color 150ms}\n    .bar.small{font-size:10px;padding-bottom:4px}\n    .info{display:flex;gap:12px;flex-wrap:wrap;align-items:center}\n    .muted{color:var(--muted);font-size:13px}\n    .pcode{font-family:ui-monospace,SFMono-Regular,Menlo,monospace;background:#021226;padding:10px;border-radius:8px;color:var(--muted);font-size:13px;line-height:1.5}\n    .pcode .line{display:block;padding:2px 6px;border-radius:6px}\n    .pcode .active{background:rgba(56,189,248,0.12);color:var(--accent)}\n    .stats{display:flex;gap:12px;align-items:center}\n    .legend{display:flex;gap:8px;align-items:center;flex-wrap:wrap}\n    .legend .item{display:flex;gap:6px;align-items:center;color:var(--muted);font-size:13px}\n    .swatch{width:14px;height:14px;border-radius:3px}\n    footer{color:var(--muted);font-size:13px;margin-top:6px}\n    @media (max-width:760px){\n      .vis{height:240px}\n    }\n  </style>\n</head>\n<body>\n  <div class=\"wrap\">\n    <header>\n      <h1>Heap Sort — Interactive Visualization</h1>\n      <div class=\"muted\">Build a max-heap, then repeatedly swap the root with the last heap element and reduce heap size.</div>\n    </header>\n\n    <div class=\"controls panel\">\n      <div style=\"display:flex;gap:10px;align-items:center;flex-wrap:wrap\">\n        <label class=\"muted\">Size\n          <input id=\"size\" type=\"range\" min=\"6\" max=\"80\" value=\"30\" />\n        </label>\n        <label class=\"muted\">Speed\n          <input id=\"speed\" type=\"range\" min=\"10\" max=\"1000\" value=\"220\" />\n        </label>\n        <button id=\"random\">Randomize</button>\n        <button id=\"start\">Start</button>\n        <button id=\"step\">Step</button>\n        <button id=\"reset\">Reset</button>\n      </div>\n\n      <div style=\"margin-left:auto;display:flex;gap:12px;align-items:center\">\n        <div class=\"stats muted\">Ops: <span id=\"ops\">0</span></div>\n        <div class=\"legend\">\n          <div class=\"item\"><div class=\"swatch\" style=\"background:var(--bar)\"></div>Unsorted</div>\n          <div class=\"item\"><div class=\"swatch\" style=\"background:var(--heap)\"></div>Heap region</div>\n          <div class=\"item\"><div class=\"swatch\" style=\"background:var(--compare)\"></div>Comparing</div>\n          <div class=\"item\"><div class=\"swatch\" style=\"background:var(--swap)\"></div>Swapping</div>\n          <div class=\"item\"><div class=\"swatch\" style=\"background:var(--sorted)\"></div>Sorted</div>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"panel\">\n      <div id=\"vis\" class=\"vis\" aria-hidden=\"true\"></div>\n      <div style=\"display:flex;gap:12px;margin-top:10px;align-items:center;flex-wrap:wrap\">\n        <div class=\"pcode\" id=\"pcode\" style=\"min-width:320px;max-width:760px\">\n          <span class=\"line\" data-id=\"1\">function heapSort(A):</span>\n          <span class=\"line\" data-id=\"2\">  n = A.length</span>\n          <span class=\"line\" data-id=\"3\">  for i = floor(n/2)-1 downto 0: // build max-heap</span>\n          <span class=\"line\" data-id=\"4\">    siftDown(A, n, i)</span>\n          <span class=\"line\" data-id=\"5\">  for end = n-1 downto 1: // extract max</span>\n          <span class=\"line\" data-id=\"6\">    swap(A[0], A[end])</span>\n          <span class=\"line\" data-id=\"7\">    siftDown(A, end, 0)</span>\n          <span class=\"line\" data-id=\"8\"></span>\n          <span class=\"line\" data-id=\"9\">function siftDown(A, n, i):</span>\n          <span class=\"line\" data-id=\"10\">  while true:</span>\n          <span class=\"line\" data-id=\"11\">    l = 2*i + 1; r = 2*i + 2; largest = i</span>\n          <span class=\"line\" data-id=\"12\">    if l < n and A[l] > A[largest]: largest = l</span>\n          <span class=\"line\" data-id=\"13\">    if r < n and A[r] > A[largest]: largest = r</span>\n          <span class=\"line\" data-id=\"14\">    if largest != i: swap(A[i], A[largest]); i = largest</span>\n          <span class=\"line\" data-id=\"15\">    else: break</span>\n        </div>\n\n        <div style=\"min-width:200px\">\n          <div class=\"muted\" style=\"margin-bottom:6px\">Status</div>\n          <div id=\"status\" class=\"panel muted\" style=\"padding:10px;min-height:66px\">Idle — generate an array and press Start.</div>\n        </div>\n      </div>\n    </div>\n\n    <footer class=\"muted\">Click \"Step\" to advance one algorithm action. Speed slider adjusts ms per step (lower = faster).</footer>\n  </div>\n\n  <script>\n    // Heap Sort Visualizer\n    const vis = document.getElementById('vis');\n    const sizeInput = document.getElementById('size');\n    const speedInput = document.getElementById('speed');\n    const randomBtn = document.getElementById('random');\n    const startBtn = document.getElementById('start');\n    const stepBtn = document.getElementById('step');\n    const resetBtn = document.getElementById('reset');\n    const opsSpan = document.getElementById('ops');\n    const statusBox = document.getElementById('status');\n    const pcode = document.getElementById('pcode');\n\n    let array = [];\n    let bars = [];\n    let gen = null;\n    let running = false;\n    let timer = null;\n    let ops = 0;\n    let lastAction = null;\n    let heapSize = 0;\n    let sortedIndices = new Set();\n\n    function randInt(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }\n\n    function createArray(n){\n      array = [];\n      for(let i=0;i<n;i++) array.push(randInt(5,100));\n      sortedIndices = new Set();\n      ops = 0; opsSpan.textContent = ops;\n      gen = null;\n      lastAction = null;\n      heapSize = array.length;\n      render();\n      setStatus('Array generated. Ready.');\n    }\n\n    function render(){\n      vis.innerHTML = '';\n      bars = [];\n      const n = array.length;\n      // adapt number of bars' width\n      for(let i=0;i<n;i++){\n        const b = document.createElement('div');\n        b.className = 'bar small';\n        b.style.height = (array[i])+'%';\n        b.style.flex = `0 0 ${Math.max(4, Math.floor(1000/n))}px`;\n        b.textContent = ''; // hide numeric for clarity; could show small\n        vis.appendChild(b);\n        bars.push(b);\n      }\n      updateColors();\n    }\n\n    function updateColors(action){\n      const n = array.length;\n      for(let i=0;i<n;i++){\n        let col = 'var(--bar)';\n        if(sortedIndices.has(i)) col = 'var(--sorted)';\n        else if(typeof heapSize === 'number' && i < heapSize) col = 'var(--heap)';\n        bars[i].style.backgroundColor = col;\n      }\n      if(action){\n        if(action.type === 'compare'){\n          if(bars[action.i]) bars[action.i].style.backgroundColor = 'var(--compare)';\n          if(bars[action.j]) bars[action.j].style.backgroundColor = 'var(--compare)';\n        } else if(action.type === 'swap'){\n          if(bars[action.i]) bars[action.i].style.backgroundColor = 'var(--swap)';\n          if(bars[action.j]) bars[action.j].style.backgroundColor = 'var(--swap)';\n        } else if(action.type === 'build'){\n          if(bars[action.i]) bars[action.i].style.backgroundColor = 'var(--heap)';\n        } else if(action.type === 'sorted'){\n          if(bars[action.idx]) bars[action.idx].style.backgroundColor = 'var(--sorted)';\n        }\n      }\n      // update heights\n      for(let i=0;i<n;i++){\n        bars[i].style.height = (array[i])+'%';\n        bars[i].textContent = '';\n      }\n    }\n\n    function setStatus(text){\n      statusBox.textContent = text;\n    }\n\n    // Generator-based heap sort to allow stepping\n    function* siftDown(A, n, i){\n      // yields actions: {type:'compare',i,j,heapSize}, {type:'swap',i,j,heapSize}\n      while(true){\n        let l = 2*i + 1;\n        let r = 2*i + 2;\n        let largest = i;\n        if(l < n){\n          yield {type:'compare', i:l, j:largest, heapSize:n};\n          if(A[l] > A[largest]) largest = l;\n        }\n        if(r < n){\n          yield {type:'compare', i:r, j:largest, heapSize:n};\n          if(A[r] > A[largest]) largest = r;\n        }\n        if(largest !== i){\n          // perform swap\n          let tmp = A[i]; A[i] = A[largest]; A[largest] = tmp;\n          yield {type:'swap', i:i, j:largest, heapSize:n};\n          i = largest;\n        } else {\n          break;\n        }\n      }\n      return;\n    }\n\n    function* heapSortGen(A){\n      let n = A.length;\n      // build max-heap\n      for(let i = Math.floor(n/2) - 1; i >= 0; i--){\n        yield {type:'build', i:i, heapSize:n, line:3};\n        yield* siftDown(A, n, i);\n      }\n      // extract\n      for(let end = n - 1; end > 0; end--){\n        // swap root with end\n        let tmp = A[0]; A[0] = A[end]; A[end] = tmp;\n        yield {type:'swap', i:0, j:end, heapSize:end, line:6};\n        // mark end as sorted\n        yield {type:'sorted', idx:end, heapSize:end, line:6};\n        yield* siftDown(A, end, 0);\n      }\n      yield {type:'sorted', idx:0, heapSize:0, line:7};\n      yield {type:'done'};\n    }\n\n    function applyAction(action){\n      lastAction = action;\n      heapSize = (typeof action.heapSize === 'number') ? action.heapSize : heapSize;\n      if(action.type === 'compare'){\n        ops++; opsSpan.textContent = ops;\n        setStatus(`Comparing indices ${action.i} and ${action.j} (heap size ${action.heapSize}).`);\n      } else if(action.type === 'swap'){\n        ops++; opsSpan.textContent = ops;\n        setStatus(`Swapped index ${action.i} and ${action.j}.`);\n      } else if(action.type === 'build'){\n        setStatus(`Building heap: siftDown from index ${action.i}.`);\n      } else if(action.type === 'sorted'){\n        sortedIndices.add(action.idx);\n        setStatus(`Index ${action.idx} is now in final position (sorted).`);\n      } else if(action.type === 'done'){\n        setStatus('Sorting complete!');\n        running = false;\n        startBtn.textContent = 'Start';\n        clearInterval(timer);\n      }\n      highlightCode(action);\n      updateColors(action);\n    }\n\n    function highlightCode(action){\n      // reset\n      pcode.querySelectorAll('.line').forEach(el => el.classList.remove('active'));\n      // map actions to line numbers\n      if(!action) return;\n      let line = null;\n      if(action.type === 'build') line = 3;\n      else if(action.type === 'compare') line = 11; // comparing children to largest\n      else if(action.type === 'swap'){\n        // if swapping root with end -> line 6; else inside siftDown -> line 14\n        if(action.i === 0 && action.j === array.length-1 - (sortedIndices.size)) line = 6;\n        else line = 14;\n      } else if(action.type === 'sorted'){\n        line = 6;\n      } else if(action.type === 'done'){\n        line = 7;\n      }\n      if(line){\n        const el = pcode.querySelector(`.line[data-id=\"${line}\"]`);\n        if(el) el.classList.add('active');\n      }\n    }\n\n    function stepOnce(){\n      if(!gen){\n        // create fresh generator on current array copy\n        gen = heapSortGen(array);\n      }\n      const it = gen.next();\n      if(it.done) {\n        applyAction({type:'done'});\n        return;\n      }\n      const action = it.value;\n      applyAction(action);\n      render(); // re-render after applying the action (heights/colors)\n    }\n\n    function startLoop(){\n      if(running) return;\n      running = true;\n      startBtn.textContent = 'Pause';\n      if(!gen) gen = heapSortGen(array);\n      const speed = Math.max(10, 1010 - Number(speedInput.value)); // invert for intuitive slider\n      timer = setInterval(()=>{\n        const it = gen.next();\n        if(it.done){\n          applyAction({type:'done'});\n          clearInterval(timer);\n          return;\n        }\n        applyAction(it.value);\n        render();\n      }, speed);\n    }\n\n    function pauseLoop(){\n      running = false;\n      startBtn.textContent = 'Start';\n      clearInterval(timer);\n    }\n\n    // Event listeners\n    sizeInput.addEventListener('input', ()=> {\n      createArray(Number(sizeInput.value));\n    });\n\n    randomBtn.addEventListener('click', ()=> {\n      createArray(Number(sizeInput.value));\n    });\n\n    startBtn.addEventListener('click', ()=> {\n      if(running){\n        pauseLoop();\n      } else {\n        startLoop();\n      }\n    });\n\n    stepBtn.addEventListener('click', ()=> {\n      if(running) return;\n      stepOnce();\n    });\n\n    resetBtn.addEventListener('click', ()=> {\n      pauseLoop();\n      createArray(Number(sizeInput.value));\n    });\n\n    // initial\n    createArray(Number(sizeInput.value));\n\n    // Resize handling to make bars fill nicely on small screens\n    window.addEventListener('resize', ()=> {\n      render();\n    });\n\n    // Small accessibility: allow space to step/start/pause\n    window.addEventListener('keydown', (e)=>{\n      if(e.code === 'Space'){\n        e.preventDefault();\n        if(running) pauseLoop(); else startLoop();\n      } else if(e.key === 'ArrowRight'){\n        e.preventDefault();\n        if(!running) stepOnce();\n      }\n    });\n\n    // Provide click to toggle showing values\n    vis.addEventListener('click', ()=>{\n      // show numbers briefly\n      bars.forEach((b,i)=> b.textContent = array[i]);\n      setTimeout(()=> bars.forEach(b=> b.textContent=''), 800);\n    });\n\n  </script>\n</body>\n</html>"
  },
  "messages": [
    {
      "role": "system",
      "content": "Generate a single HTML file with JavaScript demonstrating the user-given concept. Only respond in a single HTML file."
    },
    {
      "role": "user",
      "content": "Heap Sort"
    }
  ],
  "topic": "Heap Sort",
  "hasFSM": true,
  "hasTest": true,
  "evaluation": {
    "score": null,
    "notes": ""
  }
}