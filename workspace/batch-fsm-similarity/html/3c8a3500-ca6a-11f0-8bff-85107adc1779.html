<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Knapsack Problem Demo</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    max-width: 900px;
  }
  h1 {
    text-align: center;
  }
  table {
    border-collapse: collapse;
    width: 100%;
    margin-top: 10px;
  }
  table, th, td {
    border: 1px solid #555;
  }
  th, td {
    padding: 8px;
    text-align: center;
  }
  input[type=number] {
    width: 60px;
  }
  input[type=button], button {
    margin-top: 15px;
    padding: 10px 15px;
    font-weight: bold;
    cursor: pointer;
  }
  #result {
    background: #f9f9f9;
    border: 1px solid #bbb;
    padding: 12px;
    margin-top: 20px;
  }
</style>
</head>
<body>
<h1>0/1 Knapsack Problem Demo</h1>
<p>
  You have a knapsack with a max weight capacity.<br />
  Add items with weight and value, then compute the best selection to maximize total value.
</p>

<div>
  <label for="capacity">Knapsack Capacity (weight): </label>
  <input type="number" id="capacity" min="1" value="50" />
</div>

<h3>Items</h3>
<table id="items-table">
  <thead>
    <tr><th>#</th><th>Weight</th><th>Value</th><th>Actions</th></tr>
  </thead>
  <tbody>
  </tbody>
</table>

<button id="add-item">Add Item</button>

<br />
<button id="solve-knapsack">Solve Knapsack</button>

<div id="result"></div>

<script>
(function(){
  const itemsTableBody = document.querySelector("#items-table tbody");
  const addItemButton = document.getElementById("add-item");
  const solveButton = document.getElementById("solve-knapsack");
  const capacityInput = document.getElementById("capacity");
  const resultDiv = document.getElementById("result");
  
  let itemCount = 0;

  function createItemRow(weight = "", value = "") {
    itemCount++;
    const tr = document.createElement("tr");
    tr.dataset.index = itemCount;
    
    const numberTd = document.createElement("td");
    numberTd.textContent = itemCount;
    
    const weightTd = document.createElement("td");
    const weightInput = document.createElement("input");
    weightInput.type = "number";
    weightInput.min = "1";
    weightInput.value = weight;
    weightInput.placeholder = "weight";
    weightInput.required = true;
    weightTd.appendChild(weightInput);
    
    const valueTd = document.createElement("td");
    const valueInput = document.createElement("input");
    valueInput.type = "number";
    valueInput.min = "0";
    valueInput.value = value;
    valueInput.placeholder = "value";
    valueInput.required = true;
    valueTd.appendChild(valueInput);
    
    const actionTd = document.createElement("td");
    const delButton = document.createElement("button");
    delButton.textContent = "Delete";
    delButton.type = "button";
    delButton.style.color = "red";
    delButton.onclick = () => {
      itemsTableBody.removeChild(tr);
      refreshRowNumbers();
    };
    actionTd.appendChild(delButton);
    
    tr.appendChild(numberTd);
    tr.appendChild(weightTd);
    tr.appendChild(valueTd);
    tr.appendChild(actionTd);
    
    return tr;
  }
  function refreshRowNumbers() {
    let i = 1;
    for (const row of itemsTableBody.children) {
      row.dataset.index = i;
      row.children[0].textContent = i;
      i++;
    }
    itemCount = itemsTableBody.children.length;
  }
  
  function getItems() {
    const items = [];
    for (const row of itemsTableBody.children) {
      const weightInput = row.children[1].firstElementChild;
      const valueInput = row.children[2].firstElementChild;
      
      const w = parseInt(weightInput.value);
      const v = parseInt(valueInput.value);
      if (isNaN(w) || isNaN(v) || w <= 0 || v < 0) {
        throw new Error(`Invalid values in item #${row.dataset.index}`);
      }
      items.push({weight: w, value: v});
    }
    if (items.length === 0) {
      throw new Error("Please add at least one item.");
    }
    return items;
  }
  
  // The 0/1 Knapsack dynamic programming solver
  // Returns the maximum value and the list of selected items indices
  function knapsack(items, capacity) {
    const n = items.length;
    // dp[i][w] = max value using first i items with max capacity w
    const dp = Array.from({length: n+1}, () => Array(capacity+1).fill(0));
    
    for(let i = 1; i <= n; i++) {
      const {weight, value} = items[i-1];
      for(let w = 0; w <= capacity; w++) {
        if(weight <= w) {
          dp[i][w] = Math.max(dp[i-1][w], dp[i-1][w - weight] + value);
        } else {
          dp[i][w] = dp[i-1][w];
        }
      }
    }
    
    // Backtrack to find selected items
    let w = capacity;
    const selectedIndices = [];
    for (let i = n; i > 0; i--) {
      if (dp[i][w] !== dp[i-1][w]) {
        selectedIndices.push(i-1);
        w -= items[i-1].weight;
      }
    }
    selectedIndices.reverse();
    
    return {
      maxValue: dp[n][capacity],
      selectedIndices
    };
  }
  
  function displayResult(items, capacity, solution) {
    if(solution.selectedIndices.length === 0){
      resultDiv.innerHTML = `<strong>No items can be included given the capacity ${capacity}.</strong>`;
      return;
    }
    
    let html = `<h3>Knapsack Solution</h3>`;
    html += `<p>Capacity: <strong>${capacity}</strong></p>`;
    html += `<p>Maximum Value: <strong>${solution.maxValue}</strong></p>`;
    html += `<p>Selected Items (index, weight, value):</p>`;
    html += `<table><thead><tr><th>#</th><th>Weight</th><th>Value</th></tr></thead><tbody>`;
    for (let idx of solution.selectedIndices) {
      const it = items[idx];
      html += `<tr><td>${idx+1}</td><td>${it.weight}</td><td>${it.value}</td></tr>`;
    }
    html += `</tbody></table>`;
    
    // Summary
    const totalWeight = solution.selectedIndices.reduce((acc, i) => acc + items[i].weight, 0);
    html += `<p>Total Weight Used: <strong>${totalWeight}</strong></p>`;
    resultDiv.innerHTML = html;
  }
  
  addItemButton.onclick = () => {
    const newRow = createItemRow();
    itemsTableBody.appendChild(newRow);
  };

  solveButton.onclick = () => {
    try {
      const capacity = parseInt(capacityInput.value);
      if (isNaN(capacity) || capacity <= 0) {
        alert("Please enter a valid positive knapsack capacity.");
        capacityInput.focus();
        return;
      }
      const items = getItems();
      const result = knapsack(items, capacity);
      displayResult(items, capacity, result);
    } catch(e) {
      alert(e.message);
      resultDiv.innerHTML = "";
    }
  };

  // Initialize with some example items:
  const exampleItems = [
    { weight: 10, value: 60 },
    { weight: 20, value: 100 },
    { weight: 30, value: 120 },
  ];
  exampleItems.forEach(item => {
    itemsTableBody.appendChild(createItemRow(item.weight, item.value));
  });
})();
</script>
</body>
</html>