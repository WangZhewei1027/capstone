<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Quick Sort Visualizer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root{
      --bg:#0f1724;
      --panel:#0b1220;
      --accent:#60a5fa;
      --muted:#94a3b8;
      --good:#38bdf8;
      --danger:#fb7185;
      --pivot:#7c3aed;
      --cmp:#fbbf24;
      --bar-bg:#263244;
      --sorted:#10b981;
      --text:#e6eef8;
    }
    *{box-sizing:border-box;font-family:Inter, ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#071129 80%);color:var(--text);-webkit-font-smoothing:antialiased;}
    .wrap{max-width:1100px;margin:20px auto;padding:18px;border-radius:10px;background:linear-gradient(180deg,var(--panel),#071125);box-shadow:0 6px 30px rgba(2,6,23,0.6);}
    h1{margin:0 0 8px;font-size:20px;color:var(--accent);}
    .controls{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin-bottom:12px;}
    .control{background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;display:flex;gap:8px;align-items:center;}
    label{font-size:13px;color:var(--muted);min-width:82px;}
    input[type=range]{width:180px;}
    select,input[type=number]{padding:6px 8px;border-radius:6px;background:#071426;border:1px solid rgba(255,255,255,0.03);color:var(--text);}
    button{background:var(--accent);border:none;padding:8px 10px;border-radius:8px;color:#04263b;font-weight:600;cursor:pointer;}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text);}
    .btn-red{background:var(--danger);color:#24070a;}
    .btn-small{padding:6px 8px;font-size:13px;}
    .layout{display:flex;gap:14px;}
    .left{flex:1;min-width:320px;}
    .right{width:360px;min-width:260px;}
    .visualizer{height:360px;background:linear-gradient(180deg,#071426,#02101b);border-radius:8px;padding:10px;display:flex;align-items:end;gap:6px;overflow:hidden;border:1px solid rgba(255,255,255,0.03);}
    .bar{flex:1 1 auto;display:flex;align-items:end;justify-content:center;border-radius:6px 6px 3px 3px;background:var(--bar-bg);position:relative;transition:height 150ms linear,background 120ms;}
    .bar-value{position:absolute;top:6px;font-size:11px;color:var(--muted);display:none;}
    .bar.show-value .bar-value{display:block;}
    .stats{display:flex;gap:12px;align-items:center;margin-top:10px;}
    .stat{background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;min-width:110px;text-align:center;}
    .small{font-size:12px;color:var(--muted);}
    .big{font-size:18px;font-weight:700;color:var(--text);}
    .legend{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;}
    .legend .key{display:flex;align-items:center;gap:8px;background:rgba(255,255,255,0.02);padding:6px 8px;border-radius:8px;}
    .swatches{width:14px;height:14px;border-radius:3px;}
    /* colors */
    .bar.pivot{background:linear-gradient(180deg,var(--pivot),#5b21b6);}
    .bar.compare{background:linear-gradient(180deg,var(--cmp),#f59e0b);}
    .bar.swap{background:linear-gradient(180deg,var(--danger),#ef4444);}
    .bar.sorted{background:linear-gradient(180deg,var(--sorted),#059669);}
    .bar.active-range{box-shadow:0 0 0 3px rgba(96,165,250,0.06) inset;}
    .panel{background:linear-gradient(180deg,#021428,#01121a);padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);}
    pre{background:transparent;color:var(--muted);font-size:13px;overflow:auto;margin:0;padding:8px;border-radius:6px;border:1px dashed rgba(255,255,255,0.02);}
    .stack-list{display:flex;flex-direction:column;gap:6px;margin-top:8px;}
    .stack-item{background:rgba(255,255,255,0.02);padding:6px;border-radius:6px;color:var(--muted);font-size:13px;}
    footer{margin-top:12px;color:var(--muted);font-size:12px;}
    @media (max-width:900px){
      .layout{flex-direction:column;}
      .right{width:auto;}
    }
  </style>
</head>
<body>
  <div class="wrap" role="main">
    <h1>Quick Sort Visualizer</h1>
    <div class="controls">
      <div class="control">
        <label for="size">Array size</label>
        <input id="size" type="range" min="6" max="80" value="30">
        <span id="sizeVal" style="min-width:30px;color:var(--muted);font-size:13px;">30</span>
      </div>

      <div class="control">
        <label for="pivot">Pivot</label>
        <select id="pivot">
          <option value="last">Last element</option>
          <option value="first">First element</option>
          <option value="middle">Middle element</option>
          <option value="random">Random</option>
          <option value="median3" selected>Median-of-three</option>
        </select>
      </div>

      <div class="control">
        <label for="speed">Speed</label>
        <input id="speed" type="range" min="10" max="1000" value="200">
        <span id="speedVal" style="min-width:40px;color:var(--muted);font-size:13px;">200 ms</span>
      </div>

      <div class="control">
        <button id="generate" class="btn-small ghost">Generate</button>
        <button id="shuffle" class="btn-small ghost">Shuffle</button>
      </div>

      <div style="margin-left:auto;display:flex;gap:8px;">
        <button id="start" class="btn-small">Start</button>
        <button id="pause" class="btn-small ghost">Pause</button>
        <button id="step" class="btn-small ghost">Step</button>
        <button id="reset" class="btn-small btn-red btn-small">Reset</button>
      </div>
    </div>

    <div class="layout">
      <div class="left">
        <div id="visual" class="visualizer panel" aria-live="polite"></div>
        <div class="stats">
          <div class="stat"><div class="small">Comparisons</div><div id="cmpCount" class="big">0</div></div>
          <div class="stat"><div class="small">Swaps</div><div id="swapCount" class="big">0</div></div>
          <div class="stat"><div class="small">Steps</div><div id="stepCount" class="big">0</div></div>
        </div>

        <div class="legend">
          <div class="key"><div class="swatches" style="background:var(--pivot)"></div><div class="small">Pivot</div></div>
          <div class="key"><div class="swatches" style="background:var(--cmp)"></div><div class="small">Comparing</div></div>
          <div class="key"><div class="swatches" style="background:var(--danger)"></div><div class="small">Swapping</div></div>
          <div class="key"><div class="swatches" style="background:var(--sorted)"></div><div class="small">Placed/Sorted</div></div>
        </div>
      </div>

      <div class="right">
        <div class="panel">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <div style="font-weight:700">Algorithm (Lomuto partition)</div>
            <div style="font-size:12px;color:var(--muted)">Pivot: <span id="pivotName">median-of-three</span></div>
          </div>

          <pre id="pseudocode">
function quickSort(arr):
  stack.push((0, n-1))
  while stack not empty:
    (low, high) = stack.pop()
    if low < high:
      p = partition(arr, low, high)
      push (low, p-1), (p+1, high)

function partition(arr, low, high):
  choose pivot index
  swap pivot with arr[high]
  i = low
  for j from low to high-1:
    if arr[j] < pivotVal:
      swap arr[i] and arr[j]
      i++
  swap arr[i] and arr[high]
  return i
          </pre>

          <div style="margin-top:12px;">
            <div style="font-weight:700;margin-bottom:6px">Recursion stack (ranges)</div>
            <div class="stack-list" id="stackList"></div>
          </div>
        </div>

        <div style="height:12px"></div>

        <div class="panel">
          <div style="font-weight:700;margin-bottom:6px">Controls & Info</div>
          <div style="display:flex;gap:8px;align-items:center;">
            <input id="showValues" type="checkbox"><label for="showValues" style="margin:0;font-size:13px;color:var(--muted);">Show values on bars</label>
          </div>
          <div style="height:8px"></div>
          <div style="font-size:13px;color:var(--muted)">You can pick pivot selection strategy and step through the sorting process. Click "Start" to animate or "Step" to move one operation at a time.</div>
        </div>

      </div>
    </div>

    <footer>Quick Sort visualization â€” Lomuto partition; pivot strategies: first, last, middle, random, median-of-three.</footer>
  </div>

  <script>
    // Quick Sort Visualizer - single file
    (function(){
      // DOM
      const visual = document.getElementById('visual');
      const sizeRange = document.getElementById('size');
      const sizeVal = document.getElementById('sizeVal');
      const generateBtn = document.getElementById('generate');
      const shuffleBtn = document.getElementById('shuffle');
      const startBtn = document.getElementById('start');
      const pauseBtn = document.getElementById('pause');
      const stepBtn = document.getElementById('step');
      const resetBtn = document.getElementById('reset');
      const pivotSelect = document.getElementById('pivot');
      const pivotName = document.getElementById('pivotName');
      const speedRange = document.getElementById('speed');
      const speedVal = document.getElementById('speedVal');
      const cmpCountEl = document.getElementById('cmpCount');
      const swapCountEl = document.getElementById('swapCount');
      const stepCountEl = document.getElementById('stepCount');
      const stackList = document.getElementById('stackList');
      const pseudocode = document.getElementById('pseudocode');
      const showValues = document.getElementById('showValues');

      let array = [];
      let bars = [];
      let maxVal = 100;
      let running = false;
      let paused = false;
      let generator = null;
      let timer = null;
      let delay = Number(speedRange.value);
      let cmpCount = 0, swapCount = 0, stepCount = 0;
      let activeIndices = {}; // classes map
      let sortedIndices = new Set();
      let stackRanges = [];

      // UI init
      sizeVal.textContent = sizeRange.value;
      speedVal.textContent = delay + ' ms';
      pivotName.textContent = pivotSelect.options[pivotSelect.selectedIndex].text;

      function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }

      function generateArray(n){
        array = [];
        maxVal = Math.max(20, n * 3);
        for(let i=0;i<n;i++){
          array.push(randInt(5, maxVal));
        }
        cmpCount = swapCount = stepCount = 0;
        sortedIndices.clear();
        activeIndices = {};
        updateStats();
        renderArray();
      }

      function shuffleArray(){
        for(let i=array.length-1;i>0;i--){
          const j = randInt(0,i);
          [array[i], array[j]] = [array[j], array[i]];
        }
        cmpCount = swapCount = stepCount = 0;
        sortedIndices.clear();
        activeIndices = {};
        updateStats();
        renderArray();
      }

      function renderArray(){
        visual.innerHTML = '';
        bars = [];
        const n = array.length;
        const max = Math.max(...array);
        for(let i=0;i<n;i++){
          const val = array[i];
          const bar = document.createElement('div');
          bar.className = 'bar' + (showValues.checked ? ' show-value' : '');
          bar.style.height = (val / max * 100) + '%';
          bar.dataset.index = i;
          const label = document.createElement('div');
          label.className = 'bar-value';
          label.textContent = val;
          bar.appendChild(label);
          visual.appendChild(bar);
          bars.push(bar);
        }
        updateBarStyles();
      }

      function updateBarStyles(highlightOps){
        // highlightOps optionally contains info: {pivotIndex, compare:[i,j], swap:[i,j], activeRange:[low,high], markPlaced: index}
        // Reset classes
        bars.forEach(b => b.className = 'bar' + (showValues.checked ? ' show-value' : ''));
        if(highlightOps){
          if(highlightOps.activeRange){
            const [low,high] = highlightOps.activeRange;
            for(let i=low;i<=high;i++){
              if(bars[i]) bars[i].classList.add('active-range');
            }
          }
          if(typeof highlightOps.pivotIndex === 'number' && bars[highlightOps.pivotIndex]) bars[highlightOps.pivotIndex].classList.add('pivot');
          if(Array.isArray(highlightOps.compare)){
            highlightOps.compare.forEach(i => { if(bars[i]) bars[i].classList.add('compare'); });
          }
          if(Array.isArray(highlightOps.swap)){
            highlightOps.swap.forEach(i => { if(bars[i]) bars[i].classList.add('swap'); });
          }
          if(Number.isInteger(highlightOps.markPlaced) && bars[highlightOps.markPlaced]) bars[highlightOps.markPlaced].classList.add('sorted');
        }
        // permanently mark sortedIndices
        sortedIndices.forEach(i => {
          if(bars[i]) bars[i].classList.add('sorted');
        });
      }

      function updateStats(){
        cmpCountEl.textContent = cmpCount;
        swapCountEl.textContent = swapCount;
        stepCountEl.textContent = stepCount;
        // stack list
        stackList.innerHTML = '';
        stackRanges.slice().reverse().forEach(r => { // display top-first
          const it = document.createElement('div');
          it.className = 'stack-item';
          it.textContent = '['+r[0]+', '+r[1]+']';
          stackList.appendChild(it);
        });
      }

      // Pivot selection strategies
      function choosePivotIndex(arr, low, high, strategy){
        if(strategy === 'first') return low;
        if(strategy === 'last') return high;
        if(strategy === 'middle') return Math.floor((low+high)/2);
        if(strategy === 'random') return randInt(low, high);
        if(strategy === 'median3'){
          const mid = Math.floor((low+high)/2);
          const a = {v:arr[low], i:low};
          const b = {v:arr[mid], i:mid};
          const c = {v:arr[high], i:high};
          const trio = [a,b,c].sort((x,y)=>x.v-y.v);
          return trio[1].i;
        }
        return high;
      }

      // Partition (Lomuto) as a generator yields ops
      function* partitionGen(arr, low, high, pivotStrategy){
        // choose pivot index
        const pIndex = choosePivotIndex(arr, low, high, pivotStrategy);
        yield {type:'pivot', pivotIndex:pIndex, activeRange:[low,high]};
        // swap pivot to end (high)
        if(pIndex !== high){
          [arr[pIndex], arr[high]] = [arr[high], arr[pIndex]];
          yield {type:'swap', swap:[pIndex, high], activeRange:[low,high]};
        }
        const pivotVal = arr[high];
        let i = low;
        for(let j=low;j<high;j++){
          yield {type:'compare', compare:[j, high], activeRange:[low,high], pivotIndex:high};
          if(arr[j] < pivotVal){
            if(i !== j){
              [arr[i], arr[j]] = [arr[j], arr[i]];
              yield {type:'swap', swap:[i,j], activeRange:[low,high], pivotIndex:high};
            }
            i++;
          }
        }
        // place pivot to its final position
        if(i !== high){
          [arr[i], arr[high]] = [arr[high], arr[i]];
          yield {type:'swap', swap:[i,high], activeRange:[low,high], markPlaced:i};
        } else {
          // pivot already in place
          yield {type:'mark', markPlaced:i, activeRange:[low,high]};
        }
        return i;
      }

      // QuickSort iterative using explicit stack, yields each operation from partitionGen
      function* quickSortGen(arr, pivotStrategy){
        const n = arr.length;
        const stack = [];
        stack.push([0, n-1]);
        // yield stack updates
        while(stack.length){
          stackRanges = stack.slice();
          const range = stack.pop();
          const low = range[0], high = range[1];
          if(low < high){
            // yield that we're processing this range
            yield {type:'stack', stack:stackRanges, activeRange:[low,high]};
            // partition
            const partGen = partitionGen(arr, low, high, pivotStrategy);
            let maybe;
            while(!(maybe = partGen.next()).done){
              yield maybe.value;
            }
            const p = maybe.value; // returned pivot final index
            // mark pivot placed
            yield {type:'placed', index:p, activeRange:[low,high]};
            // push subranges
            // push larger first so smaller gets processed sooner (optional for stack depth)
            const left = [low, p-1];
            const right = [p+1, high];
            // push right, then left
            if(right[0] < right[1] || right[0] === right[1]) stack.push(right);
            if(left[0] < left[1] || left[0] === left[1]) stack.push(left);
            // update stack view
            stackRanges = stack.slice();
            yield {type:'stack', stack:stackRanges};
          } else {
            // single element or invalid: mark as placed if within bounds
            if(low === high){
              yield {type:'placed', index:low, activeRange:[low,high]};
            }
            stackRanges = stack.slice();
            yield {type:'stack', stack:stackRanges};
          }
        }
        // finished
        yield {type:'done'};
      }

      // Step runner
      function applyOp(op){
        stepCount++;
        stepCountEl.textContent = stepCount;
        if(op.type === 'pivot'){
          updateBarStyles({pivotIndex:op.pivotIndex, activeRange:op.activeRange});
        } else if(op.type === 'compare'){
          cmpCount++;
          cmpCountEl.textContent = cmpCount;
          updateBarStyles({compare:op.compare, pivotIndex:op.pivotIndex, activeRange:op.activeRange});
        } else if(op.type === 'swap'){
          swapCount++;
          swapCountEl.textContent = swapCount;
          // reflect array is already mutated by generator
          renderHeights();
          updateBarStyles({swap:op.swap, activeRange:op.activeRange, markPlaced:op.markPlaced});
        } else if(op.type === 'mark'){
          if(typeof op.markPlaced === 'number') sortedIndices.add(op.markPlaced);
          updateBarStyles({markPlaced:op.markPlaced, activeRange:op.activeRange});
        } else if(op.type === 'placed'){
          if(typeof op.index === 'number') sortedIndices.add(op.index);
          updateBarStyles({markPlaced:op.index, activeRange:op.activeRange});
        } else if(op.type === 'stack'){
          stackRanges = op.stack.slice();
          updateStats();
          updateBarStyles({activeRange:op.activeRange});
        } else if(op.type === 'done'){
          running = false;
          paused = false;
          // mark all sorted
          for(let i=0;i<array.length;i++) sortedIndices.add(i);
          updateBarStyles();
          updateStats();
          stopTimer();
        }
        updateStats();
      }

      function renderHeights(){
        const max = Math.max(...array, 1);
        for(let i=0;i<bars.length;i++){
          const h = (array[i] / max * 100) + '%';
          bars[i].style.height = h;
          const lbl = bars[i].querySelector('.bar-value');
          if(lbl) lbl.textContent = array[i];
        }
      }

      // Timer control for auto-run
      function stopTimer(){
        if(timer) { clearTimeout(timer); timer = null; }
      }

      function runGenerator(auto=true){
        if(!generator) return;
        if(!auto){
          // step mode: run single next
          const res = generator.next();
          if(res.done) { applyOp({type:'done'}); return; }
          applyOp(res.value);
          return;
        }
        function stepLoop(){
          if(!generator) return;
          const res = generator.next();
          if(res.done){
            applyOp({type:'done'});
            return;
          }
          applyOp(res.value);
          if(!running || paused) return;
          timer = setTimeout(stepLoop, delay);
        }
        stepLoop();
      }

      // Button handlers
      sizeRange.addEventListener('input',()=>{
        sizeVal.textContent = sizeRange.value;
      });

      speedRange.addEventListener('input',()=>{
        delay = Number(speedRange.value);
        speedVal.textContent = delay + ' ms';
      });

      pivotSelect.addEventListener('change',()=>{
        pivotName.textContent = pivotSelect.options[pivotSelect.selectedIndex].text;
      });

      generateBtn.addEventListener('click',()=>{
        stop();
        generateArray(Number(sizeRange.value));
      });

      shuffleBtn.addEventListener('click',()=>{
        stop();
        shuffleArray();
      });

      startBtn.addEventListener('click',()=>{
        if(running && paused){
          paused = false;
          runGenerator(true);
          return;
        }
        if(running) return;
        // initialize and start
        running = true;
        paused = false;
        cmpCount = swapCount = stepCount = 0;
        cmpCountEl.textContent = cmpCount;
        swapCountEl.textContent = swapCount;
        stepCountEl.textContent = stepCount;
        sortedIndices.clear();
        activeIndices = {};
        // create copy for generator to mutate
        // We'll use the array in place so it's visible
        generator = quickSortGen(array, pivotSelect.value);
        runGenerator(true);
      });

      pauseBtn.addEventListener('click',()=>{
        if(!running) return;
        paused = !paused;
        if(!paused){
          runGenerator(true);
        } else {
          stopTimer();
        }
      });

      stepBtn.addEventListener('click',()=>{
        if(!running){
          // start generator but paused, so we can step
          running = true;
          paused = true;
          sortedIndices.clear();
          generator = quickSortGen(array, pivotSelect.value);
        }
        // ensure not running auto
        paused = true;
        stopTimer();
        runGenerator(false); // single step
      });

      resetBtn.addEventListener('click',()=>{
        stop();
        generateArray(Number(sizeRange.value));
      });

      document.getElementById('showValues').addEventListener('change',(e)=>{
        bars.forEach(b => {
          if(e.target.checked) b.classList.add('show-value'); else b.classList.remove('show-value');
        });
      });

      function stop(){
        running = false;
        paused = false;
        generator = null;
        stopTimer();
        cmpCount = swapCount = stepCount = 0;
        cmpCountEl.textContent = cmpCount;
        swapCountEl.textContent = swapCount;
        stepCountEl.textContent = stepCount;
        sortedIndices.clear();
        activeIndices = {};
        stackRanges = [];
        updateStats();
      }

      // initialize
      generateArray(Number(sizeRange.value));

      // Keyboard shortcuts
      window.addEventListener('keydown',(e)=>{
        if(e.key === ' ') { e.preventDefault(); if(running) pauseBtn.click(); else startBtn.click(); }
        if(e.key === 'ArrowRight') stepBtn.click();
        if(e.key === 'r' || e.key === 'R') resetBtn.click();
      });

      // initial render
      renderArray();
      updateStats();

    })();
  </script>
</body>
</html>