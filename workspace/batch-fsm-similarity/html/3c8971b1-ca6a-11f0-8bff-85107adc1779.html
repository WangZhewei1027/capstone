<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Binary Search Demonstration</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 2rem;
    background: #f5f5f5;
  }
  h1 {
    text-align: center;
  }
  #array-container {
    display: flex;
    justify-content: center;
    margin-bottom: 1rem;
    flex-wrap: wrap;
    gap: 5px;
  }
  .array-item {
    width: 40px;
    height: 40px;
    background: white;
    border: 2px solid #333;
    border-radius: 4px;
    line-height: 40px;
    text-align: center;
    font-weight: bold;
    user-select: none;
    transition: background-color 0.3s, border-color 0.3s;
    position: relative;
  }
  .array-item.low {
    border-color: #007bff;
  }
  .array-item.high {
    border-color: #28a745;
  }
  .array-item.mid {
    border-color: #ffc107;
  }
  .array-item.checked {
    background-color: #ffe082;
  }
  .array-item.found {
    background-color: #28a745;
    color: white;
    font-weight: bolder;
  }
  .array-item.not-found {
    background-color: #dc3545;
    color: white;
  }
  #controls {
    max-width: 600px;
    margin: 0 auto 2rem auto;
    text-align: center;
  }
  input[type=number] {
    width: 80px;
    font-size: 1rem;
    padding: 0.3rem;
    margin-right: 0.5rem;
  }
  button {
    font-size: 1rem;
    padding: 0.4rem 1rem;
    cursor: pointer;
  }
  #log {
    max-width: 600px;
    margin: 0 auto;
    background: white;
    border: 1px solid #ccc;
    padding: 1rem;
    height: 150px;
    overflow-y: auto;
    font-family: monospace;
    white-space: pre-line;
  }
  #speed-control {
    margin-top: 1rem;
    text-align: center;
  }
  label {
    font-size: 0.9rem;
    margin-right: 0.5rem;
  }
</style>
</head>
<body>

<h1>Binary Search Demonstration</h1>

<div id="array-container" aria-label="Array to search"></div>

<div id="controls">
  <input type="number" id="array-size" aria-label="Array size" min="5" max="30" value="15" />
  <button id="generate-array">Generate Sorted Array</button>
  <br /><br />
  <input type="number" id="target-value" aria-label="Target value" placeholder="Enter target" />
  <button id="start-search">Start Search</button>

  <div id="speed-control">
    <label for="speed-range">Step Delay (ms):</label>
    <input type="range" id="speed-range" min="100" max="2000" step="100" value="700" />
    <span id="speed-display">700 ms</span>
  </div>
</div>

<div id="log" aria-live="polite">
  Click "Generate Sorted Array" to create an array.<br />
  Then enter a target value and click "Start Search" to see binary search in action.
</div>

<script>
(() => {
  const arrayContainer = document.getElementById('array-container');
  const generateArrayBtn = document.getElementById('generate-array');
  const startSearchBtn = document.getElementById('start-search');
  const arraySizeInput = document.getElementById('array-size');
  const targetValueInput = document.getElementById('target-value');
  const logElement = document.getElementById('log');
  const speedRange = document.getElementById('speed-range');
  const speedDisplay = document.getElementById('speed-display');

  let array = [];
  let stepDelay = parseInt(speedRange.value);

  // Utility to log messages to the log panel
  function log(message) {
    logElement.textContent += message + '\n';
    logElement.scrollTop = logElement.scrollHeight;
  }

  // Clears previous array display and log
  function clearDisplay() {
    arrayContainer.innerHTML = '';
    logElement.textContent = '';
  }

  // Generate a sorted array of given size with unique integers
  function generateSortedArray(size) {
    let arr = [];
    // To keep numbers unique and sorted, start random between 1 and 3, then add 1-5 increment
    let current = Math.floor(Math.random() * 3) + 1;
    for (let i = 0; i < size; i++) {
      arr.push(current);
      current += Math.floor(Math.random() * 5) + 1;
    }
    return arr;
  }

  // Render the array to the page
  function renderArray(arr) {
    arrayContainer.innerHTML = '';
    arr.forEach((val) => {
      const item = document.createElement('div');
      item.classList.add('array-item');
      item.textContent = val;
      arrayContainer.appendChild(item);
    });
  }

  // Update element classes for low, high, mid and checked/found indicators
  function updateHighlights(low, high, mid, checkedIndexes = [], foundIndex = -1) {
    const items = arrayContainer.children;
    for (let i = 0; i < items.length; i++) {
      items[i].className = 'array-item'; // Reset all classes
      if (i === low) items[i].classList.add('low');
      if (i === high) items[i].classList.add('high');
      if (i === mid) items[i].classList.add('mid');
      if (checkedIndexes.includes(i)) items[i].classList.add('checked');
      if (i === foundIndex) items[i].classList.add('found');
    }
  }

  // Sleep helper for async delays
  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  // Perform binary search with visualization
  async function binarySearchVisual(arr, target) {
    log(`Starting binary search for target: ${target}`);
    let low = 0;
    let high = arr.length - 1;

    while (low <= high) {
      let mid = Math.floor((low + high) / 2);
      updateHighlights(low, high, mid);
      log(`Checking middle index ${mid} with value ${arr[mid]}...`);
      await sleep(stepDelay);

      if (arr[mid] === target) {
        log(`Found target ${target} at index ${mid}.`);
        updateHighlights(low, high, mid, [], mid);
        return mid;
      } else if (arr[mid] < target) {
        log(`Target is greater than ${arr[mid]}, moving low to ${mid + 1}`);
        low = mid + 1;
      } else {
        log(`Target is less than ${arr[mid]}, moving high to ${mid - 1}`);
        high = mid - 1;
      }
      updateHighlights(low, high, mid, [mid]);
      await sleep(stepDelay);
    }
    log(`Target ${target} not found in the array.`);
    // Mark all items checked as not-found, highlight last low and high
    const items = arrayContainer.children;
    for(let i = 0; i < items.length; i++) {
      items[i].classList.remove('checked');
      if (i >= low && i <= high) {
        items[i].classList.add('not-found');
      }
    }
    return -1;
  }

  // Event listeners
  generateArrayBtn.addEventListener('click', () => {
    clearDisplay();
    const size = parseInt(arraySizeInput.value);
    if (isNaN(size) || size < 5 || size > 30) {
      alert("Please enter an array size between 5 and 30.");
      return;
    }
    array = generateSortedArray(size);
    renderArray(array);
    log("Generated sorted array:\n[" + array.join(', ') + "]");
  });

  startSearchBtn.addEventListener('click', async () => {
    if (array.length === 0) {
      alert("Generate the array first.");
      return;
    }
    const target = parseInt(targetValueInput.value);
    if (isNaN(target)) {
      alert("Please enter a valid target number.");
      return;
    }
    // Disable buttons during search
    generateArrayBtn.disabled = true;
    startSearchBtn.disabled = true;
    arraySizeInput.disabled = true;
    targetValueInput.disabled = true;

    await binarySearchVisual(array, target);

    // Re-enable controls
    generateArrayBtn.disabled = false;
    startSearchBtn.disabled = false;
    arraySizeInput.disabled = false;
    targetValueInput.disabled = false;
  });

  speedRange.addEventListener('input', () => {
    stepDelay = parseInt(speedRange.value);
    speedDisplay.textContent = stepDelay + ' ms';
  });

  // Initial generate
  (() => {
    array = generateSortedArray(parseInt(arraySizeInput.value));
    renderArray(array);
    log("Generated sorted array:\n[" + array.join(', ') + "]");
  })();
})();
</script>

</body>
</html>