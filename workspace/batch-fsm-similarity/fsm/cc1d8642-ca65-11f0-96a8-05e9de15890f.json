{
  "meta": {
    "concept": "UnionFind",
    "topic": "Union-Find (Disjoint Set) Visualizer",
    "educational_goal": "Allow users to create elements, perform union and find operations, observe tree structure, path compression and union-by-rank/size, and visualize animations",
    "expected_interactions": [
      "select_node",
      "union",
      "find",
      "reset",
      "random_union",
      "auto_union",
      "shuffle",
      "randomize",
      "toggle_union_strategy",
      "toggle_path_compression",
      "adjust_speed",
      "change_n"
    ]
  },
  "states": [
    {
      "id": "S0_Idle",
      "label": "Idle",
      "type": "idle",
      "entry_actions": [
        "draw()",
        "updateUI()",
        "set animRunning=false"
      ],
      "exit_actions": []
    },
    {
      "id": "S1_SelectedOne",
      "label": "OneNodeSelected",
      "type": "atomic",
      "entry_actions": [
        "selected = [hit]",
        "updateUI()",
        "draw()"
      ],
      "exit_actions": []
    },
    {
      "id": "S2_SelectedTwo",
      "label": "TwoNodesSelected",
      "type": "atomic",
      "entry_actions": [
        "prepareUnion()",
        "updateUI()",
        "draw()"
      ],
      "exit_actions": [
        "clearSelection()"
      ]
    },
    {
      "id": "S3_Finding",
      "label": "Finding",
      "type": "atomic",
      "entry_actions": [
        "enqueue(find animation)",
        "ops++",
        "updateUI()",
        "log(find started)"
      ],
      "exit_actions": [
        "resolve find promise",
        "updateUI()"
      ]
    },
    {
      "id": "S4_Unioning",
      "label": "Unioning",
      "type": "atomic",
      "entry_actions": [
        "union(a,b)",
        "log(union started)",
        "updateUI()",
        "draw()"
      ],
      "exit_actions": [
        "updateUI()",
        "draw()"
      ]
    },
    {
      "id": "S5_Animating",
      "label": "AnimatingQueue",
      "type": "atomic",
      "entry_actions": [
        "processQueue()",
        "set animRunning=true"
      ],
      "exit_actions": [
        "set animRunning=false"
      ]
    },
    {
      "id": "S6_AutoUnioning",
      "label": "AutoUnionLoop",
      "type": "compound",
      "entry_actions": [
        "start auto-union iter() loop",
        "log(auto-union started)"
      ],
      "exit_actions": [
        "stop auto-union loop",
        "log(auto-union stopped)"
      ]
    },
    {
      "id": "S7_Randomizing",
      "label": "RandomizingComponents",
      "type": "atomic",
      "entry_actions": [
        "applyRandomizeImmediate()",
        "log(Randomized components)",
        "updateUI()",
        "draw()"
      ],
      "exit_actions": []
    },
    {
      "id": "S8_Shuffling",
      "label": "ShufflingPositions",
      "type": "atomic",
      "entry_actions": [
        "positions = computeCirclePositions(N) + jitter",
        "draw()"
      ],
      "exit_actions": []
    },
    {
      "id": "S9_Resetting",
      "label": "Resetting",
      "type": "atomic",
      "entry_actions": [
        "init(N)",
        "resetArrays(N)",
        "log(Reset with N elements)",
        "updateUI()",
        "draw()"
      ],
      "exit_actions": []
    },
    {
      "id": "S10_ChangingN",
      "label": "ChangingN",
      "type": "atomic",
      "entry_actions": [
        "N = Number(#nRange.value)",
        "nVal.textContent = N",
        "updateUI()"
      ],
      "exit_actions": []
    },
    {
      "id": "S11_UpdatingSpeed",
      "label": "UpdatingSpeed",
      "type": "atomic",
      "entry_actions": [
        "animSpeed = Number(#speedRange.value)",
        "speedVal.textContent = animSpeed + 'ms'"
      ],
      "exit_actions": []
    },
    {
      "id": "S12_TogglingRank",
      "label": "TogglingUnionStrategy",
      "type": "atomic",
      "entry_actions": [
        "convertRankOrSize()",
        "log(strategy toggled)",
        "updateUI()"
      ],
      "exit_actions": []
    }
  ],
  "events": [
    {
      "id": "CANVAS_CLICK",
      "event_type": "user_action",
      "description": "User clicks on the canvas (node selection/hit test) using selector #canvas",
      "triggers": "#canvas"
    },
    {
      "id": "N_RANGE_INPUT",
      "event_type": "user_action",
      "description": "User changes number of elements via range input",
      "triggers": "#nRange"
    },
    {
      "id": "RESET_CLICK",
      "event_type": "user_action",
      "description": "User clicks Reset button",
      "triggers": "#resetBtn"
    },
    {
      "id": "SPEED_RANGE_INPUT",
      "event_type": "user_action",
      "description": "User adjusts animation speed slider",
      "triggers": "#speedRange"
    },
    {
      "id": "FIND_CLICK",
      "event_type": "user_action",
      "description": "User clicks Find button to run find on selected node",
      "triggers": "#findBtn"
    },
    {
      "id": "CLEAR_SELECTION_CLICK",
      "event_type": "user_action",
      "description": "User clicks Clear sel button to clear selection",
      "triggers": "#clearSelectionBtn"
    },
    {
      "id": "RANDOM_UNION_CLICK",
      "event_type": "user_action",
      "description": "User clicks Random union button to perform a random union",
      "triggers": "#randomUnionBtn"
    },
    {
      "id": "AUTO_UNION_CLICK",
      "event_type": "user_action",
      "description": "User clicks Auto-union until one set button to start the loop",
      "triggers": "#autoUnionBtn"
    },
    {
      "id": "SHUFFLE_CLICK",
      "event_type": "user_action",
      "description": "User clicks Shuffle positions",
      "triggers": "#shuffleBtn"
    },
    {
      "id": "RANDOMIZE_CLICK",
      "event_type": "user_action",
      "description": "User clicks Random components to randomize components",
      "triggers": "#randomizeBtn"
    },
    {
      "id": "USE_RANK_CHANGE",
      "event_type": "user_action",
      "description": "User toggles union-by-rank checkbox",
      "triggers": "#useRank"
    },
    {
      "id": "COMPRESS_TOGGLE",
      "event_type": "user_action",
      "description": "User toggles path compression checkbox (affects behavior of find)",
      "triggers": "#compressDuringFind"
    },
    {
      "id": "ANIM_QUEUE_EMPTY",
      "event_type": "system_event",
      "description": "Animation queue emptied (all enqueued visual steps complete)"
    },
    {
      "id": "FIND_COMPLETE",
      "event_type": "system_event",
      "description": "Find operation resolved (root returned)"
    },
    {
      "id": "UNION_COMPLETE",
      "event_type": "system_event",
      "description": "Union operation complete and UI updated"
    },
    {
      "id": "AUTO_UNION_STEP",
      "event_type": "system_event",
      "description": "Auto-union loop iteration performed"
    },
    {
      "id": "RANDOMIZE_COMPLETE",
      "event_type": "system_event",
      "description": "Randomize components done and UI updated"
    }
  ],
  "transitions": [
    {
      "from": "S0_Idle",
      "to": "S1_SelectedOne",
      "event": "CANVAS_CLICK",
      "guard": "hitTest(x,y) !== null && selected.length === 0",
      "actions": [
        "selected.push(hit)",
        "updateUI()",
        "draw()"
      ],
      "triggers": "#canvas",
      "expected_observables": [
        "dom:#canvas:click"
      ],
      "timeout": 0
    },
    {
      "from": "S1_SelectedOne",
      "to": "S2_SelectedTwo",
      "event": "CANVAS_CLICK",
      "guard": "hitTest(x,y) !== null && selected.length === 1 && hit !== selected[0]",
      "actions": [
        "selected.push(hit)",
        "updateUI()",
        "draw()",
        "enqueue(union(selected[0], selected[1]))",
        "selected = []"
      ],
      "triggers": "#canvas",
      "expected_observables": [
        "dom:#canvas:click",
        "dom:newUnionStarted"
      ],
      "timeout": 0
    },
    {
      "from": "S1_SelectedOne",
      "to": "S3_Finding",
      "event": "CANVAS_CLICK",
      "guard": "hitTest(x,y) !== null && selected.length === 1 && hit === selected[0]",
      "actions": [
        "enqueue(find(selected[0], true))",
        "log('find requested via canvas click')"
      ],
      "triggers": "#canvas",
      "expected_observables": [
        "dom:#canvas:click",
        "dom:findStarted"
      ],
      "timeout": 0
    },
    {
      "from": "S1_SelectedOne",
      "to": "S3_Finding",
      "event": "FIND_CLICK",
      "guard": "selected.length === 1",
      "actions": [
        "enqueue(find(selected[0], true))",
        "log('find requested via #findBtn')"
      ],
      "triggers": "#findBtn",
      "expected_observables": [
        "dom:#findBtn:click",
        "dom:findStarted"
      ],
      "timeout": 0
    },
    {
      "from": "S1_SelectedOne",
      "to": "S0_Idle",
      "event": "CLEAR_SELECTION_CLICK",
      "guard": "true",
      "actions": [
        "selected = []",
        "updateUI()",
        "draw()"
      ],
      "triggers": "#clearSelectionBtn",
      "expected_observables": [
        "dom:#clearSelectionBtn:click"
      ],
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S9_Resetting",
      "event": "RESET_CLICK",
      "guard": "true",
      "actions": [
        "N = Number(document.querySelector('#nRange').value)",
        "init(N)",
        "log('Reset button clicked')"
      ],
      "triggers": "#resetBtn",
      "expected_observables": [
        "dom:#resetBtn:click"
      ],
      "timeout": 200
    },
    {
      "from": "S0_Idle",
      "to": "S10_ChangingN",
      "event": "N_RANGE_INPUT",
      "guard": "true",
      "actions": [
        "N = Number(#nRange.value)",
        "nVal.textContent = N",
        "updateUI()"
      ],
      "triggers": "#nRange",
      "expected_observables": [
        "dom:#nRange:input"
      ],
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S11_UpdatingSpeed",
      "event": "SPEED_RANGE_INPUT",
      "guard": "true",
      "actions": [
        "animSpeed = Number(#speedRange.value)",
        "speedVal.textContent = animSpeed + 'ms'"
      ],
      "triggers": "#speedRange",
      "expected_observables": [
        "dom:#speedRange:input"
      ],
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S7_Randomizing",
      "event": "RANDOMIZE_CLICK",
      "guard": "true",
      "actions": [
        "applyRandomizeImmediate()",
        "log('Randomized components')",
        "updateUI()",
        "draw()"
      ],
      "triggers": "#randomizeBtn",
      "expected_observables": [
        "dom:#randomizeBtn:click"
      ],
      "timeout": 500
    },
    {
      "from": "S0_Idle",
      "to": "S8_Shuffling",
      "event": "SHUFFLE_CLICK",
      "guard": "true",
      "actions": [
        "positions = computeCirclePositions(N).map(jitter)",
        "draw()"
      ],
      "triggers": "#shuffleBtn",
      "expected_observables": [
        "dom:#shuffleBtn:click"
      ],
      "timeout": 200
    },
    {
      "from": "S0_Idle",
      "to": "S4_Unioning",
      "event": "RANDOM_UNION_CLICK",
      "guard": "true",
      "actions": [
        "const a=randInt(0,N-1); const b=randInt(0,N-1); if (a!==b) union(a,b) else log('random pick same index')"
      ],
      "triggers": "#randomUnionBtn",
      "expected_observables": [
        "dom:#randomUnionBtn:click"
      ],
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S6_AutoUnioning",
      "event": "AUTO_UNION_CLICK",
      "guard": "true",
      "actions": [
        "start auto-union iter() loop which calls union(a,b) repeatedly until countSets()<=1",
        "log('auto-union started')"
      ],
      "triggers": "#autoUnionBtn",
      "expected_observables": [
        "dom:#autoUnionBtn:click"
      ],
      "timeout": 0
    },
    {
      "from": "S6_AutoUnioning",
      "to": "S0_Idle",
      "event": "AUTO_UNION_STEP",
      "guard": "countSets() <= 1",
      "actions": [
        "log('Single set achieved.')",
        "stop auto-union loop"
      ],
      "triggers": "#autoUnionBtn",
      "expected_observables": [
        "dom:autoUnion:iteration",
        "dom:setsCount==1"
      ],
      "timeout": 0
    },
    {
      "from": "S4_Unioning",
      "to": "S5_Animating",
      "event": "ANIMATION_START",
      "guard": "animQueue.length > 0",
      "actions": [
        "processQueue()",
        "set animRunning=true"
      ],
      "triggers": "#canvas,#findBtn,#randomUnionBtn",
      "expected_observables": [
        "dom:animationQueued"
      ],
      "timeout": 0
    },
    {
      "from": "S3_Finding",
      "to": "S5_Animating",
      "event": "ANIMATION_START",
      "guard": "animQueue.length > 0",
      "actions": [
        "processQueue()",
        "set animRunning=true"
      ],
      "triggers": "#canvas,#findBtn",
      "expected_observables": [
        "dom:animationQueued"
      ],
      "timeout": 0
    },
    {
      "from": "S5_Animating",
      "to": "S0_Idle",
      "event": "ANIM_QUEUE_EMPTY",
      "guard": "animQueue.length === 0",
      "actions": [
        "set animRunning=false",
        "updateUI()",
        "draw()"
      ],
      "triggers": "#canvas,#speedRange",
      "expected_observables": [
        "dom:animationComplete",
        "dom:visualizationComplete"
      ],
      "timeout": 1000
    },
    {
      "from": "S3_Finding",
      "to": "S0_Idle",
      "event": "FIND_COMPLETE",
      "guard": "true",
      "actions": [
        "selected = []",
        "updateUI()",
        "draw()",
        "log('find complete')"
      ],
      "triggers": "#findBtn,#canvas",
      "expected_observables": [
        "dom:findComplete"
      ],
      "timeout": 0
    },
    {
      "from": "S4_Unioning",
      "to": "S0_Idle",
      "event": "UNION_COMPLETE",
      "guard": "true",
      "actions": [
        "updateUI()",
        "draw()",
        "log('union complete')"
      ],
      "triggers": "#randomUnionBtn,#canvas",
      "expected_observables": [
        "dom:unionComplete",
        "dom:treeStructureChanged"
      ],
      "timeout": 500
    },
    {
      "from": "S0_Idle",
      "to": "S12_TogglingRank",
      "event": "USE_RANK_CHANGE",
      "guard": "true",
      "actions": [
        "if (#useRank.checked) set rank[] = 0 for all else compute sizes into rank[]",
        "log('Union strategy toggled')",
        "updateUI()"
      ],
      "triggers": "#useRank",
      "expected_observables": [
        "dom:#useRank:change"
      ],
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "COMPRESS_TOGGLE",
      "guard": "true",
      "actions": [
        "#compressDuringFind.checked toggles compression behavior (affects find)",
        "log('Path compression toggled')"
      ],
      "triggers": "#compressDuringFind",
      "expected_observables": [
        "dom:#compressDuringFind:change"
      ],
      "timeout": 0
    },
    {
      "from": "S7_Randomizing",
      "to": "S0_Idle",
      "event": "RANDOMIZE_COMPLETE",
      "guard": "true",
      "actions": [
        "updateUI()",
        "draw()",
        "log('Randomize complete')"
      ],
      "triggers": "#randomizeBtn",
      "expected_observables": [
        "dom:randomizeComplete"
      ],
      "timeout": 200
    },
    {
      "from": "S8_Shuffling",
      "to": "S0_Idle",
      "event": "ANIMATION_START",
      "guard": "true",
      "actions": [
        "draw()",
        "updateUI()"
      ],
      "triggers": "#shuffleBtn",
      "expected_observables": [
        "dom:#shuffleBtn:click"
      ],
      "timeout": 0
    },
    {
      "from": "S10_ChangingN",
      "to": "S9_Resetting",
      "event": "N_RANGE_INPUT",
      "guard": "user completes change and clicks Reset OR immediate init desired",
      "actions": [
        "init(N)",
        "updateUI()",
        "draw()"
      ],
      "triggers": "#nRange",
      "expected_observables": [
        "dom:#nRange:input",
        "dom:#resetBtn:click"
      ],
      "timeout": 0
    }
  ],
  "components": [
    "#canvas",
    "#nRange",
    "#nVal",
    "#resetBtn",
    "#useRank",
    "#compressDuringFind",
    "#speedRange",
    "#speedVal",
    "#randomUnionBtn",
    "#autoUnionBtn",
    "#findBtn",
    "#clearSelectionBtn",
    "#selText",
    "#parentArr",
    "#rankArr",
    "#rankLabel",
    "#setsCount",
    "#opsCount",
    "#log",
    "#shuffleBtn",
    "#randomizeBtn",
    "#compLegend"
  ]
}