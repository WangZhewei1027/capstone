{
  "meta": {
    "concept": "BinaryTree",
    "topic": "Binary Tree (BST) Visualizer",
    "educational_goal": "Demonstrate BST insertion, deletion, search, traversals and step-through insertion with animated highlights",
    "expected_interactions": [
      "insert",
      "delete",
      "search",
      "traversal",
      "random",
      "clear",
      "step_insert",
      "skip_steps",
      "toggle_duplicates",
      "node_click_delete",
      "node_doubleclick_details",
      "stop_animations"
    ]
  },
  "states": [
    {
      "id": "S0_Idle",
      "label": "idle",
      "type": "idle",
      "entry_actions": [
        "render()",
        "enableControls()",
        "updateStatus()"
      ],
      "exit_actions": []
    },
    {
      "id": "S1_InsertingImmediate",
      "label": "inserting_immediate",
      "type": "atomic",
      "entry_actions": [
        "readValue('#valueInput')",
        "disableControls()",
        "insertBST(value)",
        "render()"
      ],
      "exit_actions": [
        "enableControls()",
        "clearInput('#valueInput')"
      ]
    },
    {
      "id": "S2_DeletingImmediate",
      "label": "deleting_immediate",
      "type": "atomic",
      "entry_actions": [
        "readValue('#valueInput')",
        "disableControls()",
        "deleteBST(value)",
        "render()"
      ],
      "exit_actions": [
        "enableControls()",
        "clearInput('#valueInput')"
      ]
    },
    {
      "id": "S3_SearchAnimating",
      "label": "search_animating",
      "type": "atomic",
      "entry_actions": [
        "readValue('#searchInput')",
        "computeSearchPath()",
        "stopAnimations()",
        "animateSearchPath(path, foundNode)"
      ],
      "exit_actions": [
        "stopAnimations()",
        "render()"
      ]
    },
    {
      "id": "S4_TraversalAnimating",
      "label": "traversal_animating",
      "type": "atomic",
      "entry_actions": [
        "computeTraversalNodes(type)",
        "stopAnimations()",
        "animateTraversal(nodes)"
      ],
      "exit_actions": [
        "stopAnimations()",
        "render()"
      ]
    },
    {
      "id": "S5_StepInsertActive",
      "label": "step_insert_active",
      "type": "composite",
      "entry_actions": [
        "readValue('#stepInput')",
        "computeInsertPath(value)",
        "disableControls()",
        "set stepMode.active = true"
      ],
      "exit_actions": [
        "set stepMode.active = false",
        "enableControls()",
        "render()"
      ]
    },
    {
      "id": "S6_StepInsertAnimating",
      "label": "step_insert_animating",
      "type": "atomic",
      "entry_actions": [
        "sequentially highlight path nodes (highlightNodes)",
        "highlight final insertion point (highlightNodes)"
      ],
      "exit_actions": [
        "clear highlight timeouts",
        "apply insertion (insertBST)"
      ]
    },
    {
      "id": "S7_GeneratingRandom",
      "label": "generating_random",
      "type": "atomic",
      "entry_actions": [
        "readValue('#randomCount')",
        "generateRandomTree(n)",
        "render()"
      ],
      "exit_actions": []
    },
    {
      "id": "S8_ClearingTree",
      "label": "clearing_tree",
      "type": "atomic",
      "entry_actions": [
        "stopAnimations()",
        "root = null",
        "render()"
      ],
      "exit_actions": []
    },
    {
      "id": "S9_HighlightThenDelete",
      "label": "highlight_then_delete",
      "type": "atomic",
      "entry_actions": [
        "highlightNodes([nodeRef], {color:var(--danger), duration:600})",
        "disableControls()"
      ],
      "exit_actions": [
        "deleteNodeByRef(nodeRef)",
        "enableControls()",
        "render()"
      ]
    },
    {
      "id": "S10_NodeDetailsShown",
      "label": "node_details_shown",
      "type": "atomic",
      "entry_actions": [
        "showAlert('Node details')"
      ],
      "exit_actions": [
        "dismissAlert()"
      ]
    },
    {
      "id": "S11_AnimationsStopped",
      "label": "animations_stopped",
      "type": "atomic",
      "entry_actions": [
        "stopAnimations()",
        "render()"
      ],
      "exit_actions": []
    },
    {
      "id": "S12_ShowingAlert",
      "label": "showing_alert",
      "type": "atomic",
      "entry_actions": [
        "alert(message)"
      ],
      "exit_actions": []
    }
  ],
  "events": [
    {
      "id": "CLICK_INSERT",
      "event_type": "user_action",
      "description": "User clicks Insert button (#insertBtn)"
    },
    {
      "id": "CLICK_DELETE",
      "event_type": "user_action",
      "description": "User clicks Delete button (#deleteBtn)"
    },
    {
      "id": "CLICK_SEARCH",
      "event_type": "user_action",
      "description": "User clicks Search button (#searchBtn)"
    },
    {
      "id": "CLICK_CLEAR_SEARCH",
      "event_type": "user_action",
      "description": "User clicks Clear search (#clearSearchBtn)"
    },
    {
      "id": "CLICK_RANDOM",
      "event_type": "user_action",
      "description": "User clicks Random tree (#randomBtn)"
    },
    {
      "id": "CLICK_CLEAR",
      "event_type": "user_action",
      "description": "User clicks Clear tree (#clearBtn)"
    },
    {
      "id": "CLICK_INORDER",
      "event_type": "user_action",
      "description": "User clicks In-order traversal (#inorderBtn)"
    },
    {
      "id": "CLICK_PREORDER",
      "event_type": "user_action",
      "description": "User clicks Pre-order traversal (#preorderBtn)"
    },
    {
      "id": "CLICK_POSTORDER",
      "event_type": "user_action",
      "description": "User clicks Post-order traversal (#postorderBtn)"
    },
    {
      "id": "CLICK_LEVELOER",
      "event_type": "user_action",
      "description": "User clicks Level-order traversal (#levelorderBtn)"
    },
    {
      "id": "CLICK_STOP_ANIM",
      "event_type": "user_action",
      "description": "User clicks Stop traversal (#stopAnimBtn)"
    },
    {
      "id": "TOGGLE_DUPLICATES",
      "event_type": "user_action",
      "description": "User toggles Allow duplicates checkbox (#dupToggle)"
    },
    {
      "id": "CLICK_STEP_INSERT",
      "event_type": "user_action",
      "description": "User clicks Step Insert (#stepInsertBtn)"
    },
    {
      "id": "CLICK_SKIP_STEPS",
      "event_type": "user_action",
      "description": "User clicks Skip Steps (#skipStepBtn)"
    },
    {
      "id": "CLICK_EXAMPLE1",
      "event_type": "user_action",
      "description": "User clicks Example Balanced 7 (#example1)"
    },
    {
      "id": "CLICK_EXAMPLE2",
      "event_type": "user_action",
      "description": "User clicks Example Skewed (#example2)"
    },
    {
      "id": "CLICK_EXAMPLE3",
      "event_type": "user_action",
      "description": "User clicks Example Custom set (#example3)"
    },
    {
      "id": "CLICK_SVG_NODE",
      "event_type": "user_action",
      "description": "User clicks a node in the SVG (selector: #svgCanvas g[data-id])"
    },
    {
      "id": "DBLCLICK_SVG_NODE",
      "event_type": "user_action",
      "description": "User double-clicks a node in the SVG (selector: #svgCanvas g[data-id])"
    },
    {
      "id": "CLICK_SVG_CANVAS",
      "event_type": "user_action",
      "description": "User clicks the SVG canvas to clear highlights (#svgCanvas)"
    },
    {
      "id": "INPUT_VALUE_ENTERED",
      "event_type": "user_action",
      "description": "User enters value into input fields (#valueInput, #searchInput, #stepInput, #randomCount)"
    },
    {
      "id": "ANIMATION_COMPLETE",
      "event_type": "system_event",
      "description": "Animation sequence complete (traversal/search/step)"
    },
    {
      "id": "ALERT_DISMISSED",
      "event_type": "user_action",
      "description": "User dismisses blocking alert() (system behavior)"
    }
  ],
  "transitions": [
    {
      "from": "S0_Idle",
      "to": "S1_InsertingImmediate",
      "event": "CLICK_INSERT",
      "guard": "valueIsNumber('#valueInput')",
      "actions": [
        "captureInput('#valueInput')",
        "disableControls()",
        "insertBST(value)"
      ],
      "expected_observables": [
        "dom:#insertBtn:click",
        "dom:#valueInput:value"
      ],
      "timeout": 1000
    },
    {
      "from": "S0_Idle",
      "to": "S12_ShowingAlert",
      "event": "CLICK_INSERT",
      "guard": "valueIsNaN('#valueInput')",
      "actions": [
        "alert('Please enter a number.')"
      ],
      "expected_observables": [
        "dom:#insertBtn:click",
        "dom:alert"
      ],
      "timeout": 500
    },
    {
      "from": "S0_Idle",
      "to": "S2_DeletingImmediate",
      "event": "CLICK_DELETE",
      "guard": "valueIsNumber('#valueInput')",
      "actions": [
        "captureInput('#valueInput')",
        "disableControls()",
        "deleteBST(value)"
      ],
      "expected_observables": [
        "dom:#deleteBtn:click",
        "dom:#valueInput:value"
      ],
      "timeout": 1200
    },
    {
      "from": "S0_Idle",
      "to": "S12_ShowingAlert",
      "event": "CLICK_DELETE",
      "guard": "valueIsNaN('#valueInput')",
      "actions": [
        "alert('Please enter a number to delete.')"
      ],
      "expected_observables": [
        "dom:#deleteBtn:click",
        "dom:alert"
      ],
      "timeout": 500
    },
    {
      "from": "S0_Idle",
      "to": "S3_SearchAnimating",
      "event": "CLICK_SEARCH",
      "guard": "valueIsNumber('#searchInput') && rootNotNull",
      "actions": [
        "captureInput('#searchInput')",
        "computeSearchPath(value)",
        "stopAnimations()",
        "animateSearchPath(path, found)"
      ],
      "expected_observables": [
        "dom:#searchBtn:click",
        "dom:#searchInput:value",
        "dom:svg g[data-id] highlightSequence"
      ],
      "timeout": 5000
    },
    {
      "from": "S0_Idle",
      "to": "S12_ShowingAlert",
      "event": "CLICK_SEARCH",
      "guard": "valueIsNaN('#searchInput')",
      "actions": [
        "alert('Enter a number to search.')"
      ],
      "expected_observables": [
        "dom:#searchBtn:click",
        "dom:alert"
      ],
      "timeout": 500
    },
    {
      "from": "S0_Idle",
      "to": "S12_ShowingAlert",
      "event": "CLICK_SEARCH",
      "guard": "rootIsNull",
      "actions": [
        "alert('Tree is empty.')"
      ],
      "expected_observables": [
        "dom:#searchBtn:click",
        "dom:alert"
      ],
      "timeout": 500
    },
    {
      "from": "S3_SearchAnimating",
      "to": "S0_Idle",
      "event": "ANIMATION_COMPLETE",
      "guard": "true",
      "actions": [
        "stopAnimations()",
        "render()"
      ],
      "expected_observables": [
        "dom:svg g[data-id] highlightComplete"
      ],
      "timeout": 3000
    },
    {
      "from": "S0_Idle",
      "to": "S4_TraversalAnimating",
      "event": "CLICK_INORDER",
      "guard": "rootNotNull",
      "actions": [
        "computeTraversalNodes('inorder')",
        "stopAnimations()",
        "animateTraversal(nodes)"
      ],
      "expected_observables": [
        "dom:#inorderBtn:click",
        "dom:svg g[data-id] highlightSequence"
      ],
      "timeout": 10000
    },
    {
      "from": "S0_Idle",
      "to": "S4_TraversalAnimating",
      "event": "CLICK_PREORDER",
      "guard": "rootNotNull",
      "actions": [
        "computeTraversalNodes('preorder')",
        "stopAnimations()",
        "animateTraversal(nodes)"
      ],
      "expected_observables": [
        "dom:#preorderBtn:click",
        "dom:svg g[data-id] highlightSequence"
      ],
      "timeout": 10000
    },
    {
      "from": "S0_Idle",
      "to": "S4_TraversalAnimating",
      "event": "CLICK_POSTORDER",
      "guard": "rootNotNull",
      "actions": [
        "computeTraversalNodes('postorder')",
        "stopAnimations()",
        "animateTraversal(nodes)"
      ],
      "expected_observables": [
        "dom:#postorderBtn:click",
        "dom:svg g[data-id] highlightSequence"
      ],
      "timeout": 10000
    },
    {
      "from": "S0_Idle",
      "to": "S4_TraversalAnimating",
      "event": "CLICK_LEVELOER",
      "guard": "rootNotNull",
      "actions": [
        "computeTraversalNodes('levelorder')",
        "stopAnimations()",
        "animateTraversal(nodes)"
      ],
      "expected_observables": [
        "dom:#levelorderBtn:click",
        "dom:svg g[data-id] highlightSequence"
      ],
      "timeout": 10000
    },
    {
      "from": "S4_TraversalAnimating",
      "to": "S11_AnimationsStopped",
      "event": "CLICK_STOP_ANIM",
      "guard": "true",
      "actions": [
        "stopAnimations()",
        "render()"
      ],
      "expected_observables": [
        "dom:#stopAnimBtn:click"
      ],
      "timeout": 500
    },
    {
      "from": "S4_TraversalAnimating",
      "to": "S0_Idle",
      "event": "ANIMATION_COMPLETE",
      "guard": "true",
      "actions": [
        "animations.running = false",
        "render()"
      ],
      "expected_observables": [
        "dom:animation:finished"
      ],
      "timeout": 2000
    },
    {
      "from": "S0_Idle",
      "to": "S5_StepInsertActive",
      "event": "CLICK_STEP_INSERT",
      "guard": "valueIsNumber('#stepInput')",
      "actions": [
        "captureInput('#stepInput')",
        "computeInsertPath(value)",
        "set stepMode.active = true",
        "disableControls()"
      ],
      "expected_observables": [
        "dom:#stepInsertBtn:click",
        "dom:#stepInput:value"
      ],
      "timeout": 500
    },
    {
      "from": "S5_StepInsertActive",
      "to": "S6_StepInsertAnimating",
      "event": "ENTER_STEP_ANIMATION",
      "guard": "stepMode.stepsExists",
      "actions": [
        "sequentially highlight path nodes",
        "pause between highlights"
      ],
      "expected_observables": [
        "dom:highlightNodes calls",
        "dom:svg g[data-id] highlightSequence"
      ],
      "timeout": 6000
    },
    {
      "from": "S5_StepInsertActive",
      "to": "S1_InsertingImmediate",
      "event": "ENTER_STEP_ANIMATION",
      "guard": "insertPathIsNull (root empty)",
      "actions": [
        "insertBST(value)",
        "render()"
      ],
      "expected_observables": [
        "dom:#stepInsertBtn:click",
        "dom:rootCreated"
      ],
      "timeout": 500
    },
    {
      "from": "S6_StepInsertAnimating",
      "to": "S5_StepInsertActive",
      "event": "CLICK_SKIP_STEPS",
      "guard": "stepMode.active",
      "actions": [
        "set stepMode.skip = true",
        "stopAnimations()",
        "insertBST(value)",
        "render()"
      ],
      "expected_observables": [
        "dom:#skipStepBtn:click"
      ],
      "timeout": 500
    },
    {
      "from": "S6_StepInsertAnimating",
      "to": "S0_Idle",
      "event": "ANIMATION_COMPLETE",
      "guard": "true",
      "actions": [
        "insertBST(value)",
        "render()",
        "set stepMode.active = false"
      ],
      "expected_observables": [
        "dom:highlightSequenceComplete"
      ],
      "timeout": 2000
    },
    {
      "from": "S0_Idle",
      "to": "S7_GeneratingRandom",
      "event": "CLICK_RANDOM",
      "guard": "valueIsNumber('#randomCount')",
      "actions": [
        "captureInput('#randomCount')",
        "generateRandomTree(n)",
        "render()"
      ],
      "expected_observables": [
        "dom:#randomBtn:click",
        "dom:#randomCount:value"
      ],
      "timeout": 2000
    },
    {
      "from": "S0_Idle",
      "to": "S8_ClearingTree",
      "event": "CLICK_CLEAR",
      "guard": "true",
      "actions": [
        "root = null",
        "stopAnimations()",
        "render()"
      ],
      "expected_observables": [
        "dom:#clearBtn:click"
      ],
      "timeout": 500
    },
    {
      "from": "S0_Idle",
      "to": "S9_HighlightThenDelete",
      "event": "CLICK_SVG_NODE",
      "guard": "true",
      "actions": [
        "stopPropagation()",
        "highlightNodes([nodeRef], {color:var(--danger), duration:600})"
      ],
      "expected_observables": [
        "dom:#svgCanvas g[data-id]:click"
      ],
      "timeout": 1000
    },
    {
      "from": "S9_HighlightThenDelete",
      "to": "S0_Idle",
      "event": "ANIMATION_COMPLETE",
      "guard": "true",
      "actions": [
        "deleteNodeByRef(nodeRef)",
        "render()"
      ],
      "expected_observables": [
        "dom:highlightComplete",
        "dom:svg updated"
      ],
      "timeout": 1200
    },
    {
      "from": "S0_Idle",
      "to": "S10_NodeDetailsShown",
      "event": "DBLCLICK_SVG_NODE",
      "guard": "true",
      "actions": [
        "stopPropagation()",
        "alert('Node value: ...\\nLeft: ...\\nRight: ...')"
      ],
      "expected_observables": [
        "dom:#svgCanvas g[data-id]:dblclick",
        "dom:alert"
      ],
      "timeout": 500
    },
    {
      "from": "S10_NodeDetailsShown",
      "to": "S0_Idle",
      "event": "ALERT_DISMISSED",
      "guard": "true",
      "actions": [
        "dismissAlert()",
        "render()"
      ],
      "expected_observables": [
        "dom:alert:dismiss"
      ],
      "timeout": 200
    },
    {
      "from": "S0_Idle",
      "to": "S11_AnimationsStopped",
      "event": "CLICK_CLEAR_SEARCH",
      "guard": "true",
      "actions": [
        "stopAnimations()",
        "render()",
        "clearInput('#searchInput')"
      ],
      "expected_observables": [
        "dom:#clearSearchBtn:click"
      ],
      "timeout": 400
    },
    {
      "from": "S11_AnimationsStopped",
      "to": "S0_Idle",
      "event": "ANIMATION_COMPLETE",
      "guard": "true",
      "actions": [
        "render()"
      ],
      "expected_observables": [
        "dom:svg cleared highlights"
      ],
      "timeout": 200
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "TOGGLE_DUPLICATES",
      "guard": "true",
      "actions": [
        "toggle allowDuplicates (read '#dupToggle')"
      ],
      "expected_observables": [
        "dom:#dupToggle:change"
      ],
      "timeout": 100
    },
    {
      "from": "S0_Idle",
      "to": "S1_InsertingImmediate",
      "event": "CLICK_EXAMPLE1",
      "guard": "true",
      "actions": [
        "root = null",
        "insertBST(50,30,70,20,40,60,80)",
        "render()"
      ],
      "expected_observables": [
        "dom:#example1:click"
      ],
      "timeout": 1000
    },
    {
      "from": "S0_Idle",
      "to": "S1_InsertingImmediate",
      "event": "CLICK_EXAMPLE2",
      "guard": "true",
      "actions": [
        "root = null",
        "insertBST(5,10,15,20,25,30)",
        "render()"
      ],
      "expected_observables": [
        "dom:#example2:click"
      ],
      "timeout": 1000
    },
    {
      "from": "S0_Idle",
      "to": "S1_InsertingImmediate",
      "event": "CLICK_EXAMPLE3",
      "guard": "true",
      "actions": [
        "root = null",
        "insertBST(15,6,23,4,7,71,5,50)",
        "render()"
      ],
      "expected_observables": [
        "dom:#example3:click"
      ],
      "timeout": 1000
    },
    {
      "from": "S4_TraversalAnimating",
      "to": "S11_AnimationsStopped",
      "event": "CLICK_STOP_ANIM",
      "guard": "true",
      "actions": [
        "stopAnimations()",
        "render()"
      ],
      "expected_observables": [
        "dom:#stopAnimBtn:click"
      ],
      "timeout": 300
    },
    {
      "from": "S0_Idle",
      "to": "S11_AnimationsStopped",
      "event": "CLICK_SVG_CANVAS",
      "guard": "true",
      "actions": [
        "stopAnimations()",
        "render()"
      ],
      "expected_observables": [
        "dom:#svgCanvas:click"
      ],
      "timeout": 200
    }
  ],
  "components": [
    "#valueInput",
    "#insertBtn",
    "#deleteBtn",
    "#searchInput",
    "#searchBtn",
    "#clearSearchBtn",
    "#randomBtn",
    "#randomCount",
    "#clearBtn",
    "#inorderBtn",
    "#preorderBtn",
    "#postorderBtn",
    "#levelorderBtn",
    "#stopAnimBtn",
    "#stepInput",
    "#stepInsertBtn",
    "#skipStepBtn",
    "#dupToggle",
    "#status",
    "#example1",
    "#example2",
    "#example3",
    "#svgCanvas",
    "svg g[data-id]",
    ".nodeCircle",
    "text"
  ]
}