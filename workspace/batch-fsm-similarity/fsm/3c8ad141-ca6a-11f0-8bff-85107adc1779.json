{
  "meta": {
    "concept": "KMeansClustering",
    "topic": "K-Means Clustering Demo",
    "educational_goal": "Demonstrate K-Means clustering algorithm",
    "expected_interactions": [
      "add_points",
      "run_kmeans",
      "reset"
    ]
  },
  "states": [
    {
      "id": "S0_Idle",
      "label": "Idle",
      "type": "idle",
      "entry_actions": [
        "draw()"
      ],
      "exit_actions": []
    },
    {
      "id": "S1_AddingPoints",
      "label": "AddingPoints",
      "type": "atomic",
      "entry_actions": [
        "addPoint(event.clientX, event.clientY)"
      ],
      "exit_actions": [
        "draw()"
      ]
    },
    {
      "id": "S2_RunningKMeans",
      "label": "RunningKMeans",
      "type": "atomic",
      "entry_actions": [
        "runKMeans(k)"
      ],
      "exit_actions": [
        "draw()"
      ]
    },
    {
      "id": "S3_Resetting",
      "label": "Resetting",
      "type": "atomic",
      "entry_actions": [
        "resetData()"
      ],
      "exit_actions": [
        "draw()"
      ]
    },
    {
      "id": "S4_Error",
      "label": "Error",
      "type": "atomic",
      "entry_actions": [
        "showErrorMessage()"
      ],
      "exit_actions": [
        "clearErrorMessage()"
      ]
    }
  ],
  "events": [
    {
      "id": "USER_CLICKS_CANVAS",
      "event_type": "user_action",
      "description": "User clicks on the canvas to add a point"
    },
    {
      "id": "USER_CLICKS_RUN",
      "event_type": "user_action",
      "description": "User clicks the Run K-Means button"
    },
    {
      "id": "USER_CLICKS_RESET",
      "event_type": "user_action",
      "description": "User clicks the Reset button"
    },
    {
      "id": "ERROR_MAX_POINTS",
      "event_type": "system_event",
      "description": "Error: Maximum points exceeded"
    },
    {
      "id": "ERROR_INVALID_K",
      "event_type": "system_event",
      "description": "Error: Invalid number of clusters (K)"
    },
    {
      "id": "KMEANS_COMPLETED",
      "event_type": "system_event",
      "description": "K-Means clustering completed"
    }
  ],
  "transitions": [
    {
      "from": "S0_Idle",
      "to": "S1_AddingPoints",
      "event": "USER_CLICKS_CANVAS",
      "guard": "true",
      "actions": [
        "addPoint(event.clientX, event.clientY)"
      ],
      "expected_observables": [
        "dom:canvasClicked"
      ],
      "timeout": 500
    },
    {
      "from": "S1_AddingPoints",
      "to": "S0_Idle",
      "event": "USER_CLICKS_CANVAS",
      "guard": "pointsNotExceeded",
      "actions": [
        "draw()"
      ],
      "expected_observables": [
        "dom:pointAdded"
      ],
      "timeout": 500
    },
    {
      "from": "S0_Idle",
      "to": "S2_RunningKMeans",
      "event": "USER_CLICKS_RUN",
      "guard": "kIsValid",
      "actions": [
        "runKMeans(parseInt(kInput.value, 10))"
      ],
      "expected_observables": [
        "dom:runButtonClicked"
      ],
      "timeout": 1000
    },
    {
      "from": "S0_Idle",
      "to": "S3_Resetting",
      "event": "USER_CLICKS_RESET",
      "guard": "true",
      "actions": [
        "resetData()"
      ],
      "expected_observables": [
        "dom:resetButtonClicked"
      ],
      "timeout": 500
    },
    {
      "from": "S1_AddingPoints",
      "to": "S4_Error",
      "event": "ERROR_MAX_POINTS",
      "guard": "true",
      "actions": [
        "showErrorMessage('Maximum 500 points allowed.')"
      ],
      "expected_observables": [
        "dom:errorMessageShown"
      ],
      "timeout": 500
    },
    {
      "from": "S2_RunningKMeans",
      "to": "S4_Error",
      "event": "ERROR_INVALID_K",
      "guard": "true",
      "actions": [
        "showErrorMessage('K must be at least 1 and cannot exceed the number of points.')"
      ],
      "expected_observables": [
        "dom:errorMessageShown"
      ],
      "timeout": 500
    },
    {
      "from": "S2_RunningKMeans",
      "to": "S0_Idle",
      "event": "KMEANS_COMPLETED",
      "guard": "true",
      "actions": [
        "draw()"
      ],
      "expected_observables": [
        "dom:kMeansCompleted"
      ],
      "timeout": 1000
    },
    {
      "from": "S3_Resetting",
      "to": "S0_Idle",
      "event": "KMEANS_COMPLETED",
      "guard": "true",
      "actions": [
        "draw()"
      ],
      "expected_observables": [
        "dom:resetCompleted"
      ],
      "timeout": 500
    },
    {
      "from": "S4_Error",
      "to": "S0_Idle",
      "event": "USER_CLICKS_RESET",
      "guard": "true",
      "actions": [
        "clearErrorMessage()"
      ],
      "expected_observables": [
        "dom:errorMessageCleared"
      ],
      "timeout": 500
    }
  ],
  "components": [
    "canvas",
    "kInput",
    "runBtn",
    "resetBtn",
    "info"
  ],
  "triggers": [
    "#canvas",
    "#kInput",
    "#runBtn",
    "#resetBtn"
  ]
}