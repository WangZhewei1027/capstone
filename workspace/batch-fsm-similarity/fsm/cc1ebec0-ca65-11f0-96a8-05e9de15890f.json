{
  "meta": {
    "concept": "TopologicalSort",
    "topic": "Topological Sort Visualizer (Kahn & DFS)",
    "educational_goal": "Interactive visualization of topological sorting using Kahn's algorithm (BFS) and DFS-based topological sort; demonstrate node/edge editing, cycle detection, and algorithm stepping/auto-play.",
    "expected_interactions": [
      "edit_graph",
      "generate_random_dag",
      "clear_graph",
      "kahn_initialize",
      "kahn_step",
      "kahn_auto",
      "kahn_finish",
      "kahn_reset",
      "dfs_start",
      "dfs_step",
      "dfs_auto",
      "dfs_finish",
      "dfs_reset",
      "drag_node"
    ]
  },
  "states": [
    {
      "id": "S0_Idle",
      "label": "Idle",
      "type": "idle",
      "entry_actions": [
        "drawGraph()",
        "updateInfoPanels()",
        "setMode(null)"
      ],
      "exit_actions": []
    },
    {
      "id": "S1_AddNodeMode",
      "label": "AddNodeMode",
      "type": "atomic",
      "entry_actions": [
        "setMode('addNode')",
        "highlightButton('#addNodeBtn')",
        "drawGraph(currentHighlights())"
      ],
      "exit_actions": [
        "setMode(null)",
        "drawGraph(currentHighlights())"
      ]
    },
    {
      "id": "S2_AddEdgeMode_SelectSource",
      "label": "AddEdge_SelectSource",
      "type": "atomic",
      "entry_actions": [
        "setMode('addEdge')",
        "selectedNodeForEdge = null",
        "drawGraph(currentHighlights())"
      ],
      "exit_actions": []
    },
    {
      "id": "S3_AddEdgeMode_SelectTarget",
      "label": "AddEdge_SelectTarget",
      "type": "atomic",
      "entry_actions": [
        "selectedNodeForEdge = <nodeId>",
        "drawGraph(currentHighlights())"
      ],
      "exit_actions": [
        "selectedNodeForEdge = null",
        "drawGraph()",
        "updateInfoPanels()"
      ]
    },
    {
      "id": "S4_RemoveNodeMode",
      "label": "RemoveNodeMode",
      "type": "atomic",
      "entry_actions": [
        "setMode('removeNode')",
        "highlightButton('#removeNodeBtn')",
        "drawGraph(currentHighlights())"
      ],
      "exit_actions": [
        "setMode(null)",
        "drawGraph(currentHighlights())"
      ]
    },
    {
      "id": "S5_RemoveEdgeMode",
      "label": "RemoveEdgeMode",
      "type": "atomic",
      "entry_actions": [
        "setMode('removeEdge')",
        "selectedNodeForEdge = null",
        "drawGraph(currentHighlights())"
      ],
      "exit_actions": [
        "setMode(null)",
        "selectedNodeForEdge = null",
        "drawGraph(currentHighlights())"
      ]
    },
    {
      "id": "S6_DraggingNode",
      "label": "DraggingNode",
      "type": "atomic",
      "entry_actions": [
        "selectedDragNode = <nodeId>",
        "startDragTracking()",
        "drawGraph(currentHighlights())"
      ],
      "exit_actions": [
        "selectedDragNode = null",
        "stopDragTracking()",
        "updateInfoPanels()"
      ]
    },
    {
      "id": "S7_RandomDAG_Generating",
      "label": "RandomDAG_Generating",
      "type": "atomic",
      "entry_actions": [
        "generateRandomDAG(parseInt(#rndNodes.value), parseFloat(#rndDensity.value))",
        "drawGraph()",
        "updateInfoPanels()",
        "setMode(null)"
      ],
      "exit_actions": []
    },
    {
      "id": "S8_ClearingGraph",
      "label": "ClearingGraph",
      "type": "atomic",
      "entry_actions": [
        "nodes = []",
        "edges = []",
        "nextNodeId = 0",
        "drawGraph()",
        "updateInfoPanels()",
        "setMode(null)"
      ],
      "exit_actions": []
    },
    {
      "id": "S9_Kahn_Idle",
      "label": "Kahn_Idle",
      "type": "idle",
      "entry_actions": [
        "resetKahn()",
        "drawGraph(currentHighlights())"
      ],
      "exit_actions": []
    },
    {
      "id": "S10_Kahn_Initialized",
      "label": "Kahn_Initialized",
      "type": "atomic",
      "entry_actions": [
        "initializeKahn()",
        "updateKahnUI()",
        "kahnStepBtn.disabled = false",
        "kahnAutoBtn.disabled = false",
        "kahnFinishBtn.disabled = false",
        "drawGraph(currentHighlights())"
      ],
      "exit_actions": []
    },
    {
      "id": "S11_Kahn_Stepping",
      "label": "Kahn_Stepping",
      "type": "atomic",
      "entry_actions": [
        "stepKahn()",
        "updateKahnUI()",
        "drawGraph(currentHighlights())"
      ],
      "exit_actions": []
    },
    {
      "id": "S12_Kahn_AutoRunning",
      "label": "Kahn_AutoRunning",
      "type": "atomic",
      "entry_actions": [
        "kahnState.timer = setInterval(stepKahn, parseInt(#speedKahn.value))",
        "kahnAutoBtn.textContent = 'Stop'"
      ],
      "exit_actions": [
        "clearInterval(kahnState.timer)",
        "kahnState.timer = null",
        "kahnAutoBtn.textContent = 'Auto'"
      ]
    },
    {
      "id": "S13_Kahn_Finished_Success",
      "label": "Kahn_Finished_Success",
      "type": "final",
      "entry_actions": [
        "drawGraph(currentHighlights())",
        "kahnQueue.textContent = '[]'",
        "kahnOutput.textContent = kahnState.output.join(' ➜ ')",
        "alert('Kahn: Topological order found:\\n' + kahnState.output.join(' -> '))",
        "kahnStepBtn.disabled = true",
        "kahnAutoBtn.disabled = true",
        "kahnFinishBtn.disabled = true"
      ],
      "exit_actions": []
    },
    {
      "id": "S14_Kahn_CycleDetected",
      "label": "Kahn_CycleDetected",
      "type": "atomic",
      "entry_actions": [
        "drawGraph({cycleSet: <cycleNodes>, cycleEdges: <cycleEdges>})",
        "kahnQueue.textContent = '[]'",
        "kahnOutput.textContent = kahnState.output.join(' ➜ ')",
        "alert('Kahn: Cycle detected — no topological ordering exists.')",
        "kahnStepBtn.disabled = true",
        "kahnAutoBtn.disabled = true",
        "kahnFinishBtn.disabled = true"
      ],
      "exit_actions": []
    },
    {
      "id": "S15_Kahn_Resetting",
      "label": "Kahn_Resetting",
      "type": "atomic",
      "entry_actions": [
        "resetKahn()"
      ],
      "exit_actions": [
        "drawGraph(currentHighlights())"
      ]
    },
    {
      "id": "S16_DFS_Idle",
      "label": "DFS_Idle",
      "type": "idle",
      "entry_actions": [
        "resetDfs()",
        "drawGraph(currentHighlights())"
      ],
      "exit_actions": []
    },
    {
      "id": "S17_DFS_Initialized",
      "label": "DFS_Initialized",
      "type": "atomic",
      "entry_actions": [
        "initializeDfs()",
        "dfsAutoBtn.disabled = false",
        "dfsFinishBtn.disabled = false",
        "drawGraph(currentHighlights())"
      ],
      "exit_actions": []
    },
    {
      "id": "S18_DFS_Stepping",
      "label": "DFS_Stepping",
      "type": "atomic",
      "entry_actions": [
        "stepDfs()",
        "dfsOutput.textContent = dfsState.output.join(' ← ')",
        "drawGraph(currentHighlights())"
      ],
      "exit_actions": []
    },
    {
      "id": "S19_DFS_AutoRunning",
      "label": "DFS_AutoRunning",
      "type": "atomic",
      "entry_actions": [
        "dfsState.timer = setInterval(stepDfs, parseInt(#speedDfs.value))",
        "dfsAutoBtn.textContent = 'Stop'"
      ],
      "exit_actions": [
        "clearInterval(dfsState.timer)",
        "dfsState.timer = null",
        "dfsAutoBtn.textContent = 'Auto'"
      ]
    },
    {
      "id": "S20_DFS_Finished",
      "label": "DFS_Finished",
      "type": "final",
      "entry_actions": [
        "dfsOutput.textContent = dfsState.output.join(' ← ') || '(empty)'",
        "if(!dfsState.cycleDetected) { alert('DFS: Topological order (one possible):\\n' + [...dfsState.output].reverse().join(' -> ')); }",
        "dfsAutoBtn.disabled = true",
        "dfsFinishBtn.disabled = true",
        "drawGraph(currentHighlights())"
      ],
      "exit_actions": []
    },
    {
      "id": "S21_DFS_CycleDetected",
      "label": "DFS_CycleDetected",
      "type": "atomic",
      "entry_actions": [
        "drawGraph({cycleSet: new Set(dfsState.cycleNodes), cycleEdges: dfsState.cycleEdges})",
        "dfsOutput.textContent = dfsState.output.join(' ← ')",
        "alert('DFS: Cycle detected.')",
        "dfsAutoBtn.disabled = true",
        "dfsFinishBtn.disabled = true"
      ],
      "exit_actions": []
    },
    {
      "id": "S22_DFS_Resetting",
      "label": "DFS_Resetting",
      "type": "atomic",
      "entry_actions": [
        "resetDfs()"
      ],
      "exit_actions": [
        "drawGraph(currentHighlights())"
      ]
    }
  ],
  "events": [
    {
      "id": "CLICK_ADD_NODE",
      "event_type": "user_action",
      "description": "User clicks Add Node button (#addNodeBtn)"
    },
    {
      "id": "CLICK_ADD_EDGE",
      "event_type": "user_action",
      "description": "User clicks Add Edge button (#addEdgeBtn)"
    },
    {
      "id": "CLICK_REMOVE_NODE",
      "event_type": "user_action",
      "description": "User clicks Delete Node button (#removeNodeBtn)"
    },
    {
      "id": "CLICK_REMOVE_EDGE",
      "event_type": "user_action",
      "description": "User clicks Delete Edge button (#removeEdgeBtn)"
    },
    {
      "id": "CLICK_RANDOM_DAG",
      "event_type": "user_action",
      "description": "User clicks Generate Random DAG (#randomDagBtn)"
    },
    {
      "id": "CLICK_CLEAR",
      "event_type": "user_action",
      "description": "User clicks Clear All (#clearBtn)"
    },
    {
      "id": "INPUT_RND_DENSITY",
      "event_type": "user_action",
      "description": "User adjusts Edge density range input (#rndDensity)"
    },
    {
      "id": "SVG_CLICK",
      "event_type": "user_action",
      "description": "User clicks on the SVG canvas (#svg)"
    },
    {
      "id": "SVG_DBLCLICK",
      "event_type": "user_action",
      "description": "User double-clicks on the SVG canvas (#svg)"
    },
    {
      "id": "NODE_CLICK",
      "event_type": "user_action",
      "description": "User clicks a node element (svg g[data-id])"
    },
    {
      "id": "EDGE_CLICK",
      "event_type": "user_action",
      "description": "User clicks an edge path (svg g[data-edge-index] path)"
    },
    {
      "id": "NODE_MOUSEDOWN",
      "event_type": "user_action",
      "description": "User presses mouse down on a node (svg g[data-id]) to start drag"
    },
    {
      "id": "MOUSE_MOVE_WINDOW",
      "event_type": "user_action",
      "description": "Mouse move on window for dragging (windowmousemove listener)"
    },
    {
      "id": "MOUSE_UP_WINDOW",
      "event_type": "user_action",
      "description": "Mouse up on window to end drag (windowmouseup listener)"
    },
    {
      "id": "CLICK_KAHN_START",
      "event_type": "user_action",
      "description": "User clicks Kahn Initialize button (#kahnStartBtn)"
    },
    {
      "id": "CLICK_KAHN_STEP",
      "event_type": "user_action",
      "description": "User clicks Kahn Step button (#kahnStepBtn)"
    },
    {
      "id": "CLICK_KAHN_AUTO",
      "event_type": "user_action",
      "description": "User clicks Kahn Auto button (#kahnAutoBtn)"
    },
    {
      "id": "CLICK_KAHN_FINISH",
      "event_type": "user_action",
      "description": "User clicks Kahn Finish button (#kahnFinishBtn)"
    },
    {
      "id": "CLICK_KAHN_RESET",
      "event_type": "user_action",
      "description": "User clicks Kahn Reset button (#kahnResetBtn)"
    },
    {
      "id": "KAHN_TIMER_TICK",
      "event_type": "system_event",
      "description": "Kahn auto timer tick (setInterval)"
    },
    {
      "id": "KAHN_STEP_RESULT",
      "event_type": "system_event",
      "description": "Result of stepKahn: more_steps | finished_success | cycle_detected"
    },
    {
      "id": "CLICK_DFS_START",
      "event_type": "user_action",
      "description": "User clicks DFS Start button (#dfsStartBtn)"
    },
    {
      "id": "CLICK_DFS_AUTO",
      "event_type": "user_action",
      "description": "User clicks DFS Auto button (#dfsAutoBtn)"
    },
    {
      "id": "CLICK_DFS_FINISH",
      "event_type": "user_action",
      "description": "User clicks DFS Finish button (#dfsFinishBtn)"
    },
    {
      "id": "CLICK_DFS_RESET",
      "event_type": "user_action",
      "description": "User clicks DFS Reset button (#dfsResetBtn)"
    },
    {
      "id": "DFS_TIMER_TICK",
      "event_type": "system_event",
      "description": "DFS auto timer tick (setInterval)"
    },
    {
      "id": "DFS_STEP_RESULT",
      "event_type": "system_event",
      "description": "Result of stepDfs: continue | finished | cycle_detected"
    }
  ],
  "transitions": [
    {
      "from": "S0_Idle",
      "to": "S1_AddNodeMode",
      "event": "CLICK_ADD_NODE",
      "guard": "true",
      "actions": [
        "setMode('addNode')",
        "addNodeBtn.classList.add('active')",
        "drawGraph(currentHighlights())"
      ],
      "expected_observables": [
        "dom:#addNodeBtn:click",
        "dom:setMode"
      ],
      "timeout": 1000,
      "triggers": "#addNodeBtn"
    },
    {
      "from": "S1_AddNodeMode",
      "to": "S1_AddNodeMode",
      "event": "SVG_CLICK",
      "guard": "mode==='addNode'",
      "actions": [
        "createNodeAtSvgCoords(svg click)",
        "drawGraph()",
        "updateInfoPanels()"
      ],
      "expected_observables": [
        "dom:#svg:click",
        "dom:new node in DOM (svg g[data-id])"
      ],
      "timeout": 500,
      "triggers": "#svg"
    },
    {
      "from": "S1_AddNodeMode",
      "to": "S0_Idle",
      "event": "SVG_DBLCLICK",
      "guard": "true",
      "actions": [
        "setMode(null)",
        "drawGraph(currentHighlights())"
      ],
      "expected_observables": [
        "dom:#svg:dblclick",
        "dom:modeCleared (.modeBtn.active removed)"
      ],
      "timeout": 200,
      "triggers": "#svg"
    },
    {
      "from": "S0_Idle",
      "to": "S2_AddEdgeMode_SelectSource",
      "event": "CLICK_ADD_EDGE",
      "guard": "true",
      "actions": [
        "setMode('addEdge')",
        "selectedNodeForEdge = null",
        "drawGraph(currentHighlights())"
      ],
      "expected_observables": [
        "dom:#addEdgeBtn:click",
        "dom:mode set to addEdge"
      ],
      "timeout": 1000,
      "triggers": "#addEdgeBtn"
    },
    {
      "from": "S2_AddEdgeMode_SelectSource",
      "to": "S3_AddEdgeMode_SelectTarget",
      "event": "NODE_CLICK",
      "guard": "mode==='addEdge' && selectedNodeForEdge==null",
      "actions": [
        "selectedNodeForEdge = <clickedNodeId>",
        "drawGraph(currentHighlights())"
      ],
      "expected_observables": [
        "dom:svg g[data-id]:click",
        "dom:selectedNodeForEdge set (visual stroke change)"
      ],
      "timeout": 200,
      "triggers": "svg g[data-id]"
    },
    {
      "from": "S3_AddEdgeMode_SelectTarget",
      "to": "S2_AddEdgeMode_SelectSource",
      "event": "NODE_CLICK",
      "guard": "mode==='addEdge' && selectedNodeForEdge!==null",
      "actions": [
        "if(clickedNodeId !== selectedNodeForEdge) { if(!edges.some(e=>e.from===selectedNodeForEdge && e.to===clickedNodeId)) edges.push({from:selectedNodeForEdge,to:clickedNodeId}); }",
        "selectedNodeForEdge = null",
        "drawGraph()",
        "updateInfoPanels()"
      ],
      "expected_observables": [
        "dom:svg g[data-id]:click",
        "dom:new edge appears in DOM (svg g[data-edge-index] path)",
        "dom:adjacency updated (#adjPre)"
      ],
      "timeout": 500,
      "triggers": "svg g[data-id]"
    },
    {
      "from": "S3_AddEdgeMode_SelectTarget",
      "to": "S2_AddEdgeMode_SelectSource",
      "event": "SVG_CLICK",
      "guard": "mode==='addEdge' && selectedNodeForEdge!==null",
      "actions": [
        "selectedNodeForEdge = null",
        "drawGraph(currentHighlights())"
      ],
      "expected_observables": [
        "dom:#svg:click",
        "dom:selectedNodeForEdge cleared"
      ],
      "timeout": 200,
      "triggers": "#svg"
    },
    {
      "from": "S0_Idle",
      "to": "S4_RemoveNodeMode",
      "event": "CLICK_REMOVE_NODE",
      "guard": "true",
      "actions": [
        "setMode('removeNode')",
        "drawGraph(currentHighlights())"
      ],
      "expected_observables": [
        "dom:#removeNodeBtn:click",
        "dom:mode set to removeNode"
      ],
      "timeout": 200,
      "triggers": "#removeNodeBtn"
    },
    {
      "from": "S4_RemoveNodeMode",
      "to": "S4_RemoveNodeMode",
      "event": "NODE_CLICK",
      "guard": "mode==='removeNode'",
      "actions": [
        "nodes = nodes.filter(x=>x.id !== clickedNodeId)",
        "edges = edges.filter(e => e.from !== clickedNodeId && e.to !== clickedNodeId)",
        "drawGraph()",
        "updateInfoPanels()"
      ],
      "expected_observables": [
        "dom:svg g[data-id]:click",
        "dom:node removed from DOM",
        "dom:adjacency updated (#adjPre)"
      ],
      "timeout": 300,
      "triggers": "svg g[data-id]"
    },
    {
      "from": "S0_Idle",
      "to": "S5_RemoveEdgeMode",
      "event": "CLICK_REMOVE_EDGE",
      "guard": "true",
      "actions": [
        "setMode('removeEdge')",
        "drawGraph(currentHighlights())"
      ],
      "expected_observables": [
        "dom:#removeEdgeBtn:click"
      ],
      "timeout": 200,
      "triggers": "#removeEdgeBtn"
    },
    {
      "from": "S5_RemoveEdgeMode",
      "to": "S5_RemoveEdgeMode",
      "event": "EDGE_CLICK",
      "guard": "mode==='removeEdge'",
      "actions": [
        "edges.splice(<clickedEdgeIndex>,1)",
        "drawGraph()",
        "updateInfoPanels()"
      ],
      "expected_observables": [
        "dom:svg g[data-edge-index] path:click",
        "dom:edge removed from DOM",
        "dom:adjacency updated (#adjPre)"
      ],
      "timeout": 300,
      "triggers": "svg g[data-edge-index] path"
    },
    {
      "from": "S0_Idle",
      "to": "S6_DraggingNode",
      "event": "NODE_MOUSEDOWN",
      "guard": "mode===null",
      "actions": [
        "selectedDragNode = <clickedNodeId>",
        "start tracking mouse movements",
        "drawGraph(currentHighlights())"
      ],
      "expected_observables": [
        "dom:svg g[data-id]:mousedown",
        "dom:selectedDragNode set"
      ],
      "timeout": 0,
      "triggers": "svg g[data-id]"
    },
    {
      "from": "S6_DraggingNode",
      "to": "S6_DraggingNode",
      "event": "MOUSE_MOVE_WINDOW",
      "guard": "selectedDragNode!==null",
      "actions": [
        "update node position to current mouse svg coords",
        "drawGraph(currentHighlights())"
      ],
      "expected_observables": [
        "dom:window:mousemove",
        "dom:svg g[data-id] transform attribute updated"
      ],
      "timeout": 0,
      "triggers": "window"
    },
    {
      "from": "S6_DraggingNode",
      "to": "S0_Idle",
      "event": "MOUSE_UP_WINDOW",
      "guard": "selectedDragNode!==null",
      "actions": [
        "selectedDragNode = null",
        "updateInfoPanels()",
        "drawGraph(currentHighlights())"
      ],
      "expected_observables": [
        "dom:window:mouseup",
        "dom:node final position persisted (#adjPre/#indegPre update)"
      ],
      "timeout": 200,
      "triggers": "window"
    },
    {
      "from": "S0_Idle",
      "to": "S7_RandomDAG_Generating",
      "event": "CLICK_RANDOM_DAG",
      "guard": "true",
      "actions": [
        "generateRandomDAG()",
        "drawGraph()",
        "updateInfoPanels()",
        "setMode(null)"
      ],
      "expected_observables": [
        "dom:#randomDagBtn:click",
        "dom:nodes and edges created",
        "dom:#adjPre and #indegPre updated"
      ],
      "timeout": 2000,
      "triggers": "#randomDagBtn"
    },
    {
      "from": "S7_RandomDAG_Generating",
      "to": "S0_Idle",
      "event": "RANDOM_GENERATION_COMPLETE",
      "guard": "true",
      "actions": [
        "drawGraph()",
        "updateInfoPanels()",
        "setMode(null)"
      ],
      "expected_observables": [
        "dom:nodes/edges present in svg"
      ],
      "timeout": 100,
      "triggers": "#randomDagBtn"
    },
    {
      "from": "S0_Idle",
      "to": "S8_ClearingGraph",
      "event": "CLICK_CLEAR",
      "guard": "true",
      "actions": [
        "nodes=[]",
        "edges=[]",
        "nextNodeId=0",
        "drawGraph()",
        "updateInfoPanels()",
        "setMode(null)"
      ],
      "expected_observables": [
        "dom:#clearBtn:click",
        "dom:svg cleared",
        "dom:#adjPre and #indegPre show (empty)"
      ],
      "timeout": 500,
      "triggers": "#clearBtn"
    },
    {
      "from": "S8_ClearingGraph",
      "to": "S0_Idle",
      "event": "CLEAR_COMPLETE",
      "guard": "true",
      "actions": [
        "drawGraph()",
        "updateInfoPanels()"
      ],
      "expected_observables": [
        "dom:svg empty",
        "dom:#adjPre becomes (empty)"
      ],
      "timeout": 100,
      "triggers": "#clearBtn"
    },
    {
      "from": "S0_Idle",
      "to": "S10_Kahn_Initialized",
      "event": "CLICK_KAHN_START",
      "guard": "nodes.length>0",
      "actions": [
        "initializeKahn()",
        "updateKahnUI()",
        "kahnStepBtn.disabled=false",
        "kahnAutoBtn.disabled=false",
        "kahnFinishBtn.disabled=false",
        "drawGraph(currentHighlights())"
      ],
      "expected_observables": [
        "dom:#kahnStartBtn:click",
        "dom:#kahnQueue updated",
        "dom:#kahnOutput updated"
      ],
      "timeout": 500,
      "triggers": "#kahnStartBtn"
    },
    {
      "from": "S10_Kahn_Initialized",
      "to": "S11_Kahn_Stepping",
      "event": "CLICK_KAHN_STEP",
      "guard": "kahnState && kahnState.active",
      "actions": [
        "stepKahn()",
        "updateKahnUI()",
        "drawGraph(currentHighlights())"
      ],
      "expected_observables": [
        "dom:#kahnStepBtn:click",
        "dom:#kahnQueue updated",
        "dom:#kahnOutput updated",
        "dom:edge visuals changed (edgeRemovedSet)"
      ],
      "timeout": 1500,
      "triggers": "#kahnStepBtn"
    },
    {
      "from": "S11_Kahn_Stepping",
      "to": "S10_Kahn_Initialized",
      "event": "KAHN_STEP_RESULT",
      "guard": "result==='more_steps'",
      "actions": [
        "updateKahnUI()",
        "drawGraph(currentHighlights())"
      ],
      "expected_observables": [
        "dom:#kahnQueue updated",
        "dom:#kahnOutput updated"
      ],
      "timeout": 500,
      "triggers": "#kahnStepBtn"
    },
    {
      "from": "S11_Kahn_Stepping",
      "to": "S13_Kahn_Finished_Success",
      "event": "KAHN_STEP_RESULT",
      "guard": "result==='finished_success'",
      "actions": [
        "finalizeKahnSuccess()",
        "drawGraph(currentHighlights())"
      ],
      "expected_observables": [
        "dom:alert shown with order",
        "dom:#kahnOutput final value"
      ],
      "timeout": 1000,
      "triggers": "#kahnStepBtn"
    },
    {
      "from": "S11_Kahn_Stepping",
      "to": "S14_Kahn_CycleDetected",
      "event": "KAHN_STEP_RESULT",
      "guard": "result==='cycle_detected'",
      "actions": [
        "highlightCycleNodesAndEdges()",
        "drawGraph({cycleSet:<nodes>, cycleEdges:<edges>})"
      ],
      "expected_observables": [
        "dom:alert about cycle",
        "dom:nodes highlighted red",
        "dom:edges highlighted red"
      ],
      "timeout": 1000,
      "triggers": "#kahnStepBtn"
    },
    {
      "from": "S10_Kahn_Initialized",
      "to": "S12_Kahn_AutoRunning",
      "event": "CLICK_KAHN_AUTO",
      "guard": "kahnState && !kahnState.timer",
      "actions": [
        "kahnState.timer = setInterval(()=>{ if(!stepKahn()) { clearInterval(kahnState.timer); kahnState.timer=null; kahnAutoBtn.textContent='Auto'; } }, parseInt(speedKahn.value))",
        "kahnAutoBtn.textContent = 'Stop'"
      ],
      "expected_observables": [
        "dom:#kahnAutoBtn:click",
        "dom:kahn timer started"
      ],
      "timeout": 200,
      "triggers": "#kahnAutoBtn"
    },
    {
      "from": "S12_Kahn_AutoRunning",
      "to": "S10_Kahn_Initialized",
      "event": "CLICK_KAHN_AUTO",
      "guard": "kahnState && kahnState.timer",
      "actions": [
        "clearInterval(kahnState.timer)",
        "kahnState.timer = null",
        "kahnAutoBtn.textContent = 'Auto'"
      ],
      "expected_observables": [
        "dom:#kahnAutoBtn:click",
        "dom:kahn timer stopped"
      ],
      "timeout": 200,
      "triggers": "#kahnAutoBtn"
    },
    {
      "from": "S10_Kahn_Initialized",
      "to": "S13_Kahn_Finished_Success",
      "event": "CLICK_KAHN_FINISH",
      "guard": "kahnState && kahnState.active",
      "actions": [
        "while(stepKahn()){}",
        "drawGraph(currentHighlights())"
      ],
      "expected_observables": [
        "dom:#kahnFinishBtn:click",
        "dom:alert with order or cycle"
      ],
      "timeout": 5000,
      "triggers": "#kahnFinishBtn"
    },
    {
      "from": "S10_Kahn_Initialized",
      "to": "S15_Kahn_Resetting",
      "event": "CLICK_KAHN_RESET",
      "guard": "true",
      "actions": [
        "resetKahn()"
      ],
      "expected_observables": [
        "dom:#kahnResetBtn:click",
        "dom:kahn UI cleared (#kahnQueue/#kahnOutput)"
      ],
      "timeout": 300,
      "triggers": "#kahnResetBtn"
    },
    {
      "from": "S15_Kahn_Resetting",
      "to": "S9_Kahn_Idle",
      "event": "KAHN_RESET_COMPLETE",
      "guard": "true",
      "actions": [
        "drawGraph(currentHighlights())"
      ],
      "expected_observables": [
        "dom:#kahnQueue cleared",
        "dom:#kahnOutput cleared"
      ],
      "timeout": 200,
      "triggers": "#kahnResetBtn"
    },
    {
      "from": "S0_Idle",
      "to": "S17_DFS_Initialized",
      "event": "CLICK_DFS_START",
      "guard": "nodes.length>0",
      "actions": [
        "initializeDfs()",
        "dfsAutoBtn.disabled=false",
        "dfsFinishBtn.disabled=false",
        "drawGraph(currentHighlights())"
      ],
      "expected_observables": [
        "dom:#dfsStartBtn:click",
        "dom:#dfsOutput cleared/started"
      ],
      "timeout": 500,
      "triggers": "#dfsStartBtn"
    },
    {
      "from": "S17_DFS_Initialized",
      "to": "S18_DFS_Stepping",
      "event": "CLICK_DFS_AUTO",
      "guard": "dfsState && !dfsState.timer",
      "actions": [
        "dfsState.timer = setInterval(()=>{ if(!stepDfs()){ clearInterval(dfsState.timer); dfsState.timer=null; dfsAutoBtn.textContent='Auto'; } }, parseInt(speedDfs.value))",
        "dfsAutoBtn.textContent = 'Stop'"
      ],
      "expected_observables": [
        "dom:#dfsAutoBtn:click",
        "dom:dfs timer started",
        "dom:#dfsOutput updating"
      ],
      "timeout": 200,
      "triggers": "#dfsAutoBtn"
    },
    {
      "from": "S18_DFS_Stepping",
      "to": "S17_DFS_Initialized",
      "event": "DFS_STEP_RESULT",
      "guard": "result==='continue'",
      "actions": [
        "drawGraph(currentHighlights())",
        "dfsOutput.textContent = dfsState.output.join(' ← ')"
      ],
      "expected_observables": [
        "dom:#dfsOutput updating",
        "dom:nodes colored gray/black"
      ],
      "timeout": 500,
      "triggers": "#dfsStartBtn,#dfsAutoBtn"
    },
    {
      "from": "S18_DFS_Stepping",
      "to": "S20_DFS_Finished",
      "event": "DFS_STEP_RESULT",
      "guard": "result==='finished'",
      "actions": [
        "drawGraph(currentHighlights())",
        "dfsOutput.textContent = dfsState.output.join(' ← ')",
        "alert('DFS finished; topological order shown')"
      ],
      "expected_observables": [
        "dom:alert with order",
        "dom:#dfsOutput final value"
      ],
      "timeout": 1000,
      "triggers": "#dfsFinishBtn"
    },
    {
      "from": "S18_DFS_Stepping",
      "to": "S21_DFS_CycleDetected",
      "event": "DFS_STEP_RESULT",
      "guard": "result==='cycle_detected'",
      "actions": [
        "drawGraph({cycleSet:new Set(dfsState.cycleNodes), cycleEdges: dfsState.cycleEdges})",
        "dfsOutput.textContent = dfsState.output.join(' ← ')",
        "alert('DFS: Cycle detected.')"
      ],
      "expected_observables": [
        "dom:alert about cycle",
        "dom:nodes and edges highlighted red"
      ],
      "timeout": 1000,
      "triggers": "#dfsStartBtn"
    },
    {
      "from": "S17_DFS_Initialized",
      "to": "S20_DFS_Finished",
      "event": "CLICK_DFS_FINISH",
      "guard": "dfsState && dfsState.active",
      "actions": [
        "while(stepDfs()){}",
        "drawGraph(currentHighlights())"
      ],
      "expected_observables": [
        "dom:#dfsFinishBtn:click",
        "dom:alert with order or cycle"
      ],
      "timeout": 5000,
      "triggers": "#dfsFinishBtn"
    },
    {
      "from": "S17_DFS_Initialized",
      "to": "S22_DFS_Resetting",
      "event": "CLICK_DFS_RESET",
      "guard": "true",
      "actions": [
        "resetDfs()"
      ],
      "expected_observables": [
        "dom:#dfsResetBtn:click",
        "dom:#dfsOutput cleared"
      ],
      "timeout": 300,
      "triggers": "#dfsResetBtn"
    },
    {
      "from": "S22_DFS_Resetting",
      "to": "S16_DFS_Idle",
      "event": "DFS_RESET_COMPLETE",
      "guard": "true",
      "actions": [
        "drawGraph(currentHighlights())"
      ],
      "expected_observables": [
        "dom:#dfsOutput cleared",
        "dom:node colors reset"
      ],
      "timeout": 200,
      "triggers": "#dfsResetBtn"
    },
    {
      "from": "S2_AddEdgeMode_SelectSource",
      "to": "S0_Idle",
      "event": "SVG_DBLCLICK",
      "guard": "true",
      "actions": [
        "setMode(null)",
        "selectedNodeForEdge = null",
        "drawGraph(currentHighlights())"
      ],
      "expected_observables": [
        "dom:#svg:dblclick",
        "dom:mode cleared"
      ],
      "timeout": 200,
      "triggers": "#svg"
    }
  ],
  "components": [
    "#addNodeBtn",
    ".modeBtn#addNodeBtn",
    "#addEdgeBtn",
    ".modeBtn#addEdgeBtn",
    "#removeNodeBtn",
    ".modeBtn#removeNodeBtn",
    "#removeEdgeBtn",
    ".modeBtn#removeEdgeBtn",
    "#randomDagBtn",
    ".smallBtn#randomDagBtn",
    "#clearBtn",
    ".smallBtn#clearBtn",
    "#rndNodes",
    "#rndDensity",
    "#densityLabel",
    "#kahnStartBtn",
    "#kahnStepBtn",
    "#kahnAutoBtn",
    "#kahnFinishBtn",
    "#kahnResetBtn",
    "#speedKahn",
    "#kahnQueue",
    "#kahnOutput",
    "#dfsStartBtn",
    "#dfsAutoBtn",
    "#dfsFinishBtn",
    "#dfsResetBtn",
    "#speedDfs",
    "#dfsOutput",
    "#adjPre",
    "#indegPre",
    "#svg",
    "#svgArea",
    "svg g[data-id]",
    "svg g[data-edge-index] path",
    ".modeBtn",
    ".smallBtn",
    ".listBox",
    "#left",
    "#canvasWrap"
  ]
}