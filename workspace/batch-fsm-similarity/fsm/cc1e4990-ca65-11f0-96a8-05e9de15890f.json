{
  "meta": {
    "concept": "BreadthFirstSearch",
    "topic": "Breadth-First Search (BFS) Visualizer",
    "educational_goal": "Interactive visualization of BFS on a 2D grid showing frontier, visited order, queue, and shortest path reconstruction",
    "expected_interactions": [
      "play",
      "pause",
      "step",
      "restart",
      "randomize_walls",
      "clear_walls",
      "toggle_wall",
      "drag_draw_walls",
      "set_start",
      "set_goal",
      "change_grid_size",
      "change_speed",
      "keyboard_shortcuts"
    ]
  },
  "states": [
    {
      "id": "S0_Idle",
      "label": "Idle",
      "type": "idle",
      "entry_actions": [
        "updateAll()",
        "enableControls()",
        "ensureTimerStopped()"
      ],
      "exit_actions": []
    },
    {
      "id": "S1_Running",
      "label": "Running",
      "type": "atomic",
      "entry_actions": [
        "isRunning = true",
        "playBtn.textContent = 'Pause'",
        "playBtn.classList.add('active')",
        "startTimer(Number(speedRange.value))"
      ],
      "exit_actions": [
        "isRunning = false",
        "clearInterval(timer)",
        "playBtn.textContent = 'Play'",
        "playBtn.classList.remove('active')"
      ]
    },
    {
      "id": "S2_Stepping",
      "label": "Stepping",
      "type": "atomic",
      "entry_actions": [
        "step()"
      ],
      "exit_actions": [
        "refreshQueueUI()",
        "updateStats()"
      ]
    },
    {
      "id": "S3_Finished",
      "label": "Finished",
      "type": "atomic",
      "entry_actions": [
        "finished = true",
        "stopTimer()",
        "reconstructPathIfNeeded()",
        "updateStats()"
      ],
      "exit_actions": [
        "finished = false",
        "restartBFSIfRequested()"
      ]
    },
    {
      "id": "S4_BuildingGrid",
      "label": "BuildingGrid",
      "type": "atomic",
      "entry_actions": [
        "buildGrid(rows, cols)",
        "updateAll()"
      ],
      "exit_actions": []
    },
    {
      "id": "S5_ModeWall",
      "label": "ModeWall",
      "type": "atomic",
      "entry_actions": [
        "setMode('wall')",
        "modeWallBtn.classList.add('active')"
      ],
      "exit_actions": [
        "modeWallBtn.classList.remove('active')"
      ]
    },
    {
      "id": "S6_ModeStart",
      "label": "ModeStart",
      "type": "atomic",
      "entry_actions": [
        "setMode('start')",
        "modeStartBtn.classList.add('active')"
      ],
      "exit_actions": [
        "modeStartBtn.classList.remove('active')"
      ]
    },
    {
      "id": "S7_ModeGoal",
      "label": "ModeGoal",
      "type": "atomic",
      "entry_actions": [
        "setMode('goal')",
        "modeGoalBtn.classList.add('active')"
      ],
      "exit_actions": [
        "modeGoalBtn.classList.remove('active')"
      ]
    },
    {
      "id": "S8_DraggingWalls",
      "label": "DraggingWalls",
      "type": "atomic",
      "entry_actions": [
        "mouseDown = true",
        "enableDragDrawing()"
      ],
      "exit_actions": [
        "mouseDown = false",
        "disableDragDrawing()"
      ]
    },
    {
      "id": "S9_Randomizing",
      "label": "RandomizingWalls",
      "type": "atomic",
      "entry_actions": [
        "randomizeWalls()",
        "restartBFS()",
        "updateAll()"
      ],
      "exit_actions": []
    },
    {
      "id": "S10_Clearing",
      "label": "ClearingWalls",
      "type": "atomic",
      "entry_actions": [
        "grid.fill(0)",
        "restartBFS()",
        "updateAll()"
      ],
      "exit_actions": []
    },
    {
      "id": "S11_ReconstructingPath",
      "label": "ReconstructingPath",
      "type": "atomic",
      "entry_actions": [
        "reconstructPath(endIdx)",
        "markPathVisuals()",
        "updateStats()"
      ],
      "exit_actions": []
    }
  ],
  "events": [
    {
      "id": "PLAY_CLICK",
      "event_type": "user_action",
      "description": "User clicks the Play / Pause button (#playBtn)"
    },
    {
      "id": "STEP_CLICK",
      "event_type": "user_action",
      "description": "User clicks the Step button (#stepBtn)"
    },
    {
      "id": "RESET_CLICK",
      "event_type": "user_action",
      "description": "User clicks the Restart button (#resetBtn)"
    },
    {
      "id": "RANDOM_CLICK",
      "event_type": "user_action",
      "description": "User clicks the Random Walls button (#randomBtn)"
    },
    {
      "id": "CLEAR_CLICK",
      "event_type": "user_action",
      "description": "User clicks the Clear Walls button (#clearBtn)"
    },
    {
      "id": "SPEED_CHANGE",
      "event_type": "user_action",
      "description": "User changes the speed range control (#speedRange)"
    },
    {
      "id": "GRID_SIZE_CHANGE",
      "event_type": "user_action",
      "description": "User changes grid size select (#gridSize)"
    },
    {
      "id": "MODE_SELECT_WALL",
      "event_type": "user_action",
      "description": "User selects Wall mode (#modeWall)"
    },
    {
      "id": "MODE_SELECT_START",
      "event_type": "user_action",
      "description": "User selects Set Start mode (#modeStart)"
    },
    {
      "id": "MODE_SELECT_GOAL",
      "event_type": "user_action",
      "description": "User selects Set Goal mode (#modeGoal)"
    },
    {
      "id": "CELL_CLICK",
      "event_type": "user_action",
      "description": "User clicks a grid cell (.cell). Behavior depends on current mode"
    },
    {
      "id": "CELL_DRAG",
      "event_type": "user_action",
      "description": "User drags over cells to draw walls (#gridContainer mousemove over .cell with mouseDown)"
    },
    {
      "id": "TIMER_TICK",
      "event_type": "system_event",
      "description": "Timer tick triggers automatic step (setInterval)"
    },
    {
      "id": "BFS_STEP_COMPLETE",
      "event_type": "system_event",
      "description": "A BFS step completed; may cause finished state if goal reached or queue empty"
    },
    {
      "id": "BFS_FINISHED",
      "event_type": "system_event",
      "description": "BFS finished (goal reached and path reconstructed or no path)"
    },
    {
      "id": "KEY_SPACE",
      "event_type": "user_action",
      "description": "User presses Space (body keydown) to toggle play"
    },
    {
      "id": "KEY_S",
      "event_type": "user_action",
      "description": "User presses 's' (body keydown) to step"
    },
    {
      "id": "KEY_R",
      "event_type": "user_action",
      "description": "User presses 'r' (body keydown) to restart"
    },
    {
      "id": "KEY_C",
      "event_type": "user_action",
      "description": "User presses 'c' (body keydown) to clear walls"
    },
    {
      "id": "KEY_M",
      "event_type": "user_action",
      "description": "User presses 'm' (body keydown) to toggle mode between wall and start"
    }
  ],
  "transitions": [
    {
      "from": "S0_Idle",
      "to": "S1_Running",
      "event": "PLAY_CLICK",
      "guard": "finished === false && !isRunning",
      "actions": [
        "isRunning = true",
        "startTimer(Number(speedRange.value))",
        "playBtn.textContent = 'Pause'",
        "playBtn.classList.add('active')"
      ],
      "triggers": "#playBtn",
      "timeout": 0
    },
    {
      "from": "S1_Running",
      "to": "S0_Idle",
      "event": "PLAY_CLICK",
      "guard": "isRunning === true",
      "actions": [
        "stop()",
        "clearInterval(timer)",
        "playBtn.textContent = 'Play'",
        "playBtn.classList.remove('active')"
      ],
      "triggers": "#playBtn",
      "timeout": 0
    },
    {
      "from": "S3_Finished",
      "to": "S1_Running",
      "event": "PLAY_CLICK",
      "guard": "true",
      "actions": [
        "restartBFS()",
        "isRunning = true",
        "startTimer(Number(speedRange.value))",
        "playBtn.textContent = 'Pause'",
        "playBtn.classList.add('active')"
      ],
      "triggers": "#playBtn",
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S2_Stepping",
      "event": "STEP_CLICK",
      "guard": "isRunning === false && finished === false",
      "actions": [
        "step()"
      ],
      "triggers": "#stepBtn",
      "timeout": 0
    },
    {
      "from": "S2_Stepping",
      "to": "S0_Idle",
      "event": "BFS_STEP_COMPLETE",
      "guard": "step returned false (not finished)",
      "actions": [
        "refreshQueueUI()",
        "updateStats()"
      ],
      "triggers": "#stepBtn",
      "timeout": 0
    },
    {
      "from": "S2_Stepping",
      "to": "S3_Finished",
      "event": "BFS_STEP_COMPLETE",
      "guard": "step returned true (finished)",
      "actions": [
        "finished = true",
        "stop()",
        "updateStats()"
      ],
      "triggers": "#stepBtn",
      "timeout": 0
    },
    {
      "from": "S1_Running",
      "to": "S1_Running",
      "event": "TIMER_TICK",
      "guard": "isRunning === true && finished === false",
      "actions": [
        "const done = step()",
        "if(done) { finished = true; stop(); }"
      ],
      "triggers": "internal setInterval (driven by #speedRange value)",
      "timeout": 0
    },
    {
      "from": "S1_Running",
      "to": "S3_Finished",
      "event": "BFS_FINISHED",
      "guard": "true",
      "actions": [
        "finished = true",
        "stop()",
        "reconstructPathIfNeeded()",
        "updateStats()"
      ],
      "triggers": "internal (step -> finished)",
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S4_BuildingGrid",
      "event": "GRID_SIZE_CHANGE",
      "guard": "true",
      "actions": [
        "buildGrid(Number(gridSizeSelect.value), Number(gridSizeSelect.value))",
        "updateAll()"
      ],
      "triggers": "#gridSize",
      "timeout": 1000
    },
    {
      "from": "S4_BuildingGrid",
      "to": "S0_Idle",
      "event": "GRID_BUILT",
      "guard": "true",
      "actions": [
        "startBFS()",
        "updateAll()"
      ],
      "triggers": "#gridSize",
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S9_Randomizing",
      "event": "RANDOM_CLICK",
      "guard": "true",
      "actions": [
        "randomizeWalls()",
        "restartBFS()",
        "updateAll()"
      ],
      "triggers": "#randomBtn",
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S10_Clearing",
      "event": "CLEAR_CLICK",
      "guard": "true",
      "actions": [
        "grid.fill(0)",
        "restartBFS()",
        "updateAll()"
      ],
      "triggers": "#clearBtn",
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S5_ModeWall",
      "event": "MODE_SELECT_WALL",
      "guard": "true",
      "actions": [
        "setMode('wall')",
        "modeWallBtn.classList.add('active')",
        "modeStartBtn.classList.remove('active')",
        "modeGoalBtn.classList.remove('active')"
      ],
      "triggers": "#modeWall",
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S6_ModeStart",
      "event": "MODE_SELECT_START",
      "guard": "true",
      "actions": [
        "setMode('start')",
        "modeStartBtn.classList.add('active')",
        "modeWallBtn.classList.remove('active')",
        "modeGoalBtn.classList.remove('active')"
      ],
      "triggers": "#modeStart",
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S7_ModeGoal",
      "event": "MODE_SELECT_GOAL",
      "guard": "true",
      "actions": [
        "setMode('goal')",
        "modeGoalBtn.classList.add('active')",
        "modeWallBtn.classList.remove('active')",
        "modeStartBtn.classList.remove('active')"
      ],
      "triggers": "#modeGoal",
      "timeout": 0
    },
    {
      "from": "S5_ModeWall",
      "to": "S5_ModeWall",
      "event": "CELL_CLICK",
      "guard": "mode === 'wall' && isRunning === false",
      "actions": [
        "toggleWall(i)",
        "startBFS()",
        "updateAll()"
      ],
      "triggers": ".cell",
      "timeout": 0
    },
    {
      "from": "S5_ModeWall",
      "to": "S5_ModeWall",
      "event": "CELL_CLICK",
      "guard": "mode === 'wall' && isRunning === true",
      "actions": [
        "toggleWall(i)",
        "restartBFS()",
        "updateCellVisual(i)"
      ],
      "triggers": ".cell",
      "timeout": 0
    },
    {
      "from": "S6_ModeStart",
      "to": "S6_ModeStart",
      "event": "CELL_CLICK",
      "guard": "mode === 'start'",
      "actions": [
        "if(i === idx(goal.r,goal.c)) return",
        "start = {r,c}",
        "grid[i] = 0",
        "if(isRunning) restartBFS() else startBFS()",
        "updateAll()"
      ],
      "triggers": ".cell",
      "timeout": 0
    },
    {
      "from": "S7_ModeGoal",
      "to": "S7_ModeGoal",
      "event": "CELL_CLICK",
      "guard": "mode === 'goal'",
      "actions": [
        "if(i === idx(start.r,start.c)) return",
        "goal = {r,c}",
        "grid[i] = 0",
        "if(isRunning) restartBFS() else startBFS()",
        "updateAll()"
      ],
      "triggers": ".cell",
      "timeout": 0
    },
    {
      "from": "S5_ModeWall",
      "to": "S8_DraggingWalls",
      "event": "CELL_DRAG",
      "guard": "mode === 'wall' && mouseDown === true",
      "actions": [
        "toggleWall(i)",
        "if(isRunning) restartBFS() else startBFS()",
        "updateCellVisual(i)"
      ],
      "triggers": "#gridContainer .cell",
      "timeout": 0
    },
    {
      "from": "S8_DraggingWalls",
      "to": "S5_ModeWall",
      "event": "mouse_up",
      "guard": "mouseDown === false",
      "actions": [
        "stopDrag()"
      ],
      "triggers": "document,body",
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "RESET_CLICK",
      "guard": "true",
      "actions": [
        "restartBFS()",
        "updateAll()"
      ],
      "triggers": "#resetBtn",
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "SPEED_CHANGE",
      "guard": "isRunning === false",
      "actions": [
        "update timer interval value (no running timer to change)"
      ],
      "triggers": "#speedRange",
      "timeout": 0
    },
    {
      "from": "S1_Running",
      "to": "S1_Running",
      "event": "SPEED_CHANGE",
      "guard": "isRunning === true",
      "actions": [
        "clearInterval(timer)",
        "timer = setInterval(()=>{ const done = step(); if(done) stop(); }, Number(speedRange.value))"
      ],
      "triggers": "#speedRange",
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S1_Running",
      "event": "KEY_SPACE",
      "guard": "finished === false",
      "actions": [
        "play()"
      ],
      "triggers": "body",
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S2_Stepping",
      "event": "KEY_S",
      "guard": "true",
      "actions": [
        "stepBtn.click()"
      ],
      "triggers": "body",
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "KEY_R",
      "guard": "true",
      "actions": [
        "resetBtn.click()"
      ],
      "triggers": "body",
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S10_Clearing",
      "event": "KEY_C",
      "guard": "true",
      "actions": [
        "clearBtn.click()"
      ],
      "triggers": "body",
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S6_ModeStart",
      "event": "KEY_M",
      "guard": "true",
      "actions": [
        "setMode(mode === 'wall' ? 'start' : 'wall')"
      ],
      "triggers": "body",
      "timeout": 0
    },
    {
      "from": "S1_Running",
      "to": "S1_Running",
      "event": "CELL_CLICK",
      "guard": "mode === 'wall' && isRunning === true",
      "actions": [
        "toggleWall(i)",
        "restartBFS()",
        "updateCellVisual(i)"
      ],
      "triggers": ".cell",
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S11_ReconstructingPath",
      "event": "BFS_FINISHED",
      "guard": "goal reached",
      "actions": [
        "reconstructPath(cur)",
        "lastDistance = computeDistance(cur)",
        "updateStats()"
      ],
      "triggers": "internal (step -> goal detected)",
      "timeout": 0
    }
  ],
  "components": [
    "#playBtn",
    "#stepBtn",
    "#resetBtn",
    "#randomBtn",
    "#clearBtn",
    "#speedRange",
    "#gridSize",
    "#modeWall",
    "#modeStart",
    "#modeGoal",
    "#gridContainer",
    ".grid",
    ".cell",
    ".mode-btn",
    ".mode-btn.active",
    ".btn",
    ".btn.primary",
    "#queue",
    "#stats"
  ]
}