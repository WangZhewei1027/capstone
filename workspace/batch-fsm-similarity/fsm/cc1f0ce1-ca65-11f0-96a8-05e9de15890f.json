{
  "meta": {
    "concept": "SlidingWindow",
    "topic": "Sliding Window Visualizer",
    "educational_goal": "Demonstrate fixed-size and variable-size sliding window techniques and longest-unique-substring via interactive stepping and playback",
    "expected_interactions": [
      "change_mode",
      "apply_array",
      "random_array",
      "apply_string",
      "random_string",
      "change_k",
      "change_target",
      "play",
      "pause",
      "step",
      "back",
      "reset",
      "change_speed"
    ]
  },
  "states": [
    {
      "id": "S0_Idle",
      "label": "Idle",
      "type": "idle",
      "entry_actions": [
        "render()"
      ],
      "exit_actions": []
    },
    {
      "id": "S1_Building",
      "label": "BuildingSteps",
      "type": "atomic",
      "entry_actions": [
        "build()"
      ],
      "exit_actions": [
        "render()"
      ]
    },
    {
      "id": "S2_Playing",
      "label": "Playing",
      "type": "atomic",
      "entry_actions": [
        "play()",
        "setInterval(timerTick, speed)"
      ],
      "exit_actions": [
        "pause()",
        "clearInterval(playTimer)"
      ]
    },
    {
      "id": "S3_Paused",
      "label": "Paused",
      "type": "atomic",
      "entry_actions": [
        "pause()"
      ],
      "exit_actions": []
    },
    {
      "id": "S4_StepAction",
      "label": "StepForward",
      "type": "atomic",
      "entry_actions": [
        "nextStep()"
      ],
      "exit_actions": [
        "render()"
      ]
    },
    {
      "id": "S5_BackAction",
      "label": "StepBack",
      "type": "atomic",
      "entry_actions": [
        "prevStep()"
      ],
      "exit_actions": [
        "render()"
      ]
    },
    {
      "id": "S6_Resetting",
      "label": "Resetting",
      "type": "atomic",
      "entry_actions": [
        "current = 0",
        "render()"
      ],
      "exit_actions": []
    },
    {
      "id": "S7_ErrorAlert",
      "label": "ErrorAlert",
      "type": "atomic",
      "entry_actions": [
        "alert('Invalid array input: use comma separated numbers')"
      ],
      "exit_actions": []
    },
    {
      "id": "S8_ModeFixed",
      "label": "ModeFixed",
      "type": "atomic",
      "entry_actions": [
        "setMode('fixed')"
      ],
      "exit_actions": []
    },
    {
      "id": "S9_ModeMinLen",
      "label": "ModeMinLen",
      "type": "atomic",
      "entry_actions": [
        "setMode('minlen')"
      ],
      "exit_actions": []
    },
    {
      "id": "S10_ModeUnique",
      "label": "ModeUnique",
      "type": "atomic",
      "entry_actions": [
        "setMode('unique')"
      ],
      "exit_actions": []
    }
  ],
  "events": [
    {
      "id": "SELECT_MODE_CHANGED",
      "event_type": "user_action",
      "description": "User changes algorithm mode via select #mode",
      "triggers": "#mode"
    },
    {
      "id": "CLICK_APPLY_ARRAY",
      "event_type": "user_action",
      "description": "User clicks Apply button for array",
      "triggers": "#apply-array"
    },
    {
      "id": "CLICK_RANDOM_ARRAY",
      "event_type": "user_action",
      "description": "User clicks Random Gen for array",
      "triggers": "#random-array"
    },
    {
      "id": "CLICK_APPLY_STRING",
      "event_type": "user_action",
      "description": "User clicks Apply button for string",
      "triggers": "#apply-string"
    },
    {
      "id": "CLICK_RANDOM_STRING",
      "event_type": "user_action",
      "description": "User clicks Random string generator",
      "triggers": "#random-string"
    },
    {
      "id": "INPUT_K_CHANGED",
      "event_type": "user_action",
      "description": "User changes window size k input",
      "triggers": "#k"
    },
    {
      "id": "INPUT_TARGET_CHANGED",
      "event_type": "user_action",
      "description": "User changes target sum input",
      "triggers": "#target"
    },
    {
      "id": "CLICK_PLAY",
      "event_type": "user_action",
      "description": "User clicks Play/Pause button",
      "triggers": "#play"
    },
    {
      "id": "CLICK_STEP",
      "event_type": "user_action",
      "description": "User clicks Step button",
      "triggers": "#step"
    },
    {
      "id": "CLICK_BACK",
      "event_type": "user_action",
      "description": "User clicks Back button",
      "triggers": "#back"
    },
    {
      "id": "CLICK_RESET",
      "event_type": "user_action",
      "description": "User clicks Reset button",
      "triggers": "#reset"
    },
    {
      "id": "INPUT_SPEED_CHANGED",
      "event_type": "user_action",
      "description": "User changes playback speed slider",
      "triggers": "#speed"
    },
    {
      "id": "TIMER_TICK",
      "event_type": "system_event",
      "description": "Playback interval tick (play timer)"
    },
    {
      "id": "BUILD_COMPLETE",
      "event_type": "system_event",
      "description": "build() produced steps and is ready"
    },
    {
      "id": "INVALID_ARRAY_INPUT",
      "event_type": "system_event",
      "description": "Array parse failed (non-number present) when clicking Apply",
      "triggers": "#apply-array, #array-input"
    },
    {
      "id": "ALERT_DISMISSED",
      "event_type": "user_action",
      "description": "User dismisses browser alert after invalid input",
      "triggers": "#array-input"
    },
    {
      "id": "STEPS_EXHAUSTED",
      "event_type": "system_event",
      "description": "Playback reached last step"
    }
  ],
  "transitions": [
    {
      "from": "S0_Idle",
      "to": "S1_Building",
      "event": "SELECT_MODE_CHANGED",
      "guard": "true",
      "actions": [
        "setMode(document.getElementById('mode').value)",
        "build()"
      ],
      "triggers": "#mode",
      "timeout": 100
    },
    {
      "from": "S0_Idle",
      "to": "S1_Building",
      "event": "CLICK_APPLY_ARRAY",
      "guard": "arrayInput not empty and valid numbers",
      "actions": [
        "parse array from #array-input",
        "arr = parsedArray",
        "build()"
      ],
      "triggers": "#apply-array,#array-input",
      "timeout": 300
    },
    {
      "from": "S0_Idle",
      "to": "S7_ErrorAlert",
      "event": "INVALID_ARRAY_INPUT",
      "guard": "array contains NaN",
      "actions": [
        "alert('Invalid array input: use comma separated numbers')"
      ],
      "triggers": "#apply-array,#array-input",
      "timeout": 100
    },
    {
      "from": "S7_ErrorAlert",
      "to": "S0_Idle",
      "event": "ALERT_DISMISSED",
      "guard": "true",
      "actions": [
        "focus #array-input"
      ],
      "triggers": "#array-input",
      "timeout": 50
    },
    {
      "from": "S0_Idle",
      "to": "S1_Building",
      "event": "CLICK_RANDOM_ARRAY",
      "guard": "true",
      "actions": [
        "generate random arr, set #array-input value",
        "build()"
      ],
      "triggers": "#random-array",
      "timeout": 200
    },
    {
      "from": "S0_Idle",
      "to": "S1_Building",
      "event": "CLICK_APPLY_STRING",
      "guard": "string input not empty",
      "actions": [
        "s = document.getElementById('string-input').value",
        "build()"
      ],
      "triggers": "#apply-string,#string-input",
      "timeout": 200
    },
    {
      "from": "S0_Idle",
      "to": "S1_Building",
      "event": "CLICK_RANDOM_STRING",
      "guard": "true",
      "actions": [
        "generate random string, set #string-input value",
        "build()"
      ],
      "triggers": "#random-string",
      "timeout": 200
    },
    {
      "from": "S0_Idle",
      "to": "S1_Building",
      "event": "INPUT_K_CHANGED",
      "guard": "true",
      "actions": [
        "k = Math.max(1, parseInt(#k.value)||1)",
        "build()"
      ],
      "triggers": "#k",
      "timeout": 150
    },
    {
      "from": "S0_Idle",
      "to": "S1_Building",
      "event": "INPUT_TARGET_CHANGED",
      "guard": "true",
      "actions": [
        "target = Math.max(1, parseInt(#target.value)||1)",
        "build()"
      ],
      "triggers": "#target",
      "timeout": 150
    },
    {
      "from": "S0_Idle",
      "to": "S2_Playing",
      "event": "CLICK_PLAY",
      "guard": "playTimer == null && steps.length > 0",
      "actions": [
        "play()"
      ],
      "triggers": "#play",
      "timeout": 50
    },
    {
      "from": "S2_Playing",
      "to": "S3_Paused",
      "event": "CLICK_PLAY",
      "guard": "playTimer != null",
      "actions": [
        "pause()"
      ],
      "triggers": "#play",
      "timeout": 50
    },
    {
      "from": "S3_Paused",
      "to": "S2_Playing",
      "event": "CLICK_PLAY",
      "guard": "playTimer == null && steps.length > 0",
      "actions": [
        "play()"
      ],
      "triggers": "#play",
      "timeout": 50
    },
    {
      "from": "S0_Idle",
      "to": "S4_StepAction",
      "event": "CLICK_STEP",
      "guard": "true",
      "actions": [
        "nextStep()"
      ],
      "triggers": "#step",
      "timeout": 50
    },
    {
      "from": "S0_Idle",
      "to": "S5_BackAction",
      "event": "CLICK_BACK",
      "guard": "true",
      "actions": [
        "prevStep()"
      ],
      "triggers": "#back",
      "timeout": 50
    },
    {
      "from": "S0_Idle",
      "to": "S6_Resetting",
      "event": "CLICK_RESET",
      "guard": "true",
      "actions": [
        "current = 0",
        "render()"
      ],
      "triggers": "#reset",
      "timeout": 50
    },
    {
      "from": "S2_Playing",
      "to": "S2_Playing",
      "event": "INPUT_SPEED_CHANGED",
      "guard": "true",
      "actions": [
        "speed = parseInt(#speed.value)",
        "if(playTimer) { pause(); play(); }"
      ],
      "triggers": "#speed",
      "timeout": 50
    },
    {
      "from": "S2_Playing",
      "to": "S2_Playing",
      "event": "TIMER_TICK",
      "guard": "current < steps.length - 1",
      "actions": [
        "current++",
        "render()"
      ],
      "triggers": "",
      "timeout": 0
    },
    {
      "from": "S2_Playing",
      "to": "S3_Paused",
      "event": "TIMER_TICK",
      "guard": "current >= steps.length - 1",
      "actions": [
        "pause()"
      ],
      "triggers": "",
      "timeout": 0
    },
    {
      "from": "S1_Building",
      "to": "S0_Idle",
      "event": "BUILD_COMPLETE",
      "guard": "steps.length >= 0",
      "actions": [
        "render()"
      ],
      "triggers": "",
      "timeout": 10
    }
  ],
  "components": [
    "#mode",
    "#array-input",
    "#apply-array",
    "#random-array",
    "#string-input",
    "#apply-string",
    "#random-string",
    "#k",
    "#target",
    "#play",
    "#step",
    "#back",
    "#reset",
    "#speed",
    "#array-card",
    "#string-card",
    "#k-card",
    "#target-card",
    "#array-visual",
    "#stats",
    "#pseudocode",
    "#explain",
    ".ghost",
    ".cell",
    ".cell .val",
    ".cell .idx",
    ".cell.window",
    ".cell.best",
    ".cell.left",
    ".cell.right",
    ".stat",
    ".pseudocode .line",
    ".pseudocode .line.active"
  ]
}