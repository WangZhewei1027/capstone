{
  "meta": {
    "concept": "PrimAlgorithm",
    "topic": "Prim's Algorithm Visualizer",
    "educational_goal": "Visualize Prim's algorithm step-by-step for Minimum Spanning Tree (MST) with interactive controls (generate graph, choose start node, step/auto-run, drag nodes).",
    "expected_interactions": [
      "generate",
      "reset",
      "choose_start",
      "step",
      "auto_run",
      "drag_node",
      "hover_edge_node",
      "adjust_parameters"
    ]
  },
  "states": [
    {
      "id": "S0_Idle_NoStart",
      "label": "Idle_NoStart",
      "type": "idle",
      "entry_actions": [
        "renderGraph()",
        "refreshVisual()",
        "updateLabels()",
        "ensureTimersCleared()"
      ],
      "exit_actions": []
    },
    {
      "id": "S1_ChoosingStart",
      "label": "ChoosingStart",
      "type": "atomic",
      "entry_actions": [
        "state.wantChooseStart=true",
        "selectStartBtn.textContent='Click a node...'"
      ],
      "exit_actions": [
        "state.wantChooseStart=false",
        "selectStartBtn.textContent='Choose Start Node'"
      ]
    },
    {
      "id": "S2_Ready_WithStart",
      "label": "Ready_WithStart",
      "type": "atomic",
      "entry_actions": [
        "setStartNode(startNodeId)",
        "refreshVisual()",
        "updatePQUI()"
      ],
      "exit_actions": []
    },
    {
      "id": "S3_Stepping",
      "label": "Stepping",
      "type": "atomic",
      "entry_actions": [
        "stepPrim()",
        "state.running=true",
        "refreshVisual()"
      ],
      "exit_actions": [
        "state.selectedEdge=null",
        "refreshVisual()"
      ]
    },
    {
      "id": "S4_AutoRunning",
      "label": "AutoRunning",
      "type": "atomic",
      "entry_actions": [
        "state.auto=true",
        "autoRunBtn.textContent='Pause'",
        "startAutoTimer(Math.max(80, speedInput.value))"
      ],
      "exit_actions": [
        "state.auto=false",
        "autoRunBtn.textContent='Auto Run'",
        "clearInterval(state.timer)"
      ]
    },
    {
      "id": "S5_Resetting_Alg",
      "label": "Resetting_Alg",
      "type": "atomic",
      "entry_actions": [
        "resetAlgorithm()",
        "refreshVisual()"
      ],
      "exit_actions": []
    },
    {
      "id": "S6_Generating_Graph",
      "label": "Generating_Graph",
      "type": "atomic",
      "entry_actions": [
        "makeGraph(parseInt(nodeCount.value), density.value/100, parseInt(maxWeight.value))"
      ],
      "exit_actions": []
    },
    {
      "id": "S7_Done_MST",
      "label": "Done_MST",
      "type": "final",
      "entry_actions": [
        "state.running=false",
        "state.auto=false",
        "clearInterval(state.timer)",
        "highlightCompletion()"
      ],
      "exit_actions": []
    },
    {
      "id": "S8_Error_Disconnected",
      "label": "Error_Disconnected",
      "type": "atomic",
      "entry_actions": [
        "state.running=false",
        "state.auto=false",
        "clearInterval(state.timer)",
        "alert('Priority queue empty. Graph might be disconnected.')"
      ],
      "exit_actions": []
    },
    {
      "id": "S9_Dragging_Node",
      "label": "Dragging_Node",
      "type": "atomic",
      "entry_actions": [
        "node.el.style.cursor='grabbing'",
        "beginDrag(nodeId)"
      ],
      "exit_actions": [
        "node.el.style.cursor='grab'",
        "endDrag(nodeId)",
        "refreshVisual()"
      ]
    }
  ],
  "events": [
    {
      "id": "CLICK_GENERATE",
      "event_type": "user_action",
      "description": "User clicks the Generate button to create a new random graph",
      "triggers": "#regen"
    },
    {
      "id": "CLICK_RESET",
      "event_type": "user_action",
      "description": "User clicks the Reset button to clear MST / reset algorithm",
      "triggers": "#clear, button.ghost"
    },
    {
      "id": "CLICK_CHOOSE_START",
      "event_type": "user_action",
      "description": "User clicks the Choose Start Node button to enable picking a start node",
      "triggers": "#selectStart"
    },
    {
      "id": "CLICK_AUTO_RUN",
      "event_type": "user_action",
      "description": "User toggles Auto Run (start/pause)",
      "triggers": "#autoRun"
    },
    {
      "id": "CLICK_STEP",
      "event_type": "user_action",
      "description": "User clicks Step to advance Prim by one extraction",
      "triggers": "#stepBtn"
    },
    {
      "id": "INPUT_NODECOUNT",
      "event_type": "user_action",
      "description": "User adjusts number of nodes slider",
      "triggers": "#nodeCount"
    },
    {
      "id": "INPUT_DENSITY",
      "event_type": "user_action",
      "description": "User adjusts density slider",
      "triggers": "#density"
    },
    {
      "id": "INPUT_MAXWEIGHT",
      "event_type": "user_action",
      "description": "User adjusts max weight slider",
      "triggers": "#maxWeight"
    },
    {
      "id": "INPUT_SPEED",
      "event_type": "user_action",
      "description": "User adjusts speed slider (affects auto-run interval)",
      "triggers": "#speed"
    },
    {
      "id": "CLICK_CANVAS_BLANK",
      "event_type": "user_action",
      "description": "User clicks blank area of the SVG canvas (used to cancel choosing start)",
      "triggers": "#svgCanvas"
    },
    {
      "id": "NODE_CLICK",
      "event_type": "user_action",
      "description": "User clicks a node (SVG group element) - used to choose start node",
      "triggers": "svg g[data-id]"
    },
    {
      "id": "NODE_MOUSEDOWN",
      "event_type": "user_action",
      "description": "User starts dragging a node (mousedown on node group)",
      "triggers": "svg g[data-id]"
    },
    {
      "id": "NODE_MOUSEUP",
      "event_type": "user_action",
      "description": "User releases mouse after dragging (window mouseup)",
      "triggers": "window (mouseup bound in script)"
    },
    {
      "id": "NODE_MOUSEMOVE",
      "event_type": "user_action",
      "description": "Mouse moves during dragging (window mousemove)",
      "triggers": "window (mousemove bound in script)"
    },
    {
      "id": "EDGE_HOVER",
      "event_type": "user_action",
      "description": "User hovers over an edge line to show tooltip",
      "triggers": "svg line[data-id]"
    },
    {
      "id": "EDGE_LEAVE",
      "event_type": "user_action",
      "description": "User stops hovering an edge to hide tooltip",
      "triggers": "svg line[data-id], #tooltip"
    },
    {
      "id": "GRAPH_GENERATED",
      "event_type": "system_event",
      "description": "Graph generation completed (makeGraph finished)",
      "triggers": "#svgCanvas, svg line[data-id], svg g[data-id]"
    },
    {
      "id": "ALGO_STEP_COMPLETE",
      "event_type": "system_event",
      "description": "A single Prim step completed and UI updated (pq/mst changed)",
      "triggers": "#pqList, #mstWeight, #visitedList, #mstEdges"
    },
    {
      "id": "ALGO_FINISHED",
      "event_type": "system_event",
      "description": "MST complete: all nodes included",
      "triggers": "#mstWeight, #visitedList"
    },
    {
      "id": "PQ_EMPTY_DETECTED",
      "event_type": "system_event",
      "description": "Priority queue became empty while algorithm not complete (disconnected)",
      "triggers": "#pqList"
    },
    {
      "id": "AUTO_TIMER_TICK",
      "event_type": "system_event",
      "description": "Auto-run timer fired and invoked a stepPrim()",
      "triggers": "#speed"
    }
  ],
  "transitions": [
    {
      "from": "S0_Idle_NoStart",
      "to": "S6_Generating_Graph",
      "event": "CLICK_GENERATE",
      "guard": "true",
      "actions": [
        "makeGraph(parseInt(nodeCountInput.value), densityInput.value/100, parseInt(maxWeightInput.value))"
      ],
      "expected_observables": [
        "dom:#svgCanvas svg g[data-id]",
        "dom:#pqList",
        "dom:#mstWeight"
      ],
      "timeout": 5000,
      "triggers": "#regen"
    },
    {
      "from": "S6_Generating_Graph",
      "to": "S0_Idle_NoStart",
      "event": "GRAPH_GENERATED",
      "guard": "true",
      "actions": [
        "refreshVisual()",
        "updateLabels()"
      ],
      "expected_observables": [
        "dom:svg g[data-id]",
        "dom:svg line[data-id]"
      ],
      "timeout": 2000,
      "triggers": "svg g[data-id], svg line[data-id]"
    },
    {
      "from": "S0_Idle_NoStart",
      "to": "S1_ChoosingStart",
      "event": "CLICK_CHOOSE_START",
      "guard": "true",
      "actions": [
        "state.wantChooseStart=true",
        "selectStartBtn.textContent='Click a node...'"
      ],
      "expected_observables": [
        "dom:#selectStart"
      ],
      "timeout": 200,
      "triggers": "#selectStart"
    },
    {
      "from": "S1_ChoosingStart",
      "to": "S0_Idle_NoStart",
      "event": "CLICK_CHOOSE_START",
      "guard": "state.wantChooseStart===true",
      "actions": [
        "state.wantChooseStart=false",
        "selectStartBtn.textContent='Choose Start Node'"
      ],
      "expected_observables": [
        "dom:#selectStart"
      ],
      "timeout": 200,
      "triggers": "#selectStart"
    },
    {
      "from": "S1_ChoosingStart",
      "to": "S2_Ready_WithStart",
      "event": "NODE_CLICK",
      "guard": "state.wantChooseStart===true",
      "actions": [
        "setStartNode(parseInt(eventTarget.getAttribute('data-id')))",
        "state.wantChooseStart=false",
        "selectStartBtn.textContent='Choose Start Node'",
        "refreshVisual()"
      ],
      "expected_observables": [
        "dom:#visitedList",
        "dom:#pqList",
        "dom:#mstWeight"
      ],
      "timeout": 1000,
      "triggers": "svg g[data-id]"
    },
    {
      "from": "S1_ChoosingStart",
      "to": "S0_Idle_NoStart",
      "event": "CLICK_CANVAS_BLANK",
      "guard": "state.wantChooseStart===true",
      "actions": [
        "state.wantChooseStart=false",
        "selectStartBtn.textContent='Choose Start Node'"
      ],
      "expected_observables": [
        "dom:#selectStart"
      ],
      "timeout": 200,
      "triggers": "#svgCanvas"
    },
    {
      "from": "S0_Idle_NoStart",
      "to": "S0_Idle_NoStart",
      "event": "INPUT_NODECOUNT",
      "guard": "true",
      "actions": [
        "nodeCountLabel.textContent = nodeCountInput.value"
      ],
      "expected_observables": [
        "dom:#nodeCount",
        "dom:#nodeCountLabel"
      ],
      "timeout": 100,
      "triggers": "#nodeCount"
    },
    {
      "from": "S0_Idle_NoStart",
      "to": "S0_Idle_NoStart",
      "event": "INPUT_DENSITY",
      "guard": "true",
      "actions": [
        "densityLabel.textContent = (densityInput.value/100).toFixed(2)"
      ],
      "expected_observables": [
        "dom:#density",
        "dom:#densityLabel"
      ],
      "timeout": 100,
      "triggers": "#density"
    },
    {
      "from": "S0_Idle_NoStart",
      "to": "S0_Idle_NoStart",
      "event": "INPUT_MAXWEIGHT",
      "guard": "true",
      "actions": [
        "maxWLabel.textContent = maxWeightInput.value"
      ],
      "expected_observables": [
        "dom:#maxWeight",
        "dom:#maxWLabel"
      ],
      "timeout": 100,
      "triggers": "#maxWeight"
    },
    {
      "from": "S2_Ready_WithStart",
      "to": "S3_Stepping",
      "event": "CLICK_STEP",
      "guard": "state.startNode!==null && state.mstSet.size < state.nodes.length",
      "actions": [
        "stepPrim()"
      ],
      "expected_observables": [
        "dom:#pqList",
        "dom:#mstWeight",
        "dom:#visitedList",
        "dom:#mstEdges",
        "dom:svg line[data-id]"
      ],
      "timeout": 2000,
      "triggers": "#stepBtn"
    },
    {
      "from": "S3_Stepping",
      "to": "S2_Ready_WithStart",
      "event": "ALGO_STEP_COMPLETE",
      "guard": "state.mstSet.size < state.nodes.length && state.pq.length>0",
      "actions": [
        "state.selectedEdge=null",
        "refreshVisual()"
      ],
      "expected_observables": [
        "dom:#pqList",
        "dom:#visitedList"
      ],
      "timeout": 1500,
      "triggers": "#pqList, #visitedList"
    },
    {
      "from": "S3_Stepping",
      "to": "S7_Done_MST",
      "event": "ALGO_FINISHED",
      "guard": "state.mstSet.size === state.nodes.length",
      "actions": [
        "state.running=false",
        "state.auto=false",
        "clearInterval(state.timer)"
      ],
      "expected_observables": [
        "dom:#mstWeight",
        "dom:#visitedList"
      ],
      "timeout": 1000,
      "triggers": "#mstWeight"
    },
    {
      "from": "S3_Stepping",
      "to": "S8_Error_Disconnected",
      "event": "PQ_EMPTY_DETECTED",
      "guard": "state.pq.length===0 && state.mstSet.size < state.nodes.length",
      "actions": [
        "state.running=false",
        "state.auto=false",
        "clearInterval(state.timer)",
        "alert('Priority queue empty. Graph might be disconnected.')"
      ],
      "expected_observables": [
        "dom:#pqList"
      ],
      "timeout": 1000,
      "triggers": "#pqList"
    },
    {
      "from": "S2_Ready_WithStart",
      "to": "S4_AutoRunning",
      "event": "CLICK_AUTO_RUN",
      "guard": "state.auto===false && state.startNode!==null",
      "actions": [
        "state.auto=true",
        "autoRunBtn.textContent='Pause'",
        "state.timer = setInterval(()=>stepPrim(), Math.max(80, speedInput.value))"
      ],
      "expected_observables": [
        "dom:#autoRun"
      ],
      "timeout": 200,
      "triggers": "#autoRun"
    },
    {
      "from": "S4_AutoRunning",
      "to": "S2_Ready_WithStart",
      "event": "CLICK_AUTO_RUN",
      "guard": "state.auto===true",
      "actions": [
        "state.auto=false",
        "autoRunBtn.textContent='Auto Run'",
        "clearInterval(state.timer)"
      ],
      "expected_observables": [
        "dom:#autoRun"
      ],
      "timeout": 200,
      "triggers": "#autoRun"
    },
    {
      "from": "S4_AutoRunning",
      "to": "S4_AutoRunning",
      "event": "INPUT_SPEED",
      "guard": "state.auto===true",
      "actions": [
        "clearInterval(state.timer)",
        "state.timer = setInterval(()=>{ if(state.mstSet.size===state.nodes.length||state.pq.length===0){ clearInterval(state.timer); state.auto=false; autoRunBtn.textContent='Auto Run'; return;} stepPrim(); }, Math.max(80, speedInput.value))"
      ],
      "expected_observables": [
        "dom:#speed"
      ],
      "timeout": 200,
      "triggers": "#speed"
    },
    {
      "from": "S4_AutoRunning",
      "to": "S3_Stepping",
      "event": "AUTO_TIMER_TICK",
      "guard": "state.auto===true",
      "actions": [
        "stepPrim()"
      ],
      "expected_observables": [
        "dom:#pqList",
        "dom:#visitedList"
      ],
      "timeout": 3000,
      "triggers": "#speed"
    },
    {
      "from": "S2_Ready_WithStart",
      "to": "S7_Done_MST",
      "event": "ALGO_FINISHED",
      "guard": "state.mstSet.size === state.nodes.length",
      "actions": [
        "clearInterval(state.timer)",
        "state.auto=false",
        "state.running=false"
      ],
      "expected_observables": [
        "dom:#mstWeight",
        "dom:#visitedList"
      ],
      "timeout": 500,
      "triggers": "#mstWeight"
    },
    {
      "from": "S0_Idle_NoStart",
      "to": "S9_Dragging_Node",
      "event": "NODE_MOUSEDOWN",
      "guard": "true",
      "actions": [
        "beginDrag(parseInt(eventTarget.getAttribute('data-id')))"
      ],
      "expected_observables": [
        "dom:svg g[data-id]",
        "dom:svg"
      ],
      "timeout": 0,
      "triggers": "svg g[data-id]"
    },
    {
      "from": "S2_Ready_WithStart",
      "to": "S9_Dragging_Node",
      "event": "NODE_MOUSEDOWN",
      "guard": "true",
      "actions": [
        "beginDrag(parseInt(eventTarget.getAttribute('data-id')))"
      ],
      "expected_observables": [
        "dom:svg g[data-id]"
      ],
      "timeout": 0,
      "triggers": "svg g[data-id]"
    },
    {
      "from": "S9_Dragging_Node",
      "to": "S0_Idle_NoStart",
      "event": "NODE_MOUSEUP",
      "guard": "state.startNode===null",
      "actions": [
        "endDrag(currentDragNodeId)",
        "refreshVisual()"
      ],
      "expected_observables": [
        "dom:svg g[data-id]",
        "dom:svg line[data-id]"
      ],
      "timeout": 0,
      "triggers": "window"
    },
    {
      "from": "S9_Dragging_Node",
      "to": "S2_Ready_WithStart",
      "event": "NODE_MOUSEUP",
      "guard": "state.startNode!==null",
      "actions": [
        "endDrag(currentDragNodeId)",
        "updateEdgesForNode(currentDragNodeId)",
        "refreshVisual()"
      ],
      "expected_observables": [
        "dom:svg line[data-id]",
        "dom:#pqList"
      ],
      "timeout": 0,
      "triggers": "window"
    },
    {
      "from": "S0_Idle_NoStart",
      "to": "S7_Done_MST",
      "event": "ALGO_FINISHED",
      "guard": "state.mstSet.size === state.nodes.length",
      "actions": [
        "state.running=false",
        "clearInterval(state.timer)"
      ],
      "expected_observables": [
        "dom:#mstWeight"
      ],
      "timeout": 500,
      "triggers": "#mstWeight"
    },
    {
      "from": "S8_Error_Disconnected",
      "to": "S7_Done_MST",
      "event": "CLICK_RESET",
      "guard": "true",
      "actions": [
        "resetAlgorithm()"
      ],
      "expected_observables": [
        "dom:#visitedList",
        "dom:#pqList"
      ],
      "timeout": 500,
      "triggers": "#clear"
    },
    {
      "from": "S2_Ready_WithStart",
      "to": "S7_Done_MST",
      "event": "CLICK_RESET",
      "guard": "true",
      "actions": [
        "resetAlgorithm()"
      ],
      "expected_observables": [
        "dom:#visitedList",
        "dom:#pqList"
      ],
      "timeout": 500,
      "triggers": "#clear"
    },
    {
      "from": "S7_Done_MST",
      "to": "S6_Generating_Graph",
      "event": "CLICK_GENERATE",
      "guard": "true",
      "actions": [
        "makeGraph(parseInt(nodeCountInput.value), densityInput.value/100, parseInt(maxWeightInput.value))"
      ],
      "expected_observables": [
        "dom:svg g[data-id]"
      ],
      "timeout": 2000,
      "triggers": "#regen"
    },
    {
      "from": "S7_Done_MST",
      "to": "S2_Ready_WithStart",
      "event": "CLICK_CHOOSE_START",
      "guard": "true",
      "actions": [
        "state.wantChooseStart=true",
        "selectStartBtn.textContent='Click a node...'"
      ],
      "expected_observables": [
        "dom:#selectStart"
      ],
      "timeout": 200,
      "triggers": "#selectStart"
    },
    {
      "from": "S0_Idle_NoStart",
      "to": "S0_Idle_NoStart",
      "event": "EDGE_HOVER",
      "guard": "true",
      "actions": [
        "showTooltipEdge(edge)",
        "tooltip.style.display='block'"
      ],
      "expected_observables": [
        "dom:#tooltip",
        "dom:svg line[data-id]"
      ],
      "timeout": 0,
      "triggers": "svg line[data-id]"
    },
    {
      "from": "S0_Idle_NoStart",
      "to": "S0_Idle_NoStart",
      "event": "EDGE_LEAVE",
      "guard": "true",
      "actions": [
        "hideTooltip()"
      ],
      "expected_observables": [
        "dom:#tooltip"
      ],
      "timeout": 0,
      "triggers": "svg line[data-id], #tooltip"
    }
  ],
  "components": [
    "#nodeCount",
    "#density",
    "#maxWeight",
    "#regen",
    "#clear",
    "#selectStart",
    "#autoRun",
    "#stepBtn",
    "#speed",
    "#svgCanvas",
    "#canvasWrapper",
    "#tooltip",
    "#pqList",
    "#mstWeight",
    "#visitedList",
    "#mstEdges",
    "#line0",
    "#line1",
    "#line2",
    "#line3",
    "#line4",
    "#line5",
    "svg g[data-id]",
    "svg line[data-id]",
    ".pq-item"
  ]
}