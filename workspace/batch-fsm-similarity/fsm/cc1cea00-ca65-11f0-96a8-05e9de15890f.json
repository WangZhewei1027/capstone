{
  "meta": {
    "concept": "HashMap",
    "topic": "Hash Map Visualization",
    "educational_goal": "Demonstrate hash map operations (put/get/remove/clear), collision strategies (separate chaining and linear probing), probing, tombstones, resizing, and step-by-step visualization",
    "expected_interactions": [
      "put",
      "get",
      "remove",
      "clear",
      "random_insert",
      "fill_to_resize",
      "rebuild",
      "toggle_internals",
      "toggle_step_mode",
      "change_strategy",
      "change_capacity",
      "change_threshold",
      "change_resize_enabled",
      "click_bucket_to_advance_step"
    ]
  },
  "states": [
    {
      "id": "S0_Idle",
      "label": "idle",
      "type": "idle",
      "entry_actions": [
        "renderBuckets()",
        "enableControls()",
        "updateStatsDisplay()"
      ],
      "exit_actions": [
        "disableControls()"
      ]
    },
    {
      "id": "S1_Putting",
      "label": "putting",
      "type": "atomic",
      "entry_actions": [
        "captureInput('#key','#value')",
        "hm.put(key,value)"
      ],
      "exit_actions": [
        "renderBuckets()",
        "logPutResult()"
      ]
    },
    {
      "id": "S2_Getting",
      "label": "getting",
      "type": "atomic",
      "entry_actions": [
        "captureInput('#key')",
        "hm.get(key)"
      ],
      "exit_actions": [
        "renderBuckets()",
        "logGetResult()"
      ]
    },
    {
      "id": "S3_Removing",
      "label": "removing",
      "type": "atomic",
      "entry_actions": [
        "captureInput('#key')",
        "hm.remove(key)"
      ],
      "exit_actions": [
        "renderBuckets()",
        "logRemoveResult()"
      ]
    },
    {
      "id": "S4_Clearing",
      "label": "clearing",
      "type": "atomic",
      "entry_actions": [
        "hm.clear()",
        "log('Cleared map.')"
      ],
      "exit_actions": [
        "renderBuckets()"
      ]
    },
    {
      "id": "S5_Resizing",
      "label": "resizing",
      "type": "atomic",
      "entry_actions": [
        "beginResize()",
        "hm._resize(newCapacity)"
      ],
      "exit_actions": [
        "renderBuckets()",
        "logResize()"
      ]
    },
    {
      "id": "S6_Probing",
      "label": "probing",
      "type": "atomic",
      "entry_actions": [
        "visualHighlightProbe(index)",
        "renderBuckets({op:'probing',details:...})"
      ],
      "exit_actions": [
        "clearProbeHighlight()"
      ]
    },
    {
      "id": "S7_PausedStep",
      "label": "paused_step",
      "type": "atomic",
      "entry_actions": [
        "visualPaused = true",
        "log('[Step] Paused. Click anywhere on bucket area to continue.')"
      ],
      "exit_actions": [
        "visualPaused = false",
        "log('[Step] Resumed')"
      ]
    },
    {
      "id": "S8_Rendering",
      "label": "rendering",
      "type": "atomic",
      "entry_actions": [
        "renderBuckets(lastVisual)",
        "updateStatsDisplay()"
      ],
      "exit_actions": [
        "clearTransientHighlights()"
      ]
    },
    {
      "id": "S9_Rebuilding",
      "label": "rebuilding",
      "type": "atomic",
      "entry_actions": [
        "rebuildFromSettings()",
        "log('Rebuilt map with current settings.')"
      ],
      "exit_actions": [
        "renderBuckets()"
      ]
    },
    {
      "id": "S10_Filling",
      "label": "filling",
      "type": "atomic",
      "entry_actions": [
        "insertMultipleKeysForCollisions()",
        "log('Inserted multiple keys to produce collisions/resizes.')"
      ],
      "exit_actions": [
        "renderBuckets()"
      ]
    },
    {
      "id": "S11_RandomInserting",
      "label": "random_inserting",
      "type": "atomic",
      "entry_actions": [
        "generateRandomKeyValue()",
        "hm.put(rndKey,rndVal)",
        "log(`Random insert: ${rndKey} -> ${rndVal}`)"
      ],
      "exit_actions": [
        "renderBuckets()"
      ]
    },
    {
      "id": "S12_TogglingInternals",
      "label": "toggling_internals",
      "type": "atomic",
      "entry_actions": [
        "showInternals = !showInternals"
      ],
      "exit_actions": [
        "renderBuckets()"
      ]
    },
    {
      "id": "S13_EditingSettings",
      "label": "editing_settings",
      "type": "atomic",
      "entry_actions": [
        "captureSettings('#strategy','#capacity','#resizeToggle','#threshold')"
      ],
      "exit_actions": [
        "applySettings()"
      ]
    },
    {
      "id": "S14_ErrorNoKey",
      "label": "error_no_key",
      "type": "atomic",
      "entry_actions": [
        "log('Key required')",
        "flashInputError('#key')"
      ],
      "exit_actions": [
        "clearInputError('#key')"
      ]
    }
  ],
  "events": [
    {
      "id": "USER_PUT_CLICK",
      "event_type": "user_action",
      "description": "User clicks the Put button"
    },
    {
      "id": "USER_GET_CLICK",
      "event_type": "user_action",
      "description": "User clicks the Get button"
    },
    {
      "id": "USER_REMOVE_CLICK",
      "event_type": "user_action",
      "description": "User clicks the Remove button"
    },
    {
      "id": "USER_CLEAR_CLICK",
      "event_type": "user_action",
      "description": "User clicks the Clear button"
    },
    {
      "id": "USER_RANDOM_CLICK",
      "event_type": "user_action",
      "description": "User clicks Insert Random"
    },
    {
      "id": "USER_FILL_CLICK",
      "event_type": "user_action",
      "description": "User clicks Fill to Resize"
    },
    {
      "id": "USER_REBUILD_CLICK",
      "event_type": "user_action",
      "description": "User clicks Rebuild"
    },
    {
      "id": "USER_TOGGLE_INTERNALS_CLICK",
      "event_type": "user_action",
      "description": "User clicks Toggle Internals"
    },
    {
      "id": "USER_TOGGLE_STEPMODE_CLICK",
      "event_type": "user_action",
      "description": "User clicks Step Mode button"
    },
    {
      "id": "USER_STRATEGY_CHANGE",
      "event_type": "user_action",
      "description": "User changes collision strategy select"
    },
    {
      "id": "USER_CAPACITY_CHANGE",
      "event_type": "user_action",
      "description": "User changes initial capacity input"
    },
    {
      "id": "USER_RESIZE_TOGGLE_CHANGE",
      "event_type": "user_action",
      "description": "User toggles resize enabled checkbox"
    },
    {
      "id": "USER_THRESHOLD_CHANGE",
      "event_type": "user_action",
      "description": "User changes load factor threshold"
    },
    {
      "id": "USER_KEY_INPUT",
      "event_type": "user_action",
      "description": "User types into key input"
    },
    {
      "id": "VISUAL_HASH",
      "event_type": "system_event",
      "description": "visualUpdate emitted 'hash' (shows hash and index)"
    },
    {
      "id": "VISUAL_PROBING",
      "event_type": "system_event",
      "description": "visualUpdate emitted 'probing' (probe step highlight)"
    },
    {
      "id": "VISUAL_PUT",
      "event_type": "system_event",
      "description": "visualUpdate emitted 'put' or 'put_replace' (insertion/update visual)"
    },
    {
      "id": "VISUAL_GET",
      "event_type": "system_event",
      "description": "visualUpdate emitted 'get' (lookup visual)"
    },
    {
      "id": "VISUAL_REMOVE",
      "event_type": "system_event",
      "description": "visualUpdate emitted 'remove' (removal visual, tombstone)"
    },
    {
      "id": "VISUAL_RESIZE",
      "event_type": "system_event",
      "description": "visualUpdate emitted 'resize' (map resized and rehashed)"
    },
    {
      "id": "VISUAL_CLEAR",
      "event_type": "system_event",
      "description": "visualUpdate emitted 'clear' (map cleared)"
    },
    {
      "id": "USER_BUCKET_CLICK",
      "event_type": "user_action",
      "description": "User clicks anywhere in the bucket area (used to resume step mode)"
    },
    {
      "id": "SYSTEM_RENDER_COMPLETE",
      "event_type": "system_event",
      "description": "DOM render of buckets completed (renderBuckets finished)"
    }
  ],
  "transitions": [
    {
      "from": "S0_Idle",
      "to": "S1_Putting",
      "event": "USER_PUT_CLICK",
      "guard": "keyNotEmpty('#key')",
      "actions": [
        "captureInput('#key','#value')",
        "hm.put(key,value)"
      ],
      "expected_observables": [
        "dom:click#putBtn",
        "dom:value#key",
        "dom:visual_update:put"
      ],
      "triggers": "#putBtn",
      "timeout": 3000
    },
    {
      "from": "S0_Idle",
      "to": "S14_ErrorNoKey",
      "event": "USER_PUT_CLICK",
      "guard": "keyEmpty('#key')",
      "actions": [
        "log('Key required')",
        "flashInputError('#key')"
      ],
      "expected_observables": [
        "dom:click#putBtn",
        "dom:value#key"
      ],
      "triggers": "#putBtn",
      "timeout": 500
    },
    {
      "from": "S1_Putting",
      "to": "S6_Probing",
      "event": "VISUAL_PROBING",
      "guard": "strategyIsProbing",
      "actions": [
        "visualHighlightProbe(details.probeIndex)",
        "renderBuckets(lastVisual)"
      ],
      "expected_observables": [
        "dom:visual_update:probing",
        "dom:div.bucket[data-index]"
      ],
      "triggers": "#buckets",
      "timeout": 2000
    },
    {
      "from": "S1_Putting",
      "to": "S8_Rendering",
      "event": "VISUAL_PUT",
      "guard": "true",
      "actions": [
        "updateStatsDisplay()",
        "renderBuckets(lastVisual)"
      ],
      "expected_observables": [
        "dom:visual_update:put",
        "dom:newEntryInDOM"
      ],
      "triggers": "#buckets",
      "timeout": 2000
    },
    {
      "from": "S6_Probing",
      "to": "S7_PausedStep",
      "event": "VISUAL_PROBING",
      "guard": "stepModeEnabled",
      "actions": [
        "visualPaused = true",
        "log('[Step] Paused. Click anywhere on bucket area to continue.')"
      ],
      "expected_observables": [
        "dom:visual_update:probing",
        "dom:click#buckets"
      ],
      "triggers": "#buckets",
      "timeout": 0
    },
    {
      "from": "S7_PausedStep",
      "to": "S6_Probing",
      "event": "USER_BUCKET_CLICK",
      "guard": "true",
      "actions": [
        "visualPaused = false",
        "resumeVisual()"
      ],
      "expected_observables": [
        "dom:click#buckets"
      ],
      "triggers": "#buckets",
      "timeout": 500
    },
    {
      "from": "S6_Probing",
      "to": "S8_Rendering",
      "event": "VISUAL_PUT",
      "guard": "true",
      "actions": [
        "renderBuckets(lastVisual)",
        "updateStatsDisplay()"
      ],
      "expected_observables": [
        "dom:visual_update:put",
        "dom:entryRendered"
      ],
      "triggers": "#buckets",
      "timeout": 2000
    },
    {
      "from": "S0_Idle",
      "to": "S2_Getting",
      "event": "USER_GET_CLICK",
      "guard": "keyNotEmpty('#key')",
      "actions": [
        "captureInput('#key')",
        "hm.get(key)"
      ],
      "expected_observables": [
        "dom:click#getBtn",
        "dom:value#key",
        "dom:visual_update:get"
      ],
      "triggers": "#getBtn",
      "timeout": 2000
    },
    {
      "from": "S0_Idle",
      "to": "S14_ErrorNoKey",
      "event": "USER_GET_CLICK",
      "guard": "keyEmpty('#key')",
      "actions": [
        "log('Key required')",
        "flashInputError('#key')"
      ],
      "expected_observables": [
        "dom:click#getBtn",
        "dom:value#key"
      ],
      "triggers": "#getBtn",
      "timeout": 500
    },
    {
      "from": "S0_Idle",
      "to": "S3_Removing",
      "event": "USER_REMOVE_CLICK",
      "guard": "keyNotEmpty('#key')",
      "actions": [
        "captureInput('#key')",
        "hm.remove(key)"
      ],
      "expected_observables": [
        "dom:click#removeBtn",
        "dom:value#key",
        "dom:visual_update:remove"
      ],
      "triggers": "#removeBtn",
      "timeout": 2000
    },
    {
      "from": "S0_Idle",
      "to": "S14_ErrorNoKey",
      "event": "USER_REMOVE_CLICK",
      "guard": "keyEmpty('#key')",
      "actions": [
        "log('Key required')",
        "flashInputError('#key')"
      ],
      "expected_observables": [
        "dom:click#removeBtn",
        "dom:value#key"
      ],
      "triggers": "#removeBtn",
      "timeout": 500
    },
    {
      "from": "S0_Idle",
      "to": "S4_Clearing",
      "event": "USER_CLEAR_CLICK",
      "guard": "true",
      "actions": [
        "hm.clear()",
        "log('Cleared map.')"
      ],
      "expected_observables": [
        "dom:click#clearBtn",
        "dom:visual_update:clear"
      ],
      "triggers": "#clearBtn",
      "timeout": 1000
    },
    {
      "from": "S0_Idle",
      "to": "S11_RandomInserting",
      "event": "USER_RANDOM_CLICK",
      "guard": "true",
      "actions": [
        "generateRandomKeyValue()",
        "hm.put(rndKey,rndVal)"
      ],
      "expected_observables": [
        "dom:click#randomBtn",
        "dom:visual_update:put"
      ],
      "triggers": "#randomBtn",
      "timeout": 1000
    },
    {
      "from": "S0_Idle",
      "to": "S10_Filling",
      "event": "USER_FILL_CLICK",
      "guard": "true",
      "actions": [
        "insertMultipleKeysForCollisions()"
      ],
      "expected_observables": [
        "dom:click#fillBtn",
        "dom:visual_update:put"
      ],
      "triggers": "#fillBtn",
      "timeout": 3000
    },
    {
      "from": "S0_Idle",
      "to": "S9_Rebuilding",
      "event": "USER_REBUILD_CLICK",
      "guard": "true",
      "actions": [
        "rebuildFromSettings()"
      ],
      "expected_observables": [
        "dom:click#rebuildBtn",
        "dom:visual_update:put"
      ],
      "triggers": "#rebuildBtn",
      "timeout": 2000
    },
    {
      "from": "S0_Idle",
      "to": "S12_TogglingInternals",
      "event": "USER_TOGGLE_INTERNALS_CLICK",
      "guard": "true",
      "actions": [
        "showInternals = !showInternals",
        "renderBuckets()"
      ],
      "expected_observables": [
        "dom:click#toggleInternals",
        "dom:buckets_rendered"
      ],
      "triggers": "#toggleInternals",
      "timeout": 500
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "USER_TOGGLE_STEPMODE_CLICK",
      "guard": "true",
      "actions": [
        "stepMode = !stepMode",
        "updateStepButton()",
        "hm.stepMode = stepMode"
      ],
      "expected_observables": [
        "dom:click#stepMode",
        "dom:textChange#stepMode"
      ],
      "triggers": "#stepMode",
      "timeout": 300
    },
    {
      "from": "S0_Idle",
      "to": "S13_EditingSettings",
      "event": "USER_STRATEGY_CHANGE",
      "guard": "true",
      "actions": [
        "modeLabel.textContent = strategyLabel(strategyEl.value)",
        "rebuildFromSettings()"
      ],
      "expected_observables": [
        "dom:change#strategy",
        "dom:visual_update:put"
      ],
      "triggers": "#strategy",
      "timeout": 1500
    },
    {
      "from": "S0_Idle",
      "to": "S13_EditingSettings",
      "event": "USER_CAPACITY_CHANGE",
      "guard": "true",
      "actions": [
        "rebuildFromSettings()"
      ],
      "expected_observables": [
        "dom:change#capacity",
        "dom:visual_update:put"
      ],
      "triggers": "#capacity",
      "timeout": 1500
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "USER_RESIZE_TOGGLE_CHANGE",
      "guard": "true",
      "actions": [
        "hm.resizeEnabled = resizeToggle.checked"
      ],
      "expected_observables": [
        "dom:change#resizeToggle"
      ],
      "triggers": "#resizeToggle",
      "timeout": 200
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "USER_THRESHOLD_CHANGE",
      "guard": "true",
      "actions": [
        "hm.loadFactor = parseFloat(thresholdEl.value) || 0.7"
      ],
      "expected_observables": [
        "dom:change#threshold"
      ],
      "triggers": "#threshold",
      "timeout": 200
    },
    {
      "from": "S5_Resizing",
      "to": "S8_Rendering",
      "event": "VISUAL_RESIZE",
      "guard": "true",
      "actions": [
        "renderBuckets(lastVisual)",
        "updateStatsDisplay()"
      ],
      "expected_observables": [
        "dom:visual_update:resize",
        "dom:buckets_rebuilt"
      ],
      "triggers": "#buckets",
      "timeout": 3000
    },
    {
      "from": "S8_Rendering",
      "to": "S0_Idle",
      "event": "SYSTEM_RENDER_COMPLETE",
      "guard": "true",
      "actions": [
        "enableControls()"
      ],
      "expected_observables": [
        "dom:buckets_rendered"
      ],
      "triggers": "#buckets",
      "timeout": 500
    },
    {
      "from": "S14_ErrorNoKey",
      "to": "S0_Idle",
      "event": "USER_KEY_INPUT",
      "guard": "keyNotEmpty('#key')",
      "actions": [
        "clearInputError('#key')"
      ],
      "expected_observables": [
        "dom:input#key"
      ],
      "triggers": "#key",
      "timeout": 500
    },
    {
      "from": "S2_Getting",
      "to": "S8_Rendering",
      "event": "VISUAL_GET",
      "guard": "true",
      "actions": [
        "renderBuckets(lastVisual)",
        "updateStatsDisplay()"
      ],
      "expected_observables": [
        "dom:visual_update:get"
      ],
      "triggers": "#buckets",
      "timeout": 1500
    },
    {
      "from": "S3_Removing",
      "to": "S8_Rendering",
      "event": "VISUAL_REMOVE",
      "guard": "true",
      "actions": [
        "renderBuckets(lastVisual)",
        "updateStatsDisplay()"
      ],
      "expected_observables": [
        "dom:visual_update:remove"
      ],
      "triggers": "#buckets",
      "timeout": 1500
    },
    {
      "from": "S11_RandomInserting",
      "to": "S8_Rendering",
      "event": "VISUAL_PUT",
      "guard": "true",
      "actions": [
        "renderBuckets(lastVisual)",
        "updateStatsDisplay()"
      ],
      "expected_observables": [
        "dom:click#randomBtn",
        "dom:visual_update:put"
      ],
      "triggers": "#randomBtn",
      "timeout": 1000
    },
    {
      "from": "S10_Filling",
      "to": "S5_Resizing",
      "event": "VISUAL_RESIZE",
      "guard": "mapTriggeredResize",
      "actions": [
        "beginResize()"
      ],
      "expected_observables": [
        "dom:visual_update:resize",
        "dom:statCapacityChanged"
      ],
      "triggers": "#fillBtn",
      "timeout": 3000
    },
    {
      "from": "S9_Rebuilding",
      "to": "S8_Rendering",
      "event": "VISUAL_PUT",
      "guard": "true",
      "actions": [
        "renderBuckets()",
        "updateStatsDisplay()"
      ],
      "expected_observables": [
        "dom:click#rebuildBtn",
        "dom:visual_update:put"
      ],
      "triggers": "#rebuildBtn",
      "timeout": 2000
    }
  ],
  "components": [
    "#strategy",
    "#key",
    "#value",
    "#putBtn",
    "#getBtn",
    "#removeBtn",
    "#clearBtn",
    "#capacity",
    "#resizeToggle",
    "#threshold",
    "#randomBtn",
    "#fillBtn",
    "#rebuildBtn",
    "#toggleInternals",
    "#stepMode",
    "#buckets",
    "#statCapacity",
    "#statSize",
    "#statLoad",
    "#lastHash",
    "#lastIndex",
    "#modeLabel",
    "#log"
  ]
}