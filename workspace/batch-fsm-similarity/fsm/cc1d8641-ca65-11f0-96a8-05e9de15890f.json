{
  "meta": {
    "concept": "AdjacencyList",
    "topic": "Adjacency List Interactive Demo",
    "educational_goal": "Allow users to build and manipulate a graph visually and observe its adjacency list representation updating live",
    "expected_interactions": [
      "add_node",
      "add_edge",
      "delete_node",
      "delete_edge",
      "drag_node",
      "load_sample",
      "auto_layout",
      "export_json",
      "import_json",
      "toggle_directed",
      "toggle_weighted",
      "clear_graph",
      "select_node",
      "select_edge"
    ]
  },
  "states": [
    {
      "id": "S0_Idle",
      "label": "idle",
      "type": "idle",
      "entry_actions": [
        "render()",
        "updateCounters()",
        "clearSelections()"
      ],
      "exit_actions": []
    },
    {
      "id": "S1_AddingNode",
      "label": "adding_node",
      "type": "atomic",
      "entry_actions": [
        "captureClickPosition()",
        "addNodeAt(x,y)",
        "render()"
      ],
      "exit_actions": []
    },
    {
      "id": "S2_ModeAddEdge",
      "label": "mode_add_edge",
      "type": "atomic",
      "entry_actions": [
        "toggleModeAddEdge(true)",
        "setButtonActive('#modeAddEdge')"
      ],
      "exit_actions": [
        "toggleModeAddEdge(false)",
        "setButtonActive('#modeAddEdge', false)"
      ]
    },
    {
      "id": "S3_EdgeSelecting",
      "label": "edge_selecting_first_node",
      "type": "atomic",
      "entry_actions": [
        "setEdgeFrom(nodeId)",
        "highlightNode(nodeId,true)"
      ],
      "exit_actions": [
        "highlightNode(nodeId,false)",
        "clearEdgeFrom()"
      ]
    },
    {
      "id": "S4_CreatingEdge",
      "label": "creating_edge",
      "type": "atomic",
      "entry_actions": [
        "createEdge(fromId,toId)",
        "render()"
      ],
      "exit_actions": []
    },
    {
      "id": "S5_NodeSelected",
      "label": "node_selected",
      "type": "atomic",
      "entry_actions": [
        "setSelectedNode(nodeId)",
        "render()"
      ],
      "exit_actions": [
        "clearSelectedNode()",
        "render()"
      ]
    },
    {
      "id": "S6_EdgeSelected",
      "label": "edge_selected",
      "type": "atomic",
      "entry_actions": [
        "setSelectedEdge(edgeId)",
        "render()"
      ],
      "exit_actions": [
        "clearSelectedEdge()",
        "render()"
      ]
    },
    {
      "id": "S7_Dragging",
      "label": "dragging_node",
      "type": "atomic",
      "entry_actions": [
        "startDrag(nodeId)",
        "captureDragOffset()"
      ],
      "exit_actions": [
        "endDrag()",
        "render()"
      ]
    },
    {
      "id": "S8_ClearConfirm",
      "label": "clear_confirm",
      "type": "atomic",
      "entry_actions": [
        "showConfirm('Clear the entire graph?')"
      ],
      "exit_actions": [
        "hideConfirm()"
      ]
    },
    {
      "id": "S9_ClearingGraph",
      "label": "clearing_graph",
      "type": "atomic",
      "entry_actions": [
        "clearGraph()",
        "resetIds()",
        "render()"
      ],
      "exit_actions": []
    },
    {
      "id": "S10_SampleLoaded",
      "label": "sample_loaded",
      "type": "atomic",
      "entry_actions": [
        "loadSampleGraph()",
        "render()"
      ],
      "exit_actions": []
    },
    {
      "id": "S11_AutoLayouting",
      "label": "auto_layouting",
      "type": "atomic",
      "entry_actions": [
        "computeCircularLayout()",
        "applyLayout()",
        "render()"
      ],
      "exit_actions": []
    },
    {
      "id": "S12_Exporting",
      "label": "exporting",
      "type": "atomic",
      "entry_actions": [
        "serializeGraph()",
        "navigator.clipboard.writeText(json) || prompt(json)",
        "notifyExportResult()"
      ],
      "exit_actions": []
    },
    {
      "id": "S13_Importing",
      "label": "importing",
      "type": "atomic",
      "entry_actions": [
        "promptForJson()",
        "parseAndLoadGraph(inputJson)",
        "render()"
      ],
      "exit_actions": []
    },
    {
      "id": "S14_WeightPrompt",
      "label": "weight_prompt",
      "type": "atomic",
      "entry_actions": [
        "promptForWeight()",
        "parseWeight()"
      ],
      "exit_actions": []
    },
    {
      "id": "S15_ErrorAlert",
      "label": "error_alert",
      "type": "atomic",
      "entry_actions": [
        "alert(message)"
      ],
      "exit_actions": []
    }
  ],
  "events": [
    {
      "id": "CLICK_SVG_BACKGROUND",
      "event_type": "user_action",
      "description": "User clicks empty space in the SVG canvas to add a node (selector: #svgCanvas)"
    },
    {
      "id": "CLICK_NODE",
      "event_type": "user_action",
      "description": "User clicks a node element in the SVG (selector: [data-node-id])"
    },
    {
      "id": "MOUSEDOWN_NODE",
      "event_type": "user_action",
      "description": "User presses mouse down on a node to start dragging (selector: [data-node-id])"
    },
    {
      "id": "MOUSEMOVE_WINDOW",
      "event_type": "user_action",
      "description": "Mouse moves while dragging (global window mousemove)"
    },
    {
      "id": "MOUSEUP_WINDOW",
      "event_type": "user_action",
      "description": "Mouse is released (global window mouseup)"
    },
    {
      "id": "CLICK_EDGE_HIT",
      "event_type": "user_action",
      "description": "User clicks an edge hit area (selector: line[data-edge-id])"
    },
    {
      "id": "CLICK_MODE_ADD_EDGE",
      "event_type": "user_action",
      "description": "User clicks Add Edge button to toggle edge creation mode (selector: #modeAddEdge)"
    },
    {
      "id": "CLICK_CLEAR",
      "event_type": "user_action",
      "description": "User clicks Clear button to clear the graph (selector: #clearBtn)"
    },
    {
      "id": "CONFIRM_CLEAR",
      "event_type": "user_action",
      "description": "User confirms clearing the graph via confirm dialog"
    },
    {
      "id": "CANCEL_CLEAR",
      "event_type": "user_action",
      "description": "User cancels clearing the graph via confirm dialog"
    },
    {
      "id": "CLICK_SAMPLE",
      "event_type": "user_action",
      "description": "User clicks Load Sample Graph (selector: #sampleBtn)"
    },
    {
      "id": "CLICK_AUTOLAYOUT",
      "event_type": "user_action",
      "description": "User clicks Auto Layout (selector: #autoLayout)"
    },
    {
      "id": "CLICK_EXPORT",
      "event_type": "user_action",
      "description": "User clicks Export JSON (selector: #exportBtn)"
    },
    {
      "id": "EXPORT_SUCCESS",
      "event_type": "system_event",
      "description": "Clipboard write succeeded"
    },
    {
      "id": "EXPORT_FAIL",
      "event_type": "system_event",
      "description": "Clipboard write failed and fallback prompt shown"
    },
    {
      "id": "CLICK_IMPORT",
      "event_type": "user_action",
      "description": "User clicks Import JSON (selector: #importBtn)"
    },
    {
      "id": "IMPORT_PROVIDED",
      "event_type": "user_action",
      "description": "User pastes graph JSON into prompt"
    },
    {
      "id": "IMPORT_SUCCESS",
      "event_type": "system_event",
      "description": "Imported JSON parsed and loaded"
    },
    {
      "id": "IMPORT_FAIL",
      "event_type": "system_event",
      "description": "Imported JSON invalid or parsing failed"
    },
    {
      "id": "CLICK_DELETE_SELECTED",
      "event_type": "user_action",
      "description": "User clicks Delete Selected node (selector: #deleteSelected)"
    },
    {
      "id": "CLICK_DELETE_EDGE",
      "event_type": "user_action",
      "description": "User clicks Delete Selected Edge (selector: #deleteEdge)"
    },
    {
      "id": "KEY_DELETE",
      "event_type": "user_action",
      "description": "User presses Delete or Backspace to remove selected item (global keydown)"
    },
    {
      "id": "KEY_TOGGLE_EDGE_MODE",
      "event_type": "user_action",
      "description": "User presses 'e' to toggle Add Edge mode (global keydown)"
    },
    {
      "id": "CHANGE_DIRECTED",
      "event_type": "user_action",
      "description": "User toggles Directed checkbox (selector: #directed)"
    },
    {
      "id": "CHANGE_WEIGHTED",
      "event_type": "user_action",
      "description": "User toggles Weighted checkbox (selector: #weighted)"
    },
    {
      "id": "ADJTEXT_CLICK",
      "event_type": "user_action",
      "description": "User clicks adjacency text to select a node by id (selector: #adjText)"
    },
    {
      "id": "EDGE_ALREADY_EXISTS_ALERT",
      "event_type": "system_event",
      "description": "System alerts that the edge already exists"
    }
  ],
  "transitions": [
    {
      "from": "S0_Idle",
      "to": "S1_AddingNode",
      "event": "CLICK_SVG_BACKGROUND",
      "guard": "state.modeAddEdge === false",
      "actions": [
        "captureClickPosition()",
        "addNodeAt(x,y)",
        "render()"
      ],
      "expected_observables": [
        "dom:#svgCanvas",
        "dom:[data-node-id]"
      ],
      "timeout": 1000
    },
    {
      "from": "S0_Idle",
      "to": "S2_ModeAddEdge",
      "event": "CLICK_MODE_ADD_EDGE",
      "guard": "true",
      "actions": [
        "state.modeAddEdge = !state.modeAddEdge",
        "toggleClass('#modeAddEdge','active', state.modeAddEdge)"
      ],
      "expected_observables": [
        "dom:#modeAddEdge",
        "dom:#modeAddEdge.active"
      ],
      "timeout": 500
    },
    {
      "from": "S2_ModeAddEdge",
      "to": "S3_EdgeSelecting",
      "event": "CLICK_NODE",
      "guard": "state.edgeFrom === null",
      "actions": [
        "state.edgeFrom = nodeId",
        "highlightNode(nodeId,true)"
      ],
      "expected_observables": [
        "dom:[data-node-id]",
        "dom:#modeAddEdge.active"
      ],
      "timeout": 500
    },
    {
      "from": "S3_EdgeSelecting",
      "to": "S2_ModeAddEdge",
      "event": "CLICK_NODE",
      "guard": "state.edgeFrom === clickedNodeId",
      "actions": [
        "highlightNode(clickedNodeId,false)",
        "state.edgeFrom = null"
      ],
      "expected_observables": [
        "dom:[data-node-id]",
        "dom:#modeAddEdge.active"
      ],
      "timeout": 500
    },
    {
      "from": "S3_EdgeSelecting",
      "to": "S4_CreatingEdge",
      "event": "CLICK_NODE",
      "guard": "state.edgeFrom !== null && state.edgeFrom !== clickedNodeId",
      "actions": [
        "createEdge(state.edgeFrom, clickedNodeId)",
        "highlightNode(state.edgeFrom,false)",
        "state.edgeFrom = null",
        "render()"
      ],
      "expected_observables": [
        "dom:[data-node-id]",
        "dom:line[data-edge-id]",
        "dom:#adjText"
      ],
      "timeout": 1500
    },
    {
      "from": "S3_EdgeSelecting",
      "to": "S15_ErrorAlert",
      "event": "EDGE_ALREADY_EXISTS_ALERT",
      "guard": "true",
      "actions": [
        "alert('Edge already exists between those nodes.')",
        "highlightNode(state.edgeFrom,false)",
        "state.edgeFrom = null"
      ],
      "expected_observables": [
        "dom:window.alert",
        "dom:#adjText"
      ],
      "timeout": 500
    },
    {
      "from": "S0_Idle",
      "to": "S5_NodeSelected",
      "event": "CLICK_NODE",
      "guard": "state.modeAddEdge === false",
      "actions": [
        "state.selectedNodeId = nodeId === state.selectedNodeId ? null : nodeId",
        "state.selectedEdgeId = null",
        "render()"
      ],
      "expected_observables": [
        "dom:[data-node-id]",
        "dom:#nodeCount"
      ],
      "timeout": 300
    },
    {
      "from": "S0_Idle",
      "to": "S6_EdgeSelected",
      "event": "CLICK_EDGE_HIT",
      "guard": "true",
      "actions": [
        "state.selectedEdgeId = edgeId === state.selectedEdgeId ? null : edgeId",
        "state.selectedNodeId = null",
        "render()"
      ],
      "expected_observables": [
        "dom:line[data-edge-id]",
        "dom:#edgeCount"
      ],
      "timeout": 300
    },
    {
      "from": "S0_Idle",
      "to": "S7_Dragging",
      "event": "MOUSEDOWN_NODE",
      "guard": "state.modeAddEdge === false",
      "actions": [
        "state.dragging = nodeId",
        "captureDragOffset(nodeId, event)"
      ],
      "expected_observables": [
        "dom:[data-node-id]",
        "dom:#svgCanvas"
      ],
      "timeout": 2000
    },
    {
      "from": "S7_Dragging",
      "to": "S7_Dragging",
      "event": "MOUSEMOVE_WINDOW",
      "guard": "state.dragging !== null",
      "actions": [
        "updateNodePosition(state.dragging, mousePos)",
        "render()"
      ],
      "expected_observables": [
        "dom:#svgCanvas",
        "dom:[data-node-id]"
      ],
      "timeout": 0
    },
    {
      "from": "S7_Dragging",
      "to": "S0_Idle",
      "event": "MOUSEUP_WINDOW",
      "guard": "true",
      "actions": [
        "state.dragging = null",
        "render()"
      ],
      "expected_observables": [
        "dom:#svgCanvas",
        "dom:[data-node-id]"
      ],
      "timeout": 500
    },
    {
      "from": "S0_Idle",
      "to": "S8_ClearConfirm",
      "event": "CLICK_CLEAR",
      "guard": "true",
      "actions": [
        "showConfirm('Clear the entire graph?')"
      ],
      "expected_observables": [
        "dom:#clearBtn"
      ],
      "timeout": 1000
    },
    {
      "from": "S8_ClearConfirm",
      "to": "S9_ClearingGraph",
      "event": "CONFIRM_CLEAR",
      "guard": "true",
      "actions": [
        "graph.nodes = []",
        "graph.edges = []",
        "state.nextNodeId = 1",
        "state.nextEdgeId = 1",
        "state.selectedNodeId = null",
        "state.selectedEdgeId = null",
        "state.edgeFrom = null",
        "render()"
      ],
      "expected_observables": [
        "dom:#clearBtn",
        "dom:#nodeCount",
        "dom:#edgeCount",
        "dom:#adjText"
      ],
      "timeout": 1000
    },
    {
      "from": "S8_ClearConfirm",
      "to": "S0_Idle",
      "event": "CANCEL_CLEAR",
      "guard": "true",
      "actions": [
        "hideConfirm()",
        "render()"
      ],
      "expected_observables": [
        "dom:#clearBtn"
      ],
      "timeout": 500
    },
    {
      "from": "S0_Idle",
      "to": "S10_SampleLoaded",
      "event": "CLICK_SAMPLE",
      "guard": "true",
      "actions": [
        "graph = { nodes: [], edges: [] }",
        "state.nextNodeId = 1",
        "state.nextEdgeId = 1",
        "addNodeAt(200,110,'A')",
        "addNodeAt(380,90,'B')",
        "addNodeAt(540,160,'C')",
        "addNodeAt(300,280,'D')",
        "addNodeAt(520,300,'E')",
        "createEdge(1,2)",
        "createEdge(2,3)",
        "createEdge(1,4)",
        "createEdge(4,5)",
        "createEdge(3,5)",
        "render()"
      ],
      "expected_observables": [
        "dom:#sampleBtn",
        "dom:#nodeCount",
        "dom:#edgeCount",
        "dom:#adjText"
      ],
      "timeout": 1500
    },
    {
      "from": "S0_Idle",
      "to": "S11_AutoLayouting",
      "event": "CLICK_AUTOLAYOUT",
      "guard": "graph.nodes.length > 0",
      "actions": [
        "computeCircularLayout()",
        "applyLayout()",
        "render()"
      ],
      "expected_observables": [
        "dom:#autoLayout",
        "dom:[data-node-id]",
        "dom:#svgCanvas"
      ],
      "timeout": 1000
    },
    {
      "from": "S0_Idle",
      "to": "S12_Exporting",
      "event": "CLICK_EXPORT",
      "guard": "true",
      "actions": [
        "json = JSON.stringify(graph, null, 2)",
        "navigator.clipboard?.writeText(json).then(()=>dispatch('EXPORT_SUCCESS')).catch(()=>dispatch('EXPORT_FAIL'))"
      ],
      "expected_observables": [
        "dom:#exportBtn"
      ],
      "timeout": 3000
    },
    {
      "from": "S12_Exporting",
      "to": "S0_Idle",
      "event": "EXPORT_SUCCESS",
      "guard": "true",
      "actions": [
        "alert('Graph JSON copied to clipboard.')",
        "render()"
      ],
      "expected_observables": [
        "dom:#exportBtn",
        "dom:window.alert"
      ],
      "timeout": 1000
    },
    {
      "from": "S12_Exporting",
      "to": "S0_Idle",
      "event": "EXPORT_FAIL",
      "guard": "true",
      "actions": [
        "prompt('Copy this JSON', json)",
        "render()"
      ],
      "expected_observables": [
        "dom:#exportBtn"
      ],
      "timeout": 2000
    },
    {
      "from": "S0_Idle",
      "to": "S13_Importing",
      "event": "CLICK_IMPORT",
      "guard": "true",
      "actions": [
        "input = prompt('Paste graph JSON (nodes & edges arrays):')",
        "dispatch('IMPORT_PROVIDED', input)"
      ],
      "expected_observables": [
        "dom:#importBtn"
      ],
      "timeout": 30000
    },
    {
      "from": "S13_Importing",
      "to": "S0_Idle",
      "event": "IMPORT_PROVIDED",
      "guard": "input != null",
      "actions": [
        "try { obj = JSON.parse(input); if(!Array.isArray(obj.nodes)||!Array.isArray(obj.edges)) throw Error('Invalid format'); graph = { nodes: obj.nodes.slice(), edges: obj.edges.slice() }; state.nextNodeId = (graph.nodes.reduce((m,n)=>Math.max(m,n.id),0)||0)+1; state.nextEdgeId = (graph.edges.reduce((m,e)=>Math.max(m,e.id),0)||0)+1; render(); dispatch('IMPORT_SUCCESS'); } catch(err){ dispatch('IMPORT_FAIL', err) }"
      ],
      "expected_observables": [
        "dom:#importBtn",
        "dom:#adjText"
      ],
      "timeout": 2000
    },
    {
      "from": "S13_Importing",
      "to": "S15_ErrorAlert",
      "event": "IMPORT_FAIL",
      "guard": "true",
      "actions": [
        "alert('Failed to import JSON: ' + (error?.message || error))"
      ],
      "expected_observables": [
        "dom:#importBtn",
        "dom:window.alert"
      ],
      "timeout": 1000
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "CLICK_DELETE_SELECTED",
      "guard": "state.selectedNodeId === null",
      "actions": [
        "alert('No node selected.')"
      ],
      "expected_observables": [
        "dom:#deleteSelected",
        "dom:window.alert"
      ],
      "timeout": 500
    },
    {
      "from": "S5_NodeSelected",
      "to": "S0_Idle",
      "event": "CLICK_DELETE_SELECTED",
      "guard": "state.selectedNodeId !== null",
      "actions": [
        "nid = state.selectedNodeId",
        "graph.nodes = graph.nodes.filter(n=>n.id!==nid)",
        "graph.edges = graph.edges.filter(e=>e.from!==nid && e.to!==nid)",
        "state.selectedNodeId = null",
        "render()"
      ],
      "expected_observables": [
        "dom:#deleteSelected",
        "dom:#nodeCount",
        "dom:#edgeCount",
        "dom:#adjText"
      ],
      "timeout": 1000
    },
    {
      "from": "S6_EdgeSelected",
      "to": "S0_Idle",
      "event": "CLICK_DELETE_EDGE",
      "guard": "state.selectedEdgeId !== null",
      "actions": [
        "eid = state.selectedEdgeId",
        "graph.edges = graph.edges.filter(e=>e.id!==eid)",
        "state.selectedEdgeId = null",
        "render()"
      ],
      "expected_observables": [
        "dom:#deleteEdge",
        "dom:#edgeCount",
        "dom:#adjText"
      ],
      "timeout": 1000
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "KEY_DELETE",
      "guard": "state.selectedNodeId === null && state.selectedEdgeId === null",
      "actions": [
        "noOp()",
        "alert('No node selected.')"
      ],
      "expected_observables": [
        "dom:window"
      ],
      "timeout": 500
    },
    {
      "from": "S5_NodeSelected",
      "to": "S0_Idle",
      "event": "KEY_DELETE",
      "guard": "state.selectedNodeId !== null",
      "actions": [
        "trigger('#deleteSelected')"
      ],
      "expected_observables": [
        "dom:#deleteSelected"
      ],
      "timeout": 1000
    },
    {
      "from": "S6_EdgeSelected",
      "to": "S0_Idle",
      "event": "KEY_DELETE",
      "guard": "state.selectedEdgeId !== null",
      "actions": [
        "trigger('#deleteEdge')"
      ],
      "expected_observables": [
        "dom:#deleteEdge"
      ],
      "timeout": 1000
    },
    {
      "from": "S0_Idle",
      "to": "S2_ModeAddEdge",
      "event": "KEY_TOGGLE_EDGE_MODE",
      "guard": "true",
      "actions": [
        "trigger('#modeAddEdge')"
      ],
      "expected_observables": [
        "dom:#modeAddEdge"
      ],
      "timeout": 200
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "CHANGE_DIRECTED",
      "guard": "true",
      "actions": [
        "render()"
      ],
      "expected_observables": [
        "dom:#directed"
      ],
      "timeout": 200
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "CHANGE_WEIGHTED",
      "guard": "true",
      "actions": [
        "/* toggles weightedCheckbox; createEdge will prompt when needed */",
        "noOp()"
      ],
      "expected_observables": [
        "dom:#weighted"
      ],
      "timeout": 200
    },
    {
      "from": "S0_Idle",
      "to": "S5_NodeSelected",
      "event": "ADJTEXT_CLICK",
      "guard": "selectionMatchesNodeId",
      "actions": [
        "selectNode(parsedId)",
        "render()"
      ],
      "expected_observables": [
        "dom:#adjText",
        "dom:[data-node-id]"
      ],
      "timeout": 500
    }
  ],
  "components": [
    "#svgCanvas",
    "#adjText",
    "#adjContainer",
    "#nodeCount",
    "#edgeCount",
    "#directed",
    "#weighted",
    "#modeAddEdge",
    "#clearBtn",
    "#sampleBtn",
    "#autoLayout",
    "#exportBtn",
    "#importBtn",
    "#deleteSelected",
    "#deleteEdge",
    "line[data-edge-id]",
    "[data-node-id]",
    ".wrap",
    ".panel",
    ".controls",
    ".small",
    ".active",
    ".svg-wrap",
    ".adj-list",
    ".row",
    ".muted",
    ".legend",
    ".bubble",
    ".node-b",
    ".edge-b",
    ".help",
    ".top-controls",
    ".right-top",
    ".node-label",
    ".edge-label",
    "pre.adj-text"
  ]
}