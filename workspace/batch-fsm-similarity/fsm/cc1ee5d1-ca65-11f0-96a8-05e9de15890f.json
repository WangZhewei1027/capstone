{
  "meta": {
    "concept": "HuffmanCoding",
    "topic": "Huffman Coding Demonstration",
    "educational_goal": "Interactive construction of Huffman tree, generation of prefix codes, encoding and decoding bitstrings, and stepwise visualization of merges",
    "expected_interactions": [
      "build",
      "sample",
      "clear",
      "navigate_steps",
      "select_step",
      "decode",
      "copy_bits",
      "download_bits",
      "reset_view"
    ]
  },
  "states": [
    {
      "id": "S0_Idle",
      "label": "Idle",
      "type": "idle",
      "entry_actions": [
        "resetDisplay()",
        "enableControls()"
      ],
      "exit_actions": []
    },
    {
      "id": "S1_Building",
      "label": "BuildingTree",
      "type": "atomic",
      "entry_actions": [
        "computeFrequencies(inputText.value)",
        "buildHuffmanSnapshots(freqMap)",
        "generateCodes(nodesMap)",
        "encodeText(inputText.value, codes)"
      ],
      "exit_actions": []
    },
    {
      "id": "S2_Built",
      "label": "TreeBuilt",
      "type": "atomic",
      "entry_actions": [
        "populateFreqTable(freqArray)",
        "populateCodeTable(codes)",
        "populateBitstring(bitstring)",
        "updateStats(origBits, compBits, ratio)",
        "renderStepsList(snapshots, mergeSteps, nodesMap)",
        "setStep(finalIndex)",
        "drawForest(globalNodesMap, finalSnapshot.roots)"
      ],
      "exit_actions": []
    },
    {
      "id": "S3_Error_NoInput",
      "label": "Error_NoInput",
      "type": "atomic",
      "entry_actions": [
        "alert('Please enter some text.')"
      ],
      "exit_actions": []
    },
    {
      "id": "S4_StepViewing",
      "label": "StepViewing",
      "type": "atomic",
      "entry_actions": [
        "setStep(index)",
        "drawForest(globalNodesMap, snapshot.roots)",
        "highlightStepInList(index)"
      ],
      "exit_actions": []
    },
    {
      "id": "S5_Decoding",
      "label": "Decoding",
      "type": "atomic",
      "entry_actions": [
        "readDecodeInput()",
        "validateBitsFormat()"
      ],
      "exit_actions": []
    },
    {
      "id": "S6_DecodeEmpty",
      "label": "DecodeEmptyInput",
      "type": "atomic",
      "entry_actions": [
        "displayDecodedOutput('(empty)')"
      ],
      "exit_actions": []
    },
    {
      "id": "S7_DecodeInvalid",
      "label": "DecodeInvalidBits",
      "type": "atomic",
      "entry_actions": [
        "displayDecodedOutput('Invalid bits (only 0/1 allowed).')"
      ],
      "exit_actions": []
    },
    {
      "id": "S8_DecodeSuccess",
      "label": "DecodeSuccess",
      "type": "atomic",
      "entry_actions": [
        "decodeBitsToText(bits, globalNodesMap, globalRootId)",
        "displayDecodedOutput(decodedText || '(no output)')"
      ],
      "exit_actions": []
    },
    {
      "id": "S9_Copying",
      "label": "CopyingBits",
      "type": "atomic",
      "entry_actions": [
        "navigator.clipboard.writeText(bitstring)",
        "updateCopyButtonLabel('Copied!')"
      ],
      "exit_actions": [
        "revertCopyButtonLabel()"
      ]
    },
    {
      "id": "S10_Downloading",
      "label": "DownloadingBits",
      "type": "atomic",
      "entry_actions": [
        "createBlobAndTriggerDownload(bitstring, 'huffman_bits.txt')"
      ],
      "exit_actions": []
    },
    {
      "id": "S11_SampleLoaded",
      "label": "SampleLoaded",
      "type": "atomic",
      "entry_actions": [
        "inputText.value = 'Huffman coding is a compression algorithm that assigns shorter codes to more frequent symbols.'"
      ],
      "exit_actions": []
    },
    {
      "id": "S12_Cleared",
      "label": "Cleared",
      "type": "atomic",
      "entry_actions": [
        "inputText.value = ''",
        "resetDisplay()"
      ],
      "exit_actions": [
        "returnToIdle()"
      ]
    },
    {
      "id": "S13_ResetView",
      "label": "ResetViewToFinalStep",
      "type": "atomic",
      "entry_actions": [
        "setStep(globalSnapshots.length - 1)",
        "drawForest(globalNodesMap, globalSnapshots[globalSnapshots.length - 1].roots)"
      ],
      "exit_actions": []
    }
  ],
  "events": [
    {
      "id": "USER_CLICK_BUILD",
      "event_type": "user_action",
      "description": "User clicks the Build Huffman Tree & Encode button (#buildBtn)"
    },
    {
      "id": "EVENT_AUTO_BUILD",
      "event_type": "system_event",
      "description": "Script programmatically triggers build on initialization (buildBtn.click())"
    },
    {
      "id": "USER_CLICK_SAMPLE",
      "event_type": "user_action",
      "description": "User clicks the Load sample button (#sampleBtn)"
    },
    {
      "id": "USER_CLICK_CLEAR",
      "event_type": "user_action",
      "description": "User clicks the Clear button (#clearBtn)"
    },
    {
      "id": "USER_CLICK_PREV",
      "event_type": "user_action",
      "description": "User clicks Prev step (#prevStep)"
    },
    {
      "id": "USER_CLICK_NEXT",
      "event_type": "user_action",
      "description": "User clicks Next step (#nextStep)"
    },
    {
      "id": "USER_CLICK_STEP",
      "event_type": "user_action",
      "description": "User clicks a specific step in the steps list (elements '.step' inside #stepsList)"
    },
    {
      "id": "USER_CLICK_DECODE",
      "event_type": "user_action",
      "description": "User clicks the Decode button (#decodeBtn)"
    },
    {
      "id": "USER_CLICK_COPY_BITS",
      "event_type": "user_action",
      "description": "User clicks the Copy bits button (#copyBits)"
    },
    {
      "id": "USER_CLICK_DOWNLOAD_BITS",
      "event_type": "user_action",
      "description": "User clicks the Download bits button (#downloadBits)"
    },
    {
      "id": "USER_CLICK_RESET_VIEW",
      "event_type": "user_action",
      "description": "User clicks the Reset view button (#resetBtn)"
    },
    {
      "id": "SYSTEM_BUILD_COMPLETE",
      "event_type": "system_event",
      "description": "Build logic finished and UI populated (synchronous completion inside click handler)"
    },
    {
      "id": "SYSTEM_COPY_SUCCESS",
      "event_type": "system_event",
      "description": "Clipboard write succeeded (after clicking #copyBits)"
    },
    {
      "id": "SYSTEM_COPY_FAILED",
      "event_type": "system_event",
      "description": "Clipboard write failed (after clicking #copyBits)"
    },
    {
      "id": "SYSTEM_DOWNLOAD_COMPLETE",
      "event_type": "system_event",
      "description": "Download anchor click triggered and blob created (after clicking #downloadBits)"
    }
  ],
  "transitions": [
    {
      "from": "S0_Idle",
      "to": "S1_Building",
      "event": "USER_CLICK_BUILD",
      "guard": "inputNotEmpty",
      "actions": [
        "computeFrequencies(inputText.value)",
        "buildHuffmanSnapshots(freqMap)",
        "generateCodes(nodesMap)",
        "encodeText(inputText.value, codes)"
      ],
      "triggers": "#buildBtn",
      "expected_observables": [
        "dom:#freqTable tbody",
        "dom:#codeTable tbody",
        "dom:#bitstringBox",
        "dom:#stepsList",
        "dom:#treeSvg"
      ],
      "timeout": 3000
    },
    {
      "from": "S0_Idle",
      "to": "S3_Error_NoInput",
      "event": "USER_CLICK_BUILD",
      "guard": "inputEmpty",
      "actions": [
        "alert('Please enter some text.')"
      ],
      "triggers": "#buildBtn",
      "expected_observables": [],
      "timeout": 500
    },
    {
      "from": "S0_Idle",
      "to": "S1_Building",
      "event": "EVENT_AUTO_BUILD",
      "guard": "inputNotEmpty",
      "actions": [
        "computeFrequencies(inputText.value)",
        "buildHuffmanSnapshots(freqMap)",
        "generateCodes(nodesMap)",
        "encodeText(inputText.value, codes)"
      ],
      "triggers": "#buildBtn",
      "expected_observables": [
        "dom:#freqTable tbody",
        "dom:#codeTable tbody",
        "dom:#bitstringBox",
        "dom:#stepsList",
        "dom:#treeSvg"
      ],
      "timeout": 3000
    },
    {
      "from": "S1_Building",
      "to": "S2_Built",
      "event": "SYSTEM_BUILD_COMPLETE",
      "guard": "true",
      "actions": [
        "populateFreqTable(freqArray)",
        "populateCodeTable(codes)",
        "populateBitstring(bitstring)",
        "updateStats(origBits, compBits, ratio)",
        "renderStepsList(snapshots, mergeSteps, nodesMap)",
        "setStep(finalIndex)"
      ],
      "triggers": "",
      "expected_observables": [
        "dom:#freqTable tbody",
        "dom:#codeTable tbody",
        "dom:#bitstringBox",
        "dom:#stepsList",
        "dom:#treeSvg",
        "dom:#currStep",
        "dom:#totalSteps"
      ],
      "timeout": 0
    },
    {
      "from": "S2_Built",
      "to": "S4_StepViewing",
      "event": "USER_CLICK_STEP",
      "guard": "true",
      "actions": [
        "setStep(clickedIndex)",
        "drawForest(globalNodesMap, snapshot.roots)"
      ],
      "triggers": "#stepsList .step, #stepsList > .step",
      "expected_observables": [
        "dom:#treeSvg",
        "dom:#currStep",
        "dom:.step.active"
      ],
      "timeout": 500
    },
    {
      "from": "S2_Built",
      "to": "S4_StepViewing",
      "event": "USER_CLICK_PREV",
      "guard": "true",
      "actions": [
        "setStep(Math.max(0, currentStepIndex - 1))",
        "drawForest(globalNodesMap, snapshot.roots)"
      ],
      "triggers": "#prevStep",
      "expected_observables": [
        "dom:#treeSvg",
        "dom:#currStep"
      ],
      "timeout": 200
    },
    {
      "from": "S2_Built",
      "to": "S4_StepViewing",
      "event": "USER_CLICK_NEXT",
      "guard": "true",
      "actions": [
        "setStep(Math.min(globalSnapshots.length - 1, currentStepIndex + 1))",
        "drawForest(globalNodesMap, snapshot.roots)"
      ],
      "triggers": "#nextStep",
      "expected_observables": [
        "dom:#treeSvg",
        "dom:#currStep"
      ],
      "timeout": 200
    },
    {
      "from": "S2_Built",
      "to": "S5_Decoding",
      "event": "USER_CLICK_DECODE",
      "guard": "treeExists and decodeInputProvided",
      "actions": [
        "readDecodeInput()",
        "validateBitsFormat()"
      ],
      "triggers": "#decodeBtn",
      "expected_observables": [
        "dom:#decodedOutput"
      ],
      "timeout": 500
    },
    {
      "from": "S2_Built",
      "to": "S6_DecodeEmpty",
      "event": "USER_CLICK_DECODE",
      "guard": "decodeInputEmpty",
      "actions": [
        "displayDecodedOutput('(empty)')"
      ],
      "triggers": "#decodeBtn",
      "expected_observables": [
        "dom:#decodedOutput"
      ],
      "timeout": 200
    },
    {
      "from": "S2_Built",
      "to": "S7_DecodeInvalid",
      "event": "USER_CLICK_DECODE",
      "guard": "decodeInputInvalidFormat",
      "actions": [
        "displayDecodedOutput('Invalid bits (only 0/1 allowed).')"
      ],
      "triggers": "#decodeBtn",
      "expected_observables": [
        "dom:#decodedOutput"
      ],
      "timeout": 200
    },
    {
      "from": "S5_Decoding",
      "to": "S8_DecodeSuccess",
      "event": "SYSTEM_BUILD_COMPLETE",
      "guard": "bitsValid and treeExists",
      "actions": [
        "decoded = decodeBitsToText(bits, globalNodesMap, globalRootId)",
        "displayDecodedOutput(decoded || '(no output)')"
      ],
      "triggers": "#decodeBtn",
      "expected_observables": [
        "dom:#decodedOutput"
      ],
      "timeout": 500
    },
    {
      "from": "S8_DecodeSuccess",
      "to": "S2_Built",
      "event": "true",
      "guard": "true",
      "actions": [],
      "triggers": "",
      "expected_observables": [],
      "timeout": 0
    },
    {
      "from": "S2_Built",
      "to": "S9_Copying",
      "event": "USER_CLICK_COPY_BITS",
      "guard": "bitstringNotEmpty",
      "actions": [
        "navigator.clipboard.writeText(bitstring)",
        "updateCopyButtonLabel('Copied!')"
      ],
      "triggers": "#copyBits",
      "expected_observables": [
        "dom:#copyBits"
      ],
      "timeout": 2000
    },
    {
      "from": "S9_Copying",
      "to": "S2_Built",
      "event": "SYSTEM_COPY_SUCCESS",
      "guard": "true",
      "actions": [
        "setTimeout(revertCopyButtonLabel, 1200)"
      ],
      "triggers": "",
      "expected_observables": [
        "dom:#copyBits"
      ],
      "timeout": 1500
    },
    {
      "from": "S9_Copying",
      "to": "S2_Built",
      "event": "SYSTEM_COPY_FAILED",
      "guard": "true",
      "actions": [
        "updateCopyButtonLabel('Failed')",
        "setTimeout(revertCopyButtonLabel, 1200)"
      ],
      "triggers": "",
      "expected_observables": [
        "dom:#copyBits"
      ],
      "timeout": 1500
    },
    {
      "from": "S2_Built",
      "to": "S10_Downloading",
      "event": "USER_CLICK_DOWNLOAD_BITS",
      "guard": "bitstringNotEmpty",
      "actions": [
        "createBlobAndTriggerDownload(bitstring, 'huffman_bits.txt')"
      ],
      "triggers": "#downloadBits",
      "expected_observables": [
        "dom:anchor[download='huffman_bits.txt']"
      ],
      "timeout": 1000
    },
    {
      "from": "S10_Downloading",
      "to": "S2_Built",
      "event": "SYSTEM_DOWNLOAD_COMPLETE",
      "guard": "true",
      "actions": [],
      "triggers": "",
      "expected_observables": [],
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S11_SampleLoaded",
      "event": "USER_CLICK_SAMPLE",
      "guard": "true",
      "actions": [
        "inputText.value = 'Huffman coding is a compression algorithm that assigns shorter codes to more frequent symbols.'"
      ],
      "triggers": "#sampleBtn",
      "expected_observables": [
        "dom:#inputText"
      ],
      "timeout": 0
    },
    {
      "from": "S2_Built",
      "to": "S12_Cleared",
      "event": "USER_CLICK_CLEAR",
      "guard": "true",
      "actions": [
        "inputText.value = ''",
        "resetDisplay()"
      ],
      "triggers": "#clearBtn",
      "expected_observables": [
        "dom:#freqTable tbody",
        "dom:#codeTable tbody",
        "dom:#bitstringBox",
        "dom:#stepsList",
        "dom:#treeSvg",
        "dom:#currStep",
        "dom:#totalSteps"
      ],
      "timeout": 200
    },
    {
      "from": "S12_Cleared",
      "to": "S0_Idle",
      "event": "true",
      "guard": "true",
      "actions": [],
      "triggers": "",
      "expected_observables": [],
      "timeout": 0
    },
    {
      "from": "S2_Built",
      "to": "S13_ResetView",
      "event": "USER_CLICK_RESET_VIEW",
      "guard": "globalSnapshots && globalSnapshots.length > 0",
      "actions": [
        "setStep(globalSnapshots.length - 1)",
        "drawForest(globalNodesMap, globalSnapshots[globalSnapshots.length - 1].roots)"
      ],
      "triggers": "#resetBtn",
      "expected_observables": [
        "dom:#treeSvg",
        "dom:#currStep"
      ],
      "timeout": 200
    },
    {
      "from": "S11_SampleLoaded",
      "to": "S0_Idle",
      "event": "true",
      "guard": "true",
      "actions": [],
      "triggers": "",
      "expected_observables": [
        "dom:#inputText"
      ],
      "timeout": 0
    }
  ],
  "components": [
    "#inputText",
    "#buildBtn",
    "#sampleBtn",
    "#clearBtn",
    "#decodeBits",
    "#decodeBtn",
    "#decodedOutput",
    "#uniqueCount",
    "#origBits",
    "#compBits",
    "#ratio",
    "#freqTable tbody",
    "#codeTable tbody",
    "#bitstringBox",
    "#copyBits",
    "#downloadBits",
    "#resetBtn",
    "#treeSvg",
    "#stepsList",
    ".step",
    "#prevStep",
    "#nextStep",
    "#currStep",
    "#totalSteps"
  ]
}