{
  "meta": {
    "concept": "BinarySearch",
    "topic": "Binary Search - Interactive Demo",
    "educational_goal": "Visualize binary search steps (iterative & recursive), show mid/low/high progression, count comparisons, and animate stepping & autoplay.",
    "expected_interactions": [
      "apply",
      "generate",
      "pick_random_target",
      "play_pause",
      "next",
      "prev",
      "reset",
      "change_variant",
      "change_speed",
      "keyboard_shortcuts"
    ]
  },
  "states": [
    {
      "id": "S0_Idle",
      "label": "idle",
      "type": "idle",
      "entry_actions": [
        "highlightPseudocode(0, variantSelect.value)",
        "renderArrayCells()",
        "updateUI()"
      ],
      "exit_actions": []
    },
    {
      "id": "S1_ApplyingSettings",
      "label": "applying_settings",
      "type": "atomic",
      "entry_actions": [
        "applySettings()",
        "parseArrayText(arrayInput.value)",
        "renderArrayCells()",
        "message.textContent = 'Computing steps...'"
      ],
      "exit_actions": []
    },
    {
      "id": "S2_GeneratingArray",
      "label": "generating_array",
      "type": "atomic",
      "entry_actions": [
        "generateRandomArray()",
        "arrayInput.value = generated",
        "applySettings()"
      ],
      "exit_actions": []
    },
    {
      "id": "S3_Ready",
      "label": "ready",
      "type": "idle",
      "entry_actions": [
        "buildStatesAndReset()",
        "updateUI()",
        "message.textContent = 'Ready — step through'",
        "statusTxt.textContent = 'ready'"
      ],
      "exit_actions": []
    },
    {
      "id": "S4_Playing",
      "label": "playing",
      "type": "atomic",
      "entry_actions": [
        "startPlaying()",
        "playBtn.textContent = 'Pause ⏸'"
      ],
      "exit_actions": [
        "stopPlaying()",
        "playBtn.textContent = 'Play ▶️'"
      ]
    },
    {
      "id": "S5_Stepping",
      "label": "stepping",
      "type": "atomic",
      "entry_actions": [
        "stopPlaying()",
        "updateUI()",
        "highlightPseudocode(currentLine, variantSelect.value)"
      ],
      "exit_actions": []
    },
    {
      "id": "S6_Comparing",
      "label": "comparing",
      "type": "atomic",
      "entry_actions": [
        "highlight mid cell (#arrayRow .cell[data-index=\"{mid}\"])",
        "increment compCount()",
        "highlightPseudocode(line 4 or 5)"
      ],
      "exit_actions": [
        "clearHighlights()"
      ]
    },
    {
      "id": "S7_Found",
      "label": "found",
      "type": "atomic",
      "entry_actions": [
        "mark cell found (add 'found' class)",
        "message.textContent = 'Target found!'",
        "statusTxt.textContent = 'found'",
        "resultBadge.style.background = 'linear-gradient(90deg,#16a34a,#34d399)'"
      ],
      "exit_actions": []
    },
    {
      "id": "S8_NotFound",
      "label": "not_found",
      "type": "atomic",
      "entry_actions": [
        "message.textContent = 'Target does not exist in the array'",
        "statusTxt.textContent = 'not found'",
        "resultBadge.style.background = 'linear-gradient(90deg,#ef4444,#fb7185)'"
      ],
      "exit_actions": []
    },
    {
      "id": "S9_ArrayEmpty",
      "label": "array_empty",
      "type": "atomic",
      "entry_actions": [
        "message.textContent = 'Array empty'",
        "submessage.textContent = 'Please provide numbers separated by commas or generate an array.'",
        "arr = []",
        "renderArrayCells()"
      ],
      "exit_actions": []
    },
    {
      "id": "S10_TargetInvalid",
      "label": "target_invalid",
      "type": "atomic",
      "entry_actions": [
        "message.textContent = 'Target not set'",
        "submessage.textContent = 'Enter a numeric target value to start the demonstration.'",
        "statusTxt.textContent = 'idle'"
      ],
      "exit_actions": []
    },
    {
      "id": "S11_Reset",
      "label": "reset",
      "type": "atomic",
      "entry_actions": [
        "stopPlaying()",
        "step = 0",
        "updateUI()"
      ],
      "exit_actions": []
    },
    {
      "id": "S12_Rebuilding",
      "label": "rebuilding_states",
      "type": "atomic",
      "entry_actions": [
        "buildStatesAndReset()",
        "message.textContent = 'Computing steps...'"
      ],
      "exit_actions": []
    }
  ],
  "events": [
    {
      "id": "USER_CLICK_APPLY",
      "event_type": "user_action",
      "description": "User clicks the Apply / Start button",
      "triggers": "#applyBtn"
    },
    {
      "id": "USER_CTRLENTER_ARRAYINPUT",
      "event_type": "user_action",
      "description": "User presses Ctrl/Cmd+Enter inside array textarea to apply",
      "triggers": "#arrayInput (keydown Ctrl/Cmd+Enter)"
    },
    {
      "id": "USER_CLICK_GENERATE",
      "event_type": "user_action",
      "description": "User clicks Generate random sorted array",
      "triggers": "#generateBtn"
    },
    {
      "id": "USER_CLICK_RANDOM_TARGET",
      "event_type": "user_action",
      "description": "User clicks Pick random target",
      "triggers": "#randomTargetBtn"
    },
    {
      "id": "USER_CLICK_PLAY",
      "event_type": "user_action",
      "description": "User clicks Play / Pause",
      "triggers": "#playBtn, body (spacebar)"
    },
    {
      "id": "USER_CLICK_NEXT",
      "event_type": "user_action",
      "description": "User clicks Next step",
      "triggers": "#nextBtn, body (ArrowRight)"
    },
    {
      "id": "USER_CLICK_PREV",
      "event_type": "user_action",
      "description": "User clicks Prev step",
      "triggers": "#prevBtn, body (ArrowLeft)"
    },
    {
      "id": "USER_CLICK_RESET",
      "event_type": "user_action",
      "description": "User clicks Reset",
      "triggers": "#resetBtn, body (r)"
    },
    {
      "id": "USER_CHANGE_VARIANT",
      "event_type": "user_action",
      "description": "User changes algorithm variant (iterative/recursive)",
      "triggers": "#variantSelect"
    },
    {
      "id": "USER_CHANGE_SPEED",
      "event_type": "user_action",
      "description": "User changes animation speed",
      "triggers": "#speedRange"
    },
    {
      "id": "USER_CHANGE_SIZE",
      "event_type": "user_action",
      "description": "User changes generate size input",
      "triggers": "#sizeInput"
    },
    {
      "id": "USER_TOGGLE_SORT",
      "event_type": "user_action",
      "description": "User toggles Keep array sorted",
      "triggers": "#sortChk"
    },
    {
      "id": "SYSTEM_STATES_COMPUTED",
      "event_type": "system_event",
      "description": "States for stepping have been computed (buildStatesAndReset finished)",
      "triggers": "#stepTotal, #statusTxt"
    },
    {
      "id": "SYSTEM_ARRAY_EMPTY",
      "event_type": "system_event",
      "description": "Computed or parsed array is empty",
      "triggers": "#arrayInput, #arrayRow"
    },
    {
      "id": "SYSTEM_TARGET_INVALID",
      "event_type": "system_event",
      "description": "Target could not be parsed to a number",
      "triggers": "#targetInput, #targetVal"
    },
    {
      "id": "SYSTEM_PLAYBACK_TICK",
      "event_type": "system_event",
      "description": "Playback interval tick fired (advance step)",
      "triggers": "#playBtn, #speedRange"
    },
    {
      "id": "SYSTEM_PLAYBACK_COMPLETE",
      "event_type": "system_event",
      "description": "Playback reached the last step and stopped",
      "triggers": "#stepIdx, #stepTotal, #playBtn"
    }
  ],
  "transitions": [
    {
      "from": "S0_Idle",
      "to": "S2_GeneratingArray",
      "event": "USER_CLICK_GENERATE",
      "guard": "true",
      "actions": [
        "generateBtn.click() -> generateRandomArray()",
        "arrayInput.value set to generated array",
        "applySettings()"
      ],
      "expected_observables": [
        "dom:#arrayInput.value changed",
        "dom:#arrayRow .cell created"
      ],
      "triggers": "#generateBtn",
      "timeout": 1200
    },
    {
      "from": "S0_Idle",
      "to": "S1_ApplyingSettings",
      "event": "USER_CLICK_APPLY",
      "guard": "arrayInput contains at least one numeric token",
      "actions": [
        "applySettings()",
        "parseArrayText(arrayInput.value)",
        "renderArrayCells()"
      ],
      "expected_observables": [
        "dom:#message changes to 'Computing steps...'",
        "dom:#arrayRow updated"
      ],
      "triggers": "#applyBtn",
      "timeout": 800
    },
    {
      "from": "S0_Idle",
      "to": "S1_ApplyingSettings",
      "event": "USER_CTRLENTER_ARRAYINPUT",
      "guard": "arrayInput contains at least one numeric token",
      "actions": [
        "applySettings()",
        "parseArrayText(arrayInput.value)"
      ],
      "expected_observables": [
        "dom:#message changes to 'Computing steps...'"
      ],
      "triggers": "#arrayInput (keydown Ctrl/Cmd+Enter)",
      "timeout": 800
    },
    {
      "from": "S1_ApplyingSettings",
      "to": "S9_ArrayEmpty",
      "event": "SYSTEM_ARRAY_EMPTY",
      "guard": "parsed array length === 0",
      "actions": [
        "message.textContent = 'Array empty'",
        "submessage.textContent = 'Please provide numbers...'"
      ],
      "expected_observables": [
        "dom:#message text 'Array empty'",
        "dom:#arrayRow is empty"
      ],
      "triggers": "#arrayInput, #arrayRow",
      "timeout": 400
    },
    {
      "from": "S1_ApplyingSettings",
      "to": "S10_TargetInvalid",
      "event": "SYSTEM_TARGET_INVALID",
      "guard": "target is null or NaN",
      "actions": [
        "message.textContent = 'Target not set'",
        "statusTxt.textContent = 'idle'"
      ],
      "expected_observables": [
        "dom:#targetVal shows '—' or 'invalid'",
        "dom:#message text 'Target not set'"
      ],
      "triggers": "#targetInput, #targetVal",
      "timeout": 400
    },
    {
      "from": "S1_ApplyingSettings",
      "to": "S3_Ready",
      "event": "SYSTEM_STATES_COMPUTED",
      "guard": "states.length > 0 && target is numeric",
      "actions": [
        "buildStatesAndReset()",
        "updateUI()",
        "step = 0"
      ],
      "expected_observables": [
        "dom:#stepTotal > 0",
        "dom:#statusTxt 'ready'",
        "dom:#message 'Ready — step through'"
      ],
      "triggers": "#stepTotal, #statusTxt",
      "timeout": 1000
    },
    {
      "from": "S3_Ready",
      "to": "S4_Playing",
      "event": "USER_CLICK_PLAY",
      "guard": "states.length > 0 and playing === false",
      "actions": [
        "startPlaying()",
        "playBtn.textContent = 'Pause ⏸'"
      ],
      "expected_observables": [
        "dom:#playBtn text contains 'Pause'",
        "dom:interval timer running"
      ],
      "triggers": "#playBtn, body (spacebar)",
      "timeout": 0
    },
    {
      "from": "S4_Playing",
      "to": "S3_Ready",
      "event": "USER_CLICK_PLAY",
      "guard": "playing === true",
      "actions": [
        "stopPlaying()",
        "playBtn.textContent = 'Play ▶️'"
      ],
      "expected_observables": [
        "dom:#playBtn text contains 'Play'",
        "dom:interval timer stopped"
      ],
      "triggers": "#playBtn, body (spacebar)",
      "timeout": 0
    },
    {
      "from": "S4_Playing",
      "to": "S3_Ready",
      "event": "SYSTEM_PLAYBACK_COMPLETE",
      "guard": "step >= states.length - 1",
      "actions": [
        "stopPlaying()",
        "message.textContent = 'Ready — step through'",
        "statusTxt.textContent = 'ready'"
      ],
      "expected_observables": [
        "dom:#playBtn text contains 'Play'",
        "dom:#stepIdx == dom:#stepTotal"
      ],
      "triggers": "#stepIdx, #stepTotal, #playBtn",
      "timeout": 0
    },
    {
      "from": "S3_Ready",
      "to": "S5_Stepping",
      "event": "USER_CLICK_NEXT",
      "guard": "states.length > 0 && step < states.length - 1",
      "actions": [
        "stopPlaying()",
        "step++",
        "updateUI()"
      ],
      "expected_observables": [
        "dom:#stepIdx incremented",
        "dom:#compCount updated",
        "dom:#arrayRow .cell classes updated (low/mid/high/found)"
      ],
      "triggers": "#nextBtn, body (ArrowRight)",
      "timeout": 0
    },
    {
      "from": "S3_Ready",
      "to": "S5_Stepping",
      "event": "USER_CLICK_PREV",
      "guard": "states.length > 0 && step > 0",
      "actions": [
        "stopPlaying()",
        "step--",
        "updateUI()"
      ],
      "expected_observables": [
        "dom:#stepIdx decremented",
        "dom:#arrayRow .cell classes updated"
      ],
      "triggers": "#prevBtn, body (ArrowLeft)",
      "timeout": 0
    },
    {
      "from": "S3_Ready",
      "to": "S11_Reset",
      "event": "USER_CLICK_RESET",
      "guard": "true",
      "actions": [
        "stopPlaying()",
        "step = 0",
        "updateUI()"
      ],
      "expected_observables": [
        "dom:#stepIdx set to 1 or 0 depending on states",
        "dom:#message updated"
      ],
      "triggers": "#resetBtn, body (r)",
      "timeout": 0
    },
    {
      "from": "S3_Ready",
      "to": "S12_Rebuilding",
      "event": "USER_CHANGE_VARIANT",
      "guard": "arr.length > 0 && target !== null",
      "actions": [
        "buildStatesAndReset()",
        "updateUI()"
      ],
      "expected_observables": [
        "dom:#stepTotal updated",
        "dom:#codeIter or #codeRec highlighted lines change"
      ],
      "triggers": "#variantSelect",
      "timeout": 800
    },
    {
      "from": "S4_Playing",
      "to": "S4_Playing",
      "event": "USER_CHANGE_SPEED",
      "guard": "playing === true",
      "actions": [
        "restart timer with new speed (startPlaying())"
      ],
      "expected_observables": [
        "dom:#speedRange value changed",
        "playback interval tick frequency changed"
      ],
      "triggers": "#speedRange",
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S1_ApplyingSettings",
      "event": "USER_CLICK_RANDOM_TARGET",
      "guard": "true",
      "actions": [
        "pickRandomTarget()",
        "targetInput.value set",
        "applySettings()"
      ],
      "expected_observables": [
        "dom:#targetInput value changed",
        "dom:#targetVal updated"
      ],
      "triggers": "#randomTargetBtn",
      "timeout": 600
    },
    {
      "from": "S3_Ready",
      "to": "S6_Comparing",
      "event": "SYSTEM_PLAYBACK_TICK",
      "guard": "playing === true and step < states.length - 1",
      "actions": [
        "step++",
        "updateUI()"
      ],
      "expected_observables": [
        "dom:#stepIdx incremented",
        "dom:#compCount updated",
        "dom:#arrayRow .cell classes (mid/low/high) updated"
      ],
      "triggers": "#playBtn, #speedRange",
      "timeout": 0
    },
    {
      "from": "S6_Comparing",
      "to": "S7_Found",
      "event": "SYSTEM_STATES_COMPUTED",
      "guard": "current state action === 'found'",
      "actions": [
        "mark mid as found",
        "message.textContent = 'Target found!'"
      ],
      "expected_observables": [
        "dom:#arrayRow .cell.found exists",
        "dom:#statusTxt 'found'"
      ],
      "triggers": "#arrayRow .cell, #statusTxt",
      "timeout": 400
    },
    {
      "from": "S6_Comparing",
      "to": "S8_NotFound",
      "event": "SYSTEM_STATES_COMPUTED",
      "guard": "current state action indicates no-range or finished without find",
      "actions": [
        "message.textContent = 'Target does not exist in the array'",
        "statusTxt.textContent = 'not found'"
      ],
      "expected_observables": [
        "dom:#resultBadge background red gradient",
        "dom:#statusTxt 'not found'"
      ],
      "triggers": "#statusTxt, #resultBadge",
      "timeout": 400
    },
    {
      "from": "S9_ArrayEmpty",
      "to": "S0_Idle",
      "event": "USER_CLICK_GENERATE",
      "guard": "user generates array",
      "actions": [
        "generateRandomArray()",
        "applySettings()"
      ],
      "expected_observables": [
        "dom:#arrayInput.value changed",
        "dom:#arrayRow updated"
      ],
      "triggers": "#generateBtn",
      "timeout": 1000
    },
    {
      "from": "S10_TargetInvalid",
      "to": "S1_ApplyingSettings",
      "event": "USER_CLICK_APPLY",
      "guard": "target now numeric",
      "actions": [
        "applySettings()",
        "buildStatesAndReset()"
      ],
      "expected_observables": [
        "dom:#targetVal updated",
        "dom:#stepTotal > 0"
      ],
      "triggers": "#applyBtn",
      "timeout": 800
    },
    {
      "from": "S12_Rebuilding",
      "to": "S3_Ready",
      "event": "SYSTEM_STATES_COMPUTED",
      "guard": "states rebuilt",
      "actions": [
        "updateUI()",
        "step = 0"
      ],
      "expected_observables": [
        "dom:#stepTotal updated",
        "dom:#message 'Ready — step through'"
      ],
      "triggers": "#stepTotal, #statusTxt",
      "timeout": 800
    }
  ],
  "components": [
    "#arrayInput",
    "#applyBtn",
    "#generateBtn",
    "#sizeInput",
    "#sortChk",
    "#targetInput",
    "#randomTargetBtn",
    "#variantSelect",
    "#speedRange",
    "#playBtn",
    "#prevBtn",
    "#nextBtn",
    "#resetBtn",
    "#arrayRow",
    "#stepIdx",
    "#stepTotal",
    "#compCount",
    "#nVal",
    "#targetVal",
    "#lowVal",
    "#midVal",
    "#highVal",
    "#statusTxt",
    "#message",
    "#submessage",
    "#resultBadge",
    "#codeIter .line",
    "#codeRec .line",
    ".cell",
    ".cell.low",
    ".cell.mid",
    ".cell.high",
    ".cell.found",
    ".legend .tag .dot"
  ]
}