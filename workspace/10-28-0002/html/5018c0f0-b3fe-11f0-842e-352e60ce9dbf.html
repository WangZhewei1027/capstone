<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bubble Sort Visualization</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 24px;
            background-color: #f4f4f9;
            color: #333;
        }
        h1, h2 {
            text-align: center;
        }
        #arrayContainer {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            margin: 24px 0;
            height: 300px;
            border: 1px solid #ccc;
            position: relative;
        }
        .bar {
            width: 20px;
            margin: 0 8px;
            background-color: #4CAF50;
            transition: height 0.3s, background-color 0.3s;
        }
        .active {
            background-color: #ff5722; /* Color for active comparison */
        }
        .swapped {
            background-color: #2196F3; /* Color when swapped */
        }
        .controls {
            display: flex;
            justify-content: center;
            margin-bottom: 16px;
        }
        button, input[type='range'] {
            margin: 0 8px;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button {
            background-color: #6200ea;
            color: white;
        }
        button:hover {
            background-color: #3700b3;
        }
        input[type='range'] {
            width: 200px;
        }
    </style>
</head>
<body>

    <h1>Big Bubbles Rise: Understanding Bubble Sort</h1>
    <h2>Visualize the bubble sort algorithm in action!</h2>
    
    <div id="arrayContainer"></div>
    
    <div class="controls">
        <button id="generateArray">Generate Random Array</button>
        <button id="startSort">Sort</button>
        <label for="speedControl">Speed:</label>
        <input type="range" id="speedControl" min="100" max="2000" step="100" value="500">
        <label>
            <input type="checkbox" id="stepThrough"> Step Through
        </label>
    </div>

    <script>
        const arrayContainer = document.getElementById('arrayContainer');
        const generateButton = document.getElementById('generateArray');
        const sortButton = document.getElementById('startSort');
        const speedControl = document.getElementById('speedControl');
        const stepThrough = document.getElementById('stepThrough');

        let array = [];
        const arraySize = 15;

        function generateArray() {
            array = Array.from({ length: arraySize }, () => Math.floor(Math.random() * 100) + 1);
            renderArray();
        }

        function renderArray() {
            arrayContainer.innerHTML = ''; 
            array.forEach(num => {
                const bar = document.createElement('div');
                bar.className = 'bar';
                bar.style.height = `${num * 3}px`;
                arrayContainer.appendChild(bar);
            });
        }

        async function bubbleSort() {
            const bars = document.querySelectorAll('.bar');
            const speed = parseInt(speedControl.value);
            let isSorted;
            for (let i = 0; i < array.length - 1; i++) {
                isSorted = true;
                for (let j = 0; j < array.length - 1 - i; j++) {
                    bars[j].classList.add('active');
                    bars[j + 1].classList.add('active');
                    await sleep(speed);

                    if (array[j] > array[j + 1]) {
                        // Swap
                        isSorted = false;
                        [array[j], array[j + 1]] = [array[j + 1], array[j]];
                        renderArray();
                        bars[j].classList.add('swapped');
                        bars[j + 1].classList.add('swapped');
                        await sleep(speed);
                    }

                    // Reset classes
                    bars[j].classList.remove('active');
                    bars[j + 1].classList.remove('active');
                    bars[j].classList.remove('swapped');
                    bars[j + 1].classList.remove('swapped');

                    if (stepThrough.checked) {
                        await sleep(speed);
                    }
                }
                if (isSorted) {
                    break; // No swaps means the array is sorted
                }
            }
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        generateButton.addEventListener('click', generateArray);
        sortButton.addEventListener('click', () => {
            bubbleSort();
        });

        // Initial array generation
        generateArray();
    </script>


  <script id="fsm" type="application/json">
    {
  "topic": "bubble sort",
  "description": "Finite state machine for visualizing the bubble sort algorithm.",
  "states": [
    {
      "name": "idle",
      "onEnter": "generateArray()",
      "on": {
        "GENERATE_ARRAY": "array_generated",
        "START_SORT": "sorting"
      }
    },
    {
      "name": "array_generated",
      "onEnter": "renderArray()",
      "on": {
        "START_SORT": "sorting"
      }
    },
    {
      "name": "sorting",
      "onEnter": "bubbleSort()",
      "onExit": "resetBars()",
      "on": {
        "SORT_COMPLETE": "sorted"
      }
    },
    {
      "name": "sorted",
      "onEnter": "displaySortedMessage()",
      "on": {
        "GENERATE_ARRAY": "array_generated",
        "START_SORT": "sorting"
      }
    }
  ],
  "events": [
    "GENERATE_ARRAY",
    "START_SORT",
    "SORT_COMPLETE"
  ],
  "notes": "The FSM captures the states of the bubble sort visualization, including idle state, array generation, sorting process, and completion. The transitions are triggered by button clicks and the completion of the sorting algorithm."
}
  </script>
</body>
</html>