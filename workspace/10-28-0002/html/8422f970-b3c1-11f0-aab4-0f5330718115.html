<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Hash Map</title>
  <style>
    :root {
      --bg: #f7f9fc;
      --card: #ffffff;
      --text: #222;
      --muted: #555;
      --border: #e1e5ea;
      --accent: #276ef1;
      --accent-ghost: #e9f0ff;
      --good: #1a7f37;
      --bad: #c62828;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
    }
    header {
      padding: 24px 16px 8px;
      text-align: center;
    }
    h1 {
      margin: 0 0 8px;
      font-size: 28px;
    }
    p.subtitle {
      margin: 0 auto;
      max-width: 720px;
      color: var(--muted);
      font-size: 15px;
    }
    main {
      max-width: 880px;
      margin: 16px auto 40px;
      padding: 0 16px;
    }
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 16px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.04);
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 6px;
      font-size: 13px;
    }
    input[type="text"], select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
      background: #fff;
    }
    .row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }
    button {
      appearance: none;
      border: none;
      border-radius: 8px;
      padding: 10px 14px;
      font-size: 14px;
      cursor: pointer;
      background: var(--accent);
      color: #fff;
    }
    button.secondary {
      background: #fff;
      color: var(--text);
      border: 1px solid var(--border);
    }
    button.danger {
      background: var(--bad);
    }
    .status {
      margin-top: 10px;
      font-size: 14px;
      padding: 10px;
      border-radius: 8px;
      background: var(--accent-ghost);
      border: 1px solid #cfe0ff;
    }
    .status.good { background: #e9f6ee; border-color: #b8e0c8; color: var(--good); }
    .status.bad { background: #fdeaea; border-color: #f6c7c7; color: var(--bad); }
    .metrics {
      display: flex;
      gap: 14px;
      flex-wrap: wrap;
      margin-top: 8px;
      color: var(--muted);
      font-size: 13px;
    }
    .buckets {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 10px;
      margin-top: 14px;
    }
    .bucket {
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px;
      background: #fff;
    }
    .bucket h4 {
      margin: 0 0 6px;
      font-size: 13px;
      color: var(--muted);
    }
    .pair {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      font-size: 13px;
      padding: 6px 8px;
      border-radius: 6px;
      background: #f6f8fb;
    }
    .pair + .pair { margin-top: 6px; }
    .empty {
      font-size: 12px;
      color: var(--muted);
    }
    footer {
      text-align: center;
      color: var(--muted);
      font-size: 12px;
      padding: 18px;
    }
    code {
      background: #f1f4f8;
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 2px 6px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Hash Map</h1>
    <p class="subtitle">
      A hash map stores key–value pairs and uses a hash function to map keys to indices (buckets).
      Average-time operations put/get/remove are near O(1). Collisions are handled here with simple separate chaining.
    </p>
  </header>

  <main>
    <section class="card">
      <div class="grid">
        <div>
          <label for="bucketSize">Bucket count</label>
          <div class="row">
            <select id="bucketSize">
              <option value="13">13 (default)</option>
              <option value="17">17</option>
              <option value="23">23</option>
              <option value="31">31</option>
              <option value="53">53</option>
            </select>
            <button class="secondary" id="rebuildBtn" title="Recreate empty map with chosen size">Rebuild</button>
          </div>
          <div class="metrics" id="metrics"></div>
        </div>

        <div>
          <label>Try it</label>
          <div class="row">
            <input id="keyInput" type="text" placeholder="Key (e.g., user:42)">
            <input id="valInput" type="text" placeholder="Value (e.g., Alice)">
          </div>
          <div class="row" style="margin-top:8px">
            <button id="putBtn">Put</button>
            <button class="secondary" id="getBtn">Get</button>
            <button class="danger" id="delBtn">Remove</button>
            <button class="secondary" id="clearBtn">Clear</button>
          </div>
          <div id="status" class="status" style="display:none"></div>
        </div>
      </div>

      <div class="metrics" style="margin-top:12px">
        Hash function: <code>djb2</code> • Collision strategy: <code>separate chaining</code>
      </div>

      <div id="bucketsView" class="buckets"></div>
    </section>

    <section class="card" style="margin-top:16px">
      <h3 style="margin:0 0 8px">What is a hash map?</h3>
      <p style="margin:0">
        - A hash function turns a key into a number. The index is that number modulo the bucket count.
        - If multiple keys map to the same index, they collide; we store them in a small list in that bucket.
        - Performance depends on a good hash function and a reasonable load factor (items ÷ buckets).
      </p>
    </section>
  </main>

  <footer>
    Simple educational demo. Not production-ready; focuses on clarity over performance.
  </footer>

  <script>
    function hashKey(key) {
      key = String(key);
      let hash = 5381;
      for (let i = 0; i < key.length; i++) {
        hash = ((hash << 5) + hash) + key.charCodeAt(i);
        hash |= 0;
      }
      return Math.abs(hash);
    }

    class SimpleHashMap {
      constructor(size = 13) {
        this.size = size;
        this.buckets = Array.from({ length: size }, () => []);
        this.count = 0;
      }
      _index(key) {
        return hashKey(key) % this.size;
      }
      set(key, value) {
        const idx = this._index(key);
        const bucket = this.buckets[idx];
        for (let i = 0; i < bucket.length; i++) {
          if (bucket[i][0] === key) {
            bucket[i][1] = value;
            return { idx, updated: true };
          }
        }
        bucket.push([key, value]);
        this.count++;
        return { idx, updated: false };
      }
      get(key) {
        const idx = this._index(key);
        const bucket = this.buckets[idx];
        for (const [k, v] of bucket) {
          if (k === key) return { idx, value: v };
        }
        return { idx, value: undefined };
      }
      delete(key) {
        const idx = this._index(key);
        const bucket = this.buckets[idx];
        for (let i = 0; i < bucket.length; i++) {
          if (bucket[i][0] === key) {
            bucket.splice(i, 1);
            this.count--;
            return { idx, removed: true };
          }
        }
        return { idx, removed: false };
      }
      clear() {
        this.buckets = Array.from({ length: this.size }, () => []);
        this.count = 0;
      }
      entries() {
        const out = [];
        for (const bucket of this.buckets) {
          for (const [k, v] of bucket) out.push([k, v]);
        }
        return out;
      }
      loadFactor() {
        return this.size ? this.count / this.size : 0;
      }
    }

    const el = {
      size: document.getElementById('bucketSize'),
      rebuild: document.getElementById('rebuildBtn'),
      key: document.getElementById('keyInput'),
      val: document.getElementById('valInput'),
      put: document.getElementById('putBtn'),
      get: document.getElementById('getBtn'),
      del: document.getElementById('delBtn'),
      clear: document.getElementById('clearBtn'),
      status: document.getElementById('status'),
      metrics: document.getElementById('metrics'),
      bucketsView: document.getElementById('bucketsView'),
    };

    let map = new SimpleHashMap(parseInt(el.size.value, 10));

    function showStatus(text, type = 'info') {
      el.status.textContent = text;
      el.status.style.display = 'block';
      el.status.className = 'status ' + (type === 'good' ? 'good' : type === 'bad' ? 'bad' : '');
    }

    function render() {
      el.metrics.textContent = `Items: ${map.count} • Buckets: ${map.size} • Load factor: ${map.loadFactor().toFixed(3)}`;
      const frag = document.createDocumentFragment();
      for (let i = 0; i < map.buckets.length; i++) {
        const bucket = map.buckets[i];
        const div = document.createElement('div');
        div.className = 'bucket';
        const h4 = document.createElement('h4');
        h4.textContent = `Bucket ${i}`;
        div.appendChild(h4);
        if (bucket.length === 0) {
          const em = document.createElement('div');
          em.className = 'empty';
          em.textContent = 'empty';
          div.appendChild(em);
        } else {
          for (const [k, v] of bucket) {
            const p = document.createElement('div');
            p.className = 'pair';
            const left = document.createElement('span');
            left.textContent = String(k);
            const right = document.createElement('span');
            right.textContent = String(v);
            p.appendChild(left);
            p.appendChild(right);
            div.appendChild(p);
          }
        }
        frag.appendChild(div);
      }
      el.bucketsView.innerHTML = '';
      el.bucketsView.appendChild(frag);
    }

    function requireKey() {
      const key = el.key.value.trim();
      if (!key) {
        showStatus('Please enter a key.', 'bad');
        return null;
      }
      return key;
    }

    el.put.addEventListener('click', () => {
      const key = requireKey();
      if (!key) return;
      const value = el.val.value;
      const res = map.set(key, value);
      const msg = res.updated
        ? `Updated key "${key}" at bucket ${res.idx}.`
        : `Inserted key "${key}" at bucket ${res.idx}.`;
      showStatus(msg, 'good');
      render();
    });

    el.get.addEventListener('click', () => {
      const key = requireKey();
      if (!key) return;
      const res = map.get(key);
      if (res.value === undefined) {
        showStatus(`Key "${key}" not found (mapped to bucket ${res.idx}).`, 'bad');
      } else {
        showStatus(`Found "${key}" → "${res.value}" in bucket ${res.idx}.`, 'good');
      }
    });

    el.del.addEventListener('click', () => {
      const key = requireKey();
      if (!key) return;
      const res = map.delete(key);
      if (res.removed) {
        showStatus(`Removed "${key}" from bucket ${res.idx}.`, 'good');
        render();
      } else {
        showStatus(`Key "${key}" not found (bucket ${res.idx}).`, 'bad');
      }
    });

    el.clear.addEventListener('click', () => {
      map.clear();
      showStatus('Map cleared.', 'good');
      render();
    });

    el.rebuild.addEventListener('click', () => {
      const size = parseInt(el.size.value, 10);
      map = new SimpleHashMap(size);
      showStatus(`Rebuilt empty map with ${size} buckets.`, 'good');
      render();
    });

    render();
  </script>
</body>
</html>