<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Heap (Min/Max)</title>
<style>
  :root {
    --bg: #f7f7fa;
    --card: #ffffff;
    --border: #d9d9e3;
    --text: #1e1e2a;
    --muted: #666681;
    --accent: #3b82f6;
    --accent2: #10b981;
    --danger: #ef4444;
  }
  body {
    margin: 0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, Noto Sans, "Apple Color Emoji", "Segoe UI Emoji";
    background: var(--bg);
    color: var(--text);
  }
  header {
    padding: 16px;
    text-align: center;
    background: var(--card);
    border-bottom: 1px solid var(--border);
    position: sticky;
    top: 0;
    z-index: 10;
  }
  header h1 {
    margin: 0;
    font-size: 20px;
  }
  header p {
    margin: 6px 0 0;
    font-size: 13px;
    color: var(--muted);
  }
  .container {
    max-width: 1000px;
    margin: 20px auto;
    padding: 0 16px 40px;
  }
  .grid {
    display: grid;
    grid-template-columns: 1.2fr 1.8fr;
    gap: 16px;
  }
  .card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 14px;
  }
  .section-title {
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 10px;
    color: var(--muted);
  }
  .controls {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    align-items: end;
  }
  .controls .row {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
  }
  label {
    font-size: 13px;
    color: var(--muted);
  }
  input[type="number"],
  input[type="text"] {
    width: 100%;
    padding: 8px 10px;
    border: 1px solid var(--border);
    border-radius: 8px;
    font-size: 14px;
    outline: none;
    background: #fff;
    color: var(--text);
  }
  input[type="radio"] {
    accent-color: var(--accent);
  }
  button {
    padding: 8px 12px;
    font-size: 14px;
    border: 1px solid var(--border);
    border-radius: 8px;
    background: #fff;
    color: var(--text);
    cursor: pointer;
  }
  button.primary {
    background: var(--accent);
    border-color: var(--accent);
    color: #fff;
  }
  button.success {
    background: var(--accent2);
    border-color: var(--accent2);
    color: #fff;
  }
  button.danger {
    background: var(--danger);
    border-color: var(--danger);
    color: #fff;
  }
  button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
  .small {
    font-size: 12px;
    color: var(--muted);
  }
  .array-view {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 10px;
  }
  .box {
    min-width: 46px;
    padding: 8px 10px;
    border: 1px solid var(--border);
    border-radius: 10px;
    background: #fff;
    text-align: center;
    font-size: 14px;
    position: relative;
  }
  .idx {
    position: absolute;
    top: -8px;
    left: -8px;
    background: #eef2ff;
    color: #3b82f6;
    border: 1px solid #c7d2fe;
    border-radius: 8px;
    padding: 2px 6px;
    font-size: 11px;
  }
  .stats {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    margin-top: 8px;
    font-size: 13px;
    color: var(--muted);
  }
  .svg-wrap {
    width: 100%;
    height: 400px;
    border: 1px dashed var(--border);
    border-radius: 12px;
    background: #fafbff;
    position: relative;
    overflow: hidden;
  }
  svg {
    width: 100%;
    height: 100%;
  }
  .node {
    fill: #fff;
    stroke: #9aa7ff;
    stroke-width: 2;
  }
  .edge {
    stroke: #c7cdea;
    stroke-width: 2;
  }
  .node-text {
    font-size: 12px;
    fill: #111827;
    text-anchor: middle;
    dominant-baseline: middle;
    font-weight: 600;
  }
  .footer {
    margin-top: 8px;
    font-size: 12px;
    color: var(--muted);
  }
  @media (max-width: 860px) {
    .grid {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>
<body>
<header>
  <h1>Heap (Min/Max)</h1>
  <p>Interactive min/max heap with insert and extract operations, array and tree views</p>
</header>

<div class="container">
  <div class="grid">
    <div class="card">
      <div class="section-title">Controls</div>
      <div class="controls">
        <div class="row">
          <label>Heap type:</label>
          <label><input type="radio" name="type" value="min" checked /> Min-Heap</label>
          <label><input type="radio" name="type" value="max" /> Max-Heap</label>
          <span id="invariant" class="small"></span>
        </div>
        <div class="row" style="justify-content:flex-end">
          <button id="clearBtn" class="danger">Clear</button>
          <button id="randomBtn" class="success">Random fill</button>
        </div>

        <div class="row">
          <label for="valueInput">Insert value:</label>
          <input id="valueInput" type="number" placeholder="e.g. 42" />
          <button id="insertBtn" class="primary">Insert</button>
        </div>
        <div class="row">
          <button id="extractBtn">Extract root</button>
          <button id="peekBtn">Peek root</button>
          <span id="lastAction" class="small"></span>
        </div>

        <div class="row">
          <label for="csvInput">Build from list (CSV):</label>
          <input id="csvInput" type="text" placeholder="e.g. 7, 2, 9, 1, 5" />
          <button id="buildBtn">Build heap</button>
        </div>
        <div class="row">
          <label for="sizeInput">Random size:</label>
          <input id="sizeInput" type="number" min="1" value="10" />
          <label for="minInput">Min:</label>
          <input id="minInput" type="number" value="0" />
          <label for="maxInput">Max:</label>
          <input id="maxInput" type="number" value="100" />
        </div>
      </div>

      <div class="stats" id="stats"></div>

      <div class="section-title" style="margin-top:14px">Array view (level-order)</div>
      <div id="arrayView" class="array-view"></div>

      <div class="section-title" style="margin-top:14px">Tree view</div>
      <div class="svg-wrap">
        <svg id="heapSvg" viewBox="0 0 1000 400" preserveAspectRatio="none"></svg>
      </div>

      <div class="footer">
        Operations: insert and extract root run in O(log n); peek runs in O(1). Heap height is about log₂(n).
      </div>
    </div>

    <div class="card">
      <div class="section-title">About heaps</div>
      <div style="font-size:14px; line-height:1.6; color:#1f2937">
        <p>A heap is a binary tree stored as an array that satisfies the heap property:</p>
        <ul>
          <li>Min-heap: every parent is less than or equal to its children. The minimum element is at the root.</li>
          <li>Max-heap: every parent is greater than or equal to its children. The maximum element is at the root.</li>
        </ul>
        <p>Array mapping: for an element at index i, left child is at 2i+1, right child at 2i+2, and parent at floor((i-1)/2).</p>
        <p>Common uses include priority queues, scheduling, and algorithms like Dijkstra's and heapsort.</p>
      </div>
      <div class="section-title" style="margin-top:14px">Tips</div>
      <ul style="font-size:14px; line-height:1.6; color:#1f2937">
        <li>Switch between min and max to rebuild the heap under a different comparator.</li>
        <li>Use "Build heap" to efficiently heapify a list in linear time.</li>
        <li>Extract root repeatedly to produce a sorted order (ascending for min-heap, descending for max-heap).</li>
      </ul>
    </div>
  </div>
</div>

<script>
(function(){
  const typeRadios = Array.from(document.querySelectorAll('input[name="type"]'));
  const invariantEl = document.getElementById('invariant');
  const insertBtn = document.getElementById('insertBtn');
  const extractBtn = document.getElementById('extractBtn');
  const peekBtn = document.getElementById('peekBtn');
  const clearBtn = document.getElementById('clearBtn');
  const randomBtn = document.getElementById('randomBtn');
  const buildBtn = document.getElementById('buildBtn');
  const valueInput = document.getElementById('valueInput');
  const csvInput = document.getElementById('csvInput');
  const sizeInput = document.getElementById('sizeInput');
  const minInput = document.getElementById('minInput');
  const maxInput = document.getElementById('maxInput');
  const arrayView = document.getElementById('arrayView');
  const statsEl = document.getElementById('stats');
  const svg = document.getElementById('heapSvg');
  const lastActionEl = document.getElementById('lastAction');

  let heap = [];
  let heapType = 'min';

  function updateInvariantText() {
    invariantEl.textContent = heapType === 'min'
      ? 'Invariant: parent <= children'
      : 'Invariant: parent >= children';
  }

  function compare(a, b) {
    return heapType === 'min' ? a < b : a > b;
  }

  function swap(i, j) {
    const t = heap[i]; heap[i] = heap[j]; heap[j] = t;
  }

  function bubbleUp(i) {
    while (i > 0) {
      const p = (i - 1) >> 1;
      if (compare(heap[i], heap[p])) {
        swap(i, p);
        i = p;
      } else {
        break;
      }
    }
  }

  function bubbleDown(i) {
    const n = heap.length;
    while (true) {
      const l = 2 * i + 1;
      const r = 2 * i + 2;
      let best = i;
      if (l < n && compare(heap[l], heap[best])) best = l;
      if (r < n && compare(heap[r], heap[best])) best = r;
      if (best === i) break;
      swap(i, best);
      i = best;
    }
  }

  function insert(val) {
    heap.push(val);
    bubbleUp(heap.length - 1);
    render();
  }

  function extractRoot() {
    if (heap.length === 0) return null;
    const root = heap[0];
    const last = heap.pop();
    if (heap.length > 0) {
      heap[0] = last;
      bubbleDown(0);
    }
    render();
    return root;
  }

  function peekRoot() {
    return heap.length ? heap[0] : null;
  }

  function heapify(arr) {
    heap = arr.slice();
    for (let i = ((heap.length - 1) - 1) >> 1; i >= 0; i--) {
      bubbleDown(i);
    }
    render();
  }

  function height(n) {
    return n === 0 ? 0 : Math.floor(Math.log2(n)) + 1;
  }

  function updateStats() {
    const n = heap.length;
    const h = height(n);
    statsEl.innerHTML = `
      <span>Size: ${n}</span>
      <span>Height: ${h}</span>
      <span>Root: ${peekRoot() !== null ? peekRoot() : '—'}</span>
      <span>Time: insert/extract O(log n), peek O(1)</span>
    `;
  }

  function renderArray() {
    arrayView.innerHTML = '';
    heap.forEach((v, i) => {
      const d = document.createElement('div');
      d.className = 'box';
      d.textContent = v;
      const idx = document.createElement('span');
      idx.className = 'idx';
      idx.textContent = i;
      d.appendChild(idx);
      arrayView.appendChild(d);
    });
  }

  function renderTree() {
    const n = heap.length;
    const width = svg.clientWidth || 1000;
    const heightPx = svg.clientHeight || 400;
    const rows = height(n);
    const r = 18;
    const yPadding = 20;
    const xPadding = 30;

    svg.setAttribute('viewBox', `0 0 ${width} ${heightPx}`);
    while (svg.firstChild) svg.removeChild(svg.firstChild);

    if (n === 0) {
      const t = document.createElementNS('http://www.w3.org/2000/svg', 'text');
      t.setAttribute('x', width / 2);
      t.setAttribute('y', heightPx / 2);
      t.setAttribute('class', 'node-text');
      t.textContent = 'Heap is empty';
      svg.appendChild(t);
      return;
    }

    const positions = new Array(n);
    for (let i = 0; i < n; i++) {
      const level = Math.floor(Math.log2(i + 1));
      const firstIndexAtLevel = (1 << level) - 1;
      const idxInLevel = i - firstIndexAtLevel;
      const nodesInLevel = 1 << level;

      const y = yPadding + (rows === 1 ? heightPx / 2 : (heightPx - 2 * yPadding) * (level / (rows - 1)));
      const usableWidth = width - 2 * xPadding;
      const spacing = nodesInLevel > 1 ? usableWidth / (nodesInLevel - 1) : 0;
      const x = xPadding + spacing * idxInLevel;

      positions[i] = { x, y };
    }

    // Edges
    for (let i = 1; i < n; i++) {
      const parent = (i - 1) >> 1;
      const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
      line.setAttribute('x1', positions[parent].x);
      line.setAttribute('y1', positions[parent].y + r);
      line.setAttribute('x2', positions[i].x);
      line.setAttribute('y2', positions[i].y - r);
      line.setAttribute('class', 'edge');
      svg.appendChild(line);
    }

    // Nodes
    for (let i = 0; i < n; i++) {
      const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
      const c = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
      c.setAttribute('cx', positions[i].x);
      c.setAttribute('cy', positions[i].y);
      c.setAttribute('r', r);
      c.setAttribute('class', 'node');

      const txt = document.createElementNS('http://www.w3.org/2000/svg', 'text');
      txt.setAttribute('x', positions[i].x);
      txt.setAttribute('y', positions[i].y + 1);
      txt.setAttribute('class', 'node-text');
      txt.textContent = heap[i];

      g.appendChild(c);
      g.appendChild(txt);
      svg.appendChild(g);
    }
  }

  function render() {
    updateInvariantText();
    updateStats();
    renderArray();
    renderTree();
    updateButtons();
  }

  function updateButtons() {
    extractBtn.disabled = heap.length === 0;
    peekBtn.disabled = heap.length === 0;
    clearBtn.disabled = heap.length === 0;
  }

  // Event handlers
  typeRadios.forEach(r => {
    r.addEventListener('change', () => {
      const selected = typeRadios.find(x => x.checked)?.value || 'min';
      if (selected !== heapType) {
        heapType = selected;
        // Re-heapify under new comparator
        heapify(heap);
        lastActionEl.textContent = `Switched to ${heapType}-heap and rebuilt`;
      }
    });
  });

  insertBtn.addEventListener('click', () => {
    const v = Number(valueInput.value);
    if (!Number.isFinite(v)) {
      lastActionEl.textContent = 'Enter a valid number';
      return;
    }
    insert(v);
    valueInput.value = '';
    lastActionEl.textContent = `Inserted ${v}`;
  });

  valueInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') insertBtn.click();
  });

  extractBtn.addEventListener('click', () => {
    const root = extractRoot();
    lastActionEl.textContent = root !== null ? `Extracted root: ${root}` : 'Heap is empty';
  });

  peekBtn.addEventListener('click', () => {
    const root = peekRoot();
    lastActionEl.textContent = root !== null ? `Root is ${root}` : 'Heap is empty';
  });

  clearBtn.addEventListener('click', () => {
    heap = [];
    render();
    lastActionEl.textContent = 'Cleared heap';
  });

  randomBtn.addEventListener('click', () => {
    let size = parseInt(sizeInput.value, 10);
    let mn = Number(minInput.value);
    let mx = Number(maxInput.value);
    if (!Number.isFinite(size) || size <= 0) size = 10;
    if (!Number.isFinite(mn)) mn = 0;
    if (!Number.isFinite(mx)) mx = 100;
    if (mx < mn) [mn, mx] = [mx, mn];
    const arr = Array.from({ length: size }, () => {
      return Math.round(mn + Math.random() * (mx - mn));
    });
    heapify(arr);
    lastActionEl.textContent = `Filled with ${size} random values`;
  });

  buildBtn.addEventListener('click', () => {
    const txt = csvInput.value.trim();
    if (!txt) {
      lastActionEl.textContent = 'Enter a CSV list of numbers';
      return;
    }
    const parts = txt.split(/[\s,;]+/).filter(Boolean);
    const arr = [];
    for (const p of parts) {
      const v = Number(p);
      if (!Number.isFinite(v)) {
        lastActionEl.textContent = `Invalid number: "${p}"`;
        return;
      }
      arr.push(v);
    }
    heapify(arr);
    lastActionEl.textContent = `Built heap from ${arr.length} values`;
  });

  // Resize handling for SVG layout
  window.addEventListener('resize', () => render());

  // Initial state
  heap = [];
  render();
})();
</script>
</body>
</html>