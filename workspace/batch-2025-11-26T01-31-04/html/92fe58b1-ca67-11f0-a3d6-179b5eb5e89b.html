<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Heap Sort Visualization</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f0f0f0;
  }
  h1 {
    text-align: center;
  }
  #controls {
    text-align: center;
    margin-bottom: 20px;
  }
  #arrayInput {
    width: 300px;
    font-size: 16px;
    padding: 5px;
  }
  button {
    font-size: 16px;
    padding: 6px 12px;
    margin-left: 10px;
    cursor: pointer;
  }
  #arrayContainer {
    display: flex;
    justify-content: center;
    align-items: flex-end;
    height: 200px;
    margin: 0 auto 20px;
    max-width: 800px;
  }
  .bar {
    margin: 0 2px;
    background-color: #69b3a2;
    width: 25px;
    text-align: center;
    color: white;
    font-weight: bold;
    border-radius: 4px 4px 0 0;
    user-select: none;
    position: relative;
  }
  .bar.highlight {
    background-color: #ff6f61;
  }
  .bar.swapped {
    background-color: #f9a825;
  }
  #log {
    max-width: 800px;
    margin: 0 auto;
    height: 150px;
    background: #222;
    color: #eee;
    padding: 10px;
    overflow-y: auto;
    font-family: monospace;
    border-radius: 5px;
  }
</style>
</head>
<body>
<h1>Heap Sort Visualization</h1>

<div id="controls">
  <input type="text" id="arrayInput" placeholder="Enter numbers separated by commas" />
  <button id="generateBtn">Generate Random</button>
  <button id="sortBtn">Start Heap Sort</button>
</div>

<div id="arrayContainer"></div>

<div id="log"></div>

<script>
  const arrayInput = document.getElementById('arrayInput');
  const arrayContainer = document.getElementById('arrayContainer');
  const log = document.getElementById('log');
  const generateBtn = document.getElementById('generateBtn');
  const sortBtn = document.getElementById('sortBtn');

  let array = [];
  let bars = [];

  // Generate random array
  function generateRandomArray(size = 20, min = 5, max = 100) {
    let arr = [];
    for (let i = 0; i < size; i++) {
      arr.push(Math.floor(Math.random() * (max - min + 1)) + min);
    }
    return arr;
  }

  // Render bars based on the array values
  function renderArray(arr) {
    arrayContainer.innerHTML = '';
    bars = [];
    const maxVal = Math.max(...arr);
    arr.forEach((val, i) => {
      const bar = document.createElement('div');
      bar.classList.add('bar');
      bar.style.height = `${(val / maxVal) * 150 + 30}px`;
      bar.textContent = val;
      bar.dataset.index = i;
      arrayContainer.appendChild(bar);
      bars.push(bar);
    });
  }

  // Log helper
  function appendLog(message) {
    const time = new Date().toLocaleTimeString();
    log.innerText += `[${time}] ${message}\n`;
    log.scrollTop = log.scrollHeight;
  }

  // Sleep for animation delays
  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  // Swap helper with animation
  async function swap(i, j) {
    appendLog(`Swapping index ${i} (${array[i]}) and index ${j} (${array[j]})`);
    bars[i].classList.add('swapped');
    bars[j].classList.add('swapped');

    // Swap values in array
    [array[i], array[j]] = [array[j], array[i]];

    // Swap heights and text
    bars[i].style.height = bars[j].style.height;
    bars[j].style.height = bars[i].style.height;

    // But since we swapped array values, let's re-render to avoid confusion:
    renderArray(array);
    await sleep(400);

    bars.forEach(bar => bar.classList.remove('swapped'));
  }

  // Heap sort specific functions:
  async function heapify(n, i) {
    let largest = i;
    let left = 2 * i + 1;
    let right = 2 * i + 2;

    bars[i].classList.add('highlight');
    if (left < n) bars[left].classList.add('highlight');
    if (right < n) bars[right].classList.add('highlight');

    appendLog(`Heapifying at index ${i} with left=${left} and right=${right}`);

    await sleep(700);

    if (left < n && array[left] > array[largest]) {
      appendLog(`Left child (${array[left]}) is greater than root (${array[largest]})`);
      largest = left;
    }
    if (right < n && array[right] > array[largest]) {
      appendLog(`Right child (${array[right]}) is greater than current largest (${array[largest]})`);
      largest = right;
    }

    if (largest !== i) {
      await swap(i, largest);
      bars.forEach(bar => bar.classList.remove('highlight'));
      await heapify(n, largest);
    } else {
      bars.forEach(bar => bar.classList.remove('highlight'));
    }
  }

  async function heapSort() {
    appendLog('Starting Heap Sort...');
    let n = array.length;

    // Build max heap
    for (let i = Math.floor(n / 2) - 1; i >= 0; i--) {
      appendLog(`Building max heap at index ${i}`);
      await heapify(n, i);
    }

    appendLog('Max heap built');

    // Extract elements from heap one by one
    for (let i = n - 1; i > 0; i--) {
      appendLog(`Moving max element ${array[0]} to index ${i}`);
      await swap(0, i);

      appendLog(`Heapify reduced heap of size ${i}`);
      await heapify(i, 0);
    }

    appendLog('Heap Sort completed!');
  }

  // Event listeners
  generateBtn.addEventListener('click', () => {
    array = generateRandomArray(20, 10, 99);
    renderArray(array);
    log.innerText = '';
  });

  sortBtn.addEventListener('click', async () => {
    // Parse input first
    let inputStr = arrayInput.value.trim();
    if (inputStr) {
      let tempArray = inputStr.split(',').map(n => parseInt(n.trim())).filter(n => !isNaN(n));
      if (tempArray.length === 0) {
        alert('Please enter valid numbers separated by commas.');
        return;
      }
      array = tempArray;
      renderArray(array);
      log.innerText = '';
    } else if (array.length === 0) {
      alert('Please input an array or generate a random one first.');
      return;
    }

    sortBtn.disabled = true;
    generateBtn.disabled = true;
    arrayInput.disabled = true;
    await heapSort();
    sortBtn.disabled = false;
    generateBtn.disabled = false;
    arrayInput.disabled = false;
  });

  // Initialize with random array on load
  array = generateRandomArray(20, 10, 99);
  renderArray(array);
</script>
</body>
</html>