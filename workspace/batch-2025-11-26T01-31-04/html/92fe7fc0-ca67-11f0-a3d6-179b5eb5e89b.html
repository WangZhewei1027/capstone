<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Radix Sort Visualization</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f5f5f5;
  }
  h1 {
    text-align: center;
    color: #333;
  }
  #input-area, #output-area {
    margin: 20px auto;
    max-width: 600px;
  }
  label {
    font-weight: bold;
    display: block;
    margin-bottom: 8px;
  }
  textarea {
    width: 100%;
    height: 60px;
    font-size: 16px;
    padding: 8px;
    resize: vertical;
  }
  button {
    background-color: #337ab7;
    color: white;
    border: none;
    padding: 10px 16px;
    font-size: 16px;
    margin-top: 12px;
    cursor: pointer;
    border-radius: 4px;
  }
  button:hover {
    background-color: #286090;
  }
  #steps {
    margin-top: 30px;
    max-width: 700px;
    margin-left: auto;
    margin-right: auto;
  }
  .step {
    background: white;
    border-radius: 6px;
    border: 1px solid #ddd;
    padding: 12px 16px;
    margin-bottom: 16px;
  }
  .step h3 {
    margin-top: 0;
    font-size: 18px;
    color: #444;
  }
  .array-container {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 10px;
  }
  .array-element {
    background: #5bc0de;
    color: white;
    border-radius: 4px;
    padding: 8px 12px;
    font-weight: bold;
    font-size: 16px;
    user-select: none;
    min-width: 40px;
    text-align: center;
  }
  .digit-info {
    font-size: 14px;
    color: #666;
    margin-top: 6px;
  }
  footer {
    text-align: center;
    margin: 40px 0 20px 0;
    color: #999;
  }
  @media screen and (max-width: 600px) {
    .array-element {
      min-width: 30px;
      font-size: 14px;
      padding: 6px 8px;
    }
  }
</style>
</head>
<body>
  <h1>Radix Sort Demonstration</h1>
  <div id="input-area">
    <label for="inputArray">Enter an array of non-negative integers (comma or space separated):</label>
    <textarea id="inputArray" placeholder="e.g. 170, 45, 75, 90, 802, 24, 2, 66"></textarea>
    <button id="startSort">Sort using Radix Sort</button>
  </div>
  <div id="steps"></div>
  <div id="output-area"></div>

<script>
  function parseInput(text) {
    // Split by commas or spaces, then filter and convert to number
    const items = text.split(/[\s,]+/).filter(s => s.trim() !== '');
    const numbers = items.map(s => {
      const n = Number(s);
      return (isNaN(n) || n < 0 || !Number.isInteger(n)) ? null : n;
    });
    if (numbers.includes(null)) return null;
    return numbers;
  }

  // Helper to get digit at position d (0-based from right)
  function getDigit(num, d) {
    return Math.floor(num / Math.pow(10, d)) % 10;
  }

  function radixSort(arr, stepCallback) {
    // Find max number to know number of digits
    let maxNum = Math.max(...arr);
    let maxDigits = maxNum.toString().length;

    let output = arr.slice();
    for (let d = 0; d < maxDigits; d++) {
      // Create buckets for each digit 0-9
      let buckets = Array.from({length:10}, () => []);

      // Place elements into buckets based on current digit
      for (let num of output) {
        let digit = getDigit(num, d);
        buckets[digit].push(num);
      }

      // For visualization: Pass a snapshot of current bucket distribution and arrays before and after
      if(stepCallback) {
        stepCallback({
          digitPosition: d,
          buckets: buckets.map(b => b.slice()),
          before: output.slice(),
          after: [].concat(...buckets)
        });
      }

      // Flatten buckets back into output array
      output = [].concat(...buckets);
    }
    return output;
  }

  const stepsDiv = document.getElementById('steps');
  const outputDiv = document.getElementById('output-area');
  const startBtn = document.getElementById('startSort');

  function clearVisualization() {
    stepsDiv.innerHTML = '';
    outputDiv.innerHTML = '';
  }

  // Function to create an element representing an array
  function createArrayElements(arr) {
    const container = document.createElement('div');
    container.className = 'array-container';
    arr.forEach(num => {
      const el = document.createElement('div');
      el.className = 'array-element';
      el.textContent = num;
      container.appendChild(el);
    });
    return container;
  }

  function createBucketsElements(buckets) {
    const container = document.createElement('div');
    container.style.display = 'flex';
    container.style.gap = '12px';
    container.style.flexWrap = 'wrap';

    buckets.forEach((bucketArr, idx) => {
      const bucketDiv = document.createElement('div');
      bucketDiv.style.flex = '1 0 50px';
      bucketDiv.style.minWidth = '50px';
      bucketDiv.style.textAlign = 'center';

      const label = document.createElement('div');
      label.textContent = `Bucket ${idx}`;
      label.style.fontWeight = 'bold';
      label.style.marginBottom = '4px';
      bucketDiv.appendChild(label);

      if(bucketArr.length === 0) {
        const empty = document.createElement('div');
        empty.textContent = '(empty)';
        empty.style.fontSize = '12px';
        empty.style.color = '#aaa';
        bucketDiv.appendChild(empty);
      } else {
        bucketArr.forEach(num => {
          const numDiv = document.createElement('div');
          numDiv.textContent = num;
          numDiv.style.background = '#d9534f';
          numDiv.style.color = 'white';
          numDiv.style.borderRadius = '4px';
          numDiv.style.padding = '4px';
          numDiv.style.marginBottom = '4px';
          numDiv.style.userSelect = 'none';
          bucketDiv.appendChild(numDiv);
        });
      }
      container.appendChild(bucketDiv);
    });
    return container;
  }

  startBtn.addEventListener('click', () => {
    clearVisualization();
    const inputText = document.getElementById('inputArray').value.trim();
    const arr = parseInput(inputText);

    if(!arr) {
      alert('Invalid input! Please enter non-negative integers separated by commas or spaces.');
      return;
    }
    if(arr.length === 0) {
      alert('Please enter at least one number.');
      return;
    }

    // Show initial array
    const initialStep = document.createElement('div');
    initialStep.className = 'step';
    const initialTitle = document.createElement('h3');
    initialTitle.textContent = 'Initial Array';
    initialStep.appendChild(initialTitle);
    initialStep.appendChild(createArrayElements(arr));
    stepsDiv.appendChild(initialStep);

    // Variable to hold steps for display
    let stepIndex = 1;

    radixSort(arr, ({digitPosition, buckets, before, after}) => {
      const stepDiv = document.createElement('div');
      stepDiv.className = 'step';

      const title = document.createElement('h3');
      title.textContent = `Step ${stepIndex++}: Sorting by digit at position ${digitPosition} (from right, 0-based)`;
      stepDiv.appendChild(title);

      const digitInfo = document.createElement('div');
      digitInfo.className = 'digit-info';
      digitInfo.textContent = `Distribute elements into buckets by digit at place 10^${digitPosition}:`;
      stepDiv.appendChild(digitInfo);

      // Show before array
      const beforeTitle = document.createElement('div');
      beforeTitle.textContent = 'Array before bucketing:';
      beforeTitle.style.marginTop = '8px';
      stepDiv.appendChild(beforeTitle);
      stepDiv.appendChild(createArrayElements(before));

      // Show buckets
      const bucketsTitle = document.createElement('div');
      bucketsTitle.textContent = 'Buckets:';
      bucketsTitle.style.marginTop = '12px';
      stepDiv.appendChild(bucketsTitle);
      stepDiv.appendChild(createBucketsElements(buckets));

      // Show after array
      const afterTitle = document.createElement('div');
      afterTitle.textContent = 'Array after collecting buckets:';
      afterTitle.style.marginTop = '12px';
      stepDiv.appendChild(afterTitle);
      stepDiv.appendChild(createArrayElements(after));

      stepsDiv.appendChild(stepDiv);
      // Scroll to stepDiv smoothly
      stepDiv.scrollIntoView({behavior: 'smooth', block: 'start'});
    });

    // Show final result
    const sorted = radixSort(arr);
    const finalDiv = document.createElement('div');
    finalDiv.className = 'step';
    const finalTitle = document.createElement('h3');
    finalTitle.textContent = 'Sorted Array:';
    finalDiv.appendChild(finalTitle);
    finalDiv.appendChild(createArrayElements(sorted));
    stepsDiv.appendChild(finalDiv);

    finalDiv.scrollIntoView({behavior: 'smooth', block: 'start'});
  });
</script>
</body>
</html>