<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Selection Sort Visualizer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#0f1724;
      --panel:#0b1220;
      --accent:#00aaff;
      --muted:#94a3b8;
      --success:#16a34a;
      --danger:#ef4444;
      --highlight1:#f97316;
      --highlight2:#facc15;
      --swap:#7c3aed;
      --bar-bg:#1e293b;
      --text:#e6eef8;
    }
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#071029);color:var(--text)}
    .app{max-width:1100px;margin:24px auto;padding:20px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:12px;box-shadow:0 6px 30px rgba(2,6,23,0.6);}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;gap:12px}
    h1{font-size:20px;margin:0}
    .controls{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .control-group{background:var(--panel);padding:10px;border-radius:8px;display:flex;gap:8px;align-items:center}
    label{font-size:13px;color:var(--muted)}
    input[type=range]{accent-color:var(--accent)}
    button{background:linear-gradient(180deg,#0ea5e9,#0284c7);border:none;color:white;padding:8px 12px;border-radius:8px;cursor:pointer}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text)}
    button.warn{background:linear-gradient(180deg,#fb923c,#f97316)}
    button:disabled{opacity:0.45;cursor:not-allowed}
    .main{display:flex;gap:16px}
    .visual{flex:1;background:var(--panel);padding:14px;border-radius:10px;min-height:320px;display:flex;flex-direction:column}
    .bars{flex:1;display:flex;align-items:flex-end;gap:4px;padding:8px;border-radius:8px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent)}
    .bar{flex:1 1 auto;background:var(--bar-bg);border-radius:4px;display:flex;align-items:flex-end;justify-content:center;color:rgba(255,255,255,0.9);font-size:11px;transition:height 200ms ease, background-color 120ms}
    .bar.small{font-size:10px}
    .bar .val{padding:4px 2px}
    .legend{display:flex;gap:8px;align-items:center;padding-top:8px}
    .legend .item{display:flex;gap:6px;align-items:center;color:var(--muted);font-size:13px}
    .square{width:14px;height:14px;border-radius:3px}
    .sidebar{width:360px;min-width:260px;background:var(--panel);padding:14px;border-radius:10px}
    .stats{display:flex;gap:12px;flex-wrap:wrap}
    .stat{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:8px;border-radius:8px;min-width:96px;text-align:center}
    .stat .num{font-weight:600;font-size:18px}
    pre{background:transparent;color:var(--muted);padding:8px;border-radius:6px;overflow:auto;margin:8px 0;border:1px dashed rgba(255,255,255,0.02)}
    .pseudocode{font-family:ui-monospace,SFMono-Regular,Menlo,monospace;font-size:13px;color:var(--muted);line-height:1.6}
    .pc-line{padding:6px 8px;border-radius:6px}
    .pc-line.current{background:linear-gradient(90deg,rgba(255,255,255,0.02),transparent);color:var(--text);box-shadow:inset 0 0 0 1px rgba(255,255,255,0.02)}
    .footer{display:flex;gap:10px;align-items:center;justify-content:space-between;padding-top:8px}
    .small{font-size:13px;color:var(--muted)}
    input[type=text]{padding:6px 8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)}
    .row{display:flex;gap:8px;align-items:center}
    @media(max-width:900px){.main{flex-direction:column}.sidebar{width:auto}}
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Selection Sort Visualizer">
    <header>
      <h1>Selection Sort Visualizer</h1>
      <div class="controls" aria-hidden="false">
        <div class="control-group">
          <label for="size">Size</label>
          <input id="size" type="range" min="5" max="80" value="30" />
        </div>
        <div class="control-group">
          <label for="speed">Speed</label>
          <input id="speed" type="range" min="10" max="1000" value="150" />
        </div>
        <div class="control-group">
          <button id="randomBtn">Randomize</button>
          <button id="reverseBtn" class="secondary">Reverse</button>
        </div>
        <div class="control-group">
          <button id="startBtn">Start</button>
          <button id="pauseBtn" class="secondary" disabled>Pause</button>
          <button id="stepBtn" class="secondary">Step</button>
          <button id="resetBtn" class="secondary">Reset</button>
        </div>
      </div>
    </header>

    <div class="main">
      <section class="visual" aria-label="Visualization">
        <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
          <div class="row" style="gap:6px">
            <label class="small">Input array (comma separated)</label>
            <input id="arrayInput" type="text" placeholder="e.g. 5,3,8,1" style="min-width:220px" />
            <button id="applyArray" class="secondary">Apply</button>
          </div>
        </div>

        <div id="bars" class="bars" aria-live="polite" aria-atomic="true"></div>

        <div class="legend" style="margin-top:10px">
          <div class="item"><span class="square" style="background:var(--bar-bg)"></span> Unsorted</div>
          <div class="item"><span class="square" style="background:var(--highlight1)"></span> Current i</div>
          <div class="item"><span class="square" style="background:var(--highlight2)"></span> Current j</div>
          <div class="item"><span class="square" style="background:var(--danger)"></span> Current min</div>
          <div class="item"><span class="square" style="background:var(--swap)"></span> Swapping</div>
          <div class="item"><span class="square" style="background:var(--success)"></span> Sorted</div>
        </div>
      </section>

      <aside class="sidebar" aria-label="Controls and Info">
        <div style="display:flex;gap:10px;align-items:center;margin-bottom:10px">
          <div class="stats" style="flex:1">
            <div class="stat">
              <div class="small">Comparisons</div>
              <div id="compCount" class="num">0</div>
            </div>
            <div class="stat">
              <div class="small">Swaps</div>
              <div id="swapCount" class="num">0</div>
            </div>
            <div class="stat">
              <div class="small">Time</div>
              <div id="timeCount" class="num">0.0s</div>
            </div>
          </div>
        </div>

        <div>
          <div class="small" style="margin-bottom:6px">Pseudocode</div>
          <div class="pseudocode" id="pseudocode" role="list">
            <div class="pc-line" data-line="0">for i = 0 to n - 2</div>
            <div class="pc-line" data-line="1">  min = i</div>
            <div class="pc-line" data-line="2">  for j = i + 1 to n - 1</div>
            <div class="pc-line" data-line="3">    if a[j] &lt; a[min] then</div>
            <div class="pc-line" data-line="4">      min = j</div>
            <div class="pc-line" data-line="5">  swap a[i], a[min]</div>
            <div class="pc-line" data-line="6">end for</div>
          </div>
        </div>

        <pre style="margin-top:12px">
Selection sort repeatedly finds the minimum element from the unsorted portion
and places it at the beginning. It's an in-place, unstable algorithm with
time complexity O(n^2), best for small arrays or educational purposes.
        </pre>

        <div class="footer">
          <div class="small">Status: <span id="status">Ready</span></div>
          <div style="display:flex;gap:8px">
            <button id="explainBtn" class="secondary">Example</button>
            <a href="https://en.wikipedia.org/wiki/Selection_sort" target="_blank" rel="noopener" class="secondary" style="padding:8px;border-radius:8px;text-decoration:none;color:var(--text)">Learn</a>
          </div>
        </div>
      </aside>
    </div>
  </div>

<script>
(function(){
  // Elements
  const barsEl = document.getElementById('bars');
  const sizeInput = document.getElementById('size');
  const speedInput = document.getElementById('speed');
  const randomBtn = document.getElementById('randomBtn');
  const reverseBtn = document.getElementById('reverseBtn');
  const startBtn = document.getElementById('startBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const stepBtn = document.getElementById('stepBtn');
  const resetBtn = document.getElementById('resetBtn');
  const arrayInput = document.getElementById('arrayInput');
  const applyArray = document.getElementById('applyArray');
  const compCountEl = document.getElementById('compCount');
  const swapCountEl = document.getElementById('swapCount');
  const timeCountEl = document.getElementById('timeCount');
  const statusEl = document.getElementById('status');
  const pseudocodeEl = document.getElementById('pseudocode');
  const explainBtn = document.getElementById('explainBtn');

  // State
  let array = [];
  let bars = [];
  let size = parseInt(sizeInput.value,10);
  let speed = parseInt(speedInput.value,10);
  let running = false;
  let paused = false;
  let stepping = false;
  let shouldStop = false;
  let comparisons = 0;
  let swaps = 0;
  let startTime = null;
  let timerInterval = null;

  // Visual update helpers
  function renderBars(){
    barsEl.innerHTML = '';
    const max = Math.max(...array, 1);
    const min = Math.min(...array, 0);
    const heightRange = barsEl.clientHeight - 20;
    array.forEach((val, idx) => {
      const bar = document.createElement('div');
      bar.className = 'bar';
      if (size > 50) bar.classList.add('small');
      bar.style.height = Math.max(6, (Math.abs(val - min) / (max - min || 1)) * heightRange + 8) + 'px';
      bar.dataset.index = idx;
      const label = document.createElement('div');
      label.className = 'val';
      label.textContent = val;
      bar.appendChild(label);
      barsEl.appendChild(bar);
      bars[idx] = bar;
    });
  }

  function setStatus(s){
    statusEl.textContent = s;
  }

  function colorRange(i, j, minIndex, swappingIndex=-1, swapMode=false){
    // Reset
    bars.forEach(b => b.style.background = 'var(--bar-bg)');
    if (typeof i === 'number' && bars[i]) bars[i].style.background = 'linear-gradient(180deg,var(--highlight1),#ff8a4b)';
    if (typeof j === 'number' && bars[j]) bars[j].style.background = 'linear-gradient(180deg,var(--highlight2),#fff176)';
    if (typeof minIndex === 'number' && bars[minIndex]) bars[minIndex].style.background = 'linear-gradient(180deg,var(--danger),#fb7185)';
    if (swapMode && typeof swappingIndex === 'number' && bars[swappingIndex]) bars[swappingIndex].style.background = 'linear-gradient(180deg,var(--swap),#a78bfa)';
  }

  function markSorted(index){
    if (bars[index]) bars[index].style.background = 'linear-gradient(180deg,var(--success),#34d399)';
  }

  function highlightPseudocode(line){
    pseudocodeEl.querySelectorAll('.pc-line').forEach(el => el.classList.remove('current'));
    const el = pseudocodeEl.querySelector(`.pc-line[data-line="${line}"]`);
    if (el) el.classList.add('current');
  }

  function sleep(ms){
    return new Promise(r => setTimeout(r, ms));
  }

  // Control: wait according to mode
  async function waitForNext(){
    if (shouldStop) throw new Error('stopped');
    if (stepping){
      // Wait until stepBtn pressed or start pressed
      setStatus('Paused (step mode)');
      paused = true;
      return new Promise(resolve => {
        const onStep = () => {
          document.removeEventListener('run-step', onStep);
          paused = false;
          resolve();
        };
        document.addEventListener('run-step', onStep);
      });
    } else if (paused){
      // wait until unpaused
      return new Promise(resolve => {
        const onResume = () => {
          document.removeEventListener('run-resume', onResume);
          resolve();
        };
        document.addEventListener('run-resume', onResume);
      });
    } else {
      // running in auto mode: delay by speed
      await sleep(Math.max(5, speed));
    }
  }

  // Algorithm: selection sort with visual steps
  async function selectionSort(){
    running = true;
    paused = false;
    stepping = false;
    shouldStop = false;
    startTime = Date.now();
    timerInterval = setInterval(updateTime, 100);
    comparisons = 0;
    swaps = 0;
    updateCounters();

    setStatus('Running');
    const n = array.length;
    try{
      for (let i=0;i<n-1;i++){
        highlightPseudocode(0); // for i
        colorRange(i, null, null);
        await waitForNext();

        let min = i;
        highlightPseudocode(1);
        colorRange(i, null, min);
        await waitForNext();

        for (let j=i+1;j<n;j++){
          highlightPseudocode(2); // for j
          colorRange(i, j, min);
          await waitForNext();

          highlightPseudocode(3); // if a[j] < a[min]
          comparisons++; updateCounters();
          if (array[j] < array[min]){
            highlightPseudocode(4);
            min = j;
            colorRange(i, j, min);
            await waitForNext();
          } else {
            // small pause to show comparison
            await waitForNext();
          }
        }

        // swap if needed
        highlightPseudocode(5);
        if (min !== i){
          // animate swap
          colorRange(i, null, min, i, true);
          await waitForNext();
          swaps++; updateCounters();
          await animateSwap(i, min);
          await waitForNext();
        }
        markSorted(i);
      }
      // last element is sorted
      markSorted(n-1);
      highlightPseudocode(6);
      setStatus('Finished');
    } catch (e){
      // stopped
      setStatus('Stopped');
      // nothing
    } finally {
      clearInterval(timerInterval);
      running = false;
      paused = false;
      stepping = false;
      shouldStop = false;
      startBtn.disabled = false;
      pauseBtn.disabled = true;
      stepBtn.disabled = false;
    }
  }

  function updateCounters(){
    compCountEl.textContent = comparisons;
    swapCountEl.textContent = swaps;
    updateTime();
  }

  function updateTime(){
    if (!startTime) { timeCountEl.textContent = '0.0s'; return; }
    const s = (Date.now() - startTime) / 1000;
    timeCountEl.textContent = s.toFixed(1) + 's';
  }

  // Animate swap visually by swapping heights and labels
  async function animateSwap(i, j){
    if (!bars[i] || !bars[j]) {
      // fallback to simple swap
      const tmp = array[i]; array[i] = array[j]; array[j] = tmp;
      renderBars();
      return;
    }
    const bi = bars[i], bj = bars[j];
    // swap numeric values
    const tmp = array[i]; array[i] = array[j]; array[j] = tmp;

    // animate by swapping heights and inner text; use CSS transitions
    // capture heights
    const hi = bi.style.height, hj = bj.style.height;
    const ti = bi.innerText, tj = bj.innerText;
    bi.style.transition = 'height 220ms ease, background-color 120ms';
    bj.style.transition = 'height 220ms ease, background-color 120ms';
    bi.style.height = hj;
    bj.style.height = hi;
    bi.querySelector('.val').textContent = array[i];
    bj.querySelector('.val').textContent = array[j];
    // briefly highlight swap
    bi.style.background = 'linear-gradient(180deg,var(--swap),#a78bfa)';
    bj.style.background = 'linear-gradient(180deg,var(--swap),#a78bfa)';
    await sleep(220);
    // restore backgrounds to normal or sorted later
    bi.style.background = 'var(--bar-bg)';
    bj.style.background = 'var(--bar-bg)';
    // ensure bars array remains linked
    await sleep(60);
    renderBars(); // re-render to reset references
  }

  // UI handlers
  function generateRandom(n){
    const arr = [];
    for (let i=0;i<n;i++){
      arr.push(Math.floor(Math.random()*100)+1);
    }
    return arr;
  }

  function setArray(arr){
    array = arr.slice();
    size = array.length;
    sizeInput.value = size;
    renderBars();
    comparisons = 0; swaps = 0; updateCounters();
    startTime = null; timeCountEl.textContent = '0.0s';
    highlightPseudocode(-1);
    setStatus('Ready');
  }

  // Attach events
  sizeInput.addEventListener('input', () => {
    const v = parseInt(sizeInput.value,10);
    size = v;
    setArray(generateRandom(size));
  });

  speedInput.addEventListener('input', () => {
    speed = parseInt(speedInput.value,10);
  });

  randomBtn.addEventListener('click', () => {
    setArray(generateRandom(parseInt(sizeInput.value,10)));
  });

  reverseBtn.addEventListener('click', () => {
    // descending array
    const n = parseInt(sizeInput.value,10);
    const arr = [];
    for (let i=0;i<n;i++) arr.push(n - i);
    setArray(arr);
  });

  applyArray.addEventListener('click', () => {
    const text = arrayInput.value.trim();
    if (!text) return;
    const parts = text.split(',').map(s=>s.trim()).filter(s=>s!=='');
    const nums = [];
    for (const p of parts){
      const n = Number(p);
      if (!isFinite(n)) {
        alert('Invalid number: ' + p);
        return;
      }
      nums.push(n);
    }
    if (nums.length < 2) {
      alert('Enter at least two numbers');
      return;
    }
    setArray(nums);
  });

  startBtn.addEventListener('click', async () => {
    if (running) return;
    // start in auto mode
    startBtn.disabled = true;
    pauseBtn.disabled = false;
    stepBtn.disabled = false;
    stepping = false;
    paused = false;
    shouldStop = false;
    const n = array.length;
    if (n < 2) {
      alert('Array too small to sort.');
      startBtn.disabled = false;
      return;
    }
    selectionSort();
  });

  pauseBtn.addEventListener('click', () => {
    if (!running) return;
    // toggle pause
    if (!paused && !stepping){
      paused = true;
      setStatus('Paused');
      pauseBtn.textContent = 'Resume';
      document.dispatchEvent(new Event('run-paused'));
    } else {
      paused = false;
      setStatus('Running');
      pauseBtn.textContent = 'Pause';
      document.dispatchEvent(new Event('run-resume'));
    }
  });

  stepBtn.addEventListener('click', () => {
    if (!running){
      // start in stepping mode
      startBtn.disabled = true;
      pauseBtn.disabled = false;
      stepping = true;
      paused = false;
      shouldStop = false;
      selectionSort();
      return;
    }
    // if running and in stepping or paused: trigger one step
    document.dispatchEvent(new Event('run-step'));
  });

  resetBtn.addEventListener('click', () => {
    // stop the algorithm
    if (running){
      shouldStop = true;
      // unpause to allow algorithm to exit
      paused = false;
      stepping = false;
      document.dispatchEvent(new Event('run-resume'));
    }
    startBtn.disabled = false;
    pauseBtn.disabled = true;
    pauseBtn.textContent = 'Pause';
    stepBtn.disabled = false;
    // reset counters and visuals
    comparisons = 0; swaps = 0; updateCounters();
    startTime = null; timeCountEl.textContent = '0.0s';
    setStatus('Ready');
    highlightPseudocode(-1);
    renderBars();
  });

  explainBtn.addEventListener('click', () => {
    // example small array
    const ex = [64,25,12,22,11];
    arrayInput.value = ex.join(', ');
    setArray(ex);
  });

  // initialize
  setArray(generateRandom(size));

  // Accessibility: keyboard shortcuts
  document.addEventListener('keydown', (e) => {
    if (e.key === ' ') {
      e.preventDefault();
      if (running){
        pauseBtn.click();
      } else {
        startBtn.click();
      }
    } else if (e.key === 'ArrowRight') {
      stepBtn.click();
    } else if (e.key === 'r') {
      randomBtn.click();
    }
  });

  // Responsive render on resize
  window.addEventListener('resize', () => {
    renderBars();
  });

})();
</script>
</body>
</html>