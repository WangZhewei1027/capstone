<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Insertion Sort Visualizer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root{
      --bg:#0f1724; --panel:#0b1220; --accent:#60a5fa; --muted:#94a3b8; --card:#071025;
      --bar:#90a4ae; --sorted:#38bdf8; --key:#fb923c; --comp:#ef4444; --shift:#a78bfa;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:linear-gradient(180deg,#021021 0%, #02111b 100%); color:#e6eef6; padding:18px;
    }
    .app{
      max-width:1100px; margin:0 auto;
    }
    header{
      display:flex; align-items:center; gap:12px; margin-bottom:12px;
    }
    header h1{font-size:20px; margin:0; color:var(--accent)}
    .controls{
      display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-bottom:12px;
    }
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      padding:12px; border-radius:8px; border:1px solid rgba(255,255,255,0.04);
    }
    .row{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    label{font-size:12px; color:var(--muted)}
    input[type=range]{width:100%}
    button{
      background:linear-gradient(180deg,var(--accent),#3b82f6); color:#041024; border:none; padding:8px 12px; border-radius:6px; cursor:pointer;
      font-weight:600;
    }
    button.ghost{background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--muted)}
    .vis{
      margin-top:12px; display:flex; gap:12px;
    }
    .bars{
      flex:1 1 60%; min-height:300px; background:var(--card); padding:12px; border-radius:8px; display:flex; align-items:end; gap:4px;
      border:1px solid rgba(255,255,255,0.03); position:relative;
    }
    .bar{
      background:var(--bar); flex:1 1 auto; border-radius:4px 4px 0 0; display:flex; align-items:flex-end; justify-content:center; color:#031127; font-weight:700;
      transition:height 160ms linear, transform 160ms linear, background-color 120ms linear;
      position:relative; overflow:visible;
    }
    .bar .val{font-size:11px; transform:translateY(-6px); color:#031127; padding:2px 6px; border-radius:4px; background:rgba(255,255,255,0.85)}
    .panel{
      width:360px; min-width:260px; background:var(--panel); padding:12px; border-radius:8px; border:1px solid rgba(255,255,255,0.03);
      display:flex; flex-direction:column; gap:8px;
    }
    .pseudocode{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; font-size:13px; color:var(--muted); background:rgba(255,255,255,0.02);
      padding:8px; border-radius:6px; overflow:auto; max-height:220px;
    }
    .pseudocode .line{padding:4px 6px; border-radius:4px; margin-bottom:4px}
    .pseudocode .line.active{background:linear-gradient(90deg, rgba(96,165,250,0.12), rgba(96,165,250,0.06)); color:var(--accent)}
    .stats{display:flex; gap:8px; flex-wrap:wrap}
    .stat{background:rgba(255,255,255,0.02); padding:8px; border-radius:6px; font-size:13px}
    .footer-controls{display:flex; gap:8px; align-items:center; margin-top:8px; flex-wrap:wrap}
    textarea{width:100%; min-height:56px; background:transparent; color:var(--muted); border:1px dashed rgba(255,255,255,0.04); padding:8px; border-radius:6px}
    .legend{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .legend .item{display:flex; gap:6px; align-items:center; font-size:12px; color:var(--muted)}
    .swatch{width:14px; height:12px; border-radius:3px}
    @media (max-width:880px){
      .controls{grid-template-columns:1fr; }
      .vis{flex-direction:column}
      .panel{width:100%}
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Insertion Sort — Visualizer & Stepper</h1>
      <div style="margin-left:auto;color:var(--muted);font-size:13px">Learn how insertion sort shifts elements to insert the key value.</div>
    </header>

    <div class="controls">
      <div class="card">
        <div class="row" style="justify-content:space-between">
          <div style="flex:1 1 60%">
            <label>Array size: <span id="sizeVal">20</span></label>
            <input id="size" type="range" min="5" max="80" value="20">
          </div>
          <div style="flex:1 1 40%">
            <label>Max value: <span id="maxVal">100</span></label>
            <input id="max" type="range" min="10" max="500" value="100">
          </div>
        </div>
        <div style="margin-top:8px" class="row">
          <button id="randomBtn">Randomize</button>
          <button id="almostSortedBtn" class="ghost">Nearly Sorted</button>
          <button id="reverseBtn" class="ghost">Reverse</button>
        </div>
      </div>

      <div class="card">
        <label>Manual input (comma/space separated)</label>
        <textarea id="manual" placeholder="e.g. 5,3,8,1,9"></textarea>
        <div class="row" style="margin-top:8px">
          <button id="applyManual">Apply</button>
          <button id="resetBtn" class="ghost">Reset View</button>
        </div>
      </div>

      <div class="card">
        <label>Animation speed: <span id="speedVal">1.0x</span></label>
        <input id="speed" type="range" min="0.25" max="3" step="0.25" value="1">
        <div class="footer-controls">
          <button id="playBtn">Play</button>
          <button id="stepBtn" class="ghost">Step</button>
          <button id="backBtn" class="ghost">Back</button>
          <button id="toStart" class="ghost">To Start</button>
        </div>
      </div>
    </div>

    <div class="vis">
      <div class="bars card" id="bars" aria-hidden="false"></div>

      <div class="panel">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <strong style="color:var(--accent)">Algorithm (Insertion Sort)</strong>
          <div class="legend">
            <div class="item"><span class="swatch" style="background:var(--sorted)"></span> Sorted</div>
            <div class="item"><span class="swatch" style="background:var(--key)"></span> Key</div>
            <div class="item"><span class="swatch" style="background:var(--comp)"></span> Comparing</div>
            <div class="item"><span class="swatch" style="background:var(--shift)"></span> Shifted</div>
          </div>
        </div>

        <div class="pseudocode" id="pseudocode">
          <div class="line" data-line="1">1: for i = 1 to n - 1</div>
          <div class="line" data-line="2">2: &nbsp;&nbsp;&nbsp; key = arr[i]</div>
          <div class="line" data-line="3">3: &nbsp;&nbsp;&nbsp; j = i - 1</div>
          <div class="line" data-line="4">4: &nbsp;&nbsp;&nbsp; while j >= 0 and arr[j] > key</div>
          <div class="line" data-line="5">5: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; arr[j + 1] = arr[j]</div>
          <div class="line" data-line="6">6: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; j = j - 1</div>
          <div class="line" data-line="7">7: &nbsp;&nbsp;&nbsp; arr[j + 1] = key</div>
        </div>

        <div class="stats">
          <div class="stat">Step: <span id="stepCount">0</span> / <span id="totalSteps">0</span></div>
          <div class="stat">Comparisons: <span id="compCount">0</span></div>
          <div class="stat">Shifts: <span id="shiftCount">0</span></div>
        </div>

        <div style="margin-top:6px; display:flex; gap:8px;">
          <div style="flex:1">
            <label style="font-size:12px;color:var(--muted)">Current frame action</label>
            <div id="action" style="padding:6px;background:rgba(255,255,255,0.02);border-radius:6px;font-size:13px;margin-top:4px;color:var(--muted)">—</div>
          </div>
        </div>
      </div>
    </div>

    <footer style="margin-top:12px;color:var(--muted);font-size:13px">Tip: Press Play to animate, Step to advance frame-by-frame, Back to step backwards.</footer>
  </div>

  <script>
    // Insertion Sort Visualizer
    const sizeEl = document.getElementById('size');
    const maxEl = document.getElementById('max');
    const sizeVal = document.getElementById('sizeVal');
    const maxVal = document.getElementById('maxVal');
    const barsEl = document.getElementById('bars');
    const randomBtn = document.getElementById('randomBtn');
    const almostSortedBtn = document.getElementById('almostSortedBtn');
    const reverseBtn = document.getElementById('reverseBtn');
    const manual = document.getElementById('manual');
    const applyManual = document.getElementById('applyManual');
    const resetBtn = document.getElementById('resetBtn');

    const playBtn = document.getElementById('playBtn');
    const stepBtn = document.getElementById('stepBtn');
    const backBtn = document.getElementById('backBtn');
    const toStart = document.getElementById('toStart');

    const speedEl = document.getElementById('speed');
    const speedVal = document.getElementById('speedVal');

    const stepCountEl = document.getElementById('stepCount');
    const totalStepsEl = document.getElementById('totalSteps');
    const compCountEl = document.getElementById('compCount');
    const shiftCountEl = document.getElementById('shiftCount');
    const actionEl = document.getElementById('action');
    const pseudocode = document.getElementById('pseudocode');

    let arr = [];
    let frames = []; // recorded frames
    let cur = 0;
    let playing = false;
    let timer = null;
    let speed = parseFloat(speedEl.value);

    function randArray(n, max){
      return Array.from({length:n},()=>Math.floor(Math.random()*max)+1);
    }

    function makeAlmostSorted(n, max){
      const a = randArray(n, max).sort((a,b)=>a-b);
      // introduce a few swaps
      for(let k=0;k<Math.max(1,Math.floor(n/10));k++){
        const i = Math.floor(Math.random()*n);
        const j = Math.floor(Math.random()*n);
        [a[i],a[j]]=[a[j],a[i]];
      }
      return a;
    }

    function makeReverse(n, max){
      return randArray(n,max).sort((a,b)=>b-a);
    }

    function updateControlsDisplay(){
      sizeVal.textContent = sizeEl.value;
      maxVal.textContent = maxEl.value;
      speedVal.textContent = speedEl.value + 'x';
    }

    function clone(a){ return a.slice(); }

    // Generate frames that represent steps of insertion sort
    function generateFrames(inputArr){
      const a = inputArr.slice();
      const n = a.length;
      const frames = [];
      let comps = 0;
      let shifts = 0;

      frames.push({type:'start', arr:clone(a), i:null, j:null, action:'Start' , comps, shifts});

      for(let i=1;i<n;i++){
        const key = a[i];
        let j = i-1;

        frames.push({type:'start_i', arr:clone(a), i, j, keyIndex:i, action:`Start iteration i=${i}`, comps, shifts});

        while(j>=0){
          // compare arr[j] and key
          comps++;
          frames.push({type:'compare', arr:clone(a), i, j, keyIndex:i, compared:[j,i], action:`Compare arr[${j}] (${a[j]}) > key (${key})?`, comps, shifts});

          if(a[j] > key){
            // shift a[j] to a[j+1]
            a[j+1] = a[j];
            shifts++;
            frames.push({type:'shift', arr:clone(a), i, j, shiftedIndex:j+1, keyIndex:i, action:`Shift arr[${j}] to position ${j+1}`, comps, shifts});
            j = j-1;
            // after decrement, continue
          } else {
            frames.push({type:'no_shift', arr:clone(a), i, j, action:`No shift needed (arr[${j}] ≤ key)`, comps, shifts});
            break;
          }
        }
        // place key at j+1
        a[j+1] = key;
        shifts++;
        frames.push({type:'place', arr:clone(a), i, j, placedIndex:j+1, action:`Place key at index ${j+1}`, comps, shifts});

        frames.push({type:'done_i', arr:clone(a), i, sortedUpto:i, action:`End of iteration i=${i}`, comps, shifts});
      }

      frames.push({type:'done', arr:clone(a), action:'Array sorted', comps, shifts});
      return frames;
    }

    // Render functions
    function renderFrame(index){
      if(!frames.length) return;
      cur = Math.max(0, Math.min(index, frames.length-1));
      const f = frames[cur];
      // render bars
      const values = f.arr;
      const maxValInArr = Math.max(...values, 1);
      barsEl.innerHTML = '';
      const n = values.length;
      for(let k=0;k<n;k++){
        const val = values[k];
        const bar = document.createElement('div');
        bar.className = 'bar';
        // height relative
        const height = 20 + Math.round((val / maxValInArr) * 260);
        bar.style.height = height + 'px';
        // width distribution
        bar.style.flex = '1 1 auto';
        // colors
        let bg = 'var(--bar)';
        // sorted area: if f.sortedUpto present mark <= sortedUpto as sorted
        if(f.sortedUpto !== undefined && k <= f.sortedUpto) bg = 'var(--sorted)';
        // if final done: all sorted
        if(f.type === 'done') bg = 'var(--sorted)';

        // key element
        if(f.keyIndex === k){
          bg = 'var(--key)';
          bar.style.transform = 'translateY(-6px)';
        }
        // compared
        if(f.compared && f.compared.includes(k)){
          bg = 'var(--comp)';
          bar.style.transform = 'scale(1.03)';
        }
        // shifted
        if(f.shiftedIndex === k){
          bg = 'var(--shift)';
          bar.style.transform = 'translateY(-4px)';
        }
        // placed
        if(f.placedIndex === k){
          bg = 'var(--sorted)';
          bar.style.transform = 'translateY(-6px)';
        }

        bar.style.background = bg;
        const valEl = document.createElement('div');
        valEl.className = 'val';
        valEl.textContent = val;
        bar.appendChild(valEl);
        barsEl.appendChild(bar);
      }

      // update stats & action
      stepCountEl.textContent = cur;
      totalStepsEl.textContent = frames.length - 1;
      compCountEl.textContent = f.comps ?? (frames[cur]?.comps ?? 0);
      shiftCountEl.textContent = f.shifts ?? (frames[cur]?.shifts ?? 0);
      actionEl.textContent = f.action || '—';

      // highlight pseudocode lines
      const lines = pseudocode.querySelectorAll('.line');
      lines.forEach(l=>l.classList.remove('active'));
      // map frame types to lines:
      // start_i -> lines 2 & 3, compare -> 4, shift->5, place->7, no_shift->4, done->none
      const setActive = (nums)=> nums.forEach(n=>{
        const el = pseudocode.querySelector(`.line[data-line="${n}"]`);
        if(el) el.classList.add('active');
      });

      switch(f.type){
        case 'start_i': setActive([2,3]); break;
        case 'compare': setActive([4]); break;
        case 'shift': setActive([5,6]); break;
        case 'no_shift': setActive([4]); break;
        case 'place': setActive([7]); break;
        default: break;
      }
    }

    function play(){
      if(playing) return;
      playing = true; playBtn.textContent = 'Pause';
      const stepInterval = 500 / speed; // base 500ms
      function tick(){
        if(!playing) return;
        if(cur < frames.length -1){
          cur++;
          renderFrame(cur);
          timer = setTimeout(tick, stepInterval);
        } else {
          playing = false; playBtn.textContent = 'Play';
        }
      }
      timer = setTimeout(tick, stepInterval);
    }

    function pause(){
      playing = false; playBtn.textContent = 'Play';
      if(timer) clearTimeout(timer);
      timer = null;
    }

    // UI events
    sizeEl.addEventListener('input', ()=>{ updateControlsDisplay(); });
    maxEl.addEventListener('input', ()=>{ updateControlsDisplay(); });
    speedEl.addEventListener('input', ()=>{
      speed = parseFloat(speedEl.value);
      updateControlsDisplay();
    });
    updateControlsDisplay();

    function loadAndGenerate(a){
      arr = a.slice();
      frames = generateFrames(arr);
      cur = 0;
      renderFrame(0);
    }

    randomBtn.addEventListener('click', ()=>{
      const a = randArray(parseInt(sizeEl.value), parseInt(maxEl.value));
      manual.value = a.join(', ');
      loadAndGenerate(a);
      pause();
    });
    almostSortedBtn.addEventListener('click', ()=>{
      const a = makeAlmostSorted(parseInt(sizeEl.value), parseInt(maxEl.value));
      manual.value = a.join(', ');
      loadAndGenerate(a);
      pause();
    });
    reverseBtn.addEventListener('click', ()=>{
      const a = makeReverse(parseInt(sizeEl.value), parseInt(maxEl.value));
      manual.value = a.join(', ');
      loadAndGenerate(a);
      pause();
    });

    applyManual.addEventListener('click', ()=>{
      const txt = manual.value.trim();
      if(!txt) return;
      const parts = txt.split(/[\s,]+/).filter(Boolean);
      const nums = parts.map(x=>Number(x)).filter(x=>!Number.isNaN(x));
      if(nums.length === 0){
        alert('No valid numbers found.');
        return;
      }
      loadAndGenerate(nums);
      pause();
    });

    resetBtn.addEventListener('click', ()=>{
      // re-render the current frame
      renderFrame(0);
      pause();
    });

    playBtn.addEventListener('click', ()=>{
      if(playing) pause(); else play();
    });

    stepBtn.addEventListener('click', ()=>{
      pause();
      if(cur < frames.length -1){
        cur++;
        renderFrame(cur);
      }
    });

    backBtn.addEventListener('click', ()=>{
      pause();
      if(cur > 0){
        cur--;
        renderFrame(cur);
      }
    });

    toStart.addEventListener('click', ()=>{
      pause();
      cur = 0;
      renderFrame(cur);
    });

    // initialize default array
    (function init(){
      const initArr = randArray(parseInt(sizeEl.value), parseInt(maxEl.value));
      manual.value = initArr.join(', ');
      loadAndGenerate(initArr);
    })();

    // keyboard shortcuts
    window.addEventListener('keydown', (e)=>{
      if(e.key === ' ') { e.preventDefault(); playBtn.click(); }
      if(e.key === 'ArrowRight') { stepBtn.click(); }
      if(e.key === 'ArrowLeft') { backBtn.click(); }
      if(e.key === 'Home') { toStart.click(); }
    });

    // accessibility: resize bars when window resizes
    window.addEventListener('resize', ()=> renderFrame(cur));
  </script>
</body>
</html>