<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Array Playground — Interactive JavaScript Array Demo</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root{
      --bg:#0f1724; --panel:#0b1220; --muted:#93a3b5; --accent:#60a5fa; --accent2:#7dd3fc;
      --card:#0b1226; --success:#16a34a; --danger:#ef4444; --glass: rgba(255,255,255,0.03);
    }
    html,body{height:100%; margin:0; font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:linear-gradient(180deg,#041226 0%, #081425 100%); color:white; -webkit-font-smoothing:antialiased;}
    .wrap{max-width:1100px; margin:24px auto; padding:20px; border-radius:12px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); box-shadow: 0 8px 30px rgba(2,6,23,0.7);}
    header{display:flex; gap:12px; align-items:center; margin-bottom:14px;}
    header h1{font-size:20px; margin:0; letter-spacing:-0.2px;}
    header p{margin:0; color:var(--muted); font-size:13px;}
    .grid{display:grid; grid-template-columns: 360px 1fr 360px; gap:16px;}
    .panel{background:var(--panel); padding:14px; border-radius:10px; min-height:120px;}
    .controls label{display:block; font-size:13px; color:var(--muted); margin-top:8px;}
    input[type="text"], select{width:100%; padding:8px 10px; margin-top:6px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:white; outline:none;}
    button{background:linear-gradient(180deg,var(--accent), var(--accent2)); color:#022; border:none; padding:8px 10px; border-radius:8px; cursor:pointer; margin:6px 6px 6px 0; font-weight:600;}
    button.alt{background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--muted);}
    .small{font-size:13px; padding:6px 8px;}
    .array-visual{display:flex; gap:8px; flex-wrap:wrap; align-items:flex-start; padding:8px; min-height:80px;}
    .cell{min-width:56px; height:48px; border-radius:8px; background:var(--card); display:flex; flex-direction:column; justify-content:center; align-items:center; gap:4px; padding:6px; box-shadow: 0 4px 18px rgba(2,6,23,0.6); border:1px solid rgba(255,255,255,0.03);}
    .index{font-size:11px; color:var(--muted);}
    .value{font-weight:700;}
    .log{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02)); padding:10px; border-radius:8px; max-height:260px; overflow:auto; font-family:monospace; font-size:13px; color:var(--muted);}
    .ops{display:flex; flex-wrap:wrap; gap:6px; margin-top:8px;}
    footer{margin-top:12px; color:var(--muted); font-size:13px; display:flex; justify-content:space-between; align-items:center;}
    .badge{background:var(--glass); padding:6px 8px; border-radius:8px; font-size:13px; color:var(--muted);}
    .row{display:flex; gap:8px; align-items:center;}
    .examples button{background:linear-gradient(180deg,#34d399,#60a5fa); color:#022;}
    .muted{color:var(--muted); font-size:13px;}
    .chip{background:rgba(255,255,255,0.03); padding:6px 8px; border-radius:999px; font-size:12px; color:var(--muted);}
    .highlight{color:var(--accent2); font-weight:700;}
    .right-title{display:flex; justify-content:space-between; align-items:center;}
    @media (max-width:1000px){
      .grid{grid-template-columns: 1fr; }
      .panel{min-height:unset;}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Array Playground</h1>
        <p>Interactive demo of JavaScript arrays: create, modify, inspect, map, filter, reduce, and more.</p>
      </div>
      <div style="margin-left:auto" class="badge">JS arrays • dynamic • visual</div>
    </header>

    <div class="grid">
      <!-- Left: Controls -->
      <div class="panel controls">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <strong>Create / Load Array</strong>
          <span class="chip">length: <span id="len">0</span></span>
        </div>

        <label>Comma-separated values (numbers or strings)
          <input id="inputArray" type="text" placeholder="e.g. 1,2,3,hello,true">
        </label>
        <div style="margin-top:8px;">
          <button id="btnLoad">Load Array</button>
          <button id="btnRandom" class="alt small">Random (numbers)</button>
          <button id="btnClear" class="alt small">Clear</button>
        </div>

        <label>Quick examples
          <div class="examples" style="margin-top:6px;">
            <button id="exNums" class="small">[1,2,3,4]</button>
            <button id="exStr" class="small alt">['a','b','c']</button>
            <button id="exNested" class="small alt">Nested [[1,2],[3,4]]</button>
            <button id="exMixed" class="small alt">Mixed [1,'x',true]</button>
          </div>
        </label>

        <label style="margin-top:10px;">Array Type
          <select id="arrayType">
            <option value="normal">Normal Array (Array)</option>
            <option value="int16">Int16Array (Typed)</option>
            <option value="float32">Float32Array (Typed)</option>
          </select>
        </label>

        <div style="margin-top:10px;">
          <strong>Mutate</strong>
          <div class="ops">
            <button id="push" class="small">push(value)</button>
            <button id="pop" class="small alt">pop()</button>
            <button id="shift" class="small">shift()</button>
            <button id="unshift" class="small alt">unshift(value)</button>
            <button id="splice" class="small">splice(i,del,items...)</button>
            <button id="slice" class="small alt">slice(start,end)</button>
            <button id="concat" class="small">concat(other)</button>
            <button id="fill" class="small alt">fill(value,start?,end?)</button>
            <button id="reverse" class="small">reverse()</button>
            <button id="sort" class="small alt">sort()</button>
            <button id="flat" class="small">flat(depth)</button>
          </div>
        </div>

        <label style="margin-top:10px;">Value for operations
          <input id="opValue" type="text" placeholder="value (e.g. 42 or 'x')">
        </label>
        <div style="margin-top:6px;">
          <input id="opIndex" type="text" placeholder="index or start (e.g. 1)">
          <input id="opEnd" type="text" placeholder="end or count (e.g. 2)" style="margin-left:6px;">
        </div>
      </div>

      <!-- Center: Visualization & Log -->
      <div class="panel">
        <div class="right-title">
          <div>
            <strong>Array Visualizer</strong>
            <div class="muted">Shows indexes and values. Click a cell to remove it.</div>
          </div>
          <div class="muted">Type: <span id="currentType">Array</span></div>
        </div>

        <div id="visual" class="array-visual" style="margin-top:12px;"></div>

        <div style="display:flex; justify-content:space-between; margin-top:12px; align-items:center;">
          <div><strong>Console Log</strong> <span class="muted">(operations & results)</span></div>
          <div>
            <button id="clearLog" class="alt small">Clear Log</button>
            <button id="export" class="alt small">Export JSON</button>
          </div>
        </div>
        <div id="log" class="log" style="margin-top:8px;"></div>
      </div>

      <!-- Right: Higher-order & Examples -->
      <div class="panel">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <strong>Higher-order functions</strong>
          <span class="muted">map, filter, reduce, find...</span>
        </div>

        <div style="margin-top:8px;">
          <div class="ops">
            <button id="mapBtn" class="small">map(x => x*2)</button>
            <button id="filterBtn" class="small alt">filter(x => condition)</button>
            <button id="reduceBtn" class="small">reduce((a,b)=>a+b,0)</button>
            <button id="findBtn" class="small alt">find(x => )</button>
            <button id="someBtn" class="small">some(x => )</button>
            <button id="everyBtn" class="small alt">every(x => )</button>
            <button id="forEachBtn" class="small">forEach</button>
            <button id="flatMapBtn" class="small alt">flatMap</button>
          </div>
        </div>

        <label style="margin-top:10px;">Expression input
          <input id="expr" type="text" placeholder="e.g. x => x > 2  OR (a,b)=>a+b">
        </label>

        <div style="margin-top:10px;">
          <strong>Utilities</strong>
          <div class="ops" style="margin-top:6px;">
            <button id="copySlice" class="small">copy (slice / spread)</button>
            <button id="toString" class="small alt">join()</button>
            <button id="indexOf" class="small">indexOf(value)</button>
            <button id="includes" class="small alt">includes(value)</button>
            <button id="flatten1" class="small">flat(1)</button>
            <button id="typedDemo" class="small alt">TypedArray demo</button>
          </div>
        </div>

        <div style="margin-top:12px;">
          <strong>Examples & Recipes</strong>
          <div class="muted" style="margin-top:6px;">Click to run common patterns:</div>
          <div class="ops" style="margin-top:8px;">
            <button id="evens" class="small">Filter evens</button>
            <button id="sum" class="small alt">Sum numbers</button>
            <button id="unique" class="small">Unique values</button>
            <button id="groupBy" class="small alt">Group by (parity)</button>
          </div>
        </div>

      </div>
    </div>

    <footer>
      <div class="muted">Tip: type JavaScript expressions for callbacks, e.g. x => x*2 or (a,b)=>a+b</div>
      <div class="muted">Click a visual cell to remove it from the array</div>
    </footer>
  </div>

<script>
(function(){
  // Core state
  let arr = []; // can be Array or TypedArray
  let type = 'normal'; // 'normal'|'int16'|'float32'
  const visual = document.getElementById('visual');
  const logEl = document.getElementById('log');
  const lenEl = document.getElementById('len');
  const typeEl = document.getElementById('currentType');

  // Helpers
  function parseInputToArray(text) {
    if (!text.trim()) return [];
    // Try to parse JSON first
    try {
      const j = JSON.parse(text);
      if (Array.isArray(j)) return j;
    } catch(e){}
    // Fallback: split by commas and coerce numbers/booleans/null
    return text.split(',').map(s => {
      const t = s.trim();
      if (t === '') return '';
      if (t === 'null') return null;
      if (t === 'undefined') return undefined;
      if (t === 'true') return true;
      if (t === 'false') return false;
      // number?
      if (!isNaN(Number(t))) return Number(t);
      // quoted string?
      if ((t.startsWith('"') && t.endsWith('"')) || (t.startsWith("'") && t.endsWith("'"))) {
        return t.slice(1,-1);
      }
      return t;
    });
  }

  function createArrayFromJs(v) {
    if (type === 'normal') return Array.isArray(v) ? v.slice() : Array.from(v || []);
    if (type === 'int16') {
      const flat = Array.isArray(v) ? v.map(x=>Number(x)||0) : Array.from(v||[]);
      return new Int16Array(flat);
    }
    if (type === 'float32') {
      const flat = Array.isArray(v) ? v.map(x=>Number(x)||0) : Array.from(v||[]);
      return new Float32Array(flat);
    }
  }

  function ensureNormal() {
    if (type === 'normal' || Array.isArray(arr)) return;
    // convert typed array to normal array
    arr = Array.from(arr);
    type = 'normal';
    document.getElementById('arrayType').value = 'normal';
    updateTypeLabel();
    log('Converted typed array -> normal Array');
  }

  function render() {
    visual.innerHTML = '';
    const a = arr;
    const isTyped = ArrayBuffer.isView(a) && !(a instanceof DataView);
    lenEl.textContent = a ? a.length : 0;
    typeEl.textContent = isTyped ? (a.constructor && a.constructor.name) : (Array.isArray(a) ? 'Array' : typeof a);
    // render cells
    for (let i = 0; i < (a ? a.length : 0); i++) {
      const cell = document.createElement('div');
      cell.className = 'cell';
      const idx = document.createElement('div');
      idx.className = 'index';
      idx.textContent = i;
      const val = document.createElement('div');
      val.className = 'value';
      try {
        const v = a[i];
        val.textContent = stringifyValue(v);
      } catch(e){
        val.textContent = '?';
      }
      cell.appendChild(idx);
      cell.appendChild(val);
      // clickable removal (only for normal arrays)
      cell.addEventListener('click', () => {
        if (Array.isArray(arr)) {
          const removed = arr.splice(i,1);
          log(`splice(${i},1) -> removed ${stringifyValue(removed[0])}`);
          render();
        } else {
          log('Cannot remove by click from TypedArray (fixed length). Convert to normal array to mutate freely.');
        }
      });
      visual.appendChild(cell);
    }
    // show info row if empty
    if (!a || a.length === 0) {
      const note = document.createElement('div');
      note.className = 'muted';
      note.textContent = 'Array is empty — load values on the left or try examples on the right.';
      visual.appendChild(note);
    }
  }

  function stringifyValue(v) {
    if (typeof v === 'string') return `"${v}"`;
    if (v === null) return 'null';
    if (v === undefined) return 'undefined';
    if (Array.isArray(v)) return '[' + v.map(stringifyValue).join(',') + ']';
    if (typeof v === 'object') {
      try { return JSON.stringify(v); } catch(e){ return String(v); }
    }
    return String(v);
  }

  function log(...parts) {
    const time = new Date().toLocaleTimeString();
    const line = document.createElement('div');
    line.innerHTML = `<span style="color:var(--muted);font-size:12px">[${time}]</span> ` + parts.map(p => {
      if (typeof p === 'string') return escapeHtml(p);
      try { return escapeHtml(JSON.stringify(p)); } catch(e){ return escapeHtml(String(p)); }
    }).join(' ');
    logEl.prepend(line);
  }

  function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

  // Wire up controls
  document.getElementById('btnLoad').addEventListener('click', () => {
    const txt = document.getElementById('inputArray').value;
    const parsed = parseInputToArray(txt);
    arr = createArrayFromJs(parsed);
    log('Loaded array:', parsed);
    render();
  });

  document.getElementById('btnRandom').addEventListener('click', ()=>{
    const n = 6;
    const a = Array.from({length:n}, ()=>Math.floor(Math.random()*100));
    arr = createArrayFromJs(a);
    log('Random array:', a);
    render();
  });

  document.getElementById('btnClear').addEventListener('click', ()=> {
    arr = createArrayFromJs([]);
    log('Cleared array');
    render();
  });

  // Examples
  document.getElementById('exNums').addEventListener('click', ()=> {
    arr = createArrayFromJs([1,2,3,4]);
    log('Example: [1,2,3,4]');
    render();
  });
  document.getElementById('exStr').addEventListener('click', ()=> {
    arr = createArrayFromJs(['a','b','c']);
    log("Example: ['a','b','c']");
    render();
  });
  document.getElementById('exNested').addEventListener('click', ()=> {
    arr = createArrayFromJs([[1,2],[3,4]]);
    log('Example: nested arrays [[1,2],[3,4]]');
    render();
  });
  document.getElementById('exMixed').addEventListener('click', ()=> {
    arr = createArrayFromJs([1,'x',true,null]);
    log('Example: mixed [1,"x",true,null]');
    render();
  });

  // Array type selector
  document.getElementById('arrayType').addEventListener('change', (e)=>{
    const v = e.target.value;
    if (v === type) return;
    type = v;
    // convert current arr to new type
    arr = createArrayFromJs(Array.isArray(arr) ? arr : Array.from(arr));
    updateTypeLabel();
    log('Changed array type to', type);
    render();
  });

  function updateTypeLabel(){
    const isTyped = ArrayBuffer.isView(arr) && !(arr instanceof DataView);
    typeEl.textContent = isTyped ? (arr.constructor && arr.constructor.name) : (Array.isArray(arr) ? 'Array' : typeof arr);
  }

  // Basic mutating ops
  document.getElementById('push').addEventListener('click', ()=> {
    if (!Array.isArray(arr)) { log('push: convert to normal Array first.'); ensureNormal(); }
    const v = parseSingle(document.getElementById('opValue').value);
    arr.push(v);
    log('push(', stringifyValue(v), ')');
    render();
  });
  document.getElementById('pop').addEventListener('click', ()=> {
    if (!Array.isArray(arr)) { log('pop: cannot pop from TypedArray. Convert to normal Array.'); return; }
    const r = arr.pop();
    log('pop() ->', stringifyValue(r));
    render();
  });
  document.getElementById('shift').addEventListener('click', ()=> {
    if (!Array.isArray(arr)) { log('shift: convert to normal Array first.'); ensureNormal(); }
    const r = arr.shift();
    log('shift() ->', stringifyValue(r));
    render();
  });
  document.getElementById('unshift').addEventListener('click', ()=> {
    if (!Array.isArray(arr)) { log('unshift: convert to normal Array first.'); ensureNormal(); }
    const v = parseSingle(document.getElementById('opValue').value);
    arr.unshift(v);
    log('unshift(', stringifyValue(v), ')');
    render();
  });

  document.getElementById('splice').addEventListener('click', ()=> {
    if (!Array.isArray(arr)) { log('splice: convert to normal Array first.'); ensureNormal(); }
    const i = Number(document.getElementById('opIndex').value) || 0;
    const del = (document.getElementById('opEnd').value === '') ? undefined : Number(document.getElementById('opEnd').value);
    const itemsTxt = document.getElementById('opValue').value;
    const items = itemsTxt ? parseInputToArray(itemsTxt) : [];
    const r = arr.splice(i, isNaN(del) ? undefined : del, ...items);
    log(`splice(${i},${isNaN(del)?''+arr.length:del},[${items.map(stringifyValue).join(',')}]) -> removed ${stringifyValue(r)}`);
    render();
  });

  document.getElementById('slice').addEventListener('click', ()=> {
    const s = document.getElementById('opIndex').value === '' ? 0 : Number(document.getElementById('opIndex').value);
    const e = document.getElementById('opEnd').value === '' ? undefined : Number(document.getElementById('opEnd').value);
    const r = Array.prototype.slice.call(arr, s, e);
    log(`slice(${s},${e}) ->`, r);
    // show result in a popup-ish: set arr to result
    arr = createArrayFromJs(r);
    render();
  });

  document.getElementById('concat').addEventListener('click', ()=> {
    const v = parseInputToArray(document.getElementById('opValue').value || '');
    const result = Array.prototype.concat.call(Array.isArray(arr)?arr:Array.from(arr), v);
    arr = createArrayFromJs(result);
    log('concat ->', result);
    render();
  });

  document.getElementById('fill').addEventListener('click', ()=> {
    if (!Array.isArray(arr)) { log('fill: convert to normal Array first.'); ensureNormal(); }
    const v = parseSingle(document.getElementById('opValue').value);
    const s = document.getElementById('opIndex').value === '' ? 0 : Number(document.getElementById('opIndex').value);
    const e = document.getElementById('opEnd').value === '' ? undefined : Number(document.getElementById('opEnd').value);
    arr.fill(v, s, e);
    log(`fill(${stringifyValue(v)}, ${s}, ${e})`);
    render();
  });

  document.getElementById('reverse').addEventListener('click', ()=> {
    if (!Array.isArray(arr)) { log('reverse: convert to normal Array first.'); ensureNormal(); }
    arr.reverse();
    log('reverse()');
    render();
  });

  document.getElementById('sort').addEventListener('click', ()=> {
    if (!Array.isArray(arr)) { log('sort: convert to normal Array first.'); ensureNormal(); }
    try {
      arr.sort();
      log('sort()');
    } catch(e){ log('sort() error', e.message); }
    render();
  });

  document.getElementById('flat').addEventListener('click', ()=> {
    const d = document.getElementById('opIndex').value === '' ? 1 : Number(document.getElementById('opIndex').value);
    const r = arr.flat ? arr.flat(d) : Array.prototype.concat.apply([], arr);
    arr = createArrayFromJs(r);
    log(`flat(${d}) ->`, r);
    render();
  });

  // Higher-order functions
  function safeEval(fnText) {
    // Accept arrow functions like "x => x*2" or "(a,b)=>a+b"
    try {
      if (!fnText || fnText.trim() === '') return null;
      // Wrap into parentheses to allow object returns and arrow functions
      const f = eval(`(${fnText})`);
      if (typeof f === 'function') return f;
    } catch(e){
      log('Invalid expression:', fnText, e.message);
    }
    return null;
  }

  document.getElementById('mapBtn').addEventListener('click', ()=> {
    const expr = document.getElementById('expr').value || 'x => x';
    const fn = safeEval(expr) || (x=>x);
    try {
      const result = Array.prototype.map.call(Array.isArray(arr)?arr:Array.from(arr), fn);
      arr = createArrayFromJs(result);
      log('map ->', result);
      render();
    } catch(e){ log('map error:', e.message); }
  });

  document.getElementById('filterBtn').addEventListener('click', ()=> {
    const expr = document.getElementById('expr').value || 'x => true';
    const fn = safeEval(expr) || (x=>true);
    try {
      const result = Array.prototype.filter.call(Array.isArray(arr)?arr:Array.from(arr), fn);
      arr = createArrayFromJs(result);
      log('filter ->', result);
      render();
    } catch(e){ log('filter error:', e.message); }
  });

  document.getElementById('reduceBtn').addEventListener('click', ()=> {
    const expr = document.getElementById('expr').value || '(a,b)=>a+b';
    const fn = safeEval(expr) || ((a,b)=>a+b);
    const init = (() => {
      const v = document.getElementById('opValue').value;
      return v === '' ? undefined : parseSingle(v);
    })();
    try {
      const result = Array.prototype.reduce.call(Array.isArray(arr)?arr:Array.from(arr), fn, init);
      log('reduce ->', result);
      // show result as single-element array for visualization
      arr = createArrayFromJs([result]);
      render();
    } catch(e){ log('reduce error:', e.message); }
  });

  document.getElementById('findBtn').addEventListener('click', ()=> {
    const expr = document.getElementById('expr').value || 'x => true';
    const fn = safeEval(expr) || (x=>true);
    try {
      const result = Array.prototype.find.call(Array.isArray(arr)?arr:Array.from(arr), fn);
      log('find ->', result);
      arr = createArrayFromJs([result]);
      render();
    } catch(e){ log('find error:', e.message); }
  });

  document.getElementById('someBtn').addEventListener('click', ()=> {
    const expr = document.getElementById('expr').value || 'x => false';
    const fn = safeEval(expr) || (x=>false);
    const result = Array.prototype.some.call(Array.isArray(arr)?arr:Array.from(arr), fn);
    log('some ->', result);
    arr = createArrayFromJs([result]);
    render();
  });

  document.getElementById('everyBtn').addEventListener('click', ()=> {
    const expr = document.getElementById('expr').value || 'x => false';
    const fn = safeEval(expr) || (x=>false);
    const result = Array.prototype.every.call(Array.isArray(arr)?arr:Array.from(arr), fn);
    log('every ->', result);
    arr = createArrayFromJs([result]);
    render();
  });

  document.getElementById('forEachBtn').addEventListener('click', ()=> {
    const expr = document.getElementById('expr').value || 'x => console.log(x)';
    const fn = safeEval(expr) || (x=>void 0);
    try {
      const out = [];
      Array.prototype.forEach.call(Array.isArray(arr)?arr:Array.from(arr), (v,i)=>{
        try { out.push(fn(v,i)); } catch(e){ out.push('[error]'); }
      });
      log('forEach produced (collected results) ->', out);
    } catch(e){ log('forEach error:', e.message); }
  });

  document.getElementById('flatMapBtn').addEventListener('click', ()=> {
    const expr = document.getElementById('expr').value || 'x => [x]';
    const fn = safeEval(expr) || (x=>[x]);
    try {
      const result = Array.prototype.flatMap.call(Array.isArray(arr)?arr:Array.from(arr), fn);
      arr = createArrayFromJs(result);
      log('flatMap ->', result);
      render();
    } catch(e){ log('flatMap error:', e.message); }
  });

  // Utilities
  document.getElementById('copySlice').addEventListener('click', ()=> {
    const copy = Array.isArray(arr) ? arr.slice() : Array.from(arr);
    log('copy ->', copy);
    arr = createArrayFromJs(copy);
    render();
  });

  document.getElementById('toString').addEventListener('click', ()=> {
    const sep = document.getElementById('opValue').value || ',';
    const s = Array.prototype.join.call(Array.isArray(arr)?arr:Array.from(arr), sep);
    log(`join('${sep}') ->`, s);
    arr = createArrayFromJs([s]);
    render();
  });

  document.getElementById('indexOf').addEventListener('click', ()=> {
    const v = parseSingle(document.getElementById('opValue').value);
    const i = Array.prototype.indexOf.call(Array.isArray(arr)?arr:Array.from(arr), v);
    log(`indexOf(${stringifyValue(v)}) ->`, i);
    arr = createArrayFromJs([i]);
    render();
  });

  document.getElementById('includes').addEventListener('click', ()=> {
    const v = parseSingle(document.getElementById('opValue').value);
    const r = Array.prototype.includes.call(Array.isArray(arr)?arr:Array.from(arr), v);
    log(`includes(${stringifyValue(v)}) ->`, r);
    arr = createArrayFromJs([r]);
    render();
  });

  document.getElementById('flatten1').addEventListener('click', ()=> {
    const r = (Array.prototype.flat) ? arr.flat(1) : Array.prototype.concat.apply([], arr);
    arr = createArrayFromJs(r);
    log('flat(1) ->', r);
    render();
  });

  document.getElementById('typedDemo').addEventListener('click', ()=> {
    // Show typed array behavior
    const sample = new Int16Array([10,20,30,40]);
    arr = sample;
    type = 'int16';
    document.getElementById('arrayType').value = 'int16';
    log('TypedArray demo: Int16Array([10,20,30,40]) — fixed length, numeric only.');
    render();
  });

  // Examples & recipes
  document.getElementById('evens').addEventListener('click', ()=> {
    const nums = Array.prototype.slice.call(Array.isArray(arr)?arr:Array.from(arr));
    const res = nums.filter(x => Number.isFinite(x) && x % 2 === 0);
    log('Filter evens ->', res);
    arr = createArrayFromJs(res);
    render();
  });

  document.getElementById('sum').addEventListener('click', ()=> {
    const nums = Array.prototype.slice.call(Array.isArray(arr)?arr:Array.from(arr));
    const s = nums.reduce((a,b)=> (Number(a)||0) + (Number(b)||0), 0);
    log('Sum ->', s);
    arr = createArrayFromJs([s]);
    render();
  });

  document.getElementById('unique').addEventListener('click', ()=> {
    const a = Array.prototype.slice.call(Array.isArray(arr)?arr:Array.from(arr));
    const u = Array.from(new Set(a));
    log('Unique ->', u);
    arr = createArrayFromJs(u);
    render();
  });

  document.getElementById('groupBy').addEventListener('click', ()=> {
    const a = Array.prototype.slice.call(Array.isArray(arr)?arr:Array.from(arr));
    const groups = a.reduce((acc, x) => {
      const k = (typeof x === 'number' && !isNaN(x) ? (x % 2 === 0 ? 'even' : 'odd') : 'other');
      acc[k] = acc[k] || [];
      acc[k].push(x);
      return acc;
    }, {});
    log('Group by parity ->', groups);
    arr = createArrayFromJs(Object.entries(groups));
    render();
  });

  // Log controls
  document.getElementById('clearLog').addEventListener('click', ()=> logEl.innerHTML = '');

  document.getElementById('export').addEventListener('click', ()=> {
    try {
      const data = Array.isArray(arr) ? arr : Array.from(arr);
      const json = JSON.stringify(data, null, 2);
      const blob = new Blob([json], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'array.json';
      a.click();
      URL.revokeObjectURL(url);
      log('Exported array as JSON');
    } catch(e){ log('Export failed', e.message); }
  });

  // parse a single value (for op inputs)
  function parseSingle(s) {
    if (s === undefined || s === null || s === '') return undefined;
    // Trim
    const t = String(s).trim();
    if (t === '') return '';
    if (t === 'null') return null;
    if (t === 'undefined') return undefined;
    if (t === 'true') return true;
    if (t === 'false') return false;
    if (!isNaN(Number(t))) return Number(t);
    if ((t.startsWith('"') && t.endsWith('"')) || (t.startsWith("'") && t.endsWith("'"))) return t.slice(1,-1);
    return t;
  }

  // init with a sample
  arr = createArrayFromJs([1,2,3,4,5]);
  log('Initialized with sample [1,2,3,4,5]');
  render();

})();
</script>
</body>
</html>