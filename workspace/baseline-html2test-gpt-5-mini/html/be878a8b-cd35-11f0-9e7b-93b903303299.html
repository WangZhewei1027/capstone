<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Counting Sort Visualizer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root{
      --bg:#0f1724; --panel:#0b1220; --accent:#06b6d4; --muted:#94a3b8; --card:#071126;
      --good:#10b981; --bad:#ef4444;
      --bar-height:120px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color-scheme: dark;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#031225 0%, #061022 100%); color:white}
    .container{max-width:1100px;margin:18px auto;padding:18px;display:grid;grid-template-columns:360px 1fr;gap:18px}
    .panel{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border:1px solid rgba(255,255,255,0.03);padding:14px;border-radius:10px;box-shadow:0 6px 20px rgba(2,6,23,0.6)}
    h1{margin:0 0 8px;font-size:18px}
    .controls{display:flex;flex-direction:column;gap:10px}
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    .row{display:flex;gap:8px;align-items:center}
    input[type=range]{width:100%}
    button{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:var(--accent);cursor:pointer}
    button.secondary{color:var(--muted)}
    .buttons{display:flex;gap:6px;flex-wrap:wrap}
    .stats{font-size:13px;color:var(--muted);margin-top:8px}
    .visual{display:flex;flex-direction:column;gap:12px}
    .arrays{display:flex;flex-direction:column;gap:10px}
    .array-row{display:flex;gap:8px;align-items:end;padding:6px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);border-radius:8px}
    .array-title{width:140px;color:var(--muted);font-size:13px}
    .bars{display:flex;gap:6px;align-items:end;padding:6px;flex-wrap:nowrap;overflow:auto}
    .bar{width:36px;height:var(--bar-height);display:flex;flex-direction:column;align-items:center;justify-content:flex-end;padding:4px;border-radius:6px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));position:relative;min-width:36px}
    .bar .value{background:rgba(255,255,255,0.04);padding:4px 6px;border-radius:6px;font-size:13px;margin-top:6px;color:var(--muted)}
    .bar.active{outline:3px solid rgba(6,182,212,0.12);box-shadow:0 6px 18px rgba(6,182,212,0.06)}
    .bar.count{width:48px;min-width:48px}
    .bar .height{width:100%;background:linear-gradient(180deg,var(--accent),#0f5560);border-radius:4px 4px 0 0}
    .bar .height.zero{background:rgba(255,255,255,0.02)}
    .pointer{position:absolute;top:-24px;left:50%;transform:translateX(-50%);font-size:12px;color:var(--muted)}
    .step-info{font-size:13px;color:var(--muted);margin-top:6px}
    .legend{font-size:13px;color:var(--muted);margin-top:8px}
    .explain{font-size:13px;color:var(--muted);line-height:1.4}
    .small{font-size:12px;color:var(--muted)}
    .badge{display:inline-block;padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);font-size:12px;color:var(--muted)}
    .footer{margin-top:12px;font-size:13px;color:var(--muted)}
    .highlight{outline:3px solid rgba(255,205,86,0.14);box-shadow:0 6px 18px rgba(255,205,86,0.04)}
    @media (max-width:920px){.container{grid-template-columns:1fr; padding:10px}}
  </style>
</head>
<body>
  <div class="container">
    <div class="panel">
      <h1>Counting Sort â€” Interactive Visualizer</h1>
      <div class="explain">
        Counting Sort is a non-comparison, stable sorting algorithm for integers in a small range [0..k].
        It counts occurrences, computes cumulative positions, and places items into an output array.
      </div>

      <div style="height:12px"></div>

      <div class="controls">
        <div>
          <label>Array size: <span id="sizeLabel">12</span></label>
          <input id="size" type="range" min="2" max="40" value="12">
        </div>
        <div>
          <label>Maximum value (k): <span id="kLabel">9</span></label>
          <input id="maxVal" type="range" min="1" max="50" value="9">
        </div>
        <div>
          <label>Speed: <span id="speedLabel">600ms</span></label>
          <input id="speed" type="range" min="50" max="1500" value="600">
        </div>

        <div style="display:flex;gap:8px;">
          <button id="gen">Generate Random</button>
          <button id="genUnique" class="secondary">Generate Unique</button>
        </div>

        <div style="display:flex;gap:8px;margin-top:8px;">
          <button id="start">Start</button>
          <button id="pause" class="secondary" disabled>Pause</button>
          <button id="step" class="secondary">Step</button>
          <button id="reset" class="secondary">Reset</button>
        </div>

        <div class="stats">
          <div class="row" style="justify-content:space-between">
            <div class="small">Complexity</div>
            <div class="small badge">Time: O(n + k) &nbsp; Space: O(n + k)</div>
          </div>
          <div class="row" style="justify-content:space-between;margin-top:6px">
            <div class="small">Stability</div>
            <div class="small badge">Stable</div>
          </div>
        </div>

        <div class="legend">
          <div style="margin-top:8px" class="small">Legend: <span style="color:var(--accent)">Active</span>, <span style="color:var(--muted)">Counts</span>, <span style="color:var(--done)"></span></div>
        </div>

      </div>

      <div class="footer">
        Use Step to move one micro-step at a time. Start runs automatically with selected speed.
      </div>
    </div>

    <div class="panel visual">
      <div class="arrays">
        <div class="array-row" style="align-items:flex-end">
          <div class="array-title">Input Array</div>
          <div class="bars" id="inputBars" aria-hidden="true"></div>
        </div>

        <div class="array-row">
          <div class="array-title">Counts (0..k)</div>
          <div class="bars" id="countBars" aria-hidden="true"></div>
        </div>

        <div class="array-row">
          <div class="array-title">Cumulative</div>
          <div class="bars" id="cumBars" aria-hidden="true"></div>
        </div>

        <div class="array-row">
          <div class="array-title">Output (building)</div>
          <div class="bars" id="outBars" aria-hidden="true"></div>
        </div>
      </div>

      <div class="step-info" id="stepInfo">Status: ready</div>
    </div>
  </div>

<script>
/*
  Counting Sort Visualizer
  - Implements step-by-step counting sort:
    1) Count occurrences
    2) Compute cumulative counts
    3) Build output (stable: traverse input from end)
    4) Copy output back (visual only)
  - Controls: generate, start/pause, step, reset, size, maxVal, speed
*/

const sizeSlider = document.getElementById('size');
const sizeLabel = document.getElementById('sizeLabel');
const maxValSlider = document.getElementById('maxVal');
const kLabel = document.getElementById('kLabel');
const speedSlider = document.getElementById('speed');
const speedLabel = document.getElementById('speedLabel');

const genBtn = document.getElementById('gen');
const genUniqueBtn = document.getElementById('genUnique');
const startBtn = document.getElementById('start');
const pauseBtn = document.getElementById('pause');
const stepBtn = document.getElementById('step');
const resetBtn = document.getElementById('reset');

const inputBars = document.getElementById('inputBars');
const countBars = document.getElementById('countBars');
const cumBars = document.getElementById('cumBars');
const outBars = document.getElementById('outBars');
const stepInfo = document.getElementById('stepInfo');

let arr = [];
let n = parseInt(sizeSlider.value);
let k = parseInt(maxValSlider.value);
let counts = [];
let cum = [];
let out = [];
let state = 'ready'; // 'count', 'cum', 'build', 'copy', 'done'
let i = 0, j = 0; // loop indices
let timer = null;
let speed = parseInt(speedSlider.value);
let paused = false;

function rndArr(n,k,unique=false){
  let a=[];
  if(unique){
    // generate shuffled unique numbers in [0..k] with k+1 >= n
    let maxK = Math.max(k, n-1);
    let pool = [];
    for(let x=0;x<=maxK;x++) pool.push(x);
    // shuffle
    for(let t=pool.length-1; t>0; t--){
      let r=Math.floor(Math.random()*(t+1)); [pool[t],pool[r]]=[pool[r],pool[t]];
    }
    a = pool.slice(0,n);
  } else {
    for(let t=0;t<n;t++) a.push(Math.floor(Math.random()*(k+1)));
  }
  return a;
}

function init(){
  n = parseInt(sizeSlider.value);
  k = parseInt(maxValSlider.value);
  speed = parseInt(speedSlider.value);

  sizeLabel.textContent = n;
  kLabel.textContent = k;
  speedLabel.textContent = speed + 'ms';

  arr = rndArr(n,k);
  counts = new Array(k+1).fill(0);
  cum = new Array(k+1).fill(0);
  out = new Array(n).fill(null);

  state = 'count';
  i = 0; j = 0;
  paused = false;
  updateAll();
  setStepInfo('Ready. Press Start to run or Step to advance one micro-step.');
  startBtn.disabled = false;
  pauseBtn.disabled = true;
}

function updateAll(){
  renderInput();
  renderCounts();
  renderCum();
  renderOut();
}

function renderInput(activeIndex=null, removed=[]) {
  inputBars.innerHTML = '';
  const maxHeight = 120;
  const maxVal = Math.max(...arr, k);
  for(let idx=0; idx<arr.length; idx++){
    const v = arr[idx];
    const bar = document.createElement('div');
    bar.className = 'bar';
    if(activeIndex===idx) bar.classList.add('active');
    if(removed.indexOf(idx)!==-1){
      bar.style.opacity = '0.25';
    }
    bar.style.minHeight = '56px';
    // height proportion
    const h = (maxVal>0) ? Math.max(6, Math.round((v/maxVal)*maxHeight)) : 6;
    const height = document.createElement('div');
    height.className = 'height';
    height.style.height = h + 'px';
    if(v===0) height.classList.add('zero');
    const val = document.createElement('div');
    val.className = 'value';
    val.textContent = v;
    bar.appendChild(height);
    bar.appendChild(val);
    if(activeIndex===idx){
      const p = document.createElement('div'); p.className='pointer'; p.textContent='i=' + idx;
      bar.appendChild(p);
    }
    inputBars.appendChild(bar);
  }
}

function renderCounts(activeIndex=null){
  countBars.innerHTML = '';
  const maxCount = Math.max(1, ...counts);
  for(let v=0; v<=k; v++){
    const c = counts[v] || 0;
    const bar = document.createElement('div');
    bar.className = 'bar count';
    if(activeIndex===v) bar.classList.add('active');
    const hRatio = c / maxCount;
    const h = Math.max(8, Math.round(hRatio * 80));
    const height = document.createElement('div');
    height.className='height';
    height.style.height = h + 'px';
    if(c===0) height.classList.add('zero');
    const txt = document.createElement('div');
    txt.className='value';
    txt.textContent = c;
    const lbl = document.createElement('div'); lbl.className='small'; lbl.style.position='absolute'; lbl.style.bottom='-20px'; lbl.style.fontSize='12px'; lbl.style.color='var(--muted)'; lbl.textContent = v;
    bar.appendChild(height);
    bar.appendChild(txt);
    bar.appendChild(lbl);
    countBars.appendChild(bar);
  }
}

function renderCum(activeIndex=null){
  cumBars.innerHTML = '';
  const maxMade = Math.max(1, ...cum);
  for(let v=0; v<=k; v++){
    const c = cum[v] || 0;
    const bar = document.createElement('div');
    bar.className = 'bar count';
    if(activeIndex===v) bar.classList.add('highlight');
    const hRatio = c / maxMade;
    const h = Math.max(8, Math.round(hRatio * 80));
    const height = document.createElement('div');
    height.className='height';
    height.style.height = h + 'px';
    if(c===0) height.classList.add('zero');
    const txt = document.createElement('div');
    txt.className='value';
    txt.textContent = c;
    const lbl = document.createElement('div'); lbl.className='small'; lbl.style.position='absolute'; lbl.style.bottom='-20px'; lbl.style.fontSize='12px'; lbl.style.color='var(--muted)'; lbl.textContent = v;
    bar.appendChild(height);
    bar.appendChild(txt);
    bar.appendChild(lbl);
    cumBars.appendChild(bar);
  }
}

function renderOut(activeIndex=null){
  outBars.innerHTML = '';
  const maxVal = Math.max(...arr, ...out.filter(x=>x!==null), k);
  for(let idx=0; idx<out.length; idx++){
    const v = out[idx];
    const bar = document.createElement('div');
    bar.className = 'bar';
    if(activeIndex===idx) bar.classList.add('active');
    const h = (v===null) ? 6 : Math.max(6, Math.round((v/maxVal)*120));
    const height = document.createElement('div');
    height.className='height';
    height.style.height = h + 'px';
    if(v===null) height.classList.add('zero');
    const txt = document.createElement('div');
    txt.className='value';
    txt.textContent = (v===null) ? '' : v;
    bar.appendChild(height);
    bar.appendChild(txt);
    outBars.appendChild(bar);
  }
}

function setStepInfo(msg){
  stepInfo.textContent = 'Status: ' + msg;
}

function startAuto(){
  if(state === 'done') return;
  startBtn.disabled = true;
  pauseBtn.disabled = false;
  stepBtn.disabled = true;
  genBtn.disabled = true;
  genUniqueBtn.disabled = true;
  sizeSlider.disabled = true;
  maxValSlider.disabled = true;
  resetBtn.disabled = false;
  if(timer) clearInterval(timer);
  timer = setInterval(()=>{ if(!paused) nextStep(); }, speed);
}

function pauseAuto(){
  startBtn.disabled = false;
  pauseBtn.disabled = true;
  stepBtn.disabled = false;
  genBtn.disabled = false;
  genUniqueBtn.disabled = false;
  sizeSlider.disabled = false;
  maxValSlider.disabled = false;
  if(timer) { clearInterval(timer); timer = null; }
}

function resetState(){
  if(timer) clearInterval(timer);
  timer = null;
  sizeSlider.disabled = false;
  maxValSlider.disabled = false;
  genBtn.disabled = false;
  genUniqueBtn.disabled = false;
  startBtn.disabled = false;
  pauseBtn.disabled = true;
  stepBtn.disabled = false;
  init();
}

// The core micro-stepper: we advance one tiny step in the algorithm
function nextStep(){
  if(state === 'count'){
    // loop i = 0..n-1, increment count[arr[i]]
    if(i < n){
      const val = arr[i];
      setStepInfo(`Counting: reading arr[${i}] = ${val} -> count[${val}]++`);
      counts[val] = (counts[val] || 0) + 1;
      renderInput(i);
      renderCounts(i);
      renderCum();
      renderOut();
      i++;
    } else {
      // move to cumulative
      i = 0;
      state = 'cum';
      setStepInfo('Counting complete. Now computing cumulative counts.');
      renderCounts();
    }
    return;
  }

  if(state === 'cum'){
    // build cumulative counts: cum[0]=counts[0], cum[i]=cum[i-1]+counts[i]
    if(i === 0){
      cum[0] = counts[0] || 0;
      renderCum(0); setStepInfo(`cum[0] = ${cum[0]}`);
      i++;
      return;
    }
    if(i <= k){
      cum[i] = (cum[i-1] || 0) + (counts[i] || 0);
      renderCum(i); setStepInfo(`cum[${i}] = cum[${i-1}] + count[${i}] = ${cum[i]}`);
      i++;
      return;
    } else {
      // done cumulative
      i = n-1; // prepare for building output: traverse input from end
      state = 'build';
      setStepInfo('Cumulative computed. Building output array (stable) by traversing input from end.');
      renderCum();
      renderCounts();
      renderOut();
      return;
    }
  }

  if(state === 'build'){
    // traverse input from end: for i from n-1 downto 0:
    if(i >= 0){
      const val = arr[i];
      const pos = (cum[val] || 0) - 1;
      setStepInfo(`Placing arr[${i}] = ${val} into out[${pos}] (cum[${val}]--)`);
      out[pos] = val;
      cum[val] = pos; // decrement: cum[val] now points to next free slot
      renderInput(i, [i]); // show this input element faded
      renderCounts();
      renderCum(val);
      renderOut(pos);
      i--;
      return;
    } else {
      // output built
      state = 'copy';
      i = 0;
      setStepInfo('Output built. Copying back to input (visual).');
      renderInput();
      renderOut();
      renderCounts();
      renderCum();
      return;
    }
  }

  if(state === 'copy'){
    if(i < n){
      // copy out[i] to arr[i]
      setStepInfo(`Copy back: arr[${i}] = out[${i}] (${out[i]})`);
      arr[i] = out[i];
      renderInput(i);
      renderOut(i);
      i++;
      return;
    } else {
      state = 'done';
      setStepInfo('Sorting complete. Result is stable and ascending.');
      renderInput();
      renderOut();
      renderCounts();
      renderCum();
      // stop auto if running
      if(timer) { clearInterval(timer); clearInterval(timer); timer = null; }
      startBtn.disabled = true;
      pauseBtn.disabled = true;
      stepBtn.disabled = true;
      genBtn.disabled = false;
      genUniqueBtn.disabled = false;
      sizeSlider.disabled = false;
      maxValSlider.disabled = false;
      return;
    }
  }
}

sizeSlider.addEventListener('input', ()=>{
  sizeLabel.textContent = sizeSlider.value;
});
maxValSlider.addEventListener('input', ()=>{
  kLabel.textContent = maxValSlider.value;
});
speedSlider.addEventListener('input', ()=>{
  speed = parseInt(speedSlider.value);
  speedLabel.textContent = speed + 'ms';
  if(timer){
    clearInterval(timer);
    timer = setInterval(()=>{ if(!paused) nextStep(); }, speed);
  }
});

genBtn.addEventListener('click', ()=>{
  arr = rndArr(parseInt(sizeSlider.value), parseInt(maxValSlider.value), false);
  counts = new Array(parseInt(maxValSlider.value)+1).fill(0);
  cum = new Array(parseInt(maxValSlider.value)+1).fill(0);
  out = new Array(parseInt(sizeSlider.value)).fill(null);
  state = 'count'; i=0;
  updateAll();
  setStepInfo('Random array generated. Ready.');
});

genUniqueBtn.addEventListener('click', ()=>{
  arr = rndArr(parseInt(sizeSlider.value), parseInt(maxValSlider.value), true);
  counts = new Array(parseInt(maxValSlider.value)+1).fill(0);
  cum = new Array(parseInt(maxValSlider.value)+1).fill(0);
  out = new Array(parseInt(sizeSlider.value)).fill(null);
  state = 'count'; i=0;
  updateAll();
  setStepInfo('Unique random array generated. Ready.');
});

startBtn.addEventListener('click', ()=>{
  paused = false;
  startAuto();
});

pauseBtn.addEventListener('click', ()=>{
  paused = true;
  pauseAuto();
});

stepBtn.addEventListener('click', ()=>{
  // advance one micro-step
  nextStep();
});

resetBtn.addEventListener('click', ()=>{
  resetState();
});

// initialization
init();

// keyboard shortcuts: Space = step, Enter = start/pause
document.addEventListener('keydown', (e)=>{
  if(e.code === 'Space'){ e.preventDefault(); nextStep(); }
  if(e.code === 'Enter'){ e.preventDefault(); if(!timer) startAuto(); else pauseAuto(); }
});

</script>

</body>
</html>