<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Radix Sort Visualizer</title>
<style>
  :root{
    --bg:#0f1724;
    --panel:#0b1220;
    --accent:#00b4d8;
    --muted:#94a3b8;
    --good:#2dd4bf;
    --danger:#ff6b6b;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#071229, #071a2a);font-family:Inter,Segoe UI,Roboto,Arial,sans-serif;color:#e6eef8}
  .app{max-width:1100px;margin:24px auto;padding:18px;background:linear-gradient(180deg,#061226 0%, rgba(6,18,38,0.2) 100%);border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.6)}
  header{display:flex;align-items:center;gap:16px}
  header h1{font-size:20px;margin:0;color:var(--accent)}
  .controls{display:flex;flex-wrap:wrap;gap:12px;margin-top:12px;align-items:center}
  .control{background:var(--panel);padding:8px;border-radius:8px;display:flex;gap:8px;align-items:center}
  label{font-size:13px;color:var(--muted)}
  input[type=range]{width:160px}
  select,input[type=number]{background:#061623;border:1px solid rgba(255,255,255,0.04);padding:6px;border-radius:6px;color:#dff3ff}
  button{background:linear-gradient(180deg,#0f3460,#07203c);border:1px solid rgba(255,255,255,0.04);padding:8px 12px;border-radius:8px;color:#e6f8ff;cursor:pointer}
  button.secondary{background:#112033;color:#bfe9ff}
  button:disabled{opacity:0.45;cursor:not-allowed}
  .visual{display:flex;gap:18px;margin-top:18px}
  .canvas{flex:1;background:linear-gradient(180deg,#051224,#07172a);padding:14px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
  .array-view{height:220px;display:flex;align-items:end;gap:6px;padding:6px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border-radius:8px}
  .bar{background:linear-gradient(180deg,#2aa6d6,#1a6f93);width:28px;border-radius:6px;display:flex;align-items:end;justify-content:center;color:#031726;font-weight:700;box-shadow:0 3px 8px rgba(2,8,18,0.6);position:relative}
  .bar.small{width:20px}
  .bar .label{position:absolute;top:6px;font-size:12px;color:#e8fbff}
  .bar.dim{opacity:0.45}
  .bar.moving{outline:3px solid rgba(255,255,255,0.06)}
  .buckets{margin-top:14px;display:flex;gap:8px;flex-wrap:wrap}
  .bucket{flex:0 0 calc(100% / 10 - 8px);min-width:48px;background:linear-gradient(180deg,#031827,#05243b);padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;align-items:center;gap:6px}
  .bucket .bidx{font-size:12px;color:var(--muted);font-weight:700}
  .bucket .items{display:flex;flex-direction:column;gap:4px;align-items:center;min-height:28px}
  .bucket .item{background:#083447;color:#dffbff;padding:4px 6px;border-radius:6px;font-size:12px;min-width:24px;text-align:center}
  .status{margin-top:12px;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .chip{background:rgba(255,255,255,0.03);padding:8px;border-radius:8px;font-size:13px;color:#cfeffb}
  .legend{font-size:13px;color:var(--muted);margin-top:10px}
  .footer{margin-top:18px;color:var(--muted);font-size:13px;display:flex;justify-content:space-between;align-items:center}
  .small-muted{font-size:12px;color:var(--muted)}
  .top-row{display:flex;gap:12px;align-items:center}
  .right-controls{display:flex;gap:8px}
  .note{margin-top:8px;color:#9fcbea;font-size:13px}
  @media(max-width:800px){
    .bucket{flex:0 0 46%}
    .bar{width:20px}
  }
</style>
</head>
<body>
<div class="app">
  <header>
    <div>
      <h1>Radix Sort Visualizer (LSD - Least Significant Digit)</h1>
      <div class="small-muted">Stable, non-comparative integer sorting by processing digits from least significant to most significant.</div>
    </div>
  </header>

  <div class="controls" style="margin-top:14px">
    <div class="control">
      <label>Array size</label>
      <input id="size" type="range" min="3" max="60" value="20">
      <div id="sizeVal" class="small-muted" style="min-width:36px;text-align:center">20</div>
    </div>

    <div class="control">
      <label>Max value</label>
      <input id="maxVal" type="range" min="5" max="500" value="120">
      <div id="maxValVal" class="small-muted" style="min-width:44px;text-align:center">120</div>
    </div>

    <div class="control">
      <label>Base (radix)</label>
      <select id="base">
        <option value="2">2 (binary)</option>
        <option value="4">4</option>
        <option value="8">8 (octal)</option>
        <option selected value="10">10 (decimal)</option>
        <option value="16">16 (hex)</option>
      </select>
    </div>

    <div class="control">
      <label>Speed (ms)</label>
      <input id="speed" type="range" min="50" max="1500" value="350">
      <div id="speedVal" class="small-muted" style="min-width:48px;text-align:center">350</div>
    </div>

    <div class="control right-controls" style="margin-left:auto">
      <button id="generateBtn">Generate</button>
      <button id="startBtn">Start</button>
      <button id="stepBtn" class="secondary">Step</button>
      <button id="resetBtn" class="">Reset</button>
    </div>
  </div>

  <div class="visual">
    <div class="canvas" style="flex:2">
      <div class="top-row">
        <div style="flex:1">
          <div class="legend">Array</div>
          <div id="arrayView" class="array-view" aria-hidden="false"></div>
        </div>

        <div style="width:320px;margin-left:12px;">
          <div class="legend">Status</div>
          <div class="status">
            <div class="chip">Pass: <span id="passIdx">-</span></div>
            <div class="chip">Digit place (base^p): <span id="placeVal">-</span></div>
            <div class="chip">Buckets: <span id="bucketCount">-</span></div>
            <div class="chip">Steps: <span id="stepIdx">0 / 0</span></div>
          </div>
          <div class="note" id="explain">Click "Start" to animate radial passes. Each pass groups numbers into buckets by the current digit, collecting them in stable order.</div>
        </div>
      </div>

      <div style="margin-top:12px">
        <div class="legend">Buckets (0 .. base-1)</div>
        <div id="buckets" class="buckets"></div>
      </div>
    </div>

    <div class="canvas" style="flex:1">
      <div class="legend">Legend</div>
      <div style="margin-top:10px">
        <div class="small-muted">Blue bars = values in array. During a pass, items are moved to buckets (right). After all items are placed, buckets are concatenated in bucket index order to form the array for the next pass.</div>
        <ul style="margin-top:10px;color:#dff3ff">
          <li><strong>Stable:</strong> numbers with equal digit keep their relative order in each pass.</li>
          <li><strong>Complexity:</strong> O(d * (n + b)) where d is digits and b is base. For fixed base, near linear.</li>
        </ul>
      </div>

      <div style="margin-top:12px">
        <div class="legend">Controls</div>
        <div style="margin-top:8px" class="small-muted">You can change array size, max value, base (radix), and animation speed. Generate a new array before starting.</div>
      </div>

    </div>
  </div>

  <div style="display:flex;justify-content:space-between;align-items:center;margin-top:14px">
    <div class="small-muted">This demo implements LSD (least significant digit) Radix Sort for non-negative integers.</div>
    <div class="small-muted">Tip: try base 2 or 16 to see more/fewer passes.</div>
  </div>
</div>

<script>
(function(){
  // UI elements
  const sizeSlider = document.getElementById('size');
  const sizeVal = document.getElementById('sizeVal');
  const maxSlider = document.getElementById('maxVal');
  const maxValLabel = document.getElementById('maxValVal');
  const baseSelect = document.getElementById('base');
  const speedSlider = document.getElementById('speed');
  const speedVal = document.getElementById('speedVal');

  const generateBtn = document.getElementById('generateBtn');
  const startBtn = document.getElementById('startBtn');
  const stepBtn = document.getElementById('stepBtn');
  const resetBtn = document.getElementById('resetBtn');

  const arrayView = document.getElementById('arrayView');
  const bucketsView = document.getElementById('buckets');

  const passIdx = document.getElementById('passIdx');
  const placeVal = document.getElementById('placeVal');
  const bucketCount = document.getElementById('bucketCount');
  const stepIdx = document.getElementById('stepIdx');

  // State
  let array = [];
  let initialArray = [];
  let steps = []; // precomputed steps
  let curStep = 0;
  let playing = false;
  let timer = null;

  // Event bindings
  sizeSlider.addEventListener('input', ()=>{sizeVal.textContent = sizeSlider.value});
  maxSlider.addEventListener('input', ()=>{maxValLabel.textContent = maxSlider.value});
  speedSlider.addEventListener('input', ()=>{speedVal.textContent = speedSlider.value});

  generateBtn.addEventListener('click', ()=>{generateNew();});
  startBtn.addEventListener('click', ()=>{togglePlay();});
  stepBtn.addEventListener('click', ()=>{stepOnce();});
  resetBtn.addEventListener('click', ()=>{resetAll();});

  // init
  sizeVal.textContent = sizeSlider.value;
  maxValLabel.textContent = maxSlider.value;
  speedVal.textContent = speedSlider.value;
  generateNew();

  // Helpers
  function randInt(min,max){
    return Math.floor(Math.random()*(max-min+1))+min;
  }

  function generateNew(){
    stopPlay();
    const n = Number(sizeSlider.value);
    const maxV = Number(maxSlider.value);
    array = Array.from({length:n}, ()=>randInt(0, maxV));
    initialArray = array.slice();
    renderArray(array);
    clearBuckets();
    steps = buildRadixSteps(array, Number(baseSelect.value));
    curStep = 0;
    updateStatus();
  }

  function resetAll(){
    stopPlay();
    array = initialArray.slice();
    renderArray(array);
    clearBuckets();
    steps = buildRadixSteps(array, Number(baseSelect.value));
    curStep = 0;
    updateStatus();
  }

  function togglePlay(){
    if(playing){
      stopPlay();
    } else {
      if(curStep >= steps.length) {
        // if finished, restart from zero automatically
        curStep = 0;
        array = initialArray.slice();
        renderArray(array);
        clearBuckets();
      }
      playing = true;
      startBtn.textContent = 'Pause';
      playLoop();
    }
  }

  function stopPlay(){
    playing = false;
    startBtn.textContent = 'Start';
    if(timer) { clearTimeout(timer); timer = null; }
  }

  function playLoop(){
    if(!playing) return;
    const delay = Number(speedSlider.value);
    timer = setTimeout(()=>{
      const done = performStep();
      if(done) {
        stopPlay();
      } else {
        playLoop();
      }
    }, delay);
  }

  function stepOnce(){
    stopPlay();
    performStep();
  }

  function performStep(){
    if(curStep >= steps.length){
      updateStatus();
      return true;
    }
    const s = steps[curStep];
    renderStep(s);
    curStep++;
    updateStatus();
    if(curStep >= steps.length){
      // finished: mark
      passIdx.textContent = 'done';
      placeVal.textContent = '-';
      bucketCount.textContent = Number(baseSelect.value);
    }
    return curStep >= steps.length;
  }

  function updateStatus(){
    stepIdx.textContent = `${Math.min(curStep, steps.length)} / ${steps.length}`;
  }

  // Build steps for LSD radix sort (non-negative integers)
  // Steps: {type:'place', pass, index, value, digit}
  //        {type:'collect', pass, newArray}
  function buildRadixSteps(arr, base){
    const steps = [];
    if(arr.length === 0) return steps;
    const maxValue = Math.max(...arr);
    const digits = Math.max(1, Math.floor(Math.log(maxValue) / Math.log(base)) + 1);
    let working = arr.slice();
    for(let p=0;p<digits;p++){
      // place each element into bucket by digit
      const buckets = Array.from({length:base}, ()=>[]);
      for(let i=0;i<working.length;i++){
        const v = working[i];
        const digit = Math.floor(v / Math.pow(base, p)) % base;
        steps.push({type:'place', pass:p, index:i, value:v, digit:digit, total:working.length});
        buckets[digit].push(v);
      }
      // collect
      const newArr = [];
      for(let b=0;b<base;b++){
        for(const v of buckets[b]) newArr.push(v);
      }
      steps.push({type:'collect', pass:p, newArray:newArr, buckets:JSON.parse(JSON.stringify(buckets))});
      working = newArr;
    }
    // final 'done' marker
    steps.push({type:'done', final:working});
    return steps;
  }

  // Rendering functions
  function renderArray(arr, highlightIndex=null, dimMask=[]){
    arrayView.innerHTML = '';
    const maxV = Math.max(...arr, 1);
    const useSmall = arr.length > 36;
    for(let i=0;i<arr.length;i++){
      const v = arr[i];
      const bar = document.createElement('div');
      bar.className = 'bar' + (useSmall ? ' small' : '');
      if(dimMask[i]) bar.classList.add('dim');
      if(i === highlightIndex) bar.classList.add('moving');
      const height = Math.max(6, Math.round((v / maxV) * 180));
      bar.style.height = (height+20) + 'px';
      const lbl = document.createElement('div');
      lbl.className = 'label';
      lbl.textContent = v;
      bar.appendChild(lbl);
      arrayView.appendChild(bar);
    }
  }

  function clearBuckets(){
    bucketsView.innerHTML = '';
    const base = Number(baseSelect.value);
    bucketCount.textContent = base;
    for(let b=0;b<base;b++){
      const buck = document.createElement('div');
      buck.className = 'bucket';
      const bid = document.createElement('div');
      bid.className = 'bidx';
      bid.textContent = b;
      const items = document.createElement('div');
      items.className = 'items';
      buck.appendChild(bid);
      buck.appendChild(items);
      bucketsView.appendChild(buck);
    }
  }

  function renderStep(s){
    if(!s) return;
    if(s.type === 'place'){
      // On a place step, show the array with the current moving item highlighted and add to bucket display
      // We'll keep a 'placed' count per bucket for this pass stored in a session place state.
      if(s.pass !== currentRender.pass){
        // new pass starts: reset bucket displays and store pass index
        currentRender.pass = s.pass;
        currentRender.placed = Array.from({length: Number(baseSelect.value)}, ()=>0);
        clearBuckets();
      }
      // Render array with dimmed items that have already been placed (i.e., indices < current index for this pass)
      const dimMask = [];
      for(let i=0;i<s.total;i++){
        dimMask.push(i < s.index);
      }
      renderArray(array, s.index, dimMask);

      // append item to bucket
      const bidx = s.digit;
      const bucketElems = bucketsView.children;
      const it = document.createElement('div');
      it.className = 'item';
      it.textContent = s.value;
      // place item as last child of items container
      const itemsContainer = bucketElems[bidx].querySelector('.items');
      itemsContainer.appendChild(it);
      currentRender.placed[bidx]++;

      passIdx.textContent = (s.pass + 1) + ' / ?';
      placeVal.textContent = Math.pow(Number(baseSelect.value), s.pass) + ' (base^' + s.pass + ')';
      bucketCount.textContent = Number(baseSelect.value);
    } else if(s.type === 'collect'){
      // Show collection: update array to newArray and clear buckets
      array = s.newArray.slice();
      renderArray(array);
      // show buckets content briefly then clear
      // First, show bucket counts (already added during place steps we captured in s.buckets)
      clearBuckets();
      for(let b=0;b<s.buckets.length;b++){
        const itemsContainer = bucketsView.children[b].querySelector('.items');
        for(const v of s.buckets[b]){
          const it = document.createElement('div');
          it.className = 'item';
          it.textContent = v;
          itemsContainer.appendChild(it);
        }
      }
      passIdx.textContent = (s.pass + 1);
      placeVal.textContent = Math.pow(Number(baseSelect.value), s.pass) + ' (base^' + s.pass + ')';
      bucketCount.textContent = Number(baseSelect.value);

      // After a short pause (we manage via animation timing), we'll clear buckets to visually show collection done.
      // But for simplicity we will clear them immediately so next steps can display placements fresh.
      // However, to give feedback, we'll keep them for a short visual moment if playing.
      if(playing){
        // keep buckets visible for next animation frame, then clear
        setTimeout(()=>{ clearBuckets(); }, Math.max(80, Number(speedSlider.value)/6));
      } else {
        // when stepping manually, keep buckets visible until next step
      }
    } else if(s.type === 'done'){
      array = s.final.slice();
      renderArray(array);
      clearBuckets();
      passIdx.textContent = 'done';
      placeVal.textContent = '-';
      bucketCount.textContent = Number(baseSelect.value);
    }
  }

  // small state to track current rendering pass
  const currentRender = {pass:-1, placed:[]};

  // respond to base change by rebuilding steps around current array state
  baseSelect.addEventListener('change', ()=>{
    stopPlay();
    steps = buildRadixSteps(array, Number(baseSelect.value));
    curStep = 0;
    clearBuckets();
    renderArray(array);
    updateStatus();
  });

  // keyboard shortcuts: space play/pause, right arrow step
  window.addEventListener('keydown', (e)=>{
    if(e.code === 'Space'){ e.preventDefault(); togglePlay(); }
    if(e.code === 'ArrowRight'){ e.preventDefault(); stepOnce(); }
  });

  // initial render helpers
  function initRenderOnce(){
    clearBuckets();
    renderArray(array);
  }
  initRenderOnce();

})();
</script>
</body>
</html>