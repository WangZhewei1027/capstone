<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Two Pointers — Interactive Visualizer</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  :root{
    --bg:#0f1724;
    --panel:#0b1220;
    --muted:#9aa6b2;
    --accent:#2bb0ff;
    --good:#20d39f;
    --danger:#ff6b6b;
    --card:#0f1728;
    --glass: rgba(255,255,255,0.03);
  }
  *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
  body{margin:0;background:linear-gradient(180deg,#061022 0%, #07142a 100%); color:#e6eef6; min-height:100vh; padding:24px;}
  .wrap{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:380px 1fr;gap:20px;}
  .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:16px;border:1px solid rgba(255,255,255,0.03);}
  h1{font-size:20px;margin:0 0 8px 0;}
  .muted{color:var(--muted);font-size:13px;}
  label{display:block;font-size:13px;margin:8px 0 6px;color:var(--muted);}
  input[type="text"], select{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:var(--panel);color:inherit;}
  .row{display:flex;gap:8px;margin-top:8px;align-items:center;}
  button{padding:8px 12px;border-radius:8px;border: none;background:var(--accent);color:#042033;cursor:pointer;font-weight:600;}
  button.secondary{background:transparent;color:var(--accent);border:1px solid rgba(255,255,255,0.03);}
  .controls{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;}
  .array-view{padding:12px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);margin-top:12px;display:flex;flex-direction:column;gap:12px;}
  .boxes{display:flex;gap:8px;flex-wrap:wrap;align-items:flex-end;justify-content:flex-start;}
  .box{min-width:40px;height:40px;border-radius:8px;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;font-weight:700;border:1px solid rgba(255,255,255,0.02);position:relative;}
  .pointer{position:absolute;top:-20px;font-size:12px;padding:2px 6px;border-radius:6px;background:var(--accent);color:#021826;transform:translateY(-100%);white-space:nowrap;}
  .pointer.r{background:var(--danger);}
  .box.highlight{background:linear-gradient(90deg,var(--accent), #62e0ff 60%);color:#03232f;}
  .box.sel{outline:3px solid rgba(255,255,255,0.04);}
  .box.removed{opacity:0.35;text-decoration:line-through}
  .log{font-size:13px;color:var(--muted);margin-top:8px;min-height:44px;}
  .bars{display:flex;align-items:flex-end;gap:8px;height:140px;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);}
  .bar{width:28px;background:linear-gradient(180deg,#4ed6ff,#11749e);border-radius:6px;display:flex;align-items:end;justify-content:center;color:#021826;font-weight:700;position:relative;}
  .bar .val{font-size:12px;padding:2px 4px;background:rgba(255,255,255,0.85);border-radius:4px;margin-bottom:6px;color:#07202a;}
  .info{margin-top:10px;display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
  .chip{background:var(--glass);padding:8px 12px;border-radius:999px;color:var(--muted);font-weight:600;border:1px solid rgba(255,255,255,0.02);}
  pre.code{background:#071424;border-radius:8px;padding:12px;color:#d8eef9;max-height:280px;overflow:auto;font-size:13px;margin:0;}
  .code-line{display:block;padding:2px 6px;border-radius:6px;}
  .code-line.current{background:linear-gradient(90deg,rgba(43,176,255,0.12), rgba(43,176,255,0.05));color:var(--accent);font-weight:700;}
  footer{margin-top:16px;color:var(--muted);font-size:13px;}
  .small{font-size:13px;color:var(--muted);}
  .result{margin-top:8px;font-weight:700;color:var(--good);}
  .bad{color:var(--danger);}
  input[type=range]{width:160px;}
  .controls .speed{display:flex;align-items:center;gap:8px;}
  .top-controls{display:flex;gap:8px;align-items:center;}
  .muted-btn{background:transparent;border:1px dashed rgba(255,255,255,0.02);color:var(--muted);padding:8px;border-radius:8px;}
  .link-like{background:transparent;border:none;color:var(--accent);cursor:pointer;font-weight:700;}
  .footer-note{font-size:12px;color:var(--muted);margin-top:8px;}
  @media (max-width:900px){
    .wrap{grid-template-columns:1fr; padding:12px;}
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="panel">
    <h1>Two Pointers — Interactive Visualizer</h1>
    <div class="muted">Explore common two-pointers patterns: scan from both ends, sliding pointers, in-place writes. Choose a demo, give an array, and step through the algorithm.</div>

    <label>Demo</label>
    <select id="demoSelect">
      <option value="twoSum">Two-sum in a sorted array (find pair equals target)</option>
      <option value="maxArea">Container With Most Water (maximize area)</option>
      <option value="removeDup">Remove Duplicates (in-place, sorted)</option>
    </select>

    <label>Array (comma separated numbers)</label>
    <input type="text" id="arrayInput" placeholder="e.g. 1,2,3,4,5" />

    <div class="row">
      <button id="randomBtn" class="secondary">Random</button>
      <button id="sortBtn" class="secondary">Sort Ascending</button>
      <button id="reverseBtn" class="secondary">Reverse</button>
      <div style="flex:1"></div>
    </div>

    <label style="margin-top:10px">Additional</label>
    <div style="display:flex;gap:8px;align-items:center;">
      <input type="number" id="targetInput" placeholder="target (for two-sum)" style="width:140px;padding:8px;border-radius:8px;background:var(--panel);border:1px solid rgba(255,255,255,0.03);color:inherit;">
      <div class="muted small" style="margin-left:6px">Target applies to Two-sum demo</div>
    </div>

    <div class="controls">
      <button id="startBtn">Start</button>
      <button id="pauseBtn" class="secondary">Pause</button>
      <button id="stepBtn" class="secondary">Step</button>
      <button id="resetBtn" class="secondary">Reset</button>

      <div class="speed" title="Animation speed">
        <label class="small muted" style="margin-right:6px;">Speed</label>
        <input type="range" id="speed" min="100" max="1600" step="100" value="700">
        <div class="small muted" id="speedVal">700ms</div>
      </div>
    </div>

    <div class="array-view" id="arrayView">
      <div class="small muted">Visualization</div>
      <div id="visArea">
        <!-- dynamic -->
      </div>
      <div class="log" id="log"></div>
      <div class="info">
        <div class="chip" id="stateChip">State: idle</div>
        <div class="chip">i/j pointers: <span id="ptrChip">-</span></div>
        <div class="chip">Operations: <span id="opsChip">0</span></div>
        <div class="chip">Result: <span id="resChip">-</span></div>
      </div>
    </div>

    <div style="margin-top:12px;">
      <div class="small muted">Code (highlights current step)</div>
      <pre class="code" id="codeBlock"></pre>
    </div>

    <footer class="footer-note">Tip: For Two-sum and Remove Duplicates, the array should be sorted. Use "Sort Ascending" or provide a sorted input.</footer>
  </div>

  <div class="panel">
    <h1 id="demoTitle">Demo Details</h1>
    <div class="muted" id="demoDesc">Select a demo to see an explanation.</div>

    <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:12px 0;">

    <div id="demoExtra">
      <!-- Extra content per demo -->
    </div>

  </div>
</div>

<script>
/*
  Two Pointers Visualizer
  - Three demos: twoSum (sorted), maxArea, removeDuplicates (sorted)
  - Uses generator functions to yield steps
  - UI hooks to step/run/pause/reset
*/

const demoSelect = document.getElementById('demoSelect');
const arrayInput = document.getElementById('arrayInput');
const randomBtn = document.getElementById('randomBtn');
const sortBtn = document.getElementById('sortBtn');
const reverseBtn = document.getElementById('reverseBtn');
const startBtn = document.getElementById('startBtn');
const pauseBtn = document.getElementById('pauseBtn');
const stepBtn = document.getElementById('stepBtn');
const resetBtn = document.getElementById('resetBtn');
const targetInput = document.getElementById('targetInput');
const visArea = document.getElementById('visArea');
const logEl = document.getElementById('log');
const stateChip = document.getElementById('stateChip');
const ptrChip = document.getElementById('ptrChip');
const opsChip = document.getElementById('opsChip');
const resChip = document.getElementById('resChip');
const codeBlock = document.getElementById('codeBlock');
const speedEl = document.getElementById('speed');
const speedVal = document.getElementById('speedVal');
const demoTitle = document.getElementById('demoTitle');
const demoDesc = document.getElementById('demoDesc');
const demoExtra = document.getElementById('demoExtra');

let gen = null;
let running = false;
let intervalId = null;
let currentState = null;
let ops = 0;
let lastArray = [];
let demoInfo = {
  twoSum: {
    title: 'Two-sum in a sorted array',
    desc: 'Use two pointers, one at left and one at right, moving inward. If sum < target move left pointer right; if sum > target move right pointer left; if equal — found.',
    code: [
      'function twoSum(arr, target) {',
      '  let l = 0, r = arr.length - 1;',
      '  while (l < r) {',
      '    let s = arr[l] + arr[r];',
      '    if (s === target) return [l, r];',
      '    if (s < target) l++;',
      '    else r--;',
      '  }',
      '  return null;',
      '}'
    ]
  },
  maxArea: {
    title: 'Container With Most Water (maximize area)',
    desc: 'Interpret array as heights. Two pointers start at both ends. Area = min(h[l], h[r]) * (r - l). Move the pointer at the smaller height inward (hoping for taller wall). Keep track of max area.',
    code: [
      'function maxArea(height) {',
      '  let l = 0, r = height.length - 1;',
      '  let maxA = 0;',
      '  while (l < r) {',
      '    let area = Math.min(height[l], height[r]) * (r - l);',
      '    maxA = Math.max(maxA, area);',
      '    if (height[l] < height[r]) l++;',
      '    else r--;',
      '  }',
      '  return maxA;',
      '}'
    ]
  },
  removeDup: {
    title: 'Remove Duplicates In-place (sorted array)',
    desc: 'Use one pointer (i) to mark position of unique elements and another (j) to scan. When arr[j] != arr[i], advance i and write arr[j] to arr[i]. Finally, new length is i + 1.',
    code: [
      'function removeDuplicates(arr) {',
      '  if (arr.length === 0) return 0;',
      '  let i = 0;',
      '  for (let j = 1; j < arr.length; j++) {',
      '    if (arr[j] !== arr[i]) {',
      '      i++;',
      '      arr[i] = arr[j];',
      '    }',
      '  }',
      '  return i + 1;',
      '}'
    ]
  }
};

function setDemoText() {
  const key = demoSelect.value;
  demoTitle.textContent = demoInfo[key].title;
  demoDesc.textContent = demoInfo[key].desc;
  demoExtra.innerHTML = '';
  if (key === 'twoSum') {
    demoExtra.innerHTML = '<div class="small muted">Example: arr = [1,2,3,4,6], target = 7 → pair (1,4) or values 1-based: (2,5)</div>';
  } else if (key === 'maxArea') {
    demoExtra.innerHTML = '<div class="small muted">Example: heights = [1,8,6,2,5,4,8,3,7] → max area 49 (indices 1 and 8 in 0-based example)</div>';
  } else if (key === 'removeDup') {
    demoExtra.innerHTML = '<div class="small muted">Example: arr = [0,0,1,1,1,2,2,3,3,4] → after operation arr[0..newLen-1] holds unique values [0,1,2,3,4]</div>';
  }
  renderCode([], -1);
}
setDemoText();
demoSelect.addEventListener('change', ()=>{
  setDemoText();
});

function parseArrayInput() {
  const raw = arrayInput.value.trim();
  if (!raw) return [];
  const parts = raw.split(',').map(s => s.trim()).filter(s=>s.length);
  const nums = parts.map(s => {
    const n = Number(s);
    return isNaN(n) ? 0 : n;
  });
  return nums;
}

function setArrayField(arr) {
  arrayInput.value = arr.join(',');
}

randomBtn.addEventListener('click', ()=>{
  const key = demoSelect.value;
  let arr = [];
  if (key === 'maxArea') {
    const n = 8 + Math.floor(Math.random()*3);
    for (let i=0;i<n;i++) arr.push(1 + Math.floor(Math.random()*9));
  } else {
    const n = 6 + Math.floor(Math.random()*5);
    for (let i=0;i<n;i++) arr.push(Math.floor(Math.random()*10));
  }
  setArrayField(arr);
});

sortBtn.addEventListener('click', ()=>{
  const arr = parseArrayInput();
  arr.sort((a,b)=>a-b);
  setArrayField(arr);
});

reverseBtn.addEventListener('click', ()=>{
  const arr = parseArrayInput();
  arr.reverse();
  setArrayField(arr);
});

speedEl.addEventListener('input', ()=>{
  speedVal.textContent = speedEl.value + 'ms';
  if (running) {
    clearInterval(intervalId);
    intervalId = setInterval(stepOnce, Number(speedEl.value));
  }
});

startBtn.addEventListener('click', startRun);
pauseBtn.addEventListener('click', pauseRun);
stepBtn.addEventListener('click', stepOnce);
resetBtn.addEventListener('click', resetRun);

function resetRun(){
  running = false;
  clearInterval(intervalId);
  gen = null;
  currentState = null;
  ops = 0;
  opsChip.textContent = '0';
  resChip.textContent = '-';
  logEl.textContent = '';
  stateChip.textContent = 'idle';
  ptrChip.textContent = '-';
  setDemoText();
  renderInitialVisualization();
}

function startRun(){
  if (!gen) {
    initializeGenerator();
  }
  if (!gen) return;
  if (!running) {
    running = true;
    stateChip.textContent = 'running';
    intervalId = setInterval(stepOnce, Number(speedEl.value));
  }
}

function pauseRun(){
  running = false;
  clearInterval(intervalId);
  stateChip.textContent = 'paused';
}

function stepOnce(){
  if (!gen) {
    initializeGenerator();
    if (!gen) return;
  }
  const next = gen.next();
  if (next.done) {
    running = false;
    clearInterval(intervalId);
    stateChip.textContent = 'finished';
    if (next.value && next.value.finalMessage) {
      logEl.textContent = next.value.finalMessage;
      resChip.textContent = next.value.result !== undefined ? next.value.result : '-';
    }
    renderFromState(next.value && next.value.state ? next.value.state : currentState);
    gen = null;
    return;
  }
  currentState = next.value;
  ops++;
  opsChip.textContent = ops;
  renderFromState(currentState);
}

function renderCode(lines, idx){
  codeBlock.innerHTML = lines.map((l,i)=>{
    const safe = l.replace(/</g,'&lt;').replace(/>/g,'&gt;');
    if (i === idx) return `<span class="code-line current">${safe}</span>`;
    return `<span class="code-line">${safe}</span>`;
  }).join('');
}

function renderInitialVisualization(){
  const arr = parseArrayInput();
  lastArray = arr.slice();
  if (demoSelect.value === 'maxArea') {
    renderBars(arr, -1, -1, null);
  } else {
    renderBoxes(arr, -1, -1, null);
  }
}

function renderFromState(state){
  const arr = state.arr.slice();
  lastArray = arr;
  if (demoSelect.value === 'maxArea') {
    renderBars(arr, state.l, state.r, state);
  } else {
    renderBoxes(arr, state.l, state.r, state);
  }
  logEl.textContent = state.message || '';
  ptrChip.textContent = (state.l!==undefined?('l='+state.l):'') + (state.r!==undefined?(' r='+state.r):'') + (state.i!==undefined?(' i='+state.i):'') + (state.j!==undefined?(' j='+state.j):'');
  resChip.textContent = state.result !== undefined ? state.result : resChip.textContent;
  renderCode(state.codeLines || [], state.codeIndex !== undefined ? state.codeIndex : -1);
}

function renderBoxes(arr, l, r, state){
  visArea.innerHTML = '';
  const boxes = document.createElement('div');
  boxes.className = 'boxes';
  arr.forEach((v, idx) => {
    const b = document.createElement('div');
    b.className = 'box';
    b.textContent = v;
    if (state && state.writtenIndex === idx) {
      b.classList.add('highlight');
    }
    if (state && state.removedIndices && state.removedIndices.includes(idx)) {
      b.classList.add('removed');
    }
    if (idx === l) {
      const p = document.createElement('div'); p.className='pointer'; p.textContent='L';
      b.appendChild(p);
      b.style.boxShadow = '0 0 0 2px rgba(43,176,255,0.06)';
    }
    if (idx === r) {
      const p = document.createElement('div'); p.className='pointer r'; p.textContent='R';
      b.appendChild(p);
      b.style.boxShadow = '0 0 0 2px rgba(255,107,107,0.06)';
    }
    boxes.appendChild(b);
  });
  visArea.appendChild(boxes);
}

function renderBars(arr, l, r, state){
  visArea.innerHTML = '';
  const barsWrap = document.createElement('div');
  barsWrap.className = 'bars';
  const maxH = Math.max(1, ...arr);
  arr.forEach((v, idx) => {
    const bar = document.createElement('div');
    bar.className = 'bar';
    bar.style.height = (v / maxH * 120 + 20) + 'px';
    const val = document.createElement('div');
    val.className='val';
    val.textContent = v;
    bar.appendChild(val);
    if (idx === l) {
      const p = document.createElement('div'); p.className='pointer'; p.textContent='L';
      bar.appendChild(p);
    }
    if (idx === r) {
      const p = document.createElement('div'); p.className='pointer r'; p.textContent='R';
      bar.appendChild(p);
    }
    if (state && state.bestPair && state.bestPair[0] === idx || (state && state.bestPair && state.bestPair[1] === idx)) {
      bar.style.outline = '3px solid rgba(32,211,159,0.12)';
      bar.style.background = 'linear-gradient(180deg,#88ffcf,#0bbd86)';
    }
    barsWrap.appendChild(bar);
  });
  // show area info
  const infoLine = document.createElement('div');
  infoLine.style.marginTop='8px';
  infoLine.innerHTML = `<div class="small muted">Current area: <strong>${state && state.currentArea !== undefined ? state.currentArea : '-'}</strong> &nbsp;&nbsp; Best area: <strong style="color:var(--good)">${state && state.bestArea!==undefined ? state.bestArea : '-'}</strong></div>`;
  visArea.appendChild(barsWrap);
  visArea.appendChild(infoLine);
}

function initializeGenerator(){
  const arr = parseArrayInput();
  if (!arr.length) {
    alert('Please provide an array (comma separated numbers).');
    return;
  }
  ops = 0;
  opsChip.textContent = '0';
  resChip.textContent = '-';
  logEl.textContent = '';
  const key = demoSelect.value;
  if (key === 'twoSum') {
    const t = Number(targetInput.value);
    if (isNaN(t)) {
      alert('Enter a numeric target for two-sum.');
      return;
    }
    gen = twoSumGenerator(arr.slice(), t);
  } else if (key === 'maxArea') {
    gen = maxAreaGenerator(arr.slice());
  } else if (key === 'removeDup') {
    gen = removeDuplicatesGenerator(arr.slice());
  }
  stateChip.textContent = 'initialized';
}

// ---------------------- Generators ----------------------------

function* twoSumGenerator(arr, target) {
  const codeLines = demoInfo.twoSum.code;
  let l = 0, r = arr.length - 1;
  let step = 0;
  while (l < r) {
    const s = arr[l] + arr[r];
    yield {
      arr: arr.slice(),
      l, r,
      message: `Compare arr[${l}]=${arr[l]} + arr[${r}]=${arr[r]} → sum=${s}`,
      codeLines, codeIndex:2,
      currentStep: step++
    };
    if (s === target) {
      yield {
        arr: arr.slice(),
        l, r,
        message: `Found pair at indices (${l}, ${r}) with values (${arr[l]}, ${arr[r]})`,
        result: `[${l}, ${r}]`,
        codeLines, codeIndex:3,
        finalMessage: `Found pair: indices (${l}, ${r}) values (${arr[l]}, ${arr[r]})`,
        state: {arr:arr.slice(), l, r}
      };
      return {finalMessage:`Found pair: indices (${l}, ${r}) values (${arr[l]}, ${arr[r]})`, result:[l,r], state:{arr:arr.slice(), l, r}};
    }
    if (s < target) {
      yield {
        arr: arr.slice(),
        l, r,
        message: `Sum ${s} < target ${target} → move L right`,
        codeLines, codeIndex:4,
      };
      l++;
    } else {
      yield {
        arr: arr.slice(),
        l, r,
        message: `Sum ${s} > target ${target} → move R left`,
        codeLines, codeIndex:5,
      };
      r--;
    }
  }
  yield {
    arr: arr.slice(),
    l, r,
    message: 'No pair found.',
    codeLines, codeIndex:7,
    finalMessage: 'No pair found.',
    result: null,
    state: {arr:arr.slice(), l, r}
  };
  return {finalMessage:'No pair found.', result:null, state:{arr:arr.slice(), l, r}};
}

function* maxAreaGenerator(arr) {
  const codeLines = demoInfo.maxArea.code;
  let l = 0, r = arr.length - 1;
  let maxA = 0;
  let bestPair = null;
  let step = 0;
  while (l < r) {
    const area = Math.min(arr[l], arr[r]) * (r - l);
    if (area > maxA) {
      maxA = area;
      bestPair = [l, r];
      yield {
        arr: arr.slice(),
        l, r,
        currentArea: area,
        bestArea: maxA,
        bestPair,
        message: `New best area ${area} (l=${l}, r=${r})`,
        codeLines, codeIndex:4
      };
    } else {
      yield {
        arr: arr.slice(),
        l, r,
        currentArea: area,
        bestArea: maxA,
        bestPair,
        message: `Area ${area} (l=${l}, r=${r}), best so far ${maxA}`,
        codeLines, codeIndex:4
      };
    }
    if (arr[l] < arr[r]) {
      yield {
        arr: arr.slice(),
        l, r,
        message: `height[l]=${arr[l]} < height[r]=${arr[r]} → move L right`,
        codeLines, codeIndex:5
      };
      l++;
    } else {
      yield {
        arr: arr.slice(),
        l, r,
        message: `height[l]=${arr[l]} >= height[r]=${arr[r]} → move R left`,
        codeLines, codeIndex:6
      };
      r--;
    }
    step++;
  }
  yield {
    arr: arr.slice(),
    l, r,
    message: `Finished. Max area = ${maxA} at indices ${bestPair?bestPair.join(', '):'-'}`,
    bestArea: maxA,
    bestPair,
    currentArea: 0,
    codeLines, codeIndex:8,
    finalMessage: `Max area = ${maxA}`,
    result: maxA,
    state: {arr:arr.slice(), l, r, bestArea: maxA, bestPair}
  };
  return {finalMessage: `Max area = ${maxA}`, result: maxA, state: {arr:arr.slice(), l, r, bestArea: maxA, bestPair}};
}

function* removeDuplicatesGenerator(arr) {
  const codeLines = demoInfo.removeDup.code;
  if (arr.length === 0) {
    yield {arr:arr.slice(), message:'Empty array', codeLines, codeIndex:0, finalMessage:'Length 0', result:0, state:{arr:arr.slice()}};
    return {finalMessage:'Length 0', result:0, state:{arr:arr.slice()}};
  }
  let i = 0;
  // mark all as not removed initially
  let removedIndices = [];
  yield {arr:arr.slice(), i, j: null, message:`Start. i=${i}`, codeLines, codeIndex:1};
  for (let j = 1; j < arr.length; j++) {
    yield {arr:arr.slice(), i, j, message:`Compare arr[${j}]=${arr[j]} with arr[${i}]=${arr[i]}`, codeLines, codeIndex:3};
    if (arr[j] !== arr[i]) {
      i++;
      arr[i] = arr[j]; // write
      yield {
        arr:arr.slice(),
        i, j,
        writtenIndex: i,
        message:`arr[${j}] != arr[${i-1}] → write arr[${j}] to arr[${i}]`,
        codeLines,
        codeIndex:5
      };
    } else {
      // arr[j] is duplicate — considered removed (for visualization)
      removedIndices.push(j);
      yield {
        arr:arr.slice(),
        i, j,
        removedIndices: removedIndices.slice(),
        message:`arr[${j}] == arr[${i}] → duplicate at ${j} (will be ignored)`,
        codeLines,
        codeIndex:4
      };
    }
  }
  const newLen = i + 1;
  yield {
    arr:arr.slice(),
    i, j: arr.length,
    message:`Finished. New length = ${newLen}. Unique portion: arr[0..${i}]`,
    removedIndices: removedIndices.slice(),
    codeLines, codeIndex:8,
    finalMessage:`Finished. New length = ${newLen}`,
    result: newLen,
    state: {arr:arr.slice(), i, removedIndices}
  };
  return {finalMessage:`Finished. New length = ${newLen}`, result:newLen, state:{arr:arr.slice(), i, removedIndices}};
}

// Initialize with a small default
if (!arrayInput.value) {
  arrayInput.value = '1,2,3,4,5,6';
}
renderInitialVisualization();

// on load, populate code block
renderCode([], -1);

</script>
</body>
</html>