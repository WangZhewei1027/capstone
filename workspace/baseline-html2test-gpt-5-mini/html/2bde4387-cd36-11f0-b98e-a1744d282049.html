<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Quick Sort Visualizer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root{
      --bg:#0f1724;
      --panel:#0b1220;
      --accent:#3b82f6;
      --muted:#94a3b8;
      --bar:#60a5fa;
      --pivot:#ef4444;
      --compare:#f59e0b;
      --swap:#fb923c;
      --sorted:#10b981;
      --range:#1e293b;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#06111d 0%, #071328 100%);color:#e6eef6}
    .app{
      max-width:1100px;margin:28px auto;padding:20px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;box-shadow:0 6px 30px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03);
    }
    .header{display:flex;align-items:center;gap:16px;margin-bottom:12px}
    h1{font-size:20px;margin:0}
    .controls{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    button{background:var(--accent);color:white;border:0;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);padding:6px 10px}
    button:disabled{opacity:0.45;cursor:not-allowed}
    .panel{padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border-radius:10px;margin-top:12px}
    .top-controls{display:flex;gap:14px;align-items:center;flex-wrap:wrap}
    .control-row{display:flex;gap:10px;align-items:center}
    label{font-size:13px;color:var(--muted)}
    input[type="range"]{cursor:pointer}
    .visual{
      height:360px;margin-top:14px;border-radius:8px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.06));
      display:flex;align-items:flex-end;gap:6px;overflow:hidden;border:1px solid rgba(255,255,255,0.03)
    }
    .bar{
      background:var(--bar);flex:1 1 auto;border-radius:6px 6px 2px 2px;display:flex;align-items:flex-end;justify-content:center;color:#03263f;font-weight:700;font-size:11px;
      transition:height 150ms ease, background-color 120ms;
      min-width:6px;
    }
    .bar.pivot{background:linear-gradient(180deg,var(--pivot),#f87171);color:white}
    .bar.compare{background:linear-gradient(180deg,var(--compare),#facc15);color:#111827}
    .bar.swap{background:linear-gradient(180deg,var(--swap),#fb923c);color:#111827}
    .bar.sorted{background:linear-gradient(180deg,var(--sorted),#34d399);color:#012509}
    .bar.range{outline:2px solid rgba(96,165,250,0.12);box-shadow:0 6px 18px rgba(59,130,246,0.06)}
    .status{display:flex;gap:12px;align-items:center;margin-top:10px;flex-wrap:wrap}
    .badge{background:rgba(255,255,255,0.03);padding:6px 10px;border-radius:8px;font-size:13px;color:var(--muted)}
    .code{margin-top:12px;padding:12px;background:#031325;border-radius:8px;font-family:monospace;color:#cbd5e1;font-size:13px;white-space:pre-wrap}
    .stack{margin-left:8px;font-size:13px;color:var(--muted)}
    .legend{display:flex;gap:8px;align-items:center;margin-top:8px;flex-wrap:wrap}
    .legend span{display:inline-flex;gap:6px;align-items:center;background:rgba(255,255,255,0.02);padding:6px 8px;border-radius:8px;font-size:13px;color:var(--muted)}
    .keycolor{width:14px;height:14px;border-radius:3px;display:inline-block}
    .footer{margin-top:10px;font-size:13px;color:var(--muted)}
    @media (max-width:700px){
      .visual{height:260px}
      .bar{font-size:10px}
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <h1>Quick Sort Visualizer</h1>
      <div style="color:var(--muted);font-size:13px">Visual demonstration of Lomuto quick sort (last-element pivot). Toggle random pivot to use a random pivot.</div>
    </div>

    <div class="panel">
      <div class="top-controls">
        <div class="control-row">
          <label for="size">Array size</label>
          <input id="size" type="range" min="6" max="80" value="32">
        </div>

        <div class="control-row">
          <label for="speed">Speed</label>
          <input id="speed" type="range" min="10" max="1000" value="180">
        </div>

        <div class="control-row">
          <label style="display:flex;gap:8px;align-items:center">
            <input id="randomPivot" type="checkbox"> Use random pivot
          </label>
        </div>

        <div style="margin-left:auto;display:flex;gap:8px">
          <button id="randomize">Randomize</button>
          <button id="start">Start</button>
          <button id="pause" class="secondary" disabled>Pause</button>
          <button id="step" class="secondary">Step</button>
        </div>
      </div>

      <div class="visual" id="visual" aria-hidden="false"></div>

      <div class="status">
        <div class="badge" id="actionState">Idle</div>
        <div class="badge">Actions: <span id="actionCount">0</span></div>
        <div class="badge">Progress: <span id="progress">0/0</span></div>
        <div class="badge">Recursive stack:
          <span class="stack" id="stackDisplay">[]</span>
        </div>
      </div>

      <div class="legend">
        <span><i class="keycolor" style="background:var(--pivot)"></i> pivot</span>
        <span><i class="keycolor" style="background:var(--compare)"></i> comparing</span>
        <span><i class="keycolor" style="background:var(--swap)"></i> swapping</span>
        <span><i class="keycolor" style="background:var(--sorted)"></i> placed/final</span>
        <span><i class="keycolor" style="background:var(--range)"></i> current partition</span>
      </div>

      <div class="code" id="pseudocode">
Quick Sort (Lomuto partition)
function quickSort(a, low, high):
  if low < high:
    pivot = a[high]
    p = partition(a, low, high)
    quickSort(a, low, p - 1)
    quickSort(a, p + 1, high)

function partition(a, low, high):
  pivot = a[high]
  i = low - 1
  for j = low to high-1:
    if a[j] <= pivot:
      i = i + 1
      swap a[i], a[j]
  swap a[i+1], a[high]
  return i+1
      </div>
    </div>

    <div class="footer">Tip: Use "Step" to move one action at a time. "Pause" toggles playback. Adjust speed for faster/slower animation.</div>
  </div>

  <script>
    (function(){
      // Elements
      const visual = document.getElementById('visual');
      const sizeInput = document.getElementById('size');
      const speedInput = document.getElementById('speed');
      const randomizeBtn = document.getElementById('randomize');
      const startBtn = document.getElementById('start');
      const pauseBtn = document.getElementById('pause');
      const stepBtn = document.getElementById('step');
      const actionState = document.getElementById('actionState');
      const actionCount = document.getElementById('actionCount');
      const progressEl = document.getElementById('progress');
      const stackDisplay = document.getElementById('stackDisplay');
      const randomPivotCheckbox = document.getElementById('randomPivot');

      // State
      let array = [];
      let bars = [];
      let actions = []; // sequence of actions generated by algorithm
      let playing = false;
      let paused = false;
      let currentAction = 0;
      let timer = null;
      let stepRequested = false;

      function createArray(n){
        const arr = [];
        for(let i=0;i<n;i++){
          arr.push(Math.floor(Math.random()*90)+10); // 10..99
        }
        return arr;
      }

      function renderArray(a){
        visual.innerHTML = '';
        bars = [];
        const max = Math.max(...a);
        a.forEach((v, idx) => {
          const bar = document.createElement('div');
          bar.className = 'bar';
          bar.style.height = ((v/max)*100) + '%';
          bar.textContent = v;
          bar.dataset.index = idx;
          bar.dataset.value = v;
          visual.appendChild(bar);
          bars.push(bar);
        });
      }

      function setBarClass(i, cls){
        if(i == null || !bars[i]) return;
        bars[i].className = 'bar ' + cls;
      }

      function clearBarClasses(i){
        if(i == null || !bars[i]) return;
        bars[i].className = 'bar';
      }

      function swapBars(i,j){
        if(i==j) return;
        // swap displayed heights and labels and dataset.value
        const bi = bars[i], bj = bars[j];
        const hi = bi.style.height, hj = bj.style.height;
        const ti = bi.textContent, tj = bj.textContent;
        bi.style.height = hj; bi.textContent = tj; bi.dataset.value = bj.dataset.value;
        bj.style.height = hi; bj.textContent = ti; bj.dataset.value = bi.dataset.value;
      }

      // Action types:
      // {type:'range', low, high} -> highlight current partition range
      // {type:'pivot', index}
      // {type:'compare', i, j}
      // {type:'swap', i, j}
      // {type:'markSorted', index}
      // {type:'clear'} clear highlights
      // {type:'stack', stackArray} show recursion stack
      // {type:'done'}
      function generateActionsFromQuickSort(origArr, useRandomPivot){
        const a = origArr.slice();
        const acts = [];
        const stack = [];

        function push(action){
          acts.push(action);
        }

        function pushStack(){
          push({type:'stack', stack:stack.slice()});
        }

        function partition(low, high){
          // Lomuto, optionally random pivot (swap random with high)
          if(useRandomPivot){
            const r = Math.floor(Math.random()*(high - low + 1)) + low;
            if(r !== high){
              push({type:'range', low, high});
              push({type:'compare', i:r, j:high});
              push({type:'swap', i:r, j:high});
              const tmp = a[r]; a[r]=a[high]; a[high]=tmp;
              push({type:'clear'});
            }
          }
          push({type:'range', low, high});
          const pivotVal = a[high];
          push({type:'pivot', index:high});
          let i = low - 1;
          for(let j=low;j<=high-1;j++){
            push({type:'compare', i:j, j:high});
            if(a[j] <= pivotVal){
              i++;
              if(i !== j){
                push({type:'swap', i:i, j:j});
                const tmp = a[i]; a[i]=a[j]; a[j]=tmp;
              } else {
                // even if same index, still show an informative action to highlight
                push({type:'compare', i:i, j:j});
              }
            }
          }
          push({type:'swap', i:i+1, j:high});
          const tmp = a[i+1]; a[i+1]=a[high]; a[high]=tmp;
          push({type:'markSorted', index:i+1});
          push({type:'clear'});
          return i+1;
        }

        function quick(low, high){
          if(low < high){
            stack.push([low,high]); pushStack();
            const p = partition(low, high);
            // mark pivot placed (already did markSorted)
            // remove top of stack as we've handled this node before recursing
            stack.pop(); pushStack();
            quick(low, p-1);
            quick(p+1, high);
          } else {
            // if single element, it's in final position
            if(low === high){
              push({type:'markSorted', index:low});
            }
          }
        }

        push({type:'clear'});
        quick(0, a.length - 1);
        push({type:'done'});
        return acts;
      }

      function resetUI(){
        actionState.textContent = 'Idle';
        actionCount.textContent = actions.length;
        progressEl.textContent = `${currentAction}/${actions.length}`;
        stackDisplay.textContent = '[]';
      }

      function applyAction(act){
        switch(act.type){
          case 'range':
            // highlight range
            for(let i=0;i<bars.length;i++){
              if(i>=act.low && i<=act.high) bars[i].classList.add('range');
              else bars[i].classList.remove('range');
            }
            actionState.textContent = `Processing range [${act.low}, ${act.high}]`;
            break;
          case 'pivot':
            // mark pivot
            for(let i=0;i<bars.length;i++){
              bars[i].classList.remove('pivot');
            }
            if(bars[act.index]) bars[act.index].classList.add('pivot');
            actionState.textContent = `Pivot at index ${act.index}`;
            break;
          case 'compare':
            // brief compare highlight
            for(let i=0;i<bars.length;i++){
              bars[i].classList.remove('compare');
            }
            if(bars[act.i]) bars[act.i].classList.add('compare');
            if(bars[act.j]) bars[act.j].classList.add('compare');
            actionState.textContent = `Comparing index ${act.i} with ${act.j}`;
            break;
          case 'swap':
            // animate swap visually by swapping heights and labels
            if(bars[act.i] && bars[act.j]){
              bars[act.i].classList.add('swap');
              bars[act.j].classList.add('swap');
              // delay visually handled by the main player
              swapBars(act.i, act.j);
            }
            actionState.textContent = `Swapped ${act.i} â†” ${act.j}`;
            break;
          case 'markSorted':
            if(bars[act.index]){
              bars[act.index].className = 'bar sorted';
            }
            actionState.textContent = `Placed element at index ${act.index}`;
            break;
          case 'clear':
            // clear range/pivot/compare/swap classes except 'sorted'
            for(let i=0;i<bars.length;i++){
              if(!bars[i].classList.contains('sorted')){
                bars[i].className = 'bar';
              } else {
                // keep sorted class only
                bars[i].className = 'bar sorted';
              }
            }
            actionState.textContent = '...';
            break;
          case 'stack':
            stackDisplay.textContent = JSON.stringify(act.stack);
            break;
          case 'done':
            actionState.textContent = 'Done';
            // mark everything sorted
            for(let i=0;i<bars.length;i++){
              bars[i].className = 'bar sorted';
            }
            break;
        }
      }

      function sleep(ms){
        return new Promise(resolve => setTimeout(resolve, ms));
      }

      async function play(){
        playing = true;
        paused = false;
        pauseBtn.disabled = false;
        startBtn.disabled = true;
        randomizeBtn.disabled = true;
        sizeInput.disabled = true;
        speedInput.disabled = true;
        stepBtn.disabled = true;
        randomPivotCheckbox.disabled = true;

        const total = actions.length;
        actionCount.textContent = total;
        while(currentAction < actions.length && playing){
          if(paused){
            await sleep(50);
            continue;
          }
          const act = actions[currentAction];
          applyAction(act);
          currentAction++;
          progressEl.textContent = `${currentAction}/${total}`;
          // when stepping, pause after one action
          if(stepRequested){
            stepRequested = false;
            paused = true;
            pauseBtn.textContent = 'Resume';
            break;
          }
          // control timing: speed inverted: higher speed -> smaller delay
          const speedVal = Number(speedInput.value); // 10..1000
          const delay = Math.max(6, speedVal); // in ms between actions
          // Give extra time for swap visuals to be noticeable
          if(act.type === 'swap') {
            await sleep(Math.max(30, delay+40));
          } else {
            await sleep(Math.max(10, delay));
          }
        }

        if(currentAction >= actions.length){
          playing = false;
          paused = false;
          pauseBtn.disabled = true;
          startBtn.disabled = false;
          randomizeBtn.disabled = false;
          sizeInput.disabled = false;
          speedInput.disabled = false;
          stepBtn.disabled = false;
          randomPivotCheckbox.disabled = false;
          pauseBtn.textContent = 'Pause';
        }
      }

      // Controls
      sizeInput.addEventListener('input', () => {
        const n = Number(sizeInput.value);
        array = createArray(n);
        renderArray(array);
        actions = [];
        currentAction = 0;
        resetUI();
      });

      randomizeBtn.addEventListener('click', () => {
        const n = Number(sizeInput.value);
        array = createArray(n);
        renderArray(array);
        actions = [];
        currentAction = 0;
        resetUI();
      });

      startBtn.addEventListener('click', () => {
        if(playing && !paused){
          // already playing
          return;
        }
        // If not started or finished, generate actions
        if(actions.length === 0 || currentAction >= actions.length){
          // build actions
          actions = generateActionsFromQuickSort(array, randomPivotCheckbox.checked);
          currentAction = 0;
        }
        paused = false;
        pauseBtn.textContent = 'Pause';
        play();
      });

      pauseBtn.addEventListener('click', () => {
        if(!playing) return;
        paused = !paused;
        pauseBtn.textContent = paused ? 'Resume' : 'Pause';
      });

      stepBtn.addEventListener('click', ()=>{
        // If not generated yet, create actions
        if(actions.length === 0 || currentAction >= actions.length){
          actions = generateActionsFromQuickSort(array, randomPivotCheckbox.checked);
          currentAction = 0;
        }
        // If not playing, set playing and pause after one action
        if(!playing){
          // ensure UI locked for single step
          playing = true;
          pauseBtn.disabled = true;
          startBtn.disabled = true;
          randomizeBtn.disabled = true;
          sizeInput.disabled = true;
          speedInput.disabled = true;
          randomPivotCheckbox.disabled = true;
        }
        stepRequested = true;
        paused = false;
        play().then(()=>{
          // After stepping, re-enable certain controls if finished
          if(!playing){
            pauseBtn.disabled = true;
            startBtn.disabled = false;
            randomizeBtn.disabled = false;
            sizeInput.disabled = false;
            speedInput.disabled = false;
            randomPivotCheckbox.disabled = false;
            pauseBtn.textContent = 'Pause';
          } else {
            // keep controls locked while stepping in the middle
            pauseBtn.disabled = false;
          }
          // Pause after one action
          paused = true;
          playing = true;
          pauseBtn.textContent = 'Resume';
        });
      });

      // initial setup
      array = createArray(Number(sizeInput.value));
      renderArray(array);
      resetUI();

      // expose for debugging (optional)
      window._qs = {
        gen: generateActionsFromQuickSort,
        array,
        actions
      };

    })();
  </script>
</body>
</html>