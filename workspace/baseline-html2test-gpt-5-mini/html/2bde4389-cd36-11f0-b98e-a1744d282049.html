<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Counting Sort Visualizer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#0f1724; --panel:#0b1220; --muted:#98a0b3; --accent:#60a5fa; --accent2:#34d399;
      --card:#0b1220; --glass:rgba(255,255,255,0.03);
    }
    html,body{height:100%; margin:0; font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial; background:linear-gradient(180deg,#071024 0%, #071829 60%); color:#e6eef8;}
    .app{max-width:1200px; margin:18px auto; padding:18px;}
    header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
    h1{font-size:18px;margin:0}
    .controls{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:10px; padding:12px; box-shadow: 0 6px 18px rgba(2,6,23,0.6); border:1px solid rgba(255,255,255,0.03)}
    .left{display:flex;gap:12px;flex-direction:column;min-width:320px}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    input[type="text"], input[type="number"], select{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:6px;color:var(--muted);width:100%}
    button{background:linear-gradient(180deg,var(--accent),#2b6fc1);border:none;color:white;padding:8px 12px;border-radius:8px;cursor:pointer}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .row{display:flex;gap:8px;align-items:center}
    .viz{display:flex;gap:12px}
    .panel{flex:1; min-height:360px; padding:12px; display:flex;flex-direction:column; gap:12px}
    .bars{display:flex;align-items:end;gap:6px;height:140px;padding:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); border-radius:8px}
    .bar{width:26px;background:linear-gradient(180deg,#60a5fa,#2563eb);border-radius:4px;display:flex;align-items:flex-end;justify-content:center;color:#071024;font-weight:600}
    .bar.small{width:40px;background:linear-gradient(180deg,#34d399,#059669);color:#042018}
    .counts{display:flex;gap:6px;align-items:end;height:100px;padding:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); border-radius:8px}
    .label{font-size:12px;color:var(--muted)}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .code{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:12px;border-radius:8px;font-family:monospace;font-size:13px;color:#cfe8ff; max-height:340px; overflow:auto}
    .code .line{padding:2px 6px;border-radius:4px}
    .code .hl{background:linear-gradient(90deg, rgba(96,165,250,0.14), rgba(52,211,153,0.06)); color:white}
    .log{background:#061229;padding:8px;border-radius:8px;color:var(--muted);font-size:13px; max-height:220px; overflow:auto}
    .controls-bottom{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .small{font-size:12px;color:var(--muted)}
    .status{font-size:13px;color:var(--accent2);font-weight:600}
    footer{margin-top:12px;font-size:12px;color:var(--muted)}
    @media (max-width:920px){
      .viz{flex-direction:column}
      .left{min-width:unset}
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Counting Sort — Interactive Visualizer</h1>
      <div class="small" style="margin-left:8px">Non-negative integers only • Stable variant shown</div>
    </header>

    <div class="controls">
      <div class="card left">
        <label>Array (comma or space separated integers)</label>
        <input id="inputArray" type="text" placeholder="e.g. 4,3,2,6,1,3,2" value="4,3,2,6,1,3,2">
        <div class="row">
          <div style="flex:1">
            <label>Random: size</label>
            <input id="randSize" type="number" min="1" max="40" value="10">
          </div>
          <div style="width:120px">
            <label>Max value (k)</label>
            <input id="randMax" type="number" min="0" max="100" value="9">
          </div>
          <div style="width:100px;display:flex;align-items:flex-end">
            <button id="btnRandom" class="secondary">Generate</button>
          </div>
        </div>

        <div class="row">
          <div style="flex:1">
            <label>Mode</label>
            <select id="mode">
              <option value="stable-asc">Stable (ascending) — classic counting sort</option>
              <option value="desc-nonstable">Descending (non-stable) — fill by value</option>
            </select>
          </div>
          <div style="width:160px">
            <label>Delay (ms) autoplay</label>
            <input id="speed" type="range" min="50" max="1500" value="300">
            <div class="small" id="speedLabel">300 ms</div>
          </div>
        </div>

        <div class="controls-bottom">
          <button id="btnStart">Start</button>
          <button id="btnStep" class="secondary">Step</button>
          <button id="btnPause" class="secondary">Pause</button>
          <button id="btnReset" class="secondary">Reset</button>
          <div style="flex:1"></div>
          <div class="small">Status: <span id="status" class="status">Idle</span></div>
        </div>
      </div>

      <div class="card" style="flex:1">
        <div class="viz">
          <div class="panel" style="flex:1">
            <div class="label">Input array (original)</div>
            <div id="inputBars" class="bars"></div>
            <div class="label">Counts array (index = value)</div>
            <div id="countsBars" class="counts"></div>
            <div class="label">Output array (building)</div>
            <div id="outputBars" class="bars"></div>
          </div>

          <div style="width:420px;display:flex;flex-direction:column;gap:12px">
            <div class="code card" id="codeBlock" aria-hidden="false">
              <!-- pseudo-code will be injected -->
            </div>
            <div class="log card" id="log"></div>
          </div>
        </div>
      </div>
    </div>

    <footer class="small card">
      How it works: Counting sort counts how many items have each key (value), computes starting positions using prefix sums, and places items into the output according to those positions. The stable variant processes input from right to left when placing so equal keys keep their relative order.
    </footer>
  </div>

  <script>
  // Counting Sort Visualizer
  // Author: generated interactive demo
  (function(){
    // Elements
    const inputArrayEl = document.getElementById('inputArray');
    const randSizeEl = document.getElementById('randSize');
    const randMaxEl = document.getElementById('randMax');
    const btnRandom = document.getElementById('btnRandom');
    const modeEl = document.getElementById('mode');
    const speedEl = document.getElementById('speed');
    const speedLabel = document.getElementById('speedLabel');
    const btnStart = document.getElementById('btnStart');
    const btnStep = document.getElementById('btnStep');
    const btnPause = document.getElementById('btnPause');
    const btnReset = document.getElementById('btnReset');
    const inputBars = document.getElementById('inputBars');
    const countsBars = document.getElementById('countsBars');
    const outputBars = document.getElementById('outputBars');
    const codeBlock = document.getElementById('codeBlock');
    const logEl = document.getElementById('log');
    const statusEl = document.getElementById('status');

    let state = {
      arr: [],
      k: 0,
      actions: [],
      stepIndex: 0,
      playing: false,
      timer: null
    };

    // Pseudo-code lines
    const codeLines = [
      "1. k = max(A)  // or provided maximum key",
      "2. initialize counts[0..k] = 0",
      "3. for j = 0 .. n-1: counts[A[j]]++   // count occurrences",
      "4. for i = 1 .. k: counts[i] += counts[i-1]   // prefix sums (starting indices)",
      "5. // stable placement (ascending):",
      "6. for j = n-1 .. 0: output[counts[A[j]] - 1] = A[j]; counts[A[j]]--",
      "7. // non-stable descending (alternate):",
      "8. p = 0",
      "9. for v = k .. 0: while counts[v]-- > 0: output[p++] = v"
    ];

    function renderCode(highlightLine){
      codeBlock.innerHTML = '';
      codeLines.forEach((ln,i)=>{
        const div = document.createElement('div');
        div.textContent = ln;
        div.className = 'line' + ((i+1) === highlightLine ? ' hl' : '');
        codeBlock.appendChild(div);
      });
    }

    // Helpers: parse input
    function parseInputArray(){
      const raw = inputArrayEl.value.trim();
      if(!raw) return [];
      const parts = raw.split(/[\s,]+/).map(s=>s.trim()).filter(Boolean);
      const nums = [];
      for(const p of parts){
        const v = Number(p);
        if(!Number.isFinite(v) || v<0 || Math.floor(v)!==v){
          alert("Only non-negative integers allowed. Invalid: " + p);
          return null;
        }
        nums.push(v);
      }
      return nums;
    }

    function generateRandom(){
      const n = Math.max(1, Math.min(80, Number(randSizeEl.value) || 10));
      const maxv = Math.max(0, Math.min(200, Number(randMaxEl.value) || 9));
      const a = [];
      for(let i=0;i<n;i++) a.push(Math.floor(Math.random()*(maxv+1)));
      inputArrayEl.value = a.join(', ');
    }

    // Build operations by simulating the algorithm (recording actions)
    function recordActions(arr, mode, givenK){
      const A = arr.slice();
      const n = A.length;
      const k = Math.max(givenK===undefined? -1 : givenK, ...A, 0);
      const counts = new Array(k+1).fill(0);
      const output = new Array(n).fill(null);
      const ops = [];

      // initial state
      ops.push({type:'init', arr:A.slice(), counts:counts.slice(), output:output.slice(), desc:`Initialize counts array with zeros (size k=${k})`, line:2});

      // counting occurrences
      for(let j=0;j<n;j++){
        const v = A[j];
        counts[v] += 1;
        ops.push({type:'count', idx:j, val:v, counts:counts.slice(), arr:A.slice(), output:output.slice(), desc:`Count value ${v}: counts[${v}]++ => ${counts[v]}`, line:3});
      }

      if(mode === 'stable-asc'){
        // prefix sums
        for(let i=1;i<=k;i++){
          counts[i] += counts[i-1];
          ops.push({type:'cumulative', idx:i, counts:counts.slice(), desc:`Prefix sum at ${i}: counts[${i}] += counts[${i-1}] => ${counts[i]}`, line:4});
        }
        // stable placement: iterate from right to left
        for(let j=n-1;j>=0;j--){
          const v = A[j];
          const pos = counts[v] - 1;
          output[pos] = v;
          counts[v] -= 1;
          ops.push({type:'place', fromIndex:j, value:v, toIndex:pos, counts:counts.slice(), arr:A.slice(), output:output.slice(), desc:`Place A[${j}]=${v} at output[${pos}] (counts[${v}]-- => ${counts[v]})`, line:6});
        }
        ops.push({type:'done', counts:counts.slice(), output:output.slice(), desc:'Completed stable ascending counting sort', line:null});
      } else {
        // descending non-stable: fill output by value from k down to 0
        let p = 0;
        // Note: we recorded counts already in counting phase
        for(let v=k; v>=0; v--){
          while(counts[v] > 0){
            output[p] = v;
            counts[v] -= 1;
            ops.push({type:'fillDesc', value:v, toIndex:p, counts:counts.slice(), arr:A.slice(), output:output.slice(), desc:`Place value ${v} at output[${p}] (counts[${v}]-- => ${counts[v]})`, line:9});
            p++;
          }
        }
        ops.push({type:'done', counts:counts.slice(), output:output.slice(), desc:'Completed descending non-stable counting sort', line:null});
      }

      return {ops, k};
    }

    // Rendering visual arrays
    function renderBars(container, values, options={}){
      // Options: maxValue (for scaling), showIndex, small
      container.innerHTML = '';
      const maxVal = options.maxValue !== undefined ? options.maxValue : Math.max(...values.map(v=>v===null?0:v), 1);
      const showIndex = options.showIndex || false;
      const small = options.small || false;
      const width = small ? 40 : 26;
      values.forEach((v,i)=>{
        const bar = document.createElement('div');
        bar.className = 'bar' + (small ? ' small' : '');
        const val = (v===null)? '' : String(v);
        bar.style.height = ( (v===null?0:v) / (maxVal||1) * 100 ) + '%';
        bar.title = val;
        bar.style.transition = 'height 200ms, background 200ms';
        bar.textContent = val;
        bar.style.minWidth = width + 'px';
        container.appendChild(bar);
        if(showIndex){
          const idx = document.createElement('div');
          idx.style.fontSize='11px'; idx.style.color='var(--muted)';
          idx.textContent = i; container.appendChild(idx);
        }
      });
    }

    // Render counts array with indices below bars
    function renderCounts(container, counts){
      container.innerHTML = '';
      const maxCount = Math.max(...counts, 1);
      counts.forEach((c,i)=>{
        const wrap = document.createElement('div');
        wrap.style.display = 'flex'; wrap.style.flexDirection='column'; wrap.style.alignItems='center';
        const bar = document.createElement('div');
        bar.className = 'bar small';
        bar.style.height = (c / maxCount * 100) + '%';
        bar.style.width = '34px';
        bar.style.background = 'linear-gradient(180deg,#fbbf24,#fb923c)';
        bar.textContent = c===0? '' : String(c);
        bar.title = String(c);
        bar.style.marginBottom = '6px';
        wrap.appendChild(bar);
        const lbl = document.createElement('div');
        lbl.textContent = i; lbl.style.fontSize='12px'; lbl.style.color='var(--muted)';
        wrap.appendChild(lbl);
        container.appendChild(wrap);
      });
    }

    // Log helper
    function log(msg){
      const d = document.createElement('div');
      d.textContent = msg;
      logEl.appendChild(d);
      logEl.scrollTop = logEl.scrollHeight;
    }

    function setStatus(s){
      statusEl.textContent = s;
    }

    // Playback control
    function applyAction(action){
      // update visuals & code highlight & log
      if(action.arr) renderBars(inputBars, action.arr, {maxValue: Math.max(...action.arr,1)});
      if(action.counts) renderCounts(countsBars, action.counts);
      if(action.output) renderBars(outputBars, action.output, {maxValue: Math.max(...state.arr,1)});
      if(action.desc) log(action.desc);
      renderCode(action.line || null);
    }

    async function play(){
      if(state.playing) return;
      state.playing = true;
      setStatus('Playing');
      while(state.playing && state.stepIndex < state.actions.length){
        const a = state.actions[state.stepIndex];
        applyAction(a);
        state.stepIndex++;
        const delay = Number(speedEl.value) || 300;
        await new Promise(r=>state.playing ? setTimeout(r, delay) : r());
      }
      if(state.stepIndex >= state.actions.length){
        setStatus('Completed');
        state.playing = false;
      } else {
        setStatus('Paused');
      }
    }

    function step(){
      if(state.stepIndex >= state.actions.length){
        setStatus('Completed');
        return;
      }
      const a = state.actions[state.stepIndex];
      applyAction(a);
      state.stepIndex++;
      setStatus(`Step ${state.stepIndex} / ${state.actions.length}`);
      if(state.stepIndex >= state.actions.length) setStatus('Completed');
    }

    function pause(){
      state.playing = false;
      setStatus('Paused');
    }

    function resetUI(){
      state.playing = false;
      state.stepIndex = 0;
      state.actions = [];
      state.arr = [];
      logEl.innerHTML = '';
      inputBars.innerHTML = '';
      countsBars.innerHTML = '';
      outputBars.innerHTML = '';
      renderCode(null);
      setStatus('Idle');
    }

    // Wire controls
    btnRandom.addEventListener('click', ()=>{
      generateRandom();
    });

    speedEl.addEventListener('input', ()=>{
      speedLabel.textContent = speedEl.value + ' ms';
    });

    btnStart.addEventListener('click', ()=>{
      // prepare and play
      const A = parseInputArray();
      if(A === null) return;
      if(A.length === 0){
        alert('Provide at least one number.');
        return;
      }
      const mode = modeEl.value;
      const kGiven = Number(randMaxEl.value);
      resetUI();
      state.arr = A.slice();
      const rec = recordActions(A, mode, kGiven);
      state.actions = rec.ops;
      state.k = rec.k;
      // Render initial arrays
      renderBars(inputBars, state.arr, {maxValue: Math.max(...state.arr,1)});
      // initial counts (first action)
      if(state.actions.length>0 && state.actions[0].counts) renderCounts(countsBars, state.actions[0].counts);
      renderBars(outputBars, new Array(state.arr.length).fill(null), {maxValue: Math.max(...state.arr,1)});
      logEl.innerHTML = '';
      state.stepIndex = 0;
      play();
    });

    btnStep.addEventListener('click', ()=>{
      if(state.actions.length===0){
        // prepare actions but don't play
        const A = parseInputArray();
        if(A === null) return;
        if(A.length === 0){
          alert('Provide at least one number.');
          return;
        }
        const mode = modeEl.value;
        const kGiven = Number(randMaxEl.value);
        resetUI();
        state.arr = A.slice();
        const rec = recordActions(A, mode, kGiven);
        state.actions = rec.ops;
        state.k = rec.k;
        renderBars(inputBars, state.arr, {maxValue: Math.max(...state.arr,1)});
        if(state.actions.length>0 && state.actions[0].counts) renderCounts(countsBars, state.actions[0].counts);
        renderBars(outputBars, new Array(state.arr.length).fill(null), {maxValue: Math.max(...state.arr,1)});
      }
      pause();
      step();
    });

    btnPause.addEventListener('click', ()=>{
      pause();
    });

    btnReset.addEventListener('click', ()=>{
      resetUI();
    });

    // initial render
    renderCode(null);
    renderBars(inputBars, [4,3,2,6,1,3,2], {maxValue:7});
    renderCounts(countsBars, [0,0,0,0,0,0,0]);
    renderBars(outputBars, new Array(7).fill(null), {maxValue:7});
    log("Ready. Click Start to run counting sort or Step to step through.");

    // keyboard shortcuts
    window.addEventListener('keydown', (e)=>{
      if(e.key === ' ') { e.preventDefault(); if(state.playing) pause(); else btnStart.click(); }
      if(e.key === 'ArrowRight') btnStep.click();
    });
  })();
  </script>
</body>
</html>