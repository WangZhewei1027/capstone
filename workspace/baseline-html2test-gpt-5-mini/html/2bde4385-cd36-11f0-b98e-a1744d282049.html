<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Insertion Sort Visualizer</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  :root{
    --bg:#0f1724;
    --card:#0b1220;
    --accent:#22c1c3;
    --muted:#9fb0c0;
    --bar:#60a5fa;
    --bar-active:#f59e0b;
    --bar-key:#ef4444;
    --bar-compare:#a78bfa;
    --text:#e6f0f4;
  }
  *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
  body{margin:0;background:linear-gradient(180deg,#071226 0%,#071427 100%);color:var(--text);min-height:100vh;display:flex;align-items:flex-start;justify-content:center;padding:18px;}
  .container{max-width:1100px;width:100%;}
  header{display:flex;align-items:center;gap:16px;margin-bottom:14px;}
  h1{font-size:18px;margin:0;color:var(--accent);}
  p.small{margin:0;color:var(--muted);font-size:13px}
  .controls{display:grid;grid-template-columns:repeat(6,1fr);gap:10px;margin-bottom:12px}
  .controls > *{background:var(--card);padding:10px;border-radius:8px}
  .controls label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
  input[type=range]{width:100%}
  button{background:linear-gradient(180deg,#1b2430,#0e1620);border:1px solid rgba(255,255,255,0.04);color:var(--text);padding:8px 10px;border-radius:6px;cursor:pointer}
  button:active{transform:translateY(1px)}
  .bigbtn{padding:10px 14px;font-weight:600}
  .row{display:flex;gap:12px;align-items:center}
  .viz{background:linear-gradient(180deg,#071427,#071226);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);display:flex;gap:14px}
  .canvas{flex:1;min-height:320px;display:flex;align-items:end;padding:6px;gap:6px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);border-radius:8px}
  .bar{flex:1 1 auto;display:flex;align-items:end;justify-content:center;border-radius:4px 4px 6px 6px;position:relative;min-width:6px;transition:height 180ms linear, transform 180ms linear}
  .bar > span{position:absolute;top:-22px;font-size:12px;color:var(--muted)}
  .bar.small > span{font-size:11px;top:-18px}
  .panel{width:360px;min-width:260px;max-height:480px;overflow:auto;padding:10px;border-radius:8px;background:linear-gradient(180deg,#061026,#071427);border:1px solid rgba(255,255,255,0.03)}
  pre{margin:0;background:none;color:var(--muted);font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,monospace;font-size:13px;line-height:1.5}
  .pseudocode{background:transparent;padding:8px;border-radius:6px}
  .pseudocode div{padding:6px;border-radius:6px}
  .line.active{background:linear-gradient(90deg,rgba(34,193,195,0.08),rgba(167,139,250,0.04));color:var(--text);border-left:3px solid var(--accent)}
  .stats{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .stat{background:rgba(255,255,255,0.03);padding:6px 8px;border-radius:6px;font-size:13px;color:var(--muted)}
  .legend{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
  .legend div{display:flex;gap:6px;align-items:center;font-size:13px;color:var(--muted)}
  .colorbox{width:14px;height:12px;border-radius:3px}
  footer{margin-top:12px;color:var(--muted);font-size:13px}
  .smallmuted{font-size:12px;color:var(--muted)}
  input[type=number]{width:72px;padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)}
  .controls .wide{grid-column:span 2}
  @media (max-width:900px){
    .controls{grid-template-columns:repeat(2,1fr)}
    .panel{width:100%}
    .viz{flex-direction:column}
    .canvas{min-height:240px}
  }
</style>
</head>
<body>
<div class="container">
  <header>
    <div>
      <h1>Insertion Sort Visualizer</h1>
      <p class="small">Step through insertion sort with comparisons and shifts highlighted.</p>
    </div>
  </header>

  <div class="controls">
    <div>
      <label>Array size: <span id="sizeLabel">20</span></label>
      <input id="size" type="range" min="6" max="80" value="20">
    </div>

    <div>
      <label>Speed (ms per step): <span id="speedLabel">150</span></label>
      <input id="speed" type="range" min="10" max="1000" value="150">
    </div>

    <div>
      <label>Order</label>
      <div style="display:flex;gap:8px;align-items:center">
        <button id="ascBtn" class="bigbtn" style="flex:1;background:linear-gradient(90deg,#134e4a,#065f46);">Ascending</button>
        <button id="descBtn" class="bigbtn" style="flex:1;">Descending</button>
      </div>
    </div>

    <div class="wide">
      <label>Controls</label>
      <div style="display:flex;gap:8px">
        <button id="randomize">Randomize</button>
        <button id="start" class="bigbtn">Start</button>
        <button id="pause">Pause</button>
        <button id="step">Step</button>
        <button id="reset">Reset</button>
      </div>
    </div>

    <div>
      <label>Range (min - max)</label>
      <div style="display:flex;gap:8px">
        <input id="minVal" type="number" value="10" step="1"> 
        <input id="maxVal" type="number" value="400" step="1">
      </div>
    </div>

    <div>
      <label>Shuffle seed</label>
      <div class="row">
        <input id="seed" type="number" value="">
        <button id="seedApply">Apply</button>
      </div>
    </div>
  </div>

  <div class="viz">
    <div class="canvas" id="canvas" aria-hidden="false"></div>

    <aside class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div><strong>Algorithm</strong><div class="smallmuted">Insertion Sort</div></div>
        <div class="smallmuted">Comparisons / Shifts</div>
      </div>
      <div class="pseudocode" id="pseudocode">
        <!-- pseudocode lines appended by script -->
      </div>

      <div class="stats">
        <div class="stat">Step: <span id="stepCount">0</span></div>
        <div class="stat">Comparisons: <span id="compCount">0</span></div>
        <div class="stat">Shifts: <span id="shiftCount">0</span></div>
        <div class="stat">i: <span id="iIndex">-</span></div>
        <div class="stat">j: <span id="jIndex">-</span></div>
      </div>

      <div class="legend">
        <div><div class="colorbox" style="background:var(--bar)"></div><div class="smallmuted">Normal</div></div>
        <div><div class="colorbox" style="background:var(--bar-active)"></div><div class="smallmuted">Currently considered</div></div>
        <div><div class="colorbox" style="background:var(--bar-key)"></div><div class="smallmuted">Key element</div></div>
        <div><div class="colorbox" style="background:var(--bar-compare)"></div><div class="smallmuted">Compare</div></div>
      </div>

      <footer>
        <div class="smallmuted" style="margin-top:12px">This visualizer animates the classic insertion sort: it builds a sorted prefix by taking the next element (key) and shifting larger elements right to make room.</div>
      </footer>
    </aside>
  </div>
</div>

<script>
(() => {
  // DOM refs
  const canvas = document.getElementById('canvas');
  const sizeInput = document.getElementById('size');
  const speedInput = document.getElementById('speed');
  const sizeLabel = document.getElementById('sizeLabel');
  const speedLabel = document.getElementById('speedLabel');
  const randomizeBtn = document.getElementById('randomize');
  const startBtn = document.getElementById('start');
  const pauseBtn = document.getElementById('pause');
  const stepBtn = document.getElementById('step');
  const resetBtn = document.getElementById('reset');
  const minValInput = document.getElementById('minVal');
  const maxValInput = document.getElementById('maxVal');
  const seedInput = document.getElementById('seed');
  const seedApply = document.getElementById('seedApply');
  const ascBtn = document.getElementById('ascBtn');
  const descBtn = document.getElementById('descBtn');

  const stepCountEl = document.getElementById('stepCount');
  const compCountEl = document.getElementById('compCount');
  const shiftCountEl = document.getElementById('shiftCount');
  const iIndexEl = document.getElementById('iIndex');
  const jIndexEl = document.getElementById('jIndex');

  const pseudocodeEl = document.getElementById('pseudocode');

  // state
  let arr = [];
  let bars = [];
  let generator = null;
  let running = false;
  let autoTimer = null;
  let ascending = true;
  let STEPS = 0;
  let COMPS = 0;
  let SHIFTS = 0;
  let seed = null;

  const defaultSize = parseInt(sizeInput.value,10);
  const defaultMin = parseInt(minValInput.value,10);
  const defaultMax = parseInt(maxValInput.value,10);

  // pseudocode lines
  function renderPseudocode(){
    pseudocodeEl.innerHTML = '';
    const lines = [
      'for i = 1 to n-1',
      '  key = A[i]',
      '  j = i - 1',
      `  while j >= 0 and A[j] ${ascending ? '>' : '<'} key`,
      '    A[j+1] = A[j]',
      '    j = j - 1',
      '  A[j+1] = key'
    ];
    lines.forEach((t,idx)=>{
      const div = document.createElement('div');
      div.textContent = t;
      div.dataset.line = idx;
      pseudocodeEl.appendChild(div);
    });
  }

  renderPseudocode();

  // PRNG for deterministic seed
  function seededRand(s) {
    let state = s >>> 0;
    return function() {
      // xorshift32
      state ^= state << 13;
      state ^= state >>> 17;
      state ^= state << 5;
      state >>>= 0;
      return (state) / 4294967295;
    };
  }

  function generateArray(n, minV, maxV, useSeed=false) {
    const out = [];
    const range = Math.max(1, maxV - minV);
    let rnd = Math.random;
    if (useSeed && seed !== null && seed !== '') {
      rnd = seededRand(Number(seed) || 1);
    }
    for (let i=0;i<n;i++){
      out.push(Math.round(minV + rnd() * range));
    }
    return out;
  }

  function clearCanvas() {
    canvas.innerHTML = '';
    bars = [];
  }

  function drawArray(arrSnapshot, highlight = {}) {
    // highlight: {keyIndex, compareIndex, iIndex, jIndex}
    clearCanvas();
    const n = arrSnapshot.length;
    const max = Math.max(...arrSnapshot,1);
    // create bars
    arrSnapshot.forEach((v, idx) => {
      const bar = document.createElement('div');
      bar.className = 'bar';
      if (n > 40) bar.classList.add('small');
      const h = Math.round((v / max) * 100);
      bar.style.height = (10 + h) + '%';
      bar.style.background = 'linear-gradient(180deg,var(--bar),#2b6cb0)';
      // value label
      const span = document.createElement('span');
      span.textContent = v;
      bar.appendChild(span);
      // mark types
      if (typeof highlight.keyIndex === 'number' && idx === highlight.keyIndex) {
        bar.style.background = 'linear-gradient(180deg,var(--bar-key),#ef4444)';
        bar.style.transform = 'translateY(-6px) scale(1.02)';
      } else if (typeof highlight.compareIndex === 'number' && idx === highlight.compareIndex) {
        bar.style.background = 'linear-gradient(180deg,var(--bar-compare),#7c3aed)';
        bar.style.transform = 'translateY(-4px)';
      } else if (typeof highlight.iIndex === 'number' && idx === highlight.iIndex) {
        bar.style.background = 'linear-gradient(180deg,var(--bar-active),#f59e0b)';
        bar.style.transform = 'translateY(-4px)';
      } else if (typeof highlight.jIndex === 'number' && idx === highlight.jIndex) {
        bar.style.background = 'linear-gradient(180deg,var(--bar-active),#f59e0b)';
        bar.style.transform = 'translateY(-4px)';
      }
      // add to canvas
      canvas.appendChild(bar);
      bars.push(bar);
    });
  }

  // generator for insertion sort that yields steps
  function* insertionSortGen(a, ascending=true) {
    const n = a.length;
    for (let i = 1; i < n; i++) {
      let key = a[i];
      let j = i - 1;
      // mark selection
      yield {type:'select', i, j, key, arr: a.slice()};
      // while condition check (we'll yield a compare each loop iteration)
      while (j >= 0) {
        // compare step
        const comp = ascending ? (a[j] > key) : (a[j] < key);
        yield {type:'compare', i, j, key, result: comp, arr: a.slice()};
        if (comp) {
          // shift a[j] to a[j+1]
          a[j+1] = a[j];
          yield {type:'shift', from: j, to: j+1, arr: a.slice()};
          j = j - 1;
        } else {
          break;
        }
      }
      // place the key
      a[j+1] = key;
      yield {type:'place', index: j+1, key, arr: a.slice()};
    }
    yield {type:'done', arr: a.slice()};
  }

  // UI actions
  function resetCounters(){
    STEPS = 0; COMPS = 0; SHIFTS = 0;
    stepCountEl.textContent = STEPS;
    compCountEl.textContent = COMPS;
    shiftCountEl.textContent = SHIFTS;
    iIndexEl.textContent = '-';
    jIndexEl.textContent = '-';
  }

  function updatePseudocodeHighlight(lines) {
    // lines: array of line indices to highlight
    const nodes = pseudocodeEl.querySelectorAll('div');
    nodes.forEach(n => {
      const idx = Number(n.dataset.line);
      if (lines.includes(idx)) n.classList.add('active'); else n.classList.remove('active');
    });
  }

  function applyStep(step) {
    STEPS++;
    stepCountEl.textContent = STEPS;
    if (!step) return;

    // default clear highlights
    let highlight = {};
    switch(step.type) {
      case 'select':
        iIndexEl.textContent = step.i;
        jIndexEl.textContent = step.j;
        updatePseudocodeHighlight([0,1,2]);
        highlight = {iIndex: step.i, keyIndex: step.i};
        drawArray(step.arr, highlight);
        break;
      case 'compare':
        COMPS++;
        compCountEl.textContent = COMPS;
        iIndexEl.textContent = step.i;
        jIndexEl.textContent = step.j;
        updatePseudocodeHighlight([3]);
        highlight = {jIndex: step.j, keyIndex: step.i};
        drawArray(step.arr, highlight);
        break;
      case 'shift':
        SHIFTS++;
        shiftCountEl.textContent = SHIFTS;
        updatePseudocodeHighlight([4,5]);
        // show where element was shifted
        highlight = {compareIndex: step.to, keyIndex: step.to};
        drawArray(step.arr, highlight);
        break;
      case 'place':
        updatePseudocodeHighlight([6]);
        iIndexEl.textContent = step.index;
        jIndexEl.textContent = step.index - 1;
        highlight = {keyIndex: step.index};
        drawArray(step.arr, highlight);
        break;
      case 'done':
        updatePseudocodeHighlight([]);
        drawArray(step.arr, {});
        running = false;
        stopAuto();
        break;
      default:
        drawArray(step.arr, {});
        break;
    }
  }

  function stopAuto(){
    running = false;
    if (autoTimer) {
      clearTimeout(autoTimer);
      autoTimer = null;
    }
  }

  function startAuto(){
    if (!generator) return;
    running = true;
    stepLoop();
  }

  function stepLoop(){
    if (!running) return;
    const sp = Number(speedInput.value) || 150;
    autoTimer = setTimeout(()=>{
      const res = generator.next();
      if (!res.done) {
        applyStep(res.value);
        stepLoop();
      } else {
        applyStep(res.value);
        running = false;
      }
    }, sp);
  }

  // Controls event handlers
  sizeInput.addEventListener('input', ()=>{
    sizeLabel.textContent = sizeInput.value;
  });

  speedInput.addEventListener('input', ()=>{
    speedLabel.textContent = speedInput.value;
  });

  randomizeBtn.addEventListener('click', ()=>{
    const n = Number(sizeInput.value);
    const minV = Number(minValInput.value);
    const maxV = Number(maxValInput.value);
    arr = generateArray(n, minV, maxV, seed !== '' && seed !== null);
    resetCounters();
    generator = null;
    drawArray(arr, {});
    renderPseudocode();
  });

  seedApply.addEventListener('click', ()=>{
    seed = seedInput.value;
    // generate with seed
    randomizeBtn.click();
  });

  ascBtn.addEventListener('click', ()=>{
    ascending = true;
    ascBtn.style.background = 'linear-gradient(90deg,#134e4a,#065f46)';
    descBtn.style.background = '';
    renderPseudocode();
  });

  descBtn.addEventListener('click', ()=>{
    ascending = false;
    descBtn.style.background = 'linear-gradient(90deg,#5b21b6,#7c3aed)';
    ascBtn.style.background = '';
    renderPseudocode();
  });

  startBtn.addEventListener('click', ()=>{
    if (!generator) {
      // create a fresh generator from a copy of the current array
      generator = insertionSortGen(arr.slice(), ascending);
      // ensure counters reflect fresh run
      resetCounters();
    }
    if (!running) startAuto();
  });

  pauseBtn.addEventListener('click', ()=>{
    stopAuto();
  });

  stepBtn.addEventListener('click', ()=>{
    if (!generator) {
      generator = insertionSortGen(arr.slice(), ascending);
      resetCounters();
    }
    stopAuto();
    const res = generator.next();
    if (!res.done) {
      applyStep(res.value);
    } else {
      applyStep(res.value);
    }
  });

  resetBtn.addEventListener('click', ()=>{
    stopAuto();
    generator = null;
    resetCounters();
    drawArray(arr, {});
    updatePseudocodeHighlight([]);
  });

  // initial array
  function initialize(){
    arr = generateArray(defaultSize, defaultMin, defaultMax, false);
    resetCounters();
    drawArray(arr, {});
  }
  initialize();

  // keyboard shortcuts
  window.addEventListener('keydown', (e)=>{
    if (e.key === ' ') {
      e.preventDefault();
      if (running) pauseBtn.click(); else startBtn.click();
    } else if (e.key === 'ArrowRight') {
      stepBtn.click();
    } else if (e.key === 'r') {
      randomizeBtn.click();
    }
  });

  // responsive redraw on window resize to keep labels visible
  window.addEventListener('resize', ()=> drawArray(arr, {}));

  // help: initial states for order buttons
  ascBtn.click();

  // expose nothing
})();
</script>
</body>
</html>