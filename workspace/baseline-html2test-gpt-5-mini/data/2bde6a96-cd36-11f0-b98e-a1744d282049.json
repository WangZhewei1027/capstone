{
  "id": "2bde6a96-cd36-11f0-b98e-a1744d282049",
  "timestamp": "2025-11-29T15:17:48.310Z",
  "type": "html-to-test",
  "htmlModel": "gpt-5-mini",
  "playwrightModel": "gpt-5-mini",
  "status": "success",
  "question": "Huffman Coding",
  "answer": {
    "role": "assistant",
    "content": "<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\" />\n<title>Huffman Coding Visualizer</title>\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<style>\n  :root{\n    --bg:#0f1724;\n    --panel:#0b1220;\n    --accent:#6ee7b7;\n    --muted:#9aa4b2;\n    --card:#0d1522;\n    --danger:#ff6b6b;\n  }\n  body{\n    margin:0;\n    font-family: Inter, ui-sans-serif, system-ui, -apple-system, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial;\n    background: linear-gradient(180deg, #071025 0%, #041327 100%);\n    color:#e6eef6;\n    -webkit-font-smoothing:antialiased;\n    -moz-osx-font-smoothing:grayscale;\n    line-height:1.4;\n  }\n  header{\n    padding:18px 24px;\n    display:flex;\n    align-items:center;\n    gap:18px;\n    border-bottom: 1px solid rgba(255,255,255,0.03);\n  }\n  header h1{\n    font-size:18px;\n    margin:0;\n    letter-spacing:0.2px;\n  }\n  .container{\n    display:grid;\n    grid-template-columns: 360px 1fr 360px;\n    gap:18px;\n    padding:18px;\n  }\n  .panel{\n    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));\n    border:1px solid rgba(255,255,255,0.03);\n    padding:14px;\n    border-radius:10px;\n  }\n  .panel h2{\n    font-size:14px;\n    margin:0 0 8px 0;\n    color:var(--accent);\n  }\n  textarea{\n    width:100%;\n    height:140px;\n    resize:vertical;\n    background:transparent;\n    color:inherit;\n    border:1px dashed rgba(255,255,255,0.04);\n    padding:8px;\n    border-radius:8px;\n    font-family:monospace;\n    font-size:13px;\n  }\n  button, .btn{\n    appearance:none;\n    border:0;\n    background:linear-gradient(180deg,#165f46,#0f5139);\n    color:white;\n    padding:8px 12px;\n    border-radius:8px;\n    cursor:pointer;\n    font-weight:600;\n    font-size:13px;\n  }\n  .btn.secondary{\n    background:transparent;\n    border:1px solid rgba(255,255,255,0.04);\n    color:var(--accent);\n  }\n  .small{\n    font-size:12px;\n    padding:6px 8px;\n  }\n  .freq-list{\n    max-height:240px;\n    overflow:auto;\n    margin-top:8px;\n    border-radius:8px;\n    padding:6px;\n    background:rgba(255,255,255,0.01);\n    border:1px solid rgba(255,255,255,0.02);\n  }\n  .freq-row{\n    display:flex;\n    justify-content:space-between;\n    padding:6px 8px;\n    border-radius:6px;\n    margin:4px 0;\n    align-items:center;\n    gap:8px;\n    font-size:13px;\n  }\n  .freq-row .char{\n    min-width:24px;\n    text-align:center;\n    padding:4px 6px;\n    border-radius:6px;\n    background:rgba(255,255,255,0.02);\n    font-family:monospace;\n  }\n  .freq-row .meta{\n    color:var(--muted);\n    font-size:12px;\n  }\n  .controls{\n    display:flex;\n    gap:8px;\n    margin-top:8px;\n    flex-wrap:wrap;\n  }\n  .svg-wrap{\n    background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));\n    border-radius:10px;\n    padding:8px;\n    height:560px;\n    overflow:auto;\n    border:1px solid rgba(255,255,255,0.03);\n  }\n  #treeSVG{\n    width:100%;\n    height:520px;\n  }\n  .right-col .card{\n    margin-bottom:12px;\n  }\n  .codes{\n    display:flex;\n    flex-wrap:wrap;\n    gap:8px;\n    margin-top:8px;\n  }\n  .code-row{\n    background:rgba(255,255,255,0.02);\n    padding:8px;\n    border-radius:8px;\n    border:1px solid rgba(255,255,255,0.02);\n    font-family:monospace;\n    font-size:13px;\n    min-width:110px;\n  }\n  .stats{\n    display:flex;\n    gap:12px;\n    margin-top:8px;\n    flex-wrap:wrap;\n  }\n  .stat{\n    background:rgba(255,255,255,0.01);\n    border-radius:8px;\n    padding:8px;\n    font-size:13px;\n    border:1px solid rgba(255,255,255,0.02);\n  }\n  .controls-row{\n    display:flex;\n    gap:8px;\n    align-items:center;\n    margin-top:8px;\n  }\n  .queue{\n    display:flex;\n    gap:6px;\n    flex-wrap:wrap;\n    margin-top:8px;\n  }\n  .q-item{\n    background:rgba(255,255,255,0.02);\n    padding:6px 8px;\n    border-radius:8px;\n    font-family:monospace;\n    font-size:13px;\n  }\n  .play{\n    display:flex;\n    gap:8px;\n    align-items:center;\n  }\n  .footer{\n    padding:14px 18px;\n    font-size:13px;\n    color:var(--muted);\n    border-top:1px solid rgba(255,255,255,0.02);\n  }\n  .legend{\n    display:flex;\n    gap:10px;\n    align-items:center;\n    margin-top:8px;\n    flex-wrap:wrap;\n  }\n  .legend .item{\n    display:flex;\n    gap:6px;\n    align-items:center;\n    font-size:13px;\n    color:var(--muted);\n  }\n  .dot{\n    width:14px;\n    height:14px;\n    border-radius:50%;\n    background:var(--accent);\n    display:inline-block;\n  }\n  .small-muted{\n    color:var(--muted);\n    font-size:13px;\n  }\n  a.link{\n    color:var(--accent);\n    text-decoration:none;\n  }\n  input[type=\"text\"], input[type=\"number\"]{\n    background:transparent;\n    border:1px dashed rgba(255,255,255,0.03);\n    color:inherit;\n    padding:6px 8px;\n    border-radius:6px;\n    font-family:monospace;\n    font-size:13px;\n  }\n  .controls-row label{ font-size:13px; color:var(--muted); margin-right:6px; }\n  .code-bit{\n    font-family:monospace;\n    background:rgba(255,255,255,0.02);\n    padding:6px 8px;\n    border-radius:6px;\n    border:1px solid rgba(255,255,255,0.02);\n  }\n  .danger{\n    background:linear-gradient(180deg,#b02a2a,#8a1f1f);\n  }\n  footer small{ color:var(--muted); }\n  @media (max-width:1100px){\n    .container{ grid-template-columns: 1fr; padding:12px; }\n    .svg-wrap{ height:420px; }\n  }\n</style>\n</head>\n<body>\n<header>\n  <h1>Huffman Coding Visualizer</h1>\n  <div style=\"color:var(--muted);font-size:13px\">Enter text, build a Huffman tree, watch merging steps, see codes and encoded bits.</div>\n</header>\n\n<div class=\"container\">\n  <div class=\"panel\">\n    <h2>Input</h2>\n    <textarea id=\"inputText\" placeholder=\"Type or paste any text here...\">this is an example for huffman encoding</textarea>\n    <div class=\"controls\">\n      <button id=\"buildBtn\" class=\"btn small\">Build Huffman Tree</button>\n      <button id=\"randomBtn\" class=\"btn small secondary\">Sample Text</button>\n      <button id=\"clearBtn\" class=\"btn small secondary\">Clear</button>\n    </div>\n\n    <h2 style=\"margin-top:12px\">Frequencies</h2>\n    <div class=\"freq-list\" id=\"freqList\"></div>\n\n    <div class=\"controls-row\" style=\"margin-top:10px;\">\n      <label>Min frequency filter:</label>\n      <input id=\"minFreq\" type=\"number\" value=\"1\" min=\"1\" style=\"width:70px\" />\n      <label style=\"margin-left:8px\">Show only top</label>\n      <input id=\"topK\" type=\"number\" value=\"\" placeholder=\"all\" style=\"width:70px\" />\n    </div>\n\n    <div class=\"legend\">\n      <div class=\"item\"><span class=\"dot\"></span> Leaf node (char + frequency)</div>\n      <div class=\"item\"><div style=\"width:14px;height:14px;border-radius:4px;background:#5b8cff\"></div> Internal node (sum of freq)</div>\n    </div>\n  </div>\n\n  <div class=\"panel svg-wrap right-col\">\n    <h2>Tree & Steps</h2>\n    <div style=\"display:flex;gap:12px;align-items:center;flex-wrap:wrap\">\n      <div class=\"controls-row\">\n        <button id=\"playBtn\" class=\"btn small\">Play</button>\n        <button id=\"stepPrev\" class=\"btn small secondary\">Prev</button>\n        <button id=\"stepNext\" class=\"btn small secondary\">Next</button>\n        <button id=\"resetStep\" class=\"btn small secondary\">Reset</button>\n      </div>\n      <div style=\"margin-left:auto\" class=\"small-muted\">Step <span id=\"stepIndex\">0</span> / <span id=\"stepCount\">0</span></div>\n    </div>\n\n    <div style=\"margin-top:8px;\">\n      <div class=\"small-muted\">Priority Queue (left = smallest)</div>\n      <div class=\"queue\" id=\"queueView\"></div>\n    </div>\n\n    <svg id=\"treeSVG\" viewBox=\"0 0 1200 520\" preserveAspectRatio=\"xMidYMid meet\"></svg>\n  </div>\n\n  <div class=\"panel\">\n    <h2>Codes & Compression</h2>\n\n    <div class=\"card\">\n      <div class=\"small-muted\">Generated codes</div>\n      <div class=\"codes\" id=\"codesView\" style=\"margin-top:8px\"></div>\n    </div>\n\n    <div class=\"card\" style=\"margin-top:10px\">\n      <div class=\"small-muted\">Encode / Decode</div>\n      <div style=\"margin-top:8px; display:flex; gap:8px;\">\n        <input id=\"encodeBits\" class=\"code-bit\" type=\"text\" placeholder=\"Encoded bits (auto)\"/>\n        <button id=\"decodeBtn\" class=\"btn small secondary\">Decode</button>\n        <button id=\"copyBits\" class=\"btn small\">Copy Bits</button>\n      </div>\n      <div style=\"margin-top:8px\">\n        <div class=\"small-muted\">Encoded bit string</div>\n        <div id=\"encodedView\" class=\"code-bit\" style=\"margin-top:6px; white-space:pre-wrap;max-height:120px;overflow:auto\"></div>\n      </div>\n    </div>\n\n    <div class=\"card\" style=\"margin-top:10px\">\n      <div class=\"small-muted\">Statistics</div>\n      <div class=\"stats\">\n        <div class=\"stat\">Original size: <div id=\"origSize\" style=\"font-weight:700\">0 bits</div></div>\n        <div class=\"stat\">Huffman size: <div id=\"huffSize\" style=\"font-weight:700\">0 bits</div></div>\n        <div class=\"stat\">Compression: <div id=\"compression\" style=\"font-weight:700\">0%</div></div>\n      </div>\n    </div>\n\n    <div class=\"card\" style=\"margin-top:10px\">\n      <div style=\"display:flex;gap:8px;align-items:center\">\n        <div class=\"small-muted\">Decoded text</div>\n        <button id=\"showDecoded\" class=\"btn small secondary\" style=\"margin-left:auto\">Show Decoded</button>\n      </div>\n      <div id=\"decodedView\" style=\"margin-top:8px; white-space:pre-wrap; background:rgba(255,255,255,0.01); padding:8px; border-radius:8px; border:1px solid rgba(255,255,255,0.02); max-height:140px; overflow:auto;\"></div>\n    </div>\n  </div>\n</div>\n\n<div class=\"footer\">\n  <small>Huffman coding builds an optimal prefix code (for a given frequency distribution). This demo shows step-by-step merges and assigns 0/1 codes by traversing left/right. For a single distinct symbol, code '0' is assigned.</small>\n</div>\n\n<script>\n/*\n  Huffman Coding Visualizer\n  - Build frequency table from input text\n  - Build Huffman tree step-by-step (recording merges)\n  - Assign codes by traversing final tree\n  - Visualize tree with SVG\n  - Animate merge steps and show priority queue\n  - Encode and decode text\n*/\n\nconst inputText = document.getElementById('inputText');\nconst buildBtn = document.getElementById('buildBtn');\nconst randomBtn = document.getElementById('randomBtn');\nconst clearBtn = document.getElementById('clearBtn');\nconst freqList = document.getElementById('freqList');\nconst minFreq = document.getElementById('minFreq');\nconst topK = document.getElementById('topK');\n\nconst treeSVG = document.getElementById('treeSVG');\nconst queueView = document.getElementById('queueView');\nconst codesView = document.getElementById('codesView');\nconst encodedView = document.getElementById('encodedView');\nconst encodeBits = document.getElementById('encodeBits');\nconst decodeBtn = document.getElementById('decodeBtn');\nconst copyBits = document.getElementById('copyBits');\nconst showDecoded = document.getElementById('showDecoded');\nconst decodedView = document.getElementById('decodedView');\n\nconst origSize = document.getElementById('origSize');\nconst huffSize = document.getElementById('huffSize');\nconst compression = document.getElementById('compression');\n\nconst playBtn = document.getElementById('playBtn');\nconst stepPrev = document.getElementById('stepPrev');\nconst stepNext = document.getElementById('stepNext');\nconst resetStep = document.getElementById('resetStep');\nconst stepIndex = document.getElementById('stepIndex');\nconst stepCount = document.getElementById('stepCount');\n\nconst sampleTexts = [\n  \"this is an example for huffman encoding\",\n  \"beep boop beep boop beep boop\",\n  \"AAAAAAABBBCCD\",\n  \"the quick brown fox jumps over the lazy dog\",\n  \"to be or not to be that is the question\"\n];\n\nlet state = {\n  frequencies: {},\n  nodes: [],      // initial leaf nodes\n  steps: [],      // snapshots of queue at each merge\n  root: null,\n  codes: {},\n  encoded: \"\",\n  decoded: \"\",\n  playTimer: null,\n  playSpeed: 800,\n  step: 0\n};\n\nfunction computeFrequencies(text){\n  const freq = {};\n  for (const ch of text){\n    freq[ch] = (freq[ch] || 0) + 1;\n  }\n  return freq;\n}\n\nlet nextNodeId = 1;\nfunction makeNode({char=null, freq=0, left=null, right=null, isInternal=false}){\n  return { id: nextNodeId++, char, freq, left, right, isInternal };\n}\n\n/* Build Huffman tree and record steps\n   We'll use a stable sort priority queue implemented as array sorted by freq then id\n   Steps: queue snapshots before each merge, with indices of two chosen nodes and new node appended\n*/\nfunction buildHuffmanFromFreq(freqMap){\n  nextNodeId = 1;\n  const nodes = [];\n  for(const [ch, f] of Object.entries(freqMap)){\n    nodes.push(makeNode({char: ch, freq: f, isInternal:false}));\n  }\n  // Edge: no symbols\n  if(nodes.length === 0){\n    return { root: null, steps: [], initialQueue: [], finalQueue: [] };\n  }\n  // sort ascending by freq then by id (stable)\n  const queue = nodes.slice();\n  queue.sort((a,b)=> a.freq - b.freq || a.id - b.id);\n  const steps = [];\n  // record initial queue\n  steps.push(snapshotQueue(queue));\n  // Special: if only one node, we still need a root (assign code '0')\n  if(queue.length === 1){\n    const root = makeNode({left: queue[0], right: null, freq: queue[0].freq, isInternal:true});\n    steps.push(snapshotQueue([root]));\n    return { root, steps, initialQueue: queue };\n  }\n\n  while(queue.length > 1){\n    // pick two smallest\n    const a = queue.shift();\n    const b = queue.shift();\n    const parent = makeNode({left: a, right: b, freq: a.freq + b.freq, isInternal:true});\n    // insert parent back keeping sorted order\n    let inserted = false;\n    for(let i=0;i<queue.length;i++){\n      if(parent.freq < queue[i].freq || (parent.freq === queue[i].freq && parent.id < queue[i].id)){\n        queue.splice(i,0,parent);\n        inserted = true;\n        break;\n      }\n    }\n    if(!inserted) queue.push(parent);\n    steps.push({ queue: snapshotQueue(queue), merged: {aId: a.id, bId: b.id, parentId: parent.id} });\n  }\n  const root = queue[0];\n  return { root, steps, initialQueue: nodes };\n}\n\nfunction snapshotQueue(queue){\n  // shallow copy with essential fields for display\n  return queue.map(n => ({ id: n.id, char: n.char, freq: n.freq, isInternal: !!n.isInternal }));\n}\n\n/* Assign binary codes to leaves (0 left, 1 right). For single-child internal nodes, follow left as 0.\n   For a tree with single distinct symbol, assign code '0'.\n*/\nfunction assignCodes(root){\n  const codes = {};\n  if(!root) return codes;\n  if(!root.left && !root.right && root.char !== null){\n    codes[root.char] = '0';\n    return codes;\n  }\n  function dfs(node, prefix){\n    if(!node) return;\n    if(node.char !== null && !node.isInternal){\n      codes[node.char] = prefix.length ? prefix : '0';\n      return;\n    }\n    // left -> 0, right -> 1\n    dfs(node.left, prefix + '0');\n    dfs(node.right, prefix + '1');\n  }\n  dfs(root, '');\n  return codes;\n}\n\n/* Encoding and decoding */\nfunction encodeText(text, codes){\n  let bits = '';\n  for(const ch of text){\n    const c = codes[ch];\n    if(!c) return null;\n    bits += c;\n  }\n  return bits;\n}\nfunction decodeBits(bits, root){\n  if(!root) return '';\n  // special case: single symbol tree where only root -> leaf\n  if(!root.left && !root.right && root.char !== null){\n    // bits length should be multiple of 1; each code '0'\n    let out = '';\n    for(let i=0;i<bits.length;i++){\n      out += root.char;\n    }\n    return out;\n  }\n  let res = '';\n  let node = root;\n  for(let i=0;i<bits.length;i++){\n    const b = bits[i];\n    node = (b === '0') ? node.left : node.right;\n    if(!node) return null; // invalid bits\n    if(node.char !== null && !node.isInternal){\n      res += node.char;\n      node = root;\n    }\n  }\n  // If ended not at root, bits incomplete\n  if(node !== root) return null;\n  return res;\n}\n\n/* UI: render frequency list */\nfunction renderFrequencies(freqMap){\n  freqList.innerHTML = '';\n  const arr = Object.keys(freqMap).map(ch => ({ch, f: freqMap[ch]}));\n  arr.sort((a,b)=> b.f - a.f || (a.ch > b.ch ? 1:-1));\n  const minF = Number(minFreq.value) || 1;\n  const k = Number(topK.value) || arr.length;\n  let shown = 0;\n  for(const item of arr){\n    if(item.f < minF) continue;\n    if(shown >= k) break;\n    const row = document.createElement('div');\n    row.className = 'freq-row';\n    row.innerHTML = `<div style=\"display:flex;gap:8px;align-items:center\">\n      <div class=\"char\">${escapeVisible(item.ch)}</div>\n      <div style=\"font-weight:700\">${item.f}</div>\n    </div>\n    <div class=\"meta\">${describeChar(item.ch)}</div>`;\n    freqList.appendChild(row);\n    shown++;\n  }\n  if(shown === 0){\n    freqList.innerHTML = '<div class=\"small-muted\">No symbols to show (adjust filters or enter text).</div>';\n  }\n}\n\nfunction escapeVisible(ch){\n  if(ch === ' ') return 'â£';\n  if(ch === '\\n') return '\\\\n';\n  if(ch === '\\t') return '\\\\t';\n  return ch;\n}\nfunction describeChar(ch){\n  if(ch === ' ') return 'space';\n  if(ch === '\\n') return 'newline';\n  if(ch === '\\t') return 'tab';\n  if(ch.length > 1) return ch;\n  return `code ${ch.charCodeAt(0)}`;\n}\n\n/* Render queue snapshot */\nfunction renderQueue(snapshot){\n  queueView.innerHTML = '';\n  if(!snapshot || snapshot.length === 0){\n    queueView.innerHTML = '<div class=\"small-muted\">empty</div>';\n    return;\n  }\n  for(const item of snapshot){\n    const div = document.createElement('div');\n    div.className = 'q-item';\n    if(item.isInternal){\n      div.style.background = 'linear-gradient(180deg,#153a76,#0f2956)';\n    }\n    div.textContent = `${item.char !== null ? escapeVisible(item.char) + ' ' : ''}[${item.freq}]`;\n    queueView.appendChild(div);\n  }\n}\n\n/* Draw final tree as SVG */\nfunction renderTreeSVG(root, codes){\n  // clear\n  while(treeSVG.firstChild) treeSVG.removeChild(treeSVG.firstChild);\n\n  if(!root){\n    const t = makeText(20,20,'No tree built');\n    treeSVG.appendChild(t);\n    return;\n  }\n  // compute layout positions: recursively compute subtree widths, then assign x positions\n  function measure(node){\n    if(!node) return {w:0, h:0, leaves:0};\n    if(node.char !== null && !node.isInternal){\n      return {w:1, h:1, leaves:1};\n    }\n    const L = measure(node.left || null);\n    const R = measure(node.right || null);\n    return { w: Math.max(1, L.w + R.w), h: Math.max(L.h, R.h)+1, leaves: L.leaves + R.leaves };\n  }\n  const m = measure(root);\n  const nodePositions = new Map();\n\n  const paddingX = 20;\n  const paddingY = 40;\n  const viewW = 1100;\n  const viewH = 480;\n  const startX = 40;\n  const endX = viewW - 40;\n  const totalWidthUnits = Math.max(1, m.w);\n\n  // assign x recursively\n  function assign(node, xMin, xMax, depth){\n    if(!node) return;\n    const x = (xMin + xMax) / 2;\n    const y = 40 + depth * paddingY;\n    nodePositions.set(node.id, {x,y,node});\n    if(node.left) assign(node.left, xMin, x, depth+1);\n    if(node.right) assign(node.right, x, xMax, depth+1);\n  }\n  assign(root, startX, endX, 0);\n\n  // draw links first\n  for(const [id,pos] of nodePositions){\n    const node = pos.node;\n    if(node.left){\n      const cPos = nodePositions.get(node.left.id);\n      const line = makeLine(pos.x,pos.y+16,cPos.x,cPos.y-16);\n      treeSVG.appendChild(line);\n      const lbl = makeText((pos.x + cPos.x)/2 - 8, (pos.y + cPos.y)/2 - 6, '0');\n      treeSVG.appendChild(lbl);\n    }\n    if(node.right){\n      const cPos = nodePositions.get(node.right.id);\n      const line = makeLine(pos.x,pos.y+16,cPos.x,cPos.y-16);\n      treeSVG.appendChild(line);\n      const lbl = makeText((pos.x + cPos.x)/2 + 6, (pos.y + cPos.y)/2 - 6, '1');\n      treeSVG.appendChild(lbl);\n    }\n  }\n\n  // draw nodes top-down\n  for(const [id,pos] of nodePositions){\n    const node = pos.node;\n    if(node.isInternal){\n      const g = makeGroupCircle(pos.x,pos.y,node.freq, '#5b8cff');\n      treeSVG.appendChild(g);\n    } else {\n      const g = makeGroupLeaf(pos.x,pos.y,node.char,node.freq);\n      treeSVG.appendChild(g);\n    }\n  }\n\n  // show codes near leaves\n  for(const [ch,code] of Object.entries(codes)){\n    // find leaf with char\n    let leafNode = null;\n    for(const [id,pos] of nodePositions){\n      if(pos.node.char === ch && !pos.node.isInternal){\n        leafNode = pos;\n        break;\n      }\n    }\n    if(leafNode){\n      const x = leafNode.x + 30;\n      const y = leafNode.y - 6;\n      const t = makeText(x,y, code, '#a7ffd8');\n      treeSVG.appendChild(t);\n    }\n  }\n\n  // adjust viewBox to fit\n  treeSVG.setAttribute('viewBox', `0 0 ${viewW} ${viewH}`);\n}\n\nfunction makeLine(x1,y1,x2,y2){\n  const line = document.createElementNS('http://www.w3.org/2000/svg','line');\n  line.setAttribute('x1', x1);\n  line.setAttribute('y1', y1);\n  line.setAttribute('x2', x2);\n  line.setAttribute('y2', y2);\n  line.setAttribute('stroke', 'rgba(255,255,255,0.06)');\n  line.setAttribute('stroke-width', '1.6');\n  return line;\n}\nfunction makeText(x,y,text,color='#dff7ee'){\n  const t = document.createElementNS('http://www.w3.org/2000/svg','text');\n  t.setAttribute('x', x);\n  t.setAttribute('y', y);\n  t.setAttribute('fill', color);\n  t.setAttribute('font-size', 13);\n  t.setAttribute('font-family', 'monospace');\n  t.textContent = text;\n  return t;\n}\nfunction makeGroupCircle(x,y,label,color){\n  const g = document.createElementNS('http://www.w3.org/2000/svg','g');\n  const circ = document.createElementNS('http://www.w3.org/2000/svg','circle');\n  circ.setAttribute('cx', x);\n  circ.setAttribute('cy', y);\n  circ.setAttribute('r', 18);\n  circ.setAttribute('fill', color);\n  circ.setAttribute('opacity', 0.95);\n  const txt = document.createElementNS('http://www.w3.org/2000/svg','text');\n  txt.setAttribute('x', x);\n  txt.setAttribute('y', y+5);\n  txt.setAttribute('text-anchor','middle');\n  txt.setAttribute('fill','#071127');\n  txt.setAttribute('font-weight','700');\n  txt.setAttribute('font-size', 13);\n  txt.setAttribute('font-family','monospace');\n  txt.textContent = label;\n  g.appendChild(circ);\n  g.appendChild(txt);\n  return g;\n}\nfunction makeGroupLeaf(x,y,ch,label){\n  const g = document.createElementNS('http://www.w3.org/2000/svg','g');\n  const rect = document.createElementNS('http://www.w3.org/2000/svg','rect');\n  rect.setAttribute('x', x-22);\n  rect.setAttribute('y', y-16);\n  rect.setAttribute('width', 44);\n  rect.setAttribute('height', 32);\n  rect.setAttribute('rx', 8);\n  rect.setAttribute('fill', 'rgba(255,255,255,0.03)');\n  rect.setAttribute('stroke', 'rgba(255,255,255,0.05)');\n  const txt1 = document.createElementNS('http://www.w3.org/2000/svg','text');\n  txt1.setAttribute('x', x-6);\n  txt1.setAttribute('y', y+5);\n  txt1.setAttribute('fill','#c5f6df');\n  txt1.setAttribute('font-size', 14);\n  txt1.setAttribute('font-family', 'monospace');\n  txt1.textContent = escapeVisible(ch);\n  const txt2 = document.createElementNS('http://www.w3.org/2000/svg','text');\n  txt2.setAttribute('x', x+10);\n  txt2.setAttribute('y', y+5);\n  txt2.setAttribute('fill','#9fb9c9');\n  txt2.setAttribute('font-size', 12);\n  txt2.setAttribute('font-family', 'monospace');\n  txt2.textContent = '[' + label + ']';\n  g.appendChild(rect);\n  g.appendChild(txt1);\n  g.appendChild(txt2);\n  return g;\n}\n\n/* Steps playback controls */\nfunction setStateFromBuild(result){\n  state.frequencies = Object.assign({}, result.initialFreq || {});\n  state.nodes = result.initialQueue || [];\n  state.steps = result.steps || [];\n  state.root = result.root || null;\n  state.codes = assignCodes(state.root);\n  state.encoded = encodeText(inputText.value, state.codes) || '';\n  state.decoded = decodeBits(state.encoded, state.root) || '';\n  state.step = 0;\n  updateUIAfterBuild();\n}\n\nfunction updateUIAfterBuild(){\n  renderFrequencies(state.frequencies);\n  // render initial queue and step info\n  stepCount.textContent = state.steps.length - 1 >= 0 ? state.steps.length - 1 : 0;\n  stepIndex.textContent = state.step;\n  if(state.steps.length > 0){\n    const snap = state.steps[state.step] && state.steps[state.step].queue ? state.steps[state.step].queue : state.steps[state.step];\n    renderQueue(snap);\n  } else {\n    renderQueue([]);\n  }\n  renderTreeSVG(state.root, state.codes);\n  renderCodes();\n  updateEncodedDecoded();\n}\n\n/* Build process that also stores initialFreq in result for UI */\nfunction buildAll(){\n  const text = inputText.value;\n  const freq = computeFrequencies(text);\n  state.frequencies = freq;\n  const result = buildHuffmanFromFreq(freq);\n  result.initialFreq = freq;\n  setStateFromBuild(result);\n}\n\n/* Render codes list */\nfunction renderCodes(){\n  codesView.innerHTML = '';\n  const entries = Object.keys(state.codes).map(ch=> ({ch, code: state.codes[ch], freq: state.frequencies[ch] || 0}));\n  entries.sort((a,b) => (b.freq - a.freq) || a.code.length - b.code.length || (a.ch > b.ch?1:-1));\n  for(const e of entries){\n    const div = document.createElement('div');\n    div.className = 'code-row';\n    div.innerHTML = `<div style=\"font-weight:700\">${escapeVisible(e.ch)}</div>\n      <div style=\"color:var(--muted);font-size:12px\">${describeChar(e.ch)}</div>\n      <div style=\"margin-top:6px; font-family:monospace\">${e.code}</div>\n      <div style=\"margin-top:6px;color:var(--muted);font-size:12px\">freq: ${e.freq}</div>`;\n    codesView.appendChild(div);\n  }\n  if(entries.length === 0){\n    codesView.innerHTML = '<div class=\"small-muted\">No codes (build a tree first)</div>';\n  }\n}\n\n/* Update encoded/decoded displays and stats */\nfunction updateEncodedDecoded(){\n  encodedView.textContent = state.encoded || '';\n  encodeBits.value = state.encoded || '';\n  decodedView.textContent = state.decoded || '';\n  // stats\n  const textLen = inputText.value.length;\n  const origBits = textLen * 8;\n  const huffBits = state.encoded.length || 0;\n  origSize.textContent = origBits + ' bits';\n  huffSize.textContent = huffBits + ' bits';\n  const compr = origBits ? Math.round((1 - (huffBits / origBits)) * 100) : 0;\n  compression.textContent = (isFinite(compr) ? compr : 0) + '%';\n}\n\n/* Controls: play, step, decode, copy, sample */\nplayBtn.addEventListener('click', ()=>{\n  if(state.playTimer){\n    stopPlay();\n  } else {\n    startPlay();\n  }\n});\nfunction startPlay(){\n  if(!state.steps || state.steps.length <= 1) return;\n  playBtn.textContent = 'Pause';\n  state.playTimer = setInterval(()=>{\n    if(state.step < state.steps.length - 1){\n      state.step++;\n      renderStep(state.step);\n    } else {\n      stopPlay();\n    }\n  }, state.playSpeed);\n}\nfunction stopPlay(){\n  playBtn.textContent = 'Play';\n  clearInterval(state.playTimer);\n  state.playTimer = null;\n}\n\nstepNext.addEventListener('click', ()=>{\n  if(!state.steps || state.steps.length <= 1) return;\n  if(state.step < state.steps.length - 1){\n    state.step++;\n    renderStep(state.step);\n  }\n});\nstepPrev.addEventListener('click', ()=>{\n  if(!state.steps || state.steps.length <= 1) return;\n  if(state.step > 0){\n    state.step--;\n    renderStep(state.step);\n  }\n});\nresetStep.addEventListener('click', ()=>{\n  state.step = 0;\n  renderStep(state.step);\n});\n\nfunction renderStep(idx){\n  stepIndex.textContent = idx;\n  const s = state.steps[idx];\n  const snap = s && s.queue ? s.queue : s;\n  renderQueue(snap);\n  // small highlight of merged nodes if available\n  if(s && s.merged){\n    // show an annotation in the queue (we'll just reflect by appending info line)\n    const info = document.createElement('div');\n    info.className = 'small-muted';\n    info.style.marginTop = '6px';\n    info.textContent = `Merged nodes ${s.merged.aId} + ${s.merged.bId} -> ${s.merged.parentId}`;\n    queueView.appendChild(info);\n  }\n  // only render final tree when at last step\n  if(idx === state.steps.length - 1){\n    renderTreeSVG(state.root, state.codes);\n  } else {\n    // render partial tree? For simplicity show final tree always but we can fade\n    renderTreeSVG(state.root, state.codes);\n  }\n}\n\n/* decode button - decode bits in encodeBits input */\ndecodeBtn.addEventListener('click', ()=>{\n  const bits = encodeBits.value.trim();\n  if(!state.root){\n    alert('Build a Huffman tree first.');\n    return;\n  }\n  const dec = decodeBits(bits, state.root);\n  if(dec === null){\n    alert('Invalid or incomplete bit string for the current Huffman tree.');\n    return;\n  }\n  decodedView.textContent = dec;\n});\n\ncopyBits.addEventListener('click', ()=>{\n  const bits = encodeBits.value;\n  if(!bits) return;\n  navigator.clipboard && navigator.clipboard.writeText(bits).then(()=> {\n    copyBits.textContent = 'Copied';\n    setTimeout(()=> copyBits.textContent = 'Copy Bits', 800);\n  });\n});\n\nshowDecoded.addEventListener('click', ()=>{\n  if(!state.encoded){\n    alert('No encoded bits available (build first).');\n    return;\n  }\n  const dec = decodeBits(state.encoded, state.root);\n  if(dec === null){\n    decodedView.textContent = 'Decoding failed';\n  } else {\n    decodedView.textContent = dec;\n  }\n});\n\n/* Build button and helpers */\nbuildBtn.addEventListener('click', ()=>{\n  buildAll();\n  stopPlay();\n});\nrandomBtn.addEventListener('click', ()=>{\n  inputText.value = sampleTexts[Math.floor(Math.random()*sampleTexts.length)];\n});\nclearBtn.addEventListener('click', ()=>{\n  inputText.value = '';\n  freqList.innerHTML = '';\n  queueView.innerHTML = '';\n  codesView.innerHTML = '';\n  encodedView.textContent = '';\n  decodedView.textContent = '';\n  treeSVG.innerHTML = '';\n  origSize.textContent = '0 bits';\n  huffSize.textContent = '0 bits';\n  compression.textContent = '0%';\n  state = { frequencies: {}, nodes: [], steps: [], root: null, codes: {}, encoded: '', decoded: '', playTimer: null, playSpeed:800, step: 0};\n  stepIndex.textContent = '0';\n  stepCount.textContent = '0';\n});\n\n/* When filters change, re-render frequencies */\nminFreq.addEventListener('input', ()=> renderFrequencies(state.frequencies));\ntopK.addEventListener('input', ()=> renderFrequencies(state.frequencies));\n\n/* On load, build initial sample */\n(function init(){\n  // build initial\n  buildAll();\n  // keep stepCount updated\n  stepCount.textContent = state.steps.length - 1 >= 0 ? state.steps.length - 1 : 0;\n})();\n\n/* Extend build function to set initialFreq and other state fields */\nfunction buildHuffmanFromFreqWithState(freqMap){\n  const ret = buildHuffmanFromFreq(freqMap);\n  ret.initialFreq = freqMap;\n  return ret;\n}\n\n/* Replace earlier build usage with one that sets state properly */\nfunction buildAll(){\n  const text = inputText.value;\n  const freq = computeFrequencies(text);\n  state.frequencies = freq;\n  const result = buildHuffmanFromFreq(freq);\n  result.initialFreq = freq;\n  // set internal state\n  state.nodes = result.initialQueue || [];\n  state.root = result.root || null;\n  state.steps = result.steps || [];\n  state.codes = assignCodes(state.root);\n  state.encoded = encodeText(text, state.codes) || '';\n  state.decoded = decodeBits(state.encoded, state.root) || '';\n  state.step = 0;\n  stepCount.textContent = state.steps.length - 1 >= 0 ? state.steps.length - 1 : 0;\n  updateUIAfterBuild();\n}\n\n/* Small helper to expose tree structure in console for debugging (disabled in production) */\nfunction debugDump(){\n  console.log('freq', state.frequencies);\n  console.log('codes', state.codes);\n  console.log('root', state.root);\n}\n\n/* Keyboard shortcuts for playing and stepping */\ndocument.addEventListener('keydown', (e)=>{\n  if(e.key === ' ') { e.preventDefault(); playBtn.click(); }\n  if(e.key === 'ArrowRight') stepNext.click();\n  if(e.key === 'ArrowLeft') stepPrev.click();\n});\n</script>\n</body>\n</html>"
  },
  "messages": [
    {
      "role": "system",
      "content": "Generate a single HTML file with JavaScript demonstrating the user-given concept. Only respond in a single HTML file."
    },
    {
      "role": "user",
      "content": "Huffman Coding"
    }
  ],
  "topic": "Huffman Coding",
  "hasFSM": false,
  "hasTest": true
}