{
  "id": "be87b193-cd35-11f0-9e7b-93b903303299",
  "timestamp": "2025-11-29T15:13:50.358Z",
  "type": "html-to-test",
  "htmlModel": "gpt-5-mini",
  "playwrightModel": "gpt-5-mini",
  "status": "success",
  "question": "Floyd-Warshall Algorithm",
  "answer": {
    "role": "assistant",
    "content": "<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\"/>\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\"/>\n<title>Floyd–Warshall Algorithm Visualizer</title>\n<style>\n  :root{\n    --bg:#fafafa;\n    --panel:#ffffff;\n    --muted:#666;\n    --accent:#2b7cff;\n    --danger:#d9534f;\n    --good:#28a745;\n    --grid:#e9eef9;\n    --cell-w:70px;\n  }\n  html,body{height:100%; margin:0; font-family:Inter,Segoe UI,Roboto,system-ui,-apple-system, \"Helvetica Neue\", Arial; background:var(--bg); color:#111}\n  header{padding:18px 24px; display:flex; gap:12px; align-items:center; border-bottom:1px solid #eef2f7; background:linear-gradient(180deg,#fff, #fbfdff); position:sticky; top:0; z-index:10}\n  header h1{font-size:18px; margin:0}\n  .container{display:flex; gap:18px; padding:18px; align-items:flex-start; max-width:1200px; margin:0 auto}\n  .left, .right{background:var(--panel); padding:14px; border-radius:10px; box-shadow:0 6px 20px rgba(28,40,60,0.05)}\n  .left{flex:1; min-width:420px}\n  .right{width:420px}\n  label{display:block; font-size:13px; color:var(--muted); margin-bottom:6px}\n  .controls{display:flex; gap:8px; flex-wrap:wrap; align-items:center}\n  input[type=\"number\"], input[type=\"text\"], select{padding:6px 8px; border-radius:6px; border:1px solid #e1e7f3; background:#fff; font-size:13px}\n  button{background:var(--accent); color:#fff; border:0; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:600}\n  button.ghost{background:transparent; color:var(--accent); border:1px solid #dbe9ff}\n  button.warn{background:var(--danger)}\n  button.small{padding:6px 8px; font-size:13px}\n  .row{display:flex; gap:12px; align-items:center; margin-bottom:12px}\n  .matrix-wrap{overflow:auto; background:linear-gradient(180deg,#fff, #fcfdff); padding:10px; border-radius:8px; border:1px solid #f1f5fb}\n  table.matrix{border-collapse:collapse; font-family:monospace; font-size:13px}\n  table.matrix th, table.matrix td{border:1px solid var(--grid); width:var(--cell-w); height:36px; text-align:center; padding:4px}\n  table.matrix th{background:#f6f9ff; color:var(--muted); font-weight:700}\n  td.inf{color:#c3c8d9}\n  td.updated{background:linear-gradient(90deg,#fffbeb,#fff1b8)}\n  td.self-neg{background:linear-gradient(90deg,#ffe7e7,#ffd1d1); color:var(--danger); font-weight:700}\n  .log{height:160px; overflow:auto; background:#081126; color:#9fe0ff; padding:10px; border-radius:6px; font-family:monospace; font-size:13px}\n  .small-muted{font-size:13px; color:var(--muted)}\n  .flex-col{display:flex; flex-direction:column}\n  .status{margin-top:8px; font-weight:700}\n  .play-controls{display:flex; gap:8px; align-items:center}\n  .path-result{padding:8px; background:#f6fbff; border-radius:6px; border:1px solid #e7f2ff; margin-top:8px}\n  .explain{font-size:13px; color:var(--muted); line-height:1.4}\n  .legend{display:flex; gap:8px; margin-top:8px; align-items:center; flex-wrap:wrap}\n  .chip{padding:6px 8px; border-radius:6px; background:#fff; border:1px solid #eef4ff; font-size:13px}\n  .matrix-head{display:flex; gap:12px; align-items:center; margin-bottom:8px}\n  .small{font-size:12px; color:var(--muted)}\n  input[type=\"range\"]{width:140px}\n  .footer{font-size:12px; color:var(--muted); margin-top:12px}\n</style>\n</head>\n<body>\n<header>\n  <h1>Floyd–Warshall Algorithm Visualizer</h1>\n  <div style=\"flex:1\"></div>\n  <div class=\"small-muted\">All in-browser demo • Supports negative weights • Detects negative cycles</div>\n</header>\n\n<div class=\"container\">\n  <div class=\"left\">\n    <div style=\"display:flex; justify-content:space-between; align-items:center; margin-bottom:12px\">\n      <div>\n        <label class=\"small-muted\">Number of nodes</label>\n        <div class=\"row\">\n          <input id=\"nodeCount\" type=\"number\" min=\"1\" max=\"12\" value=\"5\" style=\"width:72px\"/>\n          <button id=\"makeNodes\" class=\"small\">Make matrix</button>\n          <button id=\"randomGraph\" class=\"ghost small\">Random graph</button>\n          <button id=\"clearGraph\" class=\"ghost small\">Clear (INF)</button>\n        </div>\n      </div>\n      <div style=\"text-align:right\">\n        <label class=\"small-muted\">Play speed</label>\n        <div class=\"row\">\n          <input id=\"speedRange\" type=\"range\" min=\"200\" max=\"1500\" value=\"700\"/>\n          <div id=\"speedLabel\" class=\"small-muted\">700 ms/step</div>\n        </div>\n      </div>\n    </div>\n\n    <div>\n      <div class=\"matrix-head\">\n        <div style=\"flex:1\">\n          <label class=\"small-muted\">Adjacency matrix (enter numbers or INF)</label>\n        </div>\n        <div style=\"text-align:right\">\n          <div class=\"small-muted\">Interpretation: cell [i][j] = weight from i→j. INF = no direct edge.</div>\n        </div>\n      </div>\n\n      <div id=\"adjWrap\" class=\"matrix-wrap\" style=\"margin-bottom:12px\"></div>\n\n      <div class=\"row\">\n        <button id=\"initBtn\">Initialize (create dist & next)</button>\n        <button id=\"stepBtn\" class=\"ghost small\">Step</button>\n        <button id=\"playBtn\" class=\"ghost small\">Play</button>\n        <button id=\"fastRun\" class=\"small\">Run to End</button>\n        <button id=\"resetBtn\" class=\"ghost small\">Reset</button>\n        <button id=\"exportBtn\" class=\"ghost small\">Export matrix</button>\n      </div>\n\n      <div style=\"display:flex; gap:12px; margin-top:12px\">\n        <div style=\"flex:1\">\n          <label class=\"small-muted\">Current k (intermediate node)</label>\n          <div id=\"kLabel\" style=\"font-weight:700; font-size:16px\">k = -</div>\n        </div>\n        <div style=\"width:220px\">\n          <label class=\"small-muted\">Log</label>\n          <div id=\"log\" class=\"log\"></div>\n        </div>\n      </div>\n\n      <div style=\"display:flex; gap:12px; margin-top:12px\">\n        <div style=\"flex:1\">\n          <label class=\"small-muted\">Distance matrix (dist)</label>\n          <div id=\"distWrap\" class=\"matrix-wrap\"></div>\n        </div>\n        <div style=\"width:220px\">\n          <label class=\"small-muted\">Next matrix (for path reconstruction)</label>\n          <div id=\"nextWrap\" class=\"matrix-wrap\"></div>\n        </div>\n      </div>\n\n      <div class=\"row\" style=\"margin-top:12px\">\n        <div>\n          <label class=\"small-muted\">From</label>\n          <input id=\"fromNode\" type=\"number\" min=\"0\" value=\"0\" style=\"width:64px\"/>\n        </div>\n        <div>\n          <label class=\"small-muted\">To</label>\n          <input id=\"toNode\" type=\"number\" min=\"0\" value=\"1\" style=\"width:64px\"/>\n        </div>\n        <div style=\"align-self:flex-end\">\n          <button id=\"pathBtn\" class=\"small\">Reconstruct path</button>\n        </div>\n        <div style=\"flex:1\"></div>\n        <div class=\"small-muted\">After initialization and at least partial run.</div>\n      </div>\n\n      <div id=\"pathResult\" class=\"path-result\" style=\"display:none\"></div>\n\n      <div class=\"legend\">\n        <div class=\"chip\">INF = no path</div>\n        <div class=\"chip\">Updated cells highlighted</div>\n        <div class=\"chip\" style=\"border-color:var(--danger)\">dist[i][i] &lt; 0 → negative cycle</div>\n      </div>\n\n      <div class=\"footer\">\n        Floyd–Warshall finds all-pairs shortest paths in a weighted directed graph (works with negative edge weights; negative cycles make distances undefined).\n      </div>\n    </div>\n  </div>\n\n  <div class=\"right\">\n    <div style=\"display:flex; justify-content:space-between; align-items:center\">\n      <div>\n        <label class=\"small-muted\">Summary & explanation</label>\n        <div style=\"font-weight:700; margin-top:6px\">Floyd–Warshall</div>\n      </div>\n      <div style=\"text-align:right\">\n        <div class=\"small-muted\">Complexity</div>\n        <div style=\"font-weight:700; margin-top:6px\">Time: O(n^3) • Space: O(n^2)</div>\n      </div>\n    </div>\n\n    <div style=\"margin-top:12px\" class=\"explain\">\n      <p><strong>What it does</strong>: For every pair of nodes (i,j), the algorithm computes the shortest path distance using any intermediate vertices from a set {0..k}. It iteratively expands this set from k=0 to n-1. The key recurrence:\n      dist[i][j] = min(dist[i][j], dist[i][k] + dist[k][j])</p>\n\n      <p><strong>Path reconstruction</strong>: We maintain a helper matrix Next[i][j] which points to the next vertex after i on a shortest path to j. After updates, Next[i][j] ← Next[i][k] when using k improves dist[i][j]. Reconstruct path by repeatedly following Next[u][v].</p>\n\n      <p><strong>Negative cycles</strong>: If after the algorithm any dist[i][i] < 0, node i is part of or reachable through a negative cycle; shortest paths are then undefined in general.</p>\n\n      <hr/>\n\n      <div style=\"margin-top:8px; display:flex; gap:8px; align-items:center\">\n        <button id=\"sampleBtn\" class=\"small\">Load sample with negative edge</button>\n        <button id=\"sample2Btn\" class=\"small ghost\">Load sample (no negatives)</button>\n      </div>\n\n      <div style=\"margin-top:12px\">\n        <div class=\"small-muted\">Tips</div>\n        <ul style=\"margin:6px 0 0 18px; color:var(--muted); font-size:13px\">\n          <li>Use INF to indicate no direct edge.</li>\n          <li>Try random graphs to see how intermediate k introduces new shorter routes.</li>\n          <li>Reconstruct paths after running to inspect concrete routes.</li>\n        </ul>\n      </div>\n    </div>\n  </div>\n</div>\n\n<script>\n(function(){\n  // Utility\n  const INF = Number.POSITIVE_INFINITY;\n\n  // State\n  let n = 5;\n  let adj = []; // strings from editor -> parsed to numbers or INF\n  let dist = null;\n  let nextMat = null;\n  let k = -1; // current intermediate node in [0..n-1], -1 before start\n  let playing = false;\n  let playTimer = null;\n\n  // DOM\n  const adjWrap = document.getElementById('adjWrap');\n  const distWrap = document.getElementById('distWrap');\n  const nextWrap = document.getElementById('nextWrap');\n  const nodeCount = document.getElementById('nodeCount');\n  const makeNodes = document.getElementById('makeNodes');\n  const randomGraph = document.getElementById('randomGraph');\n  const clearGraph = document.getElementById('clearGraph');\n  const initBtn = document.getElementById('initBtn');\n  const stepBtn = document.getElementById('stepBtn');\n  const playBtn = document.getElementById('playBtn');\n  const fastRun = document.getElementById('fastRun');\n  const resetBtn = document.getElementById('resetBtn');\n  const logEl = document.getElementById('log');\n  const kLabel = document.getElementById('kLabel');\n  const pathBtn = document.getElementById('pathBtn');\n  const pathResult = document.getElementById('pathResult');\n  const fromNode = document.getElementById('fromNode');\n  const toNode = document.getElementById('toNode');\n  const speedRange = document.getElementById('speedRange');\n  const speedLabel = document.getElementById('speedLabel');\n  const exportBtn = document.getElementById('exportBtn');\n  const sampleBtn = document.getElementById('sampleBtn');\n  const sample2Btn = document.getElementById('sample2Btn');\n  const adjInputs = []; // 2D array of inputs\n\n  // Initialize UI\n  nodeCount.addEventListener('change', ()=> {\n    let val = parseInt(nodeCount.value) || 1;\n    val = Math.max(1, Math.min(12, val));\n    nodeCount.value = val;\n  });\n\n  makeNodes.addEventListener('click', ()=> {\n    n = parseInt(nodeCount.value) || 1;\n    makeMatrix(n);\n  });\n\n  speedRange.addEventListener('input', ()=> {\n    speedLabel.textContent = speedRange.value + ' ms/step';\n  });\n\n  randomGraph.addEventListener('click', ()=> {\n    createRandomGraph();\n  });\n\n  clearGraph.addEventListener('click', ()=> {\n    for(let i=0;i<n;i++){\n      for(let j=0;j<n;j++){\n        setAdjValue(i,j, i===j ? \"0\" : \"INF\");\n      }\n    }\n  });\n\n  initBtn.addEventListener('click', ()=> {\n    if(!readAdjMatrix()) return;\n    initializeFW();\n  });\n\n  stepBtn.addEventListener('click', ()=> {\n    step();\n  });\n\n  playBtn.addEventListener('click', ()=> {\n    if(playing){ stopPlaying(); } else { startPlaying(); }\n  });\n\n  fastRun.addEventListener('click', ()=> {\n    if(!dist) {\n      if(!readAdjMatrix()) return;\n      initializeFW();\n    }\n    runToEnd();\n  });\n\n  resetBtn.addEventListener('click', ()=> {\n    stopPlaying();\n    dist = null; nextMat = null; k = -1;\n    renderDistNext();\n    kLabel.textContent = 'k = -';\n    log('Reset.');\n    pathResult.style.display='none';\n  });\n\n  pathBtn.addEventListener('click', ()=> {\n    const u = parseInt(fromNode.value);\n    const v = parseInt(toNode.value);\n    if(!dist || !nextMat){\n      alert('Initialize and run at least partially (click Init) before reconstructing paths.');\n      return;\n    }\n    if(Number.isNaN(u) || Number.isNaN(v) || u<0 || v<0 || u>=n || v>=n){\n      alert('Invalid node indices.');\n      return;\n    }\n    const res = reconstructPath(u,v);\n    pathResult.style.display='block';\n    if(!res) {\n      pathResult.innerHTML = '<strong>No path</strong> from '+u+' → '+v;\n    } else {\n      const pathStr = res.path.join(' → ');\n      pathResult.innerHTML = '<strong>Path:</strong> ' + pathStr + '<br><strong>Distance:</strong> ' + (Number.isFinite(res.dist) ? res.dist : 'INF');\n    }\n  });\n\n  exportBtn.addEventListener('click', ()=> {\n    if(!readAdjMatrix()) return;\n    const rows = adj.map(r=> r.join(',')).join('\\n');\n    const blob = new Blob([rows], {type:'text/plain'});\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url; a.download = 'adjacency.csv'; document.body.appendChild(a); a.click();\n    a.remove(); URL.revokeObjectURL(url);\n  });\n\n  sampleBtn.addEventListener('click', ()=> {\n    // sample with a negative edge but no negative cycle\n    n = 4; nodeCount.value = n; makeMatrix(n);\n    setAdjValue(0,0,'0'); setAdjValue(0,1,'3'); setAdjValue(0,2,'INF'); setAdjValue(0,3,'7');\n    setAdjValue(1,0,'8'); setAdjValue(1,1,'0'); setAdjValue(1,2,'2'); setAdjValue(1,3,'INF');\n    setAdjValue(2,0,'5'); setAdjValue(2,1,'INF'); setAdjValue(2,2,'0'); setAdjValue(2,3,'1');\n    setAdjValue(3,0,'2'); setAdjValue(3,1,'INF'); setAdjValue(3,2,'INF'); setAdjValue(3,3,'0');\n    // Introduce a negative edge 3->1 = -4 (but no negative cycle)\n    setAdjValue(3,1,'-4');\n  });\n\n  sample2Btn.addEventListener('click', ()=> {\n    // sample without negatives\n    n = 5; nodeCount.value = n; makeMatrix(n);\n    for(let i=0;i<n;i++) for(let j=0;j<n;j++) setAdjValue(i,j, i===j ? '0' : 'INF');\n    setAdjValue(0,1,'6'); setAdjValue(0,3,'7');\n    setAdjValue(1,2,'5'); setAdjValue(1,3,'8'); setAdjValue(1,4,'-4');\n    setAdjValue(2,1,'-2');\n    setAdjValue(3,2,'-3'); setAdjValue(3,4,'9');\n    setAdjValue(4,0,'2'); setAdjValue(4,2,'7');\n  });\n\n  // Helpers\n  function makeMatrix(size){\n    stopPlaying();\n    n = size;\n    adj = [];\n    adjInputs.length = 0;\n    adjWrap.innerHTML = '';\n    for(let i=0;i<n;i++){\n      adj[i]=[];\n      const rowDiv = document.createElement('div');\n      rowDiv.style.display='flex';\n      rowDiv.style.gap='6px';\n      rowDiv.style.alignItems='center';\n      rowDiv.style.marginBottom='6px';\n      const label = document.createElement('div');\n      label.style.width='28px';\n      label.style.fontSize='12px';\n      label.style.color='var(--muted)';\n      label.textContent = i;\n      rowDiv.appendChild(label);\n      adjInputs[i]=[];\n      for(let j=0;j<n;j++){\n        const inp = document.createElement('input');\n        inp.type='text';\n        inp.value = (i===j) ? '0' : 'INF';\n        inp.style.width = '64px';\n        inp.addEventListener('change', ()=> {\n          // no immediate parse\n        });\n        adjInputs[i][j]=inp;\n        rowDiv.appendChild(inp);\n      }\n      adjWrap.appendChild(rowDiv);\n    }\n    // labels for columns\n    const colLabels = document.createElement('div');\n    colLabels.style.display='flex';\n    colLabels.style.gap='6px';\n    colLabels.style.alignItems='center';\n    colLabels.style.marginTop='6px';\n    const empty = document.createElement('div'); empty.style.width='28px';\n    colLabels.appendChild(empty);\n    for(let j=0;j<n;j++){\n      const c = document.createElement('div');\n      c.style.width='64px';\n      c.style.textAlign='center';\n      c.style.fontSize='12px';\n      c.style.color='var(--muted)';\n      c.textContent = j;\n      colLabels.appendChild(c);\n    }\n    adjWrap.insertBefore(colLabels, adjWrap.firstChild);\n    // reset algorithm state\n    dist = null; nextMat = null; k = -1;\n    renderDistNext();\n    kLabel.textContent = 'k = -';\n    log('Created ' + n + '×' + n + ' adjacency editor.');\n  }\n\n  function setAdjValue(i,j,val){\n    if(!adjInputs[i] || !adjInputs[i][j]) return;\n    adjInputs[i][j].value = String(val);\n  }\n\n  function createRandomGraph(){\n    stopPlaying();\n    // generate random sparse graph with some negative weights possible\n    for(let i=0;i<n;i++){\n      for(let j=0;j<n;j++){\n        if(i===j){ setAdjValue(i,j,'0'); continue; }\n        const p = Math.random();\n        if(p<0.45){\n          // no edge\n          setAdjValue(i,j,'INF');\n        } else {\n          // weight between -5 and 12\n          const val = Math.floor(Math.random()*18)-5;\n          setAdjValue(i,j,String(val));\n        }\n      }\n    }\n    log('Random graph generated.');\n  }\n\n  function readAdjMatrix(){\n    // parse inputs into adj[][] as numbers or INF\n    const newAdj = [];\n    for(let i=0;i<n;i++){\n      newAdj[i]=[];\n      for(let j=0;j<n;j++){\n        const raw = adjInputs[i][j].value.trim();\n        if(raw === '' || raw.toUpperCase() === 'INF' || raw.toUpperCase() === 'INFINITY' || raw === '∞'){\n          newAdj[i][j] = INF;\n        } else {\n          const num = Number(raw);\n          if(Number.isFinite(num)){\n            newAdj[i][j] = num;\n          } else {\n            alert('Invalid value at ['+i+']['+j+']: ' + raw);\n            return false;\n          }\n        }\n      }\n    }\n    adj = newAdj;\n    return true;\n  }\n\n  function initializeFW(){\n    // dist = copy of adj, nextMat init\n    dist = [];\n    nextMat = [];\n    for(let i=0;i<n;i++){\n      dist[i]=[];\n      nextMat[i]=[];\n      for(let j=0;j<n;j++){\n        dist[i][j] = adj[i][j];\n        if(Number.isFinite(adj[i][j])){\n          nextMat[i][j] = j;\n        } else {\n          nextMat[i][j] = null;\n        }\n      }\n    }\n    k = -1;\n    renderDistNext();\n    kLabel.textContent = 'k = -';\n    log('Initialized Floyd–Warshall.');\n    pathResult.style.display='none';\n    checkNegativeDiagonals();\n  }\n\n  function renderDistNext(highlight){\n    // highlight is optional object {i,j} to mark updated cell\n    distWrap.innerHTML = '';\n    nextWrap.innerHTML = '';\n    if(!dist){\n      distWrap.innerHTML = '<div class=\"small-muted\" style=\"padding:8px\">Distance matrix not initialized.</div>';\n      nextWrap.innerHTML = '<div class=\"small-muted\" style=\"padding:8px\">Next matrix not initialized.</div>';\n      return;\n    }\n    // dist table\n    const distTable = document.createElement('table'); distTable.className='matrix';\n    const thead = document.createElement('thead');\n    const trh = document.createElement('tr');\n    const empty = document.createElement('th'); empty.textContent=''; trh.appendChild(empty);\n    for(let j=0;j<n;j++){ const th=document.createElement('th'); th.textContent=j; trh.appendChild(th); }\n    thead.appendChild(trh); distTable.appendChild(thead);\n    const tbody = document.createElement('tbody');\n    for(let i=0;i<n;i++){\n      const tr=document.createElement('tr');\n      const th=document.createElement('th'); th.textContent=i; tr.appendChild(th);\n      for(let j=0;j<n;j++){\n        const td=document.createElement('td');\n        const val = dist[i][j];\n        td.textContent = Number.isFinite(val) ? String(val) : 'INF';\n        if(!Number.isFinite(val)) td.classList.add('inf');\n        if(highlight && highlight.i===i && highlight.j===j) td.classList.add('updated');\n        if(i===j && Number.isFinite(val) && val<0) td.classList.add('self-neg');\n        tr.appendChild(td);\n      }\n      tbody.appendChild(tr);\n    }\n    distTable.appendChild(tbody);\n    distWrap.appendChild(distTable);\n\n    // next table\n    const nextTable = document.createElement('table'); nextTable.className='matrix';\n    const thead2 = document.createElement('thead');\n    const trh2 = document.createElement('tr');\n    const empty2 = document.createElement('th'); empty2.textContent=''; trh2.appendChild(empty2);\n    for(let j=0;j<n;j++){ const th=document.createElement('th'); th.textContent=j; trh2.appendChild(th); }\n    thead2.appendChild(trh2); nextTable.appendChild(thead2);\n    const tbody2 = document.createElement('tbody');\n    for(let i=0;i<n;i++){\n      const tr=document.createElement('tr');\n      const th=document.createElement('th'); th.textContent=i; tr.appendChild(th);\n      for(let j=0;j<n;j++){\n        const td=document.createElement('td');\n        const v = nextMat[i][j];\n        td.textContent = (v===null || v===undefined) ? '-' : String(v);\n        tr.appendChild(td);\n      }\n      tbody2.appendChild(tr);\n    }\n    nextTable.appendChild(tbody2);\n    nextWrap.appendChild(nextTable);\n  }\n\n  function log(msg){\n    const t = new Date().toLocaleTimeString();\n    logEl.textContent = `[${t}] ${msg}\\n` + logEl.textContent;\n  }\n\n  // Step-by-step Floyd–Warshall: we iterate k from 0..n-1; for each k we loop i,j.\n  // We'll maintain indices iIter and jIter to continue where left off.\n  let iIter = 0, jIter = 0;\n\n  function step(){\n    if(!dist){\n      if(!readAdjMatrix()) return;\n      initializeFW();\n      // prepare to start with k=0\n      iIter = 0; jIter = 0; k = -1;\n    }\n    // if completed\n    if(k>=n-1 && iIter>=n){\n      log('Algorithm already finished.');\n      return;\n    }\n    // Begin new k if needed\n    if(jIter===0 && iIter===0){\n      k++;\n      if(k>=n){\n        // done\n        log('Completed all k.');\n        kLabel.textContent = 'k = done';\n        renderDistNext();\n        checkNegativeDiagonals();\n        return;\n      }\n      kLabel.textContent = 'k = ' + k;\n      log('Using intermediate node k=' + k);\n    }\n    // perform a single cell check/update for (iIter, jIter)\n    const i = iIter, j = jIter;\n    const old = dist[i][j];\n    const via = (Number.isFinite(dist[i][k]) && Number.isFinite(dist[k][j])) ? dist[i][k] + dist[k][j] : INF;\n    if(via < old){\n      dist[i][j] = via;\n      nextMat[i][j] = nextMat[i][k]; // follow i->k then k->j\n      log(`Updated dist[${i}][${j}] = ${via} via k=${k} (was ${old===INF?'INF':old})`);\n      renderDistNext({i,j});\n    } else {\n      // render without highlight but update UI for current k\n      renderDistNext();\n    }\n    // advance indices\n    jIter++;\n    if(jIter>=n){ jIter=0; iIter++; }\n    if(iIter>=n){\n      // finished all i,j for this k; reset indices to start next k\n      iIter=0; jIter=0;\n      // after finishing a k, check for negative cycles (intermediate detection)\n      checkNegativeDiagonals();\n    }\n  }\n\n  function runToEnd(){\n    // run all remaining steps quickly (but still update UI)\n    while(true){\n      if(!dist){ if(!readAdjMatrix()) return; initializeFW(); }\n      if(k>=n-1 && iIter>=n) break;\n      step();\n    }\n    log('Run to end finished.');\n  }\n\n  function startPlaying(){\n    if(!dist){ if(!readAdjMatrix()) return; initializeFW(); }\n    playing = true;\n    playBtn.textContent = 'Stop';\n    const ms = parseInt(speedRange.value) || 700;\n    playTimer = setInterval(()=>{\n      // if finished stop\n      if(k>=n-1 && iIter>=n){\n        stopPlaying();\n        log('Play finished.');\n        return;\n      }\n      step();\n    }, ms);\n    log('Started playing (auto-step).');\n  }\n\n  function stopPlaying(){\n    playing = false;\n    playBtn.textContent = 'Play';\n    if(playTimer){ clearInterval(playTimer); playTimer = null; }\n  }\n\n  function checkNegativeDiagonals(){\n    if(!dist) return;\n    let found=false;\n    for(let i=0;i<n;i++){\n      if(Number.isFinite(dist[i][i]) && dist[i][i] < 0){\n        log('Negative cycle detected involving node '+i);\n        found = true;\n        // highlight is done in renderDistNext via self-neg class\n      }\n    }\n    if(found){\n      // render to ensure highlighting\n      renderDistNext();\n    }\n  }\n\n  function reconstructPath(u,v){\n    if(!nextMat) return null;\n    if(nextMat[u][v] === null) return null;\n    const path = [u];\n    let cur = u;\n    const visited = new Set([u]);\n    while(cur !== v){\n      cur = nextMat[cur][v];\n      if(cur === null || cur === undefined) return null;\n      if(visited.has(cur)){\n        // loop detection (happens if negative cycles cause weird next pointers)\n        log('Path reconstruction loop detected; aborting.');\n        return null;\n      }\n      path.push(cur);\n      visited.add(cur);\n    }\n    return {path, dist: dist[u][v]};\n  }\n\n  // initial setup\n  makeMatrix(n);\n  log('Welcome! Edit adjacency matrix, then click Initialize. Use Step / Play to run the algorithm.');\n\n  // Ensure step button is enabled/disabled based on initialization\n  // expose console shortcuts for advanced users\n  window.__fw = {\n    getDist: ()=>dist,\n    getNext: ()=>nextMat\n  };\n})();\n</script>\n</body>\n</html>"
  },
  "messages": [
    {
      "role": "system",
      "content": "Generate a single HTML file with JavaScript demonstrating the user-given concept. Only respond in a single HTML file."
    },
    {
      "role": "user",
      "content": "Floyd-Warshall Algorithm"
    }
  ],
  "topic": "Floyd-Warshall Algorithm",
  "hasFSM": false,
  "hasTest": true
}