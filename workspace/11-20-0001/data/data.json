[
  {
    "id": "26f02930-c61d-11f0-a276-311b8963a899",
    "timestamp": "2025-11-20T14:33:09.323Z",
    "model": "gpt-5-mini",
    "status": "success",
    "question": "创建冒泡排序可视化",
    "answer": {
      "role": "assistant",
      "content": "<html lang=\"zh-CN\">\n<head>\n  <meta charset=\"utf-8\" />\n  <title>冒泡排序可视化</title>\n  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n  <style>\n    :root{\n      --bg:#0f1724;\n      --panel:#0b1220;\n      --accent:#06b6d4;\n      --muted:#94a3b8;\n      --bar:#60a5fa;\n      --compare:#f59e0b;\n      --swap:#ef4444;\n      --sorted:#10b981;\n      --text:#e6eef8;\n    }\n    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,\"Segoe UI\",Roboto,\"Helvetica Neue\",Arial;}\n    body{\n      margin:0;\n      background:linear-gradient(180deg,var(--bg),#071022);\n      color:var(--text);\n      min-height:100vh;\n      display:flex;\n      align-items:flex-start;\n      justify-content:center;\n      padding:24px;\n      gap:20px;\n    }\n\n    .container{\n      width:100%;\n      max-width:1100px;\n      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.015));\n      border:1px solid rgba(255,255,255,0.03);\n      border-radius:12px;\n      padding:18px;\n      box-shadow:0 10px 30px rgba(2,6,23,0.6);\n    }\n\n    header{\n      display:flex;\n      justify-content:space-between;\n      align-items:center;\n      gap:12px;\n      margin-bottom:14px;\n    }\n    header h1{\n      margin:0;\n      font-size:18px;\n      letter-spacing:0.2px;\n    }\n    .controls{\n      display:flex;\n      gap:10px;\n      align-items:center;\n      flex-wrap:wrap;\n    }\n    .control{\n      background:var(--panel);\n      padding:8px;\n      border-radius:8px;\n      display:flex;\n      gap:8px;\n      align-items:center;\n      border:1px solid rgba(255,255,255,0.02);\n    }\n    label{font-size:12px;color:var(--muted);margin-right:6px;}\n    input[type=\"range\"]{width:150px;}\n    button{\n      background:linear-gradient(180deg,var(--accent),#0891b2);\n      color:#032026;\n      border:none;\n      padding:8px 12px;\n      border-radius:8px;\n      cursor:pointer;\n      font-weight:600;\n    }\n    button.ghost{\n      background:transparent;\n      border:1px solid rgba(255,255,255,0.05);\n      color:var(--text);\n      font-weight:500;\n      padding:6px 10px;\n    }\n    button:disabled{opacity:0.5;cursor:not-allowed;}\n    main{\n      display:flex;\n      gap:16px;\n      align-items:flex-start;\n    }\n\n    /* Visualization area */\n    .viz{\n      flex:1 1 580px;\n      min-height:320px;\n      background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));\n      border-radius:10px;\n      padding:12px;\n      display:flex;\n      flex-direction:column;\n      gap:10px;\n    }\n    .canvas{\n      flex:1;\n      display:flex;\n      align-items:flex-end;\n      gap:6px;\n      padding:10px;\n      border-radius:8px;\n      background:linear-gradient(180deg, rgba(255,255,255,0.005), rgba(255,255,255,0.002));\n      overflow:hidden;\n      min-height:260px;\n    }\n    .bar{\n      background:var(--bar);\n      height:60%;\n      border-radius:6px 6px 4px 4px;\n      flex:1 0 20px;\n      display:flex;\n      align-items:flex-end;\n      justify-content:center;\n      color:rgba(0,0,0,0.5);\n      font-weight:700;\n      transition:height 250ms ease, transform 250ms ease, background 180ms;\n      position:relative;\n    }\n    .bar span{\n      transform:translateY(6px);\n      font-size:11px;\n      color:rgba(255,255,255,0.9);\n      text-shadow:0 1px 0 rgba(0,0,0,0.4);\n      padding-bottom:6px;\n    }\n    .bar.compare{background:var(--compare); transform:scale(1.05);}\n    .bar.swap{background:var(--swap); transform:scale(1.05);}\n    .bar.sorted{background:var(--sorted);}\n    .stats{\n      display:flex;\n      gap:12px;\n      align-items:center;\n      font-size:13px;\n      color:var(--muted);\n      flex-wrap:wrap;\n    }\n    .stat{\n      background:rgba(255,255,255,0.02);\n      padding:6px 10px;\n      border-radius:8px;\n      border:1px solid rgba(255,255,255,0.02);\n      min-width:88px;\n      text-align:center;\n    }\n\n    /* side panel - code + info */\n    .side{\n      width:360px;\n      max-width:38%;\n      min-width:260px;\n      display:flex;\n      gap:12px;\n      flex-direction:column;\n    }\n    .panel{\n      background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.006));\n      border-radius:10px;\n      padding:12px;\n      border:1px solid rgba(255,255,255,0.02);\n    }\n    .panel h3{margin:0 0 8px 0;font-size:14px;}\n    .pseudocode{\n      background:#031021;\n      padding:10px;\n      border-radius:8px;\n      color:var(--muted);\n      font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, \"Roboto Mono\", monospace;\n      font-size:13px;\n      line-height:1.6;\n    }\n    .code-line{display:block;padding:2px 6px;border-radius:6px;}\n    .code-line.active{background:linear-gradient(90deg, rgba(6,182,212,0.09), rgba(16,185,129,0.03)); color:var(--text);}\n\n    footer{\n      display:flex;\n      justify-content:space-between;\n      margin-top:12px;\n      align-items:center;\n      gap:8px;\n      flex-wrap:wrap;\n    }\n    .small{font-size:12px;color:var(--muted);}\n    .branding{font-size:12px;color:var(--muted);}\n    @media (max-width:900px){\n      main{flex-direction:column;}\n      .side{width:100%}\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\" role=\"application\" aria-label=\"冒泡排序可视化\">\n    <header>\n      <h1>冒泡排序（Bubble Sort）可视化</h1>\n      <div class=\"controls\" aria-hidden=\"false\">\n        <div class=\"control\">\n          <label for=\"size\">数组大小</label>\n          <input id=\"size\" type=\"range\" min=\"5\" max=\"70\" value=\"24\" />\n        </div>\n        <div class=\"control\">\n          <label for=\"speed\">速度</label>\n          <input id=\"speed\" type=\"range\" min=\"10\" max=\"1000\" value=\"180\" />\n        </div>\n        <div class=\"control\">\n          <button id=\"shuffle\" class=\"ghost\" title=\"随机生成数组\">随机数组</button>\n          <button id=\"start\">开始</button>\n          <button id=\"pause\" disabled>暂停</button>\n          <button id=\"step\" class=\"ghost\">单步</button>\n          <button id=\"reset\" class=\"ghost\">重置</button>\n        </div>\n      </div>\n    </header>\n\n    <main>\n      <section class=\"viz\" aria-label=\"可视化区域\">\n        <div class=\"canvas\" id=\"canvas\" role=\"list\" aria-live=\"polite\"></div>\n\n        <div style=\"display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap\">\n          <div class=\"stats\">\n            <div class=\"stat\"><div style=\"font-size:11px;color:var(--muted)\">比较次数</div><div id=\"comp\">0</div></div>\n            <div class=\"stat\"><div style=\"font-size:11px;color:var(--muted)\">交换次数</div><div id=\"swaps\">0</div></div>\n            <div class=\"stat\"><div style=\"font-size:11px;color:var(--muted)\">当前外循环 i</div><div id=\"iidx\">-</div></div>\n            <div class=\"stat\"><div style=\"font-size:11px;color:var(--muted)\">当前内循环 j</div><div id=\"jidx\">-</div></div>\n          </div>\n\n          <div style=\"display:flex;gap:8px;align-items:center\">\n            <div class=\"small\">条高度表示数值（随窗口自适应）</div>\n          </div>\n        </div>\n      </section>\n\n      <aside class=\"side\">\n        <div class=\"panel\">\n          <h3>伪代码</h3>\n          <div class=\"pseudocode\" id=\"pseudocode\" aria-hidden=\"false\">\n            <span class=\"code-line\" data-line=\"1\">1. for i = 0 to n-2</span>\n            <span class=\"code-line\" data-line=\"2\">2.   for j = 0 to n-2-i</span>\n            <span class=\"code-line\" data-line=\"3\">3.     if a[j] &gt; a[j+1]</span>\n            <span class=\"code-line\" data-line=\"4\">4.       swap(a[j], a[j+1])</span>\n            <span class=\"code-line\" data-line=\"5\">5. （标记最后一个元素为已排序）</span>\n          </div>\n        </div>\n\n        <div class=\"panel\">\n          <h3>说明</h3>\n          <p class=\"small\" style=\"margin:0\">\n            控件：\n          </p>\n          <ul class=\"small\" style=\"margin:8px 0 0 18px;padding:0 6px 0 0\">\n            <li>数组大小：改变元素数量并生成新数组</li>\n            <li>速度：控制步骤间隔（数值越小越快）</li>\n            <li>随机数组：生成新的随机数组</li>\n            <li>开始/暂停/单步/重置：控制排序过程</li>\n          </ul>\n        </div>\n\n        <div class=\"panel\">\n          <h3>提示</h3>\n          <p class=\"small\" style=\"margin:0\">\n            典型的冒泡排序时间复杂度为 O(n^2)。可观察到每次外循环后最终元素会是当前未排序区间的最大值（标记为绿色）。\n          </p>\n        </div>\n      </aside>\n    </main>\n\n    <footer>\n      <div class=\"branding\">可视化演示 • 冒泡排序</div>\n      <div class=\"small\">为了教学而优化的交互演示 — 支持暂停和单步</div>\n    </footer>\n  </div>\n\n<script>\n(function(){\n  // 元素\n  const canvas = document.getElementById('canvas');\n  const sizeInput = document.getElementById('size');\n  const speedInput = document.getElementById('speed');\n  const shuffleBtn = document.getElementById('shuffle');\n  const startBtn = document.getElementById('start');\n  const pauseBtn = document.getElementById('pause');\n  const stepBtn = document.getElementById('step');\n  const resetBtn = document.getElementById('reset');\n  const compEl = document.getElementById('comp');\n  const swapEl = document.getElementById('swaps');\n  const iEl = document.getElementById('iidx');\n  const jEl = document.getElementById('jidx');\n  const pseudocode = document.getElementById('pseudocode');\n\n  // 状态\n  let array = [];\n  let bars = [];\n  let sortedFlags = [];\n  let comparatorCount = 0;\n  let swapCount = 0;\n  let animating = false;\n  let paused = false;\n  let sorter = null; // generator\n  let speed = parseInt(speedInput.value,10); // delay in ms\n  let lastSize = parseInt(sizeInput.value,10);\n\n  // 初始化\n  function randArray(n){\n    const arr=[];\n    for(let i=0;i<n;i++){\n      // 随机整数 5..100\n      arr.push(Math.floor(Math.random()*96)+5);\n    }\n    return arr;\n  }\n\n  function renderArray(){\n    canvas.innerHTML='';\n    bars = [];\n    const n = array.length;\n    // compute max for scaling\n    const max = Math.max(...array, 1);\n    for(let i=0;i<n;i++){\n      const v = array[i];\n      const bar = document.createElement('div');\n      bar.className = 'bar';\n      bar.style.flex = `0 0 ${Math.max(6, Math.floor(1000/n))}px`;\n      // height relative: min 6% to 92%\n      const percent = 6 + Math.round((v / max) * 86);\n      bar.style.height = `${percent}%`;\n      const label = document.createElement('span');\n      label.textContent = v;\n      bar.appendChild(label);\n      bar.setAttribute('role','listitem');\n      bar.setAttribute('aria-label',`值 ${v}`);\n      canvas.appendChild(bar);\n      bars.push(bar);\n    }\n  }\n\n  function resetStats(){\n    comparatorCount = 0;\n    swapCount = 0;\n    compEl.textContent = '0';\n    swapEl.textContent = '0';\n    iEl.textContent = '-';\n    jEl.textContent = '-';\n  }\n\n  // Pseudocode highlighting\n  function highlightLine(line){\n    const lines = pseudocode.querySelectorAll('.code-line');\n    lines.forEach(el => el.classList.toggle('active', parseInt(el.dataset.line,10) === line));\n  }\n\n  // Generator that yields steps for bubble sort\n  function* bubbleSortGen(arr){\n    const n = arr.length;\n    // outer loop\n    for(let i=0;i<n-1;i++){\n      yield {type:'outer', i};\n      for(let j=0;j<n-1-i;j++){\n        yield {type:'compare', i, j};\n        if(arr[j] > arr[j+1]){\n          yield {type:'swap', i, j};\n          // do the swap in the array so subsequent comparisons reflect change\n          const tmp = arr[j];\n          arr[j] = arr[j+1];\n          arr[j+1] = tmp;\n        }\n      }\n      // after inner loop, the element at n-1-i is sorted\n      yield {type:'markSorted', index: n-1-i};\n    }\n    yield {type:'done'};\n  }\n\n  // Helpers: set bar status classes\n  function clearBarStates(){\n    bars.forEach(b => {\n      b.classList.remove('compare','swap');\n    });\n  }\n  function markSorted(index){\n    if(bars[index]) bars[index].classList.add('sorted');\n  }\n\n  // Advance one step (for step mode or internal use)\n  async function stepOnce(){\n    if(!sorter) return false;\n    const next = sorter.next();\n    if(next.done) return false;\n    const step = next.value;\n    // Handle step\n    switch(step.type){\n      case 'outer':\n        highlightLine(1);\n        iEl.textContent = step.i;\n        jEl.textContent = '-';\n        clearBarStates();\n        break;\n      case 'compare':\n        highlightLine(3);\n        comparatorCount++;\n        compEl.textContent = comparatorCount;\n        jEl.textContent = step.j;\n        clearBarStates();\n        if(bars[step.j]) bars[step.j].classList.add('compare');\n        if(bars[step.j+1]) bars[step.j+1].classList.add('compare');\n        break;\n      case 'swap':\n        highlightLine(4);\n        swapCount++;\n        swapEl.textContent = swapCount;\n        // perform visual swap: animate heights and text content by swapping style & content\n        clearBarStates();\n        const a = step.j, b = step.j+1;\n        if(!bars[a] || !bars[b]) break;\n        bars[a].classList.add('swap');\n        bars[b].classList.add('swap');\n        // swap heights and labels\n        await animateSwapBars(a,b);\n        // swap DOM references in bars array to keep indices consistent\n        const tmp = bars[a];\n        bars[a] = bars[b];\n        bars[b] = tmp;\n        break;\n      case 'markSorted':\n        highlightLine(5);\n        markSorted(step.index);\n        clearBarStates();\n        break;\n      case 'done':\n        highlightLine(null);\n        // mark all as sorted\n        bars.forEach(b => b.classList.add('sorted'));\n        clearBarStates();\n        iEl.textContent = '-';\n        jEl.textContent = '-';\n        return false;\n      default:\n        break;\n    }\n    return true;\n  }\n\n  // animate swap by exchanging heights + label smoothly\n  function animateSwapBars(i,j){\n    return new Promise(resolve=>{\n      const bi = bars[i];\n      const bj = bars[j];\n      if(!bi || !bj){ resolve(); return; }\n      // capture heights and labels\n      const hi = bi.style.height;\n      const hj = bj.style.height;\n      const li = bi.querySelector('span').textContent;\n      const lj = bj.querySelector('span').textContent;\n\n      // apply swap visually by temporarily setting both heights to the other\n      // Using transition in CSS to animate\n      // Slight delay to let class 'swap' apply scale\n      requestAnimationFrame(()=>{\n        bi.style.height = hj;\n        bj.style.height = hi;\n        bi.querySelector('span').textContent = lj;\n        bj.querySelector('span').textContent = li;\n      });\n\n      // wait for transition end\n      const onEnd = (e)=>{\n        // ensure triggered for both or fallback timeout\n      };\n      // fallback timeout: choose max transition 350ms\n      const t = Math.max(250, Math.min(800, parseInt(speedInput.value,10)+120));\n      setTimeout(()=>resolve(), t);\n    });\n  }\n\n  // Main loop to continuously run generator steps respecting speed & pause\n  async function runSort(){\n    if(!sorter) return;\n    animating = true;\n    startBtn.disabled = true;\n    shuffleBtn.disabled = true;\n    sizeInput.disabled = true;\n    stepBtn.disabled = true;\n    resetBtn.disabled = true;\n    pauseBtn.disabled = false;\n\n    let active = true;\n    while(active){\n      if(paused){\n        // wait until unpaused\n        await new Promise(r=> {\n          const resume = ()=>{\n            document.removeEventListener('resumeSort', resume);\n            r();\n          };\n          document.addEventListener('resumeSort', resume);\n        });\n      }\n      const cont = await stepOnce();\n      if(!cont) { active = false; break; }\n      // dynamic delay based on speed slider: smaller value => faster\n      const delay = Math.max(5, parseInt(speedInput.value,10));\n      await new Promise(r => setTimeout(r, delay));\n    }\n\n    // finished or stopped\n    animating = false;\n    startBtn.disabled = false;\n    shuffleBtn.disabled = false;\n    sizeInput.disabled = false;\n    stepBtn.disabled = false;\n    resetBtn.disabled = false;\n    pauseBtn.disabled = true;\n  }\n\n  // Control handlers\n  function generateAndRender(n){\n    array = randArray(n);\n    sortedFlags = new Array(n).fill(false);\n    resetStats();\n    renderArray();\n    highlightLine(null);\n    sorter = null;\n    paused = false;\n    animating = false;\n    pauseBtn.disabled = true;\n  }\n\n  // initialize default\n  generateAndRender(lastSize);\n\n  // Events\n  sizeInput.addEventListener('input', ()=>{\n    const n = parseInt(sizeInput.value,10);\n    lastSize = n;\n    generateAndRender(n);\n  });\n\n  shuffleBtn.addEventListener('click', ()=>{\n    generateAndRender(lastSize);\n  });\n\n  startBtn.addEventListener('click', ()=>{\n    if(animating) return;\n    // if sorter is null, create a fresh clone of array for generator\n    if(!sorter){\n      sorter = bubbleSortGen(array.slice()); // generator works on a copy to drive steps, but we mutate DOM separately\n    }\n    paused = false;\n    document.dispatchEvent(new Event('resumeSort'));\n    runSort();\n  });\n\n  pauseBtn.addEventListener('click', ()=>{\n    paused = true;\n    pauseBtn.disabled = true;\n    startBtn.disabled = false;\n    // allow resume via start\n  });\n\n  stepBtn.addEventListener('click', async ()=>{\n    if(!sorter){\n      sorter = bubbleSortGen(array.slice());\n    }\n    // if currently animating, ignore step\n    if(animating) return;\n    // run one step\n    paused = true;\n    // perform single step (no auto play)\n    await stepOnce();\n  });\n\n  resetBtn.addEventListener('click', ()=>{\n    // reset to unsorted original generate new random\n    generateAndRender(lastSize);\n  });\n\n  speedInput.addEventListener('input', ()=>{\n    speed = parseInt(speedInput.value,10);\n  });\n\n  // Accessibility: keyboard shortcuts\n  window.addEventListener('keydown', (e)=>{\n    if(e.code === 'Space'){\n      e.preventDefault();\n      if(animating && !paused){\n        pauseBtn.click();\n      } else {\n        startBtn.click();\n      }\n    }\n    if(e.key === 'ArrowRight'){\n      stepBtn.click();\n    }\n    if(e.key === 'r'){\n      shuffleBtn.click();\n    }\n  });\n\n  // Resize handling: re-render heights based on stored numbers (in bars' labels)\n  window.addEventListener('resize', ()=>{\n    // nothing heavy; heights are percentage so they adapt automatically\n  });\n\n  // Initialize some helpful hints in console\n  console.log('冒泡排序可视化已加载。按空格开始/暂停，右箭头单步，r 随机数组。');\n\n})();\n</script>\n</body>\n</html>"
    },
    "messages": [
      {
        "role": "system",
        "content": "Generate a single HTML file with JavaScript demonstrating the user-given concept. Only respond in a single HTML file."
      },
      {
        "role": "user",
        "content": "创建冒泡排序可视化"
      }
    ],
    "topic": "Bubble Sort",
    "hasFSM": true,
    "hasTest": true,
    "evaluation": {
      "score": null,
      "notes": ""
    }
  }
]