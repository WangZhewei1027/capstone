{
  "topic": "Bubble Sort",
  "description": "Finite state machine for the Bubble Sort visualization app: controls array generation, playback (run/pause/step), internal animation steps (compare/swap/mark sorted) and completion.",
  "states": [
    {
      "name": "idle",
      "onEnter": "generateAndRender",
      "onExit": "noop",
      "on": {
        "START_CLICKED": "running",
        "SHUFFLE_CLICKED": "idle",
        "SIZE_CHANGED": "idle",
        "RESET_CLICKED": "idle",
        "STEP_CLICKED": "stepping",
        "SPEED_CHANGED": "idle"
      }
    },
    {
      "name": "running",
      "onEnter": "runSort",
      "onExit": "noop",
      "on": {
        "PAUSE_CLICKED": "paused",
        "OUTER_STEP": "outer",
        "COMPARE_STEP": "comparing",
        "SWAP_STEP": "swapping",
        "MARK_SORTED": "markSorted",
        "SORT_DONE": "done"
      }
    },
    {
      "name": "paused",
      "onEnter": "setPausedTrue",
      "onExit": "setPausedFalse",
      "on": {
        "START_CLICKED": "running",
        "SORT_DONE": "done"
      }
    },
    {
      "name": "stepping",
      "onEnter": "stepOnce",
      "onExit": "noop",
      "on": {
        "STEP_COMPLETE": "idle",
        "SORT_DONE": "done"
      }
    },
    {
      "name": "outer",
      "onEnter": "highlightLine(1); set iidx",
      "onExit": "noop",
      "on": {
        "COMPARE_STEP": "comparing",
        "MARK_SORTED": "markSorted",
        "SORT_DONE": "done"
      }
    },
    {
      "name": "comparing",
      "onEnter": "highlightLine(3); incrementComparator; add .compare classes",
      "onExit": "clearBarStates",
      "on": {
        "SWAP_STEP": "swapping",
        "COMPARE_STEP": "comparing",
        "MARK_SORTED": "markSorted",
        "OUTER_STEP": "outer",
        "SORT_DONE": "done"
      }
    },
    {
      "name": "swapping",
      "onEnter": "highlightLine(4); incrementSwap; animateSwapBars",
      "onExit": "clearBarStates",
      "on": {
        "SWAP_COMPLETE": "running",
        "COMPARE_STEP": "comparing",
        "SORT_DONE": "done"
      }
    },
    {
      "name": "markSorted",
      "onEnter": "highlightLine(5); markSorted(index)",
      "onExit": "clearBarStates",
      "on": {
        "OUTER_STEP": "outer",
        "COMPARE_STEP": "comparing",
        "SORT_DONE": "done"
      }
    },
    {
      "name": "done",
      "onEnter": "highlightLine(null); add .sorted to all bars; clearBarStates",
      "onExit": "noop",
      "on": {
        "SHUFFLE_CLICKED": "idle",
        "SIZE_CHANGED": "idle",
        "RESET_CLICKED": "idle",
        "START_CLICKED": "running"
      }
    }
  ],
  "events": [
    "START_CLICKED",
    "PAUSE_CLICKED",
    "STEP_CLICKED",
    "STEP_COMPLETE",
    "SHUFFLE_CLICKED",
    "SIZE_CHANGED",
    "SPEED_CHANGED",
    "RESET_CLICKED",
    "OUTER_STEP",
    "COMPARE_STEP",
    "SWAP_STEP",
    "SWAP_COMPLETE",
    "MARK_SORTED",
    "SORT_DONE",
    "RESUME_SORT",
    "KEY_SPACE",
    "KEY_RIGHT",
    "KEY_R",
    "RUN_STARTED",
    "RUN_STOPPED"
  ],
  "triggers": {
    "START_CLICKED": "#start",
    "PAUSE_CLICKED": "#pause",
    "STEP_CLICKED": "#step",
    "SHUFFLE_CLICKED": "#shuffle",
    "SIZE_CHANGED": "#size",
    "SPEED_CHANGED": "#speed",
    "RESET_CLICKED": "#reset",
    "KEY_SPACE": "body",
    "KEY_RIGHT": "body",
    "KEY_R": "body",
    "OUTER_STEP": "#iidx, #jidx, #pseudocode .code-line",
    "COMPARE_STEP": ".bar, #pseudocode .code-line",
    "SWAP_STEP": ".bar, #pseudocode .code-line",
    "SWAP_COMPLETE": ".bar",
    "MARK_SORTED": ".bar, #pseudocode .code-line",
    "SORT_DONE": ".bar.sorted, #comp, #swaps",
    "RESUME_SORT": "#start",
    "RUN_STARTED": "#start",
    "RUN_STOPPED": "#pause"
  },
  "notes": "Triggers map user actions and internal visual step events to actual DOM selectors present in the HTML. Visual element selectors: #canvas, .bar, .bar.compare, .bar.swap, .bar.sorted, #pseudocode .code-line; control selectors: #size, #speed, #shuffle, #start, #pause, #step, #reset; stats selectors: #comp, #swaps, #iidx, #jidx."
}