{
  "id": "7abed137-cd32-11f0-a96f-2d591ffb35fe",
  "timestamp": "2025-11-29T14:49:47.124Z",
  "type": "html-to-test",
  "htmlModel": "gpt-3.5-turbo",
  "playwrightModel": "gpt-5-mini",
  "status": "success",
  "question": "K-Nearest Neighbors (KNN)",
  "answer": {
    "role": "assistant",
    "content": "<html lang=\"en\">\n<head>\n<meta charset=\"UTF-8\" />\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n<title>K-Nearest Neighbors (KNN) Demo</title>\n<style>\n  body {\n    font-family: Arial, sans-serif;\n    margin: 20px;\n  }\n  #canvasContainer {\n    position: relative;\n    border: 1px solid #ccc;\n    margin-bottom: 15px;\n    user-select: none;\n  }\n  canvas {\n    background: #fafafa;\n    cursor: crosshair;\n  }\n  .point {\n    width: 12px;\n    height: 12px;\n    border-radius: 50%;\n    position: absolute;\n    pointer-events: none;\n    transform: translate(-50%, -50%);\n  }\n  #controls {\n    margin-bottom: 10px;\n  }\n  label {\n    margin-right: 10px;\n  }\n  #legend {\n    margin-top: 10px;\n  }\n  .legend-item {\n    display: inline-flex;\n    align-items: center;\n    margin-right: 15px;\n  }\n  .legend-color {\n    display: inline-block;\n    width: 14px;\n    height: 14px;\n    border-radius: 50%;\n    margin-right: 5px;\n  }\n  #info {\n    margin-top: 10px;\n  }\n  button {\n    padding: 5px 10px;\n    margin-right: 10px;\n    cursor: pointer;\n  }\n  h1 {\n    margin-bottom: 10px;\n  }\n  p {\n    max-width: 600px;\n  }\n</style>\n</head>\n<body>\n<h1>K-Nearest Neighbors (KNN) Interactive Demo</h1>\n<p>\n  This demo lets you add points in two classes (red and blue) by clicking on the canvas.\n  Then, click anywhere on the canvas to classify that new point using the K-Nearest Neighbors algorithm.\n  Adjust the value of <strong>K</strong> to see how classification changes.\n</p>\n\n<div id=\"controls\">\n  <label>\n    Select Class to Add:\n    <select id=\"classSelector\">\n      <option value=\"red\">Red</option>\n      <option value=\"blue\">Blue</option>\n    </select>\n  </label>\n\n  <label>\n    K (neighbors):\n    <input type=\"number\" id=\"kInput\" value=\"3\" min=\"1\" max=\"15\" step=\"1\" style=\"width: 50px\" />\n  </label>\n\n  <button id=\"clearBtn\">Clear All Points</button>\n  <button id=\"resetClassifyBtn\" disabled>Clear Classified Point</button>\n</div>\n\n<div id=\"canvasContainer\" style=\"width:600px; height:400px;\">\n  <canvas id=\"knnCanvas\" width=\"600\" height=\"400\"></canvas>\n</div>\n\n<div id=\"legend\">\n  <div class=\"legend-item\"><span class=\"legend-color\" style=\"background: red;\"></span>Class Red</div>\n  <div class=\"legend-item\"><span class=\"legend-color\" style=\"background: blue;\"></span>Class Blue</div>\n  <div class=\"legend-item\"><span class=\"legend-color\" id=\"unknownPoint\" style=\"background: orange;\"></span>Classified Point</div>\n  <div class=\"legend-item\">\n    <svg width=\"16\" height=\"16\" style=\"vertical-align: middle;\">\n      <circle cx=\"8\" cy=\"8\" r=\"7\" stroke=\"green\" stroke-width=\"2\" fill=\"none\" />\n    </svg> K-Nearest Neighbors\n  </div>\n</div>\n\n<div id=\"info\"></div>\n\n<script>\n(() => {\n  const canvas = document.getElementById('knnCanvas');\n  const ctx = canvas.getContext('2d');\n  const classSelector = document.getElementById('classSelector');\n  const kInput = document.getElementById('kInput');\n  const clearBtn = document.getElementById('clearBtn');\n  const resetClassifyBtn = document.getElementById('resetClassifyBtn');\n  const infoDiv = document.getElementById('info');\n\n  const WIDTH = canvas.width;\n  const HEIGHT = canvas.height;\n\n  // Data points: [{x, y, label}]\n  let points = [];\n\n  // Classified point & neighbors\n  let classifiedPoint = null; // {x, y, predictedLabel, neighbors: [...]}\n\n  // Color scheme\n  const classColors = {\n    red: 'red',\n    blue: 'blue',\n  };\n  const unknownColor = 'orange';\n\n  // Draw a single point (circle)\n  function drawPoint(x, y, color, radius = 6, highlight=false) {\n    ctx.beginPath();\n    ctx.arc(x, y, radius, 0, 2 * Math.PI);\n    ctx.fillStyle = color;\n    ctx.fill();\n    if(highlight){\n      ctx.lineWidth = 2;\n      ctx.strokeStyle = 'green';\n      ctx.stroke();\n    }\n  }\n\n  // Distance between two points\n  function distance(p1, p2) {\n    return Math.sqrt((p1.x - p2.x) ** 2 + (p1.y - p2.y) ** 2);\n  }\n\n  // KNN Classifier\n  // Returns {label: string, neighbors: array of points}\n  function knnClassify(testPoint, k) {\n    // Compute distances to all points in dataset\n    const distances = points.map(p => ({...p, dist: distance(p, testPoint)}));\n    // Sort ascending by distance\n    distances.sort((a, b) => a.dist - b.dist);\n    // Take k nearest neighbors\n    const neighbors = distances.slice(0, k);\n\n    // Count votes\n    const votes = {};\n    neighbors.forEach(n => {\n      votes[n.label] = (votes[n.label] || 0) + 1;\n    });\n\n    // Find label with max votes (simple majority, tie-break by nearest)\n    let maxVotes = 0;\n    let chosenLabel = null;\n    for (const label in votes) {\n      if (votes[label] > maxVotes) {\n        maxVotes = votes[label];\n        chosenLabel = label;\n      } else if (votes[label] === maxVotes) {\n        // Tie-break: check the nearest neighbor in the tie labels\n        // Find closest neighbor label distance\n        const distA = neighbors.find(n => n.label === chosenLabel).dist;\n        const distB = neighbors.find(n => n.label === label).dist;\n        if (distB < distA) chosenLabel = label;\n      }\n    }\n\n    return {label: chosenLabel, neighbors};\n  }\n\n  // Clear canvas and re-draw all points & optionally classified point\n  function redraw() {\n    ctx.clearRect(0, 0, WIDTH, HEIGHT);\n\n    // Draw existing points\n    points.forEach(pt => {\n      drawPoint(pt.x, pt.y, classColors[pt.label]);\n    });\n\n    if (classifiedPoint) {\n      // Draw neighbors with green circles around\n      classifiedPoint.neighbors.forEach(n => {\n        drawPoint(n.x, n.y, classColors[n.label], 8, true);\n      });\n\n      // Draw classified test point\n      drawPoint(classifiedPoint.x, classifiedPoint.y, unknownColor, 8);\n\n      // Draw lines from test point to neighbors\n      ctx.strokeStyle = 'green';\n      ctx.lineWidth = 1.5;\n      classifiedPoint.neighbors.forEach(n => {\n        ctx.beginPath();\n        ctx.moveTo(classifiedPoint.x, classifiedPoint.y);\n        ctx.lineTo(n.x, n.y);\n        ctx.stroke();\n      });\n    }\n  }\n\n  // Info display update\n  function updateInfo() {\n    if (classifiedPoint) {\n      const k = kInput.value;\n      let html = `<strong>Classified Point:</strong> (${classifiedPoint.x.toFixed(1)}, ${classifiedPoint.y.toFixed(1)})<br />`;\n      html += `<strong>Predicted Class:</strong> <span style=\"color:${classColors[classifiedPoint.label]}\">${classifiedPoint.label}</span><br/>`;\n      html += `<strong>Nearest Neighbors (K=${k}):</strong><ul style=\"padding-left:20px;\">`;\n      classifiedPoint.neighbors.forEach((n,i) => {\n        html += `<li>(${n.x.toFixed(1)}, ${n.y.toFixed(1)}) - Class <span style=\"color:${classColors[n.label]}\">${n.label}</span>, Distance: ${n.dist.toFixed(1)}</li>`;\n      });\n      html += '</ul>';\n      infoDiv.innerHTML = html;\n      resetClassifyBtn.disabled = false;\n    } else {\n      infoDiv.innerHTML = 'Click on the canvas to add points (red or blue class selected). Then click to classify a new point.';\n      resetClassifyBtn.disabled = true;\n    }\n  }\n\n  // Event handlers\n  canvas.addEventListener('click', e => {\n    // Get mouse position relative to canvas\n    const rect = canvas.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n\n    if (!classifiedPoint) {\n      // If classification point not set, add training point\n      const selectedClass = classSelector.value;\n      points.push({x, y, label: selectedClass});\n      redraw();\n      updateInfo();\n    } else {\n      // If classified point exists, and user clicks again, interpret as re-classify new point\n\n      // Note: To simplify user experience, clear old classified point and classify at new point\n      classifiedPoint = null;\n      redraw();\n      updateInfo();\n    }\n  });\n\n  canvas.addEventListener('contextmenu', e => {\n    // Right-click to classify a new point\n    e.preventDefault();\n    if (points.length === 0) {\n      alert('Please add some training points before classification.');\n      return;\n    }\n    const rect = canvas.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n\n    let k = parseInt(kInput.value);\n    if (isNaN(k) || k < 1) {\n      alert('Please enter a valid K (>=1).');\n      return;\n    }\n    if (k > points.length) {\n      k = points.length;\n      kInput.value = k;\n    }\n\n    const testPoint = {x, y};\n    const result = knnClassify(testPoint, k);\n    classifiedPoint = {\n      x, y,\n      label: result.label,\n      neighbors: result.neighbors\n    };\n    redraw();\n    updateInfo();\n  });\n\n  kInput.addEventListener('change', () => {\n    if (classifiedPoint) {\n      // Reclassify with new k if possible\n      let k = parseInt(kInput.value);\n      if (isNaN(k) || k < 1) {\n        k = 1;\n        kInput.value = k;\n      }\n      if (k > points.length) {\n        k = points.length;\n        kInput.value = k;\n      }\n      const testPoint = { x: classifiedPoint.x, y: classifiedPoint.y };\n      const result = knnClassify(testPoint, k);\n      classifiedPoint.label = result.label;\n      classifiedPoint.neighbors = result.neighbors;\n      redraw();\n      updateInfo();\n    }\n  });\n\n  clearBtn.addEventListener('click', () => {\n    points = [];\n    classifiedPoint = null;\n    redraw();\n    updateInfo();\n  });\n\n  resetClassifyBtn.addEventListener('click', () => {\n    classifiedPoint = null;\n    redraw();\n    updateInfo();\n  });\n\n  // Initial info\n  updateInfo();\n\n  // Instructions:\n  // Left-click on canvas: add training point with selected class\n  // Right-click on canvas: classify new point at that location\n  // Adjust K and see changes\n\n  // Show a small instruction above canvas (could be enhanced)\n  const hint = document.createElement('p');\n  hint.style.marginTop = '0px';\n  hint.style.marginBottom = '15px';\n  hint.style.fontStyle = 'italic';\n  hint.style.color = '#555';\n  hint.innerHTML = 'Left-Click: Add training point | Right-Click: Classify point';\n  document.body.insertBefore(hint, document.getElementById('canvasContainer'));\n})();\n</script>\n</body>\n</html>"
  },
  "messages": [
    {
      "role": "system",
      "content": "Generate a single HTML file with JavaScript demonstrating the user-given concept. Only respond in a single HTML file."
    },
    {
      "role": "user",
      "content": "K-Nearest Neighbors (KNN)"
    }
  ],
  "topic": "K-Nearest Neighbors (KNN)",
  "hasFSM": false,
  "hasTest": true
}