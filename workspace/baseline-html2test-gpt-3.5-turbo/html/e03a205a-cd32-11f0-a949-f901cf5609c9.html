<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Merge Sort Visualization</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f0f2f5;
  }
  h1 {
    text-align: center;
    color: #333;
  }
  #inputSection {
    max-width: 600px;
    margin: 0 auto 20px auto;
    text-align: center;
  }
  #arrayInput {
    width: 80%;
    padding: 10px;
    font-size: 16px;
  }
  button {
    margin-left: 10px;
    padding: 10px 15px;
    font-size: 16px;
    cursor: pointer;
  }
  #error {
    color: red;
    margin-top: 5px;
  }
  #visualization {
    max-width: 800px;
    margin: 0 auto;
    min-height: 200px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    padding: 15px;
  }
  .barContainer {
    display: flex;
    justify-content: center;
    align-items: flex-end;
    margin-bottom: 30px;
  }
  .bar {
    margin: 0 3px;
    background-color: #4caf50;
    color: white;
    text-align: center;
    font-size: 14px;
    border-radius: 4px 4px 0 0;
    transition: background-color 0.3s;
  }
  .bar.comparing {
    background-color: #ff9800;
  }
  .bar.merging {
    background-color: #2196f3;
  }
  #log {
    max-width: 600px;
    margin: 15px auto;
    background: #222;
    color: #eee;
    padding: 10px;
    height: 150px;
    overflow-y: auto;
    font-family: monospace;
    border-radius: 6px;
  }
</style>
</head>
<body>

<h1>Merge Sort Visualization</h1>

<div id="inputSection">
  <input id="arrayInput" type="text" placeholder="Enter integers separated by commas" />
  <button id="startSort">Start Merge Sort</button>
  <div id="error"></div>
</div>

<div id="visualization"></div>
<div id="log"></div>

<script>
  const arrayInput = document.getElementById('arrayInput');
  const startSortBtn = document.getElementById('startSort');
  const visualization = document.getElementById('visualization');
  const log = document.getElementById('log');
  const errorDiv = document.getElementById('error');

  function logMessage(msg) {
    log.textContent += msg + "\\n";
    log.scrollTop = log.scrollHeight;
  }

  // Create bars for the array display
  function createBars(arr, highlightIndices = [], mergeIndices = []) {
    visualization.innerHTML = '';
    const container = document.createElement('div');
    container.className = 'barContainer';

    // Find max for relative height scaling
    const maxVal = Math.max(...arr.map(e => Math.abs(e)));

    arr.forEach((value, index) => {
      const bar = document.createElement('div');
      bar.className = 'bar';
      bar.style.height = (maxVal === 0 ? 30 : 30 + (70 * Math.abs(value) / maxVal)) + 'px';
      bar.textContent = value;
      bar.style.width = '30px';
      if (highlightIndices.includes(index)) {
        bar.classList.add('comparing');
      }
      if (mergeIndices.includes(index)) {
        bar.classList.add('merging');
      }
      container.appendChild(bar);
    });
    visualization.appendChild(container);
  }

  // Pause helper for animation speed
  function delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  async function mergeSort(arr, left = 0, right = arr.length -1) {
    if (left >= right) return;

    const mid = Math.floor((left + right) / 2);

    await mergeSort(arr, left, mid);
    await mergeSort(arr, mid + 1, right);
    await merge(arr, left, mid, right);
  }

  async function merge(arr, left, mid, right) {
    logMessage(`Merging subarrays [${left}..${mid}] and [${mid+1}..${right}]`);
    let n1 = mid - left + 1;
    let n2 = right - mid;

    let leftArr = [];
    let rightArr = [];

    for (let i = 0; i < n1; i++) {
      leftArr[i] = arr[left + i];
    }
    for (let j = 0; j < n2; j++) {
      rightArr[j] = arr[mid + 1 + j];
    }

    let i = 0;
    let j = 0;
    let k = left;

    while (i < n1 && j < n2) {
      createBars(arr, [k], [k]);
      await delay(500);

      if (leftArr[i] <= rightArr[j]) {
        arr[k] = leftArr[i];
        logMessage(`Placed ${leftArr[i]} into position ${k}`);
        i++;
      } else {
        arr[k] = rightArr[j];
        logMessage(`Placed ${rightArr[j]} into position ${k}`);
        j++;
      }
      k++;
      createBars(arr, [], [...Array(right - left + 1).keys()].map(x => x + left));
      await delay(400);
    }

    while (i < n1) {
      arr[k] = leftArr[i];
      logMessage(`Copy remaining left value ${leftArr[i]} to position ${k}`);
      i++;
      k++;
      createBars(arr, [], [...Array(right - left + 1).keys()].map(x => x + left));
      await delay(400);
    }

    while (j < n2) {
      arr[k] = rightArr[j];
      logMessage(`Copy remaining right value ${rightArr[j]} to position ${k}`);
      j++;
      k++;
      createBars(arr, [], [...Array(right - left + 1).keys()].map(x => x + left));
      await delay(400);
    }
  }

  startSortBtn.addEventListener('click', async () => {
    errorDiv.textContent = '';
    log.textContent = '';
    let inputStr = arrayInput.value.trim();
    if (!inputStr.length) {
      errorDiv.textContent = 'Please enter some numbers separated by commas.';
      return;
    }

    // Parse input
    let inputs = inputStr.split(',').map(s => s.trim());
    let arr = [];

    for (let s of inputs) {
      if (s === '') continue;
      let num = Number(s);
      if (Number.isNaN(num)) {
        errorDiv.textContent = `Invalid number: "${s}"`;
        return;
      }
      arr.push(num);
    }

    if(arr.length === 0) {
      errorDiv.textContent = "No valid numbers found.";
      return;
    }

    if(arr.length > 50) {
      errorDiv.textContent = "Please enter 50 or fewer numbers for better visualization.";
      return;
    }

    logMessage("Starting Merge Sort");
    createBars(arr);
    await delay(500);
    await mergeSort(arr);

    createBars(arr);
    logMessage("Merge Sort Completed!");
  });
</script>

</body>
</html>