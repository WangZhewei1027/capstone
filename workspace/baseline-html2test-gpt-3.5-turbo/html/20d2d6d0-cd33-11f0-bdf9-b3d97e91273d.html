<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Two Pointers Technique Demo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      max-width: 800px;
    }
    h1 {
      text-align: center;
    }
    textarea {
      width: 100%;
      height: 80px;
      font-family: monospace;
      font-size: 14px;
    }
    button {
      margin-top: 10px;
      padding: 10px 15px;
      font-size: 16px;
      cursor: pointer;
    }
    .result {
      margin-top: 20px;
      background: #f0f4f8;
      padding: 15px;
      border-radius: 5px;
      white-space: pre-wrap;
      font-family: monospace;
      font-size: 14px;
    }
    .array-visualization {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }
    .element {
      width: 30px;
      height: 30px;
      line-height: 30px;
      text-align: center;
      border: 1px solid #ccc;
      border-radius: 4px;
      user-select: none;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    .pointer-left {
      background-color: #6cace4;
      color: white;
      font-weight: bold;
      border-color: #3b7bbf;
    }
    .pointer-right {
      background-color: #e46c6c;
      color: white;
      font-weight: bold;
      border-color: #bf3b3b;
    }
    .pointer-both {
      background-color: #6ce49b;
      color: #034d11;
      font-weight: bold;
      border-color: #23762d;
    }
  </style>
</head>
<body>
  <h1>Two Pointers Technique Demo</h1>
  <p>
    Enter a sorted array of integers (comma separated):<br />
    <textarea id="inputArray" placeholder="e.g. 1, 2, 2, 3, 4, 4, 5"></textarea>
  </p>
  <p>
    Choose problem:
    <select id="problemSelect">
      <option value="twoSum">Two Sum in sorted array (find two numbers with sum = target)</option>
      <option value="removeDuplicates">Remove duplicates from sorted array</option>
    </select>
  </p>
  <p id="targetInputContainer" style="display:none;">
    Enter target sum: <input type="number" id="targetSum" value="5" />
  </p>
  <button id="runBtn">Run Two Pointers</button>
  <div class="result" id="result"></div>

  <script>
    const inputArrayEl = document.getElementById('inputArray');
    const resultEl = document.getElementById('result');
    const runBtn = document.getElementById('runBtn');
    const problemSelect = document.getElementById('problemSelect');
    const targetInputContainer = document.getElementById('targetInputContainer');
    const targetSumEl = document.getElementById('targetSum');

    problemSelect.addEventListener('change', () => {
      if (problemSelect.value === 'twoSum') {
        targetInputContainer.style.display = 'inline-block';
      } else {
        targetInputContainer.style.display = 'none';
      }
    });

    function parseInput(input) {
      return input
        .split(',')
        .map(s => s.trim())
        .filter(s => s !== '')
        .map(Number)
        .filter(n => !isNaN(n));
    }

    /**
     * Problem 1: Two Sum II - Input array is sorted, find two numbers that sum to target.
     * Use two pointers from start and end.
     */
    function twoSum(arr, target) {
      let left = 0;
      let right = arr.length - 1;
      const steps = [];
      while (left < right) {
        steps.push({
          left,
          right,
          leftVal: arr[left],
          rightVal: arr[right],
          sum: arr[left] + arr[right],
          action: null,
        });
        const sum = arr[left] + arr[right];
        if (sum === target) {
          steps[steps.length - 1].action = 'found';
          return { steps, result: [left, right] };
        } else if (sum < target) {
          steps[steps.length - 1].action = 'left++';
          left++;
        } else {
          steps[steps.length - 1].action = 'right--';
          right--;
        }
      }
      return { steps, result: null };
    }

    /**
     * Problem 2: Remove duplicates from sorted array in place
     * Use two pointers: one for the place to write, one to scan.
     * Returns new length, and the array modifies first part.
     */
    function removeDuplicates(arr) {
      if (arr.length === 0) return { steps: [], newLength: 0 };
      let writeIndex = 1;
      const steps = [];
      for (let i = 1; i < arr.length; i++) {
        steps.push({
          i,
          writeIndex,
          currentVal: arr[i],
          lastUniqueVal: arr[writeIndex - 1],
          action: null,
          arr: [...arr],
        });
        if (arr[i] !== arr[writeIndex - 1]) {
          arr[writeIndex] = arr[i];
          steps[steps.length - 1].action = `arr[${writeIndex}] = ${arr[i]}`;
          writeIndex++;
        } else {
          steps[steps.length - 1].action = 'skip duplicate';
        }
      }
      return { steps, newLength: writeIndex, arr };
    }

    /**
     * Visualize the array with highlighted pointers
     */
    function visualizeArray(arr, pointerPositions = {}, highlightPairs = []) {
      const container = document.createElement('div');
      container.className = 'array-visualization';

      arr.forEach((val, i) => {
        const elem = document.createElement('div');
        elem.className = 'element';
        elem.textContent = val;
        const isLeft = pointerPositions.left === i;
        const isRight = pointerPositions.right === i;

        if (isLeft && isRight) {
          elem.classList.add('pointer-both');
          elem.title = 'Left & Right Pointer';
        } else if (isLeft) {
          elem.classList.add('pointer-left');
          elem.title = 'Left Pointer';
        } else if (isRight) {
          elem.classList.add('pointer-right');
          elem.title = 'Right Pointer';
        }

        // Highlight pairs for remove duplicates
        if (highlightPairs.includes(i)) {
          elem.style.borderColor = '#f57c00';
          elem.style.fontWeight = 'bold';
        }

        container.appendChild(elem);
      });
      return container;
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // Animate the steps for two sum
    async function animateTwoSum(steps, arr, target) {
      resultEl.innerHTML = `Target sum = <b>${target}</b>\n\n`;
      for (let s of steps) {
        resultEl.appendChild(
          visualizeArray(arr, { left: s.left, right: s.right })
        );
        resultEl.appendChild(
          document.createElement('br')
        );
        if (s.action === 'found') {
          resultEl.appendChild(document.createTextNode(
            `Sum of arr[${s.left}] = ${s.leftVal} + arr[${s.right}] = ${s.rightVal} equals target ${target}!`
          ));
          break;
        } else if (s.action === 'left++') {
          resultEl.appendChild(document.createTextNode(
            `Sum (${s.sum}) < target (${target}), move left pointer right to index ${s.left + 1}`
          ));
        } else if (s.action === 'right--') {
          resultEl.appendChild(document.createTextNode(
            `Sum (${s.sum}) > target (${target}), move right pointer left to index ${s.right - 1}`
          ));
        }
        resultEl.appendChild(document.createElement('hr'));
        await sleep(800);
        resultEl.innerHTML = `Target sum = <b>${target}</b>\n\n`;
      }
      if (steps.length > 0 && steps[steps.length-1].action !== 'found') {
        resultEl.appendChild(document.createTextNode(`No two numbers found that sum to ${target}.`));
      }
    }

    // Animate steps for remove duplicates
    async function animateRemoveDuplicates(steps, originalArr) {
      resultEl.innerHTML = `Original array: [${originalArr.join(', ')}]\n\n`;
      for (let s of steps) {
        resultEl.appendChild(
          visualizeArray(s.arr, {}, [s.i, s.writeIndex-1])
        );
        resultEl.appendChild(document.createElement('br'));
        let line1 = `Scan i=${s.i} (val=${s.currentVal}), writing at index ${s.writeIndex}`;
        let line2 = s.action;
        resultEl.appendChild(document.createTextNode(line1));
        resultEl.appendChild(document.createElement('br'));
        resultEl.appendChild(document.createTextNode(line2));
        resultEl.appendChild(document.createElement('hr'));
        await sleep(900);
        resultEl.innerHTML = `Original array: [${originalArr.join(', ')}]\n\n`;
      }
    }

    runBtn.onclick = async () => {
      resultEl.innerHTML = '';
      const arr = parseInput(inputArrayEl.value);
      if (arr.length === 0) {
        resultEl.textContent = 'Please enter at least one valid number.';
        return;
      }

      if (problemSelect.value === 'twoSum') {
        const target = Number(targetSumEl.value);
        if (isNaN(target)) {
          resultEl.textContent = 'Please enter a valid target sum.';
          return;
        }
        // We expect sorted array for two sum
        const sortedArr = [...arr].sort((a,b) => a-b);

        const { steps, result } = twoSum(sortedArr, target);
        await animateTwoSum(steps, sortedArr, target);
        if (result) {
          resultEl.appendChild(document.createElement('br'));
          resultEl.appendChild(document.createTextNode(
            `\nResult indices in sorted array: ${result[0]}, ${result[1]}.\n` +
            `Numbers: ${sortedArr[result[0]]}, ${sortedArr[result[1]]}`
          ));
        }
      } else if (problemSelect.value === 'removeDuplicates') {
        // sorted array required for remove duplicates
        const sortedArr = [...arr].sort((a,b) => a-b);
        const { steps, newLength, arr: modifiedArr } = removeDuplicates(sortedArr);
        await animateRemoveDuplicates(steps, sortedArr);
        resultEl.appendChild(document.createTextNode(
          `\nNew length after removing duplicates: ${newLength}\n` +
          `Modified array (unique elements first): [${modifiedArr.slice(0, newLength).join(', ')}]`
        ));
      }
    };

    // Initial toggle
    problemSelect.dispatchEvent(new Event('change'));
  </script>
</body>
</html>