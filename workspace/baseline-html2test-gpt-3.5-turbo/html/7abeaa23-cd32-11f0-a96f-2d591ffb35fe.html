<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Insertion Sort Visualization</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 2em;
    background: #f0f2f5;
  }
  h1 {
    text-align: center;
    color: #333;
  }
  #controls {
    max-width: 600px;
    margin: 1.5em auto;
    text-align: center;
  }
  input[type="text"] {
    width: 300px;
    padding: 0.4em;
    font-size: 1em;
    border: 1px solid #aaa;
    border-radius: 3px;
  }
  button {
    margin-left: 1em;
    padding: 0.5em 1.2em;
    font-size: 1em;
    border: none;
    background-color: #007bff;
    color: white;
    border-radius: 3px;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  button:disabled {
    background-color: #a1c8ff;
    cursor: not-allowed;
  }
  button:hover:not(:disabled) {
    background-color: #0056b3;
  }
  #array-container {
    max-width: 700px;
    min-height: 100px;
    margin: 2em auto;
    display: flex;
    justify-content: center;
    align-items: flex-end;
    gap: 5px;
    border: 1px solid #ddd;
    background: white;
    padding: 1em;
    border-radius: 5px;
  }
  .bar {
    background-color: #3498db;
    color: white;
    width: 30px;
    display: flex;
    justify-content: center;
    align-items: flex-end;
    font-size: 0.85em;
    border-radius: 3px 3px 0 0;
    position: relative;
    transition: all 0.3s ease;
  }
  .bar.highlight {
    background-color: #e74c3c;
  }
  .bar.compared {
    background-color: #f39c12;
  }
  .bar.insertion {
    background-color: #2ecc71;
  }
  .bar-label {
    position: absolute;
    top: -20px;
    width: 100%;
    text-align: center;
    font-weight: bold;
    color: #555;
    user-select:none;
  }
  #info {
    max-width: 700px;
    margin: 0 auto;
    text-align: center;
    color: #444;
  }
  #speed-label {
    margin-left: 1em;
    font-size: 0.9em;
    color: #555;
  }
  #speed {
    vertical-align: middle;
  }
</style>
</head>
<body>

<h1>Insertion Sort Visualization</h1>
<div id="controls">
  <input id="input-array" type="text" placeholder="Enter numbers separated by commas (e.g. 5,3,8,6)" />
  <button id="start-btn">Start Sorting</button>
  <label id="speed-label">Speed:
    <input type="range" id="speed" min="50" max="1500" value="500" step="50" />
  </label>
</div>

<div id="array-container"></div>

<div id="info">
  <p><strong>Instructions:</strong> Enter a list of integers separated by commas and press "Start Sorting". Watch the algorithm insert elements into their correct position step by step.</p>
</div>

<script>
  const inputArray = document.getElementById('input-array');
  const startBtn = document.getElementById('start-btn');
  const arrayContainer = document.getElementById('array-container');
  const speedInput = document.getElementById('speed');

  let array = [];
  let bars = [];
  let delay = 500;

  speedInput.addEventListener('input', () => {
    delay = Number(speedInput.value);
  });

  function createBars(arr) {
    arrayContainer.innerHTML = '';
    bars = [];
    const maxVal = Math.max(...arr);
    for (let i = 0; i < arr.length; i++) {
      const bar = document.createElement('div');
      bar.classList.add('bar');
      bar.style.height = `${(arr[i] / maxVal) * 100 + 20}px`;
      bar.textContent = arr[i];
      arrayContainer.appendChild(bar);
      bars.push(bar);
    }
  }

  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  async function insertionSort(arr) {
    startBtn.disabled = true;
    inputArray.disabled = true;
    speedInput.disabled = true;

    const n = arr.length;
    for (let i = 1; i < n; i++) {
      let key = arr[i];
      let j = i - 1;

      // Highlight the key bar
      bars[i].classList.add('insertion');

      await sleep(delay);

      while (j >= 0 && arr[j] > key) {
        // Highlight the bar being compared
        bars[j].classList.add('compared');
        bars[j+1].classList.add('highlight');

        await sleep(delay);

        arr[j + 1] = arr[j];
        bars[j + 1].style.height = bars[j].style.height;
        bars[j + 1].textContent = arr[j];
        
        // Remove previous highlights
        bars[j].classList.remove('compared');
        bars[j+1].classList.remove('highlight');

        j = j - 1;
      }
      arr[j + 1] = key;
      bars[j + 1].style.height = `${(key / Math.max(...arr)) * 100 + 20}px`;
      bars[j + 1].textContent = key;

      // Move highlight from old position to new position
      for(let k=0; k < bars.length; k++){
        bars[k].classList.remove('insertion');
      }
      bars[j + 1].classList.add('insertion');

      await sleep(delay);

      bars[j + 1].classList.remove('insertion');
    }

    // Final colors to indicate sorted array
    for(let bar of bars){
      bar.classList.add('insertion');
      await sleep(30);
    }

    startBtn.disabled = false;
    inputArray.disabled = false;
    speedInput.disabled = false;
  }

  startBtn.addEventListener('click', () => {
    const input = inputArray.value.trim();
    if (!input) {
      alert('Please enter some numbers separated by commas.');
      return;
    }
    let tempArr = input.split(',').map(x => x.trim());
    if (tempArr.some(x => isNaN(Number(x)) || x === '')) {
      alert('Please enter only valid numbers separated by commas.');
      return;
    }
    array = tempArr.map(Number);
    createBars(array);
    insertionSort(array);
  });

</script>
</body>
</html>