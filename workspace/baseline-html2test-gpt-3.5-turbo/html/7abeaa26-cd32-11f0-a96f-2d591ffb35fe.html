<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Heap Sort Visualization</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f0f2f5;
  }
  h1 {
    text-align: center;
    margin-bottom: 0.5em;
  }
  #controls {
    max-width: 600px;
    margin: 0 auto 20px auto;
    text-align: center;
  }
  #arrayInput {
    width: 80%;
    padding: 8px;
    font-size: 1em;
  }
  button {
    padding: 10px 15px;
    margin: 5px;
    font-size: 1em;
    cursor: pointer;
  }
  #bars {
    max-width: 600px;
    height: 300px;
    margin: 20px auto;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    border: 1px solid #ccc;
    background: white;
    position: relative;
  }
  .bar {
    background-color: #4a90e2;
    margin: 0 2px;
    width: 20px;
    text-align: center;
    color: white;
    font-size: 0.8em;
    border-radius: 3px 3px 0 0;
    transition: background-color 0.3s ease;
    user-select: none;
  }
  .bar.highlight {
    background-color: #e94e77;
  }
  .bar.swap {
    background-color: #f5a623;
  }
  #description {
    max-width: 600px;
    margin: 20px auto;
    font-size: 0.9em;
    line-height: 1.4em;
    background: white;
    padding: 15px 20px;
    border-radius: 6px;
    box-shadow: 0 0 5px #ccc;
  }
</style>
</head>
<body>
<h1>Heap Sort Visualization</h1>
<div id="controls">
  <input id="arrayInput" type="text" placeholder="Enter numbers separated by commas" />
  <button id="generateBtn">Generate Random Array</button>
  <button id="startBtn">Start Heap Sort</button>
</div>
<div id="bars"></div>
<div id="description">
  Enter a comma-separated list of numbers or generate a random array, then click “Start Heap Sort” to see the sorting process step by step. The red bars indicate elements being compared or considered, orange bars are elements being swapped.
</div>

<script>
  const barsContainer = document.getElementById("bars");
  const arrayInput = document.getElementById("arrayInput");
  const startBtn = document.getElementById("startBtn");
  const generateBtn = document.getElementById("generateBtn");

  let array = [];
  let speed = 500; // delay in ms

  function generateRandomArray(size = 20, maxVal = 100) {
    const arr = [];
    for (let i = 0; i < size; i++) {
      arr.push(Math.floor(Math.random() * maxVal) + 1);
    }
    return arr;
  }

  function renderArray(arr, highlights = [], swaps = []) {
    barsContainer.innerHTML = "";
    const maxVal = Math.max(...arr);
    arr.forEach((val, i) => {
      const bar = document.createElement("div");
      bar.classList.add("bar");
      if (highlights.includes(i)) bar.classList.add("highlight");
      if (swaps.includes(i)) bar.classList.add("swap");
      bar.style.height = (val / maxVal) * 100 + "%";
      bar.textContent = val;
      barsContainer.appendChild(bar);
    });
  }

  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  async function heapSort(arr) {
    let n = arr.length;

    // Build max heap
    for (let i = Math.floor(n / 2) - 1; i >= 0; i--) {
      await heapify(arr, n, i);
    }

    // One by one extract element from heap
    for (let i = n - 1; i > 0; i--) {
      // Move current root to end
      [arr[0], arr[i]] = [arr[i], arr[0]];
      renderArray(arr, [], [0, i]);
      await sleep(speed);

      // call max heapify on the reduced heap
      await heapify(arr, i, 0);
    }
  }

  async function heapify(arr, n, i) {
    let largest = i;
    let l = 2 * i + 1;
    let r = 2 * i + 2;

    // Highlight the current root being heapified
    renderArray(arr, [i]);
    await sleep(speed);

    if (l < n) {
      renderArray(arr, [i, l]);
      await sleep(speed);
      if (arr[l] > arr[largest]) {
        largest = l;
      }
    }

    if (r < n) {
      renderArray(arr, [i, r]);
      await sleep(speed);
      if (arr[r] > arr[largest]) {
        largest = r;
      }
    }

    if (largest !== i) {
      [arr[i], arr[largest]] = [arr[largest], arr[i]];
      renderArray(arr, [], [i, largest]);
      await sleep(speed);
      await heapify(arr, n, largest);
    }
  }

  function parseInput(input) {
    return input
      .split(",")
      .map(x => x.trim())
      .filter(x => x !== "")
      .map(Number)
      .filter(x => !isNaN(x));
  }

  generateBtn.addEventListener("click", () => {
    array = generateRandomArray(20, 100);
    arrayInput.value = array.join(", ");
    renderArray(array);
  });

  startBtn.addEventListener("click", async () => {
    let inputArr = parseInput(arrayInput.value);
    if (inputArr.length === 0) {
      alert("Please enter a valid array of numbers.");
      return;
    }
    array = [...inputArr];
    startBtn.disabled = true;
    generateBtn.disabled = true;
    arrayInput.disabled = true;
    try {
      await heapSort(array);
    } catch (e) {
      console.error(e);
    }
    renderArray(array);
    startBtn.disabled = false;
    generateBtn.disabled = false;
    arrayInput.disabled = false;
  });

  // Initialize with random array
  array = generateRandomArray(20, 100);
  arrayInput.value = array.join(", ");
  renderArray(array);
</script>
</body>
</html>