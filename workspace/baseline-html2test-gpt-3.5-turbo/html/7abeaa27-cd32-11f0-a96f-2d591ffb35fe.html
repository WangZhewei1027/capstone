<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Counting Sort Demonstration</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 30px;
    max-width: 700px;
    line-height: 1.6;
    background-color: #f9f9f9;
  }
  h1 {
    text-align: center;
    color: #004080;
  }
  label {
    font-weight: bold;
  }
  input, button {
    font-size: 16px;
    padding: 6px 10px;
    margin-top: 8px;
  }
  input[type="text"] {
    width: 80%;
    margin-right: 10px;
  }
  #output {
    background: #fff;
    padding: 15px;
    border: 2px solid #ddd;
    margin-top: 20px;
    min-height: 120px;
    white-space: pre-wrap;
    font-family: 'Courier New', monospace;
  }
  .step {
    margin-bottom: 15px;
    background: #eef6ff;
    border-left: 5px solid #0077cc;
    padding: 10px 15px;
    border-radius: 4px;
  }
  .error {
    color: #b00020;
    margin-top: 10px;
  }
</style>
</head>
<body>
  <h1>Counting Sort Algorithm Visualization</h1>

  <label for="arrayInput">Enter integers (comma or space separated):</label><br/>
  <input type="text" id="arrayInput" placeholder="e.g. 4, 2, 2, 8, 3, 3, 1" />
  <button id="sortBtn">Sort</button>
  <div id="errorMsg" class="error"></div>

  <div id="output"></div>

<script>
/**
 * Counting Sort visualization.
 */

const arrayInput = document.getElementById('arrayInput');
const sortBtn = document.getElementById('sortBtn');
const output = document.getElementById('output');
const errorMsg = document.getElementById('errorMsg');

sortBtn.addEventListener('click', () => {
  errorMsg.textContent = '';
  output.innerHTML = '';
  let inputStr = arrayInput.value.trim();

  if (!inputStr) {
    errorMsg.textContent = 'Please enter at least one integer.';
    return;
  }

  // Parse input into array of integers
  let arr = inputStr.split(/[\s,]+/).map(x => x.trim()).filter(x => x !== '');
  let nums = [];
  for(let v of arr){
    if(!/^[-+]?\d+$/.test(v)){
      errorMsg.textContent = 'Invalid input: only integers are allowed.';
      return;
    }
    nums.push(parseInt(v, 10));
  }

  if(nums.length === 0){
    errorMsg.textContent = 'Please enter valid integers.';
    return;
  }

  // Determine range for counting sort
  let min = Math.min(...nums);
  let max = Math.max(...nums);

  if(max - min > 100000){
    errorMsg.textContent = 'Range too large for counting sort visualization. Max - min should be <= 100000.';
    return;
  }

  countingSortVisual(nums, min, max);
});

function countingSortVisual(arr, min, max){
  output.innerHTML = '';
  const n = arr.length;
  let steps = [];

  // Step 1: Show original array
  steps.push({
    title: 'Original Array',
    desc: `The input array is:\n[ ${arr.join(', ')} ]`
  });

  // Step 2: Initialize count array
  const range = max - min + 1;
  let count = new Array(range).fill(0);

  steps.push({
    title: 'Initialize Count Array',
    desc: `Count array initialized with zeros. Length = max - min + 1 = ${range}\n` +
          `count = [${count.join(', ')}]`
  });

  // Step 3: Store count of each number
  for(let num of arr){
    count[num - min]++;
  }
  steps.push({
    title: 'Count Frequencies',
    desc: 'Count each number\'s occurrences:\n' +
          `count = [${count.join(', ')}]\n` +
          'Index in count corresponds to (value - min).'
  });

  // Step 4: Modify count array to store cumulative counts
  for(let i = 1; i < count.length; i++){
    count[i] += count[i -1];
  }
  steps.push({
    title: 'Cumulative Count',
    desc: 'Update count array to contain cumulative sums:\n' +
          `count = [${count.join(', ')}]\n` +
          'This helps to place elements directly in output array.'
  });

  // Step 5: Build output array
  let outputArr = new Array(n);
  // Iterate backward to make Counting Sort stable
  for(let i = n -1; i >= 0; i--){
    let current = arr[i];
    count[current - min]--;
    let position = count[current - min];
    outputArr[position] = current;
  }
  steps.push({
    title: 'Build Sorted Output',
    desc: `Place each element in output array using cumulative count indices, iterating backward for stable sort.\n` +
          `Sorted array:\n[ ${outputArr.join(', ')} ]`
  });

  // Step 6: Final sorted array
  steps.push({
    title: 'Final Sorted Array',
    desc: `[ ${outputArr.join(', ')} ]`
  });

  displaySteps(steps);
}

function displaySteps(steps){
  output.innerHTML = '';
  steps.forEach((step, i) => {
    let stepDiv = document.createElement('div');
    stepDiv.className = 'step';
    stepDiv.innerHTML = `<strong>Step ${i + 1}: ${step.title}</strong>\n<pre>${step.desc}</pre>`;
    output.appendChild(stepDiv);
  });
}
</script>
</body>
</html>