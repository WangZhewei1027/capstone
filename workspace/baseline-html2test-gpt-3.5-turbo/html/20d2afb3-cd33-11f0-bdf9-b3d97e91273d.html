<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Selection Sort Demonstration</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f0f0f0;
      color: #333;
    }
    h1 {
      text-align: center;
    }
    #arrayInput {
      width: 100%;
      max-width: 400px;
      font-size: 1.2em;
      padding: 8px;
      margin: 10px 0;
    }
    #startBtn {
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
      background-color: #007BFF;
      border: none;
      color: white;
      border-radius: 4px;
      margin-bottom: 20px;
    }
    #startBtn:disabled {
      background-color: #6c757d;
      cursor: not-allowed;
    }
    #arrayContainer {
      display: flex;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
      max-width: 800px;
      margin: 0 auto 20px auto;
      min-height: 60px;
    }
    .array-bar {
      background-color: #6c757d;
      color: white;
      text-align: center;
      border-radius: 4px;
      font-weight: bold;
      user-select: none;
      transition: background-color 0.3s, transform 0.3s;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      position: relative;
      font-size: 14px;
    }
    /* Height relative to value */
    /* We'll set height inline per value */
    .current-min {
      background-color: #d9534f !important;
    }
    .current-i {
      background-color: #0275d8 !important;
    }
    .current-j {
      background-color: #5bc0de !important;
    }
    .swapping {
      background-color: #f0ad4e !important;
      transform: scale(1.2);
      z-index: 10;
    }
    #explanation {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      padding: 15px 20px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      font-size: 1.1em;
      min-height: 60px;
    }
    footer {
      margin-top: 30px;
      text-align: center;
      font-size: 0.9em;
      color: #666;
    }
  </style>
</head>
<body>
  <h1>Selection Sort Visualization</h1>
  <p>Enter a list of numbers separated by commas (e.g. 5,3,8,6,2)</p>
  <input type="text" id="arrayInput" value="64,25,12,22,11" aria-label="Array input" />
  <br />
  <button id="startBtn">Start Sorting</button>

  <div id="arrayContainer" aria-live="polite" aria-atomic="true" aria-label="Array visualization"></div>

  <div id="explanation" aria-live="polite"></div>

  <footer>
    &copy; 2024 Selection Sort Demo
  </footer>

<script>
  (function () {
    const arrayInput = document.getElementById("arrayInput");
    const startBtn = document.getElementById("startBtn");
    const arrayContainer = document.getElementById("arrayContainer");
    const explanation = document.getElementById("explanation");

    let array = [];
    let bars = [];
    const BAR_WIDTH = 40;
    const BAR_MAX_HEIGHT = 200; // px

    // Helpers
    function createBars(arr) {
      arrayContainer.innerHTML = "";
      bars = [];
      const maxVal = Math.max(...arr,1);
      for (let i = 0; i < arr.length; i++) {
        const val = arr[i];
        const bar = document.createElement("div");
        bar.classList.add("array-bar");
        bar.style.height = `${(val / maxVal) * BAR_MAX_HEIGHT + 20}px`;
        bar.style.width = `${BAR_WIDTH}px`;
        bar.textContent = val;
        bar.setAttribute("data-index", i);
        arrayContainer.appendChild(bar);
        bars.push(bar);
      }
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    function setExplanation(text) {
      explanation.textContent = text;
    }

    function clearHighlights() {
      bars.forEach(bar => {
        bar.classList.remove("current-i", "current-j", "current-min", "swapping");
      });
    }

    async function selectionSortVisual(arr) {
      // Disable UI buttons
      startBtn.disabled = true;
      arrayInput.disabled = true;

      const n = arr.length;
      for (let i = 0; i < n - 1; i++) {
        let min_idx = i;
        clearHighlights();
        bars[i].classList.add("current-i");
        setExplanation(`Select position ${i} as current minimum temporarily.`);
        await sleep(1000);

        for (let j = i + 1; j < n; j++) {
          clearHighlights();
          bars[i].classList.add("current-i");
          bars[min_idx].classList.add("current-min");
          bars[j].classList.add("current-j");
          setExplanation(`Comparing element at index ${j} (${arr[j]}) with current minimum at index ${min_idx} (${arr[min_idx]}).`);

          await sleep(1000);
          if (arr[j] < arr[min_idx]) {
            bars[min_idx].classList.remove("current-min");
            min_idx = j;
            bars[min_idx].classList.add("current-min");
            setExplanation(`Found new minimum value ${arr[min_idx]} at index ${min_idx}.`);
            await sleep(1000);
          }
        }

        if (min_idx !== i) {
          // Swap
          setExplanation(`Swapping element at index ${i} (${arr[i]}) with new minimum at index ${min_idx} (${arr[min_idx]}).`);
          bars[i].classList.add("swapping");
          bars[min_idx].classList.add("swapping");
          await sleep(1000);

          // Swap in array
          [arr[i], arr[min_idx]] = [arr[min_idx], arr[i]];
          updateBars(arr);

          await sleep(1000);
          bars[i].classList.remove("swapping");
          bars[min_idx].classList.remove("swapping");
        } else {
          setExplanation(`No swap needed since element at index ${i} is already minimum.`);
          await sleep(1000);
        }
      }
      clearHighlights();
      setExplanation("Array is sorted!");
      startBtn.disabled = false;
      arrayInput.disabled = false;
    }

    // Update bar heights and labels after swap/change
    function updateBars(arr) {
      const maxVal = Math.max(...arr,1);
      for (let i = 0; i < bars.length; i++) {
        bars[i].style.height = `${(arr[i] / maxVal) * BAR_MAX_HEIGHT + 20}px`;
        bars[i].textContent = arr[i];
      }
    }

    function validateAndParseInput(text) {
      const parts = text.split(",");
      const nums = [];
      for (let p of parts) {
        const trimmed = p.trim();
        if(trimmed === '') continue;
        if (isNaN(trimmed)) return null;
        nums.push(Number(trimmed));
      }
      return nums.length ? nums : null;
    }

    startBtn.addEventListener("click", () => {
      const inputText = arrayInput.value;
      const parsed = validateAndParseInput(inputText);
      if (!parsed) {
        alert("Please enter a valid list of numbers separated by commas.");
        return;
      }
      array = parsed;
      createBars(array);
      selectionSortVisual(array);
    });

    // Initial render
    array = [64, 25, 12, 22, 11];
    createBars(array);
    setExplanation("Click 'Start Sorting' to begin the selection sort visualization.");
  })();
</script>
</body>
</html>