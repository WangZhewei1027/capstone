<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Insertion Sort Visualization</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #fafafa;
    color: #333;
  }
  h1 {
    text-align: center;
  }
  #arrayContainer {
    display: flex;
    justify-content: center;
    margin: 20px 0;
    height: 250px;
    align-items: flex-end;
  }
  .bar {
    margin: 0 2px;
    width: 20px;
    background-color: steelblue;
    text-align: center;
    color: white;
    font-size: 12px;
    border-radius: 3px 3px 0 0;
    user-select: none;
    position: relative;
  }
  .bar.inserting {
    background-color: #e67e22;
  }
  .bar.compared {
    background-color: #c0392b;
  }
  .bar.sorted {
    background-color: #27ae60;
  }
  button {
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
  }
  #speedControl {
    margin-left: 15px;
  }
  label {
    font-size: 14px;
  }
  #controls {
    text-align: center;
  }
  #description {
    max-width: 600px;
    margin: 0 auto 30px auto;
    font-size: 16px;
    line-height: 1.4em;
  }
</style>
</head>
<body>
<h1>Insertion Sort Visualization</h1>
<div id="description">
  <p>
    Insertion Sort is a simple sorting algorithm that builds the final sorted array one item at a time by comparing and inserting elements into their correct position.
  </p>
  <p>
    Observe the bars below representing array elements. Click "Start Sort" to see how Insertion Sort works step-by-step.
  </p>
</div>
<div id="arrayContainer"></div>
<div id="controls">
  <button id="startBtn">Start Sort</button>
  <label for="speedControl">Animation Speed:</label>
  <select id="speedControl">
    <option value="500">Slow</option>
    <option value="200" selected>Normal</option>
    <option value="50">Fast</option>
  </select>
</div>

<script>
  const arrayContainer = document.getElementById('arrayContainer');
  const startBtn = document.getElementById('startBtn');
  const speedControl = document.getElementById('speedControl');

  const ARRAY_SIZE = 20;
  let array = [];
  let animationSpeed = parseInt(speedControl.value);

  function generateRandomArray(size, min = 10, max = 200) {
    const arr = [];
    for(let i = 0; i < size; i++) {
      arr.push(Math.floor(Math.random() * (max - min + 1)) + min);
    }
    return arr;
  }

  function createBars(arr) {
    arrayContainer.innerHTML = '';
    arr.forEach(value => {
      const bar = document.createElement('div');
      bar.classList.add('bar');
      bar.style.height = value + 'px';
      bar.textContent = value;
      arrayContainer.appendChild(bar);
    });
  }

  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  async function insertionSort(arr) {
    const bars = arrayContainer.children;
    for(let i = 1; i < arr.length; i++) {
      let key = arr[i];
      let j = i - 1;

      // Highlight the "inserting" bar
      bars[i].classList.add('inserting');
      await sleep(animationSpeed);

      while(j >= 0 && arr[j] > key) {
        // Highlight compared bars
        bars[j].classList.add('compared');
        bars[j + 1].classList.add('compared');
        await sleep(animationSpeed);

        arr[j + 1] = arr[j];

        // Update bar height and text
        bars[j + 1].style.height = bars[j].style.height;
        bars[j + 1].textContent = bars[j].textContent;

        // Remove comparison highlight from bars[j+1]
        bars[j + 1].classList.remove('compared');
        bars[j].classList.remove('compared');

        j--;
      }
      arr[j + 1] = key;

      // Place the key bar to the correct position
      bars[j + 1].style.height = key + 'px';
      bars[j + 1].textContent = key;

      // Remove insertion highlight
      bars[i].classList.remove('inserting');
      
      // Mark all bars from 0 to i as sorted
      for(let k = 0; k <= i; k++) {
        bars[k].classList.add('sorted');
      }
      await sleep(animationSpeed);
    }
  }

  function reset() {
    array = generateRandomArray(ARRAY_SIZE);
    createBars(array);
    // Remove all classes
    const bars = arrayContainer.children;
    for(let bar of bars) {
      bar.classList.remove('sorted', 'compared', 'inserting');
    }
  }

  speedControl.addEventListener('change', e => {
    animationSpeed = parseInt(e.target.value);
  });

  startBtn.addEventListener('click', async () => {
    startBtn.disabled = true;
    speedControl.disabled = true;
    await insertionSort(array);
    startBtn.disabled = false;
    speedControl.disabled = false;
  });

  // Initialize first array
  reset();
</script>
</body>
</html>