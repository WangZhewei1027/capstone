<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Quick Sort Visualization</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f0f2f5;
    color: #333;
  }
  h1 {
    text-align: center;
  }
  #inputArea {
    text-align: center;
    margin-bottom: 15px;
  }
  #arrayInput {
    width: 300px;
    font-size: 1em;
    padding: 5px;
  }
  button {
    font-size: 1em;
    padding: 6px 12px;
    margin-left: 10px;
    cursor: pointer;
  }
  #visualizer {
    margin: 20px auto;
    width: 90%;
    max-width: 800px;
    height: 300px;
    border: 1px solid #ccc;
    position: relative;
    background: #fff;
    display: flex;
    align-items: flex-end;
    justify-content: center;
  }
  .bar {
    margin: 0 2px;
    background-color: #69a3ff;
    width: 20px;
    transition: all 0.3s ease;
    position: relative;
  }
  .bar.pivot {
    background-color: #ff6b6b !important;
  }
  .bar.compare {
    background-color: #f3c623 !important;
  }
  .bar.swap {
    background-color: #47d147 !important;
  }
  .bar.sorted {
    background-color: #6bcf69 !important;
  }
  #legend {
    max-width: 800px;
    margin: 10px auto 0 auto;
    display: flex;
    justify-content: center;
    gap: 20px;
  }
  .legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .legend-color {
    width: 20px;
    height: 20px;
    background-color: #69a3ff;
  }
  .legend-pivot {
    background-color: #ff6b6b !important;
  }
  .legend-compare {
    background-color: #f3c623 !important;
  }
  .legend-swap {
    background-color: #47d147 !important;
  }
  .legend-sorted {
    background-color: #6bcf69 !important;
  }
  #speedControl {
    margin-top: 15px;
    text-align: center;
  }
  label {
    font-size: 0.9em;
  }
</style>
</head>
<body>

<h1>Quick Sort Visualization</h1>

<div id="inputArea">
  <input id="arrayInput" type="text" placeholder="Enter numbers separated by commas" value="25,17,31,13,2,8,24,42,7" />
  <button id="startBtn">Start Quick Sort</button>
</div>

<div id="speedControl">
  <label for="speedRange">Animation Speed: </label>
  <input type="range" id="speedRange" min="100" max="2000" value="500" step="100" />
  <span id="speedVal">500 ms</span>
</div>

<div id="visualizer"></div>

<div id="legend">
  <div class="legend-item"><div class="legend-color"></div>Normal</div>
  <div class="legend-item"><div class="legend-color legend-pivot"></div>Pivot</div>
  <div class="legend-item"><div class="legend-color legend-compare"></div>Comparing</div>
  <div class="legend-item"><div class="legend-color legend-swap"></div>Swapping</div>
  <div class="legend-item"><div class="legend-color legend-sorted"></div>Sorted</div>
</div>

<script>
  (function(){
    const visualizer = document.getElementById('visualizer');
    const startBtn = document.getElementById('startBtn');
    const arrayInput = document.getElementById('arrayInput');
    const speedRange = document.getElementById('speedRange');
    const speedVal = document.getElementById('speedVal');

    let array = [];
    let bars = [];
    let delay = +speedRange.value;

    speedRange.addEventListener('input', () => {
      delay = +speedRange.value;
      speedVal.textContent = delay + ' ms';
    });

    function createBars(arr) {
      visualizer.innerHTML = '';
      bars = [];
      const maxVal = Math.max(...arr, 10);
      const containerWidth = visualizer.clientWidth;
      const barWidth = Math.min(30, Math.floor(containerWidth / arr.length) - 4);
      arr.forEach(val => {
        const bar = document.createElement('div');
        bar.classList.add('bar');
        bar.style.height = (val / maxVal * 100) + '%';
        bar.style.width = barWidth + 'px';
        bar.title = val;
        visualizer.appendChild(bar);
        bars.push(bar);
      });
    }

    async function quickSort(arr, left = 0, right = arr.length - 1) {
      if (left < right) {
        let pivotIndex = await partition(arr, left, right);
        // mark pivot as sorted
        bars[pivotIndex].classList.add('sorted');
        await quickSort(arr, left, pivotIndex - 1);
        await quickSort(arr, pivotIndex + 1, right);
      } else if (left === right) {
        bars[left].classList.add('sorted');
      }
    }

    async function partition(arr, left, right) {
      // pivot is last element
      let pivotVal = arr[right];
      highlightPivot(right);
      let i = left - 1;

      for (let j = left; j < right; j++) {
        highlightCompare(j);
        await sleep(delay);
        if (arr[j] <= pivotVal) {
          i++;
          if(i !== j) {
            await swap(arr, i, j);
          }
          clearCompare(j);
        } else {
          clearCompare(j);
        }
      }
      if(i + 1 !== right) {
        await swap(arr, i + 1, right);
      }
      clearPivot(right);
      return i + 1;
    }

    function highlightPivot(index) {
      bars[index].classList.add('pivot');
    }
    function clearPivot(index) {
      bars[index].classList.remove('pivot');
    }
    function highlightCompare(index) {
      bars[index].classList.add('compare');
    }
    function clearCompare(index) {
      bars[index].classList.remove('compare');
    }
    async function swap(arr, i, j) {
      // highlight bars being swapped
      bars[i].classList.add('swap');
      bars[j].classList.add('swap');
      await sleep(delay);

      // swap heights & values
      let tempHeight = bars[i].style.height;
      bars[i].style.height = bars[j].style.height;
      bars[j].style.height = tempHeight;

      let tempVal = arr[i];
      arr[i] = arr[j];
      arr[j] = tempVal;

      bars[i].title = arr[i];
      bars[j].title = arr[j];

      await sleep(delay);
      bars[i].classList.remove('swap');
      bars[j].classList.remove('swap');
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    startBtn.addEventListener('click', async () => {
      // Parse input array
      let inputStr = arrayInput.value.trim();
      if (!inputStr) return;
      let parsedArr = inputStr.split(',').map(x => parseInt(x.trim())).filter(x => !isNaN(x));
      if(parsedArr.length === 0) return alert('Please enter a valid list of numbers separated by commas.');

      array = parsedArr;
      createBars(array);
      startBtn.disabled = true;
      arrayInput.disabled = true;
      speedRange.disabled = true;

      await quickSort(array);

      startBtn.disabled = false;
      arrayInput.disabled = false;
      speedRange.disabled = false;
    });

    // Initialize the view with default input
    (()=>{
      const initialArr = arrayInput.value.split(',').map(x => parseInt(x.trim())).filter(x => !isNaN(x));
      array = initialArr;
      createBars(array);
    })();

  })();
</script>

</body>
</html>