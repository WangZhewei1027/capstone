<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Radix Sort Visualization</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f5f5f5;
  }
  h1 {
    text-align: center;
  }
  #inputSection {
    max-width: 600px;
    margin: 0 auto 1.5em;
    display: flex;
    flex-wrap: wrap;
    gap: 0.5em;
    align-items: center;
    justify-content: center;
  }
  label {
    flex: 1 0 140px;
    font-weight: bold;
  }
  input[type="text"] {
    flex: 3 0 250px;
    font-size: 1em;
    padding: 0.3em;
  }
  button {
    padding: 0.5em 1em;
    font-size: 1em;
    cursor: pointer;
    border-radius: 4px;
    border: none;
    background: #007bff;
    color: white;
    transition: background 0.3s ease;
  }
  button:hover:not(:disabled) {
    background: #0056b3;
  }
  button:disabled {
    opacity: 0.6;
    cursor: default;
  }
  #arrayDisplay {
    max-width: 800px;
    margin: 0 auto 1em;
    text-align: center;
    font-family: monospace;
    font-size: 1.25em;
    word-wrap: break-word;
  }
  #steps {
    max-width: 900px;
    margin: 0 auto;
    background: white;
    border-radius: 8px;
    padding: 1em;
    box-shadow: 0 2px 6px rgb(0 0 0 / 0.2);
  }
  .step {
    margin-bottom: 1em;
    border-bottom: 1px solid #ddd;
    padding-bottom: 0.8em;
  }
  .step:last-child {
    border-bottom: none;
  }
  .step h3 {
    margin: 0 0 0.4em 0;
    font-size: 1.15em;
    color: #333;
  }
  .buckets {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
  }
  .bucket {
    flex: 1 0 40px;
    background: #e0e7ff;
    border-radius: 6px;
    padding: 6px 4px;
    text-align: center;
    min-width: 40px;
  }
  .bucket h4 {
    margin: 0 0 0.2em 0;
    font-weight: bold;
    color: #3b49df;
  }
  .bucketNumbers {
    font-family: monospace;
    font-size: 1em;
    min-height: 18px;
  }
  #legend {
    max-width: 900px;
    margin: 2em auto 0;
    font-size: 0.9em;
    color: #555;
  }
  #footer {
    margin-top: 4em;
    text-align: center;
    font-size: 0.8em;
    color: #999;
  }
  @media(max-width: 500px) {
    #inputSection {
      flex-direction: column;
      align-items: stretch;
    }
    label, input[type="text"], button {
      flex: none;
      width: 100%;
    }
    .buckets {
      gap: 6px;
    }
    .bucket {
      flex: 1 0 30px;
      min-width: 30px;
      font-size: 0.9em;
      padding: 6px 2px;
    }
  }
</style>
</head>
<body>
<h1>Radix Sort Demonstration</h1>
<section id="inputSection" aria-label="Input and controls for Radix Sort demo">
  <label for="numberInput">Enter positive integers (comma separated):</label>
  <input type="text" id="numberInput" placeholder="e.g. 170,45,75,90,802,24,2,66" aria-describedby="errorMsg" />
  <button id="sortBtn">Start Radix Sort</button>
</section>
<div id="errorMsg" role="alert" style="color:#b00020; text-align:center; min-height:1.2em;"></div>
<section id="arrayDisplay" aria-live="polite" aria-atomic="true"></section>
<section id="steps" aria-live="polite" aria-atomic="true"></section>

<div id="legend">
  <strong>Note:</strong> This visualization shows each pass of Radix Sort by sorting numbers digit by digit,
  starting from the least significant digit (units place) to the most significant digit.<br />
  Each step shows the buckets created for that digit, and the resulting array after collecting numbers from buckets.
</div>

<div id="footer">
  &copy; 2024 Radix Sort Demo by ChatGPT
</div>

<script>
(() => {
  const input = document.getElementById('numberInput');
  const btn = document.getElementById('sortBtn');
  const stepsContainer = document.getElementById('steps');
  const arrayDisplay = document.getElementById('arrayDisplay');
  const errorMsg = document.getElementById('errorMsg');

  // Utility functions
  function isValidNumberArray(arr) {
    return arr.every(n => Number.isInteger(n) && n >= 0);
  }

  function parseInput(str) {
    if (!str.trim()) return [];
    return str.split(',')
      .map(s => s.trim())
      .filter(s => s.length > 0)
      .map(s => Number(s));
  }

  function displayArray(arr) {
    arrayDisplay.textContent = 'Current array: [' + arr.join(', ') + ']';
  }

  function createBucketDivs(buckets) {
    const container = document.createElement('div');
    container.className = 'buckets';
    for(let i = 0; i < buckets.length; i++) {
      const b = document.createElement('div');
      b.className = 'bucket';
      b.setAttribute('aria-label', `Bucket ${i}`);
      const title = document.createElement('h4');
      title.textContent = i;
      const nums = document.createElement('div');
      nums.className = 'bucketNumbers';
      nums.textContent = buckets[i].length > 0 ? buckets[i].join(', ') : 'â€”';
      b.appendChild(title);
      b.appendChild(nums);
      container.appendChild(b);
    }
    return container;
  }

  // Radix Sort implementation with step callbacks
  async function radixSortDemo(arr, stepCallback) {
    if (arr.length <= 1) {
      // No sorting needed
      await stepCallback(arr.slice(), 0, [[]]);
      return arr.slice();
    }

    let maxNumber = Math.max(...arr);
    let maxDigits = 0;
    while(maxNumber > 0) {
      maxDigits++;
      maxNumber = Math.floor(maxNumber / 10);
    }
    let result = arr.slice();

    for(let digitPos = 0; digitPos < maxDigits; digitPos++) {
      const buckets = Array.from({length:10}, () => []);
      const divisor = Math.pow(10, digitPos);

      for(const num of result) {
        const digit = Math.floor(num / divisor) % 10;
        buckets[digit].push(num);
      }
      await stepCallback(result.slice(), digitPos + 1, buckets);
      result = buckets.flat();
    }
    await stepCallback(result.slice(), maxDigits, [[]], true); // final sorted stage
    return result;
  }

  // Disable/Enable UI function
  function setUIEnabled(enabled) {
    input.disabled = !enabled;
    btn.disabled = !enabled;
  }

  // Main event logic
  btn.addEventListener('click', async () => {
    errorMsg.textContent = '';
    stepsContainer.innerHTML = '';
    arrayDisplay.textContent = '';

    // Parse and validate input
    const numbers = parseInput(input.value);
    if (numbers.length === 0) {
      errorMsg.textContent = 'Please enter at least one number.';
      return;
    }
    if (!isValidNumberArray(numbers)) {
      errorMsg.textContent = 'All values must be non-negative integers.';
      return;
    }
    if (numbers.some(n => n > 99999999)) {
      errorMsg.textContent = 'Numbers should be less than 100 million for this demo.';
      return;
    }

    setUIEnabled(false);
    displayArray(numbers);

    // Define a delay between steps in ms
    const stepDelay = 1200;

    async function onStep(arr, pass, buckets, final = false) {
      const stepDiv = document.createElement('div');
      stepDiv.className = 'step';
      stepDiv.setAttribute('aria-live', 'polite');

      if(final) {
        stepDiv.innerHTML = `<h3>Sorted array after all ${pass} passes:</h3>`;
        stepDiv.appendChild(document.createTextNode('[' + arr.join(', ') + ']'));
      } else {
        stepDiv.innerHTML = `<h3>Pass ${pass} (sorting by digit at position ${pass} from right):</h3>`;
        stepDiv.appendChild(createBucketDivs(buckets));
        const resultLine = document.createElement('p');
        resultLine.innerHTML = `<strong>Array after collecting buckets:</strong> [${arr.join(', ')}]`;
        stepDiv.appendChild(resultLine);
      }
      stepsContainer.appendChild(stepDiv);
      // Scroll to latest step smoothly
      stepDiv.scrollIntoView({behavior:'smooth', block:'center'});

      displayArray(arr);
      await new Promise(res => setTimeout(res, stepDelay));
    }

    // Perform the radix sort with visualization
    const sorted = await radixSortDemo(numbers, onStep);

    setUIEnabled(true);
  });
})();
</script>
</body>
</html>