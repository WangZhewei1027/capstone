<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Counting Sort Visualization</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f0f2f5;
    color: #333;
  }
  h1 {
    text-align: center;
  }
  #input-section {
    max-width: 600px;
    margin: 0 auto 30px;
    padding: 15px 20px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
  }
  label {
    font-weight: bold;
    display: block;
    margin-bottom: 8px;
  }
  input[type="text"] {
    width: 100%;
    font-size: 1rem;
    padding: 8px;
    border-radius: 4px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }
  button {
    margin-top: 15px;
    padding: 10px 20px;
    font-weight: 600;
    font-size: 1rem;
    color: white;
    background-color: #0077E6;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
  button:disabled {
    background-color: #999;
    cursor: not-allowed;
  }
  #output-section {
    max-width: 700px;
    margin: 0 auto;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 12px rgb(0 0 0 / 0.1);
    padding: 20px;
  }
  .step {
    margin-bottom: 30px;
  }
  .step-title {
    font-weight: 700;
    margin-bottom: 12px;
    font-size: 1.1rem;
    border-bottom: 2px solid #0077E6;
    padding-bottom: 4px;
  }
  .array-container {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: 8px;
  }
  .element {
    width: 30px;
    height: 30px;
    background: #0077E6;
    color: white;
    font-weight: 700;
    text-align: center;
    line-height: 30px;
    border-radius: 4px;
    user-select: none;
  }
  .count-element {
    width: 40px;
    height: 40px;
    background: #33a852;
    color: white;
    font-weight: 700;
    text-align: center;
    line-height: 40px;
    border-radius: 4px;
    user-select: none;
    position: relative;
  }
  .count-label {
    position: absolute;
    top: -18px;
    width: 100%;
    font-size: 0.8rem;
    color: #333;
  }
  .highlight {
    box-shadow: 0 0 8px 3px #ffbb33;
  }
  .info {
    font-style: italic;
    color: #666;
    margin-top: 8px;
  }
  #error-message {
    color: #cc0000;
    font-weight: 600;
    margin-top: 10px;
  }

  footer {
    margin-top: 40px;
    text-align: center;
    color: #777;
    font-size: 0.9rem;
  }
</style>
</head>
<body>
<h1>Counting Sort Demonstration</h1>

<section id="input-section" aria-label="Input Section">
  <label for="arrayInput">
    Enter a list of non-negative integers (comma or space separated):
  </label>
  <input
    id="arrayInput"
    type="text"
    placeholder="e.g. 4, 2, 2, 8, 3, 3, 1"
    aria-describedby="error-message"
  />
  <button id="sortButton">Sort using Counting Sort</button>
  <div id="error-message" role="alert" aria-live="assertive"></div>
</section>

<section id="output-section" aria-live="polite" aria-atomic="true">
  <!-- Steps will be injected here -->
</section>

<script>
  (() => {
    const arrayInput = document.getElementById('arrayInput');
    const sortButton = document.getElementById('sortButton');
    const outputSection = document.getElementById('output-section');
    const errorMessage = document.getElementById('error-message');

    // Utility: create a container showing array elements.
    function createArrayDisplay(arr, highlightIndices = [], className = 'element') {
      const container = document.createElement('div');
      container.className = 'array-container';
      arr.forEach((val, idx) => {
        const el = document.createElement('div');
        el.className = className;
        el.textContent = val;
        if (highlightIndices.includes(idx)) {
          el.classList.add('highlight');
        }
        container.appendChild(el);
      });
      return container;
    }

    // Create counting array display with labels and counts
    function createCountDisplay(countArr, highlightIndex = -1) {
      const container = document.createElement('div');
      container.className = 'array-container';
      countArr.forEach((count, index) => {
        const el = document.createElement('div');
        el.className = 'count-element';
        if (index === highlightIndex) el.classList.add('highlight');

        const label = document.createElement('div');
        label.textContent = index;
        label.className = 'count-label';
        el.appendChild(label);

        const countVal = document.createElement('div');
        countVal.textContent = count;
        el.appendChild(countVal);

        container.appendChild(el);
      });
      return container;
    }

    // Parse and validate user input
    function parseInput(inputStr) {
      if (!inputStr.trim()) return null;
      // Split by comma or whitespace
      const tokens = inputStr.trim().split(/[\s,]+/);
      let arr = [];
      for (let t of tokens) {
        if (!/^\d+$/.test(t)) return null; // invalid if not integer >= 0
        const num = parseInt(t, 10);
        if (num < 0) return null;
        arr.push(num);
      }
      return arr;
    }

    // Clear output and error
    function clearOutput() {
      outputSection.innerHTML = '';
      errorMessage.textContent = '';
    }

    // Display a step in the sorting process
    function displayStep(title, description, contentElement) {
      const stepDiv = document.createElement('div');
      stepDiv.className = 'step';

      const stepTitle = document.createElement('h2');
      stepTitle.className = 'step-title';
      stepTitle.textContent = title;
      stepDiv.appendChild(stepTitle);

      const descP = document.createElement('p');
      descP.className = 'info';
      descP.textContent = description;
      stepDiv.appendChild(descP);

      stepDiv.appendChild(contentElement);
      outputSection.appendChild(stepDiv);
    }

    // The counting sort demonstration function
    function countingSortDemo(arr) {
      clearOutput();

      // Step 1: Show the original unsorted array
      displayStep(
        'Step 1: Original Array',
        'This is the unsorted array you provided.',
        createArrayDisplay(arr)
      );

      // Find max value (k)
      const maxVal = Math.max(...arr);

      displayStep(
        'Step 2: Determine Range',
        `The maximum value in the array is ${maxVal}. We create a count array of size ${maxVal +
          1} to count the occurrences of each integer.`,
        createArrayDisplay([maxVal], [], 'element')
      );

      // Step 3: Initialize count array
      const count = new Array(maxVal + 1).fill(0);

      // Step 4: Count frequencies
      let stepCount = 3;
      arr.forEach((num, index) => {
        count[num]++;
        // For demonstration, we can update the count array after counting each element
        displayStep(
          `Step ${stepCount}: Count Frequencies (Processing element arr[${index}] = ${num})`,
          `Increment count of number ${num}.`,
          createCountDisplay(count, num)
        );
        stepCount++;
      });

      // Step 5: Calculate cumulative counts (prefix sums)
      displayStep(
        `Step ${stepCount}: Count Array Before Cumulative Sum`,
        'Current counts of each integer:',
        createCountDisplay(count)
      );
      stepCount++;

      for (let i = 1; i < count.length; i++) {
        count[i] += count[i - 1];
        displayStep(
          `Step ${stepCount}: Cumulative Count at index ${i}`,
          `Add count[${i - 1}] to count[${i}].`,
          createCountDisplay(count, i)
        );
        stepCount++;
      }

      // Step 6: Place elements into output array in sorted order
      const output = new Array(arr.length);
      displayStep(
        `Step ${stepCount}: Initialize Output Array`,
        'Create an empty array to place sorted elements.',
        document.createElement('div')
      );
      stepCount++;

      // We must iterate from right to left to maintain stability
      for (let i = arr.length - 1; i >= 0; i--) {
        const num = arr[i];
        count[num]--;
        output[count[num]] = num;
        displayStep(
          `Step ${stepCount}: Place element ${num} at output index ${count[num]}`,
          `Decrement count[${num}] to ${count[num]} and place ${num} at output[${count[num]}].`,
          createArrayDisplay(output.filter(_ => _ !== undefined))
        );
        stepCount++;
      }

      // Step 7: Final sorted output
      displayStep(
        'Step ' + stepCount + ': Sorted Array',
        'This is the final sorted array produced by Counting Sort.',
        createArrayDisplay(output)
      );
    }

    sortButton.addEventListener('click', () => {
      clearOutput();
      const arr = parseInput(arrayInput.value);
      if (arr === null) {
        errorMessage.textContent =
          'Please enter a valid list of non-negative integers separated by commas or spaces.';
        return;
      }
      if (arr.length === 0) {
        errorMessage.textContent = 'Input array cannot be empty.';
        return;
      }
      if (arr.length > 50) {
        errorMessage.textContent = 'Please enter 50 or fewer numbers for visualization.';
        return;
      }
      countingSortDemo(arr);
    });
  })();
</script>
<footer>Counting Sort Visualization &copy; 2024</footer>
</body>
</html>