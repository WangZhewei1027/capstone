<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Knapsack Problem Demo</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 2rem;
    max-width: 800px;
  }
  h1 {
    text-align: center;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 1rem;
  }
  th, td {
    border: 1px solid #666;
    padding: 0.5rem;
    text-align: center;
  }
  input[type=number] {
    width: 4rem;
  }
  button {
    padding: 0.5rem 1rem;
    font-size: 1rem;
  }
  .result {
    margin-top: 1rem;
    padding: 1rem;
    background: #f0f8ff;
    border: 1px solid #a0c0ff;
    border-radius: 5px;
  }
  .dp-table-container {
    max-height: 250px;
    overflow: auto;
    margin-top: 1rem;
    border: 1px solid #ccc;
  }
  table.dp-table th, table.dp-table td {
    font-size: 0.75rem;
    min-width: 30px;
    padding: 0.2rem 0.3rem;
  }
</style>
</head>
<body>

<h1>0/1 Knapsack Problem Solver</h1>

<p>
  Enter items with their weights and values, then specify the maximum knapsack capacity.
  The solver will find the maximum total value achievable without exceeding capacity.
</p>

<form id="knapsackForm">
  <table id="itemsTable" aria-label="Items input table">
    <thead>
      <tr>
        <th>#</th>
        <th>Weight</th>
        <th>Value</th>
        <th>Remove</th>
      </tr>
    </thead>
    <tbody id="itemsBody">
      <tr>
        <td>1</td>
        <td><input type="number" name="weight" min="1" value="3" required /></td>
        <td><input type="number" name="value" min="0" value="25" required /></td>
        <td><button type="button" class="removeBtn" aria-label="Remove item 1">−</button></td>
      </tr>
      <tr>
        <td>2</td>
        <td><input type="number" name="weight" min="1" value="2" required /></td>
        <td><input type="number" name="value" min="0" value="20" required /></td>
        <td><button type="button" class="removeBtn" aria-label="Remove item 2">−</button></td>
      </tr>
      <tr>
        <td>3</td>
        <td><input type="number" name="weight" min="1" value="1" required /></td>
        <td><input type="number" name="value" min="0" value="15" required /></td>
        <td><button type="button" class="removeBtn" aria-label="Remove item 3">−</button></td>
      </tr>
    </tbody>
  </table>
  <button type="button" id="addItemBtn">Add Item +</button>
  <p>
    <label for="capacityInput"><strong>Knapsack Capacity:</strong></label>
    <input type="number" id="capacityInput" name="capacity" min="1" value="5" required />
  </p>
  <button type="submit">Solve</button>
</form>

<div class="result" id="result" aria-live="polite"></div>

<div class="dp-table-container" id="dpContainer" aria-label="Dynamic programming table container"></div>

<script>
(() => {
  const itemsBody = document.getElementById('itemsBody');
  const addItemBtn = document.getElementById('addItemBtn');
  const knapsackForm = document.getElementById('knapsackForm');
  const resultDiv = document.getElementById('result');
  const dpContainer = document.getElementById('dpContainer');

  // Add new item row
  addItemBtn.addEventListener('click', () => {
    const rowCount = itemsBody.rows.length + 1;
    const row = document.createElement('tr');
    row.innerHTML = \`
      <td>\${rowCount}</td>
      <td><input type="number" name="weight" min="1" value="1" required /></td>
      <td><input type="number" name="value" min="0" value="0" required /></td>
      <td><button type="button" class="removeBtn" aria-label="Remove item \${rowCount}">−</button></td>
    \`;
    itemsBody.appendChild(row);
    updateRemoveButtons();
  });

  // Remove an item row
  function updateRemoveButtons() {
    const removeButtons = itemsBody.querySelectorAll('.removeBtn');
    removeButtons.forEach((btn, i) => {
      btn.onclick = () => {
        btn.closest('tr').remove();
        updateRowNumbers();
      };
    });
  }

  // Update row numbers after remove
  function updateRowNumbers() {
    [...itemsBody.rows].forEach((row, i) => {
      row.cells[0].textContent = i + 1;
      const removeBtn = row.querySelector('.removeBtn');
      if (removeBtn) {
        removeBtn.setAttribute('aria-label', 'Remove item ' + (i + 1));
      }
    });
  }

  updateRemoveButtons();

  // Solve knapsack on form submit
  knapsackForm.addEventListener('submit', e => {
    e.preventDefault();

    // Read items data
    const weights = [];
    const values = [];
    let valid = true;
    [...itemsBody.rows].forEach((row) => {
      const weightInput = row.querySelector('input[name="weight"]');
      const valueInput = row.querySelector('input[name="value"]');
      const w = parseInt(weightInput.value, 10);
      const v = parseInt(valueInput.value, 10);

      if (isNaN(w) || w < 1) {
        weightInput.setCustomValidity('Weight must be a positive integer');
        weightInput.reportValidity();
        valid = false;
      } else {
        weightInput.setCustomValidity('');
      }
      if (isNaN(v) || v < 0) {
        valueInput.setCustomValidity('Value must be a non-negative integer');
        valueInput.reportValidity();
        valid = false;
      } else {
        valueInput.setCustomValidity('');
      }
      weights.push(w);
      values.push(v);
    });
    const capacityInput = document.getElementById('capacityInput');
    const capacity = parseInt(capacityInput.value, 10);
    if (isNaN(capacity) || capacity < 1) {
      capacityInput.setCustomValidity('Capacity must be a positive integer');
      capacityInput.reportValidity();
      valid = false;
    } else {
      capacityInput.setCustomValidity('');
    }

    if (!valid) return;

    const n = weights.length;

    // DP table: dp[i][w] = max value using first i items within weight w
    const dp = Array.from({ length: n + 1 }, () => Array(capacity + 1).fill(0));

    for (let i = 1; i <= n; i++) {
      const wt = weights[i - 1];
      const val = values[i - 1];
      for (let w = 0; w <= capacity; w++) {
        if (wt <= w) {
          dp[i][w] = Math.max(dp[i - 1][w], dp[i - 1][w - wt] + val);
        } else {
          dp[i][w] = dp[i - 1][w];
        }
      }
    }

    // Find which items to take (reconstruct solution)
    let w = capacity;
    const taken = [];
    for (let i = n; i > 0; i--) {
      if (dp[i][w] !== dp[i - 1][w]) {
        taken.push(i - 1); // zero-based index of taken item
        w -= weights[i - 1];
      }
    }
    taken.reverse();

    // Display results
    const maxValue = dp[n][capacity];
    const totalWeight = taken.reduce((acc, idx) => acc + weights[idx], 0);

    resultDiv.innerHTML = \`
      <h2>Solution</h2>
      <p><strong>Maximum value achievable:</strong> \${maxValue}</p>
      <p><strong>Total weight of chosen items:</strong> \${totalWeight} / \${capacity}</p>
      <p><strong>Items chosen (index, weight, value):</strong></p>
      <ul>
        \${taken.length > 0
          ? taken.map(i => '<li>Item ' + (i+1) + ': weight = ' + weights[i] + ', value = ' + values[i] + '</li>').join('')
          : '<li><em>No items selected</em></li>'
        }
      </ul>
    \`;

    // Display DP table for small cases (capacity <= 50 & n <= 20)
    if (n <= 20 && capacity <= 50) {
      dpContainer.innerHTML = generateDpTable(dp, weights, values, capacity);
    } else {
      dpContainer.innerHTML = '<p><em>DP table display is skipped for large input.</em></p>';
    }
  });

  // Function to generate a table showing dp array
  function generateDpTable(dp, weights, values, capacity) {
    let html = '<h3>DP Table (max values for item count vs capacity)</h3>';
    html += '<table class="dp-table" aria-label="Dynamic programming table">' +
      '<thead><tr><th>Items\\W</th>';
    for (let w = 0; w <= capacity; w++) {
      html += '<th>' + w + '</th>';
    }
    html += '</tr></thead><tbody>';
    for (let i = 0; i < dp.length; i++) {
      html += '<tr>';
      if (i === 0) {
        html += '<th>0 (no items)</th>';
      } else {
        html += '<th>' + i + '<br>(w=' + weights[i-1] + '<br>v=' + values[i-1] + ')</th>';
      }
      for (let w = 0; w <= capacity; w++) {
        html += '<td>' + dp[i][w] + '</td>';
      }
      html += '</tr>';
    }
    html += '</tbody></table>';
    return html;
  }
})();
</script>

</body>
</html>