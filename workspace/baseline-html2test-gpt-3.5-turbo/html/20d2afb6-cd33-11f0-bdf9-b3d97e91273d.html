<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Quick Sort Demonstration</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 2rem;
    background: #f5f5f5;
  }
  h1 {
    text-align: center;
  }
  #input-area {
    display: flex;
    justify-content: center;
    margin-bottom: 1rem;
  }
  #arrayInput {
    width: 300px;
    font-size: 1rem;
    padding: 0.5rem;
  }
  button {
    font-size: 1rem;
    margin-left: 0.5rem;
    padding: 0.5rem 1rem;
    cursor: pointer;
  }
  #arrayDisplay, #stepsDisplay {
    max-width: 600px;
    margin: 1rem auto;
    background: white;
    border-radius: 5px;
    padding: 1rem;
    box-shadow: 0 0 6px rgba(0,0,0,0.1);
  }
  #arrayDisplay {
    display: flex;
    justify-content: center;
    gap: 8px;
    flex-wrap: wrap;
    margin-bottom: 2rem;
  }
  .array-item {
    width: 30px;
    height: 30px;
    background: #2196F3;
    color: white;
    line-height: 30px;
    text-align: center;
    border-radius: 4px;
    font-weight: bold;
    transition: all 0.3s ease;
  }
  .pivot {
    background: #FF5722 !important;
  }
  .comparing {
    background: #FFEB3B !important;
    color: black;
  }
  .swapped {
    background: #4CAF50 !important;
  }
  #stepsDisplay {
    font-family: monospace;
    white-space: pre-wrap;
    height: 200px;
    overflow-y: auto;
  }
  #speedControl {
    margin: 0 auto 1rem auto;
    max-width: 600px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  label {
    font-weight: bold;
  }
</style>
</head>
<body>
<h1>Quick Sort Visualization</h1>
<div id="input-area">
  <input id="arrayInput" type="text" placeholder="Enter numbers separated by commas" />
  <button id="startSort">Start Sorting</button>
</div>
<div id="speedControl">
  <label for="speedRange">Animation Speed:</label>
  <input type="range" id="speedRange" min="50" max="2000" value="500" />
  <span id="speedValue">500 ms</span>
</div>
<div id="arrayDisplay"></div>
<div id="stepsDisplay"></div>

<script>
  const arrayInput = document.getElementById('arrayInput');
  const startSortBtn = document.getElementById('startSort');
  const arrayDisplay = document.getElementById('arrayDisplay');
  const stepsDisplay = document.getElementById('stepsDisplay');
  const speedRange = document.getElementById('speedRange');
  const speedValue = document.getElementById('speedValue');

  speedRange.addEventListener('input', () => {
    speedValue.textContent = speedRange.value + ' ms';
  });

  function renderArray(arr, highlight = {}) {
    // highlight can contain indices for pivot, comparing, swapped
    arrayDisplay.innerHTML = '';
    arr.forEach((val, i) => {
      const div = document.createElement('div');
      div.classList.add('array-item');
      if (highlight.pivot === i) div.classList.add('pivot');
      if (highlight.comparing && highlight.comparing.includes(i)) div.classList.add('comparing');
      if (highlight.swapped && highlight.swapped.includes(i)) div.classList.add('swapped');
      div.textContent = val;
      arrayDisplay.appendChild(div);
    });
  }

  function delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  function logStep(msg) {
    stepsDisplay.textContent += msg + '\n';
    stepsDisplay.scrollTop = stepsDisplay.scrollHeight;
  }

  // The Quick Sort algorithm will be implemented with asynchronous steps for visualization.
  async function quickSort(arr, left, right) {
    if (left < right) {
      logStep(`Calling partition on subarray indices [${left}, ${right}]`);
      const pivotIndex = await partition(arr, left, right);
      logStep(`Partition complete, pivot positioned at index ${pivotIndex}\n`);
      
      await quickSort(arr, left, pivotIndex - 1);
      await quickSort(arr, pivotIndex + 1, right);
    }
  }

  async function partition(arr, left, right) {
    // Choose pivot - We use the rightmost element as pivot.
    const pivotValue = arr[right];
    let i = left - 1;
    
    logStep(`Pivot chosen: arr[${right}] = ${pivotValue}`);
    renderArray(arr, {pivot: right});
    await delay(speedRange.value);

    for (let j = left; j < right; j++) {
      logStep(`Comparing arr[${j}] = ${arr[j]} with pivot ${pivotValue}`);
      renderArray(arr, {pivot: right, comparing:[j]});
      await delay(speedRange.value);

      if (arr[j] <= pivotValue) {
        i++;
        if (i !== j) {
          logStep(`Swapping arr[${i}] = ${arr[i]} and arr[${j}] = ${arr[j]}`);
          [arr[i], arr[j]] = [arr[j], arr[i]];
          renderArray(arr, {pivot: right, swapped: [i,j]});
          await delay(speedRange.value);
        }
      }
    }
    // Place pivot in correct position
    if (i+1 !== right) {
      logStep(`Swapping pivot arr[${right}] = ${arr[right]} with arr[${i+1}] = ${arr[i+1]}`);
      [arr[i+1], arr[right]] = [arr[right], arr[i+1]];
      renderArray(arr, {pivot: i+1, swapped: [i+1, right]});
      await delay(speedRange.value);
    }
    return i + 1;
  }

  startSortBtn.addEventListener('click', async () => {
    let inputStr = arrayInput.value.trim();
    if (!inputStr) {
      alert('Please enter some numbers separated by commas.');
      return;
    }
    let arr = inputStr.split(',').map(s => s.trim()).filter(s => s !== '').map(Number);
    if (arr.some(isNaN)) {
      alert('Please enter valid numbers only.');
      return;
    }

    stepsDisplay.textContent = '';
    renderArray(arr);
    logStep(`Initial array: [${arr.join(', ')}]\n`);
  
    startSortBtn.disabled = true;
    arrayInput.disabled = true;

    await quickSort(arr, 0, arr.length - 1);

    logStep(`Sorting complete! Final sorted array: [${arr.join(', ')}]`);
    renderArray(arr);

    startSortBtn.disabled = false;
    arrayInput.disabled = false;
  });
</script>
</body>
</html>