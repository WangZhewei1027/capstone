<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Radix Sort Visualization</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 2rem;
    background: #f7f9fc;
    color: #333;
  }
  h1 {
    text-align: center;
    margin-bottom: 1rem;
  }
  #inputArea {
    text-align: center;
    margin-bottom: 1rem;
  }
  #numbersInput {
    width: 80%;
    max-width: 500px;
    font-size: 1.25rem;
    padding: 0.5rem;
  }
  button {
    font-size: 1.1rem;
    padding: 0.5rem 1rem;
    margin-left: 0.5rem;
    cursor: pointer;
  }
  #visualization {
    margin-top: 2rem;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .array-row {
    margin: 0.5rem 0;
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
  }
  .array-item {
    background-color: #007bff;
    color: white;
    min-width: 40px;
    height: 40px;
    margin: 0 0.2rem 0.4rem 0.2rem;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 4px;
    font-weight: bold;
    font-size: 1.1rem;
    user-select: none;
    transition: background-color 0.3s ease;
  }
  .array-item.highlight {
    background-color: #28a745;
    box-shadow: 0 0 8px #28a745;
  }
  .description {
    max-width: 600px;
    margin: 1rem auto 2rem auto;
    font-size: 1rem;
    line-height: 1.4;
    text-align: center;
    color: #555;
  }
  #speedLabel {
    margin-left: 1rem;
    font-weight: normal;
  }
  #speedControl {
    vertical-align: middle;
  }
</style>
</head>
<body>
<h1>Radix Sort Visualization (LSD)</h1>
<div class="description">
  Enter a list of positive integers separated by commas or spaces and press "Start Sort" to see how Radix Sort (Least Significant Digit) sorts them step by step.
</div>
<div id="inputArea">
  <input
    type="text"
    id="numbersInput"
    placeholder="e.g. 170, 45, 75, 90, 802, 24, 2, 66"
  />
  <button id="startBtn">Start Sort</button>
  <label for="speedControl" id="speedLabel">Speed:</label>
  <input type="range" id="speedControl" min="100" max="2000" value="700" step="100" />
</div>
<div id="visualization"></div>

<script>
(() => {
  const numbersInput = document.getElementById("numbersInput");
  const startBtn = document.getElementById("startBtn");
  const visualization = document.getElementById("visualization");
  const speedControl = document.getElementById("speedControl");

  let speed = 700;
  speedControl.addEventListener("input", () => {
    speed = +speedControl.value;
  });

  // Utility: sleep for ms milliseconds
  function sleep(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms));
  }

  // Render array row with optional highlights and label
  function renderArray(arr, highlightIndices = [], label = "") {
    const row = document.createElement("div");
    row.className = "array-row";

    if (label) {
      const labelSpan = document.createElement("div");
      labelSpan.textContent = label;
      labelSpan.style.width = "100%";
      labelSpan.style.fontWeight = "bold";
      labelSpan.style.marginBottom = "0.2rem";
      labelSpan.style.color = "#444";
      row.appendChild(labelSpan);
    }

    for (let i = 0; i < arr.length; i++) {
      const item = document.createElement("div");
      item.className = "array-item";
      item.textContent = arr[i];
      if (highlightIndices.includes(i)) {
        item.classList.add("highlight");
      }
      row.appendChild(item);
    }
    visualization.appendChild(row);
  }

  // Clear visualization area
  function clearVisualization() {
    visualization.innerHTML = "";
  }

  startBtn.addEventListener("click", () => {
    // Parse input numbers
    const rawInput = numbersInput.value.trim();
    if (!rawInput) {
      alert("Please enter some numbers.");
      return;
    }
    const tokens = rawInput.split(/[\s,]+/);
    const arr = tokens
      .map((t) => parseInt(t, 10))
      .filter((num) => Number.isInteger(num) && num >= 0);

    if (arr.length === 0) {
      alert("Please enter valid non-negative integers separated by commas or spaces.");
      return;
    }

    clearVisualization();
    startBtn.disabled = true;
    numbersInput.disabled = true;
    speedControl.disabled = true;

    radixSort(arr).then(() => {
      startBtn.disabled = false;
      numbersInput.disabled = false;
      speedControl.disabled = false;
    });
  });

  // Get digit at place (1 = ones, 10 = tens, etc)
  function getDigit(num, place) {
    return Math.floor(Math.abs(num) / place) % 10;
  }

  // Find max number
  function findMax(arr) {
    return Math.max(...arr);
  }

  // Main async radix sort function with visualization
  async function radixSort(arr) {
    // Initial display
    renderArray(arr, [], "Initial array:");

    await sleep(speed);

    const maxNum = findMax(arr);

    // Start with LSD = 1 (ones place)
    let place = 1;
    let iteration = 1;

    while (Math.floor(maxNum / place) > 0) {
      clearVisualization();

      renderArray(arr, [], `Iteration ${iteration}: Sorting by place = ${place}`);

      // Prepare buckets for digits 0 through 9
      const buckets = Array.from({ length: 10 }, () => []);

      // Show current digit for each element
      const digitsForAll = arr.map((num) => getDigit(num, place));
      renderArray(arr, [], "Current array:");
      // Highlight each element with its digit in this place
      const digitLabelsRow = document.createElement("div");
      digitLabelsRow.className = "array-row";
      for (let d of digitsForAll) {
        const dItem = document.createElement("div");
        dItem.className = "array-item";
        dItem.style.backgroundColor = "#ffc107"; // yellow for digit highlight
        dItem.textContent = d;
        digitLabelsRow.appendChild(dItem);
      }
      visualization.appendChild(digitLabelsRow);

      await sleep(speed);

      // Place elements into buckets one by one with highlights
      for (let i = 0; i < arr.length; i++) {
        clearVisualization();

        renderArray(arr, [i], `Iteration ${iteration}: Placing elements into buckets by digit at place ${place}`);

        // Show all buckets with their contents
        const tempBuckets = buckets.map((b) => b.slice());
        tempBuckets[digitsForAll[i]].push(arr[i]);

        // Display buckets
        const bucketsContainer = document.createElement("div");
        bucketsContainer.style.display = "flex";
        bucketsContainer.style.justifyContent = "center";
        bucketsContainer.style.flexWrap = "wrap";
        bucketsContainer.style.marginTop = "1rem";
        bucketsContainer.style.maxWidth = "700px";

        for (let digit = 0; digit < 10; digit++) {
          const bucketDiv = document.createElement("div");
          bucketDiv.style.margin = "0 0.5rem";
          bucketDiv.style.flexBasis = "80px";

          const bucketLabel = document.createElement("div");
          bucketLabel.textContent = `Bucket ${digit}`;
          bucketLabel.style.textAlign = "center";
          bucketLabel.style.fontWeight = "bold";
          bucketLabel.style.color = "#555";
          bucketLabel.style.marginBottom = "0.3rem";
          bucketDiv.appendChild(bucketLabel);

          const bucketContent = document.createElement("div");
          bucketContent.style.display = "flex";
          bucketContent.style.flexWrap = "wrap";
          bucketContent.style.justifyContent = "center";

          for (const val of tempBuckets[digit]) {
            const item = document.createElement("div");
            item.className = "array-item";
            item.textContent = val;
            item.style.backgroundColor = "#17a2b8"; // teal for bucket items
            bucketContent.appendChild(item);
          }
          bucketDiv.appendChild(bucketContent);
          bucketsContainer.appendChild(bucketDiv);
        }
        visualization.appendChild(bucketsContainer);

        buckets[digitsForAll[i]].push(arr[i]);
        await sleep(speed);
      }

      // Reassemble arr by concatenating buckets
      clearVisualization();
      renderArray(arr, [], `Iteration ${iteration}: Collecting elements from buckets in order`);

      // Show final buckets before collection
      const bucketsContainerFinal = document.createElement("div");
      bucketsContainerFinal.style.display = "flex";
      bucketsContainerFinal.style.justifyContent = "center";
      bucketsContainerFinal.style.flexWrap = "wrap";
      bucketsContainerFinal.style.marginTop = "1rem";
      bucketsContainerFinal.style.maxWidth = "700px";

      for (let digit = 0; digit < 10; digit++) {
        const bucketDiv = document.createElement("div");
        bucketDiv.style.margin = "0 0.5rem";
        bucketDiv.style.flexBasis = "80px";

        const bucketLabel = document.createElement("div");
        bucketLabel.textContent = `Bucket ${digit}`;
        bucketLabel.style.textAlign = "center";
        bucketLabel.style.fontWeight = "bold";
        bucketLabel.style.color = "#555";
        bucketLabel.style.marginBottom = "0.3rem";
        bucketDiv.appendChild(bucketLabel);

        const bucketContent = document.createElement("div");
        bucketContent.style.display = "flex";
        bucketContent.style.flexWrap = "wrap";
        bucketContent.style.justifyContent = "center";

        for (const val of buckets[digit]) {
          const item = document.createElement("div");
          item.className = "array-item";
          item.textContent = val;
          item.style.backgroundColor = "#17a2b8";
          bucketContent.appendChild(item);
        }
        bucketDiv.appendChild(bucketContent);
        bucketsContainerFinal.appendChild(bucketDiv);
      }
      visualization.appendChild(bucketsContainerFinal);

      await sleep(speed * 1.2);

      // Flatten buckets into arr
      let idx = 0;
      for (let digit = 0; digit < 10; digit++) {
        for (const val of buckets[digit]) {
          arr[idx++] = val;
          // Show current reassembled state with highlight
          clearVisualization();
          renderArray(arr.slice(0, idx), [], `Iteration ${iteration}: Reassembling array`);
          await sleep(speed / 5);
        }
      }

      clearVisualization();
      renderArray(arr, [], `After iteration ${iteration} (place = ${place}):`);

      await sleep(speed);

      place *= 10;
      iteration++;
    }

    clearVisualization();
    renderArray(arr, [], "Sorted array:");
  }
})();
</script>
</body>
</html>