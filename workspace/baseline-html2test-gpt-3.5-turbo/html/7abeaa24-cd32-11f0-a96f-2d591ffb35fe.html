<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Merge Sort Visualization</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f5f5f5;
  }
  h1 {
    text-align: center;
  }
  #inputSection {
    text-align: center;
    margin-bottom: 10px;
  }
  #arrayInput {
    width: 300px;
    padding: 8px;
    font-size: 16px;
  }
  #sortBtn {
    padding: 9px 16px;
    font-size: 16px;
    margin-left: 8px;
    cursor: pointer;
  }
  #visualization {
    margin: 0 auto;
    margin-top: 20px;
    width: 90%;
    max-width: 900px;
    height: 300px;
    border: 1px solid #ccc;
    display: flex;
    align-items: flex-end;
    background: white;
    position: relative;
    overflow-x: auto;
    padding-bottom: 20px;
  }
  .bar {
    margin: 0 2px;
    background-color: #007bff;
    text-align: center;
    color: white;
    font-size: 12px;
    border-radius: 3px 3px 0 0;
    user-select: none;
    transition: background-color 0.3s;
  }
  .bar.comparing {
    background-color: #dc3545;
  }
  .bar.merging {
    background-color: #28a745;
  }
  #stepsLog {
    max-height: 150px;
    overflow-y: auto;
    margin-top: 16px;
    background: #fff;
    border: 1px solid #ccc;
    padding: 12px;
    font-family: monospace;
    white-space: pre-wrap;
  }
  #footer {
    text-align: center;
    margin-top: 30px;
    color: #777;
  }
  .highlight {
    font-weight: bold;
    color: #dc3545;
  }
</style>
</head>
<body>

<h1>Merge Sort Visualization</h1>

<div id="inputSection">
  <input
    type="text"
    id="arrayInput"
    placeholder="Enter numbers separated by commas"
    value="38,27,43,3,9,82,10"
  />
  <button id="sortBtn">Sort</button>
</div>

<div id="visualization"></div>

<div id="stepsLog"></div>

<div id="footer">
  Enter a list of numbers separated by commas and click Sort to see Merge Sort in action.
</div>

<script>
  const input = document.getElementById("arrayInput");
  const sortBtn = document.getElementById("sortBtn");
  const visualization = document.getElementById("visualization");
  const stepsLog = document.getElementById("stepsLog");

  let bars = [];
  let delay = 500; // milliseconds between steps

  function createBars(arr) {
    visualization.innerHTML = "";
    bars = [];
    // Find max value to scale heights
    const maxVal = Math.max(...arr);
    for (let i = 0; i < arr.length; i++) {
      const bar = document.createElement("div");
      bar.classList.add("bar");
      bar.style.height = `${(arr[i] / maxVal) * 100}%`;
      bar.style.width = `calc((90% / ${arr.length}) - 4px)`;
      bar.textContent = arr[i];
      visualization.appendChild(bar);
      bars.push(bar);
    }
  }

  function logStep(message) {
    stepsLog.textContent += message + "\n";
    stepsLog.scrollTop = stepsLog.scrollHeight;
  }

  // Async wait helper
  function wait(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms));
  }

  // Merge function with visualization
  async function merge(arr, left, mid, right) {
    let n1 = mid - left + 1;
    let n2 = right - mid;

    let L = new Array(n1);
    let R = new Array(n2);

    for (let i = 0; i < n1; i++) {
      L[i] = arr[left + i];
    }
    for (let j = 0; j < n2; j++) {
      R[j] = arr[mid + 1 + j];
    }

    logStep(
      `Merging left: [${L.join(", ")}] and right: [${R.join(", ")}] at positions ${left} to ${right}`
    );

    let i = 0,
      j = 0,
      k = left;

    while (i < n1 && j < n2) {
      // Highlight bars being compared
      bars[k].classList.add("merging");
      bars[left + i].classList.add("comparing");
      bars[mid + 1 + j].classList.add("comparing");

      await wait(delay);

      if (L[i] <= R[j]) {
        arr[k] = L[i];
        bars[k].textContent = L[i];
        bars[k].style.height = `${(L[i] / Math.max(...arr)) * 100}%`;
        i++;
      } else {
        arr[k] = R[j];
        bars[k].textContent = R[j];
        bars[k].style.height = `${(R[j] / Math.max(...arr)) * 100}%`;
        j++;
      }

      // Remove highlight for compared bars
      bars[left + i - (L[i-1] === arr[k] ? 1 : 0)]?.classList.remove("comparing");
      bars[mid + 1 + j - (R[j-1] === arr[k] ? 1 : 0)]?.classList.remove("comparing");
      bars[k].classList.remove("merging");

      await wait(delay);

      k++;
    }

    // Copy remaining elements of L[]
    while (i < n1) {
      bars[k].classList.add("merging");
      bars[left + i].classList.add("comparing");
      await wait(delay);

      arr[k] = L[i];
      bars[k].textContent = L[i];
      bars[k].style.height = `${(L[i] / Math.max(...arr)) * 100}%`;

      bars[left + i].classList.remove("comparing");
      bars[k].classList.remove("merging");

      i++;
      k++;

      await wait(delay);
    }

    // Copy remaining elements of R[]
    while (j < n2) {
      bars[k].classList.add("merging");
      bars[mid + 1 + j].classList.add("comparing");
      await wait(delay);

      arr[k] = R[j];
      bars[k].textContent = R[j];
      bars[k].style.height = `${(R[j] / Math.max(...arr)) * 100}%`;

      bars[mid + 1 + j].classList.remove("comparing");
      bars[k].classList.remove("merging");

      j++;
      k++;

      await wait(delay);
    }
    logStep(`Merged portion: [${arr.slice(left, right + 1).join(", ")}]\n`);
  }

  async function mergeSort(arr, left, right) {
    if (left >= right) {
      return;
    }
    const mid = Math.floor((left + right) / 2);

    logStep(`Splitting array at positions [${left}..${mid}] and [${mid + 1}..${right}]`);

    await mergeSort(arr, left, mid);
    await mergeSort(arr, mid + 1, right);

    await merge(arr, left, mid, right);
  }

  sortBtn.addEventListener("click", async () => {
    stepsLog.textContent = "";
    const rawInput = input.value.trim();

    if (!rawInput) {
      alert("Please enter some numbers separated by commas.");
      return;
    }

    let arr = rawInput.split(",").map((v) => Number(v.trim()));

    if (arr.some((x) => isNaN(x))) {
      alert("Please enter valid numbers separated by commas.");
      return;
    }
    if (arr.length === 0) return;

    createBars(arr);
    sortBtn.disabled = true;
    input.disabled = true;

    logStep(`Initial array: [${arr.join(", ")}]\n`);

    await mergeSort(arr, 0, arr.length - 1);

    logStep(`Sorting complete! Final sorted array: [${arr.join(", ")}]`);
    sortBtn.disabled = false;
    input.disabled = false;
  });
</script>

</body>
</html>