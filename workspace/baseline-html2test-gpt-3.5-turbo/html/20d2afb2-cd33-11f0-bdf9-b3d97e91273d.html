<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bubble Sort Visualization</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 2rem;
    background: #f0f0f0;
    color: #222;
  }
  h1 {
    text-align: center;
  }
  #arrayInput {
    width: 100%;
    max-width: 400px;
    padding: 0.5rem;
    font-size: 1rem;
  }
  #sortBtn {
    margin-top: 0.5rem;
    padding: 0.6rem 1.2rem;
    font-size: 1rem;
    cursor: pointer;
  }
  #container {
    margin-top: 2rem;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    height: 200px;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
    background: #fff;
    padding: 1rem;
    border-radius: 8px;
    box-shadow: 0 0 10px #aaa;
  }
  .bar {
    margin: 0 2px;
    background-color: #4285F4;
    width: 20px;
    border-radius: 2px;
    transition: background-color 0.3s;
    display: flex;
    justify-content: center;
    align-items: flex-end;
    color: white;
    font-weight: bold;
    font-size: 12px;
    user-select: none;
  }
  .bar.comparing {
    background-color: #fbbc04;
  }
  .bar.swapping {
    background-color: #ea4335;
  }
  #speedLabel {
    margin-left: 1rem;
    font-size: 0.9rem;
  }
  #speedRange {
    vertical-align: middle;
  }
  #codeBlock {
    max-width: 700px;
    margin: 2rem auto;
    background: #272822;
    color: #f8f8f2;
    padding: 1rem;
    border-radius: 8px;
    font-family: 'Courier New', Courier, monospace;
    overflow-x: auto;
    font-size: 0.9rem;
    line-height: 1.4;
    user-select: text;
  }
</style>
</head>
<body>
<h1>Bubble Sort Visualization</h1>
<div style="text-align: center;">
  <input id="arrayInput" type="text" value="5,3,8,4,2" aria-label="Array input" />
  <button id="sortBtn">Start Bubble Sort</button>
  <label id="speedLabel" for="speedRange">Speed: </label>
  <input type="range" id="speedRange" min="50" max="1000" value="300" step="10" />
</div>

<div id="container" aria-live="polite" aria-label="Visualization of array bars"></div>

<pre id="codeBlock" aria-label="Bubble sort code example">
// Bubble Sort pseudocode:
function bubbleSort(arr) {
  let n = arr.length;
  for (let i = 0; i &lt; n - 1; i++) {
    for (let j = 0; j &lt; n - i - 1; j++) {
      if (arr[j] &gt; arr[j + 1]) {
        // Swap arr[j] and arr[j + 1]
        let temp = arr[j];
        arr[j] = arr[j + 1];
        arr[j + 1] = temp;
      }
    }
  }
  return arr;
}
</pre>

<script>
  const container = document.getElementById('container');
  const input = document.getElementById('arrayInput');
  const sortBtn = document.getElementById('sortBtn');
  const speedRange = document.getElementById('speedRange');

  let bars = [];
  let array = [];

  function createBars(arr) {
    container.innerHTML = '';
    bars = [];
    const maxVal = Math.max(...arr);
    arr.forEach((val) => {
      const bar = document.createElement('div');
      bar.className = 'bar';
      // height scaled relative to maxVal
      bar.style.height = (val / maxVal) * 180 + 20 + 'px';
      bar.textContent = val;
      container.appendChild(bar);
      bars.push(bar);
    });
  }

  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  async function bubbleSort(arr) {
    const n = arr.length;
    for (let i = 0; i < n - 1; i++) {
      let swapped = false;
      for (let j = 0; j < n - i - 1; j++) {
        // Highlight bars being compared
        bars[j].classList.add('comparing');
        bars[j+1].classList.add('comparing');
        await sleep(speedRange.value);

        if (arr[j] > arr[j + 1]) {
          swapped = true;
          // Highlight bars being swapped
          bars[j].classList.remove('comparing');
          bars[j+1].classList.remove('comparing');
          bars[j].classList.add('swapping');
          bars[j+1].classList.add('swapping');

          await sleep(speedRange.value);

          // Swap values
          [arr[j], arr[j + 1]] = [arr[j + 1], arr[j]];
          // Swap bars height and text
          bars[j].style.height = (arr[j] / Math.max(...arr)) * 180 + 20 + 'px';
          bars[j].textContent = arr[j];
          bars[j+1].style.height = (arr[j+1] / Math.max(...arr)) * 180 + 20 + 'px';
          bars[j+1].textContent = arr[j+1];

          await sleep(speedRange.value);

          bars[j].classList.remove('swapping');
          bars[j+1].classList.remove('swapping');
        }
        bars[j].classList.remove('comparing');
        bars[j+1].classList.remove('comparing');
      }
      // Mark the last sorted bar as a different color
      bars[n - 1 - i].style.backgroundColor = '#34a853'; // green
      if (!swapped) break; // Optimization: no swaps means array is sorted
    }
    // Mark the first bar as sorted after all passes
    bars[0].style.backgroundColor = '#34a853';
  }

  function parseInput(value) {
    try {
      let nums = value.split(',').map(x => parseInt(x.trim(), 10));
      if (nums.some(isNaN)) return null;
      if (nums.length === 0) return null;
      return nums;
    } catch {
      return null;
    }
  }

  sortBtn.addEventListener('click', async () => {
    let arr = parseInput(input.value);
    if (!arr) {
      alert('Please enter a valid comma-separated list of integers.');
      return;
    }
    array = [...arr];
    createBars(array);
    sortBtn.disabled = true;
    input.disabled = true;
    speedRange.disabled = true;
    await bubbleSort(array);
    sortBtn.disabled = false;
    input.disabled = false;
    speedRange.disabled = false;
  });

  // Initialize on page load
  (function init() {
    let arr = parseInput(input.value) || [5,3,8,4,2];
    array = [...arr];
    createBars(array);
  })();
</script>
</body>
</html>