<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Insertion Sort Visualization</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f0f2f5;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1 {
    margin-bottom: 10px;
  }
  #arrayInput {
    width: 300px;
    font-size: 16px;
    padding: 8px;
  }
  #startBtn {
    margin-left: 10px;
    padding: 8px 16px;
    font-size: 16px;
    cursor: pointer;
  }
  #barContainer {
    margin-top: 40px;
    width: 90vw;
    max-width: 800px;
    height: 300px;
    position: relative;
    border: 1px solid #ccc;
    background: white;
    display: flex;
    align-items: flex-end;
    justify-content: center;
  }
  .bar {
    margin: 0 2px;
    background-color: steelblue;
    width: 25px;
    border-radius: 3px 3px 0 0;
    transition: background-color 0.3s ease;
    position: relative;
  }
  .bar.highlight {
    background-color: orange;
  }
  .bar.inserted {
    background-color: seagreen;
  }
  .bar.compared {
    background-color: tomato;
  }
  .bar-label {
    position: absolute;
    bottom: -20px;
    width: 100%;
    text-align: center;
    font-size: 12px;
    color: #333;
  }
  #info {
    margin-top: 20px;
    font-size: 18px;
    min-height: 24px;
  }
  #footer {
    margin-top: 40px;
    font-size: 14px;
    color: #555;
  }
</style>
</head>
<body>
<h1>Insertion Sort Visualization</h1>
<div>
  <input id="arrayInput" type="text" placeholder="Enter numbers comma separated" value="5,3,8,6,2,7,4,1" />
  <button id="startBtn">Start Sort</button>
</div>
<div id="info"></div>
<div id="barContainer"></div>
<div id="footer">Visualization highlights the current key (orange), compared bars (tomato), and inserted position (green).</div>

<script>
  const arrayInput = document.getElementById('arrayInput');
  const startBtn = document.getElementById('startBtn');
  const barContainer = document.getElementById('barContainer');
  const info = document.getElementById('info');

  let array = [];
  let bars = [];
  let delay = 600;

  function createBars(arr) {
    barContainer.innerHTML = '';
    bars = [];
    const maxVal = Math.max(...arr);
    for (let i = 0; i < arr.length; i++) {
      const bar = document.createElement('div');
      bar.classList.add('bar');
      const heightPercent = (arr[i] / maxVal) * 100;
      bar.style.height = heightPercent + '%';
      bar.style.width = `${Math.min(600 / arr.length, 40)}px`;
      bar.dataset.index = i;
      bar.title = arr[i];

      let label = document.createElement('div');
      label.classList.add('bar-label');
      label.textContent = arr[i];
      bar.appendChild(label);

      barContainer.appendChild(bar);
      bars.push(bar);
    }
  }

  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  async function insertionSort(arr) {
    info.textContent = 'Starting Insertion Sort...';
    for (let i = 1; i < arr.length; i++) {
      let key = arr[i];
      let j = i - 1;

      highlightKey(i);

      info.textContent = `Selecting key = ${key} at index ${i}`;
      await sleep(delay);

      while (j >= 0 && arr[j] > key) {
        highlightCompared(j, j+1);
        info.textContent = `Compare arr[${j}] = ${arr[j]} with key = ${key} â†’ Move arr[${j}] right`;
        await sleep(delay);
        
        arr[j+1] = arr[j];
        updateBarHeight(j+1, arr[j+1]);
        removeCompared(j, j+1);
        j--;
      }
      arr[j+1] = key;
      updateBarHeight(j+1, key);
      highlightInserted(j+1);

      info.textContent = `Insert key = ${key} at index ${j+1}`;
      await sleep(delay);

      resetHighlights();
    }
    info.textContent = 'Array is sorted!';
  }

  function highlightKey(i) {
    resetHighlights();
    bars[i].classList.add('highlight');
  }

  function highlightCompared(i, j) {
    bars[i].classList.add('compared');
    bars[j].classList.add('compared');
  }

  function removeCompared(i, j) {
    bars[i].classList.remove('compared');
    bars[j].classList.remove('compared');
  }

  function highlightInserted(i) {
    bars[i].classList.add('inserted');
  }

  function resetHighlights() {
    bars.forEach(bar => {
      bar.classList.remove('highlight');
      bar.classList.remove('compared');
      bar.classList.remove('inserted');
    });
  }

  function updateBarHeight(i, val) {
    const maxVal = Math.max(...array);
    bars[i].style.height = (val / maxVal) * 100 + '%';
    bars[i].title = val;
    bars[i].querySelector('.bar-label').textContent = val;
  }

  startBtn.addEventListener('click', () => {
    const inputStr = arrayInput.value.trim();
    if (!inputStr) {
      alert('Please enter some numbers separated by commas.');
      return;
    }
    let inputArr = inputStr.split(',').map(x => x.trim()).map(Number);
    if (inputArr.some(isNaN)) {
      alert('Invalid input: please enter only numbers separated by commas.');
      return;
    }
    if (inputArr.length < 2) {
      alert('Please enter at least two numbers to sort.');
      return;
    }
    array = inputArr;
    createBars(array);
    startBtn.disabled = true;
    arrayInput.disabled = true;
    insertionSort(array).then(() => {
      startBtn.disabled = false;
      arrayInput.disabled = false;
    });
  });

  // Initial display
  array = [5,3,8,6,2,7,4,1];
  createBars(array);
</script>
</body>
</html>