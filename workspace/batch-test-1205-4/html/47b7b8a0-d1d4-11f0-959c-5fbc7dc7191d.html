<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K-Means Clustering Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #canvas {
            border: 1px solid black;
            cursor: pointer;
        }
        #controls {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>K-Means Clustering Demo</h1>
    <canvas id="canvas" width="500" height="500"></canvas>
    <div id="controls">
        <button id="start">Run K-Means</button>
        <label for="k">Choose number of clusters (k): </label>
        <input type="number" id="k" value="3" min="1" max="10">
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const points = [];
        let clusters = [];
        let k = 3;
        let colors = [];
        
        function randomColor() {
            return 'rgb(' + Math.floor(Math.random() * 256) + ',' + Math.floor(Math.random() * 256) + ',' + Math.floor(Math.random() * 256) + ')';
        }

        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            points.push({x: x, y: y});
            drawPoints();
        });

        function drawPoints() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            points.forEach(point => {
                ctx.fillStyle = 'black';
                ctx.beginPath();
                ctx.arc(point.x, point.y, 5, 0, Math.PI * 2);
                ctx.fill();
            });
            clusters.forEach(cluster => {
                ctx.fillStyle = cluster.color;
                ctx.beginPath();
                ctx.arc(cluster.centroid.x, cluster.centroid.y, 10, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function initializeClusters() {
            clusters = [];
            colors = [];
            for (let i = 0; i < k; i++) {
                const randomIndex = Math.floor(Math.random() * points.length);
                clusters.push({
                    centroid: { ...points[randomIndex] },
                    points: [],
                    color: randomColor()
                });
                colors.push(clusters[i].color);
            }
        }

        function updateClusters() {
            // Reset points in clusters
            clusters.forEach(cluster => cluster.points = []);
            
            points.forEach(point => {
                let closestCluster = clusters[0];
                let minDist = distance(point, closestCluster.centroid);
                clusters.slice(1).forEach(cluster => {
                    const dist = distance(point, cluster.centroid);
                    if (dist < minDist) {
                        closestCluster = cluster;
                        minDist = dist;
                    }
                });
                closestCluster.points.push(point);
            });

            // Update centroids
            clusters.forEach(cluster => {
                if (cluster.points.length) {
                    cluster.centroid.x = cluster.points.reduce((sum, p) => sum + p.x, 0) / cluster.points.length;
                    cluster.centroid.y = cluster.points.reduce((sum, p) => sum + p.y, 0) / cluster.points.length;
                }
            });
        }

        function distance(point1, point2) {
            return Math.sqrt(Math.pow(point1.x - point2.x, 2) + Math.pow(point1.y - point2.y, 2));
        }

        function kMeans() {
            initializeClusters();
            for (let i = 0; i < 10; i++) { // limiting to 10 iterations for demonstration
                updateClusters();
                drawPoints();
            }
        }

        document.getElementById('start').addEventListener('click', () => {
            k = parseInt(document.getElementById('k').value, 10);
            kMeans();
        });
    </script>
</body>
</html>