<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Divide and Conquer: Visual Merge Sort</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            min-height: 100vh;
            padding: 24px;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 32px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 12px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .description {
            color: #a0a0a0;
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .controls {
            display: flex;
            gap: 16px;
            justify-content: center;
            align-items: center;
            margin-bottom: 32px;
            flex-wrap: wrap;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        button:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #4a4a4a;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 12px;
            color: #a0a0a0;
        }

        .speed-slider {
            width: 120px;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: #333;
            outline: none;
            border-radius: 3px;
        }

        .speed-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: #667eea;
            cursor: pointer;
            border-radius: 50%;
        }

        .visualization-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
        }

        .array-container {
            width: 100%;
            height: 300px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 4px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            margin-bottom: 32px;
        }

        .bar {
            flex: 1;
            background: #4a4a4a;
            border-radius: 4px 4px 0 0;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            color: white;
            font-size: 0.9rem;
            font-weight: 500;
            padding-bottom: 8px;
        }

        .bar.active {
            background: #f59e0b;
        }

        .bar.comparing {
            background: #ef4444;
        }

        .bar.sorted {
            background: #10b981;
        }

        .bar.group-1 {
            transform: translateX(-20px);
        }

        .bar.group-2 {
            transform: translateX(20px);
        }

        .tree-container {
            width: 100%;
            min-height: 200px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 24px;
            overflow-x: auto;
            margin-bottom: 24px;
        }

        .tree-level {
            display: flex;
            justify-content: center;
            margin-bottom: 24px;
            gap: 32px;
        }

        .tree-node {
            background: #1a1a1a;
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 12px 16px;
            font-family: monospace;
            font-size: 0.9rem;
            position: relative;
            transition: all 0.3s ease;
        }

        .tree-node.active {
            background: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .info-panel {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 24px;
            text-align: center;
        }

        .step-info {
            font-size: 1.1rem;
            color: #a0a0a0;
            margin-bottom: 12px;
        }

        .phase-indicator {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 500;
        }

        .phase-indicator.divide {
            background: #f59e0b;
        }

        .phase-indicator.conquer {
            background: #10b981;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }

            .controls {
                flex-direction: column;
                gap: 12px;
            }

            .array-container {
                height: 200px;
            }

            .bar {
                font-size: 0.75rem;
            }

            button {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Divide and Conquer: Visual Merge Sort</h1>
        <p class="description">
            Experience how divide and conquer breaks down complex problems into smaller, 
            manageable pieces. Watch as merge sort recursively divides the array, 
            solves each part, and combines them into a sorted result.
        </p>
    </div>

    <div class="controls">
        <button id="generateBtn">Generate New Array</button>
        <button id="startBtn">Start Sorting</button>
        <button id="stepBtn">Step Forward</button>
        <button id="resetBtn" disabled>Reset</button>
        <div class="speed-control">
            <span>Speed:</span>
            <input type="range" class="speed-slider" id="speedSlider" min="1" max="10" value="5">
        </div>
    </div>

    <div class="visualization-container">
        <div class="array-container" id="arrayContainer"></div>
        <div class="tree-container" id="treeContainer">
            <div class="tree-level" id="treeVisualization"></div>
        </div>
        <div class="info-panel">
            <div class="step-info" id="stepInfo">Click "Generate New Array" to begin</div>
            <div class="phase-indicator" id="phaseIndicator">Ready</div>
        </div>
    </div>

    <script>
        class MergeSortVisualizer {
            constructor() {
                this.array = [];
                this.originalArray = [];
                this.isRunning = false;
                this.isPaused = false;
                this.currentStep = 0;
                this.steps = [];
                this.delay = 500;
                
                this.arrayContainer = document.getElementById('arrayContainer');
                this.treeContainer = document.getElementById('treeVisualization');
                this.stepInfo = document.getElementById('stepInfo');
                this.phaseIndicator = document.getElementById('phaseIndicator');
                
                this.setupEventListeners();
                this.generateArray();
            }

            setupEventListeners() {
                document.getElementById('generateBtn').addEventListener('click', () => {
                    this.generateArray();
                });
                
                document.getElementById('startBtn').addEventListener('click', () => {
                    this.startSorting();
                });
                
                document.getElementById('stepBtn').addEventListener('click', () => {
                    this.stepForward();
                });
                
                document.getElementById('resetBtn').addEventListener('click', () => {
                    this.reset();
                });
                
                document.getElementById('speedSlider').addEventListener('input', (e) => {
                    this.delay = 1100 - (e.target.value * 100);
                });
            }

            generateArray() {
                this.array = [];
                for (let i = 0; i < 8; i++) {
                    this.array.push(Math.floor(Math.random() * 50) + 10);
                }
                this.originalArray = [...this.array];
                this.steps = [];
                this.currentStep = 0;
                this.renderArray();
                this.updateInfo('New array generated. Click "Start Sorting" to begin!', 'Ready');
                this.enableButtons(['startBtn', 'generateBtn']);
                this.disableButtons(['resetBtn', 'stepBtn']);
            }

            renderArray(highlights = {}) {
                this.arrayContainer.innerHTML = '';
                const maxValue = Math.max(...this.array);
                
                this.array.forEach((value, index) => {
                    const bar = document.createElement('div');
                    bar.className = 'bar';
                    bar.style.height = `${(value / maxValue) * 250}px`;
                    bar.textContent = value;
                    
                    if (highlights.active?.includes(index)) {
                        bar.classList.add('active');
                    }
                    if (highlights.comparing?.includes(index)) {
                        bar.classList.add('comparing');
                    }
                    if (highlights.sorted?.includes(index)) {
                        bar.classList.add('sorted');
                    }
                    if (highlights.group1?.includes(index)) {
                        bar.classList.add('group-1');
                    }
                    if (highlights.group2?.includes(index)) {
                        bar.classList.add('group-2');
                    }
                    
                    this.arrayContainer.appendChild(bar);
                });
            }

            async mergeSort(arr, start, end, depth = 0) {
                if (start >= end) return;

                const mid = Math.floor((start + end) / 2);
                
                // Divide phase
                this.steps.push({
                    type: 'divide',
                    array: [...this.array],
                    highlights: {
                        group1: Array.from({length: mid - start + 1}, (_, i) => start + i),
                        group2: Array.from({length: end - mid}, (_, i) => mid + 1 + i)
                    },
                    message: `Dividing array from index ${start} to ${end} at middle index ${mid}`,
                    phase: 'Divide'
                });

                await this.mergeSort(arr, start, mid, depth + 1);
                await this.mergeSort(arr, mid + 1, end, depth + 1);
                await this.merge(arr, start, mid, end);
            }

            async merge(arr, start, mid, end) {
                const left = arr.slice(start, mid + 1);
                const right = arr.slice(mid + 1, end + 1);
                let i = 0, j = 0, k = start;

                while (i < left.length && j < right.length) {
                    this.steps.push({
                        type: 'compare',
                        array: [...this.array],
                        highlights: {
                            comparing: [start + i, mid + 1 + j],
                            active: Array.from({length: end - start + 1}, (_, idx) => start + idx)
                        },
                        message: `Comparing ${left[i]} and ${right[j]}`,
                        phase: 'Conquer'
                    });

                    if (left[i] <= right[j]) {
                        this.array[k] = left[i];
                        i++;
                    } else {
                        this.array[k] = right[j];
                        j++;
                    }
                    k++;

                    this.steps.push({
                        type: 'merge',
                        array: [...this.array],
                        highlights: {
                            sorted: Array.from({length: k - start}, (_, idx) => start + idx),
                            active: Array.from({length: end - start + 1}, (_, idx) => start + idx)
                        },
                        message: `Placed ${this.array[k - 1]} at position ${k - 1}`,
                        phase: 'Conquer'
                    });
                }

                while (i < left.length) {
                    this.array[k] = left[i];
                    i++;
                    k++;
                }

                while (j < right.length) {
                    this.array[k] = right[j];
                    j++;
                    k++;
                }

                this.steps.push({
                    type: 'merged',
                    array: [...this.array],
                    highlights: {
                        sorted: Array.from({length: end - start + 1}, (_, i) => start + i)
                    },
                    message: `Merged subarray from index ${start} to ${end}`,
                    phase: 'Conquer'
                });
            }

            async startSorting() {
                this.isRunning = true;
                this.isPaused = false;
                this.steps = [];
                this.currentStep = 0;
                this.array = [...this.originalArray];
                
                this.disableButtons(['startBtn', 'generateBtn']);
                this.enableButtons(['resetBtn']);
                
                await this.mergeSort(this.array, 0, this.array.length - 1);
                
                this.steps.push({
                    type: 'complete',
                    array: [...this.array],
                    highlights: {
                        sorted: Array.from({length: this.array.length}, (_, i) => i)
                    },
                    message: 'Array is fully sorted!',
                    phase: 'Complete'
                });
                
                this.animate();
            }

            async animate() {
                while (this.currentStep < this.steps.length && this.isRunning && !this.isPaused) {
                    const step = this.steps[this.currentStep];
                    this.array = [...step.array];
                    this.renderArray(step.highlights);
                    this.updateInfo(step.message, step.phase);
                    
                    await this.sleep(this.delay);
                    this.currentStep++;
                }
                
                if (this.currentStep >= this.steps.length) {
                    this.isRunning = false;
                    this.enableButtons(['generateBtn']);
                    this.disableButtons(['stepBtn']);
                }
            }

            stepForward() {
                if (this.currentStep < this.steps.length) {
                    const step = this.steps[this.currentStep];
                    this.array = [...step.array];
                    this.renderArray(step.highlights);
                    this.updateInfo(step.message, step.phase);
                    this.currentStep++;
                    
                    if (this.currentStep >= this.steps.length) {
                        this.disableButtons(['stepBtn']);
                    }
                }
            }

            reset() {
                this.isRunning = false;
                this.isPaused = false;
                this.currentStep = 0;
                this.array = [...this.originalArray];
                this.renderArray();
                this.updateInfo('Array reset. Click "Start Sorting" to begin!', 'Ready');
                this.enableButtons(['startBtn', 'generateBtn']);
                this.disableButtons(['resetBtn']);
                
                if (this.steps.length > 0) {
                    this.enableButtons(['stepBtn']);
                }
            }

            updateInfo(message, phase) {
                this.stepInfo.textContent = message;
                this.phaseIndicator.textContent = phase;
                this.phaseIndicator.className = 'phase-indicator';
                if (phase === 'Divide') {
                    this.phaseIndicator.classList.add('divide');
                } else if (phase === 'Conquer') {
                    this.phaseIndicator.classList.add('conquer');
                }
            }

            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            enableButtons(buttons) {
                buttons.forEach(id => {
                    document.getElementById(id).disabled = false;
                });
            }

            disableButtons(buttons) {
                buttons.forEach(id => {
                    document.getElementById(id).disabled = true;
                });
            }
        }

        // Initialize the visualizer
        const visualizer = new MergeSortVisualizer();
    </script>
</body>
</html>