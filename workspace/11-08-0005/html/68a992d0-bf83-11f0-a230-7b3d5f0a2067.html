<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bubble Sort Visualization</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #f5f5f7;
            color: #1d1d1f;
            line-height: 1.6;
            padding: 24px;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 32px;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: #1d1d1f;
        }

        .description {
            font-size: 1.1rem;
            color: #6e6e73;
            max-width: 600px;
            margin: 0 auto;
        }

        .visualization {
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 16px;
        }

        .array-container {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            height: 240px;
            gap: 8px;
            margin-bottom: 24px;
            position: relative;
        }

        .array-element {
            flex: 1;
            max-width: 80px;
            position: relative;
            transition: transform 0.3s ease;
        }

        .bar {
            background: #007aff;
            border-radius: 8px 8px 0 0;
            position: relative;
            transition: all 0.3s ease;
            min-height: 20px;
        }

        .bar.comparing {
            background: #5856d6;
            box-shadow: 0 0 20px rgba(88, 86, 214, 0.5);
            transform: translateY(-4px);
        }

        .bar.sorted {
            background: #34c759;
        }

        .bar-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .bar-index {
            position: absolute;
            bottom: -24px;
            left: 50%;
            transform: translateX(-50%);
            color: #6e6e73;
            font-size: 0.9rem;
        }

        .info-panel {
            background: #f5f5f7;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .status {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 12px;
            color: #1d1d1f;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
        }

        .stat {
            display: flex;
            flex-direction: column;
        }

        .stat-label {
            color: #6e6e73;
            font-size: 0.9rem;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #007aff;
        }

        .controls {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 16px;
        }

        .button-group {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            background: #007aff;
            color: white;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #c7c7cc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        button.secondary {
            background: #e5e5ea;
            color: #1d1d1f;
        }

        button.secondary:hover {
            background: #d1d1d6;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .speed-control label {
            font-weight: 500;
            color: #1d1d1f;
        }

        .slider {
            flex: 1;
            height: 4px;
            border-radius: 2px;
            background: #e5e5ea;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #007aff;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #007aff;
            cursor: pointer;
            border: none;
            transition: all 0.2s ease;
        }

        .code-display {
            background: #1d1d1f;
            color: #f5f5f7;
            border-radius: 16px;
            padding: 24px;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            overflow-x: auto;
        }

        .code-line {
            padding: 4px 8px;
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }

        .code-line.active {
            background: #007aff;
            color: white;
        }

        .speed-value {
            min-width: 60px;
            text-align: right;
            font-weight: 500;
            color: #007aff;
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 2rem;
            }

            .array-container {
                height: 180px;
            }

            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }

            .speed-control {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Bubble Sort Visualization</h1>
            <p class="description">
                Watch how bubble sort compares adjacent elements and swaps them if they're in the wrong order, 
                causing larger values to "bubble up" to the end of the array.
            </p>
        </header>

        <div class="visualization">
            <div class="array-container" id="arrayContainer"></div>
        </div>

        <div class="info-panel">
            <div class="status" id="status">Click "Generate Array" to begin</div>
            <div class="stats">
                <div class="stat">
                    <span class="stat-label">Current Pass</span>
                    <span class="stat-value" id="passCount">-</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Comparisons</span>
                    <span class="stat-value" id="comparisonCount">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Swaps Made</span>
                    <span class="stat-value" id="swapCount">0</span>
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="button-group">
                <button onclick="generateArray()">Generate Array</button>
                <button onclick="step()" id="stepBtn" disabled>Next Step</button>
                <button onclick="reset()" id="resetBtn" disabled>Reset</button>
                <button onclick="toggleAutoPlay()" id="playBtn" disabled>
                    <span id="playBtnText">Auto Play</span>
                </button>
            </div>
            <div class="speed-control">
                <label for="speedSlider">Speed:</label>
                <input type="range" id="speedSlider" class="slider" 
                       min="100" max="1000" value="500" step="50">
                <span class="speed-value" id="speedValue">500ms</span>
            </div>
        </div>

        <div class="code-display">
            <div class="code-line" id="line1">for i from 0 to n-1:</div>
            <div class="code-line" id="line2">    for j from 0 to n-i-2:</div>
            <div class="code-line" id="line3">        if array[j] > array[j+1]:</div>
            <div class="code-line" id="line4">            swap(array[j], array[j+1])</div>
        </div>
    </div>

    <script>
        let array = [];
        let currentPass = 0;
        let currentIndex = 0;
        let comparisons = 0;
        let swaps = 0;
        let isPlaying = false;
        let playInterval = null;
        let isSorting = false;

        const arrayContainer = document.getElementById('arrayContainer');
        const statusEl = document.getElementById('status');
        const passCountEl = document.getElementById('passCount');
        const comparisonCountEl = document.getElementById('comparisonCount');
        const swapCountEl = document.getElementById('swapCount');
        const stepBtn = document.getElementById('stepBtn');
        const resetBtn = document.getElementById('resetBtn');
        const playBtn = document.getElementById('playBtn');
        const playBtnText = document.getElementById('playBtnText');
        const speedSlider = document.getElementById('speedSlider');
        const speedValue = document.getElementById('speedValue');

        speedSlider.addEventListener('input', (e) => {
            speedValue.textContent = e.target.value + 'ms';
            if (isPlaying) {
                stopAutoPlay();
                startAutoPlay();
            }
        });

        function generateArray() {
            array = [];
            for (let i = 0; i < 8; i++) {
                array.push(Math.floor(Math.random() * 50) + 1);
            }
            reset();
            renderArray();
            stepBtn.disabled = false;
            resetBtn.disabled = false;
            playBtn.disabled = false;
            statusEl.textContent = "Array generated. Click 'Next Step' to begin sorting.";
        }

        function reset() {
            currentPass = 0;
            currentIndex = 0;
            comparisons = 0;
            swaps = 0;
            isSorting = false;
            stopAutoPlay();
            updateStats();
            clearHighlights();
            renderArray();
            statusEl.textContent = "Ready to sort. Click 'Next Step' to begin.";
        }

        function renderArray() {
            arrayContainer.innerHTML = '';
            const maxValue = Math.max(...array);
            
            array.forEach((value, index) => {
                const element = document.createElement('div');
                element.className = 'array-element';
                element.id = `element-${index}`;
                
                const bar = document.createElement('div');
                bar.className = 'bar';
                bar.style.height = `${(value / maxValue) * 200}px`;
                
                if (index >= array.length - currentPass) {
                    bar.classList.add('sorted');
                }
                
                const valueLabel = document.createElement('div');
                valueLabel.className = 'bar-value';
                valueLabel.textContent = value;
                
                const indexLabel = document.createElement('div');
                indexLabel.className = 'bar-index';
                indexLabel.textContent = index;
                
                bar.appendChild(valueLabel);
                element.appendChild(bar);
                element.appendChild(indexLabel);
                arrayContainer.appendChild(element);
            });
        }

        function updateStats() {
            passCountEl.textContent = currentPass + 1;
            comparisonCountEl.textContent = comparisons;
            swapCountEl.textContent = swaps;
        }

        function clearHighlights() {
            document.querySelectorAll('.code-line').forEach(line => {
                line.classList.remove('active');
            });
            document.querySelectorAll('.bar').forEach(bar => {
                bar.classList.remove('comparing');
            });
        }

        function highlightElements(index1, index2) {
            clearHighlights();
            document.querySelector(`#element-${index1} .bar`).classList.add('comparing');
            document.querySelector(`#element-${index2} .bar`).classList.add('comparing');
        }

        function swapElements(index1, index2) {
            const temp = array[index1];
            array[index1] = array[index2];
            array[index2] = temp;
            
            const el1 = document.getElementById(`element-${index1}`);
            const el2 = document.getElementById(`element-${index2}`);
            
            const el1Rect = el1.getBoundingClientRect();
            const el2Rect = el2.getBoundingClientRect();
            const distance = el2Rect.left - el1Rect.left;
            
            el1.style.transform = `translateX(${distance}px)`;
            el2.style.transform = `translateX(${-distance}px)`;
            
            setTimeout(() => {
                renderArray();
            }, 300);
        }

        function step() {
            if (!isSorting) {
                isSorting = true;
                statusEl.textContent = "Sorting in progress...";
            }

            if (currentPass >= array.length - 1) {
                statusEl.textContent = "Array is fully sorted!";
                stepBtn.disabled = true;
                playBtn.disabled = true;
                stopAutoPlay();
                clearHighlights();
                return;
            }

            clearHighlights();

            if (currentIndex < array.length - 1 - currentPass) {
                highlightElements(currentIndex, currentIndex + 1);
                comparisons++;
                
                document.getElementById('line1').classList.add('active');
                document.getElementById('line2').classList.add('active');
                document.getElementById('line3').classList.add('active');
                
                if (array[currentIndex] > array[currentIndex + 1]) {
                    statusEl.textContent = `Comparing ${array[currentIndex]} and ${array[currentIndex + 1]} - Swapping needed!`;
                    document.getElementById('line4').classList.add('active');
                    swapElements(currentIndex, currentIndex + 1);
                    swaps++;
                } else {
                    statusEl.textContent = `Comparing ${array[currentIndex]} and ${array[currentIndex + 1]} - No swap needed.`;
                }
                
                updateStats();
                currentIndex++;
            } else {
                currentIndex = 0;
                currentPass++;
                
                if (currentPass < array.length - 1) {
                    statusEl.textContent = `Pass ${currentPass} complete. Starting pass ${currentPass + 1}.`;
                    updateStats();
                } else {
                    statusEl.textContent = "Sorting complete!";
                    stepBtn.disabled = true;
                    playBtn.disabled = true;
                    stopAutoPlay();
                }
            }
        }

        function startAutoPlay() {
            playInterval = setInterval(() => {
                step();
                if (stepBtn.disabled) {
                    stopAutoPlay();
                }
            }, parseInt(speedSlider.value));
        }

        function stopAutoPlay() {
            if (playInterval) {
                clearInterval(playInterval);
                playInterval = null;
            }
            isPlaying = false;
            playBtnText.textContent = 'Auto Play';
        }

        function toggleAutoPlay() {
            if (isPlaying) {
                stopAutoPlay();
            } else {
                isPlaying = true;
                playBtnText.textContent = 'Pause';
                startAutoPlay();
            }
        }

        // Initialize with a default array
        generateArray();
    </script>
</body>
</html>