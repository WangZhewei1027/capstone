<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Radix Sort Visualizer (LSD) — Interactive Demo</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#0f1724;
      --panel:#071129;
      --accent:#39a7ff;
      --muted:#94a3b8;
      --card:#0b1220;
      --good:#22c55e;
      --danger:#fb7185;
      --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071126 0%, #071b2a 100%);color:#e6eef8;}
    .container{max-width:1100px;margin:24px auto;padding:20px;}
    header{display:flex;gap:16px;align-items:center;margin-bottom:18px;}
    h1{font-size:20px;margin:0;}
    .controls{display:flex;gap:14px;align-items:center;flex-wrap:wrap;}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:10px;padding:12px;}
    .control{display:flex;gap:8px;align-items:center;}
    label{font-size:12px;color:var(--muted);}
    input[type=range]{width:140px;}
    input[type=text]{background:transparent;border:1px solid rgba(255,255,255,0.06);color:inherit;padding:6px 8px;border-radius:6px;min-width:220px;}
    button{background:var(--accent);border:none;color:#04202a;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:600}
    button.ghost{background:transparent;border-radius:8px;padding:8px}
    .layout{display:grid;grid-template-columns:1fr 360px;gap:14px;margin-top:18px;}
    .visual.card{padding:16px;min-height:420px;display:flex;flex-direction:column;gap:12px}
    .array-row{display:flex;gap:6px;align-items:end;height:140px;padding:6px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));}
    .bar{background:linear-gradient(180deg,var(--accent),#0ba6ff);width:28px;border-radius:6px;display:flex;align-items:flex-end;justify-content:center;color:#032a36;font-weight:700;filter:drop-shadow(0 4px 8px rgba(2,6,23,0.6));transition:transform 350ms;}
    .bar.small{width:22px;font-size:11px}
    .value{padding:6px 4px;color:#00262a;background:rgba(255,255,255,0.9);border-radius:4px;margin-bottom:6px;font-weight:700}
    .buckets{display:flex;gap:6px;align-items:flex-start;justify-content:flex-start;flex-wrap:nowrap;padding:6px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));min-height:120px}
    .bucket{flex:0 0 46px;background:rgba(255,255,255,0.02);border-radius:8px;padding:6px;display:flex;flex-direction:column;gap:6px;align-items:center;min-height:80px;border:1px dashed rgba(255,255,255,0.03)}
    .bucket .label{font-size:12px;color:var(--muted);margin-bottom:4px}
    .bucket .item{background:var(--glass);padding:4px 6px;border-radius:6px;font-weight:700;font-size:12px;color:var(--accent);width:100%;text-align:center}
    .sidebar.card{padding:12px;display:flex;flex-direction:column;gap:12px;height:100%}
    .panel{background:rgba(255,255,255,0.02);padding:10px;border-radius:8px}
    .info{font-size:13px;color:var(--muted);line-height:1.35}
    .pseudo{background:#001426;padding:10px;border-radius:8px;color:#bfe9ff;font-family:monospace;font-size:13px;white-space:pre-wrap;max-height:260px;overflow:auto}
    .controls-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .status{font-size:13px;color:var(--muted);display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .badge{padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.03);font-weight:700;color:var(--muted);font-size:13px}
    .highlight{background:linear-gradient(90deg,#063449,#004a5f);padding:6px 8px;border-radius:8px;font-weight:700;color:#bff1ff}
    footer{margin-top:18px;color:var(--muted);font-size:13px}
    @media (max-width:980px){.layout{grid-template-columns:1fr;}.array-row{height:100px}.bar{width:20px}.bucket{flex:1 0 36px}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div style="flex:1">
        <h1>Radix Sort Visualizer (LSD) — Stable integer sort by digits</h1>
        <div class="info" style="margin-top:6px">
          This interactive demo walks through Least Significant Digit (LSD) Radix Sort on non-negative integers.
          Use controls to change the array, base (radix), and step through distribution and collection phases.
        </div>
      </div>

      <div class="controls card">
        <div class="control">
          <label>Size</label>
          <input id="sizeRange" type="range" min="3" max="18" value="10" />
          <span id="sizeValue" class="badge">10</span>
        </div>

        <div class="control">
          <label>Max value</label>
          <input id="maxRange" type="range" min="9" max="999" value="99" />
          <span id="maxValue" class="badge">99</span>
        </div>

        <div class="control">
          <label>Base (radix)</label>
          <input id="baseInput" type="number" min="2" max="16" value="10" style="width:68px;padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit"/>
        </div>

        <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
          <button id="randomBtn">Shuffle / Randomize</button>
          <button id="resetBtn" class="secondary">Reset</button>
        </div>
      </div>
    </header>

    <div class="layout">
      <section class="visual card">
        <div style="display:flex;justify-content:space-between;align-items:end">
          <div class="status">
            <div class="badge">Radix: <span id="radixBadge">10</span></div>
            <div class="badge">Steps: <span id="stepsBadge">0</span></div>
            <div class="badge">State: <span id="stateBadge">—</span></div>
            <div id="digitBadge" class="badge">Digit: —</div>
          </div>

          <div style="display:flex;gap:8px;align-items:center">
            <label style="font-size:13px;color:var(--muted)">Speed</label>
            <input id="speed" type="range" min="200" max="2000" step="100" value="900" />
            <button id="playBtn" class="ghost" title="Play/pause">▶️</button>
            <button id="prevBtn" class="ghost" title="Previous step">⏮️</button>
            <button id="nextBtn" class="ghost" title="Next step">⏭️</button>
          </div>
        </div>

        <div class="panel">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:700">Array</div>
            <div class="info" style="font-size:13px">Bars are proportional to value. Values shown on top.</div>
          </div>

          <div id="arrayRow" class="array-row" style="margin-top:10px"></div>
        </div>

        <div class="panel">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
            <div style="font-weight:700">Buckets</div>
            <div id="phaseText" class="info" style="font-size:13px">Distribution & Collection steps shown for each digit (least significant to most).</div>
          </div>

          <div id="buckets" class="buckets"></div>
        </div>

        <div class="info" style="font-size:13px">
          Note: This demo implements LSD radix sort for non-negative integers. To handle negative numbers you'd sort positives and negatives separately (or offset values).
        </div>
      </section>

      <aside class="sidebar card">
        <div>
          <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
            <input id="arrayInput" type="text" placeholder="Type numbers separated by commas (e.g. 170,45,75)" />
            <button id="setArray" class="secondary">Set</button>
          </div>
          <div class="info">Or click Shuffle to generate a random array using selected size & max value. Use Next/Prev to step through algorithm states.</div>
        </div>

        <div>
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:700">Pseudo-code (LSD Radix Sort)</div>
            <div style="font-size:12px;color:var(--muted)">Stable per-digit counting using buckets</div>
          </div>
          <div class="pseudo" id="pseudo">
function radixSortLSD(array, base):
  maxVal = max(array)
  maxDigits = number of digits of maxVal in base
  for d = 0 to maxDigits-1:
    // distribution
    buckets = array of base empty queues
    for item in array:
      digit = (item // base^d) % base
      buckets[digit].enqueue(item)
    // collection in order (stable)
    array = concat(buckets[0], buckets[1], ... , buckets[base-1])
  return array
          </div>
        </div>

        <div>
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:700">Current explanation</div>
            <div id="explainShort" class="badge">—</div>
          </div>
          <div id="explainText" class="info" style="margin-top:8px;min-height:60px">
            Walk through the distribution and collection phases for each digit (starting at the least significant digit).
          </div>
        </div>

        <footer>
          Tip: Try small arrays and different bases (binary, octal, decimal, hex) to see how digits affect distribution.
        </footer>
      </aside>
    </div>
  </div>

  <script>
    // Radix Sort Visualizer (LSD) - Single HTML file, vanilla JS
    (function(){
      // DOM
      const sizeRange = document.getElementById('sizeRange');
      const sizeValue = document.getElementById('sizeValue');
      const maxRange = document.getElementById('maxRange');
      const maxValue = document.getElementById('maxValue');
      const baseInput = document.getElementById('baseInput');
      const radixBadge = document.getElementById('radixBadge');
      const arrayRow = document.getElementById('arrayRow');
      const bucketsDiv = document.getElementById('buckets');
      const randomBtn = document.getElementById('randomBtn');
      const resetBtn = document.getElementById('resetBtn');
      const arrayInput = document.getElementById('arrayInput');
      const setArrayBtn = document.getElementById('setArray');
      const playBtn = document.getElementById('playBtn');
      const nextBtn = document.getElementById('nextBtn');
      const prevBtn = document.getElementById('prevBtn');
      const speedInput = document.getElementById('speed');
      const stepsBadge = document.getElementById('stepsBadge');
      const stateBadge = document.getElementById('stateBadge');
      const digitBadge = document.getElementById('digitBadge');
      const phaseText = document.getElementById('phaseText');
      const explainText = document.getElementById('explainText');

      // Model
      let array = [];
      let base = parseInt(baseInput.value,10) || 10;
      let states = []; // generated states for animation
      let stepIndex = -1;
      let timer = null;

      // Utility
      function randInt(max){ return Math.floor(Math.random()*(max+1)); }
      function clamp(v,min,max){ return Math.max(min,Math.min(max,v)); }
      function copyDeep(x){ return JSON.parse(JSON.stringify(x)); }

      // Setup initial
      function initRandom(){
        const n = parseInt(sizeRange.value,10);
        const maxv = parseInt(maxRange.value,10);
        array = new Array(n).fill(0).map(()=>randInt(maxv));
        buildStates();
        stepIndex = -1;
        renderStep(0); // first state (initial array)
      }

      // Build states array by simulating LSD radix sort
      // We'll include an initial state representing the starting array (index 0).
      // Then for each digit d:
      //   - push distribution state: {type:'distribution', digit:d, buckets:[...], array:currentArray}
      //   - push collection state: {type:'collection', digit:d, buckets:[...], array:newArray}
      function buildStates(){
        states = [];
        const arr = array.slice();
        states.push({type:'start', digit:null, array:arr.slice(), buckets:[]});
        base = clamp(parseInt(baseInput.value,10)||10,2,16);
        radixBadge.textContent = base;
        // edge: if all zeros, maxDigits = 1
        const maxVal = arr.length ? Math.max(...arr) : 0;
        const maxDigits = Math.max(1, Math.floor(Math.log(maxVal)/Math.log(base))+1 || 1);

        let working = arr.slice();
        for(let d=0; d<maxDigits; d++){
          // distribution
          const buckets = new Array(base).fill(0).map(()=>[]);
          for(const item of working){
            const digit = Math.floor(item / Math.pow(base,d)) % base;
            buckets[digit].push(item);
          }
          states.push({type:'distribution', digit:d, array:working.slice(), buckets:copyDeep(buckets)});
          // collection
          const collected = [];
          for(let b=0;b<base;b++){
            for(const v of buckets[b]) collected.push(v);
          }
          working = collected.slice();
          states.push({type:'collection', digit:d, array:working.slice(), buckets:copyDeep(buckets)});
        }
        stepsBadge.textContent = states.length;
        // reset step pointer
        stepIndex = 0;
      }

      // Render helpers
      function renderArray(arr, highlightIndex=null){
        arrayRow.innerHTML = '';
        if(!arr) return;
        const maxVal = arr.length ? Math.max(...arr) : 1;
        const minHeight = 18;
        for(let i=0;i<arr.length;i++){
          const v = arr[i];
          const hPct = maxVal>0 ? (v / maxVal) : 0;
          const height = Math.max(minHeight, Math.round(hPct*110)+12);
          const bar = document.createElement('div');
          bar.className = 'bar';
          if(arr.length>14) bar.classList.add('small');
          bar.style.height = height+'px';
          bar.style.transition = 'transform 450ms, opacity 240ms';
          // show value box on top
          const val = document.createElement('div');
          val.className='value';
          val.textContent = v;
          bar.appendChild(val);
          if(i===highlightIndex){
            bar.style.boxShadow = '0 0 18px rgba(255,255,255,0.06), 0 8px 16px rgba(3,128,162,0.14)';
            bar.style.transform = 'translateY(-8px)';
          }
          arrayRow.appendChild(bar);
        }
      }

      function renderBuckets(buckets){
        bucketsDiv.innerHTML = '';
        if(!buckets || !buckets.length){
          // nothing to show
          const placeholder = document.createElement('div');
          placeholder.style.color='var(--muted)';
          placeholder.textContent = 'Buckets will appear during distribution steps.';
          bucketsDiv.appendChild(placeholder);
          return;
        }
        for(let i=0;i<buckets.length;i++){
          const b = document.createElement('div');
          b.className='bucket';
          const lbl = document.createElement('div');
          lbl.className='label';
          lbl.textContent = i;
          b.appendChild(lbl);
          const bucketItems = buckets[i];
          if(bucketItems.length===0){
            const p = document.createElement('div');
            p.style.fontSize='12px';
            p.style.color='rgba(255,255,255,0.06)';
            p.textContent = '—';
            b.appendChild(p);
          } else {
            for(const v of bucketItems){
              const it = document.createElement('div');
              it.className='item';
              it.textContent = v;
              b.appendChild(it);
            }
          }
          bucketsDiv.appendChild(b);
        }
      }

      function explainState(s){
        if(!s) return '';
        if(s.type==='start') return 'Initial array (unsorted).';
        if(s.type==='distribution'){
          return `Distribution for digit index ${s.digit} (extract digit: floor(value / ${base}^${s.digit}) % ${base}).\nWe place each item into the bucket that matches its digit. Buckets are indexed 0..${base-1}.`;
        }
        if(s.type==='collection'){
          return `Collection after placing items by digit ${s.digit}.\nWe concatenate buckets in order: bucket 0, bucket 1, ..., bucket ${base-1}. Because we preserve the original order within each bucket, the sort is stable for this digit.`;
        }
        return '';
      }

      // Render a particular step in states
      function renderStep(idx){
        idx = clamp(idx,0,states.length-1);
        stepIndex = idx;
        const s = states[stepIndex];
        stateBadge.textContent = s.type || '—';
        digitBadge.textContent = s.digit===null ? '—' : s.digit;
        explainText.textContent = explainState(s);
        // Which array to show?
        if(s.type==='distribution'){
          renderArray(s.array);
          renderBuckets(s.buckets);
          phaseText.textContent = `Distribution (digit ${s.digit}). Items are placed into buckets based on the current digit.`;
        } else if(s.type==='collection'){
          renderArray(s.array);
          renderBuckets(s.buckets);
          phaseText.textContent = `Collection (digit ${s.digit}). Buckets concatenated to form next array order.`;
        } else if(s.type==='start'){
          renderArray(s.array);
          renderBuckets([]);
          phaseText.textContent = 'Initial state';
        } else {
          renderArray(s.array);
          renderBuckets([]);
        }
        // update buttons text
        playBtn.textContent = timer ? '⏸️' : '▶️';
      }

      // Controls
      sizeRange.addEventListener('input',()=>{
        sizeValue.textContent = sizeRange.value;
      });

      maxRange.addEventListener('input',()=>{
        maxValue.textContent = maxRange.value;
      });

      randomBtn.addEventListener('click', ()=>{
        initRandom();
      });

      resetBtn.addEventListener('click', ()=>{
        // reset to a clean random but keep size/max/base as is
        initRandom();
      });

      baseInput.addEventListener('change', ()=>{
        const b = clamp(parseInt(baseInput.value||10,10),2,16);
        baseInput.value = b;
        radixBadge.textContent = b;
        buildStates();
        renderStep(0);
      });

      setArrayBtn.addEventListener('click', ()=>{
        const raw = arrayInput.value.trim();
        if(!raw) return;
        const parts = raw.split(',').map(p=>p.trim()).filter(p=>p.length);
        const parsed = [];
        for(const p of parts){
          const n = Number(p);
          if(Number.isFinite(n) && n>=0 && Number.isInteger(n)) parsed.push(n);
        }
        if(parsed.length===0){
          alert('Enter a comma-separated list of non-negative integers (e.g. 170,45,75).');
          return;
        }
        array = parsed.slice();
        // reflect size and max sliders
        sizeRange.value = Math.min(18,Math.max(3,array.length));
        sizeValue.textContent = sizeRange.value;
        const maxv = Math.max(...array);
        maxRange.value = Math.max(9,maxv);
        maxValue.textContent = maxRange.value;
        buildStates();
        renderStep(0);
      });

      nextBtn.addEventListener('click', ()=>{
        if(stepIndex < states.length-1){
          renderStep(stepIndex+1);
        } else {
          // end reached
          renderStep(states.length-1);
          stopAuto();
        }
      });

      prevBtn.addEventListener('click', ()=>{
        if(stepIndex > 0){
          renderStep(stepIndex-1);
        }
      });

      playBtn.addEventListener('click', ()=>{
        if(timer) stopAuto();
        else startAuto();
      });

      function startAuto(){
        if(stepIndex >= states.length-1) {
          renderStep(0);
        }
        timer = setInterval(()=>{
          if(stepIndex < states.length-1){
            renderStep(stepIndex+1);
          } else {
            stopAuto();
          }
        }, Math.max(120, parseInt(speedInput.value,10)));
        playBtn.textContent = '⏸️';
      }
      function stopAuto(){
        if(timer){
          clearInterval(timer);
          timer = null;
        }
        playBtn.textContent = '▶️';
      }

      // react to size/max change to produce new random array
      sizeRange.addEventListener('change', ()=>{
        initRandom();
      });
      maxRange.addEventListener('change', ()=>{
        initRandom();
      });

      // Initialize
      initRandom();

      // For clarity, expose some state while debugging (not required)
      window._radixVisualizer = {
        states, getState: ()=>states, getArray: ()=>array
      };

      // Accessibility / keyboard shortcuts
      document.addEventListener('keydown',(e)=>{
        if(e.key===' '){
          e.preventDefault();
          if(timer) stopAuto(); else startAuto();
        } else if(e.key==='ArrowRight'){
          nextBtn.click();
        } else if(e.key==='ArrowLeft'){
          prevBtn.click();
        }
      });
    })();
  </script>
</body>
</html>