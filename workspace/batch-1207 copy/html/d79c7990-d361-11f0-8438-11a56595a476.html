<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Union-Find (Disjoint Set) Visualization</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f7f9fc;
    color: #333;
  }
  h1 {
    text-align: center;
  }
  #controls {
    margin-bottom: 20px;
    display: flex; 
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
  }
  label {
    margin-right: 5px;
  }
  button {
    cursor: pointer;
    padding: 6px 12px;
    font-size: 14px;
  }
  input[type=number] {
    width: 50px;
    padding: 4px;
  }
  #setsContainer {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
    margin-top: 20px;
  }
  .set {
    border: 2px solid #0077cc;
    border-radius: 12px;
    padding: 12px 15px;
    background: white;
    min-width: 60px;
    text-align: center;
    user-select: none;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    position: relative;
  }
  .set .representative {
    font-weight: bold;
    font-size: 18px;
    color: #004a99;
  }
  .set .elements {
    margin-top: 8px;
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    justify-content: center;
  }
  .element {
    background: #0077cc;
    color: white;
    font-weight: bold;
    border-radius: 50%;
    width: 28px;
    height: 28px;
    line-height: 28px;
    user-select: none;
  }
  #info {
    margin-top: 20px;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
    background: #e1f0ff;
    padding: 12px;
    border-radius: 8px;
    font-size: 14px;
    color: #004a99;
  }
  #log {
    max-height: 150px;
    overflow-y: auto;
    background: #fff;
    border: 1px solid #ddd;
    font-size: 13px;
    padding: 8px;
    border-radius: 6px;
    margin-top: 10px;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }
  #log p {
    margin: 0 0 4px 0;
  }
</style>
</head>
<body>
<h1>Union-Find (Disjoint Set) Structure Visualization</h1>

<div id="controls" aria-label="Controls for Union-Find operations">
  <div>
    <label for="totalElements">Total Elements:</label>
    <input type="number" id="totalElements" min="1" max="30" value="10" aria-describedby="totalElementsHelp" />
    <small id="totalElementsHelp">(1 to 30)</small>
  </div>
  <button id="initializeBtn" aria-label="Initialize the Union-Find structure">Initialize</button>
</div>

<div id="unionControls" style="display:none; justify-content:center; gap:10px; flex-wrap: wrap;" aria-label="Union operation controls">
  <div>
    <label for="unionA">Union A:</label>
    <input type="number" id="unionA" min="0" value="0" />
  </div>
  <div>
    <label for="unionB">Union B:</label>
    <input type="number" id="unionB" min="0" value="1" />
  </div>
  <button id="unionBtn" aria-label="Perform union operation">Union</button>
</div>

<div id="findControls" style="display:none; justify-content:center; gap:10px; flex-wrap: wrap;" aria-label="Find operation controls">
  <div>
    <label for="findElem">Find Element:</label>
    <input type="number" id="findElem" min="0" value="0" />
  </div>
  <button id="findBtn" aria-label="Find set representative">Find</button>
</div>

<div id="setsContainer" aria-live="polite" aria-atomic="true" aria-label="Current sets"></div>

<div id="info" aria-live="polite" aria-atomic="true">
  <strong>Information:</strong> Initialize to create disjoint sets. Use Union to connect sets. Use Find to determine a set's representative.
</div>

<div id="log" aria-live="polite" aria-atomic="false" aria-label="Operation log"></div>

<script>
  class UnionFind {
    constructor(n) {
      this.count = n;
      this.parent = Array(n);
      this.size = Array(n);
      for(let i = 0; i < n; i++) {
        this.parent[i] = i;
        this.size[i] = 1;
      }
    }

    find(p) {
      this._validate(p);
      // path compression
      let root = p;
      while(root !== this.parent[root]) {
        root = this.parent[root];
      }
      // compress path
      while(p !== root) {
        let next = this.parent[p];
        this.parent[p] = root;
        p = next;
      }
      return root;
    }

    union(p, q) {
      this._validate(p);
      this._validate(q);
      let rootP = this.find(p);
      let rootQ = this.find(q);
      if(rootP === rootQ) return false;

      // union by size
      if(this.size[rootP] < this.size[rootQ]) {
        this.parent[rootP] = rootQ;
        this.size[rootQ] += this.size[rootP];
      } else {
        this.parent[rootQ] = rootP;
        this.size[rootP] += this.size[rootQ];
      }
      this.count--;
      return true;
    }

    connected(p, q) {
      this._validate(p);
      this._validate(q);
      return this.find(p) === this.find(q);
    }

    _validate(p) {
      if(p < 0 || p >= this.parent.length) {
        throw new Error("Index " + p + " is not between 0 and " + (this.parent.length-1));
      }
    }

    getCount() {
      return this.count;
    }
  }

  // DOM elements
  const totalElementsInput = document.getElementById('totalElements');
  const initializeBtn = document.getElementById('initializeBtn');
  const unionControls = document.getElementById('unionControls');
  const findControls = document.getElementById('findControls');
  const unionABInput = document.getElementById('unionA');
  const unionBBInput = document.getElementById('unionB');
  const unionBtn = document.getElementById('unionBtn');
  const findElemInput = document.getElementById('findElem');
  const findBtn = document.getElementById('findBtn');
  const setsContainer = document.getElementById('setsContainer');
  const infoBox = document.getElementById('info');
  const logBox = document.getElementById('log');

  let uf = null;

  function log(msg) {
    const p = document.createElement('p');
    p.textContent = msg;
    logBox.appendChild(p);
    logBox.scrollTop = logBox.scrollHeight;
  }

  function clearLog() {
    logBox.innerHTML = '';
  }

  function renderSets() {
    setsContainer.innerHTML = '';

    if(!uf) return;

    // Create a map from root -> array of elements
    const groups = new Map();
    for(let i = 0; i < uf.parent.length; i++) {
      const root = uf.find(i);
      if(!groups.has(root)) {
        groups.set(root, []);
      }
      groups.get(root).push(i);
    }

    // Sort keys for consistent order
    const sortedRoots = Array.from(groups.keys()).sort((a,b) => a - b);

    for(const root of sortedRoots) {
      const setDiv = document.createElement('div');
      setDiv.className = 'set';
      setDiv.setAttribute('tabindex', '0'); // make it focusable for accessibility
      setDiv.setAttribute('aria-label', `Set with representative ${root} containing elements: ${groups.get(root).join(', ')}`);

      const repr = document.createElement('div');
      repr.className = 'representative';
      repr.textContent = `Rep: ${root}`;
      setDiv.appendChild(repr);

      const elemsDiv = document.createElement('div');
      elemsDiv.className = 'elements';
      for(const e of groups.get(root)) {
        const elemSpan = document.createElement('span');
        elemSpan.className = 'element';
        elemSpan.textContent = e;
        elemsDiv.appendChild(elemSpan);
      }
      setDiv.appendChild(elemsDiv);
      setsContainer.appendChild(setDiv);
    }
    infoBox.textContent = `Total elements: ${uf.parent.length}, Number of sets: ${uf.getCount()}.`;
  }

  function validateElementInput(value, max) {
    const n = Number(value);
    if (isNaN(n) || !Number.isInteger(n)) return false;
    if (n < 0 || n >= max) return false;
    return true;
  }

  initializeBtn.addEventListener('click', () => {
    const total = Number(totalElementsInput.value);
    if(isNaN(total) || total < 1 || total > 30) {
      alert('Please enter a number between 1 and 30 for total elements.');
      return;
    }
    uf = new UnionFind(total);
    infoBox.textContent = `Initialized ${total} disjoint sets. Each element is its own set.`;
    clearLog();
    log(`Initialized Union-Find structure with ${total} elements.`);
    renderSets();
    unionControls.style.display = 'flex';
    findControls.style.display = 'flex';

    unionABInput.max = total - 1;
    unionBBInput.max = total - 1;
    findElemInput.max = total - 1;

    unionABInput.value = 0;
    unionBBInput.value = total > 1 ? 1 : 0;
    findElemInput.value = 0;
  });

  unionBtn.addEventListener('click', () => {
    if(!uf) {
      alert('Please initialize the structure first.');
      return;
    }
    const a = Number(unionABInput.value);
    const b = Number(unionBBInput.value);
    if(!validateElementInput(a, uf.parent.length) || !validateElementInput(b, uf.parent.length)) {
      alert(`Please enter valid element indices between 0 and ${uf.parent.length - 1}.`);
      return;
    }
    if(a === b) {
      alert('Cannot union the same element with itself.');
      return;
    }
    
    const connectedBefore = uf.connected(a,b);
    const unionResult = uf.union(a,b);
    if(unionResult) {
      log(`Union(${a}, ${b}): merged sets.`);
      infoBox.textContent = `Union performed: elements ${a} and ${b} are now connected. Total sets: ${uf.getCount()}.`;
    } else {
      log(`Union(${a}, ${b}): elements already connected.`);
      infoBox.textContent = `Elements ${a} and ${b} are already in the same set. Total sets: ${uf.getCount()}.`;
    }
    renderSets();
  });

  findBtn.addEventListener('click', () => {
    if(!uf) {
      alert('Please initialize the structure first.');
      return;
    }
    const x = Number(findElemInput.value);
    if(!validateElementInput(x, uf.parent.length)) {
      alert(`Please enter valid element index between 0 and ${uf.parent.length - 1}.`);
      return;
    }
    const rep = uf.find(x);
    log(`Find(${x}) -> Representative: ${rep}`);
    infoBox.textContent = `Element ${x} belongs to the set with representative ${rep}.`;
    renderSets();
  });

  // Initialize on load for convenience
  initializeBtn.click();
</script>
</body>
</html>