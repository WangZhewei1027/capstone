<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Sliding Window Visualizer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin: 18px; color: #111; }
    h1 { margin: 0 0 8px 0; font-size: 20px; }
    p { margin: 6px 0 12px 0; color: #333; }
    .controls { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; margin-bottom: 12px; }
    label { font-size: 13px; }
    select, input[type="text"], input[type="number"], button { padding: 6px 8px; font-size: 13px; }
    .panel { border: 1px solid #ddd; padding: 12px; border-radius: 8px; background:#fafafa; margin-bottom: 12px; }
    .array-row { display:flex; gap:6px; align-items:flex-end; margin: 12px 0; flex-wrap:wrap; }
    .cell { width:46px; height:46px; display:flex; align-items:center; justify-content:center; border-radius:6px; background:white; border:1px solid #ddd; font-weight:600; box-shadow: 0 1px 0 rgba(0,0,0,0.02); position:relative; }
    .cell.index { font-size:12px; color:#555; font-weight:500; height:auto; padding:6px 8px; }
    .cell.window { border-color:#2b8aef; background: linear-gradient(180deg, #e9f3ff, #f6fbff); }
    .pointer { position:absolute; top:-20px; left:50%; transform:translateX(-50%); font-size:12px; color:#2b8aef; }
    .pointer.left { top:-22px; color:#ef6b6b; }
    .pointer.right { top:-22px; color:#2b8aef; }
    .summary { margin-top:8px; font-size:14px; }
    .code { background:#111; color:#fff; padding:12px; border-radius:6px; font-family: Menlo, Monaco, monospace; font-size:13px; white-space:pre; overflow:auto; max-height:220px; }
    .status { margin-top:8px; font-size:13px; color:#333; line-height:1.4; }
    .play-controls { display:flex; gap:8px; align-items:center; margin-top:8px; }
    .steps { display:flex; gap:6px; align-items:center; margin-top:10px; flex-wrap:wrap; }
    .btn { padding:6px 10px; border-radius:6px; border:1px solid #ccc; background:white; cursor:pointer; }
    .btn.primary { background:#2b8aef; color:white; border-color:#0f6cd7; }
    .small { padding:4px 8px; font-size:13px; }
    .muted { color:#666; font-size:13px; }
    .legend { margin-top:8px; display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
    .legend .box { width:18px; height:18px; border-radius:4px; display:inline-block; border:1px solid #ccc; vertical-align:middle; margin-right:6px;}
    .box.window { background: linear-gradient(180deg,#e9f3ff,#f6fbff); border-color:#2b8aef; }
    .box.max { background:#ffe9a6; border-color:#f0c040; }
    .footer { margin-top:14px; font-size:13px; color:#444; }
    @media (max-width:520px) {
      .cell { width:36px; height:36px; font-size:14px; }
    }
  </style>
</head>
<body>
  <h1>Sliding Window Visualizer</h1>
  <p>Interactive demonstration of the "Sliding Window" technique. Pick an example, provide input, and step through the algorithm.</p>

  <div class="panel controls" id="controls">
    <label>
      Example:
      <select id="exampleSelect">
        <option value="fixed">Max Sum Subarray of Size K (Fixed-size)</option>
        <option value="variable">Longest Substring with ≤ K Distinct Characters (Variable-size)</option>
      </select>
    </label>

    <div id="fixedControls">
      <label>Array (comma separated):
        <input id="arrayInput" type="text" value="2,1,5,1,3,2" style="width:200px" />
      </label>
      <label>K:
        <input id="kInput" type="number" value="3" min="1" style="width:70px" />
      </label>
      <button id="randomArray" class="btn small">Random</button>
    </div>

    <div id="variableControls" style="display:none;">
      <label>String:
        <input id="strInput" type="text" value="araaci" style="width:180px" />
      </label>
      <label>K:
        <input id="kVarInput" type="number" value="2" min="1" style="width:70px" />
      </label>
      <button id="randomStr" class="btn small">Random</button>
    </div>

    <button id="buildBtn" class="btn primary">Build Steps</button>
  </div>

  <div class="panel">
    <div style="display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;">
      <div style="font-weight:700" id="titleArea">Max Sum Subarray of Size K</div>
      <div style="display:flex; gap:8px; align-items:center;">
        Speed:
        <input id="speedRange" type="range" min="200" max="2000" value="700" />
        <span id="speedLabel" class="muted">700ms</span>
      </div>
    </div>

    <div id="visualArea">
      <!-- Array / string visualization -->
      <div id="arrayVisual" class="array-row" aria-hidden="true"></div>
      <div class="summary" id="summaryArea"></div>
      <div class="status" id="statusArea"></div>
    </div>

    <div class="play-controls">
      <button id="stepBack" class="btn small">⟵ Step</button>
      <button id="playPause" class="btn small">Play</button>
      <button id="stepForward" class="btn small">Step ⟶</button>
      <div style="margin-left:12px">
        Step <span id="stepIndex">0</span> / <span id="stepTotal">0</span>
      </div>
      <div style="margin-left:auto; display:flex; gap:8px">
        <button id="resetBtn" class="btn small">Reset</button>
      </div>
    </div>

    <div class="legend">
      <div><span class="box window"></span>Current window</div>
      <div><span class="box max" style="display:inline-block"></span>Best (max / longest) found</div>
    </div>

    <div style="margin-top:10px;">
      <div class="code" id="codeArea"></div>
    </div>

  </div>

  <div class="panel">
    <div style="font-weight:700">How to use</div>
    <ul style="margin-top:8px">
      <li>Select the example type.</li>
      <li>Provide array or string and K, or hit Random to get a sample.</li>
      <li>Click "Build Steps" to prepare the algorithm trace, then Step/Play to visualize.</li>
    </ul>
    <div class="footer">
      Note: This visualizer generates step snapshots of the algorithms to make it easy to inspect intermediate states. The fixed-size demo shows how a window of size K slides across an array to compute sums. The variable-size demo shows expanding and shrinking a window while tracking character counts to find the longest substring with at most K distinct characters.
    </div>
  </div>

<script>
(function(){
  const exampleSelect = document.getElementById('exampleSelect');
  const fixedControls = document.getElementById('fixedControls');
  const variableControls = document.getElementById('variableControls');
  const arrayInput = document.getElementById('arrayInput');
  const kInput = document.getElementById('kInput');
  const randomArrayBtn = document.getElementById('randomArray');
  const strInput = document.getElementById('strInput');
  const kVarInput = document.getElementById('kVarInput');
  const randomStrBtn = document.getElementById('randomStr');
  const buildBtn = document.getElementById('buildBtn');
  const arrayVisual = document.getElementById('arrayVisual');
  const summaryArea = document.getElementById('summaryArea');
  const statusArea = document.getElementById('statusArea');
  const codeArea = document.getElementById('codeArea');
  const titleArea = document.getElementById('titleArea');
  const stepBack = document.getElementById('stepBack');
  const stepForward = document.getElementById('stepForward');
  const playPause = document.getElementById('playPause');
  const stepIndexLabel = document.getElementById('stepIndex');
  const stepTotalLabel = document.getElementById('stepTotal');
  const resetBtn = document.getElementById('resetBtn');
  const speedRange = document.getElementById('speedRange');
  const speedLabel = document.getElementById('speedLabel');

  let steps = [];
  let cur = 0;
  let timer = null;

  exampleSelect.addEventListener('change', () => {
    const v = exampleSelect.value;
    if (v === 'fixed') {
      fixedControls.style.display = '';
      variableControls.style.display = 'none';
      titleArea.textContent = 'Max Sum Subarray of Size K';
      showCode(fixedCode());
    } else {
      fixedControls.style.display = 'none';
      variableControls.style.display = '';
      titleArea.textContent = 'Longest Substring with ≤ K Distinct Characters';
      showCode(variableCode());
    }
  });

  randomArrayBtn.addEventListener('click', () => {
    const n = 6 + Math.floor(Math.random()*6);
    const arr = Array.from({length:n}, ()=> Math.floor(Math.random()*9)-2); // include negatives
    arrayInput.value = arr.join(',');
  });

  randomStrBtn.addEventListener('click', () => {
    const samples = ['araaci','cbbebi','aabacbebebe','abcabcbb','bbaaac','xyzzzaa'];
    strInput.value = samples[Math.floor(Math.random()*samples.length)];
  });

  speedRange.addEventListener('input', ()=> {
    speedLabel.textContent = speedRange.value + 'ms';
  });

  buildBtn.addEventListener('click', ()=> {
    stopPlay();
    buildSteps();
    renderStep(0);
  });

  stepBack.addEventListener('click', ()=> {
    stopPlay();
    if (cur>0) { cur--; renderStep(cur); }
  });
  stepForward.addEventListener('click', ()=> {
    stopPlay();
    if (cur < steps.length-1) { cur++; renderStep(cur); }
  });
  playPause.addEventListener('click', ()=> {
    if (!steps.length) return;
    if (timer) { stopPlay(); }
    else { startPlay(); }
  });

  resetBtn.addEventListener('click', ()=> {
    stopPlay();
    steps = []; cur = 0;
    arrayVisual.innerHTML = '';
    summaryArea.innerHTML = '';
    statusArea.innerHTML = '';
    codeArea.innerHTML = '';
    stepIndexLabel.textContent = 0; stepTotalLabel.textContent = 0;
  });

  function startPlay(){
    if (!steps.length) return;
    playPause.textContent = 'Pause';
    timer = setInterval(()=> {
      if (cur < steps.length-1) {
        cur++; renderStep(cur);
      } else {
        stopPlay();
      }
    }, Number(speedRange.value));
  }
  function stopPlay(){
    if (timer) { clearInterval(timer); timer = null; }
    playPause.textContent = 'Play';
  }

  function buildSteps(){
    const ex = exampleSelect.value;
    if (ex === 'fixed') {
      const raw = arrayInput.value.trim();
      if (!raw) { alert('Enter an array or generate Random.'); return; }
      const arr = raw.split(',').map(s=>Number(s.trim())).filter(s=>!Number.isNaN(s));
      const k = Number(kInput.value);
      if (!Number.isInteger(k) || k < 1) { alert('K must be an integer >=1'); return; }
      steps = buildFixedSteps(arr, k);
      showCode(fixedCode());
      titleArea.textContent = 'Max Sum Subarray of Size K';
    } else {
      const s = strInput.value;
      if (typeof s !== 'string' || s.length===0) { alert('Enter a string or generate Random.'); return; }
      const k = Number(kVarInput.value);
      if (!Number.isInteger(k) || k < 1) { alert('K must be an integer >=1'); return; }
      steps = buildVariableSteps(s, k);
      showCode(variableCode());
      titleArea.textContent = 'Longest Substring with ≤ K Distinct Characters';
    }
    if (!steps.length) {
      statusArea.textContent = 'No steps generated.';
    }
    cur = 0;
    stepIndexLabel.textContent = 0;
    stepTotalLabel.textContent = Math.max(0, steps.length-1);
  }

  function renderStep(i){
    if (!steps || !steps.length) return;
    const st = steps[i];
    stepIndexLabel.textContent = i;
    // build visualization for either array or string
    arrayVisual.innerHTML = '';
    // create cells
    for (let idx=0; idx<st.items.length; idx++){
      const val = st.items[idx];
      const c = document.createElement('div');
      c.className = 'cell';
      c.textContent = val.display;
      c.title = val.title || '';
      // mark indices below
      const idxBadge = document.createElement('div');
      idxBadge.className = 'cell index';
      idxBadge.style.position = 'absolute';
      idxBadge.style.bottom = '-22px';
      idxBadge.style.left = '50%';
      idxBadge.style.transform = 'translateX(-50%)';
      idxBadge.style.fontSize = '11px';
      idxBadge.style.border = 'none';
      idxBadge.style.background = 'transparent';
      idxBadge.textContent = idx;
      if (idx === st.left || idx === st.right) {
        const pointer = document.createElement('div');
        pointer.className = 'pointer ' + (idx===st.left ? 'left':'right');
        pointer.textContent = idx===st.left ? 'L' : 'R';
        c.appendChild(pointer);
      }
      if (idx >= st.left && idx <= st.right) {
        c.classList.add('window');
      }
      if (st.bestRange && idx >= st.bestRange[0] && idx <= st.bestRange[1]) {
        c.style.background = '#fff6e1';
        c.style.borderColor = '#f0c040';
      }
      arrayVisual.appendChild(c);
      c.appendChild(idxBadge);
    }

    // summary and status
    summaryArea.innerHTML = st.summaryHTML || '';
    statusArea.innerHTML = st.status || '';

    // highlight code with current step description
    codeArea.textContent = (st.commentBlock || '') + "\n\n" + (st.pseudocode || '');
  }

  // ---------- Algorithms producing steps ----------

  function buildFixedSteps(arr, k){
    const n = arr.length;
    const steps = [];
    // helper to push snapshot
    function snap(left, right, currSum, maxSum, maxLeft, maxRight, stage){
      const items = arr.map(v=>({display:String(v)}));
      const st = {
        items,
        left: Math.max(0, left),
        right: Math.max(-1, right),
        currentSum: currSum,
        maxSum: maxSum,
        bestRange: (maxLeft===null ? null : [maxLeft, maxRight]),
        status: `Stage: ${stage}\nCurrent window [${left}, ${right}] sum = ${currSum}\nBest sum = ${maxSum}`.replace(/\n/g,'<br>'),
        summaryHTML: `<strong>Current Sum:</strong> ${currSum} &nbsp;&nbsp; <strong>Best Sum:</strong> ${maxSum}` ,
        pseudocode: fixedCode(),
        commentBlock: `Array: [${arr.join(', ')}], K = ${k}`
      };
      steps.push(st);
    }

    if (k > n) {
      // immediate snapshot showing invalid
      const items = arr.map(v=>({display:String(v)}));
      steps.push({
        items,
        left: 0,
        right: n-1,
        currentSum: 0,
        maxSum: 0,
        bestRange: null,
        status: `K (${k}) > array length (${n}). No valid window.`,
        summaryHTML: '',
        pseudocode: fixedCode(),
        commentBlock: `Array: [${arr.join(', ')}], K = ${k}`
      });
      return steps;
    }

    // initial window
    let windowSum = 0, maxSum = -Infinity, maxLeft = null, maxRight = null;
    for (let i=0;i<k;i++){
      windowSum += arr[i];
      snap(0, i, windowSum, maxSum, maxLeft, maxRight, `Filling window (add index ${i})`);
    }
    maxSum = windowSum; maxLeft = 0; maxRight = k-1;
    snap(0, k-1, windowSum, maxSum, maxLeft, maxRight, 'Initial full window ready');

    // slide
    for (let right=k; right<n; right++){
      const leavingIndex = right-k;
      const leavingVal = arr[leavingIndex];
      windowSum -= leavingVal;
      snap(leavingIndex+1, right-1, windowSum, maxSum, maxLeft, maxRight, `After removing arr[${leavingIndex}] = ${leavingVal}`);
      windowSum += arr[right];
      snap(leavingIndex+1, right, windowSum, maxSum, maxLeft, maxRight, `After adding arr[${right}] = ${arr[right]}`);
      if (windowSum > maxSum) {
        maxSum = windowSum; maxLeft = leavingIndex+1; maxRight = right;
        snap(leavingIndex+1, right, windowSum, maxSum, maxLeft, maxRight, 'New max found');
      } else {
        snap(leavingIndex+1, right, windowSum, maxSum, maxLeft, maxRight, 'No new max');
      }
    }

    // final snapshot
    snap(maxLeft, maxRight, maxSum, maxSum, maxLeft, maxRight, 'Finished: best window');
    return steps;
  }

  function buildVariableSteps(s, K){
    const n = s.length;
    const steps = [];
    function snap(left, right, counts, bestLen, bestLeft, stage, action){
      const items = s.split('').map(ch=>({display:ch}));
      const st = {
        items,
        left: Math.max(0, left),
        right: Math.max(-1, right),
        counts: {...counts},
        currentWindow: s.substring(left, right+1 || 0),
        bestRange: (bestLeft===null ? null : [bestLeft, bestLeft+bestLen-1]),
        status: `Stage: ${stage}<br>${action || ''}`,
        summaryHTML: `<strong>Window:</strong> [${left}, ${right}] = "${s.substring(left, right+1||0)}" &nbsp;&nbsp; <strong>Distinct:</strong> ${Object.keys(counts).length} &nbsp;&nbsp; <strong>Best length:</strong> ${bestLen}`,
        pseudocode: variableCode(),
        commentBlock: `String: "${s}", K = ${K}`
      };
      steps.push(st);
    }

    let left = 0, right = -1;
    let counts = {};
    let distinct = 0;
    let bestLen = 0, bestLeft = null;
    snap(left, right, counts, bestLen, bestLeft, 'Start', 'Empty window');

    for (right = 0; right < n; right++){
      const ch = s[right];
      counts[ch] = (counts[ch]||0)+1;
      if (counts[ch] === 1) distinct++;
      snap(left, right, counts, bestLen, bestLeft, 'Expand right', `Added '${ch}', counts: ${JSON.stringify(counts)}`);

      // shrink while more than K distinct
      while (distinct > K && left <= right){
        const rem = s[left];
        counts[rem]--;
        if (counts[rem] === 0) { delete counts[rem]; distinct--; }
        snap(left+1, right, counts, bestLen, bestLeft, 'Shrink left', `Removed '${rem}', counts: ${JSON.stringify(counts)}`);
        left++;
      }

      // now window [left, right] has <=K distinct
      const len = right - left + 1;
      if (len > bestLen) {
        bestLen = len; bestLeft = left;
        snap(left, right, counts, bestLen, bestLeft, 'Update best', `Found longer window len=${len} at [${left},${right}]`);
      } else {
        snap(left, right, counts, bestLen, bestLeft, 'No update', `Window len=${len}`);
      }
    }

    // final snapshot
    snap(bestLeft || 0, (bestLeft===null? -1: bestLeft+bestLen-1), counts, bestLen, bestLeft, 'Finished', `Best length = ${bestLen}` );
    return steps;
  }

  // ---------- Pseudocode content ----------

  function fixedCode(){
    return [
      "Fixed-size sliding window (max sum of subarray of size K):",
      "",
      "1. Compute sum of first K elements (windowSum).",
      "2. Set maxSum = windowSum, bestRange = [0, K-1].",
      "3. For right = K to n-1:",
      "     - subtract arr[right-K] from windowSum (element leaving)",
      "     - add arr[right] to windowSum (element entering)",
      "     - if windowSum > maxSum: update maxSum and bestRange",
      "",
      "This runs in O(n) time and O(1) extra space."
    ].join('\\n');
  }

  function variableCode(){
    return [
      "Variable-size sliding window (longest substring with ≤ K distinct chars):",
      "",
      "1. left = 0, iterate right from 0 to n-1:",
      "     - add s[right] to counts map",
      "     - while number of distinct chars > K:",
      "         - remove s[left] from counts, left++",
      "     - update best length if (right - left + 1) is larger",
      "",
      "We expand right to grow window, and shrink left to enforce constraint.",
      "Time: O(n) (each char enters/exits at most once)."
    ].join('\\n');
  }

  function showCode(txt){
    codeArea.textContent = txt;
  }

  // initialize with default example
  showCode(fixedCode());

  // Build sample on load
  buildSteps();
  renderStep(0);

})();
</script>
</body>
</html>