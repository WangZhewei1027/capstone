<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hash Table Demo in JavaScript</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    max-width: 700px;
  }
  h1 {
    text-align: center;
  }
  #hashTableContainer {
    margin-top: 20px;
  }
  table {
    border-collapse: collapse;
    width: 100%;
    margin-top: 10px;
  }
  th, td {
    border: 1px solid #555;
    padding: 8px;
    text-align: left;
  }
  th {
    background-color: #ddd;
  }
  input[type="text"], input[type="number"] {
    padding: 6px;
    margin: 6px 8px 6px 0;
    width: 150px;
  }
  button {
    padding: 7px 12px;
    margin: 6px 5px 6px 0;
  }
  #messages {
    margin-top: 15px;
    min-height: 20px;
  }
  small {
    color: #666;
  }
</style>
</head>
<body>

<h1>Hash Table Implementation Demo</h1>

<p>This demo implements a simple hash table with separate chaining in JavaScript.</p>

<form id="formInsert" onsubmit="return false;">
  <strong>Insert / Update Key-Value Pair</strong><br/>
  <input type="text" id="insertKey" placeholder="Key (string)" required />
  <input type="text" id="insertValue" placeholder="Value (string)" required />
  <button onclick="insertKeyValue()">Insert / Update</button>
</form>

<form id="formSearch" onsubmit="return false;">
  <strong>Search by Key</strong><br/>
  <input type="text" id="searchKey" placeholder="Key (string)" required />
  <button onclick="searchKey()">Search</button>
</form>

<form id="formRemove" onsubmit="return false;">
  <strong>Remove by Key</strong><br/>
  <input type="text" id="removeKey" placeholder="Key (string)" required />
  <button onclick="removeKey()">Remove</button>
</form>

<button onclick="clearHashTable()" style="background:#c33; color:#fff;">Clear Hash Table</button>

<div id="messages"></div>

<div id="hashTableContainer">
  <h2>Hash Table Buckets (Separate Chaining)</h2>
  <label>Number of Buckets:
    <input type="number" id="bucketCount" value="8" min="1" max="50" onchange="changeBucketCount()" />
  </label>
  <small> - Increasing buckets reduces collisions but uses more memory.</small>
  <div id="tableWrapper"></div>
</div>

<script>
/**
 * Simple Hash Table implementation with separate chaining.
 * Keys and values are strings.
 */

class HashTable {
  constructor(size = 8) {
    this.size = size;
    this.buckets = Array(size).fill(null).map(() => []);
  }

  // djb2 hash function - good for strings
  hash(key) {
    let hash = 5381;
    for (let i = 0; i < key.length; i++) {
      hash = ((hash << 5) + hash) + key.charCodeAt(i); /* hash * 33 + c */
    }
    return Math.abs(hash) % this.size;
  }

  set(key, value) {
    const index = this.hash(key);
    const bucket = this.buckets[index];

    for (let i=0; i < bucket.length; i++) {
      if (bucket[i][0] === key) {
        bucket[i][1] = value; // Update existing
        return false; // false means updated
      }
    }
    bucket.push([key, value]); // Add new
    return true; // true means inserted new
  }

  get(key) {
    const index = this.hash(key);
    const bucket = this.buckets[index];
    for (let i=0; i < bucket.length; i++) {
      if (bucket[i][0] === key) {
        return bucket[i][1];
      }
    }
    return undefined;
  }

  remove(key) {
    const index = this.hash(key);
    const bucket = this.buckets[index];
    for (let i=0; i < bucket.length; i++) {
      if (bucket[i][0] === key) {
        bucket.splice(i,1);
        return true;
      }
    }
    return false;
  }

  clear() {
    this.buckets = Array(this.size).fill(null).map(() => []);
  }

  changeSize(newSize) {
    newSize = Math.max(1, newSize);
    // Rehash all elements to new bucket array
    const allItems = [];
    for (const bucket of this.buckets) {
      allItems.push(...bucket);
    }
    this.size = newSize;
    this.buckets = Array(newSize).fill(null).map(() => []);
    for (const [key, value] of allItems) {
      this.set(key, value);
    }
  }
}

const hashTable = new HashTable(8);

const messagesDiv = document.getElementById("messages");
const tableWrapper = document.getElementById("tableWrapper");

function displayMessage(msg, isError = false) {
  messagesDiv.textContent = msg;
  messagesDiv.style.color = isError ? "crimson" : "green";
  if (!msg) {
    messagesDiv.style.color = "";
  }
}

function refreshTable() {
  const buckets = hashTable.buckets;
  let html = '<table><thead><tr><th>Bucket #</th><th>Key => Value Pairs</th></tr></thead><tbody>';
  for(let i = 0; i < buckets.length; i++) {
    if (buckets[i].length === 0) {
      html += `<tr><td>${i}</td><td><i>empty</i></td></tr>`;
    } else {
      const pairs = buckets[i].map(([k,v]) => `<strong>${escapeHTML(k)}</strong> =&gt; ${escapeHTML(v)}`).join("<br/>");
      html += `<tr><td>${i}</td><td>${pairs}</td></tr>`;
    }
  }
  html += "</tbody></table>";
  tableWrapper.innerHTML = html;
}

function escapeHTML(text) {
  return text.replace(/[&<>"'`=\/]/g, function(s) {
    return ({
      '&': "&amp;",
      '<': "&lt;",
      '>': "&gt;",
      '"': "&quot;",
      "'": "&#39;",
      '/': "&#x2F;",
      '`': "&#96;",
      '=': "&#x3D;"
    })[s];
  });
}

function insertKeyValue() {
  const keyInput = document.getElementById("insertKey");
  const valueInput = document.getElementById("insertValue");
  const key = keyInput.value.trim();
  const value = valueInput.value.trim();

  if (key === "" || value === "") {
    displayMessage("Both key and value are required.", true);
    return;
  }

  const insertedNew = hashTable.set(key, value);
  displayMessage(insertedNew ? `Inserted new key "${key}".` : `Updated existing key "${key}".`);
  keyInput.value = "";
  valueInput.value = "";
  keyInput.focus();
  refreshTable();
}

function searchKey() {
  const keyInput = document.getElementById("searchKey");
  const key = keyInput.value.trim();
  if (key === "") {
    displayMessage("Please enter a key to search for.", true);
    return;
  }
  const value = hashTable.get(key);
  if (value === undefined) {
    displayMessage(`Key "${key}" not found.`, true);
  } else {
    displayMessage(`Key "${key}" found with value: "${value}".`);
  }
  keyInput.value = "";
  keyInput.focus();
}

function removeKey() {
  const keyInput = document.getElementById("removeKey");
  const key = keyInput.value.trim();
  if (key === "") {
    displayMessage("Please enter a key to remove.", true);
    return;
  }
  const removed = hashTable.remove(key);
  if (removed) {
    displayMessage(`Key "${key}" removed.`);
  } else {
    displayMessage(`Key "${key}" not found.`, true);
  }
  keyInput.value = "";
  keyInput.focus();
  refreshTable();
}

function clearHashTable() {
  if(confirm("Are you sure you want to clear the entire hash table?")) {
    hashTable.clear();
    displayMessage("Hash table cleared.");
    refreshTable();
  }
}

function changeBucketCount() {
  const bucketCountInput = document.getElementById("bucketCount");
  let newCount = parseInt(bucketCountInput.value, 10);
  if (isNaN(newCount) || newCount < 1) {
    newCount = 8;
    bucketCountInput.value = newCount;
  }
  hashTable.changeSize(newCount);
  displayMessage(`Number of buckets changed to ${newCount}. Table rehashed.`);
  refreshTable();
}

// On load:
refreshTable();

</script>

</body>
</html>