<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Quick Sort Visualizer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root{
      --bg:#0f1724;
      --panel:#0b1220;
      --accent:#1fb6ff;
      --muted:#94a3b8;
      --good:#16a34a;
      --bad:#ef4444;
      --card:#0b1220;
    }
    *{box-sizing:border-box;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071027 0%,var(--bg) 100%);color:#e6eef8}
    .app {
      max-width:1100px;margin:24px auto;padding:20px;display:grid;grid-template-columns: 360px 1fr;gap:20px;
    }

    .panel{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.03);
      padding:14px;border-radius:10px;box-shadow:0 6px 18px rgba(2,6,23,0.6);
    }

    h1{font-size:20px;margin:6px 0 12px;color:#eaf6ff}
    .controls{display:grid;gap:10px}
    .row{display:flex;gap:8px;align-items:center}
    label{font-size:13px;color:var(--muted);min-width:110px}
    select,input[type=range],input[type=number]{width:100%;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:#e6eef8}
    button{padding:8px 12px;background:linear-gradient(180deg,var(--accent),#0ea5e9);border:none;color:#022;cursor:pointer;border-radius:8px;font-weight:600}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#e6eef8}
    .small{padding:6px 8px;font-size:13px;border-radius:6px}
    .controls .grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .visual {
      display:flex;flex-direction:column;gap:12px;
    }
    .canvas {
      height:420px;background:linear-gradient(180deg, rgba(255,255,255,0.012), rgba(0,0,0,0.02));border-radius:10px;padding:12px;display:flex;align-items:end;gap:6px;border:1px solid rgba(255,255,255,0.03);
    }
    .bar{
      flex:1 1 auto;background:linear-gradient(180deg,#2b78a6,#1a536f);height:40px;border-radius:4px;display:flex;align-items:flex-end;justify-content:center;color:#022;font-weight:700;transition:all 250ms ease;
      position:relative;
    }
    .bar span{transform:translateY(6px);font-size:12px;color:#e6eef8}
    .bar.pivot{background:linear-gradient(180deg,#ffd166,#ffb86b);box-shadow:0 4px 10px rgba(255,160,60,0.12)}
    .bar.compare{background:linear-gradient(180deg,#fb7185,#f43f5e);box-shadow:0 4px 10px rgba(244,63,94,0.12)}
    .bar.swapping{background:linear-gradient(180deg,#7dd3fc,#38bdf8);box-shadow:0 4px 10px rgba(59,130,246,0.10)}
    .bar.sorted{background:linear-gradient(180deg,#86efac,#5eead4);box-shadow:0 4px 12px rgba(34,197,94,0.10)}
    .bar.index{position:absolute;top:-18px;font-size:11px;color:var(--muted)}
    .info{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .stat {background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;font-size:13px;color:var(--muted)}
    pre.code {background:#07172a;padding:10px;border-radius:8px;overflow:auto;color:#dbeafe;font-size:12px;line-height:1.4;margin:0;border:1px solid rgba(255,255,255,0.03)}
    .code-line{padding:3px 8px;border-radius:4px}
    .code-line.active{background:linear-gradient(90deg,rgba(31,182,255,0.07),rgba(31,182,255,0.03));border-left:3px solid var(--accent)}
    .stack {background:linear-gradient(90deg,rgba(255,255,255,0.02),transparent);padding:8px;border-radius:8px;min-height:60px;color:var(--muted);font-size:13px}
    .stack-item{padding:6px 8px;border-radius:6px;background:rgba(255,255,255,0.01);margin-bottom:6px;border:1px solid rgba(255,255,255,0.02);display:flex;justify-content:space-between;align-items:center}
    .legend{display:flex;gap:8px;flex-wrap:wrap}
    .legend-item{display:flex;gap:6px;align-items:center;padding:6px 8px;border-radius:6px;background:rgba(255,255,255,0.02);font-size:13px}
    .color-box{width:14px;height:14px;border-radius:3px}
    footer{grid-column:1/-1;margin-top:12px;color:var(--muted);font-size:13px}
    .inputs{display:flex;gap:8px;align-items:center}
    textarea{width:100%;height:64px;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);color:#e6eef8;resize:vertical}
    .top-row{display:flex;align-items:center;gap:10px;justify-content:space-between}
    .muted{color:var(--muted);font-size:13px}
    @media (max-width:980px){
      .app{grid-template-columns:1fr; padding:12px}
      .panel{margin-bottom:12px}
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="panel">
      <div class="top-row">
        <h1>Quick Sort Visualizer</h1>
        <div class="muted">Interactive step-by-step demo</div>
      </div>

      <div style="height:10px"></div>

      <div class="controls">
        <div class="row">
          <label>Array size</label>
          <input id="size" type="number" min="5" max="100" value="30">
        </div>

        <div class="row">
          <label>Value range</label>
          <div style="display:flex;gap:6px;width:100%">
            <input id="minVal" type="number" value="10" style="width:70px">
            <input id="maxVal" type="number" value="100" style="width:70px">
            <div style="flex:1"></div>
          </div>
        </div>

        <div class="row">
          <label>Pivot strategy</label>
          <select id="pivot">
            <option value="last">Last element (Lomuto)</option>
            <option value="first">First element (Lomuto variant)</option>
            <option value="median">Median-of-three</option>
            <option value="random">Random pivot</option>
          </select>
        </div>

        <div class="row">
          <label>Order</label>
          <select id="order">
            <option value="asc">Ascending</option>
            <option value="desc">Descending</option>
          </select>
        </div>

        <div class="row">
          <label>Speed</label>
          <input id="speed" type="range" min="0" max="1000" value="250">
        </div>

        <div class="grid">
          <button id="generate">Generate Array</button>
          <button id="shuffle" class="secondary">Shuffle</button>
          <button id="randomPreset" class="secondary">Few/Many Presets</button>
        </div>

        <div class="grid">
          <button id="start" class="small">Start</button>
          <button id="step" class="small secondary">Step</button>
          <button id="pause" class="small secondary">Pause</button>
        </div>

        <div class="grid">
          <button id="reset" class="secondary">Reset</button>
          <button id="showCode" class="secondary">Toggle Pseudocode</button>
        </div>

        <div style="height:6px"></div>

        <div class="info">
          <div class="stat">Comparisons: <strong id="comp">0</strong></div>
          <div class="stat">Swaps: <strong id="swap">0</strong></div>
          <div class="stat">Steps: <strong id="steps">0</strong></div>
        </div>

        <div style="height:10px"></div>

        <div class="legend">
          <div class="legend-item"><div class="color-box" style="background:linear-gradient(180deg,#ffd166,#ffb86b)"></div>Pivot</div>
          <div class="legend-item"><div class="color-box" style="background:linear-gradient(180deg,#fb7185,#f43f5e)"></div>Comparing</div>
          <div class="legend-item"><div class="color-box" style="background:linear-gradient(180deg,#7dd3fc,#38bdf8)"></div>Swapping</div>
          <div class="legend-item"><div class="color-box" style="background:linear-gradient(180deg,#86efac,#5eead4)"></div>Sorted</div>
        </div>

        <div style="height:8px"></div>

        <label>Manual array (comma separated)</label>
        <textarea id="manual" placeholder="e.g., 5,3,8,1,2"></textarea>
        <div class="row">
          <button id="loadManual">Load Manual Array</button>
          <button id="explain" class="secondary">Explain Steps</button>
        </div>
      </div>
    </div>

    <div class="panel visual">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="display:flex;gap:10px;align-items:center">
          <div class="muted">Array</div>
          <div id="rangeLabel" class="muted"></div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <div class="muted">Recursion stack:</div>
          <div id="stack" class="stack" style="min-width:220px"></div>
        </div>
      </div>

      <div id="canvas" class="canvas"></div>

      <div style="display:flex;gap:12px;align-items:center;justify-content:space-between">
        <div style="width:64%">
          <pre id="pseudocode" class="code" style="display:block"></pre>
        </div>
        <div style="width:34%;display:flex;flex-direction:column;gap:10px">
          <div style="display:flex;gap:8px;align-items:center">
            <div class="muted">Current action:</div>
            <div id="action" class="stat">Idle</div>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <div class="muted">Low / High</div>
            <div class="stat" id="rangeDisplay">-</div>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <div class="muted">Pivot index</div>
            <div class="stat" id="pivotDisplay">-</div>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <div class="muted">Notes</div>
            <div class="stat" id="notes">-</div>
          </div>
        </div>
      </div>

      <footer>
        Quick Sort (Lomuto partition by default). Use Step to walk through each action. Median-of-three and random pivot strategies are available.
      </footer>
    </div>
  </div>

<script>
(function(){
  // Utility
  const el = id => document.getElementById(id);
  let arr = [];
  let bars = [];
  let generator = null;
  let running = false;
  let paused = false;
  let lastAction = null;
  let comps = 0, swaps = 0, steps = 0;
  let speed = 250;
  let order = 'asc';
  let pivotStrategy = 'last';
  let stackState = [];

  // Pseudocode lines (Lomuto)
  const codeLines = [
    "function quickSort(A, low, high):",
    "  if low < high:",
    "    p = partition(A, low, high)",
    "    quickSort(A, low, p - 1)",
    "    quickSort(A, p + 1, high)",
    "",
    "function partition(A, low, high):",
    "  pivot = choosePivot(A, low, high)",
    "  swap(A[pivotIndex], A[high])  // move pivot to end",
    "  i = low",
    "  for j = low to high - 1:",
    "    if compare(A[j], pivot):",
    "      swap(A[i], A[j])",
    "      i = i + 1",
    "  swap(A[i], A[high])",
    "  return i"
  ];

  // Initialize UI
  function init(){
    el('pseudocode').innerHTML = codeLines.map((s,i) => `<div class="code-line" data-line="${i}"><code>${s}</code></div>`).join('');
    el('generate').addEventListener('click', generateArray);
    el('shuffle').addEventListener('click', () => { shuffleArray(); drawArray(); });
    el('start').addEventListener('click', start);
    el('step').addEventListener('click', stepOnce);
    el('pause').addEventListener('click', pause);
    el('reset').addEventListener('click', resetAll);
    el('speed').addEventListener('input', (e)=>speed = 1000 - Number(e.target.value));
    el('pivot').addEventListener('change', (e)=>pivotStrategy=e.target.value);
    el('order').addEventListener('change', (e)=>order=e.target.value);
    el('size').addEventListener('change', ()=>generateArray());
    el('minVal').addEventListener('change', ()=>generateArray());
    el('maxVal').addEventListener('change', ()=>generateArray());
    el('loadManual').addEventListener('click', loadManual);
    el('showCode').addEventListener('click', ()=>{ const p=el('pseudocode'); p.style.display = p.style.display === 'none' ? 'block' : 'none';});
    el('randomPreset').addEventListener('click', randomPreset);
    el('explain').addEventListener('click', explainNotes);
    generateArray();
  }

  function explainNotes(){
    alert("This visualization uses a Lomuto-style partition: pivot is chosen and moved to the end; elements less (for ascending) than pivot are moved to left. Median-of-three selects the median of A[low], A[mid], A[high] as pivot. Random picks a random index.");
  }

  function randomPreset(){
    const presets = [
      "few large: 5,5,4,4,6,6,20,20,20,18,17,3",
      "reversed: 20,19,18,17,16,15,14,13,12,11",
      "duplicates: 5,3,5,3,5,2,2,8,8,1",
      "random small: 3,7,2,9,1,5,8,6,4",
      "random large: 62,10,44,73,15,99,31,81,57"
    ];
    const r = presets[Math.floor(Math.random()*presets.length)];
    el('manual').value = r;
    loadManual();
  }

  function loadManual(){
    const text = el('manual').value.trim();
    if(!text){ alert("Enter comma separated numbers."); return; }
    const parts = text.split(',').map(s=>Number(s.trim())).filter(n=>!isNaN(n));
    if(parts.length===0){ alert("No valid numbers found."); return; }
    arr = parts.slice();
    resetStats();
    drawArray();
  }

  function generateArray(){
    const size = Math.max(5, Math.min(200, Number(el('size').value) || 30));
    const min = Number(el('minVal').value) || 1;
    const max = Number(el('maxVal').value) || 100;
    arr = [];
    for(let i=0;i<size;i++){
      arr.push(Math.floor(Math.random()*(max-min+1))+min);
    }
    resetStats();
    drawArray();
  }

  function shuffleArray(){
    for(let i=arr.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    resetStats();
  }

  function resetStats(){
    comps=swaps=steps=0;
    updateStats();
    stackState = [];
    el('stack').innerHTML = "";
    el('action').innerText = 'Idle';
    el('pivotDisplay').innerText = '-';
    el('rangeDisplay').innerText = '-';
    el('notes').innerText = '-';
    generator = null;
    running = false;
    paused = false;
    clearHighlights();
  }

  function updateStats(){
    el('comp').innerText = comps;
    el('swap').innerText = swaps;
    el('steps').innerText = steps;
  }

  function drawArray(highlights = {}){
    // highlights: {pivot: index, compare: idx, swap: [i,j], sorted: set}
    const container = el('canvas');
    container.innerHTML = '';
    if(arr.length === 0) return;
    const maxVal = Math.max(...arr);
    const minVal = Math.min(...arr);
    const range = `${minVal}–${maxVal}`;
    el('rangeLabel').innerText = range;
    bars = [];
    const sortedSet = highlights.sorted || new Set();
    for(let i=0;i<arr.length;i++){
      const b = document.createElement('div');
      b.className = 'bar';
      const hPct = (arr[i] - minVal) / (maxVal - minVal + 0.0001);
      const height = Math.max(6, Math.round(hPct * 100) + 10);
      b.style.height = (height*3) + 'px';
      b.style.flexBasis = (100 / arr.length) + '%';
      b.dataset.index = i;
      let label = document.createElement('span');
      label.textContent = arr[i];
      b.appendChild(label);
      let indexLabel = document.createElement('div');
      indexLabel.className = 'bar index';
      indexLabel.innerText = i;
      b.appendChild(indexLabel);

      if(highlights.pivot === i) b.classList.add('pivot');
      if(highlights.compare === i) b.classList.add('compare');
      if(highlights.swap && (highlights.swap[0]===i || highlights.swap[1]===i)) b.classList.add('swapping');
      if(sortedSet.has(i)) b.classList.add('sorted');

      container.appendChild(b);
      bars.push(b);
    }
  }

  function clearHighlights(){
    for(const b of bars){
      b.classList.remove('pivot','compare','swapping','sorted');
    }
    highlightCode(-1);
  }

  function highlightCode(line){
    const nodes = el('pseudocode').querySelectorAll('.code-line');
    nodes.forEach(n => {
      if(Number(n.dataset.line) === line) n.classList.add('active');
      else n.classList.remove('active');
    });
  }

  // Generator-based QuickSort with yields for visualization
  function* quickSortGen(A, low, high){
    // push stack frame
    stackPush([low, high]);
    yield action('pushStack', {low,high});
    if(low < high){
      yield action('check', {low,high});
      // Partition
      const pRes = yield* partitionGen(A, low, high);
      const p = pRes.index;
      // after partition
      yield action('partitionDone', {index:p});
      // left
      yield* quickSortGen(A, low, p - 1);
      // right
      yield* quickSortGen(A, p + 1, high);
    } else {
      // base case: mark as sorted single element or empty
      if(low === high){
        yield action('markSorted', {index:low});
      }
    }
    // pop stack frame
    stackPop();
    yield action('popStack', {low,high});
  }

  function* partitionGen(A, low, high){
    // choose pivot index according to strategy
    let pivotIndex = choosePivotIndex(A, low, high);
    yield action('choosePivot', {pivotIndex,low,high});
    // move pivot to end (swap pivotIndex, high)
    if(pivotIndex !== high){
      yield action('swapStart', {i:pivotIndex,j:high});
      swap(A, pivotIndex, high);
      yield action('swapDone', {i:pivotIndex,j:high});
    }
    const pivot = A[high];
    yield action('setPivotValue', {pivot, index:high});
    let i = low;
    yield action('setI', {i});
    for(let j = low; j <= high -1; j++){
      yield action('compare', {j, pivotIndex:high});
      if(compare(A[j], pivot)){
        yield action('swapStart', {i,j});
        swap(A, i, j);
        yield action('swapDone', {i,j});
        i++;
        yield action('increaseI', {i});
      }
    }
    // final pivot placement
    yield action('swapStart', {i, j:high});
    swap(A, i, high);
    yield action('swapDone', {i, j:high});
    yield action('pivotPlaced', {i});
    return {index: i};
  }

  function choosePivotIndex(A, low, high){
    if(pivotStrategy === 'last') return high;
    if(pivotStrategy === 'first') return low;
    if(pivotStrategy === 'random') return Math.floor(Math.random()*(high-low+1))+low;
    if(pivotStrategy === 'median'){
      const mid = Math.floor((low+high)/2);
      const trio = [[A[low],low],[A[mid],mid],[A[high],high]];
      trio.sort((a,b)=>a[0]-b[0]);
      // median element's index
      return trio[1][1];
    }
    return high;
  }

  function compare(a,b){
    comps++;
    updateStats();
    if(order === 'asc') return a < b;
    else return a > b;
  }

  function swap(A,i,j){
    swaps++;
    steps++;
    updateStats();
    const temp = A[i];
    A[i] = A[j];
    A[j] = temp;
  }

  // Action helper to yield objects to visualizer
  function action(type, payload){
    return {type, payload};
  }

  // Visualizer runner: consumes generator yields and animates
  async function runGenerator(gen){
    if(!gen) return;
    running = true;
    paused = false;
    while(true){
      if(paused) { await sleep(50); continue; }
      const next = gen.next();
      if(next.done) break;
      const act = next.value;
      steps++;
      updateStats();
      await handleAction(act);
      // Wait according to speed
      await sleep(speed);
    }
    running = false;
    el('action').innerText = 'Finished';
    // mark all as sorted
    const sorted = new Set(arr.map((_,i)=>i));
    drawArray({sorted});
    highlightCode(-1);
  }

  // Step through a single action
  function stepOnce(){
    if(!generator){
      generator = quickSortGen(arr, 0, arr.length-1);
      // ensure stack display initial push
    }
    if(paused) paused = false;
    const next = generator.next();
    if(next.done){
      el('action').innerText = 'Finished';
      running = false;
      return;
    }
    const act = next.value;
    steps++;
    updateStats();
    handleAction(act);
    paused = true;
  }

  function start(){
    if(running) return;
    if(!generator){
      generator = quickSortGen(arr, 0, arr.length-1);
    }
    runGenerator(generator);
  }

  function pause(){
    paused = true;
    running = false;
    el('action').innerText = 'Paused';
  }

  function resetAll(){
    generator = null;
    running = false;
    paused = false;
    resetStats();
    drawArray();
  }

  // Manage stack visual
  function stackPush(frame){
    stackState.push(frame);
    renderStack();
  }
  function stackPop(){
    stackState.pop();
    renderStack();
  }

  function renderStack(){
    const s = el('stack');
    s.innerHTML = '';
    for(let i = stackState.length-1; i>=0; i--){
      const f = stackState[i];
      const item = document.createElement('div');
      item.className = 'stack-item';
      item.innerHTML = `<div>low: ${f[0]}</div><div>high: ${f[1]}</div>`;
      s.appendChild(item);
    }
  }

  // Handle different action types and update visualization
  async function handleAction(act){
    if(!act) return;
    const t = act.type;
    const p = act.payload || {};
    el('action').innerText = t;
    // default code highlight mapping
    switch(t){
      case 'pushStack':
        renderStack();
        el('notes').innerText = `Pushed [${p.low}, ${p.high}]`;
        highlightCode(1);
        break;
      case 'popStack':
        renderStack();
        el('notes').innerText = `Popped [${p.low}, ${p.high}]`;
        highlightCode(-1);
        break;
      case 'check':
        el('rangeDisplay').innerText = `[${p.low}, ${p.high}]`;
        el('notes').innerText = `Checking low < high`;
        highlightCode(1);
        break;
      case 'choosePivot':
        el('pivotDisplay').innerText = p.pivotIndex;
        el('notes').innerText = `Chosen pivot index ${p.pivotIndex}`;
        drawArray({pivot:p.pivotIndex});
        highlightCode(7);
        break;
      case 'swapStart':
        el('notes').innerText = `Swapping ${p.i} ↔ ${p.j}`;
        drawArray({swap:[p.i,p.j]});
        highlightCode(8);
        break;
      case 'swapDone':
        el('notes').innerText = `Swapped ${p.i} ↔ ${p.j}`;
        drawArray({swap:[p.i,p.j]});
        highlightCode(13);
        break;
      case 'setPivotValue':
        el('notes').innerText = `Pivot value = ${p.pivot}`;
        drawArray({pivot:p.index});
        highlightCode(7);
        break;
      case 'setI':
        el('notes').innerText = `i = ${p.i}`;
        drawArray();
        highlightCode(-1);
        break;
      case 'compare':
        el('notes').innerText = `Comparing A[${p.j}] with pivot`;
        comps++; updateStats();
        drawArray({compare:p.j, pivot:p.pivotIndex});
        highlightCode(11);
        break;
      case 'increaseI':
        el('notes').innerText = `i increased to ${p.i}`;
        drawArray();
        highlightCode(12);
        break;
      case 'pivotPlaced':
        el('notes').innerText = `Pivot placed at index ${p.i}`;
        // mark pivot position as sorted for now
        const sorted = new Set();
        sorted.add(p.i);
        drawArray({sorted, pivot:p.i});
        highlightCode(15);
        break;
      case 'partitionDone':
        el('notes').innerText = `Partition finished, pivot at ${p.index}`;
        el('pivotDisplay').innerText = p.index;
        // mark pivot index as sorted
        const sorted2 = new Set();
        sorted2.add(p.index);
        drawArray({sorted:sorted2});
        highlightCode(2);
        break;
      case 'markSorted':
        el('notes').innerText = `Index ${p.index} is sorted`;
        const sset = new Set([p.index]);
        drawArray({sorted:sset});
        highlightCode(15);
        break;
      default:
        drawArray();
        highlightCode(-1);
    }
    updateStats();
  }

  // Sleep helper
  function sleep(ms){ return new Promise(r=>setTimeout(r, ms)); }

  // Initialization
  init();

  // Expose small debug to window
  window.__qs = {
    arr: ()=>arr,
    reset: resetAll
  };

})();
</script>
</body>
</html>