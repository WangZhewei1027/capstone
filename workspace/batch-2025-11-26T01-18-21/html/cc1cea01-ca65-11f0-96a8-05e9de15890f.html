<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Interactive Demo: JavaScript Set</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin: 20px; color:#0b0b0b; }
    h1 { margin: 0 0 6px 0; font-size: 20px; }
    p.lead { margin: 6px 0 18px 0; color:#444; }
    .container { display:flex; gap:20px; flex-wrap:wrap; }
    .box { border:1px solid #ddd; padding:12px; border-radius:8px; background:#fff; width: 460px; box-shadow: 0 1px 3px rgba(0,0,0,0.03); }
    label { display:block; margin:8px 0 4px 0; font-weight:600; font-size:13px; }
    select,input[type="text"],button { padding:8px 10px; font-size:13px; border-radius:6px; border:1px solid #ccc; }
    button { cursor:pointer; }
    .row { display:flex; gap:8px; align-items:center; margin-top:8px; }
    .small { font-size:13px; color:#333; }
    .list { margin-top:10px; background:#f9f9f9; padding:10px; border-radius:6px; min-height:36px; max-height:220px; overflow:auto; border:1px dashed #eee; }
    .item { padding:6px 8px; background:white; border-radius:6px; margin:6px 0; border:1px solid #eee; display:flex; justify-content:space-between; align-items:center; gap:8px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; color:#1a1a1a; }
    .badge { font-size:12px; padding:4px 6px; border-radius:6px; background:#eef3ff; color:#1b4bdb; border:1px solid #dbeaff; }
    .muted { color:#666; font-size:13px; }
    .controls { display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
    .ops { display:flex; gap:6px; flex-wrap:wrap; margin-top:8px; }
    .result { margin-top:10px; padding:10px; border-radius:6px; background:#fcfcff; border:1px solid #eef; }
    .note { margin-top:10px; font-size:13px; color:#444; }
    .pool { display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
    .pill { padding:6px 8px; border-radius:14px; background:#f1f5f9; border:1px solid #e2e8f0; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; }
    footer { margin-top:18px; font-size:13px; color:#555; }
    a { color:#1b4bdb; text-decoration:none; }
  </style>
</head>
<body>
  <h1>JavaScript Set — Interactive Playground</h1>
  <p class="lead">Explore how ES6 Set works: uniqueness, insertion order, reference equality for objects, special values like NaN and ±0, and common set operations.</p>

  <div class="container">
    <div class="box" id="box-a">
      <h2 style="margin:0;font-size:16px;">Set A <span class="badge" id="size-a">size: 0</span></h2>
      <label>Choose value type</label>
      <div class="row">
        <select id="type-a">
          <option value="string">String</option>
          <option value="number">Number</option>
          <option value="boolean">Boolean</option>
          <option value="nan">NaN</option>
          <option value="posZero">+0</option>
          <option value="negZero">-0</option>
          <option value="object">New Object (unique)</option>
          <option value="reuseObject">Pick existing object (reference)</option>
          <option value="array">New Array (unique)</option>
        </select>
        <input id="value-a" type="text" placeholder="text or number" />
        <button id="add-a">Add → A</button>
        <button id="del-a">Delete from A</button>
      </div>

      <label class="muted">Object pool (created objects you may reuse)</label>
      <div class="row">
        <button id="create-obj">Create new object in pool</button>
        <select id="pool" style="min-width:160px;"></select>
      </div>

      <div class="controls">
        <button id="has-a">Has?</button>
        <button id="clear-a">Clear A</button>
        <button id="to-array-a">Convert A → Array</button>
        <button id="iterate-a">Show iteration</button>
      </div>

      <div class="list" id="list-a" aria-live="polite"></div>

      <div class="note" id="note-a">
        Tip: Sets store unique values. For objects and arrays equality is by reference, not structure.
      </div>
    </div>

    <div class="box" id="box-b">
      <h2 style="margin:0;font-size:16px;">Set B <span class="badge" id="size-b">size: 0</span></h2>
      <label>Quick operations to compare A and B</label>
      <div class="row">
        <button id="create-sample-b">Add sample items to B</button>
        <button id="clear-b">Clear B</button>
      </div>

      <div class="ops">
        <button id="union">A ∪ B (Union)</button>
        <button id="intersection">A ∩ B (Intersection)</button>
        <button id="difference">A \\ B (Difference)</button>
        <button id="symmetric">Symmetric Difference</button>
      </div>

      <div class="list" id="list-b"></div>

      <div class="result" id="result"></div>
    </div>
  </div>

  <footer>
    Quick facts: 
    - Iteration order = insertion order. 
    - NaN is considered equal to NaN in a Set. 
    - +0 and -0 are treated as the same value.
    - WeakSet can't be iterated; it's for object references only.
  </footer>

  <script>
    // Core sets
    const A = new Set();
    const B = new Set();

    // Pool of created objects (to demonstrate reference equality)
    const objectPool = [];

    // DOM refs
    const sizeA = document.getElementById('size-a');
    const sizeB = document.getElementById('size-b');
    const listA = document.getElementById('list-a');
    const listB = document.getElementById('list-b');
    const result = document.getElementById('result');
    const poolSelect = document.getElementById('pool');

    // Helpers
    function fmtValue(v) {
      // produce a display-friendly string and a small description
      if (typeof v === 'string') return '"' + v + '"';
      if (typeof v === 'number') {
        if (Number.isNaN(v)) return 'NaN';
        // Show -0 explicitly if negative zero
        if (Object.is(v, -0)) return '-0';
        return String(v);
      }
      if (typeof v === 'boolean') return String(v);
      if (typeof v === 'symbol') return v.toString();
      if (Array.isArray(v)) return 'Array[' + v.length + '] ' + JSON.stringify(v);
      if (v && typeof v === 'object') {
        // assume it's from pool and has an id
        if (v._id !== undefined) return 'Object{id:' + v._id + '} ' + JSON.stringify(v);
        return 'Object ' + JSON.stringify(v);
      }
      return String(v);
    }

    function updateDisplays() {
      sizeA.textContent = 'size: ' + A.size;
      sizeB.textContent = 'size: ' + B.size;
      listA.innerHTML = '';
      listB.innerHTML = '';

      for (const v of A) {
        const el = document.createElement('div');
        el.className = 'item';
        el.innerHTML = '<div class="mono">' + escapeHtml(fmtValue(v)) + '</div><div class="muted">' + typeofDisplay(v) + '</div>';
        listA.appendChild(el);
      }
      for (const v of B) {
        const el = document.createElement('div');
        el.className = 'item';
        el.innerHTML = '<div class="mono">' + escapeHtml(fmtValue(v)) + '</div><div class="muted">' + typeofDisplay(v) + '</div>';
        listB.appendChild(el);
      }
    }

    function typeofDisplay(v) {
      if (typeof v === 'object') {
        if (v === null) return 'null';
        if (Array.isArray(v)) return 'array';
        return 'object';
      }
      return typeof v;
    }

    function escapeHtml(s) {
      return String(s).replace(/[&<>"']/g, function (m) { return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]); });
    }

    // Add event handlers
    document.getElementById('add-a').addEventListener('click', () => {
      const type = document.getElementById('type-a').value;
      const txt = document.getElementById('value-a').value;
      let val = interpretValue(type, txt);
      A.add(val);
      updateDisplays();
      showResult('Added to A: ' + fmtValue(val));
    });

    document.getElementById('del-a').addEventListener('click', () => {
      const type = document.getElementById('type-a').value;
      const txt = document.getElementById('value-a').value;
      let val = interpretValue(type, txt);
      const ok = A.delete(val);
      updateDisplays();
      showResult(ok ? 'Deleted from A: ' + fmtValue(val) : 'Not found in A: ' + fmtValue(val));
    });

    document.getElementById('has-a').addEventListener('click', () => {
      const type = document.getElementById('type-a').value;
      const txt = document.getElementById('value-a').value;
      let val = interpretValue(type, txt);
      showResult('A.has(' + fmtValue(val) + ') → ' + A.has(val));
    });

    document.getElementById('clear-a').addEventListener('click', () => {
      A.clear();
      updateDisplays();
      showResult('Cleared A');
    });

    document.getElementById('clear-b').addEventListener('click', () => {
      B.clear();
      updateDisplays();
      showResult('Cleared B');
    });

    document.getElementById('to-array-a').addEventListener('click', () => {
      const arr = Array.from(A);
      showResult('Array.from(A): [' + arr.map(fmtValue).join(', ') + ']');
    });

    document.getElementById('iterate-a').addEventListener('click', () => {
      let s = '';
      for (const v of A) s += fmtValue(v) + ' ← ';
      s = s ? s.slice(0, -3) : '(empty)';
      showResult('Iterating A: ' + s);
    });

    document.getElementById('create-obj').addEventListener('click', () => {
      const id = objectPool.length + 1;
      const obj = { _id: id, timestamp: Date.now() };
      objectPool.push(obj);
      const opt = document.createElement('option');
      opt.value = objectPool.length - 1;
      opt.textContent = 'Object{id:' + id + '}';
      poolSelect.appendChild(opt);
      poolSelect.value = objectPool.length - 1;
      showResult('Created ' + fmtValue(obj) + ' in pool');
    });

    // Create sample items in B for set operations
    document.getElementById('create-sample-b').addEventListener('click', () => {
      B.clear();
      B.add(1);
      B.add(2);
      B.add('a');
      B.add('b');
      // reuse a previously created object if any, else create one and reuse it
      if (objectPool.length === 0) {
        const obj = { _id: 999 };
        objectPool.push(obj);
        const opt = document.createElement('option');
        opt.value = objectPool.length - 1;
        opt.textContent = 'Object{id:' + obj._id + '}';
        poolSelect.appendChild(opt);
      }
      B.add(objectPool[0]);
      updateDisplays();
      showResult('B populated with sample items (1,2,"a","b",object)');
    });

    // Set operations
    document.getElementById('union').addEventListener('click', () => {
      const u = union(A, B);
      showResultSet('A ∪ B', u);
    });

    document.getElementById('intersection').addEventListener('click', () => {
      const i = intersection(A, B);
      showResultSet('A ∩ B', i);
    });

    document.getElementById('difference').addEventListener('click', () => {
      const d = difference(A, B);
      showResultSet('A \\ B', d);
    });

    document.getElementById('symmetric').addEventListener('click', () => {
      const s = symmetricDifference(A, B);
      showResultSet('A △ B (symmetric difference)', s);
    });

    // Utility: interpret typed input based on selected type
    function interpretValue(type, txt) {
      switch (type) {
        case 'string': return String(txt);
        case 'number': return Number(txt); // parse to number (NaN if invalid)
        case 'boolean': return txt.toLowerCase() === 'true' || txt === '1';
        case 'nan': return NaN;
        case 'posZero': return +0;
        case 'negZero': return -0;
        case 'object':
          // create a new unique object each time
          const id = objectPool.length + 1;
          const obj = { _id: id, created: 'new' };
          objectPool.push(obj);
          // also add to pool select
          const opt = document.createElement('option');
          opt.value = objectPool.length - 1;
          opt.textContent = 'Object{id:' + obj._id + '}';
          poolSelect.appendChild(opt);
          return obj;
        case 'reuseObject':
          const idx = parseInt(poolSelect.value, 10);
          return objectPool[idx];
        case 'array':
          // new array from comma-separated values
          const arr = txt ? txt.split(',').map(s => s.trim()) : [];
          return arr;
        default:
          return txt;
      }
    }

    // Set operation helpers
    function union(s1, s2) {
      const out = new Set(s1);
      for (const v of s2) out.add(v);
      return out;
    }
    function intersection(s1, s2) {
      const out = new Set();
      for (const v of s1) if (s2.has(v)) out.add(v);
      return out;
    }
    function difference(s1, s2) {
      const out = new Set();
      for (const v of s1) if (!s2.has(v)) out.add(v);
      return out;
    }
    function symmetricDifference(s1, s2) {
      // (A \ B) ∪ (B \ A)
      const d1 = difference(s1, s2);
      const d2 = difference(s2, s1);
      return union(d1, d2);
    }

    // Display helpers
    function showResult(msg) {
      result.textContent = msg;
    }
    function showResultSet(title, setObj) {
      const arr = Array.from(setObj);
      showResult(title + ' → [' + arr.map(fmtValue).join(', ') + '] (size=' + setObj.size + ')');
    }

    // initialize displays
    updateDisplays();
    showResult('Ready — try adding values to Set A.');

    // Small demonstration: add duplicate values and special cases
    // (not executed automatically, but hint available)
    // We'll provide a few quick example buttons via console-friendly instructions:
    console.log('Demo hints:');
    console.log(' - Add "hello" twice to see that Set keeps one instance.');
    console.log(' - Choose NaN type and add twice: sets treat NaN as equal to NaN.');
    console.log(' - Choose +0 then -0: they are treated as the same value.');
    console.log(' - Create objects in pool and try adding same object to A and B to observe reference equality.');

    // keyboard: Enter to add to A
    document.getElementById('value-a').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') document.getElementById('add-a').click();
    });

    // Utility to keep pool select in sync (ensure at least one option)
    if (poolSelect.options.length === 0) {
      const opt = document.createElement('option');
      opt.value = -1;
      opt.textContent = '(empty)';
      poolSelect.appendChild(opt);
      poolSelect.value = -1;
    }

    // Observe mutations to sets rarely change pool; update displays on interval in case other code modifies
    setInterval(updateDisplays, 500);

    // Accessibility: visual explanation about NaN and zero behavior
    const noteA = document.getElementById('note-a');
    noteA.innerHTML = 'Tip: Sets use the "Same-value-zero" algorithm: NaN is equal to NaN (unlike ===), and +0 and -0 are treated the same. Objects and arrays are compared by reference.';
  </script>
</body>
</html>