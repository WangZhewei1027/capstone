<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Bubble Sort Visualizer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    :root{
      --bg:#0f1724;
      --panel:#0b1220;
      --accent:#60a5fa;
      --muted:#94a3b8;
      --good:#34d399;
      --danger:#fb7185;
      --bar:#60a5fa;
      --bar-compare:#f59e0b;
      --bar-swap:#ef4444;
      --bar-sorted:#10b981;
      color-scheme: dark;
    }
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#061026 0%, #071426 100%);color:#e6eef8}
    .wrap{max-width:1100px;margin:28px auto;padding:20px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.6)}
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .controls{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .panel{padding:12px;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03)}
    label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
    input[type="range"]{width:160px}
    .buttons{display:flex;gap:8px;flex-wrap:wrap}
    button{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.06);color:var(--muted);padding:8px 12px;border-radius:8px;cursor:pointer}
    button.primary{background:linear-gradient(180deg,var(--accent),#3b82f6);color:#021225;border:font-weight:600}
    button.warn{background:linear-gradient(180deg,var(--danger),#ef4444);color:white}
    button:disabled{opacity:0.45;cursor:not-allowed}
    .visual{margin-top:18px;padding:14px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));min-height:260px;display:flex;align-items:flex-end;gap:6px;overflow:hidden}
    .bar{flex:1 1 auto;margin:0 2px;background:var(--bar);border-radius:6px 6px 4px 4px;display:flex;align-items:flex-end;justify-content:center;position:relative;transition:height 160ms linear, background 120ms}
    .bar .val{font-size:11px;color:rgba(0,0,0,0.7);padding:4px 6px;border-radius:6px 6px 0 0;background:rgba(255,255,255,0.9);transform:translateY(4px)}
    .bar.compare{background:var(--bar-compare)}
    .bar.swap{background:var(--bar-swap)}
    .bar.sorted{background:var(--bar-sorted)}
    .info{display:flex;gap:12px;align-items:center;margin-top:12px;flex-wrap:wrap}
    .stat{padding:10px 12px;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);font-size:13px;color:var(--muted)}
    .bottom{display:flex;gap:12px;margin-top:16px;flex-wrap:wrap}
    .array-input{width:360px}
    input[type="text"]{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .small{font-size:13px}
    pre{background:rgba(0,0,0,0.25);padding:12px;border-radius:8px;overflow:auto;max-height:260px}
    .code-line{opacity:0.7}
    .code-line.active{background:linear-gradient(90deg,rgba(255,255,255,0.03),rgba(255,255,255,0.018));opacity:1;padding:2px 6px;border-radius:6px}
    footer{margin-top:18px;color:var(--muted);font-size:12px}
    @media (max-width:720px){
      .array-input{width:100%}
      .controls{flex-direction:column;align-items:stretch}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Bubble Sort — Interactive Visualizer</h1>
      <div style="margin-left:auto;color:var(--muted);font-size:13px">Compare & swap adjacent elements until array is sorted</div>
    </header>

    <div class="controls">
      <div class="panel">
        <label>Array size: <span id="sizeLabel">12</span></label>
        <input id="size" type="range" min="4" max="64" value="12"/>
      </div>

      <div class="panel">
        <label>Speed (ms delay per step)</label>
        <input id="speed" type="range" min="10" max="1000" value="180"/>
        <div style="font-size:12px;color:var(--muted);margin-top:6px">Delay: <span id="speedLabel">180</span> ms</div>
      </div>

      <div class="panel">
        <label>Options</label>
        <div style="display:flex;gap:8px;align-items:center">
          <label class="small"><input id="ascending" type="checkbox" checked/> Ascending</label>
          <label class="small"><input id="optimized" type="checkbox" checked/> Stop early (optimized)</label>
        </div>
      </div>

      <div class="panel buttons" style="margin-left:auto">
        <button id="randomBtn" class="primary">Generate Random</button>
        <button id="startBtn" class="primary">Start</button>
        <button id="stepBtn">Step</button>
        <button id="pauseBtn" disabled>Pause</button>
        <button id="resetBtn">Reset</button>
      </div>
    </div>

    <div class="bottom">
      <div style="flex:1;min-width:320px">
        <label>Array (comma separated) — edit and press "Reset" to use</label>
        <input id="arrayInput" class="array-input" type="text" placeholder="e.g. 5,3,8,1,2"/>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="useInputBtn">Use Input</button>
          <button id="shuffleBtn">Shuffle Current</button>
        </div>

        <div class="info">
          <div class="stat">Comparisons: <strong id="comparisons">0</strong></div>
          <div class="stat">Swaps: <strong id="swaps">0</strong></div>
          <div class="stat">Passes: <strong id="passes">0</strong></div>
        </div>

        <div class="visual panel" id="visual" aria-label="Array visualization">
          <!-- Bars inserted here -->
        </div>

        <div class="info" style="margin-top:10px">
          <div class="stat">Current action: <strong id="action">Idle</strong></div>
          <div class="stat">Last compared indices: <strong id="lastComp">-</strong></div>
        </div>
      </div>

      <div style="width:380px;min-width:280px">
        <label>Pseudocode (highlights current line)</label>
        <pre id="pseudocode" class="panel small" style="height:220px">
<span class="code-line" data-line="1">for i from 0 to n-1</span>
<span class="code-line" data-line="2">  swapped = false</span>
<span class="code-line" data-line="3">  for j from 0 to n-i-2</span>
<span class="code-line" data-line="4">    if a[j] > a[j+1]</span>
<span class="code-line" data-line="5">      swap a[j] and a[j+1]</span>
<span class="code-line" data-line="6">      swapped = true</span>
<span class="code-line" data-line="7">  if not swapped: break</span>
        </pre>

        <label style="margin-top:10px">Notes</label>
        <div class="panel small" style="padding:10px">
          - This visualizer shows each comparison and swap.<br>
          - "Optimized" bubble sort stops early if the array becomes sorted during a pass.<br>
          - Use "Step" to advance one algorithm action at a time.
        </div>
      </div>
    </div>

    <footer style="display:flex;justify-content:space-between;align-items:center">
      <div>© Bubble Sort Visualizer</div>
      <div style="color:var(--muted)">Tip: press Generate Random then Start</div>
    </footer>
  </div>

<script>
(function(){
  // Utilities
  const el = id => document.getElementById(id);
  const clamp = (v,a,b)=>Math.max(a,Math.min(b,v));

  // Elements
  const sizeRange = el('size');
  const sizeLabel = el('sizeLabel');
  const speedRange = el('speed');
  const speedLabel = el('speedLabel');
  const ascendingCb = el('ascending');
  const optimizedCb = el('optimized');
  const randomBtn = el('randomBtn');
  const startBtn = el('startBtn');
  const pauseBtn = el('pauseBtn');
  const stepBtn = el('stepBtn');
  const resetBtn = el('resetBtn');
  const shuffleBtn = el('shuffleBtn');
  const useInputBtn = el('useInputBtn');
  const arrayInput = el('arrayInput');
  const visual = el('visual');
  const compsEl = el('comparisons');
  const swapsEl = el('swaps');
  const passesEl = el('passes');
  const actionEl = el('action');
  const lastCompEl = el('lastComp');
  const pseudocodeEl = el('pseudocode');

  // State
  let array = [];
  let initialArray = [];
  let gen = null;
  let running = false;
  let timer = null;
  let stepDelay = parseInt(speedRange.value,10);
  let comparisons = 0, swaps = 0, passes = 0;
  let currentHighlight = {i:-1,j:-1, type:null, sortedIndex:-1};

  // Pseudocode line mapping
  function setPseudocodeLine(n){
    pseudocodeEl.querySelectorAll('.code-line').forEach(el=>{
      el.classList.toggle('active', Number(el.dataset.line)===n);
    });
  }

  // Generate random array
  function randomArray(n){
    const arr = [];
    for(let i=0;i<n;i++){
      // values 5..100 for visible bars
      arr.push(Math.floor(Math.random()*96)+5);
    }
    return arr;
  }

  // Render
  function render(){
    visual.innerHTML='';
    const maxVal = Math.max(...array,1);
    const barCount = array.length;
    array.forEach((v,idx)=>{
      const bar = document.createElement('div');
      bar.className='bar';
      const h = (v/maxVal)*92; // percentage of container height
      bar.style.height = h + '%';
      bar.title = String(v);
      // value label
      const label = document.createElement('div');
      label.className='val';
      label.textContent = v;
      bar.appendChild(label);

      // states
      if(currentHighlight.type === 'compare' && (idx===currentHighlight.i || idx===currentHighlight.j)){
        bar.classList.add('compare');
      }
      if(currentHighlight.type === 'swap' && (idx===currentHighlight.i || idx===currentHighlight.j)){
        bar.classList.add('swap');
      }
      if(currentHighlight.type === 'sorted' && idx >= currentHighlight.sortedIndex){
        bar.classList.add('sorted');
      }
      visual.appendChild(bar);
    });
    compsEl.textContent = comparisons;
    swapsEl.textContent = swaps;
    passesEl.textContent = passes;
    lastCompEl.textContent = (currentHighlight.i>=0 && currentHighlight.j>=0) ? `${currentHighlight.i}, ${currentHighlight.j}` : '-';
  }

  // Bubble sort generator: yields at each compare and swap, and at pass end
  function* bubbleSortGen(arr, ascending=true, optimized=true){
    let a = arr.slice(); // work on copy
    const n = a.length;
    let comps=0, sw=0;
    for(let i=0;i<n;i++){
      let swapped=false;
      // signal start of pass
      // inner loop
      for(let j=0;j<n-i-1;j++){
        // comparing j and j+1
        yield {type:'compare', i:j, j:j+1, arr:a.slice(), comps, sw, pass:i, sortedIndex:n-i};
        comps++;
        const cmp = ascending ? (a[j] > a[j+1]) : (a[j] < a[j+1]);
        if(cmp){
          // swap
          const tmp = a[j]; a[j]=a[j+1]; a[j+1]=tmp;
          sw++;
          swapped=true;
          yield {type:'swap', i:j, j:j+1, arr:a.slice(), comps, sw, pass:i, sortedIndex:n-i};
        }
      }
      passes++;
      // end of pass: mark last element as sorted (n-i-1)
      yield {type:'passEnd', i:-1, j:-1, arr:a.slice(), comps, sw, pass:i, sortedIndex:n-i-1};
      if(optimized && !swapped){
        break;
      }
    }
    yield {type:'done', i:-1, j:-1, arr:a.slice(), comps, sw, pass:null, sortedIndex:0};
  }

  // Advance generator one step and update UI
  function advanceOnce(){
    if(!gen) return false;
    const res = gen.next();
    if(res.done){
      // algorithm finished
      const s = res.value || {};
      if(s.arr) array = s.arr.slice();
      comparisons = (s.comps !== undefined) ? s.comps : comparisons;
      swaps = (s.sw !== undefined) ? s.sw : swaps;
      currentHighlight = {i:-1,j:-1,type:'sorted',sortedIndex:0};
      setPseudocodeLine(null);
      render();
      running = false;
      stopAuto();
      actionEl.textContent = 'Finished';
      startBtn.disabled = true;
      pauseBtn.disabled = true;
      stepBtn.disabled = true;
      return false;
    }
    const state = res.value;
    // update counters from yield (they represent counts before or after)
    comparisons = state.comps;
    swaps = state.sw;
    // interpret state
    if(state.type === 'compare'){
      currentHighlight = {i:state.i, j:state.j, type:'compare', sortedIndex:state.sortedIndex||-1};
      actionEl.textContent = 'Comparing';
      setPseudocodeLine(4);
    } else if(state.type === 'swap'){
      array = state.arr.slice();
      currentHighlight = {i:state.i, j:state.j, type:'swap', sortedIndex:state.sortedIndex||-1};
      actionEl.textContent = 'Swapped';
      setPseudocodeLine(5);
    } else if(state.type === 'passEnd'){
      array = state.arr.slice();
      passes = state.pass+1;
      currentHighlight = {i:-1,j:-1,type:'sorted',sortedIndex:state.sortedIndex||-1};
      actionEl.textContent = 'End of pass';
      setPseudocodeLine(2);
    } else {
      // fallback
      array = state.arr ? state.arr.slice() : array;
      currentHighlight = {i:-1,j:-1,type:null,sortedIndex:-1};
      actionEl.textContent = state.type || 'Running';
      setPseudocodeLine(null);
    }
    render();
    return true;
  }

  // Auto-run
  function startAuto(){
    if(running) return;
    running = true;
    startBtn.disabled = true;
    pauseBtn.disabled = false;
    stepBtn.disabled = true;
    resetBtn.disabled = true;
    randomBtn.disabled = true;
    useInputBtn.disabled = true;
    shuffleBtn.disabled = true;
    sizeRange.disabled = true;
    speedRange.disabled = false;
    arrayInput.disabled = true;
    const loop = async ()=>{
      if(!running) return;
      const did = advanceOnce();
      if(!did){
        running=false;
        stopAuto();
        return;
      }
      timer = setTimeout(loop, stepDelay);
    };
    timer = setTimeout(loop, stepDelay);
  }

  function stopAuto(){
    running = false;
    if(timer) { clearTimeout(timer); timer=null; }
    startBtn.disabled = false;
    pauseBtn.disabled = true;
    stepBtn.disabled = false;
    resetBtn.disabled = false;
    randomBtn.disabled = false;
    useInputBtn.disabled = false;
    shuffleBtn.disabled = false;
    sizeRange.disabled = false;
    arrayInput.disabled = false;
  }

  function pauseAuto(){
    running = false;
    if(timer) { clearTimeout(timer); timer=null; }
    startBtn.disabled = false;
    pauseBtn.disabled = true;
    stepBtn.disabled = false;
    resetBtn.disabled = false;
    randomBtn.disabled = false;
    useInputBtn.disabled = false;
    shuffleBtn.disabled = false;
    sizeRange.disabled = false;
    arrayInput.disabled = false;
    actionEl.textContent = 'Paused';
  }

  // Initialize array and UI
  function resetToInitial(useInput=false){
    if(useInput){
      const txt = arrayInput.value.trim();
      if(txt){
        try{
          const parts = txt.split(',').map(s=>s.trim()).filter(s=>s.length>0).map(Number);
          if(parts.some(x=>Number.isNaN(x))) throw new Error('Invalid number in input');
          array = parts.slice();
        }catch(e){
          alert('Invalid input. Please enter comma separated numbers.');
          return;
        }
      } else {
        array = randomArray(parseInt(sizeRange.value,10));
      }
    } else {
      array = initialArray.slice();
    }
    comparisons = 0; swaps = 0; passes = 0;
    gen = null;
    running = false;
    currentHighlight = {i:-1,j:-1,type:null,sortedIndex:-1};
    actionEl.textContent = 'Idle';
    lastCompEl.textContent = '-';
    startBtn.disabled = false;
    pauseBtn.disabled = true;
    stepBtn.disabled = false;
    resetBtn.disabled = false;
    randomBtn.disabled = false;
    useInputBtn.disabled = false;
    shuffleBtn.disabled = false;
    sizeRange.disabled = false;
    arrayInput.disabled = false;
    render();
    setPseudocodeLine(null);
  }

  // Event handlers
  sizeRange.addEventListener('input', ()=>{
    sizeLabel.textContent = sizeRange.value;
  });

  speedRange.addEventListener('input', ()=>{
    speedLabel.textContent = speedRange.value;
    stepDelay = parseInt(speedRange.value,10);
  });

  randomBtn.addEventListener('click', ()=>{
    const n = parseInt(sizeRange.value,10);
    initialArray = randomArray(n);
    arrayInput.value = initialArray.join(', ');
    resetToInitial(false);
  });

  shuffleBtn.addEventListener('click', ()=>{
    // shuffle current array
    for(let i=array.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    initialArray = array.slice();
    resetToInitial(false);
  });

  useInputBtn.addEventListener('click', ()=>{
    resetToInitial(true);
  });

  startBtn.addEventListener('click', ()=>{
    if(!gen){
      // create new generator from current array copy
      gen = bubbleSortGen(array.slice(), ascendingCb.checked, optimizedCb.checked);
    }
    startAuto();
    actionEl.textContent = 'Running';
  });

  pauseBtn.addEventListener('click', ()=>{
    pauseAuto();
  });

  stepBtn.addEventListener('click', ()=>{
    if(!gen){
      gen = bubbleSortGen(array.slice(), ascendingCb.checked, optimizedCb.checked);
    }
    const ok = advanceOnce();
    if(!ok){
      // finished
      gen = null;
    }
  });

  resetBtn.addEventListener('click', ()=>{
    gen = null;
    resetToInitial(false);
  });

  arrayInput.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter'){
      resetToInitial(true);
    }
  });

  // init defaults
  function init(){
    sizeLabel.textContent = sizeRange.value;
    speedLabel.textContent = speedRange.value;
    stepDelay = parseInt(speedRange.value,10);
    initialArray = randomArray(parseInt(sizeRange.value,10));
    arrayInput.value = initialArray.join(', ');
    resetToInitial(false);
  }

  // Create accessibility: keyboard shortcuts
  window.addEventListener('keydown', (e)=>{
    if(e.ctrlKey || e.metaKey) return;
    if(e.key === ' '){ e.preventDefault(); if(running) pauseAuto(); else startBtn.click(); }
    if(e.key === 'ArrowRight'){ stepBtn.click(); }
  });

  // Kick off
  init();

})();
</script>
</body>
</html>