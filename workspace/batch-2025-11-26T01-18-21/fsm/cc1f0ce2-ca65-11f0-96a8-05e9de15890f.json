{
  "meta": {
    "concept": "TwoPointers",
    "topic": "Two Pointers — Interactive Playground",
    "educational_goal": "Visualize and teach two-pointer patterns: left/right pointers, in-place swaps (reverse), and read/write (remove duplicates); allow step-by-step and automated runs",
    "expected_interactions": [
      "change_demo",
      "apply_array",
      "generate_random_array",
      "step",
      "auto_start_stop",
      "fast_run",
      "reset",
      "set_target",
      "change_interval",
      "click_cell"
    ]
  },
  "states": [
    {
      "id": "S0_Ready",
      "label": "Ready",
      "type": "idle",
      "entry_actions": [
        "initState()",
        "updateUI()",
        "renderArray(state.arr, highlights)",
        "setStatus('Ready. Demo: ' + (state.demo))"
      ],
      "exit_actions": []
    },
    {
      "id": "S1_Stepping",
      "label": "Stepping",
      "type": "atomic",
      "entry_actions": [
        "step()",
        "state.steps++"
      ],
      "exit_actions": []
    },
    {
      "id": "S2_AutoRunning",
      "label": "AutoRunning",
      "type": "atomic",
      "entry_actions": [
        "autoTimer = setInterval(()=>{ if(state.finished){ clearInterval(autoTimer); autoTimer=null; autoBtn.textContent='Auto ▶'; } step(); }, Number(interval.value))",
        "autoBtn.textContent = 'Auto ■'",
        "setStatus('Auto running...')"
      ],
      "exit_actions": [
        "clearInterval(autoTimer)",
        "autoTimer = null",
        "autoBtn.textContent = 'Auto ▶'",
        "setStatus('Auto stopped')"
      ]
    },
    {
      "id": "S3_FastRunning",
      "label": "FastRunning",
      "type": "atomic",
      "entry_actions": [
        "runFast()",
        "setStatus('Running fast...')"
      ],
      "exit_actions": [
        "setStatus('Finished (fast run)', 'found')"
      ]
    },
    {
      "id": "S4_Initializing",
      "label": "Initializing",
      "type": "atomic",
      "entry_actions": [
        "initState()",
        "setStatus('Initializing...')"
      ],
      "exit_actions": []
    },
    {
      "id": "S5_InputError",
      "label": "InputError",
      "type": "atomic",
      "entry_actions": [
        "setStatus(msg || 'Invalid input', 'bad')"
      ],
      "exit_actions": [
        "setStatus('Ready')"
      ]
    },
    {
      "id": "S6_TargetSetting",
      "label": "TargetSetting",
      "type": "atomic",
      "entry_actions": [
        "const t = Number(document.getElementById('targetInput') && document.getElementById('targetInput').value)",
        "if (!Number.isFinite(t)) setStatus('Invalid target','bad') else { state.target = t; setStatus('Target set to ' + t) }"
      ],
      "exit_actions": []
    },
    {
      "id": "S7_Finished",
      "label": "Finished",
      "type": "final",
      "entry_actions": [
        "state.finished = true",
        "renderArray(state.arr)",
        "setStatus('Finished', 'found')"
      ],
      "exit_actions": []
    },
    {
      "id": "S8_DemoChanged",
      "label": "DemoChanged",
      "type": "atomic",
      "entry_actions": [
        "initState()",
        "setStatus('Demo changed')"
      ],
      "exit_actions": []
    }
  ],
  "events": [
    {
      "id": "DEMO_CHANGE",
      "event_type": "user_action",
      "description": "User selects a different demo from the select box",
      "triggers": "#demoSelect"
    },
    {
      "id": "GENERATE_RANDOM",
      "event_type": "user_action",
      "description": "User clicks Generate to create a random array",
      "triggers": "#genBtn"
    },
    {
      "id": "APPLY_ARRAY",
      "event_type": "user_action",
      "description": "User clicks Apply after entering an array in the input",
      "triggers": "#applyArr, #arrInput"
    },
    {
      "id": "STEP_CLICK",
      "event_type": "user_action",
      "description": "User clicks Step button or presses Space to advance one step",
      "triggers": "#stepBtn"
    },
    {
      "id": "RESET_CLICK",
      "event_type": "user_action",
      "description": "User clicks Reset to reinitialize current demo and array",
      "triggers": "#resetBtn"
    },
    {
      "id": "AUTO_TOGGLE",
      "event_type": "user_action",
      "description": "User toggles Auto mode by clicking Auto button",
      "triggers": "#autoBtn"
    },
    {
      "id": "FAST_RUN",
      "event_type": "user_action",
      "description": "User clicks Run Fast to execute to completion with short delays",
      "triggers": "#fastBtn"
    },
    {
      "id": "INTERVAL_CHANGE",
      "event_type": "user_action",
      "description": "User changes the interval slider which controls auto stepping frequency",
      "triggers": "#interval"
    },
    {
      "id": "TARGET_SET",
      "event_type": "user_action",
      "description": "User sets target for pairSum demo (button created dynamically inside #extraControls)",
      "triggers": "#setTarget, #targetInput"
    },
    {
      "id": "CELL_CLICK",
      "event_type": "user_action",
      "description": "User clicks a cell in the array visualization",
      "triggers": "#arrayVis .cell, .cell"
    },
    {
      "id": "INPUT_PARSE_FAILED",
      "event_type": "system_event",
      "description": "Array input parsing failed (invalid array)",
      "triggers": "#applyArr, #arrInput"
    },
    {
      "id": "AUTO_FINISHED",
      "event_type": "system_event",
      "description": "Auto run stopped because algorithm reached finished state",
      "triggers": "#autoBtn, #arrayVis"
    },
    {
      "id": "FAST_FINISHED",
      "event_type": "system_event",
      "description": "Fast run completed to algorithm finish",
      "triggers": "#fastBtn, #arrayVis"
    },
    {
      "id": "INIT_COMPLETE",
      "event_type": "system_event",
      "description": "Initialization / state reset completed",
      "triggers": "#arrayVis, #pseudocode"
    }
  ],
  "transitions": [
    {
      "from": "S4_Initializing",
      "to": "S0_Ready",
      "event": "INIT_COMPLETE",
      "guard": "true",
      "actions": [
        "updateUI()",
        "renderArray(state.arr)"
      ],
      "expected_observables": [
        "dom:#arrayVis updated",
        "dom:#pseudocode.textContent updated",
        "dom:#status.textContent updated"
      ],
      "triggers": "#arrayVis, #pseudocode",
      "timeout": 200
    },
    {
      "from": "S0_Ready",
      "to": "S1_Stepping",
      "event": "STEP_CLICK",
      "guard": "state && !state.finished",
      "actions": [
        "clearInterval(autoTimer) // if any (code clears when stepBtn clicked)",
        "step()"
      ],
      "expected_observables": [
        "dom:#stepInfo.textContent changed",
        "dom:#arrayVis .cell classes changed",
        "dom:#status.textContent changed"
      ],
      "triggers": "#stepBtn",
      "timeout": 500
    },
    {
      "from": "S1_Stepping",
      "to": "S7_Finished",
      "event": "STEP_RESULT_FINISHED",
      "guard": "state.finished === true",
      "actions": [
        "setStatus('Finished', 'found')",
        "renderArray(state.arr)"
      ],
      "expected_observables": [
        "dom:#status.class contains 'found'",
        "dom:#result.textContent updated"
      ],
      "triggers": "#arrayVis .cell",
      "timeout": 500
    },
    {
      "from": "S1_Stepping",
      "to": "S0_Ready",
      "event": "STEP_RESULT_CONTINUE",
      "guard": "state.finished === false",
      "actions": [
        "renderArray(state.arr, {left: state.l, right: state.r, write: state.write, removed: state.removed})",
        "setStatus('Ready')"
      ],
      "expected_observables": [
        "dom:#arrayVis updated",
        "dom:#stepInfo.textContent updated"
      ],
      "triggers": "#arrayVis .cell",
      "timeout": 200
    },
    {
      "from": "S0_Ready",
      "to": "S2_AutoRunning",
      "event": "AUTO_TOGGLE",
      "guard": "autoTimer == null && !state.finished",
      "actions": [
        "autoTimer = setInterval(()=>{ if(state.finished){ clearInterval(autoTimer); autoTimer=null; autoBtn.textContent='Auto ▶'; } step(); }, Number(interval.value))",
        "autoBtn.textContent = 'Auto ■'",
        "setStatus('Auto running...')"
      ],
      "expected_observables": [
        "dom:#autoBtn.textContent == 'Auto ■'",
        "dom:#status.textContent contains 'Auto running'"
      ],
      "triggers": "#autoBtn",
      "timeout": 200
    },
    {
      "from": "S2_AutoRunning",
      "to": "S0_Ready",
      "event": "AUTO_TOGGLE",
      "guard": "autoTimer != null",
      "actions": [
        "clearInterval(autoTimer)",
        "autoTimer = null",
        "autoBtn.textContent = 'Auto ▶'",
        "setStatus('Auto stopped')"
      ],
      "expected_observables": [
        "dom:#autoBtn.textContent == 'Auto ▶'",
        "dom:#status.textContent contains 'Auto stopped'"
      ],
      "triggers": "#autoBtn",
      "timeout": 200
    },
    {
      "from": "S2_AutoRunning",
      "to": "S7_Finished",
      "event": "AUTO_FINISHED",
      "guard": "state.finished === true",
      "actions": [
        "clearInterval(autoTimer)",
        "autoTimer = null",
        "autoBtn.textContent = 'Auto ▶'",
        "setStatus('Finished', 'found')"
      ],
      "expected_observables": [
        "dom:#status.class contains 'found'",
        "dom:#arrayVis final state"
      ],
      "triggers": "#arrayVis",
      "timeout": 500
    },
    {
      "from": "S0_Ready",
      "to": "S3_FastRunning",
      "event": "FAST_RUN",
      "guard": "state && !state.finished",
      "actions": [
        "if (autoTimer) { clearInterval(autoTimer); autoTimer=null; autoBtn.textContent='Auto ▶'; }",
        "runFast()"
      ],
      "expected_observables": [
        "dom:#status.textContent contains 'Running fast...'",
        "dom:#arrayVis changes rapidly"
      ],
      "triggers": "#fastBtn",
      "timeout": 100
    },
    {
      "from": "S3_FastRunning",
      "to": "S7_Finished",
      "event": "FAST_FINISHED",
      "guard": "state.finished === true",
      "actions": [
        "setStatus('Finished (fast run)', 'found')",
        "renderArray(state.arr)"
      ],
      "expected_observables": [
        "dom:#status.class contains 'found'",
        "dom:#result.textContent updated"
      ],
      "triggers": "#fastBtn, #arrayVis",
      "timeout": 2000
    },
    {
      "from": "S0_Ready",
      "to": "S4_Initializing",
      "event": "RESET_CLICK",
      "guard": "true",
      "actions": [
        "if (autoTimer) { clearInterval(autoTimer); autoTimer=null; autoBtn.textContent='Auto ▶'; }",
        "initState()"
      ],
      "expected_observables": [
        "dom:#arrayVis re-rendered",
        "dom:#status.textContent updated"
      ],
      "triggers": "#resetBtn",
      "timeout": 200
    },
    {
      "from": "S0_Ready",
      "to": "S4_Initializing",
      "event": "GENERATE_RANDOM",
      "guard": "true",
      "actions": [
        "arrInput.value = ''",
        "initState()"
      ],
      "expected_observables": [
        "dom:#arrInput.value == ''",
        "dom:#arrayVis updated"
      ],
      "triggers": "#genBtn",
      "timeout": 200
    },
    {
      "from": "S0_Ready",
      "to": "S5_InputError",
      "event": "APPLY_ARRAY",
      "guard": "parseArrayInput(document.getElementById('arrInput').value || '') == null",
      "actions": [
        "setStatus('Invalid array. Use comma separated numbers.', 'bad')"
      ],
      "expected_observables": [
        "dom:#status.class contains 'bad'",
        "dom:#status.textContent contains 'Invalid array'"
      ],
      "triggers": "#applyArr",
      "timeout": 200
    },
    {
      "from": "S0_Ready",
      "to": "S4_Initializing",
      "event": "APPLY_ARRAY",
      "guard": "parseArrayInput(document.getElementById('arrInput').value || '') != null",
      "actions": [
        "initState()"
      ],
      "expected_observables": [
        "dom:#arrayVis updated",
        "dom:#status.textContent updated"
      ],
      "triggers": "#applyArr",
      "timeout": 200
    },
    {
      "from": "S0_Ready",
      "to": "S6_TargetSetting",
      "event": "TARGET_SET",
      "guard": "document.getElementById('targetInput') != null",
      "actions": [
        "const t = Number(document.getElementById('targetInput').value)",
        "if (!Number.isFinite(t)) { setStatus('Invalid target', 'bad') } else { state.target = t; setStatus('Target set to ' + t) }"
      ],
      "expected_observables": [
        "dom:#targetInput.value read",
        "dom:#status.textContent updated"
      ],
      "triggers": "#setTarget",
      "timeout": 200
    },
    {
      "from": "S6_TargetSetting",
      "to": "S0_Ready",
      "event": "TARGET_SET_COMPLETE",
      "guard": "true",
      "actions": [
        "updateUI()",
        "renderArray(state.arr)"
      ],
      "expected_observables": [
        "dom:#status updated",
        "dom:#arrayVis updated"
      ],
      "triggers": "#targetInput, #setTarget",
      "timeout": 200
    },
    {
      "from": "S0_Ready",
      "to": "S8_DemoChanged",
      "event": "DEMO_CHANGE",
      "guard": "true",
      "actions": [
        "initState()",
        "setStatus('Demo changed')"
      ],
      "expected_observables": [
        "dom:#pseudocode.textContent updated",
        "dom:#arrayVis updated"
      ],
      "triggers": "#demoSelect",
      "timeout": 200
    },
    {
      "from": "S2_AutoRunning",
      "to": "S2_AutoRunning",
      "event": "INTERVAL_CHANGE",
      "guard": "autoTimer != null",
      "actions": [
        "clearInterval(autoTimer)",
        "autoTimer = setInterval(()=>{ if(state.finished){ clearInterval(autoTimer); autoTimer=null; autoBtn.textContent='Auto ▶'; } step(); }, Number(interval.value))",
        "ivalLbl.textContent = interval.value"
      ],
      "expected_observables": [
        "dom:#ivalLbl.textContent updated",
        "dom:#autoBtn remains 'Auto ■'"
      ],
      "triggers": "#interval",
      "timeout": 200
    },
    {
      "from": "S0_Ready",
      "to": "S0_Ready",
      "event": "CELL_CLICK",
      "guard": "true",
      "actions": [
        "const idx = Number(ev && ev.target && ev.target.closest && ev.target.closest('.cell') && ev.target.closest('.cell').querySelector('.idx').textContent)",
        "setStatus('Clicked index ' + idx + '. Value: ' + state.arr[idx])"
      ],
      "expected_observables": [
        "dom:#status.textContent updated",
        "dom:#arrayVis .cell retains classes"
      ],
      "triggers": "#arrayVis .cell, .cell",
      "timeout": 100
    }
  ],
  "components": [
    "#demoSelect",
    "#arrInput",
    "#applyArr",
    "#genBtn",
    "#sizeRange",
    "#arrayVis",
    "#stepBtn",
    "#resetBtn",
    "#autoBtn",
    "#fastBtn",
    "#status",
    "#hint",
    "#pseudocode",
    "#stepInfo",
    "#result",
    "#extraControls",
    "#interval",
    "#ivalLbl",
    "#targetInput",
    "#setTarget",
    ".array",
    ".cell",
    ".idx",
    ".ptrLeft",
    ".ptrRight",
    ".ptrWrite",
    ".found",
    ".bad",
    ".controls",
    ".btnRow",
    ".dot.left",
    ".dot.right",
    ".dot.write"
  ]
}