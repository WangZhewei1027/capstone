{
  "meta": {
    "concept": "SelectionSort",
    "topic": "Selection Sort Visualizer",
    "educational_goal": "Demonstrate step-by-step selection sort with controls for playback, stepping, randomization, size/order/delay adjustments, and inline editing of array values",
    "expected_interactions": [
      "randomize",
      "play",
      "pause",
      "step_forward",
      "step_back",
      "reset",
      "change_size",
      "change_order",
      "change_delay",
      "edit_value"
    ]
  },
  "states": [
    {
      "id": "S0_Idle",
      "label": "Idle",
      "type": "idle",
      "entry_actions": [
        "initialize() /* array = randArray(Number(sizeInput.value)); initialArray = array.slice(); rebuildSnapshots(); applySnapshot(0) */",
        "renderArray(current snapshot) /* renderArray(snapshots[current]) */",
        "enableControls() /* startBtn.disabled = false; pauseBtn.disabled = true; update UI values */"
      ],
      "exit_actions": []
    },
    {
      "id": "S1_Playing",
      "label": "Playing",
      "type": "atomic",
      "entry_actions": [
        "play() /* set playing = true; startBtn.disabled = true; pauseBtn.disabled = false; start timer using Number(delayInput.value) */",
        "startTimer() /* timer = setInterval(advanceSnapshot, delay) */"
      ],
      "exit_actions": [
        "stopTimer() /* clearInterval(timer); timer = null */",
        "setPlayingFalse() /* playing = false; startBtn.disabled = false; pauseBtn.disabled = true */"
      ]
    },
    {
      "id": "S2_Paused",
      "label": "Paused",
      "type": "atomic",
      "entry_actions": [
        "stop() /* clearInterval if any; playing = false */",
        "enableControls() /* startBtn.disabled = false; pauseBtn.disabled = true */"
      ],
      "exit_actions": []
    },
    {
      "id": "S3_StepForward",
      "label": "StepForward",
      "type": "atomic",
      "entry_actions": [
        "stop() /* ensure playback stopped */",
        "applySnapshot(current + 1) /* advance one snapshot and render */"
      ],
      "exit_actions": []
    },
    {
      "id": "S4_StepBackward",
      "label": "StepBackward",
      "type": "atomic",
      "entry_actions": [
        "stop()",
        "applySnapshot(current - 1) /* go back one snapshot and render */"
      ],
      "exit_actions": []
    },
    {
      "id": "S5_Randomizing",
      "label": "Randomizing",
      "type": "atomic",
      "entry_actions": [
        "array = randArray(Number(sizeInput.value))",
        "initialArray = array.slice()",
        "rebuildSnapshots()",
        "applySnapshot(0)"
      ],
      "exit_actions": []
    },
    {
      "id": "S6_Rebuilding",
      "label": "RebuildingSnapshots",
      "type": "atomic",
      "entry_actions": [
        "rebuildSnapshots()",
        "applySnapshot(0)"
      ],
      "exit_actions": []
    },
    {
      "id": "S7_Editing",
      "label": "EditingValue",
      "type": "atomic",
      "entry_actions": [
        "promptEditValue(idx) /* prompt() for new value */",
        "validateAndApplyEdit() /* parseInt, update array[idx], initialArray = array.slice() */",
        "rebuildSnapshots()",
        "applySnapshot(0)"
      ],
      "exit_actions": []
    },
    {
      "id": "S8_Finished",
      "label": "Finished",
      "type": "final",
      "entry_actions": [
        "stop()",
        "render final snapshot /* ensure last snapshot is shown */",
        "enableControls()"
      ],
      "exit_actions": []
    }
  ],
  "events": [
    {
      "id": "USER_CLICK_START",
      "event_type": "user_action",
      "description": "User clicks the Play / Start button (#startBtn) or presses Space to toggle play",
      "triggers": "#startBtn, window"
    },
    {
      "id": "USER_CLICK_PAUSE",
      "event_type": "user_action",
      "description": "User clicks the Pause button (#pauseBtn) or presses Space to toggle pause",
      "triggers": "#pauseBtn, window"
    },
    {
      "id": "USER_CLICK_STEP_FORWARD",
      "event_type": "user_action",
      "description": "User clicks the Step forward button (#stepF) or presses ArrowRight",
      "triggers": "#stepF, window"
    },
    {
      "id": "USER_CLICK_STEP_BACK",
      "event_type": "user_action",
      "description": "User clicks the Step back button (#stepB) or presses ArrowLeft",
      "triggers": "#stepB, window"
    },
    {
      "id": "USER_CLICK_RANDOMIZE",
      "event_type": "user_action",
      "description": "User clicks the Randomize button (#randomBtn) or presses 'r' key",
      "triggers": "#randomBtn, window"
    },
    {
      "id": "USER_CLICK_RESET",
      "event_type": "user_action",
      "description": "User clicks the Reset button (#resetBtn)",
      "triggers": "#resetBtn"
    },
    {
      "id": "SIZE_CHANGED",
      "event_type": "user_action",
      "description": "User changes the array size range input (#size) - 'input' updates display and 'change' regenerates array",
      "triggers": "#size"
    },
    {
      "id": "ORDER_CHANGED",
      "event_type": "user_action",
      "description": "User changes the order select (#order)",
      "triggers": "#order"
    },
    {
      "id": "DELAY_CHANGED",
      "event_type": "user_action",
      "description": "User changes the delay slider (#delay) which updates delayVal and restarts timer if playing",
      "triggers": "#delay"
    },
    {
      "id": "BAR_CLICK",
      "event_type": "user_action",
      "description": "User clicks a displayed bar to edit its value (bars use class 'bar' within #vis)",
      "triggers": "#vis .bar"
    },
    {
      "id": "TIMER_TICK",
      "event_type": "system_event",
      "description": "Playback timer tick advances snapshots automatically (internal setInterval)",
      "triggers": "#delay"
    },
    {
      "id": "PLAYBACK_COMPLETE",
      "event_type": "system_event",
      "description": "Playback reached final snapshot (current >= snapshots.length - 1)",
      "triggers": "#stepCounter,#maxStep"
    },
    {
      "id": "SNAPSHOTS_REBUILT",
      "event_type": "system_event",
      "description": "Snapshots were regenerated after array/order/size/change",
      "triggers": "#vis,#pseudocode"
    },
    {
      "id": "SNAPSHOT_APPLIED",
      "event_type": "system_event",
      "description": "A snapshot was applied and rendered",
      "triggers": "#vis .bar,#stepCounter,#compCount,#swapCount,#message"
    }
  ],
  "transitions": [
    {
      "from": "S0_Idle",
      "to": "S1_Playing",
      "event": "USER_CLICK_START",
      "guard": "playing === false",
      "actions": [
        "play()",
        "startTimer() /* uses Number(delayInput.value) */"
      ],
      "triggers": "#startBtn, window",
      "timeout": 0
    },
    {
      "from": "S2_Paused",
      "to": "S1_Playing",
      "event": "USER_CLICK_START",
      "guard": "playing === false",
      "actions": [
        "play()",
        "startTimer()"
      ],
      "triggers": "#startBtn, window",
      "timeout": 0
    },
    {
      "from": "S1_Playing",
      "to": "S2_Paused",
      "event": "USER_CLICK_PAUSE",
      "guard": "playing === true",
      "actions": [
        "stop()"
      ],
      "triggers": "#pauseBtn, window",
      "timeout": 0
    },
    {
      "from": "S1_Playing",
      "to": "S0_Idle",
      "event": "PLAYBACK_COMPLETE",
      "guard": "current >= snapshots.length - 1",
      "actions": [
        "stop()",
        "applySnapshot(snapshots.length - 1)"
      ],
      "triggers": "#stepCounter,#maxStep",
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S3_StepForward",
      "event": "USER_CLICK_STEP_FORWARD",
      "guard": "true",
      "actions": [
        "stop()",
        "applySnapshot(current + 1)"
      ],
      "triggers": "#stepF, window",
      "timeout": 0
    },
    {
      "from": "S1_Playing",
      "to": "S3_StepForward",
      "event": "USER_CLICK_STEP_FORWARD",
      "guard": "true",
      "actions": [
        "stop()",
        "applySnapshot(current + 1)"
      ],
      "triggers": "#stepF, window",
      "timeout": 0
    },
    {
      "from": "S3_StepForward",
      "to": "S2_Paused",
      "event": "SNAPSHOT_APPLIED",
      "guard": "true",
      "actions": [],
      "triggers": "#vis .bar,#stepCounter",
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S4_StepBackward",
      "event": "USER_CLICK_STEP_BACK",
      "guard": "true",
      "actions": [
        "stop()",
        "applySnapshot(current - 1)"
      ],
      "triggers": "#stepB, window",
      "timeout": 0
    },
    {
      "from": "S1_Playing",
      "to": "S4_StepBackward",
      "event": "USER_CLICK_STEP_BACK",
      "guard": "true",
      "actions": [
        "stop()",
        "applySnapshot(current - 1)"
      ],
      "triggers": "#stepB, window",
      "timeout": 0
    },
    {
      "from": "S4_StepBackward",
      "to": "S2_Paused",
      "event": "SNAPSHOT_APPLIED",
      "guard": "true",
      "actions": [],
      "triggers": "#vis .bar,#stepCounter",
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S5_Randomizing",
      "event": "USER_CLICK_RANDOMIZE",
      "guard": "true",
      "actions": [
        "array = randArray(Number(sizeInput.value))",
        "initialArray = array.slice()",
        "rebuildSnapshots()",
        "applySnapshot(0)"
      ],
      "triggers": "#randomBtn, window",
      "timeout": 0
    },
    {
      "from": "S5_Randomizing",
      "to": "S0_Idle",
      "event": "SNAPSHOTS_REBUILT",
      "guard": "true",
      "actions": [],
      "triggers": "#vis,#pseudocode",
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S6_Rebuilding",
      "event": "SIZE_CHANGED",
      "guard": "true",
      "actions": [
        "array = randArray(Number(sizeInput.value)) /* on change event the code regenerates */",
        "initialArray = array.slice()",
        "rebuildSnapshots()",
        "applySnapshot(0)"
      ],
      "triggers": "#size",
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S6_Rebuilding",
      "event": "ORDER_CHANGED",
      "guard": "true",
      "actions": [
        "rebuildSnapshots()",
        "applySnapshot(0)"
      ],
      "triggers": "#order",
      "timeout": 0
    },
    {
      "from": "S2_Paused",
      "to": "S6_Rebuilding",
      "event": "ORDER_CHANGED",
      "guard": "true",
      "actions": [
        "rebuildSnapshots()",
        "applySnapshot(0)"
      ],
      "triggers": "#order",
      "timeout": 0
    },
    {
      "from": "S6_Rebuilding",
      "to": "S0_Idle",
      "event": "SNAPSHOTS_REBUILT",
      "guard": "true",
      "actions": [],
      "triggers": "#vis,#pseudocode",
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "DELAY_CHANGED",
      "guard": "true",
      "actions": [
        "update delayVal textContent",
        "if (playing) { stop(); play(); }"
      ],
      "triggers": "#delay",
      "timeout": 0
    },
    {
      "from": "S1_Playing",
      "to": "S1_Playing",
      "event": "DELAY_CHANGED",
      "guard": "true",
      "actions": [
        "update delayVal textContent",
        "stop(); play()"
      ],
      "triggers": "#delay",
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S7_Editing",
      "event": "BAR_CLICK",
      "guard": "true",
      "actions": [
        "promptEditValue(idx) /* prompt user for integer */",
        "if valid: array[idx] = num; initialArray = array.slice(); rebuildSnapshots(); applySnapshot(0)"
      ],
      "triggers": "#vis .bar",
      "timeout": 0
    },
    {
      "from": "S7_Editing",
      "to": "S0_Idle",
      "event": "SNAPSHOTS_REBUILT",
      "guard": "true",
      "actions": [],
      "triggers": "#vis,#pseudocode",
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "USER_CLICK_RESET",
      "guard": "true",
      "actions": [
        "stop()",
        "initialArray = array.slice()",
        "rebuildSnapshots()",
        "applySnapshot(0)"
      ],
      "triggers": "#resetBtn",
      "timeout": 0
    },
    {
      "from": "S1_Playing",
      "to": "S0_Idle",
      "event": "USER_CLICK_RESET",
      "guard": "true",
      "actions": [
        "stop()",
        "initialArray = array.slice()",
        "rebuildSnapshots()",
        "applySnapshot(0)"
      ],
      "triggers": "#resetBtn",
      "timeout": 0
    },
    {
      "from": "S0_Idle",
      "to": "S8_Finished",
      "event": "PLAYBACK_COMPLETE",
      "guard": "current >= snapshots.length - 1",
      "actions": [
        "stop()",
        "applySnapshot(snapshots.length - 1)"
      ],
      "triggers": "#stepCounter,#maxStep",
      "timeout": 0
    }
  ],
  "components": [
    "#size",
    "#sizeVal",
    "#order",
    "#randomBtn",
    "#startBtn",
    "#pauseBtn",
    "#stepF",
    "#stepB",
    "#resetBtn",
    "#delay",
    "#delayVal",
    "#vis",
    "#vis .bar",
    ".bar",
    "#pseudocode",
    ".pseudo .line",
    "#stepCounter",
    "#maxStep",
    "#compCount",
    "#swapCount",
    "#message"
  ]
}