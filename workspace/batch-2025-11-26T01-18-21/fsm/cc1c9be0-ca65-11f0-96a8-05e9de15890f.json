{
  "meta": {
    "concept": "Queue",
    "topic": "Queue Visualization",
    "educational_goal": "Demonstrate FIFO queue operations (enqueue, dequeue, peek), implementations (circular buffer vs array), capacity effects, and auto-enqueue behavior",
    "expected_interactions": [
      "enqueue",
      "dequeue",
      "peek",
      "clear",
      "bulk_add",
      "auto_toggle",
      "change_impl",
      "change_capacity",
      "click_cell_remove"
    ]
  },
  "states": [
    {
      "id": "S0_Idle",
      "label": "idle",
      "type": "idle",
      "entry_actions": [
        "render()",
        "updateMetaLabels()"
      ],
      "exit_actions": []
    },
    {
      "id": "S1_Enqueuing",
      "label": "enqueuing",
      "type": "atomic",
      "entry_actions": [
        "enqueueValue(itemInput.value.trim())",
        "log('Enqueue triggered')"
      ],
      "exit_actions": [
        "itemInput.value = ''",
        "itemInput.focus()",
        "render()"
      ]
    },
    {
      "id": "S2_EnqueueErrorEmpty",
      "label": "enqueue_error_empty",
      "type": "atomic",
      "entry_actions": [
        "log('Cannot enqueue empty string','error')"
      ],
      "exit_actions": []
    },
    {
      "id": "S3_EnqueueErrorFull",
      "label": "enqueue_error_full",
      "type": "atomic",
      "entry_actions": [
        "log('Enqueue failed: queue is full (capacity ' + queue.capacity() + ')','error')"
      ],
      "exit_actions": []
    },
    {
      "id": "S4_Dequeuing",
      "label": "dequeuing",
      "type": "atomic",
      "entry_actions": [
        "dequeueValue()"
      ],
      "exit_actions": [
        "render()"
      ]
    },
    {
      "id": "S5_DequeueErrorEmpty",
      "label": "dequeue_error_empty",
      "type": "atomic",
      "entry_actions": [
        "log('Dequeue attempted on empty queue','error')"
      ],
      "exit_actions": []
    },
    {
      "id": "S6_Peeking",
      "label": "peeking",
      "type": "atomic",
      "entry_actions": [
        "peekValue()"
      ],
      "exit_actions": []
    },
    {
      "id": "S7_BulkAdding",
      "label": "bulk_adding",
      "type": "atomic",
      "entry_actions": [
        "bulkAdd(3)"
      ],
      "exit_actions": [
        "render()"
      ]
    },
    {
      "id": "S8_AutoRunning",
      "label": "auto_running",
      "type": "atomic",
      "entry_actions": [
        "toggleAuto()"
      ],
      "exit_actions": [
        "toggleAuto()"
      ]
    },
    {
      "id": "S9_SwitchingImpl",
      "label": "switching_impl",
      "type": "atomic",
      "entry_actions": [
        "implSelect change handler: switch impl variable, recreate queue instance, copy items from prevData",
        "log('Switched implementation to ' + impl,'warn')",
        "render()"
      ],
      "exit_actions": []
    },
    {
      "id": "S10_ChangingCapacity",
      "label": "changing_capacity",
      "type": "atomic",
      "entry_actions": [
        "capacityInput change handler: resize circular queue preserving existing items up to new capacity",
        "log('Circular capacity set to ' + capacityInput.value)",
        "render()"
      ],
      "exit_actions": []
    },
    {
      "id": "S11_Clearing",
      "label": "clearing",
      "type": "atomic",
      "entry_actions": [
        "queue.clear()",
        "log('Queue cleared','warn')",
        "render()"
      ],
      "exit_actions": []
    },
    {
      "id": "S12_ClickRemove",
      "label": "click_remove",
      "type": "atomic",
      "entry_actions": [
        "queue.removeAt(index)",
        "log('Removed element at index ' + index + ' via click','warn')",
        "render()"
      ],
      "exit_actions": []
    },
    {
      "id": "S13_Rendering",
      "label": "rendering",
      "type": "atomic",
      "entry_actions": [
        "render()"
      ],
      "exit_actions": []
    }
  ],
  "events": [
    {
      "id": "USER_CLICK_ENQUEUE",
      "event_type": "user_action",
      "description": "User clicks Enqueue button",
      "triggers": "#enqueueBtn"
    },
    {
      "id": "USER_KEY_ENTER_INPUT",
      "event_type": "user_action",
      "description": "User presses Enter while focused on item input",
      "triggers": "#itemInput"
    },
    {
      "id": "USER_CLICK_DEQUEUE",
      "event_type": "user_action",
      "description": "User clicks Dequeue button",
      "triggers": "#dequeueBtn"
    },
    {
      "id": "USER_CLICK_PEEK",
      "event_type": "user_action",
      "description": "User clicks Peek button",
      "triggers": "#peekBtn"
    },
    {
      "id": "USER_CLICK_CLEAR",
      "event_type": "user_action",
      "description": "User clicks Clear button",
      "triggers": "#clearBtn"
    },
    {
      "id": "USER_CLICK_BULK_ADD",
      "event_type": "user_action",
      "description": "User clicks Bulk add 3 button",
      "triggers": "#bulkBtn"
    },
    {
      "id": "USER_CLICK_AUTO_TOGGLE",
      "event_type": "user_action",
      "description": "User clicks Auto Enqueue Start/Stop button",
      "triggers": "#autoToggle"
    },
    {
      "id": "USER_CHANGE_RATE",
      "event_type": "user_action",
      "description": "User adjusts auto-enqueue rate slider",
      "triggers": "#rate"
    },
    {
      "id": "USER_CHANGE_IMPL",
      "event_type": "user_action",
      "description": "User changes implementation select (circular/array)",
      "triggers": "#implSelect"
    },
    {
      "id": "USER_CHANGE_CAPACITY",
      "event_type": "user_action",
      "description": "User changes capacity numeric input",
      "triggers": "#capacity"
    },
    {
      "id": "USER_CLICK_CELL_REMOVE",
      "event_type": "user_action",
      "description": "User clicks a rendered cell to remove it (array impl only)",
      "triggers": "#visual .cell"
    },
    {
      "id": "SYSTEM_ENQUEUE_COMPLETE",
      "event_type": "system_event",
      "description": "Enqueue operation completed (item added)",
      "triggers": ""
    },
    {
      "id": "SYSTEM_ENQUEUE_FAILED_FULL",
      "event_type": "system_event",
      "description": "Enqueue failed because circular queue is full",
      "triggers": ""
    },
    {
      "id": "SYSTEM_ENQUEUE_FAILED_EMPTY_INPUT",
      "event_type": "system_event",
      "description": "Enqueue prevented due to empty input",
      "triggers": ""
    },
    {
      "id": "SYSTEM_DEQUEUE_COMPLETE",
      "event_type": "system_event",
      "description": "Dequeue operation completed (item removed)",
      "triggers": ""
    },
    {
      "id": "SYSTEM_DEQUEUE_EMPTY",
      "event_type": "system_event",
      "description": "Dequeue attempted on empty queue",
      "triggers": ""
    },
    {
      "id": "SYSTEM_AUTO_TICK",
      "event_type": "system_event",
      "description": "Auto-enqueue timer ticked and attempted an enqueue",
      "triggers": ""
    }
  ],
  "transitions": [
    {
      "from": "S0_Idle",
      "to": "S1_Enqueuing",
      "event": "USER_CLICK_ENQUEUE",
      "guard": "inputNotEmpty",
      "actions": [
        "enqueueValue(itemInput.value.trim())",
        "render()"
      ],
      "triggers": "#enqueueBtn",
      "timeout": 2000
    },
    {
      "from": "S0_Idle",
      "to": "S1_Enqueuing",
      "event": "USER_KEY_ENTER_INPUT",
      "guard": "inputNotEmpty",
      "actions": [
        "enqueueValue(itemInput.value.trim())",
        "render()"
      ],
      "triggers": "#itemInput",
      "timeout": 2000
    },
    {
      "from": "S0_Idle",
      "to": "S2_EnqueueErrorEmpty",
      "event": "USER_CLICK_ENQUEUE",
      "guard": "inputEmpty",
      "actions": [
        "log('Cannot enqueue empty string','error')"
      ],
      "triggers": "#enqueueBtn,#itemInput",
      "timeout": 500
    },
    {
      "from": "S1_Enqueuing",
      "to": "S3_EnqueueErrorFull",
      "event": "SYSTEM_ENQUEUE_FAILED_FULL",
      "guard": "implIsCircular && queue.count === queue.capacity()",
      "actions": [
        "log('Enqueue failed: queue is full (capacity ' + queue.capacity() + ')','error')"
      ],
      "triggers": "",
      "timeout": 1000
    },
    {
      "from": "S1_Enqueuing",
      "to": "S13_Rendering",
      "event": "SYSTEM_ENQUEUE_COMPLETE",
      "guard": "true",
      "actions": [
        "render()",
        "itemInput.value = ''",
        "itemInput.focus()"
      ],
      "triggers": "",
      "timeout": 500
    },
    {
      "from": "S13_Rendering",
      "to": "S0_Idle",
      "event": "RENDER_COMPLETE",
      "guard": "true",
      "actions": [
        "updateMetaLabels()"
      ],
      "triggers": "#visual",
      "timeout": 300
    },
    {
      "from": "S0_Idle",
      "to": "S4_Dequeuing",
      "event": "USER_CLICK_DEQUEUE",
      "guard": "true",
      "actions": [
        "dequeueValue()",
        "render()"
      ],
      "triggers": "#dequeueBtn",
      "timeout": 1500
    },
    {
      "from": "S4_Dequeuing",
      "to": "S5_DequeueErrorEmpty",
      "event": "SYSTEM_DEQUEUE_EMPTY",
      "guard": "queue.size() === 0",
      "actions": [
        "log('Dequeue attempted on empty queue','error')"
      ],
      "triggers": "",
      "timeout": 500
    },
    {
      "from": "S4_Dequeuing",
      "to": "S13_Rendering",
      "event": "SYSTEM_DEQUEUE_COMPLETE",
      "guard": "true",
      "actions": [
        "render()"
      ],
      "triggers": "",
      "timeout": 500
    },
    {
      "from": "S0_Idle",
      "to": "S6_Peeking",
      "event": "USER_CLICK_PEEK",
      "guard": "true",
      "actions": [
        "peekValue()"
      ],
      "triggers": "#peekBtn",
      "timeout": 500
    },
    {
      "from": "S6_Peeking",
      "to": "S0_Idle",
      "event": "PEEK_COMPLETE",
      "guard": "true",
      "actions": [],
      "triggers": "",
      "timeout": 200
    },
    {
      "from": "S0_Idle",
      "to": "S7_BulkAdding",
      "event": "USER_CLICK_BULK_ADD",
      "guard": "true",
      "actions": [
        "bulkAdd(3)",
        "render()"
      ],
      "triggers": "#bulkBtn",
      "timeout": 3000
    },
    {
      "from": "S7_BulkAdding",
      "to": "S0_Idle",
      "event": "BULK_ADD_COMPLETE",
      "guard": "true",
      "actions": [
        "render()"
      ],
      "triggers": "",
      "timeout": 500
    },
    {
      "from": "S0_Idle",
      "to": "S8_AutoRunning",
      "event": "USER_CLICK_AUTO_TOGGLE",
      "guard": "autoInterval === null",
      "actions": [
        "toggleAuto()",
        "log('Auto enqueue started (rate ' + rateSlider.value + ' ms)')"
      ],
      "triggers": "#autoToggle",
      "timeout": 500
    },
    {
      "from": "S8_AutoRunning",
      "to": "S0_Idle",
      "event": "USER_CLICK_AUTO_TOGGLE",
      "guard": "autoInterval !== null",
      "actions": [
        "toggleAuto()",
        "log('Auto enqueue stopped')"
      ],
      "triggers": "#autoToggle",
      "timeout": 500
    },
    {
      "from": "S8_AutoRunning",
      "to": "S8_AutoRunning",
      "event": "SYSTEM_AUTO_TICK",
      "guard": "true",
      "actions": [
        "attempt auto enqueue (enqueue random 'aXXX')",
        "render()"
      ],
      "triggers": "",
      "timeout": 0
    },
    {
      "from": "S8_AutoRunning",
      "to": "S3_EnqueueErrorFull",
      "event": "SYSTEM_ENQUEUE_FAILED_FULL",
      "guard": "impl === 'circular' && queue.count === queue.capacity()",
      "actions": [
        "log('Auto enqueue: stopped because queue is full','warn')",
        "toggleAuto()"
      ],
      "triggers": "",
      "timeout": 500
    },
    {
      "from": "S0_Idle",
      "to": "S9_SwitchingImpl",
      "event": "USER_CHANGE_IMPL",
      "guard": "true",
      "actions": [
        "impl = implSelect.value",
        "recreate queue instance and copy previous items",
        "log('Switched implementation to ' + impl,'warn')",
        "render()"
      ],
      "triggers": "#implSelect",
      "timeout": 1000
    },
    {
      "from": "S0_Idle",
      "to": "S10_ChangingCapacity",
      "event": "USER_CHANGE_CAPACITY",
      "guard": "impl === 'circular'",
      "actions": [
        "resize circular queue preserving items",
        "log('Circular capacity set to ' + capacityInput.value)",
        "render()"
      ],
      "triggers": "#capacity",
      "timeout": 1000
    },
    {
      "from": "S0_Idle",
      "to": "S11_Clearing",
      "event": "USER_CLICK_CLEAR",
      "guard": "true",
      "actions": [
        "queue.clear()",
        "log('Queue cleared','warn')",
        "render()"
      ],
      "triggers": "#clearBtn",
      "timeout": 500
    },
    {
      "from": "S0_Idle",
      "to": "S12_ClickRemove",
      "event": "USER_CLICK_CELL_REMOVE",
      "guard": "impl === 'array'",
      "actions": [
        "queue.removeAt(index)",
        "log('Removed element at index ' + index + ' via click','warn')",
        "render()"
      ],
      "triggers": "#visual .cell",
      "timeout": 500
    },
    {
      "from": "S12_ClickRemove",
      "to": "S0_Idle",
      "event": "CLICK_REMOVE_COMPLETE",
      "guard": "true",
      "actions": [
        "render()"
      ],
      "triggers": "",
      "timeout": 300
    }
  ],
  "components": [
    "#enqueueBtn",
    "#dequeueBtn",
    "#peekBtn",
    "#clearBtn",
    "#bulkBtn",
    "#autoToggle",
    "#itemInput",
    "#capacity",
    "#rate",
    "#implSelect",
    "#visual",
    "#visualPanel",
    "#log",
    "#size",
    "#capacityDisplay",
    "#frontIdx",
    "#rearIdx",
    "#codeArea",
    "#implBadge",
    ".cell",
    ".cell.empty",
    ".pointer",
    ".pointer.rear",
    ".anim",
    ".idx",
    ".panel",
    ".controls",
    ".small-muted",
    ".badge",
    ".log",
    ".caption",
    ".row",
    "body",
    "header",
    "select#implSelect",
    "input#capacity",
    "input#itemInput",
    "input#rate",
    "button#enqueueBtn",
    "button#dequeueBtn",
    "button#peekBtn",
    "button#clearBtn",
    "button#bulkBtn",
    "button#autoToggle",
    "#visual .cell"
  ]
}