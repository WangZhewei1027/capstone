{
  "meta": {
    "concept": "DepthFirstSearch",
    "topic": "Depth-First Search (DFS) Visualizer",
    "educational_goal": "Demonstrate DFS traversal (recursive and iterative), node discovery/finish times, stack behavior, and edge classification",
    "expected_interactions": [
      "randomize",
      "edit_graph",
      "drag_node",
      "toggle_edge",
      "run",
      "step",
      "play",
      "pause",
      "reset",
      "change_mode",
      "toggle_directed",
      "clear_edges",
      "clear_nodes",
      "show_explanation",
      "keyboard_step"
    ]
  },
  "states": [
    {
      "id": "S0_Idle",
      "label": "Idle",
      "type": "idle",
      "entry_actions": [
        "render()",
        "updateInfoUI()"
      ],
      "exit_actions": []
    },
    {
      "id": "S1_EditingGraph",
      "label": "EditingGraph",
      "type": "atomic",
      "entry_actions": [
        "render()",
        "rebuildStartSelect()"
      ],
      "exit_actions": [
        "resetAnim()"
      ]
    },
    {
      "id": "S2_DraggingNode",
      "label": "DraggingNode",
      "type": "atomic",
      "entry_actions": [
        "startDrag()",
        "render()"
      ],
      "exit_actions": [
        "endDrag()",
        "render()"
      ]
    },
    {
      "id": "S3_EdgeSelected",
      "label": "EdgeSelected",
      "type": "atomic",
      "entry_actions": [
        "highlightNode(selectedForEdge, true)"
      ],
      "exit_actions": [
        "highlightNode(selectedForEdge, false)",
        "selectedForEdge = null"
      ]
    },
    {
      "id": "S4_Running",
      "label": "RunningGenerator",
      "type": "compound",
      "entry_actions": [
        "animGen = dfsRecursive(...) || dfsIterative(...)",
        "stepOnce()",
        "updateUIFromState()"
      ],
      "exit_actions": [
        "animGen = null",
        "clearInterval(automator)"
      ]
    },
    {
      "id": "S5_Playing",
      "label": "Playing",
      "type": "atomic",
      "entry_actions": [
        "automator = setInterval(() => stepOnce(), +speedInput.value)"
      ],
      "exit_actions": [
        "clearInterval(automator)",
        "automator = null"
      ]
    },
    {
      "id": "S6_Paused",
      "label": "Paused",
      "type": "atomic",
      "entry_actions": [
        "clearInterval(automator)",
        "automator = null"
      ],
      "exit_actions": []
    },
    {
      "id": "S7_Stepping",
      "label": "SteppingOnce",
      "type": "atomic",
      "entry_actions": [
        "stepOnce()",
        "updateUIFromState()"
      ],
      "exit_actions": []
    },
    {
      "id": "S8_ShowingExplanation",
      "label": "ShowingExplanation",
      "type": "atomic",
      "entry_actions": [
        "explainText.style.display = 'block'"
      ],
      "exit_actions": [
        "explainText.style.display = 'none'"
      ]
    },
    {
      "id": "S9_Resetting",
      "label": "Resetting",
      "type": "atomic",
      "entry_actions": [
        "resetAnim()",
        "render()"
      ],
      "exit_actions": []
    },
    {
      "id": "S10_ErrorAlert",
      "label": "ErrorAlert",
      "type": "atomic",
      "entry_actions": [
        "alert('No nodes to run DFS on.')"
      ],
      "exit_actions": []
    }
  ],
  "events": [
    {
      "id": "USER_CLICK_RANDOMIZE",
      "event_type": "user_action",
      "description": "User clicks the Random graph button (#randomize)"
    },
    {
      "id": "USER_CLICK_RUN",
      "event_type": "user_action",
      "description": "User clicks the Run button (#run)"
    },
    {
      "id": "USER_CLICK_STEP",
      "event_type": "user_action",
      "description": "User clicks the Step button (#stepBtn) or presses Space"
    },
    {
      "id": "USER_CLICK_PLAY",
      "event_type": "user_action",
      "description": "User clicks the Play button (#playBtn)"
    },
    {
      "id": "USER_CLICK_PAUSE",
      "event_type": "user_action",
      "description": "User clicks the Pause button (#pauseBtn)"
    },
    {
      "id": "USER_CLICK_RESET",
      "event_type": "user_action",
      "description": "User clicks the Reset button (#resetBtn)"
    },
    {
      "id": "USER_CHANGE_DIRECTED",
      "event_type": "user_action",
      "description": "User changes the Directed select (#directed)"
    },
    {
      "id": "USER_CLICK_CLEAR_EDGES",
      "event_type": "user_action",
      "description": "User clicks Clear Edges (#clearEdges)"
    },
    {
      "id": "USER_CLICK_CLEAR_NODES",
      "event_type": "user_action",
      "description": "User clicks Clear Nodes (#clearNodes)"
    },
    {
      "id": "USER_CLICK_EXPLAIN",
      "event_type": "user_action",
      "description": "User clicks Show explanation (#explainBtn)"
    },
    {
      "id": "USER_MOUSEDOWN_NODE",
      "event_type": "user_action",
      "description": "User mousedown on a node element (svg g[data-node]) — used for drag or shift+click edge selection"
    },
    {
      "id": "USER_DBLCLICK_NODE",
      "event_type": "user_action",
      "description": "User double-clicks a node (svg g[data-node]) to remove it"
    },
    {
      "id": "USER_MOUSEUP_BODY",
      "event_type": "user_action",
      "description": "User mouseup anywhere (document.onmouseup) — ends drag"
    },
    {
      "id": "ANIM_STEP_COMPLETE",
      "event_type": "system_event",
      "description": "A generator yielded an event and UI updated (stepOnce processed)"
    },
    {
      "id": "ANIM_COMPLETE",
      "event_type": "system_event",
      "description": "Generator finished (type:'done')"
    },
    {
      "id": "AUTOMATOR_TICK",
      "event_type": "system_event",
      "description": "Automator interval fired to trigger step (setInterval)"
    },
    {
      "id": "KEYBOARD_STEP",
      "event_type": "user_action",
      "description": "User pressed Space (window keydown) mapped to Step (#stepBtn.click)"
    }
  ],
  "transitions": [
    {
      "from": "S0_Idle",
      "to": "S1_EditingGraph",
      "event": "USER_CLICK_RANDOMIZE",
      "guard": "true",
      "actions": [
        "createRandomGraph(+nodeCount.value, +density.value)",
        "resetAnim()",
        "render()"
      ],
      "expected_observables": [
        "dom:#randomize:click",
        "dom:svg g[data-node]"
      ],
      "triggers": "#randomize",
      "timeout": 2000
    },
    {
      "from": "S0_Idle",
      "to": "S4_Running",
      "event": "USER_CLICK_RUN",
      "guard": "nodes.length > 0",
      "actions": [
        "runDFS(+startNode.value)",
        "render()"
      ],
      "expected_observables": [
        "dom:animGen != null",
        "dom:#run:click"
      ],
      "triggers": "#run",
      "timeout": 500
    },
    {
      "from": "S0_Idle",
      "to": "S10_ErrorAlert",
      "event": "USER_CLICK_RUN",
      "guard": "nodes.length === 0",
      "actions": [
        "alert('No nodes to run DFS on.')"
      ],
      "expected_observables": [
        "dom:alert_shown"
      ],
      "triggers": "#run",
      "timeout": 100
    },
    {
      "from": "S0_Idle",
      "to": "S7_Stepping",
      "event": "USER_CLICK_STEP",
      "guard": "nodes.length > 0 && !animGen",
      "actions": [
        "runDFS(+startNode.value)",
        "stepOnce()"
      ],
      "expected_observables": [
        "dom:animGen != null",
        "dom:#stepBtn:click"
      ],
      "triggers": "#stepBtn, body",
      "timeout": 500
    },
    {
      "from": "S4_Running",
      "to": "S7_Stepping",
      "event": "USER_CLICK_STEP",
      "guard": "animGen != null",
      "actions": [
        "stepOnce()"
      ],
      "expected_observables": [
        "dom:animGen.next called",
        "dom:#stepBtn:click"
      ],
      "triggers": "#stepBtn",
      "timeout": 200
    },
    {
      "from": "S0_Idle",
      "to": "S5_Playing",
      "event": "USER_CLICK_PLAY",
      "guard": "nodes.length > 0",
      "actions": [
        "if(!animGen) runDFS(+startNode.value)",
        "automator = setInterval(() => { if(animGen) stepOnce(); else { clearInterval(automator); automator=null } }, +speedInput.value)"
      ],
      "expected_observables": [
        "dom:#playBtn:click",
        "dom:setInterval_running"
      ],
      "triggers": "#playBtn",
      "timeout": 500
    },
    {
      "from": "S5_Playing",
      "to": "S6_Paused",
      "event": "USER_CLICK_PAUSE",
      "guard": "automator != null",
      "actions": [
        "clearInterval(automator)",
        "automator = null"
      ],
      "expected_observables": [
        "dom:#pauseBtn:click",
        "dom:automator_cleared"
      ],
      "triggers": "#pauseBtn",
      "timeout": 200
    },
    {
      "from": "S5_Playing",
      "to": "S0_Idle",
      "event": "ANIM_COMPLETE",
      "guard": "animGen finished",
      "actions": [
        "clearInterval(automator)",
        "automator = null",
        "animGen = null",
        "updateUIFromState()"
      ],
      "expected_observables": [
        "dom:animGen.done",
        "dom:svg g[data-node] text.timeLabel"
      ],
      "triggers": "#svg",
      "timeout": 1000
    },
    {
      "from": "S4_Running",
      "to": "S0_Idle",
      "event": "ANIM_COMPLETE",
      "guard": "animGen finished",
      "actions": [
        "animGen = null",
        "updateUIFromState()"
      ],
      "expected_observables": [
        "dom:timesList updated",
        "dom:edgeClasses updated"
      ],
      "triggers": "#svg",
      "timeout": 500
    },
    {
      "from": "S0_Idle",
      "to": "S2_DraggingNode",
      "event": "USER_MOUSEDOWN_NODE",
      "guard": "ev.shiftKey === false",
      "actions": [
        "dragging = nodeId",
        "dragOffset = computeDragOffset(ev)",
        "render()"
      ],
      "expected_observables": [
        "dom:svg g[data-node] mousedown",
        "dom:document.onmousemove active"
      ],
      "triggers": "svg g[data-node]",
      "timeout": 200
    },
    {
      "from": "S2_DraggingNode",
      "to": "S0_Idle",
      "event": "USER_MOUSEUP_BODY",
      "guard": "true",
      "actions": [
        "dragging = null",
        "render()"
      ],
      "expected_observables": [
        "dom:document.onmouseup",
        "dom:svg node positions updated"
      ],
      "triggers": "body",
      "timeout": 200
    },
    {
      "from": "S0_Idle",
      "to": "S3_EdgeSelected",
      "event": "USER_MOUSEDOWN_NODE",
      "guard": "ev.shiftKey === true && selectedForEdge === null",
      "actions": [
        "selectedForEdge = nodeId",
        "highlightNode(nodeId, true)"
      ],
      "expected_observables": [
        "dom:selectedForEdge set",
        "dom:node stroke changed"
      ],
      "triggers": "svg g[data-node]",
      "timeout": 200
    },
    {
      "from": "S3_EdgeSelected",
      "to": "S0_Idle",
      "event": "USER_MOUSEDOWN_NODE",
      "guard": "ev.shiftKey === true && selectedForEdge === clickedNode",
      "actions": [
        "highlightNode(selectedForEdge, false)",
        "selectedForEdge = null"
      ],
      "expected_observables": [
        "dom:selectedForEdge cleared",
        "dom:node stroke restored"
      ],
      "triggers": "svg g[data-node]",
      "timeout": 200
    },
    {
      "from": "S3_EdgeSelected",
      "to": "S1_EditingGraph",
      "event": "USER_MOUSEDOWN_NODE",
      "guard": "ev.shiftKey === true && selectedForEdge !== clickedNode",
      "actions": [
        "toggleEdge(selectedForEdge, clickedNode)",
        "highlightNode(selectedForEdge, false)",
        "selectedForEdge = null",
        "render()"
      ],
      "expected_observables": [
        "dom:edges changed",
        "dom:g[data-edge-idx] updated"
      ],
      "triggers": "svg g[data-node]",
      "timeout": 400
    },
    {
      "from": "S0_Idle",
      "to": "S1_EditingGraph",
      "event": "USER_DBLCLICK_NODE",
      "guard": "true",
      "actions": [
        "remove node and incident edges (reindex nodes)",
        "rebuildStartSelect()",
        "resetAnim()",
        "render()"
      ],
      "expected_observables": [
        "dom:svg g[data-node] removed",
        "dom:#startNode options updated"
      ],
      "triggers": "svg g[data-node]",
      "timeout": 800
    },
    {
      "from": "S0_Idle",
      "to": "S9_Resetting",
      "event": "USER_CLICK_RESET",
      "guard": "true",
      "actions": [
        "resetAnim()",
        "render()"
      ],
      "expected_observables": [
        "dom:#resetBtn:click",
        "dom:anim state cleared"
      ],
      "triggers": "#resetBtn",
      "timeout": 300
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "USER_CHANGE_DIRECTED",
      "guard": "true",
      "actions": [
        "if(isDirected()) edges = edges.map(e=>({...e,directed:true})); else collapse to undirected set",
        "render()",
        "resetAnim()"
      ],
      "expected_observables": [
        "dom:#directed:change",
        "dom:edges updated"
      ],
      "triggers": "#directed",
      "timeout": 500
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "USER_CLICK_CLEAR_EDGES",
      "guard": "true",
      "actions": [
        "clearEdges()",
        "resetAnim()",
        "render()"
      ],
      "expected_observables": [
        "dom:#clearEdges:click",
        "dom:svg edges removed"
      ],
      "triggers": "#clearEdges",
      "timeout": 300
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "USER_CLICK_CLEAR_NODES",
      "guard": "true",
      "actions": [
        "removeAllNodes()",
        "rebuildStartSelect()",
        "resetAnim()",
        "render()"
      ],
      "expected_observables": [
        "dom:#clearNodes:click",
        "dom:svg nodes removed"
      ],
      "triggers": "#clearNodes",
      "timeout": 500
    },
    {
      "from": "S0_Idle",
      "to": "S8_ShowingExplanation",
      "event": "USER_CLICK_EXPLAIN",
      "guard": "explainText.style.display === 'none'",
      "actions": [
        "explainText.style.display = 'block'"
      ],
      "expected_observables": [
        "dom:#explainBtn:click",
        "dom:#explainText displayed"
      ],
      "triggers": "#explainBtn",
      "timeout": 200
    },
    {
      "from": "S8_ShowingExplanation",
      "to": "S0_Idle",
      "event": "USER_CLICK_EXPLAIN",
      "guard": "explainText.style.display !== 'none'",
      "actions": [
        "explainText.style.display = 'none'"
      ],
      "expected_observables": [
        "dom:#explainBtn:click",
        "dom:#explainText hidden"
      ],
      "triggers": "#explainBtn",
      "timeout": 200
    },
    {
      "from": "S4_Running",
      "to": "S4_Running",
      "event": "ANIM_STEP_COMPLETE",
      "guard": "animGen != null",
      "actions": [
        "handleEvent(generatorYield)",
        "renderColorState()",
        "renderEdgeClasses()",
        "updateUIFromState()"
      ],
      "expected_observables": [
        "dom:node fills updated",
        "dom:edge colors updated",
        "dom:stackView updated"
      ],
      "triggers": "#svg g[data-node], g[data-edge-idx]",
      "timeout": 1200
    },
    {
      "from": "S4_Running",
      "to": "S0_Idle",
      "event": "ANIM_COMPLETE",
      "guard": "true",
      "actions": [
        "animGen = null",
        "updateUIFromState()",
        "render()"
      ],
      "expected_observables": [
        "dom:timesList updated",
        "dom:edgeClasses updated"
      ],
      "triggers": "#svg",
      "timeout": 1000
    },
    {
      "from": "S6_Paused",
      "to": "S5_Playing",
      "event": "USER_CLICK_PLAY",
      "guard": "animGen != null && automator == null",
      "actions": [
        "automator = setInterval(() => { if(animGen) stepOnce(); else { clearInterval(automator); automator=null } }, +speedInput.value)"
      ],
      "expected_observables": [
        "dom:#playBtn:click",
        "dom:setInterval_running"
      ],
      "triggers": "#playBtn",
      "timeout": 300
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "KEYBOARD_STEP",
      "guard": "true",
      "actions": [
        "document.querySelector('#stepBtn').click()"
      ],
      "expected_observables": [
        "dom:keydown space",
        "dom:#stepBtn:click"
      ],
      "triggers": "body",
      "timeout": 200
    }
  ],
  "components": [
    "#mode",
    "#directed",
    "#nodeCount",
    "#density",
    "#randomize",
    "#startNode",
    "#run",
    "#stepBtn",
    "#playBtn",
    "#pauseBtn",
    "#resetBtn",
    "#speed",
    "#speedLabel",
    "#canvasWrap",
    "#svg",
    "svg g[data-node]",
    "svg g[data-node] circle",
    "svg g[data-node] text",
    "g[data-edge-idx]",
    "g[data-edge-idx] line",
    "#timesList",
    "#adjList",
    "#edgeClasses",
    "#stackView",
    "#timeView",
    "#clearEdges",
    "#clearNodes",
    "#explainBtn",
    "#explainText",
    "body"
  ]
}