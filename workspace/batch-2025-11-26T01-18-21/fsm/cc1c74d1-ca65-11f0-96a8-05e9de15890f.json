{
  "meta": {
    "concept": "Stack",
    "topic": "Stack Visualizer — LIFO Data Structure",
    "educational_goal": "Demonstrate push, pop, peek, capacity management, and animations of a stack (LIFO).",
    "expected_interactions": [
      "push",
      "pop",
      "peek",
      "clear",
      "change_capacity",
      "toggle_animation",
      "adjust_speed",
      "demo_push_sequence",
      "demo_pop_sequence",
      "keyboard_shortcuts"
    ]
  },
  "states": [
    {
      "id": "S0_Idle",
      "label": "idle",
      "type": "idle",
      "entry_actions": [
        "render()",
        "updateMetaChips()",
        "enableControls()"
      ],
      "exit_actions": []
    },
    {
      "id": "S1_Pushing",
      "label": "pushing",
      "type": "atomic",
      "entry_actions": [
        "captureInputValue()",
        "log(\"Push <value>\", 'ok')",
        "stack.push(value)",
        "render()",
        "highlightTop('adding')"
      ],
      "exit_actions": [
        "clearInput()",
        "focusInput()"
      ]
    },
    {
      "id": "S2_Popping",
      "label": "popping",
      "type": "atomic",
      "entry_actions": [
        "log(\"Pop -> <value>\", 'ok')",
        "highlightTop('removing')",
        "stack.pop()",
        "render()"
      ],
      "exit_actions": []
    },
    {
      "id": "S3_Peeking",
      "label": "peeking",
      "type": "atomic",
      "entry_actions": [
        "log(\"Peek -> <value>\", 'ok')",
        "highlightTop('highlight')"
      ],
      "exit_actions": []
    },
    {
      "id": "S4_Overflow",
      "label": "overflow",
      "type": "atomic",
      "entry_actions": [
        "log(\"Push <value> — Overflow (capacity <capacity>)\", 'err')",
        "flashSlot(null,'err')"
      ],
      "exit_actions": []
    },
    {
      "id": "S5_Underflow",
      "label": "underflow",
      "type": "atomic",
      "entry_actions": [
        "log(\"Pop — Underflow (stack is empty)\", 'err')",
        "flashSlot(null,'err')"
      ],
      "exit_actions": []
    },
    {
      "id": "S6_PushConfirmEmpty",
      "label": "push_confirm_empty",
      "type": "atomic",
      "entry_actions": [
        "openConfirmDialog('Push an empty value?')"
      ],
      "exit_actions": []
    },
    {
      "id": "S7_ClearingConfirm",
      "label": "clearing_confirm",
      "type": "atomic",
      "entry_actions": [
        "openConfirmDialog('Clear the entire stack?')"
      ],
      "exit_actions": []
    },
    {
      "id": "S8_Cleared",
      "label": "cleared",
      "type": "atomic",
      "entry_actions": [
        "stack = []",
        "render()",
        "log('Clear — stack emptied', 'ok')"
      ],
      "exit_actions": []
    },
    {
      "id": "S9_CapacityChanging",
      "label": "capacity_changing",
      "type": "atomic",
      "entry_actions": [
        "readCapacityInput()",
        "setCapacity(<n>)",
        "if (stack.length > capacity) { stack = stack.slice(0,capacity); log('Capacity decreased to <capacity>; top elements dropped','err') } else { log('Capacity set to <capacity>','ok') }",
        "render()"
      ],
      "exit_actions": []
    },
    {
      "id": "S10_DemoRunning",
      "label": "demo_running",
      "type": "compound",
      "entry_actions": [
        "disableControls()",
        "runDemoSequence()"
      ],
      "exit_actions": [
        "enableControls()"
      ]
    }
  ],
  "events": [
    {
      "id": "BTN_PUSH_CLICK",
      "event_type": "user_action",
      "description": "User clicks the Push button",
      "triggers": "#btnPush"
    },
    {
      "id": "BTN_POP_CLICK",
      "event_type": "user_action",
      "description": "User clicks the Pop button",
      "triggers": "#btnPop"
    },
    {
      "id": "BTN_PEEK_CLICK",
      "event_type": "user_action",
      "description": "User clicks the Peek button",
      "triggers": "#btnPeek"
    },
    {
      "id": "BTN_CLEAR_CLICK",
      "event_type": "user_action",
      "description": "User clicks the Clear button",
      "triggers": "#btnClear"
    },
    {
      "id": "DEMO_PUSH_CLICK",
      "event_type": "user_action",
      "description": "User clicks Auto Push Sequence demo",
      "triggers": "#demoPush"
    },
    {
      "id": "DEMO_POP_CLICK",
      "event_type": "user_action",
      "description": "User clicks Auto Pop Sequence demo",
      "triggers": "#demoPop"
    },
    {
      "id": "CAPACITY_CHANGE",
      "event_type": "user_action",
      "description": "User changes capacity input",
      "triggers": "#capacity"
    },
    {
      "id": "ANIMATE_TOGGLE",
      "event_type": "user_action",
      "description": "User toggles animation on/off",
      "triggers": "#animate"
    },
    {
      "id": "SPEED_ADJUST",
      "event_type": "user_action",
      "description": "User adjusts animation speed",
      "triggers": "#speed"
    },
    {
      "id": "INPUT_ENTER_KEY",
      "event_type": "user_action",
      "description": "User presses Enter while focused on value input (triggers push)",
      "triggers": "#value, document"
    },
    {
      "id": "KEYBOARD_POP_SHORTCUT",
      "event_type": "user_action",
      "description": "User presses Ctrl+P (pop)",
      "triggers": "document"
    },
    {
      "id": "KEYBOARD_PEEK_SHORTCUT",
      "event_type": "user_action",
      "description": "User presses Ctrl+K (peek)",
      "triggers": "document"
    },
    {
      "id": "SYSTEM_PUSH_COMPLETE",
      "event_type": "system_event",
      "description": "Push operation finished (render + animation complete)",
      "triggers": "#stackContainer .slot, #topIndicator"
    },
    {
      "id": "SYSTEM_POP_COMPLETE",
      "event_type": "system_event",
      "description": "Pop operation finished (render complete)",
      "triggers": "#stackContainer .slot, #size"
    },
    {
      "id": "SYSTEM_PEAK_COMPLETE",
      "event_type": "system_event",
      "description": "Peek highlight finished",
      "triggers": "#stackContainer .slot"
    },
    {
      "id": "USER_CONFIRMED",
      "event_type": "user_action",
      "description": "User confirmed a browser confirm() dialog (OK)",
      "triggers": "window.confirm (synchronous native dialog)"
    },
    {
      "id": "USER_CANCELLED",
      "event_type": "user_action",
      "description": "User cancelled a browser confirm() dialog (Cancel)",
      "triggers": "window.confirm (synchronous native dialog)"
    },
    {
      "id": "DEMO_SEQUENCE_COMPLETE",
      "event_type": "system_event",
      "description": "Demo auto sequence finished or reached capacity",
      "triggers": "#demoPush, #demoPop, #stackContainer"
    }
  ],
  "transitions": [
    {
      "from": "S0_Idle",
      "to": "S1_Pushing",
      "event": "BTN_PUSH_CLICK",
      "guard": "valueNotEmptyOrConfirmed",
      "actions": [
        "captureInputValue()",
        "disableControls()",
        "pushValue(<value>)"
      ],
      "expected_observables": [
        "dom:#btnPush:click",
        "dom:#value:valueRead",
        "dom:#stackContainer .slot.filled"
      ],
      "timeout": 4000
    },
    {
      "from": "S0_Idle",
      "to": "S6_PushConfirmEmpty",
      "event": "BTN_PUSH_CLICK",
      "guard": "valueIsEmpty",
      "actions": [
        "openConfirmDialog('Push an empty value?')"
      ],
      "expected_observables": [
        "dom:#btnPush:click",
        "dom:window.confirm"
      ],
      "timeout": 2000
    },
    {
      "from": "S6_PushConfirmEmpty",
      "to": "S1_Pushing",
      "event": "USER_CONFIRMED",
      "guard": "true",
      "actions": [
        "captureInputValue()",
        "pushValue(<value>)"
      ],
      "expected_observables": [
        "dom:window.confirm:ok",
        "dom:#stackContainer .slot.filled"
      ],
      "timeout": 4000
    },
    {
      "from": "S6_PushConfirmEmpty",
      "to": "S0_Idle",
      "event": "USER_CANCELLED",
      "guard": "true",
      "actions": [
        "cancelPush()",
        "focusInput()"
      ],
      "expected_observables": [
        "dom:window.confirm:cancel"
      ],
      "timeout": 1000
    },
    {
      "from": "S1_Pushing",
      "to": "S4_Overflow",
      "event": "BTN_PUSH_CLICK",
      "guard": "stackLengthAtCapacity",
      "actions": [
        "logOverflow(<value>)",
        "flashSlot(null,'err')"
      ],
      "expected_observables": [
        "dom:#stackContainer:boxShadowFlash",
        "dom:#log p.err"
      ],
      "timeout": 1000
    },
    {
      "from": "S1_Pushing",
      "to": "S0_Idle",
      "event": "SYSTEM_PUSH_COMPLETE",
      "guard": "true",
      "actions": [
        "enableControls()",
        "clearInput()",
        "focusInput()"
      ],
      "expected_observables": [
        "dom:#stackContainer .slot:not(.adding)",
        "dom:#size"
      ],
      "timeout": 2000
    },
    {
      "from": "S0_Idle",
      "to": "S2_Popping",
      "event": "BTN_POP_CLICK",
      "guard": "stackNotEmpty",
      "actions": [
        "disableControls()",
        "popValue()"
      ],
      "expected_observables": [
        "dom:#btnPop:click",
        "dom:#stackContainer .slot.removing"
      ],
      "timeout": 3000
    },
    {
      "from": "S0_Idle",
      "to": "S5_Underflow",
      "event": "BTN_POP_CLICK",
      "guard": "stackEmpty",
      "actions": [
        "logUnderflow('Pop — Underflow (stack is empty)')",
        "flashSlot(null,'err')"
      ],
      "expected_observables": [
        "dom:#log p.err",
        "dom:#stackContainer:boxShadowFlash"
      ],
      "timeout": 1000
    },
    {
      "from": "S2_Popping",
      "to": "S0_Idle",
      "event": "SYSTEM_POP_COMPLETE",
      "guard": "true",
      "actions": [
        "enableControls()"
      ],
      "expected_observables": [
        "dom:#stackContainer .slot",
        "dom:#size"
      ],
      "timeout": 2000
    },
    {
      "from": "S0_Idle",
      "to": "S3_Peeking",
      "event": "BTN_PEEK_CLICK",
      "guard": "stackNotEmpty",
      "actions": [
        "peekValue()"
      ],
      "expected_observables": [
        "dom:#btnPeek:click",
        "dom:#stackContainer .slot.highlight"
      ],
      "timeout": 1500
    },
    {
      "from": "S0_Idle",
      "to": "S5_Underflow",
      "event": "BTN_PEEK_CLICK",
      "guard": "stackEmpty",
      "actions": [
        "log('Peek — stack empty','err')",
        "flashSlot(null,'err')"
      ],
      "expected_observables": [
        "dom:#log p.err",
        "dom:#stackContainer:boxShadowFlash"
      ],
      "timeout": 1000
    },
    {
      "from": "S3_Peeking",
      "to": "S0_Idle",
      "event": "SYSTEM_PEAK_COMPLETE",
      "guard": "true",
      "actions": [],
      "expected_observables": [
        "dom:#stackContainer .slot:not(.highlight)"
      ],
      "timeout": 1200
    },
    {
      "from": "S0_Idle",
      "to": "S7_ClearingConfirm",
      "event": "BTN_CLEAR_CLICK",
      "guard": "true",
      "actions": [
        "openConfirmDialog('Clear the entire stack?')"
      ],
      "expected_observables": [
        "dom:#btnClear:click",
        "dom:window.confirm"
      ],
      "timeout": 2000
    },
    {
      "from": "S7_ClearingConfirm",
      "to": "S8_Cleared",
      "event": "USER_CONFIRMED",
      "guard": "true",
      "actions": [
        "clearStack()"
      ],
      "expected_observables": [
        "dom:#stackContainer .slot",
        "dom:#size"
      ],
      "timeout": 2000
    },
    {
      "from": "S7_ClearingConfirm",
      "to": "S0_Idle",
      "event": "USER_CANCELLED",
      "guard": "true",
      "actions": [],
      "expected_observables": [
        "dom:window.confirm:cancel"
      ],
      "timeout": 500
    },
    {
      "from": "S8_Cleared",
      "to": "S0_Idle",
      "event": "SYSTEM_POP_COMPLETE",
      "guard": "true",
      "actions": [],
      "expected_observables": [
        "dom:#stackContainer .slot",
        "dom:#size"
      ],
      "timeout": 500
    },
    {
      "from": "S0_Idle",
      "to": "S9_CapacityChanging",
      "event": "CAPACITY_CHANGE",
      "guard": "true",
      "actions": [
        "readCapacityInput()",
        "setCapacity(<n>)",
        "if (stack.length > capacity) { trimStackToCapacity() }",
        "render()"
      ],
      "expected_observables": [
        "dom:#capacity:change",
        "dom:#cap",
        "dom:#empty"
      ],
      "timeout": 1000
    },
    {
      "from": "S9_CapacityChanging",
      "to": "S0_Idle",
      "event": "SYSTEM_PUSH_COMPLETE",
      "guard": "true",
      "actions": [],
      "expected_observables": [
        "dom:#cap",
        "dom:#stackContainer .slot"
      ],
      "timeout": 500
    },
    {
      "from": "S0_Idle",
      "to": "S10_DemoRunning",
      "event": "DEMO_PUSH_CLICK",
      "guard": "true",
      "actions": [
        "runDemoPushSequence()"
      ],
      "expected_observables": [
        "dom:#demoPush:click",
        "dom:#stackContainer .slot.filled"
      ],
      "timeout": 60000
    },
    {
      "from": "S10_DemoRunning",
      "to": "S0_Idle",
      "event": "DEMO_SEQUENCE_COMPLETE",
      "guard": "true",
      "actions": [
        "enableControls()"
      ],
      "expected_observables": [
        "dom:#stackContainer",
        "dom:#size"
      ],
      "timeout": 2000
    },
    {
      "from": "S0_Idle",
      "to": "S10_DemoRunning",
      "event": "DEMO_POP_CLICK",
      "guard": "stackNotEmpty",
      "actions": [
        "runDemoPopSequence()"
      ],
      "expected_observables": [
        "dom:#demoPop:click",
        "dom:#stackContainer .slot.removing"
      ],
      "timeout": 60000
    },
    {
      "from": "S10_DemoRunning",
      "to": "S0_Idle",
      "event": "DEMO_SEQUENCE_COMPLETE",
      "guard": "true",
      "actions": [
        "enableControls()"
      ],
      "expected_observables": [
        "dom:#stackContainer",
        "dom:#size"
      ],
      "timeout": 2000
    },
    {
      "from": "S0_Idle",
      "to": "S1_Pushing",
      "event": "INPUT_ENTER_KEY",
      "guard": "documentActiveElementIs #value",
      "actions": [
        "captureInputValue()",
        "pushValue(<value>)"
      ],
      "expected_observables": [
        "dom:#value:keypress:Enter",
        "dom:#btnPush:click"
      ],
      "timeout": 4000
    },
    {
      "from": "S0_Idle",
      "to": "S2_Popping",
      "event": "KEYBOARD_POP_SHORTCUT",
      "guard": "true",
      "actions": [
        "popValue()"
      ],
      "expected_observables": [
        "dom:document:keydown Ctrl+P",
        "dom:#stackContainer .slot.removing"
      ],
      "timeout": 3000
    },
    {
      "from": "S0_Idle",
      "to": "S3_Peeking",
      "event": "KEYBOARD_PEEK_SHORTCUT",
      "guard": "true",
      "actions": [
        "peekValue()"
      ],
      "expected_observables": [
        "dom:document:keydown Ctrl+K",
        "dom:#stackContainer .slot.highlight"
      ],
      "timeout": 1500
    }
  ],
  "components": [
    "#value",
    "#capacity",
    "#animate",
    "#speed",
    "#btnPush",
    "#btnPop",
    "#btnPeek",
    "#btnClear",
    "#demoPush",
    "#demoPop",
    "#stackContainer",
    "#topIndicator",
    "#size",
    "#cap",
    "#empty",
    "#log"
  ]
}