{
  "meta": {
    "concept": "Binary Search Tree (BST) Interactive Demo",
    "topic": "Binary Search Tree operations, traversal, visualization, pan/zoom",
    "educational_goal": "Allow users to insert, delete, search, traverse, import/export, and visualize a BST with animations and pan/zoom controls.",
    "expected_interactions": [
      "Click buttons (#insertBtn, #deleteBtn, #searchBtn, traversal buttons) to perform operations",
      "Enter numeric values in input#valueInput and use Enter or buttons",
      "Click nodes on canvas to autofill valueInput",
      "Drag canvas to pan and use mouse wheel to zoom",
      "Use Random/Balanced to build trees, Import/Export via prompt"
    ]
  },
  "states": [
    {
      "id": "S0_Idle",
      "label": "Idle / Ready",
      "type": "idle",
      "entry_actions": [
        "draw()",
        "updateStats()"
      ],
      "exit_actions": [],
      "evidence": [
        "draw();",
        "function updateStats() {",
        "fitCanvasToWindow();",
        "(function seedDemo() {",
        "draw();"
      ],
      "confidence": 1
    },
    {
      "id": "S1_Animating",
      "label": "Animating / Highlighting Sequence",
      "type": "modal",
      "entry_actions": [
        "animatePath(...) or animateSequence(...)",
        "setTimeout highlighting via animTimers"
      ],
      "exit_actions": [
        "clearAnim()",
        "currentHighlights.clear(); draw();"
      ],
      "evidence": [
        "function animatePath(nodes, color='#ffd54f', cb) {",
        "function animateSequence(nodes, color='#93c5fd', cb) {",
        "animTimers.forEach(id => clearTimeout(id));",
        "UI.insertBtn.addEventListener('click', () => {",
        "animatePath(res.path, '#34d399', () => {",
        "UI.inorderBtn.addEventListener('click', () => {",
        "animateSequence(nodes, '#60a5fa', () => { currentHighlights.clear(); draw(); });",
        "UI.stopAnim.addEventListener('click', () => { clearAnim(); });"
      ],
      "confidence": 1
    },
    {
      "id": "S2_Panning",
      "label": "Canvas Panning",
      "type": "transient",
      "entry_actions": [
        "isPanning = true; lastPan = { x, y }; canvas.style.cursor = 'grabbing';"
      ],
      "exit_actions": [
        "isPanning = false; lastPan = null; canvas.style.cursor = 'default';"
      ],
      "evidence": [
        "canvas.addEventListener('mousedown', (ev) => {",
        "isPanning = true;",
        "lastPan = { x: ev.clientX, y: ev.clientY };",
        "window.addEventListener('mousemove', (ev) => {",
        "if (!isPanning || !lastPan) return;",
        "window.addEventListener('mouseup', () => {",
        "isPanning = false;",
        "canvas.style.cursor = 'default';"
      ],
      "confidence": 1
    },
    {
      "id": "S3_PromptOpen",
      "label": "Prompt Open (user input via prompt())",
      "type": "blocking",
      "entry_actions": [
        "window.prompt(...) called"
      ],
      "exit_actions": [
        "parse prompt result, possibly tree build/draw"
      ],
      "evidence": [
        "let raw = prompt('Enter numbers separated by commas (will be deduped & sorted):', '1,2,3,4,5,6,7');",
        "prompt('Copy JSON of values (inorder):', json);",
        "const raw = prompt('Paste JSON array of numbers (e.g. [5,1,7,3])');"
      ],
      "confidence": 1
    },
    {
      "id": "S4_ConfirmOpen",
      "label": "Confirmation Dialog Open (confirm())",
      "type": "blocking",
      "entry_actions": [
        "confirm('Clear the entire tree?')"
      ],
      "exit_actions": [
        "if confirmed -> clear tree, draw; else return (no-op)"
      ],
      "evidence": [
        "if (!confirm('Clear the entire tree?')) return;"
      ],
      "confidence": 1
    }
  ],
  "events": [
    {
      "id": "INSERT_CLICK",
      "event_type": "click",
      "description": "User clicks the Insert button (#insertBtn) to insert numeric value",
      "trigger_selectors": [
        "#insertBtn"
      ],
      "evidence": [
        "UI.insertBtn.addEventListener('click', () => {",
        "const v = Number(UI.valueInput.value);",
        "const res = tree.insert(v);",
        "animatePath(res.path, '#34d399', () => { currentHighlights.clear(); draw(); });"
      ],
      "confidence": 1
    },
    {
      "id": "SEARCH_CLICK",
      "event_type": "click",
      "description": "User clicks the Search button (#searchBtn) to search for a value",
      "trigger_selectors": [
        "#searchBtn"
      ],
      "evidence": [
        "UI.searchBtn.addEventListener('click', () => {",
        "const v = Number(UI.valueInput.value);",
        "const res = tree.findWithPath(v);",
        "animatePath(res.path, res.found ? '#93c5fd' : '#fb7185', () => {"
      ],
      "confidence": 1
    },
    {
      "id": "DELETE_CLICK",
      "event_type": "click",
      "description": "User clicks the Delete button (#deleteBtn) to delete a value",
      "trigger_selectors": [
        "#deleteBtn"
      ],
      "evidence": [
        "UI.deleteBtn.addEventListener('click', () => {",
        "const v = Number(UI.valueInput.value);",
        "const res = tree.findWithPath(v);",
        "animatePath(res.path, '#fbbf24', () => {",
        "const del = tree.delete(v);",
        "animatePath(del.path, del.deleted ? '#fb7185' : '#fb7185', () => { currentHighlights.clear(); draw(); });"
      ],
      "confidence": 1
    },
    {
      "id": "CLEAR_CLICK",
      "event_type": "click",
      "description": "User clicks Clear (#clearBtn); triggers confirm() then clear tree",
      "trigger_selectors": [
        "#clearBtn"
      ],
      "evidence": [
        "UI.clearBtn.addEventListener('click', () => {",
        "if (!confirm('Clear the entire tree?')) return;",
        "clearAnim();",
        "tree.clear();",
        "draw();"
      ],
      "confidence": 1
    },
    {
      "id": "RANDOM_CLICK",
      "event_type": "click",
      "description": "User clicks Random Tree (#randomBtn) to populate with random values",
      "trigger_selectors": [
        "#randomBtn"
      ],
      "evidence": [
        "UI.randomBtn.addEventListener('click', () => {",
        "const count = Math.min(40, Math.max(1, Number(UI.randCount.value) || 8));",
        "tree.clear();",
        "for (let v of arr) tree.insert(v);",
        "draw();"
      ],
      "confidence": 1
    },
    {
      "id": "BALANCED_CLICK",
      "event_type": "click",
      "description": "User clicks Balanced from Sorted (#balancedBtn) to build balanced BST (may prompt)",
      "trigger_selectors": [
        "#balancedBtn"
      ],
      "evidence": [
        "UI.balancedBtn.addEventListener('click', () => {",
        "let arr = tree.toArray();",
        "if (arr.length === 0) { let raw = prompt('Enter numbers separated by commas (will be deduped & sorted):', '1,2,3,4,5,6,7');",
        "tree.root = buildBalanced(arr);",
        "tree.size = arr.length;",
        "draw();"
      ],
      "confidence": 1
    },
    {
      "id": "INORDER_CLICK",
      "event_type": "click",
      "description": "User clicks Inorder traversal (#inorderBtn) to animate inorder traversal",
      "trigger_selectors": [
        "#inorderBtn"
      ],
      "evidence": [
        "UI.inorderBtn.addEventListener('click', () => {",
        "const nodes = tree.inorder();",
        "UI.output.textContent = JSON.stringify(nodes.map(n => n.value));",
        "animateSequence(nodes, '#60a5fa', () => { currentHighlights.clear(); draw(); });"
      ],
      "confidence": 1
    },
    {
      "id": "PREORDER_CLICK",
      "event_type": "click",
      "description": "User clicks Preorder traversal (#preorderBtn)",
      "trigger_selectors": [
        "#preorderBtn"
      ],
      "evidence": [
        "UI.preorderBtn.addEventListener('click', () => {",
        "const nodes = tree.preorder();",
        "UI.output.textContent = JSON.stringify(nodes.map(n => n.value));",
        "animateSequence(nodes, '#a78bfa', () => { currentHighlights.clear(); draw(); });"
      ],
      "confidence": 1
    },
    {
      "id": "POSTORDER_CLICK",
      "event_type": "click",
      "description": "User clicks Postorder traversal (#postorderBtn)",
      "trigger_selectors": [
        "#postorderBtn"
      ],
      "evidence": [
        "UI.postorderBtn.addEventListener('click', () => {",
        "const nodes = tree.postorder();",
        "UI.output.textContent = JSON.stringify(nodes.map(n => n.value));",
        "animateSequence(nodes, '#fb7185', () => { currentHighlights.clear(); draw(); });"
      ],
      "confidence": 1
    },
    {
      "id": "LEVELORDER_CLICK",
      "event_type": "click",
      "description": "User clicks Level-order traversal (#levelBtn)",
      "trigger_selectors": [
        "#levelBtn"
      ],
      "evidence": [
        "UI.levelBtn.addEventListener('click', () => {",
        "const nodes = tree.levelorder();",
        "UI.output.textContent = JSON.stringify(nodes.map(n => n.value));",
        "animateSequence(nodes, '#34d399', () => { currentHighlights.clear(); draw(); });"
      ],
      "confidence": 1
    },
    {
      "id": "STOP_ANIM_CLICK",
      "event_type": "click",
      "description": "User clicks Stop (#stopAnim) to clear animations",
      "trigger_selectors": [
        "#stopAnim"
      ],
      "evidence": [
        "UI.stopAnim.addEventListener('click', () => {",
        "clearAnim();",
        "});"
      ],
      "confidence": 1
    },
    {
      "id": "EXPORT_CLICK",
      "event_type": "click",
      "description": "User clicks Export Values (JSON) (#exportBtn) to prompt JSON string of inorder values",
      "trigger_selectors": [
        "#exportBtn"
      ],
      "evidence": [
        "UI.exportBtn.addEventListener('click', () => {",
        "const arr = tree.toArray();",
        "const json = JSON.stringify(arr, null, 2);",
        "prompt('Copy JSON of values (inorder):', json);"
      ],
      "confidence": 1
    },
    {
      "id": "IMPORT_CLICK",
      "event_type": "click",
      "description": "User clicks Import JSON (#importBtn) to paste JSON array and load tree",
      "trigger_selectors": [
        "#importBtn"
      ],
      "evidence": [
        "UI.importBtn.addEventListener('click', () => {",
        "const raw = prompt('Paste JSON array of numbers (e.g. [5,1,7,3])');",
        "const arr = JSON.parse(raw);",
        "tree.clear();",
        "arr.forEach(v => { if (Number.isFinite(v)) tree.insert(Number(v)); });",
        "draw();"
      ],
      "confidence": 1
    },
    {
      "id": "CANVAS_CLICK",
      "event_type": "click",
      "description": "User clicks on the canvas to autofill the input with a node's value",
      "trigger_selectors": [
        "canvas#treeCanvas"
      ],
      "evidence": [
        "canvas.addEventListener('click', (ev) => {",
        "const rect = canvas.getBoundingClientRect();",
        "const cx = (ev.clientX - rect.left) / scale - offsetX;",
        "let found = null;",
        "if (found) { UI.valueInput.value = found.value; }"
      ],
      "confidence": 1
    },
    {
      "id": "CANVAS_WHEEL",
      "event_type": "wheel",
      "description": "Mouse wheel on canvas to zoom (prevents default)",
      "trigger_selectors": [
        "canvas#treeCanvas"
      ],
      "evidence": [
        "canvas.addEventListener('wheel', (ev) => {",
        "ev.preventDefault();",
        "scale = Math.max(0.3, Math.min(3.0, scale * zoomFactor));",
        "draw();",
        "}, { passive: false });"
      ],
      "confidence": 1
    },
    {
      "id": "CANVAS_MOUSEDOWN",
      "event_type": "mousedown",
      "description": "Mouse down on canvas begins panning",
      "trigger_selectors": [
        "canvas#treeCanvas"
      ],
      "evidence": [
        "canvas.addEventListener('mousedown', (ev) => {",
        "isPanning = true;",
        "lastPan = { x: ev.clientX, y: ev.clientY };",
        "canvas.style.cursor = 'grabbing';",
        "});"
      ],
      "confidence": 1
    },
    {
      "id": "WINDOW_MOUSEMOVE",
      "event_type": "mousemove",
      "description": "Window mousemove updates pan when isPanning",
      "trigger_selectors": [
        "window"
      ],
      "evidence": [
        "window.addEventListener('mousemove', (ev) => {",
        "if (!isPanning || !lastPan) return;",
        "const dx = (ev.clientX - lastPan.x) / scale;",
        "offsetX += dx;",
        "draw();",
        "});"
      ],
      "confidence": 1
    },
    {
      "id": "WINDOW_MOUSEUP",
      "event_type": "mouseup",
      "description": "Window mouseup ends panning",
      "trigger_selectors": [
        "window"
      ],
      "evidence": [
        "window.addEventListener('mouseup', () => {",
        "isPanning = false;",
        "lastPan = null;",
        "canvas.style.cursor = 'default';",
        "});"
      ],
      "confidence": 1
    },
    {
      "id": "WINDOW_RESIZE",
      "event_type": "resize",
      "description": "Window resize triggers fitCanvasToWindow() and redraw",
      "trigger_selectors": [
        "window"
      ],
      "evidence": [
        "window.addEventListener('resize', fitCanvasToWindow);",
        "function fitCanvasToWindow() {",
        "draw();",
        "}"
      ],
      "confidence": 1
    },
    {
      "id": "SPEED_INPUT",
      "event_type": "input/change",
      "description": "Speed range input updates speed display",
      "trigger_selectors": [
        "#speedRange"
      ],
      "evidence": [
        "UI.speedRange.addEventListener('input', () => setSpeedDisplay());",
        "UI.speedRange.addEventListener('change', () => setSpeedDisplay());",
        "function setSpeedDisplay() { UI.speedVal.textContent = UI.speedRange.value + 'ms'; }"
      ],
      "confidence": 1
    },
    {
      "id": "KEYDOWN_GLOBAL",
      "event_type": "keydown",
      "description": "Global keydown: Enter triggers insert click, Delete triggers delete click",
      "trigger_selectors": [
        "window"
      ],
      "evidence": [
        "window.addEventListener('keydown', (ev) => {",
        "if (ev.key === 'Enter') { UI.insertBtn.click(); } else if (ev.key === 'Delete') { UI.deleteBtn.click(); }",
        "});"
      ],
      "confidence": 1
    }
  ],
  "transitions": [
    {
      "from": "S0_Idle",
      "to": "S1_Animating",
      "event": "INSERT_CLICK",
      "actions": [
        "read UI.valueInput, call tree.insert(v)",
        "call animatePath(res.path, '#34d399', callback -> clear highlights and draw)",
        "draw()"
      ],
      "expected_observables": [
        "node highlight animation along insertion path",
        "tree.size increments and canvas redraw"
      ],
      "evidence": [
        "UI.insertBtn.addEventListener('click', () => {",
        "const v = Number(UI.valueInput.value);",
        "const res = tree.insert(v);",
        "animatePath(res.path, '#34d399', () => {",
        "currentHighlights.clear();",
        "draw();",
        "});",
        "draw();",
        "});"
      ],
      "confidence": 1
    },
    {
      "from": "S0_Idle",
      "to": "S1_Animating",
      "event": "SEARCH_CLICK",
      "actions": [
        "read UI.valueInput, call tree.findWithPath(v)",
        "call animatePath(res.path, color depending on found)"
      ],
      "expected_observables": [
        "node highlight animation along search path",
        "alert if not found"
      ],
      "evidence": [
        "UI.searchBtn.addEventListener('click', () => {",
        "const res = tree.findWithPath(v);",
        "animatePath(res.path, res.found ? '#93c5fd' : '#fb7185', () => {",
        "if (!res.found) alert('Value not found.');",
        "currentHighlights.clear();",
        "draw();",
        "});",
        "});"
      ],
      "confidence": 1
    },
    {
      "from": "S0_Idle",
      "to": "S1_Animating",
      "event": "DELETE_CLICK",
      "actions": [
        "animatePath(res.path, '#fbbf24') then call tree.delete(v) then animatePath(del.path) then clear highlights and draw"
      ],
      "expected_observables": [
        "search highlight then deletion & re-layout highlight, tree.size decremented if deleted"
      ],
      "evidence": [
        "UI.deleteBtn.addEventListener('click', () => {",
        "const res = tree.findWithPath(v);",
        "animatePath(res.path, '#fbbf24', () => {",
        "const del = tree.delete(v);",
        "animatePath(del.path, del.deleted ? '#fb7185' : '#fb7185', () => {",
        "currentHighlights.clear();",
        "draw();",
        "});",
        "});",
        "});"
      ],
      "confidence": 1
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "CLEAR_CLICK",
      "guard": "confirm('Clear the entire tree?') returns true",
      "actions": [
        "clearAnim(); tree.clear(); draw();"
      ],
      "expected_observables": [
        "canvas shows empty tree, UI.size and UI.height updated"
      ],
      "evidence": [
        "UI.clearBtn.addEventListener('click', () => {",
        "if (!confirm('Clear the entire tree?')) return;",
        "clearAnim();",
        "tree.clear();",
        "draw();",
        "});"
      ],
      "confidence": 1
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "RANDOM_CLICK",
      "actions": [
        "compute random unique values, tree.clear(), insert values, draw()"
      ],
      "expected_observables": [
        "new random tree drawn, UI.output updated"
      ],
      "evidence": [
        "UI.randomBtn.addEventListener('click', () => {",
        "const vals = new Set();",
        "tree.clear();",
        "for (let v of arr) tree.insert(v);",
        "draw();",
        "});"
      ],
      "confidence": 1
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "BALANCED_CLICK",
      "actions": [
        "if tree empty -> prompt for numbers; else balance current values; rebuild tree.root and set size; draw()"
      ],
      "expected_observables": [
        "balanced tree drawn from sorted values or from prompt input"
      ],
      "evidence": [
        "UI.balancedBtn.addEventListener('click', () => {",
        "let arr = tree.toArray();",
        "if (arr.length === 0) { let raw = prompt('Enter numbers separated by commas (will be deduped & sorted):', '1,2,3,4,5,6,7');",
        "tree.root = buildBalanced(arr);",
        "tree.size = arr.length;",
        "draw();",
        "});"
      ],
      "confidence": 1
    },
    {
      "from": "S0_Idle",
      "to": "S1_Animating",
      "event": "INORDER_CLICK",
      "actions": [
        "compute inorder nodes, set UI.output, animateSequence(nodes), clear highlights on finish"
      ],
      "expected_observables": [
        "UI.output shows inorder JSON and nodes are highlighted in sequence"
      ],
      "evidence": [
        "UI.inorderBtn.addEventListener('click', () => {",
        "const nodes = tree.inorder();",
        "UI.output.textContent = JSON.stringify(nodes.map(n => n.value));",
        "animateSequence(nodes, '#60a5fa', () => { currentHighlights.clear(); draw(); });",
        "});"
      ],
      "confidence": 1
    },
    {
      "from": "S0_Idle",
      "to": "S1_Animating",
      "event": "PREORDER_CLICK",
      "actions": [
        "compute preorder, set output, animateSequence"
      ],
      "expected_observables": [
        "UI.output shows preorder JSON and nodes highlighted"
      ],
      "evidence": [
        "UI.preorderBtn.addEventListener('click', () => {",
        "const nodes = tree.preorder();",
        "UI.output.textContent = JSON.stringify(nodes.map(n => n.value));",
        "animateSequence(nodes, '#a78bfa', () => { currentHighlights.clear(); draw(); });",
        "});"
      ],
      "confidence": 1
    },
    {
      "from": "S0_Idle",
      "to": "S1_Animating",
      "event": "POSTORDER_CLICK",
      "actions": [
        "compute postorder, set output, animateSequence"
      ],
      "expected_observables": [
        "UI.output shows postorder JSON and nodes highlighted"
      ],
      "evidence": [
        "UI.postorderBtn.addEventListener('click', () => {",
        "const nodes = tree.postorder();",
        "UI.output.textContent = JSON.stringify(nodes.map(n => n.value));",
        "animateSequence(nodes, '#fb7185', () => { currentHighlights.clear(); draw(); });",
        "});"
      ],
      "confidence": 1
    },
    {
      "from": "S0_Idle",
      "to": "S1_Animating",
      "event": "LEVELORDER_CLICK",
      "actions": [
        "compute level order, set output, animateSequence"
      ],
      "expected_observables": [
        "UI.output shows level-order JSON and nodes highlighted"
      ],
      "evidence": [
        "UI.levelBtn.addEventListener('click', () => {",
        "const nodes = tree.levelorder();",
        "UI.output.textContent = JSON.stringify(nodes.map(n => n.value));",
        "animateSequence(nodes, '#34d399', () => { currentHighlights.clear(); draw(); });",
        "});"
      ],
      "confidence": 1
    },
    {
      "from": "S1_Animating",
      "to": "S0_Idle",
      "event": "ANIM_COMPLETE",
      "actions": [
        "currentHighlights.clear(); draw();",
        "clearAnim()"
      ],
      "expected_observables": [
        "highlights cleared and normal idle rendering resumes"
      ],
      "evidence": [
        "animatePath(..., () => { currentHighlights.clear(); draw(); });",
        "animateSequence(..., () => { currentHighlights.clear(); draw(); });",
        "function clearAnim() { animTimers.forEach(id => clearTimeout(id)); animTimers = []; currentHighlights.clear(); draw(); }"
      ],
      "confidence": 1
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "STOP_ANIM_CLICK",
      "actions": [
        "clearAnim()"
      ],
      "expected_observables": [
        "all animation timers cleared and highlights removed"
      ],
      "evidence": [
        "UI.stopAnim.addEventListener('click', () => {",
        "clearAnim();",
        "});"
      ],
      "confidence": 1
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "EXPORT_CLICK",
      "actions": [
        "compute inorder array and prompt JSON to user"
      ],
      "expected_observables": [
        "prompt dialog with JSON string"
      ],
      "evidence": [
        "UI.exportBtn.addEventListener('click', () => {",
        "const arr = tree.toArray();",
        "const json = JSON.stringify(arr, null, 2);",
        "prompt('Copy JSON of values (inorder):', json);",
        "});"
      ],
      "confidence": 1
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "IMPORT_CLICK",
      "actions": [
        "prompt for JSON, parse it, tree.clear(), insert values, draw()",
        "on parse error -> alert('Invalid JSON array.')"
      ],
      "expected_observables": [
        "new tree built from imported JSON or alert on invalid JSON"
      ],
      "evidence": [
        "UI.importBtn.addEventListener('click', () => {",
        "const raw = prompt('Paste JSON array of numbers (e.g. [5,1,7,3])');",
        "const arr = JSON.parse(raw);",
        "tree.clear();",
        "arr.forEach(v => { if (Number.isFinite(v)) tree.insert(Number(v)); });",
        "draw();",
        "} catch (e) { alert('Invalid JSON array.'); }",
        "});"
      ],
      "confidence": 1
    },
    {
      "from": "S0_Idle",
      "to": "S2_Panning",
      "event": "CANVAS_MOUSEDOWN",
      "actions": [
        "isPanning = true; lastPan = {x,y}; canvas.style.cursor = 'grabbing';"
      ],
      "expected_observables": [
        "subsequent mousemove will pan canvas until mouseup"
      ],
      "evidence": [
        "canvas.addEventListener('mousedown', (ev) => {",
        "isPanning = true;",
        "lastPan = { x: ev.clientX, y: ev.clientY };",
        "canvas.style.cursor = 'grabbing';",
        "});"
      ],
      "confidence": 1
    },
    {
      "from": "S2_Panning",
      "to": "S2_Panning",
      "event": "WINDOW_MOUSEMOVE",
      "guard": "isPanning === true",
      "actions": [
        "update offsetX/offsetY based on mouse movement and draw()"
      ],
      "expected_observables": [
        "canvas content translates visually"
      ],
      "evidence": [
        "window.addEventListener('mousemove', (ev) => {",
        "if (!isPanning || !lastPan) return;",
        "const dx = (ev.clientX - lastPan.x) / scale;",
        "offsetX += dx;",
        "offsetY += dy;",
        "lastPan = { x: ev.clientX, y: ev.clientY };",
        "draw();",
        "});"
      ],
      "confidence": 1
    },
    {
      "from": "S2_Panning",
      "to": "S0_Idle",
      "event": "WINDOW_MOUSEUP",
      "actions": [
        "isPanning = false; lastPan = null; canvas.style.cursor = 'default';"
      ],
      "expected_observables": [
        "panning stops and cursor returns to default"
      ],
      "evidence": [
        "window.addEventListener('mouseup', () => {",
        "isPanning = false;",
        "lastPan = null;",
        "canvas.style.cursor = 'default';",
        "});"
      ],
      "confidence": 1
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "CANVAS_WHEEL",
      "actions": [
        "preventDefault, adjust scale and offsets to zoom towards cursor, draw()"
      ],
      "expected_observables": [
        "zoom in/out of canvas content"
      ],
      "evidence": [
        "canvas.addEventListener('wheel', (ev) => {",
        "ev.preventDefault();",
        "scale = Math.max(0.3, Math.min(3.0, scale * zoomFactor));",
        "offsetX = (offsetX) - (mx * (zoomFactor - 1));",
        "offsetY = (offsetY) - (my * (zoomFactor - 1));",
        "draw();",
        "}, { passive: false });"
      ],
      "confidence": 1
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "SPEED_INPUT",
      "actions": [
        "update UI.speedVal text to show current speed value"
      ],
      "expected_observables": [
        "speed display text changes (e.g. '400ms')"
      ],
      "evidence": [
        "UI.speedRange.addEventListener('input', () => setSpeedDisplay());",
        "function setSpeedDisplay() { UI.speedVal.textContent = UI.speedRange.value + 'ms'; }"
      ],
      "confidence": 1
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "KEYDOWN_GLOBAL",
      "actions": [
        "if Enter -> trigger UI.insertBtn.click(); if Delete -> trigger UI.deleteBtn.click()"
      ],
      "expected_observables": [
        "Enter key causes same behavior as clicking Insert; Delete key same as clicking Delete"
      ],
      "evidence": [
        "window.addEventListener('keydown', (ev) => {",
        "if (ev.key === 'Enter') { UI.insertBtn.click(); } else if (ev.key === 'Delete') { UI.deleteBtn.click(); }",
        "});"
      ],
      "confidence": 1
    },
    {
      "from": "S0_Idle",
      "to": "S0_Idle",
      "event": "CANVAS_CLICK",
      "actions": [
        "detect nearest node under cursor and set UI.valueInput.value = found.value"
      ],
      "expected_observables": [
        "valueInput is filled with clicked node's numeric value"
      ],
      "evidence": [
        "canvas.addEventListener('click', (ev) => {",
        "const cx = (ev.clientX - rect.left) / scale - offsetX;",
        "const radius = defaultNodeRadius + 4;",
        "if (dx*dx + dy*dy <= (radius*radius)) { found = node; }",
        "if (found) { UI.valueInput.value = found.value; }",
        "});"
      ],
      "confidence": 1
    }
  ],
  "components": [
    {
      "type": "visual",
      "selector": "canvas#treeCanvas",
      "text": "",
      "attributes": {
        "id": "treeCanvas",
        "width": "1200",
        "height": "640"
      },
      "evidence": [
        "<canvas id=\"treeCanvas\" width=\"1200\" height=\"640\"></canvas>"
      ]
    },
    {
      "type": "input",
      "selector": "input#valueInput",
      "text": "",
      "attributes": {
        "id": "valueInput",
        "type": "number",
        "placeholder": "e.g. 42"
      },
      "evidence": [
        "<input id=\"valueInput\" type=\"number\" placeholder=\"e.g. 42\" />"
      ]
    },
    {
      "type": "button",
      "selector": "button#insertBtn",
      "text": "Insert",
      "attributes": {
        "id": "insertBtn"
      },
      "evidence": [
        "<button id=\"insertBtn\">Insert</button>"
      ]
    },
    {
      "type": "button",
      "selector": "button#deleteBtn",
      "text": "Delete",
      "attributes": {
        "id": "deleteBtn",
        "class": "ghost"
      },
      "evidence": [
        "<button id=\"deleteBtn\" class=\"ghost\">Delete</button>"
      ]
    },
    {
      "type": "button",
      "selector": "button#searchBtn",
      "text": "Search",
      "attributes": {
        "id": "searchBtn",
        "class": "ghost"
      },
      "evidence": [
        "<button id=\"searchBtn\" class=\"ghost\">Search</button>"
      ]
    },
    {
      "type": "button",
      "selector": "button#clearBtn",
      "text": "Clear",
      "attributes": {
        "id": "clearBtn",
        "class": "ghost"
      },
      "evidence": [
        "<button id=\"clearBtn\" class=\"ghost\">Clear</button>"
      ]
    },
    {
      "type": "input",
      "selector": "input#randCount",
      "text": "",
      "attributes": {
        "id": "randCount",
        "type": "number",
        "min": "1",
        "max": "30",
        "value": "8",
        "style": "width:90px;"
      },
      "evidence": [
        "<input id=\"randCount\" type=\"number\" min=\"1\" max=\"30\" value=\"8\" style=\"width:90px;\" />"
      ]
    },
    {
      "type": "button",
      "selector": "button#randomBtn",
      "text": "Random Tree",
      "attributes": {
        "id": "randomBtn",
        "class": "small ghost"
      },
      "evidence": [
        "<button id=\"randomBtn\" class=\"small ghost\">Random Tree</button>"
      ]
    },
    {
      "type": "button",
      "selector": "button#balancedBtn",
      "text": "Balanced from Sorted",
      "attributes": {
        "id": "balancedBtn",
        "class": "small ghost"
      },
      "evidence": [
        "<button id=\"balancedBtn\" class=\"small ghost\">Balanced from Sorted</button>"
      ]
    },
    {
      "type": "button",
      "selector": "button#inorderBtn",
      "text": "Inorder",
      "attributes": {
        "id": "inorderBtn",
        "class": "small ghost"
      },
      "evidence": [
        "<button id=\"inorderBtn\" class=\"small ghost\">Inorder</button>"
      ]
    },
    {
      "type": "button",
      "selector": "button#preorderBtn",
      "text": "Preorder",
      "attributes": {
        "id": "preorderBtn",
        "class": "small ghost"
      },
      "evidence": [
        "<button id=\"preorderBtn\" class=\"small ghost\">Preorder</button>"
      ]
    },
    {
      "type": "button",
      "selector": "button#postorderBtn",
      "text": "Postorder",
      "attributes": {
        "id": "postorderBtn",
        "class": "small ghost"
      },
      "evidence": [
        "<button id=\"postorderBtn\" class=\"small ghost\">Postorder</button>"
      ]
    },
    {
      "type": "button",
      "selector": "button#levelBtn",
      "text": "Level-order",
      "attributes": {
        "id": "levelBtn",
        "class": "small ghost"
      },
      "evidence": [
        "<button id=\"levelBtn\" class=\"small ghost\">Level-order</button>"
      ]
    },
    {
      "type": "visual",
      "selector": "div#output",
      "text": "[]",
      "attributes": {
        "id": "output",
        "class": "traversal-output"
      },
      "evidence": [
        "<div class=\"traversal-output\" id=\"output\">[]</div>"
      ]
    },
    {
      "type": "visual",
      "selector": "span#size",
      "text": "0",
      "attributes": {
        "id": "size"
      },
      "evidence": [
        "<div class=\"stat\">Size: <span id=\"size\">0</span></div>"
      ]
    },
    {
      "type": "visual",
      "selector": "span#height",
      "text": "0",
      "attributes": {
        "id": "height"
      },
      "evidence": [
        "<div class=\"stat\">Height: <span id=\"height\">0</span></div>"
      ]
    },
    {
      "type": "input",
      "selector": "input#speedRange",
      "text": "",
      "attributes": {
        "id": "speedRange",
        "type": "range",
        "min": "100",
        "max": "1200",
        "step": "50",
        "value": "400"
      },
      "evidence": [
        "<input id=\"speedRange\" type=\"range\" min=\"100\" max=\"1200\" step=\"50\" value=\"400\" />"
      ]
    },
    {
      "type": "visual",
      "selector": "span#speedVal",
      "text": "400ms",
      "attributes": {
        "id": "speedVal"
      },
      "evidence": [
        "<span id=\"speedVal\" style=\"width:42px; text-align:right; color:var(--muted); font-size:13px;\">400ms</span>"
      ]
    },
    {
      "type": "button",
      "selector": "button#stopAnim",
      "text": "Stop",
      "attributes": {
        "id": "stopAnim",
        "class": "ghost small"
      },
      "evidence": [
        "<button id=\"stopAnim\" class=\"ghost small\">Stop</button>"
      ]
    },
    {
      "type": "button",
      "selector": "button#exportBtn",
      "text": "Export Values (JSON)",
      "attributes": {
        "id": "exportBtn",
        "class": "small ghost btn-wide"
      },
      "evidence": [
        "<button id=\"exportBtn\" class=\"small ghost btn-wide\">Export Values (JSON)</button>"
      ]
    },
    {
      "type": "button",
      "selector": "button#importBtn",
      "text": "Import JSON",
      "attributes": {
        "id": "importBtn",
        "class": "small ghost btn-wide"
      },
      "evidence": [
        "<button id=\"importBtn\" class=\"small ghost btn-wide\">Import JSON</button>"
      ]
    },
    {
      "type": "button",
      "selector": "button.ghost",
      "text": "",
      "attributes": {
        "class": "ghost"
      },
      "evidence": [
        "multiple elements use class=\"ghost\" (e.g. <button id=\"deleteBtn\" class=\"ghost\">Delete</button>)"
      ]
    },
    {
      "type": "button",
      "selector": "button.small",
      "text": "",
      "attributes": {
        "class": "small"
      },
      "evidence": [
        "multiple elements use class=\"small\" (e.g. <button id=\"randomBtn\" class=\"small ghost\">Random Tree</button>)"
      ]
    }
  ],
  "extraction_summary": {
    "timestamp": "2025-12-05T00:00:00.000Z",
    "detected_components_count": 23,
    "detected_components": [
      {
        "type": "visual",
        "selector": "canvas#treeCanvas"
      },
      {
        "type": "input",
        "selector": "input#valueInput"
      },
      {
        "type": "button",
        "selector": "button#insertBtn"
      },
      {
        "type": "button",
        "selector": "button#deleteBtn"
      },
      {
        "type": "button",
        "selector": "button#searchBtn"
      },
      {
        "type": "button",
        "selector": "button#clearBtn"
      },
      {
        "type": "input",
        "selector": "input#randCount"
      },
      {
        "type": "button",
        "selector": "button#randomBtn"
      },
      {
        "type": "button",
        "selector": "button#balancedBtn"
      },
      {
        "type": "button",
        "selector": "button#inorderBtn"
      },
      {
        "type": "button",
        "selector": "button#preorderBtn"
      },
      {
        "type": "button",
        "selector": "button#postorderBtn"
      },
      {
        "type": "button",
        "selector": "button#levelBtn"
      },
      {
        "type": "visual",
        "selector": "div#output"
      },
      {
        "type": "visual",
        "selector": "span#size"
      },
      {
        "type": "visual",
        "selector": "span#height"
      },
      {
        "type": "input",
        "selector": "input#speedRange"
      },
      {
        "type": "visual",
        "selector": "span#speedVal"
      },
      {
        "type": "button",
        "selector": "button#stopAnim"
      },
      {
        "type": "button",
        "selector": "button#exportBtn"
      },
      {
        "type": "button",
        "selector": "button#importBtn"
      },
      {
        "type": "button",
        "selector": "button.ghost"
      },
      {
        "type": "button",
        "selector": "button.small"
      }
    ],
    "detected_event_handlers_count": 23,
    "detected_event_handlers": [
      "UI.speedRange.addEventListener('input', () => setSpeedDisplay());",
      "UI.insertBtn.addEventListener('click', () => {",
      "UI.searchBtn.addEventListener('click', () => {",
      "UI.deleteBtn.addEventListener('click', () => {",
      "UI.clearBtn.addEventListener('click', () => {",
      "UI.randomBtn.addEventListener('click', () => {",
      "UI.balancedBtn.addEventListener('click', () => {",
      "UI.inorderBtn.addEventListener('click', () => {",
      "UI.preorderBtn.addEventListener('click', () => {",
      "UI.postorderBtn.addEventListener('click', () => {",
      "UI.levelBtn.addEventListener('click', () => {",
      "UI.stopAnim.addEventListener('click', () => {",
      "UI.exportBtn.addEventListener('click', () => {",
      "UI.importBtn.addEventListener('click', () => {",
      "canvas.addEventListener('click', (ev) => {",
      "canvas.addEventListener('wheel', (ev) => {",
      "canvas.addEventListener('mousedown', (ev) => {",
      "window.addEventListener('mousemove', (ev) => {",
      "window.addEventListener('mouseup', () => {",
      "window.addEventListener('resize', fitCanvasToWindow);",
      "window.addEventListener('keydown', (ev) => {",
      "UI.speedRange.addEventListener('change', () => setSpeedDisplay());"
    ],
    "extracted_states_count": 5,
    "extracted_transitions_count": 23,
    "extraction_confidence": 0.95,
    "notes": [
      "Extraction is based solely on inline HTML and <script> content; no external scripts were fetched (none referenced inline).",
      "All button IDs and class selectors present in HTML were listed; transitions are mapped only where inline listeners or functions are present.",
      "Prompt() and confirm() usage are treated as blocking UI states (S3_PromptOpen, S4_ConfirmOpen) with transitions based on code paths.",
      "DOM mutation is client-side in the inline script (tree.insert/delete/clear/buildBalanced) and transitions reflect these operations; visual drawing is via canvas.draw() calls.",
      "No assumptions were made about external behavior; keyboard, wheel, and mouse events are included because they are explicitly present in inline code."
    ]
  }
}