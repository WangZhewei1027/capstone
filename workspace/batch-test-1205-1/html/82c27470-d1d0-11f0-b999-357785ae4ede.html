<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Bubble Sort Visualizer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#0f1724;
      --panel:#0b1320;
      --accent:#06b6d4;
      --muted:#94a3b8;
      --card:#071127;
      --good:#16a34a;
      --warn:#f59e0b;
      --bad:#ef4444;
      --bar:#60a5fa;
    }
    *{box-sizing:border-box;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#071024 120%);color:#e6eef8;min-height:100vh;display:flex;align-items:stretch;gap:18px;padding:18px;}
    .container{display:flex;gap:18px;width:100%;}
    .left, .right{background:linear-gradient(180deg,var(--panel),#041221);border-radius:10px;padding:18px;box-shadow:0 8px 24px rgba(2,6,23,0.7); }
    .left{flex:1;min-height:520px;display:flex;flex-direction:column;gap:12px;}
    .right{width:420px;display:flex;flex-direction:column;gap:12px;}
    .bars-wrap{flex:1;background:linear-gradient(180deg,#062033, #02101a);border-radius:8px;padding:12px;display:flex;align-items:end;gap:6px;overflow:hidden;}
    .bar{flex:1 1 auto;display:flex;justify-content:center;align-items:flex-end;border-radius:4px 4px 0 0;position:relative;transition:height 200ms ease, background-color 150ms ease, transform 200ms ease;min-width:6px;margin:0 2px;}
    .bar .label{position:absolute;bottom:6px;font-size:11px;color:rgba(255,255,255,0.85);text-shadow:0 1px 2px rgba(0,0,0,0.6);display:none;}
    .bar.show-label .label{display:block}
    .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center;}
    .btn{
      background:linear-gradient(180deg,#0ea5a6,#0284c7);
      border:none;color:white;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600;
      box-shadow:0 6px 16px rgba(2,6,23,0.5);
    }
    .btn.secondary{background:linear-gradient(180deg,#334155,#0f1724);border:1px solid rgba(255,255,255,0.03);}
    .btn.ghost{background:transparent;border:1px dashed rgba(255,255,255,0.06);padding:6px 10px;}
    .btn:disabled{opacity:0.5;cursor:not-allowed}
    .row{display:flex;gap:8px;align-items:center;}
    label{font-size:13px;color:var(--muted);}
    input[type="range"]{width:140px;}
    .stats{display:flex;gap:12px;flex-wrap:wrap;}
    .stat{background:rgba(255,255,255,0.03);padding:8px 10px;border-radius:8px;min-width:90px;text-align:center;}
    .stat .num{font-weight:700;font-size:18px;margin-top:4px;color:var(--accent);}
    .code{background:#001826;border-radius:8px;padding:12px;color:#dff6ff;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;font-size:13px;overflow:auto;max-height:220px;}
    .code pre{margin:0;line-height:1.5;}
    .line{display:block;padding:2px 6px;border-radius:4px}
    .line.active{background:linear-gradient(90deg,rgba(6,182,212,0.08), rgba(6,182,212,0.02));border-left:4px solid rgba(6,182,212,0.28);color:#e6fbff}
    .footer-note{font-size:13px;color:var(--muted);line-height:1.4}
    .toggles{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
    .small{font-size:13px;color:var(--muted)}
    .legend{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .legend .item{display:flex;gap:6px;align-items:center;padding:6px 8px;border-radius:6px;background:rgba(255,255,255,0.02)}
    .color-swatch{width:14px;height:14px;border-radius:4px}
    /* bar colors */
    .bar.default{background:linear-gradient(180deg,var(--bar),#2b6cb0)}
    .bar.compare{background:linear-gradient(180deg,var(--warn),#f97316);transform:translateY(-6px)}
    .bar.swap{background:linear-gradient(180deg,var(--bad),#ea580c);transform:translateY(-8px)}
    .bar.sorted{background:linear-gradient(180deg,var(--good),#16a34a)}
    .bar.pivot{background:linear-gradient(180deg,#7c3aed,#a78bfa)}
    .input-area{display:flex;gap:6px}
    input[type="text"]{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:8px;color:inherit;flex:1}
    .hint{font-size:12px;color:var(--muted)}
    .credit{font-size:12px;color:var(--muted);text-align:center;margin-top:6px}
    @media (max-width:900px){
      body{padding:10px}
      .container{flex-direction:column}
      .right{width:100%}
    }
  </style>
</head>
<body>
  <div class="container" role="main">
    <div class="left" aria-label="Visualization panel">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <h2 style="margin:0">Bubble Sort</h2>
          <div class="hint">Visual step-by-step demonstration of Bubble Sort (stable, comparison sort)</div>
        </div>
        <div class="legend" aria-hidden="true">
          <div class="item"><div class="color-swatch" style="background:linear-gradient(180deg,var(--bar),#2b6cb0)"></div><div class="small">Unsorted</div></div>
          <div class="item"><div class="color-swatch" style="background:linear-gradient(180deg,var(--warn),#f97316)"></div><div class="small">Comparing</div></div>
          <div class="item"><div class="color-swatch" style="background:linear-gradient(180deg,var(--bad),#ea580c)"></div><div class="small">Swapping</div></div>
          <div class="item"><div class="color-swatch" style="background:linear-gradient(180deg,var(--good),#16a34a)"></div><div class="small">Sorted</div></div>
        </div>
      </div>

      <div class="bars-wrap" id="barsWrap" aria-live="polite" aria-atomic="true"></div>

      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px;gap:12px">
        <div class="controls">
          <button class="btn" id="playBtn" title="Play/Pause">Play</button>
          <button class="btn secondary" id="stepBtn" title="Do one step">Step</button>
          <button class="btn secondary" id="resetBtn" title="Reset to original array">Reset</button>
          <button class="btn ghost" id="randomBtn" title="Randomize array">Randomize</button>
        </div>

        <div style="display:flex;gap:10px;align-items:center">
          <label class="small">Speed</label>
          <input type="range" id="speed" min="50" max="1200" step="10" value="300" />
        </div>
      </div>

      <div style="display:flex;justify-content:space-between;gap:12px;margin-top:8px;align-items:center">
        <div style="display:flex;gap:8px;align-items:center">
          <label class="small">Array size</label>
          <input type="range" id="size" min="5" max="60" value="20" />
        </div>

        <div style="display:flex;gap:8px;align-items:center">
          <label class="small">Order</label>
          <select id="order" style="background:transparent;border-radius:8px;padding:6px;border:1px solid rgba(255,255,255,0.04);color:inherit">
            <option value="asc">Ascending</option>
            <option value="desc">Descending</option>
          </select>
        </div>

        <div style="display:flex;gap:8px;align-items:center">
          <label class="small">Optimized</label>
          <input type="checkbox" id="optimized" checked />
        </div>
      </div>

    </div>

    <div class="right" aria-label="Controls and explanation">
      <div style="display:flex;flex-direction:column;gap:8px">
        <div style="display:flex;gap:8px;align-items:center">
          <div style="flex:1">
            <div style="display:flex;gap:8px">
              <input type="text" id="customArray" placeholder="e.g. 5,1,4,2,8" aria-label="Enter custom array" />
              <button class="btn secondary" id="loadArray">Load</button>
            </div>
            <div class="hint" style="margin-top:6px">You can type comma-separated numbers. Click Load to use them.</div>
          </div>
        </div>

        <div class="stats" aria-hidden="false">
          <div class="stat"><div class="small">Comparisons</div><div class="num" id="compCount">0</div></div>
          <div class="stat"><div class="small">Swaps</div><div class="num" id="swapCount">0</div></div>
          <div class="stat"><div class="small">Pass</div><div class="num" id="passCount">0</div></div>
          <div class="stat"><div class="small">Status</div><div class="num" id="status">Ready</div></div>
        </div>

        <div class="code" aria-label="Bubble sort code">
          <pre id="codeBlock">
<span class="line" data-line="1">function bubbleSort(arr) {</span>
<span class="line" data-line="2">  let n = arr.length;</span>
<span class="line" data-line="3">  for (let i = 0; i &lt; n - 1; i++) {</span>
<span class="line" data-line="4">    let swapped = false;</span>
<span class="line" data-line="5">    for (let j = 0; j &lt; n - 1 - i; j++) {</span>
<span class="line" data-line="6">      // compare arr[j] and arr[j+1]</span>
<span class="line" data-line="7">      if (arr[j] &gt; arr[j+1]) {</span>
<span class="line" data-line="8">        // swap</span>
<span class="line" data-line="9">        [arr[j], arr[j+1]] = [arr[j+1], arr[j]];</span>
<span class="line" data-line="10">        swapped = true;</span>
<span class="line" data-line="11">      }</span>
<span class="line" data-line="12">    }</span>
<span class="line" data-line="13">    if (!swapped) break; // optimization</span>
<span class="line" data-line="14">  }</span>
<span class="line" data-line="15">  return arr;</span>
<span class="line" data-line="16">}</span>
          </pre>
        </div>

        <div class="footer-note">
          Bubble Sort repeatedly steps through the list, compares adjacent elements and swaps them if they are in the wrong order.
          Best case O(n) with optimization (already sorted), Average/Worst O(n^2). Stable and in-place.
        </div>
        <div class="credit">Interactive demo â€” highlight shows comparisons and swaps. Use Step to advance one operation at a time.</div>
      </div>
    </div>
  </div>

<script>
(() => {
  // DOM references
  const barsWrap = document.getElementById('barsWrap');
  const playBtn = document.getElementById('playBtn');
  const stepBtn = document.getElementById('stepBtn');
  const resetBtn = document.getElementById('resetBtn');
  const randomBtn = document.getElementById('randomBtn');
  const speedInput = document.getElementById('speed');
  const sizeInput = document.getElementById('size');
  const orderSelect = document.getElementById('order');
  const optimizedCheckbox = document.getElementById('optimized');
  const compCountEl = document.getElementById('compCount');
  const swapCountEl = document.getElementById('swapCount');
  const passCountEl = document.getElementById('passCount');
  const statusEl = document.getElementById('status');
  const customArrayInput = document.getElementById('customArray');
  const loadArrayBtn = document.getElementById('loadArray');
  const codeBlock = document.getElementById('codeBlock');

  // State
  let array = [];
  let initialArray = [];
  let bars = [];
  let playing = false;
  let autoTimer = null;
  let speed = Number(speedInput.value);
  let compCount = 0;
  let swapCount = 0;
  let passCount = 0;
  let stepGenerator = null;
  let ascending = true;
  let optimized = true;

  // Utility to create array
  function generateRandomArray(n){
    const arr = [];
    for (let i=0;i<n;i++) arr.push(Math.floor(Math.random()*100)+5);
    return arr;
  }

  // Render bars
  function renderBars(arr){
    barsWrap.innerHTML = '';
    bars = [];
    const max = Math.max(...arr, 1);
    arr.forEach((v, idx) => {
      const bar = document.createElement('div');
      bar.className = 'bar default';
      bar.style.height = (v / max * 100) + '%';
      bar.dataset.index = idx;
      const label = document.createElement('div');
      label.className = 'label';
      label.textContent = v;
      bar.appendChild(label);
      barsWrap.appendChild(bar);
      bars.push(bar);
    });
    // show labels for small arrays
    if (arr.length <= 20) bars.forEach(b=>b.classList.add('show-label')); else bars.forEach(b=>b.classList.remove('show-label'));
  }

  // Helpers to color bars
  function resetBarStyles(){
    bars.forEach(b=>{
      b.classList.remove('compare','swap','sorted','pivot');
      b.classList.add('default');
    });
  }

  function markCompare(i,j){
    resetBarStyles();
    bars[i].classList.remove('default'); bars[i].classList.add('compare');
    bars[j].classList.remove('default'); bars[j].classList.add('compare');
    highlightCodeLine(6);
  }

  function markSwap(i,j){
    resetBarStyles();
    bars[i].classList.remove('default'); bars[i].classList.add('swap');
    bars[j].classList.remove('default'); bars[j].classList.add('swap');
    highlightCodeLine(8);
  }

  function markSorted(index){
    bars[index].classList.remove('default','compare','swap');
    bars[index].classList.add('sorted');
  }

  function updateLabels(){
    const max = Math.max(...array, 1);
    array.forEach((v, idx)=>{
      bars[idx].style.height = (v / max * 100) + '%';
      const lbl = bars[idx].querySelector('.label');
      if (lbl) lbl.textContent = v;
    });
  }

  // Code highlighting
  function highlightCodeLine(n){
    const lines = codeBlock.querySelectorAll('.line');
    lines.forEach(ln => ln.classList.remove('active'));
    const target = codeBlock.querySelector('.line[data-line="'+n+'"]');
    if (target) target.classList.add('active');
  }

  function clearCodeHighlight(){
    const lines = codeBlock.querySelectorAll('.line');
    lines.forEach(ln => ln.classList.remove('active'));
  }

  // Bubble sort generator yields actions for visualization
  function* bubbleSortGenerator(arr, asc=true, opt=true){
    const n = arr.length;
    // lines: mapping for visualization (approx)
    // 2:n, 3:for i, 4:swapped, 5:for j, 6:compare, 7:if, 8:swap, 13:opt break
    yield {type:'init', n};
    for (let i=0;i<n-1;i++){
      let swapped = false;
      yield {type:'passStart', i};
      for (let j=0;j<n-1-i;j++){
        yield {type:'compare', i, j, j1:j+1};
        if ((asc && arr[j] > arr[j+1]) || (!asc && arr[j] < arr[j+1])){
          // perform swap
          yield {type:'swap', i, j, j1:j+1};
          const tmp = arr[j]; arr[j]=arr[j+1]; arr[j+1]=tmp;
          swapped = true;
        }
      }
      // element at position n-1-i is in correct place
      yield {type:'sorted', index:n-1-i, pass:i};
      if (!swapped && opt){
        yield {type:'earlyExit', pass:i};
        break;
      }
    }
    // mark remaining as sorted
    // find first unsorted index
    yield {type:'done'};
  }

  // Action handler
  async function handleAction(action){
    switch(action.type){
      case 'init':
        statusEl.textContent = 'Running';
        break;
      case 'passStart':
        passCount = action.i+1;
        passCountEl.textContent = passCount;
        highlightCodeLine(3);
        break;
      case 'compare':
        compCount++;
        compCountEl.textContent = compCount;
        highlightCodeLine(6);
        markCompare(action.j, action.j1);
        statusEl.textContent = `Comparing indices ${action.j} & ${action.j1}`;
        break;
      case 'swap':
        swapCount++;
        swapCountEl.textContent = swapCount;
        highlightCodeLine(9);
        markSwap(action.j, action.j1);
        // animate swap visually by swapping heights and data
        await animateSwap(action.j, action.j1);
        updateLabels();
        statusEl.textContent = `Swapped indices ${action.j} & ${action.j1}`;
        break;
      case 'sorted':
        markSorted(action.index);
        highlightCodeLine(13);
        statusEl.textContent = `Position ${action.index} is sorted`;
        break;
      case 'earlyExit':
        clearCodeHighlight();
        statusEl.textContent = `Early exit after pass ${action.pass} (no swaps)`;
        break;
      case 'done':
        // mark all sorted
        for (let i=0;i<bars.length;i++) markSorted(i);
        statusEl.textContent = 'Completed';
        highlightCodeLine(15);
        stopAuto();
        break;
    }
  }

  // Visual swap animation between bars i and j: swap heights and labels
  function animateSwap(i,j){
    return new Promise(resolve=>{
      // swap values in array
      const tmp = array[i]; array[i] = array[j]; array[j] = tmp;
      // swap heights
      const h1 = bars[i].style.height;
      const h2 = bars[j].style.height;
      bars[i].style.height = h2;
      bars[j].style.height = h1;
      // swap labels if visible
      const l1 = bars[i].querySelector('.label');
      const l2 = bars[j].querySelector('.label');
      if (l1 && l2){
        const t1 = l1.textContent; l1.textContent = l2.textContent; l2.textContent = t1;
      }
      // small transform to emphasize
      bars[i].style.transform = 'translateY(-6px)';
      bars[j].style.transform = 'translateY(-6px)';
      setTimeout(()=>{
        bars[i].style.transform = '';
        bars[j].style.transform = '';
        // also update classes
        bars[i].classList.remove('swap'); bars[i].classList.add('compare');
        bars[j].classList.remove('swap'); bars[j].classList.add('compare');
        setTimeout(()=>resolve(), Math.max(80, speed/3));
      }, Math.max(150, speed/2));
    });
  }

  // Control auto play
  function startAuto(){
    if (playing) return;
    playing = true;
    playBtn.textContent = 'Pause';
    statusEl.textContent = 'Playing';
    autoStep();
  }

  function stopAuto(){
    playing = false;
    playBtn.textContent = 'Play';
    if (autoTimer) { clearTimeout(autoTimer); autoTimer=null; }
  }

  async function autoStep(){
    if (!playing) return;
    const next = stepGenerator.next();
    if (next.done){
      stopAuto();
      return;
    }
    await handleAction(next.value);
    // schedule next
    autoTimer = setTimeout(()=>autoStep(), speed);
  }

  // Single step
  async function stepOnce(){
    if (!stepGenerator) return;
    const next = stepGenerator.next();
    if (next.done){
      statusEl.textContent = 'Completed';
      stopAuto();
      return;
    }
    await handleAction(next.value);
  }

  // Reset to initial array
  function reset(){
    stopAuto();
    array = initialArray.slice();
    renderBars(array);
    compCount = swapCount = passCount = 0;
    compCountEl.textContent = '0';
    swapCountEl.textContent = '0';
    passCountEl.textContent = '0';
    statusEl.textContent = 'Ready';
    stepGenerator = bubbleSortGenerator(array, ascending, optimized);
    clearCodeHighlight();
    resetBarStyles();
  }

  // Randomize and prepare
  function randomize(){
    const n = Number(sizeInput.value);
    array = generateRandomArray(n);
    initialArray = array.slice();
    renderBars(array);
    compCount = swapCount = passCount = 0;
    compCountEl.textContent = '0';
    swapCountEl.textContent = '0';
    passCountEl.textContent = '0';
    stepGenerator = bubbleSortGenerator(array, ascending, optimized);
    statusEl.textContent = 'Ready';
    clearCodeHighlight();
  }

  // Load custom array
  function loadCustom(){
    const txt = customArrayInput.value.trim();
    if (!txt) return alert('Enter comma separated numbers (e.g. 5,1,4,2)');
    const parts = txt.split(/[\s,]+/).map(s=>Number(s)).filter(n=>!isNaN(n));
    if (parts.length === 0) return alert('No valid numbers found');
    array = parts.slice();
    initialArray = array.slice();
    renderBars(array);
    compCount = swapCount = passCount = 0;
    compCountEl.textContent = '0';
    swapCountEl.textContent = '0';
    passCountEl.textContent = '0';
    stepGenerator = bubbleSortGenerator(array, ascending, optimized);
    statusEl.textContent = 'Ready';
    clearCodeHighlight();
  }

  // Event listeners
  playBtn.addEventListener('click', ()=>{
    if (playing){
      stopAuto();
      statusEl.textContent = 'Paused';
    } else {
      // if generator finished, reinitialize
      if (!stepGenerator) stepGenerator = bubbleSortGenerator(array, ascending, optimized);
      startAuto();
    }
  });

  stepBtn.addEventListener('click', async ()=>{
    if (playing) return; // do not step while playing
    if (!stepGenerator) stepGenerator = bubbleSortGenerator(array, ascending, optimized);
    await stepOnce();
  });

  resetBtn.addEventListener('click', reset);
  randomBtn.addEventListener('click', () => { randomize(); });

  speedInput.addEventListener('input', (e)=>{ speed = Number(e.target.value); });
  sizeInput.addEventListener('input', (e)=>{
    // change size immediate
    const n = Number(e.target.value);
    array = generateRandomArray(n);
    initialArray = array.slice();
    renderBars(array);
    compCount = swapCount = passCount = 0;
    compCountEl.textContent = '0';
    swapCountEl.textContent = '0';
    passCountEl.textContent = '0';
    stepGenerator = bubbleSortGenerator(array, ascending, optimized);
    statusEl.textContent = 'Ready';
  });

  orderSelect.addEventListener('change', (e)=> {
    ascending = e.target.value === 'asc';
    reset();
  });

  optimizedCheckbox.addEventListener('change', (e)=>{
    optimized = e.target.checked;
    reset();
  });

  loadArrayBtn.addEventListener('click', loadCustom);

  // Initialize
  function init(){
    ascending = orderSelect.value === 'asc';
    optimized = optimizedCheckbox.checked;
    array = generateRandomArray(Number(sizeInput.value));
    initialArray = array.slice();
    renderBars(array);
    stepGenerator = bubbleSortGenerator(array, ascending, optimized);
    statusEl.textContent = 'Ready';
  }

  // On page load
  init();

  // Accessibility: keyboard shortcuts
  window.addEventListener('keydown', (e)=>{
    if (e.key === ' '){
      e.preventDefault();
      playBtn.click();
    } else if (e.key === 'ArrowRight'){
      e.preventDefault();
      stepBtn.click();
    } else if (e.key === 'r' || e.key === 'R'){
      resetBtn.click();
    }
  });

})();
</script>
</body>
</html>