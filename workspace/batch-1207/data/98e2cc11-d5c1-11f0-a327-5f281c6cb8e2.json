{
  "id": "98e2cc11-d5c1-11f0-a327-5f281c6cb8e2",
  "timestamp": "2025-12-10T12:17:10.098Z",
  "model": "gpt-5-mini",
  "status": "success",
  "question": "Sliding Window",
  "answer": {
    "role": "assistant",
    "content": "<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\" />\n  <title>Sliding Window Visualizer</title>\n  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n  <style>\n    :root{\n      --bg:#0f1724;\n      --panel:#0b1220;\n      --accent:#4f46e5;\n      --muted:#94a3b8;\n      --card:#0b1220;\n      --good:#10b981;\n      --bad:#ef4444;\n      --glass: rgba(255,255,255,0.03);\n    }\n    html,body{\n      height:100%;\n      margin:0;\n      font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,\"Helvetica Neue\",Arial;\n      background: linear-gradient(180deg,#071020 0%, #071827 100%);\n      color:#e6eef8;\n    }\n    .container{\n      max-width:1200px;\n      margin:18px auto;\n      padding:18px;\n    }\n    header{\n      display:flex;\n      gap:16px;\n      align-items:center;\n      margin-bottom:16px;\n    }\n    header h1{\n      margin:0;\n      font-size:20px;\n      letter-spacing:0.2px;\n    }\n    .layout{\n      display:grid;\n      grid-template-columns: 320px 1fr 360px;\n      gap:16px;\n      align-items:start;\n    }\n    .panel{\n      background:var(--panel);\n      border-radius:12px;\n      padding:14px;\n      box-shadow: 0 6px 30px rgba(2,6,23,0.6);\n      min-height:120px;\n    }\n    label{display:block; font-size:13px; color:var(--muted); margin-bottom:6px;}\n    input[type=\"text\"], input[type=\"number\"], select{\n      width:100%;\n      padding:8px 10px;\n      border-radius:8px;\n      border:1px solid rgba(255,255,255,0.03);\n      background:transparent;\n      color:inherit;\n      outline:none;\n      box-sizing:border-box;\n    }\n    .row{display:flex; gap:8px; align-items:center;}\n    .row.space{justify-content:space-between;}\n    .btn{\n      display:inline-flex;\n      align-items:center;\n      justify-content:center;\n      gap:8px;\n      padding:8px 10px;\n      border-radius:8px;\n      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));\n      border:1px solid rgba(255,255,255,0.03);\n      color:inherit;\n      cursor:pointer;\n      user-select:none;\n    }\n    .btn.primary{\n      background:linear-gradient(180deg,var(--accent),#3760e3);\n      color:#fff;\n      border:none;\n      box-shadow: 0 6px 20px rgba(79,70,229,0.18);\n    }\n    .controls{display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px;}\n    .vis{\n      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));\n      border-radius:12px;\n      padding:12px;\n      height:420px;\n      display:flex;\n      flex-direction:column;\n      gap:12px;\n      justify-content:flex-start;\n    }\n    .bars{\n      display:flex;\n      gap:6px;\n      align-items:end;\n      height:280px;\n      padding:8px;\n      border-radius:8px;\n      background:var(--glass);\n      overflow:hidden;\n      position:relative;\n    }\n    .bar{\n      width:36px;\n      background:linear-gradient(180deg,#60a5fa,#2563eb);\n      border-radius:6px 6px 3px 3px;\n      display:flex;\n      align-items:flex-end;\n      justify-content:center;\n      color:#08122b;\n      font-weight:600;\n      font-size:13px;\n      position:relative;\n    }\n    .bar .val{\n      transform:translateY(-6px);\n      font-size:12px;\n      color:#0b1220;\n      padding:4px 6px;\n      border-radius:6px;\n      background:rgba(255,255,255,0.9);\n    }\n    .bar.label{\n      background:transparent;\n      color:var(--muted);\n    }\n    .bar.in-window{\n      outline: 3px solid rgba(79,70,229,0.18);\n      box-shadow: 0 8px 22px rgba(79,70,229,0.08);\n      transform:translateY(-6px);\n    }\n    .bar.out-of-window{\n      filter:grayscale(60%) brightness(0.8);\n      opacity:0.7;\n    }\n    .pointers{\n      display:flex;\n      gap:12px;\n      font-size:13px;\n      color:var(--muted);\n      align-items:center;\n      flex-wrap:wrap;\n    }\n    .status{\n      margin-top:8px;\n      background:rgba(255,255,255,0.02);\n      padding:10px;\n      border-radius:8px;\n      font-size:14px;\n      color:#dbeafe;\n    }\n    .code{\n      background:#07102a;\n      border-radius:8px;\n      padding:12px;\n      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, \"Roboto Mono\", \"Courier New\", monospace;\n      font-size:13px;\n      color:#cbd5e1;\n      line-height:1.5;\n      white-space:pre-wrap;\n    }\n    .deque{\n      display:flex;\n      gap:8px;\n      align-items:center;\n      flex-wrap:wrap;\n      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, monospace;\n    }\n    .dq-item{\n      padding:6px 10px;\n      background:linear-gradient(180deg,#111827,#0b1220);\n      border-radius:8px;\n      border:1px solid rgba(255,255,255,0.03);\n      color:#9fb4ff;\n      font-weight:600;\n    }\n    .small{font-size:13px;color:var(--muted);}\n    footer{margin-top:14px; font-size:13px; color:var(--muted);}\n    .hint{font-size:13px; color:var(--muted); margin-top:6px;}\n    /* responsive */\n    @media (max-width:1050px){\n      .layout{\n        grid-template-columns: 1fr;\n      }\n      .panel{min-height:unset;}\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <header>\n      <h1>Sliding Window Visualizer</h1>\n      <div class=\"small\" style=\"margin-left:auto; color:var(--muted);\">Interactive demo: fixed-size and variable-size sliding window techniques</div>\n    </header>\n\n    <div class=\"layout\">\n      <div class=\"panel\">\n        <label for=\"mode\">Mode</label>\n        <select id=\"mode\">\n          <option value=\"fixed\">Fixed-size window (sum / avg / max)</option>\n          <option value=\"deque\">Fixed-size window — optimized max (deque)</option>\n          <option value=\"varsum\">Variable window — longest subarray with sum ≤ S</option>\n          <option value=\"kdistinct\">Variable window — longest substring with ≤ K distinct</option>\n        </select>\n\n        <div style=\"height:8px\"></div>\n\n        <label>Array / String (comma-separated numbers or plain string)</label>\n        <input id=\"inputData\" type=\"text\" value=\"2,1,3,4,6,2,3,5,1\" />\n\n        <div class=\"controls\" style=\"margin-top:10px;\">\n          <div style=\"display:flex; gap:8px; align-items:center;\">\n            <button id=\"randomBtn\" class=\"btn\">Randomize</button>\n            <button id=\"applyBtn\" class=\"btn primary\">Apply</button>\n          </div>\n        </div>\n\n        <div style=\"height:10px\"></div>\n\n        <div id=\"fixedControls\">\n          <label>Window size k</label>\n          <input id=\"kInput\" type=\"number\" min=\"1\" value=\"3\" />\n          <div style=\"height:10px\"></div>\n          <label>Operation</label>\n          <select id=\"operation\">\n            <option value=\"sum\">Sum</option>\n            <option value=\"avg\">Average</option>\n            <option value=\"max\">Max (naive)</option>\n          </select>\n        </div>\n\n        <div id=\"dequeControls\" style=\"display:none;\">\n          <label>Window size k</label>\n          <input id=\"kInput2\" type=\"number\" min=\"1\" value=\"3\" />\n          <div class=\"hint\">Shows step-by-step monotonic deque algorithm for maximum in a sliding window.</div>\n        </div>\n\n        <div id=\"varsumControls\" style=\"display:none;\">\n          <label>Threshold S (sum ≤ S)</label>\n          <input id=\"sInput\" type=\"number\" step=\"1\" value=\"10\" />\n          <div class=\"hint\">Finds the longest contiguous subarray whose sum does not exceed S.</div>\n        </div>\n\n        <div id=\"kdistinctControls\" style=\"display:none;\">\n          <label>K (max distinct characters)</label>\n          <input id=\"kInput3\" type=\"number\" min=\"1\" value=\"2\" />\n          <div class=\"hint\">Input will be treated as a string. Finds the longest substring with at most K distinct characters.</div>\n        </div>\n\n        <hr style=\"border:none; height:1px; background:rgba(255,255,255,0.02); margin:12px 0;\">\n\n        <div style=\"display:flex; gap:8px; align-items:center; flex-wrap:wrap;\">\n          <button id=\"prevBtn\" class=\"btn\">⟨ Prev</button>\n          <button id=\"playBtn\" class=\"btn primary\">Play ▶</button>\n          <button id=\"nextBtn\" class=\"btn\">Next ⟩</button>\n          <div style=\"width:8px\"></div>\n          <label class=\"small\" style=\"margin:0\">Speed</label>\n          <input id=\"speed\" type=\"range\" min=\"200\" max=\"2000\" step=\"50\" value=\"800\" />\n        </div>\n\n      </div>\n\n      <div class=\"panel vis\">\n        <div style=\"display:flex; justify-content:space-between; align-items:center;\">\n          <div style=\"display:flex; gap:12px; align-items:center;\">\n            <div class=\"small\">Array visualization</div>\n            <div class=\"small\" id=\"arrayInfo\" style=\"color:var(--muted)\"></div>\n          </div>\n          <div class=\"small\" id=\"stepIndicator\" style=\"color:var(--muted)\">Step 0 / 0</div>\n        </div>\n\n        <div id=\"bars\" class=\"bars\" aria-hidden=\"false\"></div>\n\n        <div class=\"pointers\">\n          <div class=\"small\">Left: <span id=\"leftIdx\">-</span></div>\n          <div class=\"small\">Right: <span id=\"rightIdx\">-</span></div>\n          <div class=\"small\">Window indices: <span id=\"windowIdx\">-</span></div>\n          <div class=\"small\">Current value: <strong id=\"currentValue\">-</strong></div>\n          <div class=\"small\">Best / Result: <strong id=\"bestValue\">-</strong></div>\n        </div>\n\n        <div class=\"status\" id=\"description\" style=\"min-height:40px;\">Press Apply to build steps. Use Play / Next to animate.</div>\n      </div>\n\n      <div class=\"panel\">\n        <div style=\"display:flex; justify-content:space-between; align-items:start; gap:8px;\">\n          <div>\n            <div class=\"small\">Algorithm state</div>\n            <div style=\"height:8px\"></div>\n            <div id=\"dequeView\" style=\"display:none;\">\n              <div class=\"small\">Deque (indices → values)</div>\n              <div class=\"deque\" id=\"dequeContainer\"></div>\n            </div>\n          </div>\n          <div style=\"text-align:right;\">\n            <div class=\"small\">Pseudo-code</div>\n          </div>\n        </div>\n\n        <div style=\"height:12px\"></div>\n\n        <div id=\"codeArea\" class=\"code\">\n          Choose a mode and press Apply to view pseudo-code and run steps.\n        </div>\n\n        <div style=\"height:8px\"></div>\n        <div class=\"hint\">Tip: Try the deque mode to see how we maintain a monotonic queue for O(n) max per window. Variable modes demonstrate two-pointer expansion/shrink patterns.</div>\n      </div>\n    </div>\n\n    <footer>\n      Built for education — demonstrates sliding-window patterns: fixed-size, optimized deque for max, and variable-size (two-pointer) techniques.\n    </footer>\n  </div>\n\n  <script>\n    // Utility helpers\n    function $(id){return document.getElementById(id);}\n    function parseArrayInput(str){\n      str = str.trim();\n      if(!str) return [];\n      // if string contains commas or digits, try parse numbers; else treat as plain string\n      if(/[,\\d\\-]/.test(str) && /[,\\d]/.test(str)) {\n        // parse numbers separated by commas/spaces\n        const parts = str.split(/[\\s,]+/).filter(Boolean);\n        const arr = parts.map(x => {\n          const n = Number(x);\n          return isNaN(n) ? 0 : n;\n        });\n        return arr;\n      }\n      // fallback: treat as characters\n      return str.split('');\n    }\n\n    // DOM refs\n    const modeEl = $('mode');\n    const inputDataEl = $('inputData');\n    const randomBtn = $('randomBtn');\n    const applyBtn = $('applyBtn');\n    const kInput = $('kInput');\n    const kInput2 = $('kInput2');\n    const kInput3 = $('kInput3');\n    const sInput = $('sInput');\n    const operationEl = $('operation');\n    const prevBtn = $('prevBtn');\n    const nextBtn = $('nextBtn');\n    const playBtn = $('playBtn');\n    const barsDiv = $('bars');\n    const leftIdx = $('leftIdx');\n    const rightIdx = $('rightIdx');\n    const windowIdx = $('windowIdx');\n    const currentValue = $('currentValue');\n    const bestValue = $('bestValue');\n    const description = $('description');\n    const stepIndicator = $('stepIndicator');\n    const codeArea = $('codeArea');\n    const dequeView = $('dequeView');\n    const dequeContainer = $('dequeContainer');\n    const dequeControls = $('dequeControls');\n    const fixedControls = $('fixedControls');\n    const varsumControls = $('varsumControls');\n    const kdistinctControls = $('kdistinctControls');\n    const arrayInfo = $('arrayInfo');\n    const speedEl = $('speed');\n\n    let data = [];\n    let steps = [];\n    let currentStep = 0;\n    let timer = null;\n\n    function randomArray(n=9, min=-2, max=9){\n      const a=[];\n      for(let i=0;i<n;i++) a.push(Math.floor(Math.random()*(max-min+1))+min);\n      return a;\n    }\n\n    function randomString(n=12){\n      const chars = 'abacdecfghijklmnopqrstuvwxyz';\n      let s='';\n      for(let i=0;i<n;i++) s += chars[Math.floor(Math.random()*chars.length)];\n      return s;\n    }\n\n    function setModeUI(){\n      const mode = modeEl.value;\n      fixedControls.style.display = (mode==='fixed') ? 'block' : 'none';\n      dequeControls.style.display = (mode==='deque') ? 'block' : 'none';\n      varsumControls.style.display = (mode==='varsum') ? 'block' : 'none';\n      kdistinctControls.style.display = (mode==='kdistinct') ? 'block' : 'none';\n      // update pseudo-code\n      updateCodeSnippet(mode);\n    }\n\n    modeEl.addEventListener('change', ()=>{\n      setModeUI();\n      // change input placeholder depending on mode\n      if(modeEl.value==='kdistinct'){\n        inputDataEl.value = 'abcbaacbb';\n      } else if(modeEl.value==='varsum'){\n        inputDataEl.value = '2,1,3,4,6,2,3,5,1';\n      }\n    });\n\n    randomBtn.addEventListener('click', ()=>{\n      const m = modeEl.value;\n      if(m==='kdistinct'){\n        inputDataEl.value = randomString(12);\n      } else {\n        inputDataEl.value = randomArray(9,1,9).join(',');\n      }\n    });\n\n    applyBtn.addEventListener('click', buildSteps);\n    prevBtn.addEventListener('click', ()=>{ pause(); stepTo(currentStep-1); });\n    nextBtn.addEventListener('click', ()=>{ pause(); stepTo(currentStep+1); });\n    playBtn.addEventListener('click', togglePlay);\n\n    function togglePlay(){\n      if(timer) pause();\n      else play();\n    }\n    function play(){\n      if(steps.length===0) return;\n      playBtn.textContent = 'Pause ⏸';\n      timer = setInterval(()=> {\n        if(currentStep >= steps.length-1){\n          pause();\n        } else {\n          stepTo(currentStep+1);\n        }\n      }, Number(speedEl.value));\n    }\n    function pause(){\n      if(timer) clearInterval(timer);\n      timer = null;\n      playBtn.textContent = 'Play ▶';\n    }\n\n    function updateCodeSnippet(mode){\n      let text = '';\n      if(mode==='fixed'){\n        text = `Fixed-size sliding window (naive):\nfor i from 0 to n-k:\n  window = arr[i..i+k-1]\n  compute sum/avg/max by scanning window\nTime: O(n*k) (naive)\\n\\nTip: Use cumulative sums for sums/averages in O(n).`;\n      } else if(mode==='deque'){\n        text = `Monotonic deque for sliding-window maximum (O(n)):\ndeque = empty (store indices)\nfor i in 0..n-1:\n  // remove out-of-window indices\n  while deque not empty and deque.front <= i - k:\n    pop front\n  // maintain decreasing values\n  while deque not empty and arr[i] >= arr[deque.back]:\n    pop back\n  push i onto back\n  if i >= k-1:\n    max = arr[deque.front]\\n\\nThis maintains a decreasing queue of candidates.`;\n      } else if(mode==='varsum'){\n        text = `Two-pointer for longest subarray with sum ≤ S:\nleft = 0, sum = 0, best = 0\nfor right in 0..n-1:\n  sum += arr[right]\n  while sum > S and left <= right:\n    sum -= arr[left]\n    left += 1\n  // now sum ≤ S, update best length\n  best = max(best, right - left + 1)`;\n      } else if(mode==='kdistinct'){\n        text = `Sliding window for longest substring with ≤ K distinct chars:\nleft = 0, best = 0\nfreq = empty map\nfor right in 0..n-1:\n  freq[s[right]]++\n  while distinct(freq) > K:\n    freq[s[left]]--\n    if freq[s[left]] == 0: remove\n    left++\n  best = max(best, right - left + 1)`;\n      }\n      codeArea.textContent = text;\n    }\n\n    // Build visual bars (numbers or chars)\n    function renderBars(){\n      barsDiv.innerHTML = '';\n      const max = Math.max(...data.map(v => typeof v === 'number' ? Math.abs(v) : 1), 1);\n      const n = data.length;\n      arrayInfo.textContent = `n = ${n}`;\n      for(let i=0;i<n;i++){\n        const v = data[i];\n        const bar = document.createElement('div');\n        bar.className = 'bar';\n        bar.dataset.index = i;\n        if(typeof v === 'number'){\n          const h = Math.max(14, Math.round((Math.abs(v)/max)*220)+16);\n          bar.style.height = `${h}px`;\n          // color: positives blue, negatives red, zero neutral\n          if(v < 0){\n            bar.style.background = 'linear-gradient(180deg,#fca5a5,#ef4444)';\n            bar.style.color = '#2b0b0b';\n          } else {\n            bar.style.background = 'linear-gradient(180deg,#60a5fa,#2563eb)';\n            bar.style.color = '#07122b';\n          }\n          const span = document.createElement('div');\n          span.className = 'val';\n          span.textContent = v;\n          bar.appendChild(span);\n        } else {\n          // char\n          bar.style.height = `60px`;\n          bar.style.width = '40px';\n          bar.style.background = 'linear-gradient(180deg,#94a3b8,#475569)';\n          bar.style.borderRadius = '8px';\n          bar.style.color = '#08122b';\n          const span = document.createElement('div');\n          span.className = 'val';\n          span.textContent = v;\n          bar.appendChild(span);\n        }\n        barsDiv.appendChild(bar);\n      }\n    }\n\n    // Steps structure: array of step objects: {left, right, window: [i..j], deque: [{idx,val}], current, best, desc}\n    function buildSteps(){\n      pause();\n      steps = [];\n      currentStep = 0;\n      dequeView.style.display = 'none';\n      dequeContainer.innerHTML = '';\n      const raw = inputDataEl.value;\n      data = parseArrayInput(raw);\n      if(data.length===0){ alert('Input empty'); return; }\n      renderBars();\n      const mode = modeEl.value;\n      if(mode==='fixed'){\n        const k = Number(kInput.value);\n        if(k <=0){ alert('k must be >=1'); return;}\n        buildFixedSteps(data, k, operationEl.value);\n      } else if(mode==='deque'){\n        const k = Number(kInput2.value);\n        if(k <=0){ alert('k must be >=1'); return;}\n        buildDequeSteps(data, k);\n      } else if(mode==='varsum'){\n        const S = Number(sInput.value);\n        buildVarSumSteps(data, S);\n      } else if(mode==='kdistinct'){\n        const k = Number(kInput3.value);\n        const s = typeof data === 'string' ? data : (Array.isArray(data) ? data.join('') : inputDataEl.value);\n        buildKDistinctSteps(s, k);\n      }\n      stepTo(0);\n    }\n\n    // ------ Fixed-size naive steps ------\n    function buildFixedSteps(arr, k, operation){\n      const n = arr.length;\n      if(k > n){\n        description.textContent = `Window size k=${k} is larger than array length ${n}. No steps.`;\n        steps = [];\n        return;\n      }\n      let best = (operation === 'max') ? -Infinity : (operation === 'sum' || operation === 'avg') ? null : null;\n      for(let i=0;i<=n-k;i++){\n        const left = i;\n        const right = i+k-1;\n        const window = arr.slice(left, right+1).map(x=>x);\n        let current;\n        if(operation==='sum'){\n          current = window.reduce((a,b)=>Number(a)+Number(b),0);\n          best = (best===null)?current:Math.max(best,current);\n        } else if(operation==='avg'){\n          current = window.reduce((a,b)=>Number(a)+Number(b),0)/k;\n          best = (best===null)?current:Math.max(best,current);\n        } else if(operation==='max'){\n          current = window.reduce((a,b)=>Math.max(a,b), -Infinity);\n          best = Math.max(best,current);\n        }\n        steps.push({\n          left, right, window: [left,right],\n          deque: [],\n          current,\n          best,\n          desc: `Window [${left}..${right}] → values: [${window.join(', ')}]. ${operation} = ${Number.isFinite(current) ? current : current}`\n        });\n      }\n      description.textContent = `Naive sliding window (${operation}) produced ${steps.length} windows.`;\n      updateCodeSnippet('fixed');\n    }\n\n    // ------ Deque optimized max steps ------\n    function buildDequeSteps(arr, k){\n      const n = arr.length;\n      if(k > n){\n        description.textContent = `Window size k=${k} is larger than array length ${n}. No steps.`;\n        steps = [];\n        return;\n      }\n      dequeView.style.display = 'block';\n      updateCodeSnippet('deque');\n\n      let dq = []; // will store indices\n      let bestResults = [];\n      for(let i=0;i<n;i++){\n        // Step: process arr[i] insertion with description of pops\n        let stepBefore = {\n          left: null, right: i,\n          window: null,\n          deque: dq.slice(),\n          current: null,\n          best: null,\n          desc: `Processing index ${i}, value=${arr[i]}.`\n        };\n        steps.push({...stepBefore, desc: `Processing index ${i}, value=${arr[i]}. Remove outdated at front if any.`});\n        // remove out-of-window from front\n        if(dq.length && dq[0] <= i - k){\n          let popped = dq[0];\n          dq = dq.slice(1);\n          steps.push({\n            left: null, right: i,\n            window: null,\n            deque: dq.slice(),\n            current: null,\n            best: null,\n            desc: `Removed index ${popped} from front (out of window range).`\n          });\n        }\n        // remove from back while arr[i] >= arr[dq.back]\n        while(dq.length && arr[i] >= arr[dq[dq.length-1]]){\n          let popped = dq[dq.length-1];\n          dq.pop();\n          steps.push({\n            left: null, right: i,\n            window: null,\n            deque: dq.slice(),\n            current: null,\n            best: null,\n            desc: `Popped index ${popped} from back because arr[${i}] (${arr[i]}) >= arr[${popped}] (${arr[popped]}).`\n          });\n        }\n        // push i\n        dq.push(i);\n        steps.push({\n          left: null, right: i,\n          window: null,\n          deque: dq.slice(),\n          current: null,\n          best: null,\n          desc: `Pushed index ${i}. Deque now: [${dq.join(', ')}] (indices).`\n        });\n        // if we have first full window, record max\n        if(i >= k-1){\n          const left = i - k + 1;\n          const right = i;\n          const maxVal = arr[dq[0]];\n          steps.push({\n            left, right,\n            window: [left,right],\n            deque: dq.slice(),\n            current: maxVal,\n            best: null,\n            desc: `Window [${left}..${right}] full. Current max = arr[${dq[0]}] = ${maxVal}.`\n          });\n        }\n      }\n      description.textContent = `Deque steps generated (${steps.length} internal steps) for k=${k}.`;\n    }\n\n    // ------ Variable sum ≤ S steps ------\n    function buildVarSumSteps(arr, S){\n      const n = arr.length;\n      let left = 0, sum = 0, best = 0, bestRange = null;\n      updateCodeSnippet('varsum');\n      for(let right=0; right<n; right++){\n        sum += Number(arr[right]);\n        steps.push({\n          left, right,\n          window: [left,right],\n          deque: [],\n          current: sum,\n          best,\n          desc: `Added arr[${right}] = ${arr[right]}; sum = ${sum}.`\n        });\n        while(sum > S && left <= right){\n          steps.push({\n            left, right,\n            window: [left,right],\n            deque: [],\n            current: sum,\n            best,\n            desc: `sum (${sum}) > S (${S}). Shrinking: remove arr[${left}] = ${arr[left]}.`\n          });\n          sum -= Number(arr[left]);\n          left++;\n          steps.push({\n            left, right,\n            window: [left,right],\n            deque: [],\n            current: sum,\n            best,\n            desc: `After shrinking left -> ${left}, sum = ${sum}.`\n          });\n        }\n        // now sum <= S\n        if(sum <= S){\n          const len = right - left + 1;\n          if(len > best){\n            best = len;\n            bestRange = [left,right];\n            steps.push({\n              left, right,\n              window: [left,right],\n              deque: [],\n              current: sum,\n              best,\n              desc: `Valid window [${left}..${right}] (sum=${sum}). New best length = ${best}.`\n            });\n          } else {\n            steps.push({\n              left, right,\n              window: [left,right],\n              deque: [],\n              current: sum,\n              best,\n              desc: `Valid window [${left}..${right}] (sum=${sum}). Best remains ${best}.`\n            });\n          }\n        }\n      }\n      description.textContent = `Two-pointer steps generated for S=${S}. Best length = ${best}${bestRange ? ` in [${bestRange[0]}..${bestRange[1]}]` : ''}.`;\n    }\n\n    // ------ K distinct chars steps ------\n    function buildKDistinctSteps(str, K){\n      // treat str as string of chars\n      const arr = str.split('');\n      const n = arr.length;\n      let left = 0, best = 0, bestRange = null;\n      const freq = {};\n      updateCodeSnippet('kdistinct');\n      for(let right=0; right<n; right++){\n        const ch = arr[right];\n        freq[ch] = (freq[ch]||0)+1;\n        steps.push({\n          left, right,\n          window: [left,right],\n          deque: [],\n          current: Object.keys(freq).length,\n          best,\n          desc: `Added '${ch}' at ${right}. Distinct now = ${Object.keys(freq).length}.`\n        });\n        while(Object.keys(freq).length > K){\n          const rem = arr[left];\n          steps.push({\n            left, right,\n            window: [left,right],\n            deque: [],\n            current: Object.keys(freq).length,\n            best,\n            desc: `Too many distinct (>${K}). Removing '${rem}' at left=${left}.`\n          });\n          freq[rem]--;\n          if(freq[rem] === 0) delete freq[rem];\n          left++;\n          steps.push({\n            left, right,\n            window: [left,right],\n            deque: [],\n            current: Object.keys(freq).length,\n            best,\n            desc: `After removal left=${left}. Distinct = ${Object.keys(freq).length}.`\n          });\n        }\n        // now valid\n        const len = right - left + 1;\n        if(len > best){\n          best = len; bestRange = [left,right];\n          steps.push({\n            left, right,\n            window: [left,right],\n            deque: [],\n            current: Object.keys(freq).length,\n            best,\n            desc: `Valid substring '${arr.slice(left,right+1).join('')}'. New best length = ${best}.`\n          });\n        } else {\n          steps.push({\n            left, right,\n            window: [left,right],\n            deque: [],\n            current: Object.keys(freq).length,\n            best,\n            desc: `Valid substring '${arr.slice(left,right+1).join('')}'. Best remains ${best}.`\n          });\n        }\n      }\n      description.textContent = `Longest substring with ≤ ${K} distinct: length=${best}${bestRange? `, range [${bestRange[0]}..${bestRange[1]}]` : ''}.`;\n    }\n\n    // Step rendering\n    function stepTo(i){\n      if(steps.length===0){\n        stepIndicator.textContent = 'Step 0 / 0';\n        description.textContent = 'No steps available. Press Apply to generate steps.';\n        leftIdx.textContent = '-';\n        rightIdx.textContent = '-';\n        windowIdx.textContent = '-';\n        currentValue.textContent = '-';\n        bestValue.textContent = '-';\n        renderBars();\n        return;\n      }\n      if(i < 0) i = 0;\n      if(i > steps.length-1) i = steps.length-1;\n      currentStep = i;\n      const s = steps[i];\n      // update indicator\n      stepIndicator.textContent = `Step ${i+1} / ${steps.length}`;\n      // update description\n      description.textContent = s.desc || '';\n      // update pointers\n      leftIdx.textContent = (s.left == null) ? '-' : s.left;\n      rightIdx.textContent = (s.right == null) ? '-' : s.right;\n      windowIdx.textContent = (s.window && s.window.length===2) ? `[${s.window[0]}..${s.window[1]}]` : '-';\n      currentValue.textContent = s.current == null ? '-' : s.current;\n      bestValue.textContent = s.best == null ? '-' : s.best;\n\n      // highlight bars depending on window\n      const barElems = barsDiv.querySelectorAll('.bar');\n      barElems.forEach(b => {\n        b.classList.remove('in-window','out-of-window');\n      });\n\n      if(s.window && s.window.length===2){\n        const L = s.window[0], R = s.window[1];\n        barElems.forEach(b => {\n          const idx = Number(b.dataset.index);\n          if(idx >= L && idx <= R) b.classList.add('in-window');\n          else b.classList.add('out-of-window');\n        });\n      } else if(typeof s.left === 'number' && typeof s.right === 'number'){\n        // when left/right denote pointers but not full window\n        const L = s.left, R = s.right;\n        barElems.forEach(b => {\n          const idx = Number(b.dataset.index);\n          if(idx >= L && idx <= R) b.classList.add('in-window');\n          else b.classList.add('out-of-window');\n        });\n      } else {\n        barElems.forEach(b => b.classList.remove('out-of-window'));\n      }\n\n      // deque view\n      if(s.deque && s.deque.length){\n        dequeView.style.display = 'block';\n      } else {\n        // only show deque view in deque mode (we keep block when used)\n        // But hide if no deque\n        if(modeEl.value !== 'deque') dequeView.style.display = 'none';\n      }\n      dequeContainer.innerHTML = '';\n      if(s.deque && s.deque.length){\n        s.deque.forEach(idx=>{\n          const item = document.createElement('div');\n          item.className = 'dq-item';\n          item.textContent = `${idx} → ${data[idx]}`;\n          dequeContainer.appendChild(item);\n        });\n      }\n\n      // simple auto-scroll: center current window\n      // Not necessary but helpful for long arrays: shift container scrollLeft\n      // Compute bounding\n      const firstIn = barsDiv.querySelector('.bar.in-window');\n      if(firstIn){\n        const rect = firstIn.getBoundingClientRect();\n        const parentRect = barsDiv.getBoundingClientRect();\n        const offset = (rect.left - parentRect.left) - parentRect.width/2 + rect.width/2;\n        barsDiv.scrollLeft += offset;\n      }\n    }\n\n    // initialize UI\n    setModeUI();\n    renderBars();\n\n    // Keyboard shortcuts\n    window.addEventListener('keydown', (e)=>{\n      if(e.key === ' ') { e.preventDefault(); togglePlay(); }\n      if(e.key === 'ArrowRight') { e.preventDefault(); stepTo(currentStep+1); pause(); }\n      if(e.key === 'ArrowLeft') { e.preventDefault(); stepTo(currentStep-1); pause(); }\n    });\n\n    // initial\n    // Build default steps on load\n    buildSteps();\n\n  </script>\n</body>\n</html>"
  },
  "messages": [
    {
      "role": "system",
      "content": "Generate a single HTML file with JavaScript demonstrating the user-given concept. Only respond in a single HTML file."
    },
    {
      "role": "user",
      "content": "Sliding Window"
    }
  ],
  "topic": "Sliding Window",
  "hasFSM": true,
  "hasTest": true,
  "evaluation": {
    "score": null,
    "notes": ""
  }
}