<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Sort Visualization</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        button {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .array-display {
            margin: 20px 0;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
            min-height: 60px;
        }
        .element {
            display: inline-block;
            width: 40px;
            height: 40px;
            line-height: 40px;
            text-align: center;
            margin: 5px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .pivot {
            background-color: #ff5722 !important;
            transform: scale(1.2);
        }
        .comparing {
            background-color: #2196f3 !important;
        }
        .sorted {
            background-color: #4CAF50 !important;
        }
        .partition {
            background-color: #ffeb3b !important;
            color: #333 !important;
        }
        .explanation {
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f4fd;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
        }
        .step-info {
            margin: 10px 0;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Quick Sort Visualization</h1>
        
        <div class="controls">
            <input type="text" id="arrayInput" placeholder="Enter numbers (e.g., 5,3,8,1,2)" value="5,3,8,1,2,7,6,4">
            <button onclick="generateArray()">Generate Array</button>
            <button onclick="startSorting()">Start Quick Sort</button>
            <button onclick="reset()">Reset</button>
            <button onclick="nextStep()" id="nextStepBtn" disabled>Next Step</button>
        </div>

        <div class="array-display" id="arrayDisplay"></div>
        <div class="step-info" id="stepInfo"></div>
        <div class="explanation" id="explanation">
            <h3>How Quick Sort Works:</h3>
            <p>Quick Sort is a divide-and-conquer algorithm that works by:</p>
            <ol>
                <li>Selecting a 'pivot' element from the array</li>
                <li>Partitioning the array around the pivot (elements smaller than pivot go left, larger go right)</li>
                <li>Recursively applying the same process to the left and right subarrays</li>
            </ol>
            <p>Time Complexity: O(n log n) average case, O(nÂ²) worst case</p>
        </div>
    </div>

    <script>
        let originalArray = [];
        let currentArray = [];
        let sortingSteps = [];
        let currentStep = 0;
        let isSorting = false;

        function generateArray() {
            const input = document.getElementById('arrayInput').value;
            originalArray = input.split(',').map(num => parseInt(num.trim())).filter(num => !isNaN(num));
            
            if (originalArray.length === 0) {
                originalArray = [5, 3, 8, 1, 2, 7, 6, 4];
            }
            
            reset();
        }

        function reset() {
            currentArray = [...originalArray];
            sortingSteps = [];
            currentStep = 0;
            isSorting = false;
            document.getElementById('nextStepBtn').disabled = true;
            displayArray(currentArray);
            document.getElementById('stepInfo').textContent = 'Click "Start Quick Sort" to begin';
        }

        function startSorting() {
            if (originalArray.length === 0) {
                generateArray();
            }
            
            currentArray = [...originalArray];
            sortingSteps = [];
            currentStep = 0;
            isSorting = true;
            
            // Generate all sorting steps
            quickSortSteps([...currentArray], 0, currentArray.length - 1);
            
            document.getElementById('nextStepBtn').disabled = false;
            document.getElementById('stepInfo').textContent = `Step ${currentStep + 1}/${sortingSteps.length}: Ready to begin`;
        }

        function quickSortSteps(arr, low, high, parentStep = null) {
            if (low < high) {
                // Save current state before partitioning
                const step = {
                    array: [...arr],
                    low: low,
                    high: high,
                    pivotIndex: -1,
                    comparing: [],
                    partition: [],
                    explanation: `Partitioning from index ${low} to ${high}`,
                    parentStep: parentStep
                };
                sortingSteps.push(step);

                const pivotIndex = partitionSteps(arr, low, high);
                
                // Save state after partitioning
                const afterPartitionStep = {
                    array: [...arr],
                    low: low,
                    high: high,
                    pivotIndex: pivotIndex,
                    comparing: [],
                    partition: [],
                    explanation: `Pivot ${arr[pivotIndex]} is now in correct position`,
                    parentStep: parentStep
                };
                sortingSteps.push(afterPartitionStep);

                // Recursively sort left and right partitions
                quickSortSteps(arr, low, pivotIndex - 1, sortingSteps.length - 1);
                quickSortSteps(arr, pivotIndex + 1, high, sortingSteps.length - 1);
            }
        }

        function partitionSteps(arr, low, high) {
            const pivot = arr[high];
            let i = low - 1;

            // Save initial partitioning state
            const initialStep = {
                array: [...arr],
                low: low,
                high: high,
                pivotIndex: high,
                comparing: [high],
                partition: [],
                explanation: `Selected pivot: ${pivot} (last element)`
            };
            sortingSteps.push(initialStep);

            for (let j = low; j < high; j++) {
                // Save comparison step
                const compareStep = {
                    array: [...arr],
                    low: low,
                    high: high,
                    pivotIndex: high,
                    comparing: [j, high],
                    partition: Array.from({length: i - low + 1}, (_, idx) => low + idx),
                    explanation: `Comparing ${arr[j]} with pivot ${pivot}`
                };
                sortingSteps.push(compareStep);

                if (arr[j] <= pivot) {
                    i++;
                    
                    if (i !== j) {
                        // Swap elements
                        [arr[i], arr[j]] = [arr[j], arr[i]];
                        
                        // Save swap step
                        const swapStep = {
                            array: [...arr],
                            low: low,
                            high: high,
                            pivotIndex: high,
                            comparing: [i, j],
                            partition: Array.from({length: i - low + 1}, (_, idx) => low + idx),
                            explanation: `Swapped ${arr[i]} and ${arr[j]}`
                        };
                        sortingSteps.push(swapStep);
                    }
                }
            }

            // Final swap with pivot
            [arr[i + 1], arr[high]] = [arr[high], arr[i + 1]];
            
            const finalStep = {
                array: [...arr],
                low: low,
                high: high,
                pivotIndex: i + 1,
                comparing: [i + 1, high],
                partition: Array.from({length: i + 1 - low + 1}, (_, idx) => low + idx),
                explanation: `Placed pivot ${pivot} in final position at index ${i + 1}`
            };
            sortingSteps.push(finalStep);

            return i + 1;
        }

        function nextStep() {
            if (currentStep < sortingSteps.length) {
                const step = sortingSteps[currentStep];
                displayArrayWithHighlights(step.array, step);
                document.getElementById('stepInfo').textContent = 
                    `Step ${currentStep + 1}/${sortingSteps.length}: ${step.explanation}`;
                currentStep++;
                
                if (currentStep === sortingSteps.length) {
                    document.getElementById('nextStepBtn').disabled = true;
                    document.getElementById('stepInfo').textContent += ' - Sorting Completed!';
                }
            }
        }

        function displayArray(arr) {
            const display = document.getElementById('arrayDisplay');
            display.innerHTML = '';
            
            arr.forEach((value, index) => {
                const element = document.createElement('div');
                element.className = 'element';
                element.textContent = value;
                element.style.backgroundColor = getColorForValue(value, Math.max(...arr), Math.min(...arr));
                display.appendChild(element);
            });
        }

        function displayArrayWithHighlights(arr, step) {
            const display = document.getElementById('arrayDisplay');
            display.innerHTML = '';
            
            arr.forEach((value, index) => {
                const element = document.createElement('div');
                element.className = 'element';
                element.textContent = value;
                
                if (index === step.pivotIndex) {
                    element.classList.add('pivot');
                } else if (step.comparing.includes(index)) {
                    element.classList.add('comparing');
                } else if (step.partition.includes(index)) {
                    element.classList.add('partition');
                } else {
                    element.style.backgroundColor = getColorForValue(value, Math.max(...arr), Math.min(...arr));
                }
                
                display.appendChild(element);
            });
        }

        function getColorForValue(value, max, min) {
            const range = max - min;
            if (range === 0) return '#666666';
            
            const ratio = (value - min) / range;
            const hue = (1 - ratio) * 240; // Blue (240) to Red (0)
            return `hsl(${hue}, 70%, 60%)`;
        }

        // Initialize with default array
        window.onload = function() {
            generateArray();
        };
    </script>
</body>
</html>