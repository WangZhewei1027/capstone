<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bubble Sort Demonstration</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f0f0f0;
      text-align: center;
    }
    h1 {
      margin-bottom: 10px;
    }
    #array-container {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      height: 200px;
      margin: 20px 0;
    }
    .bar {
      margin: 0 2px;
      background-color: steelblue;
      width: 30px;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      color: white;
      font-weight: bold;
      border-radius: 4px 4px 0 0;
      transition: background-color 0.3s ease;
    }
    .bar.comparing {
      background-color: orange;
    }
    .bar.swapping {
      background-color: crimson;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin: 5px;
      cursor: pointer;
    }
    input[type="text"] {
      width: 300px;
      padding: 8px;
      font-size: 16px;
      margin: 5px;
    }
    #message {
      margin-top: 10px;
      font-style: italic;
      color: #555;
      min-height: 24px;
    }
  </style>
</head>
<body>
  <h1>Bubble Sort Visualization</h1>
  <div>
    <input type="text" id="input-array" placeholder="Enter numbers separated by commas" value="5,1,4,2,8" />
  </div>
  <div>
    <button id="start-btn">Start Sorting</button>
    <button id="random-btn">Generate Random Array</button>
  </div>
  <div id="array-container"></div>
  <div id="message"></div>

  <script>
    const inputArrayEl = document.getElementById('input-array');
    const startBtn = document.getElementById('start-btn');
    const randomBtn = document.getElementById('random-btn');
    const arrayContainer = document.getElementById('array-container');
    const messageEl = document.getElementById('message');

    let array = [];

    // Generate bars for the array visualization
    function renderArray(arr, highlight = {}) {
      arrayContainer.innerHTML = '';
      const maxVal = Math.max(...arr);
      arr.forEach((value, index) => {
        const bar = document.createElement('div');
        bar.classList.add('bar');
        bar.style.height = (value / maxVal) * 100 + '%';
        bar.textContent = value;
        if (highlight.comparing && highlight.comparing.includes(index)) {
          bar.classList.add('comparing');
        }
        if (highlight.swapping && highlight.swapping.includes(index)) {
          bar.classList.add('swapping');
        }
        arrayContainer.appendChild(bar);
      });
    }

    // Sleep for given milliseconds
    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    async function bubbleSort(arr) {
      const n = arr.length;
      let swapped;
      for (let i = 0; i < n - 1; i++) {
        swapped = false;
        messageEl.textContent = `Pass ${i + 1} of ${n - 1}`;
        for (let j = 0; j < n - 1 - i; j++) {
          // Highlight current comparison
          renderArray(arr, { comparing: [j, j + 1] });
          await sleep(600);
          if (arr[j] > arr[j + 1]) {
            // Highlight swap
            renderArray(arr, { swapping: [j, j + 1] });
            await sleep(400);
            // Swap elements
            [arr[j], arr[j + 1]] = [arr[j + 1], arr[j]];
            swapped = true;
            renderArray(arr, { swapping: [j, j + 1] });
            await sleep(600);
          }
          renderArray(arr);
          await sleep(300);
        }
        if (!swapped) {
          messageEl.textContent = `Array is sorted after ${i + 1} passes.`;
          break;
        }
      }
      messageEl.textContent = 'Sorting completed.';
      renderArray(arr);
      startBtn.disabled = false;
      randomBtn.disabled = false;
      inputArrayEl.disabled = false;
    }

    function parseInput(input) {
      return input.split(',')
                  .map(s => s.trim())
                  .filter(s => s !== '')
                  .map(x => Number(x));
    }

    function validateArray(arr) {
      if (arr.length === 0) {
        messageEl.textContent = 'Please enter at least one number.';
        return false;
      }
      if (arr.some(isNaN)) {
        messageEl.textContent = 'Invalid input detected. Use only numbers separated by commas.';
        return false;
      }
      return true;
    }

    function generateRandomArray(size = 10, max = 50) {
      return Array.from({length: size}, () => Math.floor(Math.random() * max) + 1);
    }

    startBtn.addEventListener('click', () => {
      const parsed = parseInput(inputArrayEl.value);
      if (!validateArray(parsed)) {
        return;
      }
      array = parsed;
      startBtn.disabled = true;
      randomBtn.disabled = true;
      inputArrayEl.disabled = true;
      messageEl.textContent = 'Starting bubble sort...';
      bubbleSort(array);
    });

    randomBtn.addEventListener('click', () => {
      const randomArr = generateRandomArray(10, 100);
      array = randomArr;
      inputArrayEl.value = randomArr.join(', ');
      renderArray(array);
      messageEl.textContent = 'Random array generated. Ready to sort.';
    });

    // Initial render with default input
    window.onload = () => {
      const initialArr = parseInput(inputArrayEl.value);
      if (validateArray(initialArr)) {
        array = initialArr;
        renderArray(array);
        messageEl.textContent = 'Enter numbers and press Start Sorting';
      }
    };
  </script>
</body>
</html>