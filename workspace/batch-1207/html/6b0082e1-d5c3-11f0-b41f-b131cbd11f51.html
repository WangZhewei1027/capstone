<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insertion Sort Visualization</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        button {
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .array-container {
            display: flex;
            justify-content: center;
            align-items: end;
            height: 200px;
            margin: 20px 0;
            gap: 5px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
        }
        
        .array-bar {
            width: 30px;
            background-color: #3498db;
            border-radius: 3px 3px 0 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: end;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .array-bar.comparing {
            background-color: #e74c3c !important;
        }
        
        .array-bar.sorted {
            background-color: #27ae60 !important;
        }
        
        .array-bar.current {
            background-color: #f39c12 !important;
        }
        
        .array-bar.key {
            background-color: #9b59b6 !important;
        }
        
        .info-panel {
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f4fd;
            border-radius: 5px;
            border-left: 4px solid #3498db;
        }
        
        .statistics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .stat-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
        }
        
        input[type="range"] {
            width: 200px;
        }
        
        .explanation {
            margin-top: 20px;
            line-height: 1.6;
        }
        
        .code-snippet {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Insertion Sort Visualization</h1>
        
        <div class="controls">
            <button id="generateArray">Generate New Array</button>
            <button id="startSort">Start Sorting</button>
            <button id="pauseResume" disabled>Pause</button>
            <button id="stepSort" disabled>Step</button>
            <button id="reset">Reset</button>
            
            <div style="margin-left: auto; display: flex; align-items: center; gap: 10px;">
                <label for="speed">Speed:</label>
                <input type="range" id="speed" min="1" max="10" value="5">
            </div>
            
            <div style="display: flex; align-items: center; gap: 10px;">
                <label for="arraySize">Array Size:</label>
                <input type="range" id="arraySize" min="5" max="30" value="15">
            </div>
        </div>
        
        <div class="array-container" id="arrayContainer"></div>
        
        <div class="info-panel">
            <h3>Algorithm Status</h3>
            <div id="status">Ready to sort</div>
            <div class="statistics">
                <div class="stat-item">
                    <div>Comparisons</div>
                    <div id="comparisons">0</div>
                </div>
                <div class="stat-item">
                    <div>Swaps</div>
                    <div id="swaps">0</div>
                </div>
                <div class="stat-item">
                    <div>Current Step</div>
                    <div id="currentStep">-</div>
                </div>
            </div>
        </div>
        
        <div class="explanation">
            <h3>How Insertion Sort Works</h3>
            <p>Insertion Sort is a simple sorting algorithm that builds the final sorted array one item at a time.</p>
            
            <div class="code-snippet">
// Insertion Sort Algorithm
function insertionSort(arr) {
    for (let i = 1; i < arr.length; i++) {
        let key = arr[i];
        let j = i - 1;
        
        // Move elements greater than key one position ahead
        while (j >= 0 && arr[j] > key) {
            arr[j + 1] = arr[j];
            j--;
        }
        arr[j + 1] = key;
    }
    return arr;
}
            </div>
            
            <p><strong>Steps:</strong></p>
            <ol>
                <li>Start with the second element (index 1) as the "key"</li>
                <li>Compare the key with elements to its left</li>
                <li>Shift larger elements one position to the right</li>
                <li>Insert the key into its correct position</li>
                <li>Repeat for all elements in the array</li>
            </ol>
            
            <p><strong>Time Complexity:</strong> O(nÂ²) in worst and average cases, O(n) in best case (already sorted)</p>
            <p><strong>Space Complexity:</strong> O(1) - in-place sorting algorithm</p>
        </div>
    </div>

    <script>
        class InsertionSortVisualizer {
            constructor() {
                this.array = [];
                this.isSorting = false;
                this.isPaused = false;
                this.currentStep = 0;
                this.comparisons = 0;
                this.swaps = 0;
                this.speed = 500;
                this.animationId = null;
                
                this.initializeElements();
                this.generateRandomArray();
                this.setupEventListeners();
            }
            
            initializeElements() {
                this.arrayContainer = document.getElementById('arrayContainer');
                this.statusElement = document.getElementById('status');
                this.comparisonsElement = document.getElementById('comparisons');
                this.swapsElement = document.getElementById('swaps');
                this.currentStepElement = document.getElementById('currentStep');
                
                this.generateArrayBtn = document.getElementById('generateArray');
                this.startSortBtn = document.getElementById('startSort');
                this.pauseResumeBtn = document.getElementById('pauseResume');
                this.stepSortBtn = document.getElementById('stepSort');
                this.resetBtn = document.getElementById('reset');
                this.speedSlider = document.getElementById('speed');
                this.arraySizeSlider = document.getElementById('arraySize');
            }
            
            setupEventListeners() {
                this.generateArrayBtn.addEventListener('click', () => this.generateRandomArray());
                this.startSortBtn.addEventListener('click', () => this.startSorting());
                this.pauseResumeBtn.addEventListener('click', () => this.togglePause());
                this.stepSortBtn.addEventListener('click', () => this.stepSort());
                this.resetBtn.addEventListener('click', () => this.reset());
                
                this.speedSlider.addEventListener('input', (e) => {
                    this.speed = 1100 - (e.target.value * 100);
                });
                
                this.arraySizeSlider.addEventListener('input', (e) => {
                    this.generateRandomArray(parseInt(e.target.value));
                });
            }
            
            generateRandomArray(size = null) {
                if (this.isSorting) return;
                
                const arraySize = size || parseInt(this.arraySizeSlider.value);
                this.array = Array.from({length: arraySize}, () => 
                    Math.floor(Math.random() * 90) + 10
                );
                
                this.currentStep = 0;
                this.comparisons = 0;
                this.swaps = 0;
                this.updateStatistics();
                this.renderArray();
                this.updateStatus('New array generated');
                
                this.startSortBtn.disabled = false;
                this.stepSortBtn.disabled = false;
                this.pauseResumeBtn.disabled = true;
            }
            
            renderArray(highlightIndices = {}) {
                this.arrayContainer.innerHTML = '';
                const maxValue = Math.max(...this.array);
                
                this.array.forEach((value, index) => {
                    const bar = document.createElement('div');
                    bar.className = 'array-bar';
                    bar.style.height = `${(value / maxValue) * 180}px`;
                    bar.textContent = value;
                    
                    if (highlightIndices.key === index) {
                        bar.classList.add('key');
                    } else if (highlightIndices.current === index) {
                        bar.classList.add('current');
                    } else if (highlightIndices.comparing && 
                              (highlightIndices.comparing.includes(index))) {
                        bar.classList.add('comparing');
                    } else if (index < this.currentStep) {
                        bar.classList.add('sorted');
                    }
                    
                    this.arrayContainer.appendChild(bar);
                });
            }
            
            async startSorting() {
                if (this.isSorting) return;
                
                this.isSorting = true;
                this.isPaused = false;
                this.startSortBtn.disabled = true;
                this.pauseResumeBtn.disabled = false;
                this.stepSortBtn.disabled = true;
                this.generateArrayBtn.disabled = true;
                
                await this.performSort();
                
                this.isSorting = false;
                this.pauseResumeBtn.disabled = true;
                this.generateArrayBtn.disabled = false;
                this.updateStatus('Sorting completed!');
            }
            
            async performSort() {
                const array = [...this.array];
                const n = array.length;
                
                for (let i = 1; i < n; i++) {
                    if (this.isPaused) {
                        await this.waitForResume();
                    }
                    
                    const key = array[i];
                    let j = i - 1;
                    
                    this.updateStatus(`Processing element at index ${i} (value: ${key})`);
                    this.renderArray({key: i, current: i});
                    await this.delay();
                    
                    while (j >= 0 && array[j] > key) {
                        this.comparisons++;
                        this.updateStatistics();
                        
                        this.renderArray({
                            key: i,
                            current: j,
                            comparing: [j, j + 1]
                        });
                        await this.delay();
                        
                        array[j + 1] = array[j];
                        this.swaps++;
                        this.updateStatistics();
                        
                        j--;
                        
                        if (this.isPaused) {
                            await this.waitForResume();
                        }
                    }
                    
                    array[j + 1] = key;
                    this.array = [...array];
                    this.currentStep = i + 1;
                    this.renderArray({key: j + 1});
                    await this.delay();
                }
                
                // Final render with all elements sorted
                this.renderArray();
            }
            
            stepSort() {
                if (this.isSorting) return;
                
                this.isSorting = true;
                this.performSingleStep().then(() => {
                    this.isSorting = false;
                });
            }
            
            async performSingleStep() {
                // Simplified step implementation - in practice, this would need
                // to maintain state between steps
                this.updateStatus('Step mode not fully implemented in this demo');
            }
            
            togglePause() {
                if (!this.isSorting) return;
                
                this.isPaused = !this.isPaused;
                this.pauseResumeBtn.textContent = this.isPaused ? 'Resume' : 'Pause';
                
                if (!this.isPaused) {
                    // Resume sorting
                    this.resume();
                }
            }
            
            waitForResume() {
                return new Promise(resolve => {
                    const checkResume = () => {
                        if (!this.isPaused) {
                            resolve();
                        } else {
                            setTimeout(checkResume, 100);
                        }
                    };
                    checkResume();
                });
            }
            
            resume() {
                // Sorting will resume in the performSort loop
            }
            
            reset() {
                this.isSorting = false;
                this.isPaused = false;
                this.currentStep = 0;
                this.comparisons = 0;
                this.swaps = 0;
                
                this.startSortBtn.disabled = false;
                this.pauseResumeBtn.disabled = true;
                this.stepSortBtn.disabled = false;
                this.generateArrayBtn.disabled = false;
                this.pauseResumeBtn.textContent = 'Pause';
                
                this.renderArray();
                this.updateStatus('Ready to sort');
                this.updateStatistics();
            }
            
            delay() {
                return new Promise(resolve => setTimeout(resolve, this.speed));
            }
            
            updateStatistics() {
                this.comparisonsElement.textContent = this.comparisons;
                this.swapsElement.textContent = this.swaps;
                this.currentStepElement.textContent = this.currentStep;
            }
            
            updateStatus(message) {
                this.statusElement.textContent = message;
            }
        }
        
        // Initialize the visualizer when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new InsertionSortVisualizer();
        });
    </script>
</body>
</html>