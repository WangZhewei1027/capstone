<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Radix Sort Visualization</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
  }
  h1 {
    text-align:center;
  }
  #inputArea {
    margin-bottom: 10px;
    text-align: center;
  }
  input[type="text"] {
    width: 300px;
    padding: 8px;
    font-size: 16px;
  }
  button {
    padding: 8px 16px;
    font-size: 16px;
    margin-left: 8px;
    cursor: pointer;
  }
  #arrayContainer {
    margin-top: 30px;
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 8px;
  }
  .arrayElement {
    width: 50px;
    height: 50px;
    background-color: #4CAF50;
    color: white;
    font-weight: bold;
    font-size: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 6px;
    transition: background-color 0.3s ease;
  }
  .highlight {
    background-color: #f39c12 !important;
  }
  #bucketsContainer {
    margin-top: 40px;
    display: flex;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
  }
  .bucket {
    border: 2px solid #3498db;
    min-width: 60px;
    min-height: 70px;
    border-radius: 6px;
    padding: 5px;
    text-align: center;
  }
  .bucketTitle {
    font-weight: bold;
    margin-bottom: 5px;
  }
  .bucketElements {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }
  .bucketElements .arrayElement {
    width: 40px;
    height: 30px;
    font-size: 14px;
    background-color: #2980b9;
  }
  #status {
    margin-top: 30px;
    text-align: center;
    font-size: 18px;
    min-height: 40px;
  }
  #speedControl {
    margin-top: 20px;
    text-align:center;
  }
  label {
    font-weight: bold;
  }
</style>
</head>
<body>
<h1>Radix Sort Visualization</h1>

<div id="inputArea">
  <input type="text" id="inputArray" placeholder="Enter integers separated by commas" value="170,45,75,90,802,24,2,66" />
  <button id="startBtn">Start Sorting</button>
</div>

<div id="speedControl">
  <label for="speedRange">Animation Speed:</label>
  <input type="range" id="speedRange" min="100" max="2000" value="600" step="100" />
  <span id="speedValue">600 ms</span>
</div>

<div id="status"></div>

<div id="arrayContainer"></div>

<div id="bucketsContainer"></div>

<script>
(() => {
  const inputArray = document.getElementById("inputArray");
  const startBtn = document.getElementById("startBtn");
  const arrayContainer = document.getElementById("arrayContainer");
  const bucketsContainer = document.getElementById("bucketsContainer");
  const status = document.getElementById("status");
  const speedRange = document.getElementById("speedRange");
  const speedValue = document.getElementById("speedValue");

  let animationDelay = +speedRange.value;

  speedRange.addEventListener('input', () => {
    animationDelay = +speedRange.value;
    speedValue.textContent = animationDelay + ' ms';
  });

  // Utility function: pause with async delay
  const delay = ms => new Promise(res => setTimeout(res, ms));

  // Create array element div for visualization
  function createArrayElement(value) {
    const div = document.createElement('div');
    div.className = 'arrayElement';
    div.textContent = value;
    return div;
  }

  // Render the main array visualization
  function renderArray(arr, highlightIndices = []) {
    arrayContainer.innerHTML = '';
    arr.forEach((num, i) => {
      const el = createArrayElement(num);
      if (highlightIndices.includes(i)) {
        el.classList.add('highlight');
      }
      arrayContainer.appendChild(el);
    });
  }

  // Render buckets visualization
  function renderBuckets(buckets) {
    bucketsContainer.innerHTML = '';
    for (let i = 0; i < 10; i++) {
      const bucket = document.createElement('div');
      bucket.className = 'bucket';
      bucket.id = 'bucket-' + i;

      const title = document.createElement('div');
      title.className = 'bucketTitle';
      title.textContent = i;
      bucket.appendChild(title);

      const bucketElements = document.createElement('div');
      bucketElements.className = 'bucketElements';

      buckets[i].forEach(value => {
        const el = createArrayElement(value);
        el.style.width = '40px';
        el.style.height = '30px';
        el.style.fontSize = '14px';
        bucketElements.appendChild(el);
      });

      bucket.appendChild(bucketElements);
      bucketsContainer.appendChild(bucket);
    }
  }

  // Get digit at (exp)th place of num (exp: 1 = units, 10 = tens, etc.)
  function getDigit(num, exp) {
    return Math.floor(Math.abs(num) / exp) % 10;
  }

  async function radixSortVisualization(arr) {
    let maxNum = Math.max(...arr.map(n => Math.abs(n)));
    
    status.textContent = "Starting Radix Sort.";
    renderArray(arr);
    await delay(animationDelay);

    let exp = 1; // 1, 10, 100, ...
    let iteration = 1;

    while (Math.floor(maxNum / exp) > 0) {
      status.textContent = `Iteration ${iteration}: Sorting by digit at place ${exp}.`;
      // Initialize buckets (0-9)
      let buckets = Array.from({length:10}, () => []);

      // Distribute elements into buckets
      for (let i = 0; i < arr.length; i++) {
        renderArray(arr, [i]);
        await delay(animationDelay / 2);
        const digit = getDigit(arr[i], exp);
        status.textContent = `Placing value ${arr[i]} into bucket ${digit}.`;
        buckets[digit].push(arr[i]);
        renderBuckets(buckets);
        await delay(animationDelay);
      }

      // Collect from buckets back into arr
      let idx = 0;
      for (let i = 0; i < 10; i++) {
        if (buckets[i].length > 0) {
          status.textContent = `Collecting elements from bucket ${i}.`;
          for (let val of buckets[i]) {
            arr[idx] = val;
            renderArray(arr, [idx]);
            await delay(animationDelay / 2);
            idx++;
          }
        }
      }

      renderArray(arr);
      bucketsContainer.innerHTML = '';
      exp *= 10;
      iteration++;
      await delay(animationDelay);
    }

    status.textContent = "Sorting complete!";
    renderArray(arr);
  }

  startBtn.addEventListener('click', async () => {
    // Disable button while sorting
    startBtn.disabled = true;
    status.textContent = "";
    bucketsContainer.innerHTML = '';

    // Parse input values
    let raw = inputArray.value.trim();
    if (!raw) {
      alert("Please enter some integers separated by commas.");
      startBtn.disabled = false;
      return;
    }
    let arr = raw.split(',').map(s => s.trim()).filter(s => s !== '').map(n => Number(n));
    if (arr.some(v => Number.isNaN(v))) {
      alert("Input contains invalid number(s). Please enter only integers separated by commas.");
      startBtn.disabled = false;
      return;
    }

    // Handle negative numbers by offsetting
    let minVal = Math.min(...arr);
    let offset = 0;
    if(minVal < 0){
      offset = -minVal; // e.g. minVal = -50, offset = 50
      arr = arr.map(v => v + offset);
    }

    await radixSortVisualization(arr);

    // Revert offset
    if(offset !== 0){
      arr = arr.map(v => v - offset);
      renderArray(arr);
      status.textContent += " (Negative numbers handled by offset.)";
    }

    startBtn.disabled = false;
  });
})();
</script>
</body>
</html>