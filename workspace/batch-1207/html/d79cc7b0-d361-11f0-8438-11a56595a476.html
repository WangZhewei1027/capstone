<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Merge Sort Demonstration</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 25px;
    background: #f0f4f8;
    color: #333;
  }
  h1 {
    text-align: center;
    color: #2c3e50;
  }
  #input-area {
    max-width: 600px;
    margin: 0 auto 20px auto;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
  }
  #array-input {
    flex: 1 1 300px;
    padding: 8px;
    font-size: 1rem;
  }
  button {
    padding: 8px 15px;
    font-size: 1rem;
    cursor:pointer;
    border: none;
    border-radius: 4px;
    background-color: #2980b9;
    color: white;
    transition: background-color 0.3s ease;
  }
  button:disabled {
    background-color: #7fb3d5;
    cursor: default;
  }
  button:hover:not(:disabled) {
    background-color: #1b4f72;
  }
  #steps {
    max-width: 700px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 15px rgb(0 0 0 / 0.1);
    margin: 0 auto;
    padding: 20px;
    overflow-wrap: break-word;
  }
  .step {
    background: #ecf0f1;
    padding: 8px 12px;
    border-radius: 5px;
    margin-bottom: 10px;
    font-family: 'Courier New', Courier, monospace;
    white-space: pre-wrap;
  }
  .highlight {
    background-color: #d4efdf;
    border-left: 4px solid #27ae60;
    padding-left: 8px;
  }
  #final-result {
    font-weight: bold;
    font-size: 1.2rem;
    text-align: center;
    margin-top: 15px;
    color: #27ae60;
  }
  small {
    display: block;
    margin-top: 15px;
    color: #666;
  }
</style>
</head>
<body>
<h1>Merge Sort Visualization & Demo</h1>
<div id="input-area">
  <input
    type="text"
    id="array-input"
    placeholder="Enter numbers separated by commas, e.g. 5,3,8,4,2"
    aria-label="Input array"
  />
  <button id="sort-button">Sort</button>
</div>
<div id="steps" aria-live="polite" aria-atomic="true">Enter an array above and click "Sort" to see merge sort steps.</div>
<small>Note: You can input any sequence of integers separated by commas or spaces.</small>

<script>
(function() {
  const input = document.getElementById('array-input');
  const sortBtn = document.getElementById('sort-button');
  const stepsDiv = document.getElementById('steps');

  // Parse user input string into array of integers or null if invalid
  function parseInput(str) {
    // Accept commas, spaces, or both as separators:
    const parts = str.trim().split(/[\s,]+/);
    const numbers = [];
    for(let p of parts){
      if(p === '') continue;
      const num = Number(p);
      if(Number.isNaN(num)) return null;
      numbers.push(num);
    }
    return numbers;
  }

  // Merge function that merges two sorted arrays into one sorted array
  // Extra parameter 'steps' collects textual steps for demonstration
  function merge(left, right, steps) {
    let merged = [];
    let i = 0, j = 0;
    steps.push(`Merging:\n  left:  [${left.join(', ')}]\n  right: [${right.join(', ')}]`);
    while(i < left.length && j < right.length) {
      if(left[i] <= right[j]){
        merged.push(left[i]);
        i++;
      } else {
        merged.push(right[j]);
        j++;
      }
    }
    // Append remaining items
    while(i < left.length) {
      merged.push(left[i]);
      i++;
    }
    while(j < right.length) {
      merged.push(right[j]);
      j++;
    }

    steps.push(`Result after merge: [${merged.join(', ')}]\n`);
    return merged;
  }

  // Recursive merge sort function
  // Returns sorted array and pushes textual steps into steps array
  function mergeSort(arr, steps, depth = 0) {
    const indent = '  '.repeat(depth);
    if(arr.length <= 1){
      steps.push(`${indent}Array of length 1 or less, considered sorted: [${arr.join(', ')}]\n`);
      return arr;
    }
    const mid = Math.floor(arr.length / 2);
    steps.push(`${indent}Splitting array: [${arr.join(', ')}] into:`);
    const leftPart = arr.slice(0, mid);
    const rightPart = arr.slice(mid);
    steps.push(`${indent}  left:  [${leftPart.join(', ')}]`);
    steps.push(`${indent}  right: [${rightPart.join(', ')}]\n`);

    const leftSorted = mergeSort(leftPart, steps, depth + 1);
    const rightSorted = mergeSort(rightPart, steps, depth + 1);
    const merged = merge(leftSorted, rightSorted, steps);
    return merged;
  }

  // Render steps nicely in stepsDiv
  function renderSteps(arr, sortedArr, steps) {
    stepsDiv.innerHTML = '';
    for(let s of steps){
      const stepElem = document.createElement('div');
      stepElem.className = 'step';
      // Use <pre> formatting style by using white-space: pre-wrap, showing new lines
      stepElem.textContent = s;
      stepsDiv.appendChild(stepElem);
    }
    const finalElem = document.createElement('div');
    finalElem.id = 'final-result';
    finalElem.textContent = `Final sorted array: [${sortedArr.join(', ')}]`;
    stepsDiv.appendChild(finalElem);
  }

  sortBtn.addEventListener('click', () => {
    const rawInput = input.value;
    const arr = parseInput(rawInput);
    if(arr === null || arr.length === 0){
      stepsDiv.textContent = 'Invalid input. Please enter a sequence of numbers separated by commas or spaces.';
      return;
    }

    sortBtn.disabled = true;
    input.disabled = true;
    stepsDiv.textContent = 'Sorting... Please wait.';

    // Use slight delay to show "Sorting..." message before computing
    setTimeout(() => {
      const steps = [];
      const sortedArr = mergeSort(arr, steps);
      renderSteps(arr, sortedArr, steps);
      sortBtn.disabled = false;
      input.disabled = false;
    }, 50);
  });
})();
</script>
</body>
</html>