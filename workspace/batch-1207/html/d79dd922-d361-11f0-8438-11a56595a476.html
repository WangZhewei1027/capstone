<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sliding Window Visualization</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f0f2f5;
    color: #333;
  }
  h1 {
    text-align: center;
  }
  #arrayContainer {
    display: flex;
    justify-content: center;
    margin: 30px 0;
    flex-wrap: wrap;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }
  .array-element {
    width: 40px;
    height: 40px;
    border: 2px solid #888;
    margin: 2px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: 600;
    font-size: 18px;
    border-radius: 6px;
    transition: background-color 0.3s ease, border-color 0.3s ease;
    user-select: none;
  }
  .in-window {
    background-color: #4a90e2;
    color: white;
    border-color: #2a5cad;
  }
  .current-max {
    background-color: #ff9500;
    border-color: #cc7a00;
    color: white;
  }
  #controls {
    text-align: center;
    margin: 20px 0;
  }
  label {
    margin-right: 10px;
    font-weight: 600;
  }
  input[type="text"], input[type="number"] {
    padding: 5px 8px;
    font-size: 16px;
    width: 200px;
    border-radius: 4px;
    border: 1px solid #ccc;
    margin-right: 20px;
  }
  button {
    font-size: 16px;
    padding: 8px 15px;
    border-radius: 5px;
    border: none;
    background-color: #4a90e2;
    color: white;
    cursor: pointer;
    transition: background-color 0.25s ease;
  }
  button:disabled {
    background-color: #a0b9db;
    cursor: not-allowed;
  }
  button:hover:not(:disabled) {
    background-color: #3a78c2;
  }
  #result {
    max-width: 600px;
    margin: 20px auto;
    background: white;
    border-radius: 8px;
    padding: 15px 20px;
    box-shadow: 0 2px 7px rgba(0,0,0,0.1);
  }
  #explanation {
    max-width: 600px;
    margin: 30px auto 0;
    font-style: italic;
    color: #555;
  }
</style>
</head>
<body>
<h1>Sliding Window Maximum Visualization</h1>
<div id="controls">
  <label for="arrayInput">Array (comma-separated integers):</label>
  <input type="text" id="arrayInput" value="2,1,3,4,6,3,8,9,10,12,56" />
  <label for="windowSize">Window size (k):</label>
  <input type="number" id="windowSize" min="1" value="4" />
  <button id="startBtn">Start Visualization</button>
</div>

<div id="arrayContainer" aria-live="polite" aria-label="Array visualization"></div>

<div id="result" aria-live="polite" aria-atomic="true"></div>

<div id="explanation">
  <strong>What is Sliding Window Maximum?</strong><br/>
  Given an array and a window size k, for each contiguous subarray of length k, find the maximum value. This visualization slides a window across the array, showing the current window elements and the maximum inside it.
</div>

<script>
  (() => {
    const arrayInput = document.getElementById('arrayInput');
    const windowInput = document.getElementById('windowSize');
    const startBtn = document.getElementById('startBtn');
    const container = document.getElementById('arrayContainer');
    const result = document.getElementById('result');

    let array = [];
    let k = 0;
    let currentIndex = 0;
    let intervalId = null;

    // Helper to clear container and redraw array elements with highlighting
    function drawArrayHighlightWindow(arr, windowStart, windowEnd, maxIndices=[]) {
      container.innerHTML = '';
      for(let i=0; i<arr.length; i++) {
        const el = document.createElement('div');
        el.className = 'array-element';
        el.textContent = arr[i];
        if(i >= windowStart && i <= windowEnd) {
          el.classList.add('in-window');
        }
        if(maxIndices.includes(i)) {
          el.classList.add('current-max');
          // Put aria label for screen readers
          el.setAttribute('aria-label', `${arr[i]} (maximum in current window)`);
        } else {
          el.removeAttribute('aria-label');
        }
        container.appendChild(el);
      }
    }

    // Sliding window maximum algorithm with deque to demonstrate logic step-by-step
    function slidingWindowMax(arr, k) {
      const n = arr.length;
      if (k > n) return [];

      let dq = []; // will store indices
      let maxValues = [];
      let steps = [];

      for(let i=0; i<n; i++){
        // Remove indices out of window range
        while(dq.length && dq[0] <= i - k) {
          dq.shift();
        }
        // Remove smaller elements indices
        while(dq.length && arr[dq[dq.length - 1]] <= arr[i]) {
          dq.pop();
        }
        dq.push(i);

        if(i >= k - 1) {
          maxValues.push(arr[dq[0]]);
          // Capture snapshot info for visualization
          steps.push({
            windowStart: i - k + 1,
            windowEnd: i,
            maxIndices: [dq[0]],
            dq: [...dq],
            maxValue: arr[dq[0]],
            currentIndex: i
          });
        }
      }
      return {maxValues, steps};
    }

    function disableInputs(disabled) {
      arrayInput.disabled = disabled;
      windowInput.disabled = disabled;
      startBtn.disabled = disabled;
    }

    function clearVisualization() {
      container.innerHTML = '';
      result.textContent = '';
    }


    function runVisualization(arr, k) {
      const { maxValues, steps } = slidingWindowMax(arr, k);
      let currentStep = 0;

      disableInputs(true);
      clearVisualization();

      function showStep(step) {
        drawArrayHighlightWindow(arr, step.windowStart, step.windowEnd, step.maxIndices);
        result.textContent = `Window [${step.windowStart} .. ${step.windowEnd}]: Max = ${step.maxValue}`;
      }

      showStep(steps[0]);

      intervalId = setInterval(() => {
        currentStep++;
        if(currentStep >= steps.length) {
          clearInterval(intervalId);
          result.textContent += ' â€” Finished sliding all windows.';
          disableInputs(false);
          return;
        }
        showStep(steps[currentStep]);
      }, 1300);
    }

    startBtn.addEventListener('click', () => {
      let inputStr = arrayInput.value.trim();
      if(!inputStr.length) {
        alert('Please enter a valid array of integers.');
        return;
      }
      let parsedArray = inputStr.split(',').map(s => Number(s.trim()));
      if(parsedArray.some(isNaN)) {
        alert('Array must contain only integers, separated by commas.');
        return;
      }
      let windowSize = Number(windowInput.value);

      if(isNaN(windowSize) || windowSize < 1 || windowSize > parsedArray.length) {
        alert(`Window size k must be an integer between 1 and array length (${parsedArray.length}).`);
        return;
      }

      array = parsedArray;
      k = windowSize;

      runVisualization(array, k);
    });

  })();
</script>
</body>
</html>