<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Array Explorer — Interactive JavaScript Array Playground</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#0f1724;
      --panel:#0b1220;
      --accent:#38bdf8;
      --muted:#94a3b8;
      --card:#071029;
      --green:#22c55e;
      --red:#ef4444;
      --glass: rgba(255,255,255,0.03);
      color-scheme: dark;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071021 0%, #071022 60%, #031226 100%); color:#e6eef8;}
    .wrap{max-width:1100px;margin:24px auto;padding:20px;display:grid;grid-template-columns:1fr 420px;gap:18px;}
    header{grid-column:1/-1;display:flex;align-items:center;gap:14px;}
    h1{font-size:20px;margin:0;color:var(--accent);}
    p.subtitle{margin:0;color:var(--muted);font-size:13px;}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.04); padding:14px;border-radius:10px;box-shadow:0 6px 20px rgba(2,6,23,0.6)}
    .left{min-height:420px;}
    .right{height:100%;}
    .row{display:flex;gap:10px;align-items:center;margin-bottom:12px;flex-wrap:wrap}
    label{font-size:13px;color:var(--muted)}
    input[type="text"], input[type="number"], textarea, select{
      background:var(--glass);border:1px solid rgba(255,255,255,0.04);color:inherit;padding:8px 10px;border-radius:8px;outline:none;font-size:13px;
    }
    textarea{min-height:60px;resize:vertical}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    button{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--accent);padding:8px 10px;border-radius:8px;cursor:pointer}
    button.secondary{color:var(--muted);border-style:dashed}
    button.danger{color:var(--red);border-color:rgba(239,68,68,0.14)}
    button.green{color:var(--green);border-color:rgba(34,197,94,0.14)}
    .array-visual{display:flex;gap:8px;flex-wrap:wrap;padding:10px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));min-height:80px}
    .cell{min-width:56px;min-height:48px;padding:6px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:13px;position:relative}
    .cell .idx{position:absolute;top:6px;left:8px;font-size:11px;color:var(--muted)}
    .cell .val{word-break:break-all;text-align:center}
    footer.small{font-size:12px;color:var(--muted);margin-top:8px}
    .log{height:260px;overflow:auto;padding:10px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.03);font-family:monospace;font-size:12px}
    .help{font-size:13px;color:var(--muted);line-height:1.4}
    .split{display:grid;gap:10px;grid-template-columns:1fr 1fr}
    .examples button{padding:6px 8px;font-size:13px}
    .result{padding:8px;border-radius:8px;background:linear-gradient(180deg, rgba(56,189,248,0.05), rgba(56,189,248,0.02));border:1px solid rgba(56,189,248,0.08);color:var(--accent);font-family:monospace;font-size:13px}
    .small-muted{font-size:12px;color:var(--muted);}
    .code{background:#041021;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);font-family:monospace;font-size:12px;white-space:pre;overflow:auto}
    a.link{color:var(--accent);text-decoration:none}
    @media(max-width:980px){ .wrap{grid-template-columns:1fr; padding:12px} .right{order:3} header{flex-direction:column;align-items:flex-start;gap:4px} }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Array Explorer</h1>
        <p class="subtitle">Create arrays, run operations (push/pop/map/filter/reduce/...) and visualize results live.</p>
      </div>
      <div style="margin-left:auto;text-align:right">
        <div class="small-muted">Tip: enter an array as JSON ([1,2,3]) or comma-separated (a,b,c)</div>
      </div>
    </header>

    <section class="panel left">
      <div class="row">
        <div style="flex:1">
          <label>Array input</label>
          <input id="arrInput" type="text" placeholder='e.g. [1,2,3] or "a,b,c" or 1,2,3' />
        </div>
        <div style="width:240px">
          <label>Examples</label>
          <div class="examples" style="display:flex;gap:6px;margin-top:6px">
            <button onclick="applyExample('[1,2,3,4]')">[1,2,3,4]</button>
            <button onclick="applyExample('a,b,c')">a,b,c</button>
            <button onclick="applyExample('[\"apple\",\"banana\",\"pear\"]')">fruits</button>
            <button onclick="applyExample('[1,2,[3,4],5]')">nested</button>
            <button onclick="applyExample('[10,3,7,21]')">nums</button>
          </div>
        </div>
      </div>

      <div class="row">
        <div style="flex:1">
          <button onclick="createArray()" class="green">Create Array</button>
          <button onclick="resetDemo()" class="secondary">Reset</button>
          <button onclick="randomArray()" class="secondary">Random</button>
        </div>
        <div style="width:220px">
          <label>Array type</label>
          <select id="arrType" style="width:100%">
            <option value="normal">Normal Array</option>
            <option value="int32">TypedArray Int32Array</option>
            <option value="float32">TypedArray Float32Array</option>
          </select>
        </div>
      </div>

      <div class="row">
        <label style="width:120px">Current Array</label>
        <div style="flex:1" id="arrayBox" class="array-visual"></div>
      </div>

      <div style="display:flex;gap:12px;margin-bottom:12px;">
        <div style="flex:1">
          <label>Length</label>
          <input id="lengthInput" type="number" min="0" placeholder="set length" />
        </div>
        <div style="width:220px">
          <label>Set length (will truncate or expand with undefined)</label>
          <div style="display:flex;gap:8px;margin-top:6px">
            <button onclick="setLength()" class="secondary">Set</button>
            <button onclick="showProperty()" class="secondary">Show .length</button>
          </div>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div class="panel" style="padding:10px">
          <label>push(value)</label>
          <div class="row">
            <input id="pushVal" type="text" placeholder='value e.g. 5 or "x"' />
            <button onclick="opPush()">Push</button>
            <button onclick="opPop()" class="danger">Pop</button>
          </div>
          <div class="small-muted" style="margin-top:8px">push adds to end; pop removes last and returns it.</div>
        </div>

        <div class="panel" style="padding:10px">
          <label>unshift / shift</label>
          <div class="row">
            <input id="unshiftVal" type="text" placeholder='"start"' />
            <button onclick="opUnshift()">Unshift</button>
            <button onclick="opShift()" class="danger">Shift</button>
          </div>
          <div class="small-muted" style="margin-top:8px">unshift adds to front; shift removes first.</div>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px">
        <div class="panel" style="padding:10px">
          <label>splice(start, deleteCount, ...items)</label>
          <div style="display:flex;gap:6px;margin-top:6px">
            <input id="spliceStart" type="number" placeholder="start" />
            <input id="spliceDelete" type="number" placeholder="deleteCount" />
            <input id="spliceItems" type="text" placeholder='items comma "x",2' />
            <button onclick="opSplice()">Run</button>
          </div>
          <div class="small-muted" style="margin-top:8px">splice mutates the array and returns removed elements.</div>
        </div>

        <div class="panel" style="padding:10px">
          <label>slice(start, end)</label>
          <div style="display:flex;gap:6px;margin-top:6px">
            <input id="sliceStart" type="number" placeholder="start" />
            <input id="sliceEnd" type="number" placeholder="end" />
            <button onclick="opSlice()">Slice</button>
          </div>
          <div class="small-muted" style="margin-top:8px">slice returns a shallow copy subset (non-mutating).</div>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px">
        <div class="panel" style="padding:10px">
          <label>map(expression)</label>
          <div style="display:flex;gap:6px;margin-top:6px">
            <input id="mapExpr" type="text" placeholder="x * 2 or x + '-' + i" />
            <button onclick="opMap()">Map</button>
          </div>
          <div class="small-muted" style="margin-top:8px">expression can use x (value), i (index), arr (array)</div>
        </div>

        <div class="panel" style="padding:10px">
          <label>filter(condition)</label>
          <div style="display:flex;gap:6px;margin-top:6px">
            <input id="filterExpr" type="text" placeholder="x % 2 == 0" />
            <button onclick="opFilter()">Filter</button>
          </div>
          <div class="small-muted" style="margin-top:8px">returns values where condition is truthy.</div>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px">
        <div class="panel" style="padding:10px">
          <label>reduce((acc,x) => ... , initial)</label>
          <div style="display:flex;gap:6px;margin-top:6px">
            <input id="reduceExpr" type="text" placeholder="acc + x" />
            <input id="reduceInit" type="text" placeholder="0" />
            <button onclick="opReduce()">Reduce</button>
          </div>
          <div class="small-muted" style="margin-top:8px">acc is accumulator, x is current element.</div>
        </div>

        <div class="panel" style="padding:10px">
          <label>sort / reverse / join</label>
          <div style="display:flex;gap:6px;margin-top:6px">
            <input id="sortExpr" type="text" placeholder='(a,b)=>a-b or leave blank' />
            <button onclick="opSort()">Sort</button>
            <button onclick="opReverse()">Reverse</button>
            <button onclick="opJoin()">Join</button>
          </div>
          <input id="joinSep" type="text" placeholder='separator (default ",")' style="margin-top:6px" />
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px">
        <div class="panel" style="padding:10px">
          <label>concat(second array)</label>
          <div style="display:flex;gap:6px;margin-top:6px">
            <input id="concatInput" type="text" placeholder='e.g. [4,5] or "x,y"' />
            <button onclick="opConcat()">Concat</button>
          </div>
        </div>

        <div class="panel" style="padding:10px">
          <label>flat(depth)</label>
          <div style="display:flex;gap:6px;margin-top:6px">
            <input id="flatDepth" type="number" min="0" placeholder="1" />
            <button onclick="opFlat()">Flat</button>
          </div>
        </div>
      </div>

      <div style="display:flex;gap:8px;margin-top:12px;align-items:center">
        <button onclick="inspectIncludes()">includes / indexOf / find</button>
        <div style="flex:1;display:flex;gap:6px">
          <input id="searchVal" type="text" placeholder='value to search e.g. 3 or "a"' />
          <input id="findExpr" type="text" placeholder='find condition e.g. x>5' />
        </div>
      </div>

      <div style="margin-top:12px;display:flex;gap:6px;align-items:center">
        <button onclick="opFill()">fill(value,start,end)</button>
        <input id="fillVal" type="text" placeholder='value' />
        <input id="fillStart" type="number" placeholder="start" />
        <input id="fillEnd" type="number" placeholder="end" />
        <button onclick="opCopyWithin()">copyWithin(target,start,end)</button>
        <input id="cwTarget" type="number" placeholder="target" style="width:60px" />
        <input id="cwStart" type="number" placeholder="start" style="width:60px" />
        <input id="cwEnd" type="number" placeholder="end" style="width:60px" />
      </div>

      <div style="margin-top:12px">
        <label>Code executed (preview)</label>
        <div id="codePreview" class="code">No operations yet.</div>
      </div>
    </section>

    <aside class="panel right">
      <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
        <label style="width:90px">Result / Log</label>
        <div style="flex:1" class="small-muted">Shows operation results, removed elements, and messages.</div>
        <button onclick="clearLog()" class="secondary">Clear</button>
      </div>

      <div id="log" class="log"></div>

      <div style="margin-top:12px" class="help">
        <strong>Quick notes:</strong>
        <ul style="margin:6px 0 0 18px;padding:0;color:var(--muted)">
          <li>Enter expressions using x (value), i (index), arr (array). Example map: "x*2"</li>
          <li>Input values are parsed with JSON.parse if possible, otherwise treated as strings.</li>
          <li>Typed arrays (Int32Array/Float32Array) support fewer mutating operations; converting happens internally when needed.</li>
        </ul>
      </div>

      <div style="margin-top:12px">
        <label>Current array as JSON</label>
        <div id="jsonOut" class="code" style="height:120px;overflow:auto">[]</div>
      </div>

      <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
        <button onclick="exportArray()" class="green">Copy JSON</button>
        <button onclick="downloadArray()" class="secondary">Download .json</button>
      </div>

    </aside>
  </div>

  <script>
    // Array Explorer — interactive demo
    let current = []; // may be normal array or typed array
    let currentType = 'normal';
    const arrInput = document.getElementById('arrInput');
    const arrayBox = document.getElementById('arrayBox');
    const logEl = document.getElementById('log');
    const jsonOut = document.getElementById('jsonOut');
    const codePreview = document.getElementById('codePreview');

    function parseInputValue(raw) {
      if (raw === undefined) return undefined;
      raw = raw.trim();
      if (raw === '') return undefined;
      // try JSON.parse
      try {
        return JSON.parse(raw);
      } catch (e) {
        // not JSON - treat as single string or maybe comma separated list handled elsewhere
        return raw;
      }
    }

    function parseArrayText(text) {
      text = (text || '').trim();
      if (!text) return [];
      // If looks like JSON array
      if (text.startsWith('[') && text.endsWith(']')) {
        try {
          return JSON.parse(text);
        } catch (e) {
          // fallthrough
        }
      }
      // otherwise split by commas
      const parts = text.split(',').map(s => s.trim()).filter(s=>s.length>0);
      const parsed = parts.map(p=>{
        try { return JSON.parse(p); } catch(e){ return p; }
      });
      return parsed;
    }

    function createArray(fromInput=true) {
      const typeSelect = document.getElementById('arrType');
      currentType = typeSelect.value;
      let arr;
      if (fromInput) {
        arr = parseArrayText(arrInput.value);
      } else {
        arr = [];
      }
      if (currentType === 'int32') {
        try {
          current = new Int32Array(arr.map(n => Number(n) || 0));
        } catch(e){ current = Array.from(arr); }
      } else if (currentType === 'float32') {
        try {
          current = new Float32Array(arr.map(n => Number(n) || 0));
        } catch(e){ current = Array.from(arr); }
      } else {
        current = arr;
      }
      log('Created array', current);
      renderAll();
      showCode('// created array\n' + previewCodeForCreation());
    }

    function previewCodeForCreation() {
      if (currentType === 'normal') {
        return `const arr = ${JSON.stringify(Array.from(current))};`;
      } else {
        return `const arr = new ${currentType === 'int32' ? 'Int32Array' : 'Float32Array'}(${JSON.stringify(Array.from(current))});`;
      }
    }

    function applyExample(text) {
      arrInput.value = text;
      createArray(true);
    }

    function resetDemo() {
      current = [];
      currentType = 'normal';
      arrInput.value = '';
      document.getElementById('arrType').value = 'normal';
      renderAll();
      log('Reset');
      showCode('// reset array');
    }

    function randomArray() {
      const arr = Array.from({length:8}, _=> Math.floor(Math.random()*30) - 5);
      arrInput.value = JSON.stringify(arr);
      createArray(true);
    }

    function renderAll() {
      renderArrayVisual();
      jsonOut.textContent = JSON.stringify(Array.from(current), null, 2);
    }

    function renderArrayVisual() {
      arrayBox.innerHTML = '';
      const arrToShow = Array.from(current);
      if (arrToShow.length === 0) {
        arrayBox.innerHTML = '<div class="small-muted">empty array</div>';
        return;
      }
      arrToShow.forEach((v,i)=>{
        const c = document.createElement('div');
        c.className = 'cell';
        const idx = document.createElement('div');
        idx.className='idx';
        idx.textContent = i;
        const val = document.createElement('div');
        val.className='val';
        val.textContent = formatValue(v);
        c.appendChild(idx);
        c.appendChild(val);
        arrayBox.appendChild(c);
      });
    }

    function formatValue(v) {
      if (v === null) return 'null';
      if (v === undefined) return 'undefined';
      if (Array.isArray(v)) return '[' + v.map(formatValue).join(', ') + ']';
      if (typeof v === 'object') return JSON.stringify(v);
      return String(v);
    }

    function log(...args) {
      const now = new Date().toLocaleTimeString();
      const line = document.createElement('div');
      line.innerHTML = `<span style="color:var(--muted)">${now}</span>  ${args.map(a => safeStringify(a)).join(' ')}`;
      logEl.prepend(line);
    }

    function safeStringify(v) {
      if (v === undefined) return '<undefined>';
      if (typeof v === 'string') return `"${v}"`;
      try { return JSON.stringify(v); } catch(e) { return String(v); }
    }

    function showCode(code) {
      codePreview.textContent = code;
    }

    function getArrayAsNormal() {
      return Array.from(current);
    }

    function setCurrentFrom(arr) {
      if (currentType === 'normal') {
        current = Array.from(arr);
      } else if (currentType === 'int32') {
        current = new Int32Array(arr.map(n=>Number(n)||0));
      } else if (currentType === 'float32') {
        current = new Float32Array(arr.map(n=>Number(n)||0));
      } else {
        current = Array.from(arr);
      }
      renderAll();
    }

    // Basic operations
    function opPush() {
      const raw = document.getElementById('pushVal').value;
      const val = parseInputValue(raw);
      const code = `arr.push(${stringifyForCode(val)}); // returns new length`;
      try {
        if (ArrayBuffer.isView(current)) {
          // typed arrays require special handling: convert to normal, mutate, convert back
          const tmp = Array.from(current);
          tmp.push(val);
          setCurrentFrom(tmp);
        } else {
          const res = current.push(val);
          renderAll();
          log('push -> new length', res);
        }
        showCode(code);
      } catch(e) {
        log('Error in push:', e.message);
      }
    }

    function opPop() {
      try {
        const arrBefore = Array.from(current);
        let res;
        if (ArrayBuffer.isView(current)) {
          const tmp = Array.from(current);
          res = tmp.pop();
          setCurrentFrom(tmp);
        } else {
          res = current.pop();
          renderAll();
        }
        log('pop ->', res);
        showCode('arr.pop(); // returns ' + stringifyForCode(res));
      } catch(e) { log('Error pop', e.message); }
    }

    function opUnshift() {
      const raw = document.getElementById('unshiftVal').value;
      const val = parseInputValue(raw);
      const code = `arr.unshift(${stringifyForCode(val)});`;
      try {
        if (ArrayBuffer.isView(current)) {
          const tmp = Array.from(current);
          tmp.unshift(val);
          setCurrentFrom(tmp);
        } else {
          const res = current.unshift(val);
          renderAll();
          log('unshift -> new length', res);
        }
        showCode(code);
      } catch(e){ log('Error unshift', e.message); }
    }

    function opShift() {
      try {
        let res;
        if (ArrayBuffer.isView(current)) {
          const tmp = Array.from(current);
          res = tmp.shift();
          setCurrentFrom(tmp);
        } else {
          res = current.shift();
          renderAll();
        }
        log('shift ->', res);
        showCode('arr.shift();');
      } catch(e){ log('Error shift', e.message); }
    }

    function opSplice() {
      const s = Number(document.getElementById('spliceStart').value || 0);
      const d = Number(document.getElementById('spliceDelete').value || 0);
      const itemsText = document.getElementById('spliceItems').value;
      const items = itemsText ? itemsText.split(',').map(x=>parseInputValue(x.trim())) : [];
      const code = `arr.splice(${s}, ${d}${items.length ? ', ' + items.map(stringifyForCode).join(', ') : ''});`;
      try {
        if (ArrayBuffer.isView(current)) {
          const tmp = Array.from(current);
          const removed = tmp.splice(s,d,...items);
          setCurrentFrom(tmp);
          log('splice removed', removed);
        } else {
          const removed = current.splice(s,d,...items);
          renderAll();
          log('splice removed', removed);
        }
        showCode(code);
      } catch(e){ log('Error splice', e.message); }
    }

    function opSlice() {
      const s = document.getElementById('sliceStart').value;
      const e = document.getElementById('sliceEnd').value;
      const sN = s === '' ? undefined : Number(s);
      const eN = e === '' ? undefined : Number(e);
      const code = `const out = arr.slice(${s === '' ? '' : sN}${e === '' ? '' : ', ' + eN});`;
      try {
        const out = Array.from(current).slice(sN, eN);
        log('slice ->', out);
        showCode(code + '\n// result shown above');
      } catch(e){ log('Error slice', e.message); }
    }

    // Map / Filter / Reduce
    function buildFn(expr, args = ['x','i','arr']) {
      try {
        // For safety, avoid access to global via this, but we allow expression as is.
        const fn = new Function(...args, 'return (' + expr + ');');
        return fn;
      } catch(e){
        return null;
      }
    }

    function opMap() {
      const expr = document.getElementById('mapExpr').value.trim();
      if (!expr) { log('Provide a map expression, e.g., x*2'); return; }
      const fn = buildFn(expr);
      if (!fn) { log('Invalid expression'); return; }
      try {
        const out = Array.from(current).map((x,i,arr)=>fn(x,i,arr));
        log('map ->', out);
        showCode(`const out = arr.map((x,i,arr) => ${expr});`);
      } catch(e){ log('Error map', e.message); }
    }

    function opFilter() {
      const expr = document.getElementById('filterExpr').value.trim();
      if (!expr) { log('Provide a filter expression, e.g., x%2==0'); return; }
      const fn = buildFn(expr);
      if (!fn) { log('Invalid expression'); return; }
      try {
        const out = Array.from(current).filter((x,i,arr)=>fn(x,i,arr));
        log('filter ->', out);
        showCode(`const out = arr.filter((x,i,arr) => ${expr});`);
      } catch(e){ log('Error filter', e.message); }
    }

    function opReduce() {
      const expr = document.getElementById('reduceExpr').value.trim();
      if (!expr) { log('Provide a reduce expression, e.g., acc + x'); return; }
      const initRaw = document.getElementById('reduceInit').value;
      const init = initRaw === '' ? undefined : parseInputValue(initRaw);
      // create function (acc,x,i,arr)
      let fn;
      try {
        fn = new Function('acc','x','i','arr','return (' + expr + ');');
      } catch(e){ log('Invalid reduce expression'); return; }
      try {
        const arrCopy = Array.from(current);
        let res;
        if (init === undefined) {
          res = arrCopy.reduce((acc,x,i,arr)=>fn(acc,x,i,arr));
        } else {
          res = arrCopy.reduce((acc,x,i,arr)=>fn(acc,x,i,arr), init);
        }
        log('reduce ->', res);
        showCode(`const res = arr.reduce((acc,x,i,arr) => ${expr}, ${stringifyForCode(init)});`);
      } catch(e){ log('Error reduce', e.message); }
    }

    // Sort / reverse / join
    function opSort() {
      const expr = document.getElementById('sortExpr').value.trim();
      try {
        if (ArrayBuffer.isView(current)) {
          const tmp = Array.from(current);
          if (expr) {
            const cmp = buildFn(expr, ['a','b']);
            tmp.sort(cmp);
            setCurrentFrom(tmp);
          } else {
            tmp.sort();
            setCurrentFrom(tmp);
          }
        } else {
          if (expr) {
            const cmp = buildFn(expr, ['a','b']);
            current.sort(cmp);
          } else {
            current.sort();
          }
          renderAll();
        }
        log('sorted');
        showCode(expr ? `arr.sort((a,b)=>${expr});` : 'arr.sort();');
      } catch(e){ log('Error sort', e.message); }
    }

    function opReverse() {
      try {
        if (ArrayBuffer.isView(current)) {
          const tmp = Array.from(current).reverse();
          setCurrentFrom(tmp);
        } else {
          current.reverse();
          renderAll();
        }
        log('reversed');
        showCode('arr.reverse();');
      } catch(e){ log('Error reverse', e.message); }
    }

    function opJoin() {
      const sep = document.getElementById('joinSep').value;
      try {
        const res = Array.from(current).join(sep);
        log('join ->', res);
        showCode(`arr.join(${stringifyForCode(sep || ',')});`);
      } catch(e){ log('Error join', e.message); }
    }

    function opConcat() {
      const raw = document.getElementById('concatInput').value;
      if (!raw) { log('Provide second array text'); return; }
      const second = parseArrayText(raw);
      try {
        const res = Array.from(current).concat(second);
        log('concat ->', res);
        showCode(`const out = arr.concat(${JSON.stringify(second)});`);
      } catch(e){ log('Error concat', e.message); }
    }

    function opFlat() {
      const d = Number(document.getElementById('flatDepth').value || 1);
      try {
        const res = Array.from(current).flat(d);
        log('flat ->', res);
        showCode(`const out = arr.flat(${d});`);
      } catch(e){ log('Error flat', e.message); }
    }

    // includes / indexOf / find
    function inspectIncludes() {
      const raw = document.getElementById('searchVal').value;
      const v = parseInputValue(raw);
      const findExpr = document.getElementById('findExpr').value.trim();
      try {
        const inc = Array.from(current).includes(v);
        const idx = Array.from(current).indexOf(v);
        let found, foundIdx;
        if (findExpr) {
          const fn = buildFn(findExpr);
          found = Array.from(current).find((x,i,arr)=>fn(x,i,arr));
          foundIdx = Array.from(current).findIndex((x,i,arr)=>fn(x,i,arr));
        }
        log('includes ->', inc, '| indexOf ->', idx, (findExpr ? ('| find -> ' + safeStringify(found) + ' @' + foundIdx) : ''));
        showCode(`arr.includes(${stringifyForCode(v)});  arr.indexOf(${stringifyForCode(v)});` + (findExpr ? `\narr.find(x => ${findExpr});` : ''));
      } catch(e){ log('Error', e.message); }
    }

    function opFill() {
      const rawVal = document.getElementById('fillVal').value;
      const val = parseInputValue(rawVal);
      const s = document.getElementById('fillStart').value;
      const e = document.getElementById('fillEnd').value;
      const sN = s === '' ? 0 : Number(s);
      const eN = e === '' ? undefined : Number(e);
      try {
        if (ArrayBuffer.isView(current)) {
          const tmp = Array.from(current);
          tmp.fill(val, sN, eN);
          setCurrentFrom(tmp);
        } else {
          current.fill(val, sN, eN);
          renderAll();
        }
        log('fill done');
        showCode(`arr.fill(${stringifyForCode(val)}, ${sN}, ${eN === undefined ? '' : eN});`);
      } catch(e){ log('Error fill', e.message); }
    }

    function opCopyWithin() {
      const t = Number(document.getElementById('cwTarget').value || 0);
      const s = Number(document.getElementById('cwStart').value || 0);
      const e = document.getElementById('cwEnd').value || undefined;
      try {
        if (ArrayBuffer.isView(current)) {
          const tmp = Array.from(current);
          tmp.copyWithin(t,s,e);
          setCurrentFrom(tmp);
        } else {
          current.copyWithin(t,s,e);
          renderAll();
        }
        log('copyWithin done');
        showCode(`arr.copyWithin(${t}, ${s}, ${e === undefined ? '' : e});`);
      } catch(e){ log('Error copyWithin', e.message); }
    }

    // length operations
    function setLength() {
      const v = document.getElementById('lengthInput').value;
      if (v === '') { log('Enter a length'); return; }
      const n = Number(v);
      if (n < 0) { log('Length must be >= 0'); return; }
      try {
        if (ArrayBuffer.isView(current)) {
          const tmp = Array.from(current).slice(0,n);
          while (tmp.length < n) tmp.push(undefined);
          setCurrentFrom(tmp);
        } else {
          current.length = n;
          renderAll();
        }
        log('.length set to', n);
        showCode('arr.length = ' + n + ';');
      } catch(e){ log('Error setting length', e.message); }
    }

    function showProperty() {
      log('.length ->', Array.from(current).length);
    }

    // Export / utilities
    function stringifyForCode(v) {
      if (v === undefined) return 'undefined';
      try { return JSON.stringify(v); } catch(e){ return String(v); }
    }

    function clearLog(){ logEl.innerHTML = ''; }

    function exportArray() {
      const json = JSON.stringify(Array.from(current), null, 2);
      navigator.clipboard?.writeText(json).then(()=>log('Copied JSON to clipboard')).catch(()=>log('Could not copy to clipboard, here it is:', json));
    }

    function downloadArray() {
      const json = JSON.stringify(Array.from(current), null, 2);
      const blob = new Blob([json], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'array.json';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      log('Downloaded array.json');
    }

    function safeEvalJSON(s) {
      try { return JSON.parse(s); } catch(e){ return null; }
    }

    // helper to initialize with a demo array
    (function init(){
      arrInput.value = '[1,2,3,4]';
      createArray();
      log('Welcome to Array Explorer — modify arrays and try operations!');
    })();
  </script>
</body>
</html>