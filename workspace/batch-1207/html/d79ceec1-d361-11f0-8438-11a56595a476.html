<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Radix Sort Visualization</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f2f7fc;
  }
  h1 {
    text-align: center;
  }
  #inputArea {
    margin-bottom: 20px;
    text-align: center;
  }
  input[type="text"] {
    width: 300px;
    font-size: 1.1em;
    padding: 6px 10px;
  }
  button {
    font-size: 1em;
    padding: 7px 14px;
    margin-left: 10px;
    cursor: pointer;
  }
  #error {
    color: darkred;
    margin-top: 10px;
    height: 20px;
    text-align: center;
  }
  #arrayContainer {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    min-height: 50px;
    margin-bottom: 30px;
  }
  .array-element {
    padding: 10px 14px;
    margin: 4px;
    background-color: #4a90e2;
    color: white;
    font-weight: bold;
    border-radius: 4px;
    min-width: 40px;
    text-align: center;
    font-size: 1.1em;
    user-select: none;
    transition: background-color 0.3s ease;
  }
  .highlight {
    background-color: #e94e77 !important;
    box-shadow: 0 0 8px 2px #e94e77;
  }
  .bucket-container {
    margin-top: 10px;
    margin-bottom: 30px;
    display: flex;
    justify-content: center;
    gap: 15px;
  }
  .bucket {
    background: #fff;
    border: 2px solid #4a90e2;
    border-radius: 6px;
    min-width: 60px;
    min-height: 80px;
    padding: 6px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .bucket-label {
    font-weight: bold;
    margin-bottom: 6px;
    color: #4a90e2;
    user-select: none;
  }
  .bucket-element {
    background-color: #7fb3e6;
    color: white;
    border-radius: 3px;
    padding: 3px 6px;
    margin: 2px 0;
    min-width: 32px;
    text-align: center;
    font-weight: 600;
    font-size: 0.9em;
  }
  #controls {
    text-align: center;
    margin-bottom: 30px;
  }
  #speedLabel {
    margin-left: 15px;
    font-size: 1em;
  }
  #info {
    max-width: 600px;
    margin: 0 auto;
    background: white;
    border-radius: 8px;
    padding: 15px 20px;
    box-shadow: 0 0 10px #ccc;
  }
  #info h2 {
    margin-top: 0;
    color: #4a90e2;
  }
  #footer {
    margin-top: 40px;
    text-align: center;
    color: #666;
    font-size: 0.9em;
  }
</style>
</head>
<body>

<h1>Radix Sort Visualization</h1>

<div id="inputArea">
  <input type="text" id="inputArray" placeholder="Enter positive integers separated by commas" />
  <button id="startBtn">Start Sort</button>
  <button id="resetBtn" disabled>Reset</button>
  <label for="speedRange">Speed:</label>
  <input type="range" id="speedRange" min="100" max="2000" step="100" value="800" />
  <span id="speedLabel">800 ms</span>
  <div id="error"></div>
</div>

<div id="arrayContainer"></div>

<div id="bucketArea">
  <div class="bucket-container" id="buckets"></div>
</div>

<div id="info">
  <h2>How Radix Sort Works</h2>
  <p>
    Radix Sort is a non-comparative sorting algorithm that sorts integers by processing individual digits.
    It works by grouping numbers by each digit, starting from the least significant digit (rightmost) to the
    most significant digit (leftmost). In each pass, the numbers are distributed into buckets (0-9) according
    to the current digit, then collected back in order. This process repeats for each digit place until the array
    is sorted.
  </p>
</div>

<div id="footer">
  &copy; 2024 Radix Sort Demo
</div>

<script>
  (() => {
    const inputEl = document.getElementById('inputArray');
    const startBtn = document.getElementById('startBtn');
    const resetBtn = document.getElementById('resetBtn');
    const errorEl = document.getElementById('error');
    const arrayContainer = document.getElementById('arrayContainer');
    const bucketsContainer = document.getElementById('buckets');
    const speedRange = document.getElementById('speedRange');
    const speedLabel = document.getElementById('speedLabel');

    let array = [];
    let originalArray = [];
    let sorting = false;
    let delay = parseInt(speedRange.value);

    speedRange.addEventListener('input', () => {
      delay = parseInt(speedRange.value);
      speedLabel.textContent = `${delay} ms`;
    });

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    function createArrayElements(arr) {
      arrayContainer.innerHTML = '';
      arr.forEach((num, i) => {
        const el = document.createElement('div');
        el.classList.add('array-element');
        el.textContent = num;
        el.dataset.index = i;
        arrayContainer.appendChild(el);
      });
    }

    function resetBuckets() {
      bucketsContainer.innerHTML = '';
      for (let i = 0; i <= 9; i++) {
        const bucket = document.createElement('div');
        bucket.classList.add('bucket');
        bucket.id = 'bucket-' + i;
        const label = document.createElement('div');
        label.classList.add('bucket-label');
        label.textContent = i;
        bucket.appendChild(label);
        bucketsContainer.appendChild(bucket);
      }
    }

    /**
     * Get digit at digitPlace from right (0-based)
     * For example getDigit(123,0) = 3, getDigit(123,1) = 2
     */
    function getDigit(num, digitPlace) {
      return Math.floor(num / Math.pow(10, digitPlace)) % 10;
    }

    /**
     * Get max digits in numbers of array
     */
    function getMaxDigits(nums) {
      let max = 0;
      nums.forEach(n => {
        const digits = n.toString().length;
        if (digits > max) max = digits;
      });
      return max;
    }

    /**
     * Update array display with optional highlight on indices
     * highlightIndices is an array of indices to highlight
     */
    function updateArrayDisplay(arr, highlightIndices = []) {
      const els = arrayContainer.querySelectorAll('.array-element');
      els.forEach((el, i) => {
        el.textContent = arr[i];
        if (highlightIndices.includes(i)) {
          el.classList.add('highlight');
        } else {
          el.classList.remove('highlight');
        }
      });
    }

    /**
     * Clear all bucket contents except labels
     */
    function clearBuckets() {
      for (let i = 0; i <= 9; i++) {
        const bucket = document.getElementById('bucket-' + i);
        while (bucket.children.length > 1) {
          bucket.removeChild(bucket.lastChild);
        }
      }
    }

    /**
     * Add elements to buckets visualization
     * bucketMap: digit -> array of numbers
     */
    function updateBuckets(bucketMap) {
      clearBuckets();
      for (let digit = 0; digit <= 9; digit++) {
        const bucket = document.getElementById('bucket-' + digit);
        const numbers = bucketMap[digit] || [];
        numbers.forEach(num => {
          const el = document.createElement('div');
          el.classList.add('bucket-element');
          el.textContent = num;
          bucket.appendChild(el);
        });
      }
    }

    async function radixSortVisual(arr) {
      sorting = true;
      startBtn.disabled = true;
      resetBtn.disabled = false;
      inputEl.disabled = true;
      speedRange.disabled = true;
      errorEl.textContent = '';

      const maxDigit = getMaxDigits(arr);
      let nums = [...arr];

      for (let digitPlace = 0; digitPlace < maxDigit; digitPlace++) {
        // Highlight current digit place
        errorEl.textContent = `Sorting by digit place ${digitPlace} (0 = least significant digit)`;
        let buckets = {};
        for (let i = 0; i < 10; i++) buckets[i] = [];

        // Show array and highlight all as active to show processing
        updateArrayDisplay(nums, [...Array(nums.length).keys()]);
        await sleep(delay / 2);

        // Place numbers into buckets by current digit
        for (let i = 0; i < nums.length; i++) {
          const num = nums[i];
          updateArrayDisplay(nums, [i]);
          await sleep(delay / 3);
          const digit = getDigit(num, digitPlace);
          buckets[digit].push(num);
          updateBuckets(buckets);
          await sleep(delay / 3);
        }

        // Collect numbers from buckets back into array
        let collected = [];
        updateArrayDisplay(nums, []);
        await sleep(delay / 2);
        for (let digit = 0; digit <= 9; digit++) {
          const bucketNums = buckets[digit];
          for (let num of bucketNums) {
            collected.push(num);
            updateBuckets(buckets);
            updateArrayDisplay(collected.concat(nums.slice(collected.length)), [collected.length - 1]);
            await sleep(delay / 3);
          }
        }
        nums = collected;
      }

      // Final update to array display with no highlights
      updateArrayDisplay(nums, []);
      clearBuckets();
      errorEl.textContent = 'Array is sorted!';
      sorting = false;
      startBtn.disabled = false;
      resetBtn.disabled = false;
      inputEl.disabled = false;
      speedRange.disabled = false;
      array = nums;
    }

    startBtn.addEventListener('click', async () => {
      if (sorting) return;
      errorEl.textContent = '';

      let rawInput = inputEl.value.trim();
      if (!rawInput) {
        errorEl.textContent = 'Please enter some numbers to sort.';
        return;
      }

      // Parse input
      let nums = rawInput.split(',').map(s => s.trim()).filter(s => s !== '');
      if (nums.length === 0) {
        errorEl.textContent = 'Please enter valid numbers separated by commas.';
        return;
      }
      let parsed = [];
      for (let s of nums) {
        if (!/^\d+$/.test(s)) {
          errorEl.textContent = 'Only positive integers are allowed.';
          return;
        }
        parsed.push(parseInt(s, 10));
      }

      array = parsed;
      originalArray = [...array];
      createArrayElements(array);
      resetBuckets();

      await radixSortVisual(array);
    });

    resetBtn.addEventListener('click', () => {
      if (sorting) return;
      errorEl.textContent = '';
      inputEl.value = originalArray.join(', ');
      createArrayElements(originalArray);
      array = [...originalArray];
      resetBuckets();
      resetBtn.disabled = true;
    });

    // Initialize with sample data
    function init() {
      const sample = [170, 45, 75, 90, 802, 24, 2, 66];
      inputEl.value = sample.join(', ');
      originalArray = [...sample];
      createArrayElements(sample);
      resetBuckets();
      resetBtn.disabled = true;
    }

    init();
  })();
</script>

</body>
</html>