<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Knapsack Problem Demo</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    max-width: 900px;
  }
  h1 {
    text-align: center;
  }
  table {
    border-collapse: collapse;
    margin-bottom: 15px;
    width: 100%;
  }
  th, td {
    border: 1px solid #aaa;
    padding: 8px;
    text-align: center;
  }
  input[type=number] {
    width: 80px;
    padding: 4px;
    margin-right: 10px;
  }
  button {
    padding: 8px 16px;
    font-size: 1em;
    margin: 10px 0;
    cursor: pointer;
  }
  #items-input {
    margin-bottom: 20px;
  }
  #result {
    margin-top: 20px;
    background: #f9f9f9;
    border: 1px solid #ddd;
    padding: 10px;
    white-space: pre-wrap;
  }
  .highlight {
    background: #dff0d8;
    font-weight: bold;
  }
  .warning {
    color: red;
    margin: 10px 0;
  }
  @media(max-width: 600px) {
    input[type=number] {
      width: 100%;
      margin: 5px 0;
    }
    button {
      width: 100%;
    }
  }
</style>
</head>
<body>

<h1>Knapsack Problem Solver Demo</h1>

<p>
  Enter the knapsack capacity (positive integer), then define items by their weight and value.
  The goal is to maximize total value while not exceeding the capacity.
</p>

<div>
  <label for="capacity">Knapsack Capacity:&nbsp;</label>
  <input type="number" id="capacity" min="1" value="10" />
</div>

<div id="items-input">
  <h3>Items (weight, value):</h3>
  <table id="items-table" aria-label="Items input table">
    <thead>
      <tr><th>#</th><th>Weight</th><th>Value</th><th>Action</th></tr>
    </thead>
    <tbody>
      <tr>
        <td>1</td>
        <td><input type="number" min="1" value="2" /></td>
        <td><input type="number" min="0" value="3" /></td>
        <td><button class="delete-item" aria-label="Delete item 1">✖</button></td>
      </tr>
      <tr>
        <td>2</td>
        <td><input type="number" min="1" value="3" /></td>
        <td><input type="number" min="0" value="4" /></td>
        <td><button class="delete-item" aria-label="Delete item 2">✖</button></td>
      </tr>
      <tr>
        <td>3</td>
        <td><input type="number" min="1" value="4" /></td>
        <td><input type="number" min="0" value="5" /></td>
        <td><button class="delete-item" aria-label="Delete item 3">✖</button></td>
      </tr>
      <tr>
        <td>4</td>
        <td><input type="number" min="1" value="5" /></td>
        <td><input type="number" min="0" value="8" /></td>
        <td><button class="delete-item" aria-label="Delete item 4">✖</button></td>
      </tr>
    </tbody>
  </table>
  <button id="add-item-btn" aria-label="Add new item">➕ Add Item</button>
</div>

<button id="solve-btn" aria-label="Solve knapsack problem">Solve Knapsack</button>

<div id="warning-msg" class="warning" role="alert" aria-live="assertive"></div>

<h3>Result:</h3>
<pre id="result" aria-live="polite" aria-atomic="true"></pre>

<script>
(() => {
  const capacityInput = document.getElementById('capacity');
  const itemsTableBody = document.querySelector('#items-table tbody');
  const addItemBtn = document.getElementById('add-item-btn');
  const solveBtn = document.getElementById('solve-btn');
  const resultPre = document.getElementById('result');
  const warningMsg = document.getElementById('warning-msg');

  // Add new item row
  function addItem(weight = '', value = '') {
    const rowCount = itemsTableBody.rows.length;
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${rowCount + 1}</td>
      <td><input type="number" min="1" value="${weight}" /></td>
      <td><input type="number" min="0" value="${value}" /></td>
      <td><button class="delete-item" aria-label="Delete item ${rowCount + 1}">✖</button></td>
    `;
    itemsTableBody.appendChild(row);
  }

  // Delete item row
  function deleteItem(event) {
    if (!event.target.classList.contains('delete-item')) return;
    const row = event.target.closest('tr');
    row.remove();
    updateRowNumbers();
  }

  // Update the item numbers in the first column and aria-label on delete buttons
  function updateRowNumbers() {
    Array.from(itemsTableBody.rows).forEach((row, i) => {
      row.cells[0].textContent = i + 1;
      const delBtn = row.querySelector('.delete-item');
      delBtn.setAttribute('aria-label', `Delete item ${i + 1}`);
    });
  }

  // Display warning messages
  function warn(msg) {
    warningMsg.textContent = msg;
  }

  // Clear warning
  function clearWarn() {
    warningMsg.textContent = '';
  }

  // Parse input items
  function getItems() {
    const items = [];
    for (const row of itemsTableBody.rows) {
      const weightInput = row.cells[1].querySelector('input');
      const valueInput = row.cells[2].querySelector('input');
      let w = parseInt(weightInput.value, 10);
      let v = parseInt(valueInput.value, 10);
      if (isNaN(w) || w < 1) return { error: 'Weights must be integers ≥ 1.' };
      if (isNaN(v) || v < 0) return { error: 'Values must be integers ≥ 0.' };
      items.push({ weight: w, value: v });
    }
    if (items.length === 0) return { error: 'Please add at least one item.' };
    return { items };
  }

  // Knapsack solver - 0/1 Knapsack using DP (bottom-up)
  // Returns { maxValue, selectedItemsIndices }
  function knapsack(capacity, items) {
    // dp[i][w] = maximum value for first i items with max weight w
    const n = items.length;
    const dp = Array(n + 1).fill(null).map(() => Array(capacity + 1).fill(0));

    for (let i = 1; i <= n; i++) {
      const { weight, value } = items[i-1];
      for (let w = 0; w <= capacity; w++) {
        if (weight > w) {
          dp[i][w] = dp[i-1][w];
        } else {
          dp[i][w] = Math.max(dp[i-1][w], dp[i-1][w - weight] + value);
        }
      }
    }

    // Backtrack to find selected items
    let w = capacity;
    const selectedItemsIndices = [];
    for (let i = n; i > 0; i--) {
      if (dp[i][w] !== dp[i-1][w]) {
        selectedItemsIndices.push(i-1);
        w -= items[i-1].weight;
      }
    }
    selectedItemsIndices.reverse();

    return { maxValue: dp[n][capacity], selectedItemsIndices, dp };
  }

  // Display result including DP table summary
  function displayResult(capacity, items, solution) {
    const { maxValue, selectedItemsIndices, dp } = solution;
    let output = '';
    output += `Knapsack Capacity: ${capacity}\n`;
    output += `Number of Items: ${items.length}\n\n`;
    output += `Items (index: weight, value):\n`;
    items.forEach(({weight, value}, i) => {
      const selected = selectedItemsIndices.includes(i) ? '*' : ' ';
      output += `${selected} [${i+1}]: (${weight}, ${value})\n`;
    });
    output += '\n';
    output += `Max Total Value: ${maxValue}\n`;
    output += `Selected Items:\n`;
    if (selectedItemsIndices.length === 0) {
      output += "  None (knapsack cannot accommodate any item)\n";
    } else {
      selectedItemsIndices.forEach(i => {
        const { weight, value } = items[i];
        output += `  - Item ${i+1} (weight: ${weight}, value: ${value})\n`;
      });
    }
    output += '\n';

    // Show a snippet of the dp table:
    output += "DP Table (rows=items, cols=capacity):\n";
    output += `  Capacity → 0 `;
    for (let w = 1; w <= capacity; w++) {
      output += w % 10 + ' ';
    }
    output += '\n';

    const maxRowsToShow = Math.min(items.length, 15);
    for (let i = 0; i <= maxRowsToShow; i++) {
      if (i === 0) {
        output += "i=0 (no items) ";
      } else {
        output += `i=${i} (item ${i}) `.padEnd(14, ' ');
      }
      for (let w = 0; w <= capacity; w++) {
        output += dp[i][w].toString().padStart(2) + ' ';
      }
      output += '\n';
    }
    if (items.length > 15) {
      output += `... (DP table rows truncated, total items = ${items.length})\n`;
    }

    resultPre.textContent = output;
  }

  // On Solve click
  function solve() {
    clearWarn();
    resultPre.textContent = '';
    const capacityVal = parseInt(capacityInput.value, 10);
    if (isNaN(capacityVal) || capacityVal < 1) {
      warn('Capacity must be an integer ≥ 1.');
      return;
    }
    const { error, items } = getItems();
    if (error) {
      warn(error);
      return;
    }
    // Check for large input sizes (heuristic limit)
    if (capacityVal > 10000) {
      warn('Capacity too large - computation might take a long time.');
      return;
    }
    if (items.length > 1000) {
      warn('Too many items - please limit to 1000 items or fewer.');
      return;
    }

    try {
      const solution = knapsack(capacityVal, items);
      displayResult(capacityVal, items, solution);
    } catch (ex) {
      warn('Error during solving: ' + ex.message);
    }
  }

  // Event listeners
  addItemBtn.addEventListener('click', () => addItem());
  itemsTableBody.addEventListener('click', deleteItem);
  solveBtn.addEventListener('click', solve);
})();
</script>

</body>
</html>