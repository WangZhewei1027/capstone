<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Counting Sort Visualization & Demo</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 2rem;
    background: #f5f7fa;
    color: #333;
  }
  h1 {
    text-align: center;
  }
  #input-section, #output-section {
    max-width: 600px;
    margin: 1rem auto;
    background: white;
    padding: 1rem 2rem 2rem 2rem;
    border-radius: 8px;
    box-shadow: 0 0 8px rgba(0,0,0,0.1);
  }
  label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: bold;
  }
  input[type=text] {
    width: 100%;
    font-size: 1rem;
    padding: 0.5rem;
    box-sizing: border-box;
    border-radius: 4px;
    border: 1px solid #ccc;
  }
  button {
    margin-top: 1rem;
    padding: 0.6rem 1.2rem;
    font-size: 1rem;
    border-radius: 4px;
    border: none;
    background-color: #3b82f6;
    color: white;
    cursor: pointer;
  }
  button:disabled {
    background-color: #a5b4fc;
    cursor: not-allowed;
  }
  #result {
    margin-top: 1rem;
    font-family: monospace;
    white-space: pre-wrap;
    background: #e0e7ff;
    padding: 1rem;
    border-radius: 6px;
    min-height: 3rem;
  }
  #visualization {
    margin-top: 1.5rem;
  }
  .count-bar {
    display: inline-block;
    margin: 0 2px;
    background-color: #3b82f6;
    color: white;
    text-align: center;
    border-radius: 3px;
  }
  .count-label {
    font-size: 0.8rem;
    margin-top: 0.2rem;
  }
  #steps {
    margin-top: 1.5rem;
    max-height: 200px;
    overflow-y: auto;
    background: #fff;
    border: 1px solid #ddd;
    padding: 1rem;
    border-radius: 6px;
    font-size: 0.9rem;
    white-space: pre-wrap;
  }
  .error {
    color: #dc2626;
    font-weight: bold;
    margin-top: 0.5rem;
  }
  footer {
    margin-top: 3rem;
    font-size: 0.9rem;
    color: #555;
    text-align: center;
  }
  @media (max-width: 640px) {
    body {
      margin: 1rem;
    }
    #input-section, #output-section {
      padding: 1rem;
    }
  }
</style>
</head>
<body>
  <h1>Counting Sort Visualization & Demo</h1>

  <section id="input-section">
    <label for="inputArray">Enter non-negative integers (comma or space separated):</label>
    <input type="text" id="inputArray" placeholder="e.g. 4, 2, 2, 8, 3, 3, 1" />
    <button id="sortBtn">Sort using Counting Sort</button>
    <div id="errorMsg" class="error" aria-live="polite"></div>
  </section>

  <section id="output-section" aria-live="polite" aria-atomic="true">
    <h2>Sorted Output</h2>
    <div id="result"></div>

    <h2>Counting Array Visualization (Frequency Table)</h2>
    <div id="visualization"></div>

    <h2>Step-by-Step Explanation</h2>
    <div id="steps"></div>
  </section>

<script>
  (() => {
    const inputEl = document.getElementById("inputArray");
    const button = document.getElementById("sortBtn");
    const resultEl = document.getElementById("result");
    const visualizationEl = document.getElementById("visualization");
    const stepsEl = document.getElementById("steps");
    const errorEl = document.getElementById("errorMsg");

    // Counting Sort implementation with steps captured
    function countingSort(array) {
      const steps = [];
      if (array.length === 0) {
        steps.push("Input array is empty â€” nothing to sort.");
        return {sorted: [], steps};
      }

      const maxVal = Math.max(...array);
      steps.push(`Maximum value found: ${maxVal}`);

      // Initialize count array
      let count = new Array(maxVal + 1).fill(0);
      steps.push(`Initialized count array with size ${maxVal + 1}, all zeros.`);

      // Count frequency
      array.forEach((num, idx) => {
        count[num]++;
        steps.push(`Increment count[${num}] to ${count[num]} (processing element index ${idx})`);
      });

      // Visualization helper (after count)
      steps.push(`Frequency count completed: [${count.join(", ")}]`);

      // Modify count array by adding previous counts (cumulative count)
      for (let i = 1; i < count.length; i++) {
        count[i] += count[i - 1];
        steps.push(`Cumulative count at index ${i} updated to ${count[i]}`);
      }

      steps.push(`Cumulative count array: [${count.join(", ")}]`);

      // Output array same size as input
      let output = new Array(array.length);

      // Build output array (iterate backwards for stable sort)
      for (let i = array.length - 1; i >= 0; i--) {
        const num = array[i];
        count[num]--;
        const pos = count[num];
        output[pos] = num;
        steps.push(`Placed element ${num} from input index ${i} to output index ${pos}. Decremented count[${num}] to ${count[num]}`);
      }

      steps.push("Completed building the sorted output array.");

      return {sorted: output, steps, originalCountArray: count};
    }

    // Visualize frequency array (non-cumulative count for clarity)
    function visualizeCount(array) {
      if (array.length === 0) return;

      let maxFrequency = Math.max(...array);
      if (maxFrequency === 0) maxFrequency = 1; // avoid zero maxHeight

      const bars = array
        .map((freq, i) => {
          const heightPercent = (freq / maxFrequency) * 100;
          return `
            <div style="display:flex; flex-direction: column; align-items:center; margin:0 3px;">
              <div class="count-bar" style="height: ${heightPercent * 2}px; min-width: 20px;" title="Value ${i}: ${freq}">
                ${freq > 0 ? freq : ''}
              </div>
              <div class="count-label">${i}</div>
            </div>
          `;
        })
        .join("");
      visualizationEl.innerHTML = `<div style="display:flex; align-items:flex-end; justify-content:center;">${bars}</div>`;
    }

    // Validate input and parse to array of non-negative integers
    function parseInput(str) {
      // Split by comma or space or both
      const tokens = str.trim().split(/[\s,]+/);
      if (tokens.length === 1 && tokens[0] === "") return [];

      let nums = [];
      for (const t of tokens) {
        if (!/^\d+$/.test(t)) {
          return null; // invalid token
        }
        nums.push(parseInt(t, 10));
      }
      return nums;
    }

    button.addEventListener("click", () => {
      errorEl.textContent = "";
      resultEl.textContent = "";
      visualizationEl.innerHTML = "";
      stepsEl.textContent = "";

      const userInput = inputEl.value;
      const parsed = parseInput(userInput);

      if (parsed === null) {
        errorEl.textContent = "Invalid input! Please enter only non-negative integers separated by spaces or commas.";
        return;
      }

      if (parsed.length === 0) {
        resultEl.textContent = "Input array is empty.";
        return;
      }

      // Limit max value for demo (performance & visualization)
      const maxValueInInput = Math.max(...parsed);
      if (maxValueInInput > 1000) {
        errorEl.textContent = "Please enter numbers less than or equal to 1000 for visualization purposes.";
        return;
      }

      // Perform counting sort
      const {sorted, steps} = countingSort(parsed);

      // Show sorted result
      resultEl.textContent = `[ ${sorted.join(", ")} ]`;

      // Visualize frequency count before cumulative sum
      // To get frequency count, we re-derive it for clear visualization:
      let freq = new Array(maxValueInInput + 1).fill(0);
      parsed.forEach(n => freq[n]++);
      visualizeCount(freq);

      // Show step-by-step explanation
      stepsEl.textContent = steps.join("\n");
    });

    // Accessibility: allow pressing Enter when focus on input triggers sort
    inputEl.addEventListener("keypress", e => {
      if(e.key === "Enter"){
        button.click();
      }
    });
  })();
</script>
<footer>
  Counting Sort demo by ChatGPT
</footer>
</body>
</html>