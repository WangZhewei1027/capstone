<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merge Sort Demonstration</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #array {
            display: flex;
            margin: 20px 0;
        }
        .bar {
            width: 20px;
            margin: 1px;
            background-color: #4CAF50;
            text-align: center;
            color: white;
        }
        button {
            padding: 10px 15px;
            font-size: 16px;
        }
    </style>
</head>
<body>

<h1>Merge Sort Visualization</h1>
<p>Click the button to visualize the merge sort algorithm on a randomly generated array of numbers.</p>
<button id="startSort">Start Merge Sort</button>
<div id="array"></div>

<script>
    let arraySize = 20;
    let array = [];

    function generateArray() {
        array = [];
        for (let i = 0; i < arraySize; i++) {
            array.push(Math.floor(Math.random() * 100));
        }
        displayArray();
    }

    function displayArray() {
        const arrayDiv = document.getElementById('array');
        arrayDiv.innerHTML = '';
        array.forEach(value => {
            const bar = document.createElement('div');
            bar.className = 'bar';
            bar.style.height = `${value}px`;
            bar.innerText = value;
            arrayDiv.appendChild(bar);
        });
    }

    function mergeSort(arr) {
        if (arr.length <= 1) return arr;

        const mid = Math.floor(arr.length / 2);
        const left = mergeSort(arr.slice(0, mid));
        const right = mergeSort(arr.slice(mid));

        return merge(left, right);
    }

    function merge(left, right) {
        let result = [];
        let leftIndex = 0;
        let rightIndex = 0;

        while (leftIndex < left.length && rightIndex < right.length) {
            if (left[leftIndex] < right[rightIndex]) {
                result.push(left[leftIndex]);
                leftIndex++;
            } else {
                result.push(right[rightIndex]);
                rightIndex++;
            }
        }
        return result.concat(left.slice(leftIndex)).concat(right.slice(rightIndex));
    }

    async function startSort() {
        const sortedArray = await mergeSortWithVisualization(array);
        array = sortedArray;
        displayArray();
    }

    async function mergeSortWithVisualization(arr) {
        if (arr.length <= 1) {
            return arr;
        }

        const mid = Math.floor(arr.length / 2);
        const left = await mergeSortWithVisualization(arr.slice(0, mid));
        const right = await mergeSortWithVisualization(arr.slice(mid));

        const mergedArray = merge(left, right);
        await delayVisualization();
        return mergedArray;
    }

    function delayVisualization() {
        return new Promise(resolve => {
            setTimeout(() => {
                displayArray();
                resolve();
            }, 500); // Delay in milliseconds.
        });
    }

    document.getElementById('startSort').addEventListener('click', () => {
        generateArray();
        startSort();
    });

    // Initial array generation
    generateArray();
</script>

</body>
</html>