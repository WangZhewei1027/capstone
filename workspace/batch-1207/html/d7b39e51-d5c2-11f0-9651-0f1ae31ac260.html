<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Heap Sort Visualization</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f9f9f9;
  }
  h1 {
    text-align: center;
  }
  #arrayInput {
    width: 100%;
    font-size: 16px;
    padding: 8px;
    box-sizing: border-box;
  }
  #sortButton {
    margin-top: 10px;
    padding: 10px;
    font-size: 18px;
    background-color: #4285f4;
    border: none;
    color: white;
    width: 100%;
    cursor: pointer;
    border-radius: 4px;
  }
  #sortButton:disabled {
    background-color: #a0c3ff;
    cursor: not-allowed;
  }
  #arrayContainer {
    margin-top: 30px;
    display: flex;
    justify-content: center;
    align-items: flex-end;
    gap: 5px;
    min-height: 200px;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
  }
  .array-bar {
    background-color: #4285f4;
    width: 30px;
    color: black;
    text-align: center;
    font-weight: bold;
    border-radius: 4px 4px 0 0;
    user-select: none;
    position: relative;
  }
  .array-bar.swap {
    background-color: #ff7043;
  }
  .array-bar.sorted {
    background-color: #34a853;
    color: white;
  }
  #info {
    max-width: 800px;
    margin: 20px auto;
    font-size: 16px;
    color: #444;
  }
  #speedControl {
    max-width: 800px;
    margin: 20px auto;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  #speedControl label {
    flex: 0 0 100px;
  }
  #speedControl input[type=range] {
    flex: 1;
  }
  footer {
    text-align: center;
    margin-top: 40px;
    color: #888;
    font-size: 14px;
  }
</style>
</head>
<body>
<h1>Heap Sort Visualization</h1>
<p>Enter array elements separated by commas or spaces:</p>
<textarea id="arrayInput" rows="2" placeholder="e.g. 12, 4, 56, 23, 78, 1, 9"></textarea>
<button id="sortButton">Start Heap Sort</button>

<div id="speedControl">
  <label for="speedRange">Speed (ms):</label>
  <input type="range" id="speedRange" min="50" max="1000" value="300" step="50" />
  <span id="speedValue">300</span> ms
</div>

<div id="arrayContainer"></div>

<div id="info">
  <h2>How Heap Sort works:</h2>
  <p>
    Heap Sort is a comparison-based sorting algorithm that uses a binary heap data structure.
    First, it builds a max heap from the input data. Then, it repeatedly swaps the root (maximum element)
    of the heap with the last element of the heap, reduces the heap size by one, and heapifies the root again.
    This process continues until the heap size is 1.
  </p>
  <p><strong>Key steps in visualization:</strong></p>
  <ul>
    <li><strong>Heapify:</strong> Arrange a subtree to follow the max-heap property.</li>
    <li><strong>Build max heap:</strong> Call heapify bottom-up starting from the last non-leaf node.</li>
    <li><strong>Extract max:</strong> Swap root with last element and reduce heap size.</li>
  </ul>
</div>

<footer>
  Heap Sort visualization &mdash; Demonstration by ChatGPT
</footer>

<script>
(() => {
  const arrayInput = document.getElementById('arrayInput');
  const sortButton = document.getElementById('sortButton');
  const arrayContainer = document.getElementById('arrayContainer');
  const speedRange = document.getElementById('speedRange');
  const speedValue = document.getElementById('speedValue');

  let speed = parseInt(speedRange.value, 10);
  speedRange.addEventListener('input', () => {
    speed = parseInt(speedRange.value, 10);
    speedValue.textContent = speed;
  });

  function sleep(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms));
  }

  // Parse input to array of numbers
  function parseInput(input) {
    // split by commas or spaces
    return input
      .trim()
      .split(/[\s,]+/)
      .map(Number)
      .filter(n => !isNaN(n));
  }

  // Render bars for the array
  function renderArray(arr, highlights = {}, heapSize = arr.length) {
    // highlights: { swap: [indices], heapify: [indices], sorted: [indices] }
    arrayContainer.innerHTML = '';
    if (arr.length === 0) return;

    const maxVal = Math.max(...arr);
    arr.forEach((val, idx) => {
      const bar = document.createElement('div');
      bar.classList.add('array-bar');
      // Height proportional (min height 20px)
      const height = 20 + (val / maxVal) * 160;
      bar.style.height = height + 'px';
      bar.textContent = val;
      if (highlights.sorted && highlights.sorted.includes(idx)) {
        bar.classList.add('sorted');
      } else if (highlights.swap && highlights.swap.includes(idx)) {
        bar.classList.add('swap');
      } else if (highlights.heapify && highlights.heapify.includes(idx)) {
        bar.style.backgroundColor = '#fbbc04'; // yellow for heapify nodes
      } else if (idx >= heapSize) {
        bar.style.backgroundColor = '#ddd'; // elements outside heap (sorted tail)
        bar.style.color = '#666';
      }
      arrayContainer.appendChild(bar);
    });
  }

  async function heapSort(arr) {
    let n = arr.length;
    let highlights = {sorted: [], swap: [], heapify: []};

    // Build max heap
    for (let i = Math.floor(n / 2) - 1; i >= 0; i--) {
      await heapify(arr, n, i);
    }

    // One by one extract elements
    for (let i = n - 1; i > 0; i--) {
      highlights.swap = [0, i];
      renderArray(arr, highlights, i+1);
      await sleep(speed);

      // Swap current root with end
      [arr[0], arr[i]] = [arr[i], arr[0]];

      highlights.sorted.push(i);
      highlights.swap = [0];
      renderArray(arr, highlights, i);
      await sleep(speed);

      await heapify(arr, i, 0);

      highlights.swap = [];
      renderArray(arr, highlights, i);
    }
    highlights.sorted = Array.from({length: n}, (_, i) => i);
    highlights.heapify = [];
    highlights.swap = [];
    renderArray(arr, highlights, 0);
  }

  // Heapify subtree rooted at index i, n is heap size
  async function heapify(arr, n, i) {
    let largest = i;
    let left = 2*i + 1;
    let right = 2*i + 2;

    let highlights = { heapify: [i] };
    if (left < n) highlights.heapify.push(left);
    if (right < n) highlights.heapify.push(right);

    renderArray(arr, highlights, n);
    await sleep(speed);

    if (left < n && arr[left] > arr[largest]) {
      largest = left;
    }
    if (right < n && arr[right] > arr[largest]) {
      largest = right;
    }
    if (largest !== i) {
      // Swap and continue heapify
      let highlightsSwap = { swap: [i, largest], heapify: [i, left, right] };
      renderArray(arr, highlightsSwap, n);
      await sleep(speed);

      [arr[i], arr[largest]] = [arr[largest], arr[i]];

      renderArray(arr, highlightsSwap, n);
      await sleep(speed);

      await heapify(arr, n, largest);
    } else {
      renderArray(arr, { heapify: [i] }, n);
      await sleep(speed);
    }
  }

  function disableControls(disabled) {
    arrayInput.disabled = disabled;
    sortButton.disabled = disabled;
    speedRange.disabled = disabled;
  }

  sortButton.addEventListener('click', async () => {
    let arr = parseInput(arrayInput.value);
    if (arr.length === 0) {
      alert('Please enter a valid array of numbers.');
      return;
    }
    if (arr.length > 50) {
      alert('Please enter no more than 50 numbers for clear visualization.');
      return;
    }

    disableControls(true);
    renderArray(arr);
    await heapSort(arr);
    disableControls(false);
  });

  // Initial sample array
  const initialArray = '12, 4, 56, 23, 78, 1, 9';
  arrayInput.value = initialArray;
  renderArray(parseInput(initialArray));
})();
</script>
</body>
</html>