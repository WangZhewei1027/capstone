<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Heap Sort Visualization</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f9f9f9;
  }
  h1 {
    text-align: center;
    color: #333;
  }
  #inputArea {
    text-align: center;
    margin-bottom: 15px;
  }
  #arrayInput {
    width: 60%;
    padding: 8px;
    font-size: 16px;
  }
  button {
    padding: 9px 15px;
    font-size: 16px;
    margin-left: 10px;
    cursor: pointer;
    background-color: #2874f0;
    color: white;
    border: none;
    border-radius: 5px;
  }
  button:hover {
    background-color: #155ab6;
  }
  #bars {
    display: flex;
    align-items: flex-end;
    justify-content: center;
    height: 300px;
    margin-top: 20px;
    gap: 5px;
    border-top: 2px solid #666;
    border-bottom: 2px solid #666;
    background: white;
    padding: 10px 0;
    max-width: 90vw;
    margin-left: auto;
    margin-right: auto;
  }
  .bar {
    width: 20px;
    background-color: #2874f0;
    border-radius: 3px 3px 0 0;
    position: relative;
  }
  .bar.highlight {
    background-color: #e67e22;
  }
  .bar.swap {
    background-color: #e74c3c;
  }
  .bar.sorted {
    background-color: #2ecc71;
  }
  .bar::after {
    content: attr(data-value);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    font-size: 12px;
    color: #222;
  }
  #log {
    max-width: 90vw;
    margin: 20px auto 0;
    background: white;
    padding: 15px;
    border-radius: 8px;
    font-family: monospace;
    height: 150px;
    overflow-y: auto;
    box-shadow: 0 0 8px #ccc;
  }
</style>
</head>
<body>
<h1>Heap Sort Visualization</h1>
<div id="inputArea">
  <input type="text" id="arrayInput" placeholder="Enter numbers separated by commas" />
  <button id="startBtn">Start Heap Sort</button>
</div>
<div id="bars"></div>
<div id="log"></div>

<script>
(() => {
  const barsContainer = document.getElementById("bars");
  const input = document.getElementById("arrayInput");
  const startBtn = document.getElementById("startBtn");
  const logEl = document.getElementById("log");

  let array = [];
  let delay = 600; // milliseconds per animation step

  function log(message) {
    logEl.textContent += message + "\n";
    logEl.scrollTop = logEl.scrollHeight;
  }

  function clearLog() {
    logEl.textContent = "";
  }

  function createBars(arr) {
    barsContainer.innerHTML = "";
    const maxVal = Math.max(...arr);
    arr.forEach((val) => {
      const bar = document.createElement("div");
      bar.classList.add("bar");
      bar.style.height = ((val / maxVal) * 250 + 20) + "px";
      bar.setAttribute("data-value", val);
      barsContainer.appendChild(bar);
    });
  }

  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  async function swap(arr, i, j) {
    log(`Swapping indices ${i} (${arr[i]}) and ${j} (${arr[j]})`);
    [arr[i], arr[j]] = [arr[j], arr[i]];
    updateBars(arr, i, j, true);
    await sleep(delay);
    updateBars(arr);
  }

  function updateBars(arr, highlight1 = -1, highlight2 = -1, swap = false, sortedUntil = -1) {
    const bars = barsContainer.children;
    const maxVal = Math.max(...arr);
    for (let i = 0; i < arr.length; i++) {
      const bar = bars[i];
      bar.style.height = ((arr[i] / maxVal) * 250 + 20) + "px";
      bar.setAttribute("data-value", arr[i]);
      bar.classList.remove("highlight", "swap", "sorted");
      if(i <= sortedUntil) {
        bar.classList.add("sorted");
      }
      if (i === highlight1 || i === highlight2) {
        if (swap) {
          bar.classList.add("swap");
        } else {
          bar.classList.add("highlight");
        }
      }
    }
  }

  async function heapify(arr, n, i) {
    let largest = i;
    const left = 2 * i + 1;
    const right = 2 * i + 2;

    updateBars(arr, i);
    await sleep(delay);

    if (left < n) {
      log(`Compare arr[${left}] (${arr[left]}) and arr[${largest}] (${arr[largest]})`);
      updateBars(arr, left, largest);
      await sleep(delay);
      if (arr[left] > arr[largest]) {
        largest = left;
      }
    }

    if (right < n) {
      log(`Compare arr[${right}] (${arr[right]}) and arr[${largest}] (${arr[largest]})`);
      updateBars(arr, right, largest);
      await sleep(delay);
      if (arr[right] > arr[largest]) {
        largest = right;
      }
    }

    if (largest !== i) {
      await swap(arr, i, largest);
      await heapify(arr, n, largest);
    }
  }

  async function heapSort(arr) {
    const n = arr.length;

    log("Building Max Heap...");
    // Build max heap
    for (let i = Math.floor(n / 2) - 1; i >= 0; i--) {
      await heapify(arr, n, i);
    }
    log("Max Heap built.");

    // One by one extract elements
    log("Extracting elements from heap and sorting...");
    for (let i = n - 1; i > 0; i--) {
      await swap(arr, 0, i);
      updateBars(arr, -1, -1, false, n - 1 - i);
      await heapify(arr, i, 0);
      updateBars(arr, -1, -1, false, n - 1 - i + 1);
    }
    // Mark all as sorted
    updateBars(arr, -1, -1, false, n - 1);
    log("Heap sort completed.");
  }

  startBtn.addEventListener("click", async () => {
    clearLog();
    let raw = input.value.trim();
    if (!raw) {
      alert("Please enter some numbers separated by commas.");
      return;
    }
    let parsed = raw.split(",").map(x => Number(x.trim())).filter(x => !isNaN(x));
    if (parsed.length === 0) {
      alert("Enter valid numbers separated by commas.");
      return;
    }
    if (parsed.length > 50) {
      alert("Please enter 50 or fewer numbers for visualization.");
      return;
    }
    array = parsed;
    createBars(array);
    startBtn.disabled = true;
    input.disabled = true;
    try {
      await heapSort(array);
    } catch(e) {
      log("Error occurred: " + e.message);
    } finally {
      startBtn.disabled = false;
      input.disabled = false;
    }
  });
})();
</script>
</body>
</html>