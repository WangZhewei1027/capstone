<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Quick Sort Visualizer</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  :root{
    --bg:#0f1724;
    --panel:#0b1220;
    --accent:#3b82f6;
    --muted:#94a3b8;
    --card:#071028;
    --ok:#16a34a;
    --danger:#ef4444;
    --yellow:#f59e0b;
    --pivot:#fb923c;
    --compare:#ef4444;
    --swap:#facc15;
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    color: #dbeafe;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#071025);}
  .app{max-width:1100px;margin:20px auto;padding:20px;border-radius:12px;background:linear-gradient(180deg,var(--panel),#051226);box-shadow:0 10px 30px rgba(2,6,23,.6);}
  header{display:flex;align-items:center;gap:16px;margin-bottom:12px;}
  header h1{font-size:20px;margin:0;}
  .controls{display:flex;flex-wrap:wrap;gap:12px;align-items:center;margin-bottom:12px;}
  .control{background:var(--card);padding:10px;border-radius:8px;display:flex;gap:8px;align-items:center;}
  label{font-size:13px;color:var(--muted);}
  input[type=range]{width:140px;}
  select,button,input[type=number]{background:#07132a;border:1px solid rgba(255,255,255,0.04);color:inherit;padding:6px 8px;border-radius:6px;}
  button{cursor:pointer;}
  button.primary{background:var(--accent);border:none;color:#032042;padding:8px 12px;border-radius:8px;}
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:6px 10px;}
  .viz{height:360px;background:linear-gradient(180deg,#02132a00,#02243a11);border-radius:8px;padding:12px;display:flex;align-items:flex-end;gap:4px;overflow:hidden;border:1px solid rgba(255,255,255,0.03);}
  .bar{flex:1 1 auto;margin:0 2px;background:linear-gradient(180deg,#7dd3fc,#0284c7);height:40%;border-radius:6px;display:flex;align-items:end;justify-content:center;color:#001;position:relative;transition:height .12s,transform .12s;}
  .bar .label{position:absolute;bottom:4px;font-size:11px;color:rgba(0,0,0,0.6);padding:1px 6px;border-radius:4px;}
  .bar.pivot{background:linear-gradient(180deg,var(--pivot),#fb7a2b);transform:scale(1.05);z-index:2;box-shadow:0 6px 24px rgba(251,146,60,0.12);}
  .bar.compare{background:linear-gradient(180deg,var(--compare),#ef4444);transform:translateY(-6px);}
  .bar.swap{background:linear-gradient(180deg,var(--swap),#facc15);transform:translateY(-6px);}
  .bar.sorted{background:linear-gradient(180deg,var(--ok),#3ad06a);color:#022;}
  .bar.range{background:linear-gradient(180deg,#60a5fa33,#0284c733);}
  .stats{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;}
  .stat{background:#071830;padding:8px 10px;border-radius:8px;color:var(--muted);font-size:13px;}
  .bottom{display:flex;gap:12px;margin-top:12px;}
  .panel{flex:1;background:#051428;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);}
  pre{background:transparent;color:var(--muted);font-size:13px;line-height:1.5;margin:0;white-space:pre-wrap;}
  .legend{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;}
  .key{display:flex;align-items:center;gap:8px;background:#021428;padding:6px 8px;border-radius:8px;font-size:13px;color:var(--muted);}
  .swatch{width:18px;height:12px;border-radius:4px;}
  footer{margin-top:12px;color:var(--muted);font-size:12px;}
  @media (max-width:720px){
    .controls{flex-direction:column;align-items:stretch;}
    .viz{height:260px;}
  }
</style>
</head>
<body>
<div class="app">
  <header>
    <h1>Quick Sort Visualizer</h1>
    <div style="color:var(--muted);font-size:13px;">Interactive demonstration of in-place Quick Sort (Lomuto partition)</div>
  </header>

  <div class="controls">
    <div class="control">
      <label for="size">Size</label>
      <input id="size" type="range" min="6" max="80" value="30" />
      <span id="sizeLabel" style="min-width:34px;text-align:center;font-weight:600;color:var(--muted)">30</span>
    </div>

    <div class="control">
      <label for="pivot">Pivot</label>
      <select id="pivot">
        <option value="last">Last (Lomuto)</option>
        <option value="first">First</option>
        <option value="random">Random</option>
        <option value="median">Median of Three</option>
      </select>
    </div>

    <div class="control">
      <label for="speed">Speed</label>
      <input id="speed" type="range" min="10" max="1000" value="120" />
      <span id="speedLabel" style="min-width:40px;text-align:center;font-weight:600;color:var(--muted)">120ms</span>
    </div>

    <div class="control">
      <button id="generate" class="ghost">Generate</button>
      <button id="shuffle" class="ghost">Shuffle</button>
      <button id="run" class="primary">Play</button>
      <button id="step" class="ghost">Step</button>
      <button id="reset" class="ghost">Reset</button>
    </div>
  </div>

  <div id="viz" class="viz" aria-hidden="false"></div>

  <div class="stats" id="stats">
    <div class="stat">Comparisons: <strong id="comp">0</strong></div>
    <div class="stat">Swaps: <strong id="swaps">0</strong></div>
    <div class="stat">Recursive calls: <strong id="rcalls">0</strong></div>
    <div class="stat">Actions queued: <strong id="queued">0</strong></div>
  </div>

  <div class="legend">
    <div class="key"><div class="swatch" style="background:linear-gradient(180deg,var(--pivot),#fb7a2b)"></div> Pivot</div>
    <div class="key"><div class="swatch" style="background:linear-gradient(180deg,var(--compare),#ef4444)"></div> Comparing</div>
    <div class="key"><div class="swatch" style="background:linear-gradient(180deg,var(--swap),#facc15)"></div> Swapping</div>
    <div class="key"><div class="swatch" style="background:linear-gradient(180deg,var(--ok),#3ad06a)"></div> Sorted</div>
    <div class="key"><div class="swatch" style="background:linear-gradient(180deg,#60a5fa33,#0284c733)"></div> Active range</div>
  </div>

  <div class="bottom">
    <div class="panel" style="flex:0.6">
      <strong style="display:block;margin-bottom:6px">Pseudocode (Lomuto)</strong>
      <pre id="code">
quicksort(A, low, high):
  if low < high:
    pivotIndex = choosePivot(low, high)
    swap(A[pivotIndex], A[high])
    p = partition(A, low, high)        // p is final pivot position
    quicksort(A, low, p - 1)
    quicksort(A, p + 1, high)

partition(A, low, high):
  pivot = A[high]
  i = low
  for j = low to high-1:
    if A[j] < pivot:
      swap A[i] and A[j]
      i = i + 1
  swap A[i] and A[high]
  return i
      </pre>
    </div>

    <div class="panel" style="flex:0.4">
      <strong style="display:block;margin-bottom:6px">Info</strong>
      <p style="margin:0;color:var(--muted);font-size:13px">
        Quick Sort is a divide-and-conquer in-place sorting algorithm.
        Average time: O(n log n), Worst-case: O(n^2) (bad pivot choices).
      </p>
      <div style="margin-top:8px;font-size:13px;color:var(--muted)">
        Use different pivot strategies to see how they affect behavior. Step through or play the algorithm.
      </div>
    </div>
  </div>

  <footer>Built-in visualization: bars show values. Controls let you generate, shuffle, step, and play. This demo uses an in-place Lomuto partitioning quick sort.</footer>
</div>

<script>
(function(){
  // Utility
  const $ = id => document.getElementById(id);

  // DOM
  const viz = $('viz');
  const sizeRange = $('size');
  const sizeLabel = $('sizeLabel');
  const generateBtn = $('generate');
  const shuffleBtn = $('shuffle');
  const runBtn = $('run');
  const stepBtn = $('step');
  const resetBtn = $('reset');
  const pivotSelect = $('pivot');
  const speedRange = $('speed');
  const speedLabel = $('speedLabel');
  const compEl = $('comp');
  const swapsEl = $('swaps');
  const rcallsEl = $('rcalls');
  const queuedEl = $('queued');

  // State
  let array = [];
  let bars = [];
  let actions = []; // queued actions
  let playing = false;
  let timer = null;
  let actionIndex = 0;
  let comparisons = 0, swaps = 0, rCalls = 0;
  let initialArray = [];
  let sortedFlags = [];
  let maxValue = 100;

  function createArray(n){
    array = [];
    for(let i=0;i<n;i++){
      array.push(Math.floor(10 + Math.random() * (maxValue-10)));
    }
    initialArray = array.slice();
    sortedFlags = new Array(n).fill(false);
    comparisons = swaps = rCalls = 0;
    updateStats();
  }

  function renderBars(){
    viz.innerHTML = '';
    bars = [];
    const n = array.length;
    const maxv = Math.max(...array, 1);
    for(let i=0;i<n;i++){
      const b = document.createElement('div');
      b.className = 'bar';
      const h = Math.max(4, Math.round((array[i]/maxv) * 100));
      b.style.height = h + '%';
      const label = document.createElement('div');
      label.className = 'label';
      label.textContent = array[i];
      b.appendChild(label);
      viz.appendChild(b);
      bars.push(b);
      if(sortedFlags[i]){
        b.classList.add('sorted');
      }
    }
  }

  function updateStats(){
    compEl.textContent = comparisons;
    swapsEl.textContent = swaps;
    rcallsEl.textContent = rCalls;
    queuedEl.textContent = Math.max(0, actions.length - actionIndex);
  }

  // Action types: 'range', 'pivot', 'compare', 'swap', 'mark', 'done'
  function enqueueActions(actList){
    actions = actList;
    actionIndex = 0;
    updateStats();
  }

  // QuickSort generator producing action objects for visualization
  function* quickSortGen(A, low, high, pivotStrategy){
    if(low < 0) low = 0;
    if(high >= A.length) high = A.length - 1;
    rCalls++;
    yield {type:'range', low, high};
    if(low < high){
      // choose pivot
      let pivotIndex = choosePivot(A, low, high, pivotStrategy);
      yield {type:'pivot', index: pivotIndex};
      if(pivotIndex !== high){
        // swap pivot to end
        [A[pivotIndex], A[high]] = [A[high], A[pivotIndex]];
        yield {type:'swap', i: pivotIndex, j: high};
        pivotIndex = high;
      }
      // partition
      const p = yield* partitionGen(A, low, high);
      // p is pivot final position
      yield {type:'mark', index: p};
      // recursive calls
      yield* quickSortGen(A, low, p-1, pivotStrategy);
      yield* quickSortGen(A, p+1, high, pivotStrategy);
    }
    yield {type:'range', low:-1, high:-1};
  }

  function* partitionGen(A, low, high){
    const pivotVal = A[high];
    let i = low;
    for(let j = low; j <= high-1; j++){
      yield {type:'compare', i:j, j:high};
      if(A[j] < pivotVal){
        // swap A[i], A[j]
        [A[i], A[j]] = [A[j], A[i]];
        yield {type:'swap', i:i, j:j};
        i++;
      }
    }
    [A[i], A[high]] = [A[high], A[i]];
    yield {type:'swap', i:i, j:high};
    return i;
  }

  function choosePivot(A, low, high, strat){
    if(strat === 'last') return high;
    if(strat === 'first') return low;
    if(strat === 'random') return Math.floor(low + Math.random() * (high - low + 1));
    if(strat === 'median'){
      const mid = Math.floor((low + high)/2);
      const trio = [[A[low],low],[A[mid],mid],[A[high],high]];
      trio.sort((x,y)=>x[0]-y[0]);
      return trio[1][1];
    }
    return high;
  }

  // Apply single action
  function applyAction(act){
    switch(act.type){
      case 'range':
        // clear range markers then mark new range
        bars.forEach(b => {
          b.classList.remove('range');
          b.classList.remove('compare');
          b.classList.remove('pivot');
          b.classList.remove('swap');
        });
        if(act.low >= 0 && act.high >= 0){
          for(let k=act.low;k<=act.high;k++){
            if(bars[k]) bars[k].classList.add('range');
          }
        }
        break;
      case 'pivot':
        // highlight pivot
        bars.forEach(b => b.classList.remove('pivot'));
        if(bars[act.index]) bars[act.index].classList.add('pivot');
        break;
      case 'compare':
        comparisons++;
        // highlight compare between i and j (j is pivot typically)
        bars.forEach(b => b.classList.remove('compare'));
        if(bars[act.i]) bars[act.i].classList.add('compare');
        if(bars[act.j]) bars[act.j].classList.add('compare');
        break;
      case 'swap':
        swaps++;
        // animate swap: swap heights and labels
        const bi = bars[act.i];
        const bj = bars[act.j];
        if(!bi || !bj) break;
        bi.classList.add('swap');
        bj.classList.add('swap');
        // swap values in model
        const t = array[act.i]; array[act.i] = array[act.j]; array[act.j] = t;
        // update visuals
        updateBar(bi, array[act.i]);
        updateBar(bj, array[act.j]);
        break;
      case 'mark':
        // mark pivot at index as sorted
        sortedFlags[act.index] = true;
        if(bars[act.index]) bars[act.index].classList.add('sorted');
        break;
      case 'done':
        // mark all sorted
        bars.forEach((b,i)=> b.classList.add('sorted'));
        break;
    }
    updateStats();
  }

  function updateBar(bar, value){
    const maxv = Math.max(...array, 1);
    const h = Math.max(4, Math.round((value / maxv) * 100));
    bar.style.height = h + '%';
    const lbl = bar.querySelector('.label');
    if(lbl) lbl.textContent = value;
  }

  // Playback control
  function stepForward(){
    if(actionIndex >= actions.length){
      playing = false;
      runBtn.textContent = 'Play';
      return;
    }
    const act = actions[actionIndex++];
    applyAction(act);
    updateStats();
  }

  function play(){
    if(playing) return;
    playing = true;
    runBtn.textContent = 'Pause';
    const tick = () => {
      if(!playing) return;
      if(actionIndex >= actions.length){
        playing = false;
        runBtn.textContent = 'Play';
        return;
      }
      stepForward();
      const delay = Math.max(8, parseInt(speedRange.value,10));
      timer = setTimeout(tick, delay);
    };
    tick();
  }

  function pause(){
    playing = false;
    runBtn.textContent = 'Play';
    if(timer) clearTimeout(timer);
  }

  // Build action list from generator by copying array to avoid destructive changes interfering with visualization
  function buildActions(){
    // copy array for generator to mutate safely
    const A = array.slice();
    comparisons = swaps = rCalls = 0;
    const gen = quickSortGen(A, 0, A.length - 1, pivotSelect.value);
    const list = [];
    for(const act of gen){
      list.push(act);
    }
    list.push({type:'done'});
    enqueueActions(list);
  }

  // UI events
  sizeRange.addEventListener('input', e=>{
    sizeLabel.textContent = e.target.value;
  });

  speedRange.addEventListener('input', e=>{
    speedLabel.textContent = e.target.value + 'ms';
  });

  generateBtn.addEventListener('click', ()=>{
    createArray(parseInt(sizeRange.value,10));
    renderBars();
    buildActions();
  });

  shuffleBtn.addEventListener('click', ()=>{
    // Shuffle current array
    for(let i=array.length-1;i>0;i--){
      const j = Math.floor(Math.random() * (i+1));
      [array[i], array[j]] = [array[j], array[i]];
      sortedFlags[i]=false; sortedFlags[j]=false;
    }
    sortedFlags.fill(false);
    renderBars();
    buildActions();
  });

  runBtn.addEventListener('click', ()=>{
    if(playing){
      pause();
    } else {
      // if finished, rebuild actions from current array state
      if(actionIndex >= actions.length){
        buildActions();
      }
      play();
    }
  });

  stepBtn.addEventListener('click', ()=>{
    pause();
    // if finished, rebuild actions
    if(actionIndex >= actions.length){
      buildActions();
    }
    stepForward();
  });

  resetBtn.addEventListener('click', ()=>{
    pause();
    array = initialArray.slice();
    sortedFlags = new Array(array.length).fill(false);
    renderBars();
    comparisons = swaps = rCalls = 0;
    buildActions();
  });

  pivotSelect.addEventListener('change', ()=>{
    pause();
    buildActions();
  });

  // Initialize
  createArray(parseInt(sizeRange.value,10));
  renderBars();
  buildActions();

  // Expose double-click to run full immediate sort (no visualization), for fast test
  viz.addEventListener('dblclick', ()=>{
    pause();
    array.sort((a,b)=>a-b);
    sortedFlags = new Array(array.length).fill(true);
    renderBars();
    comparisons = swaps = rCalls = 0;
    updateStats();
  });

  // Keyboard shortcuts
  window.addEventListener('keydown', e=>{
    if(e.key === ' ') { e.preventDefault(); runBtn.click(); }
    if(e.key === 'ArrowRight') { stepBtn.click(); }
  });

})();
</script>
</body>
</html>