<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Bubble Sort Visualizer</title>
<style>
  :root{
    --bg:#0f1724;
    --panel:#0b1220;
    --accent:#3b82f6;
    --accent-2:#06b6d4;
    --muted:#94a3b8;
    --good:#10b981;
    --danger:#ef4444;
    --bar:#60a5fa;
    --bar-2:#93c5fd;
    --text:#e6eef8;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#081024);color:var(--text);font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue","Noto Sans",Arial; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}
  .container{max-width:1100px;margin:28px auto;padding:20px;box-sizing:border-box;}
  header{display:flex;align-items:center;gap:16px;margin-bottom:16px;}
  h1{font-size:20px;margin:0;}
  .controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin-bottom:18px;}
  .controls > *{background:var(--panel);padding:10px;border-radius:8px;box-shadow:inset 0 -2px 0 rgba(255,255,255,0.02);}
  label{display:flex;gap:8px;align-items:center;color:var(--muted);font-size:13px;}
  input[type=range]{width:180px;}
  .btn{background:linear-gradient(180deg,var(--accent),#2563eb);border:0;color:white;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600;}
  .btn.secondary{background:linear-gradient(180deg,var(--panel),#0b1220);border:1px solid rgba(255,255,255,0.03);color:var(--text);}
  .btn.warn{background:linear-gradient(180deg,var(--danger),#b91c1c);}
  .btn:disabled{opacity:0.5;cursor:not-allowed;}
  .layout{display:grid;grid-template-columns:1fr 340px;gap:18px;align-items:start;}
  .visual{background:linear-gradient(180deg,#071022,#02101a);padding:12px;border-radius:10px;min-height:320px;display:flex;flex-direction:column;gap:8px;}
  .bars{flex:1;display:flex;align-items:flex-end;gap:4px;padding:6px;height:360px;border-radius:6px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);overflow:hidden;}
  .bar{flex:1 1 auto;display:flex;align-items:flex-end;justify-content:center;position:relative;background:linear-gradient(180deg,var(--bar),var(--bar-2));border-radius:4px;transition:height 200ms ease, background-color 120ms ease, transform 200ms ease;box-shadow:0 1px 0 rgba(255,255,255,0.02) inset;}
  .bar.small{margin:0 2px;}
  .bar-value{position:absolute;top:6px;left:6px;font-size:11px;color:rgba(255,255,255,0.85);font-weight:700}
  .bar.compare{background:linear-gradient(180deg,#f59e0b,#f97316);transform:scaleX(1.02);z-index:2;}
  .bar.swap{background:linear-gradient(180deg,#ef4444,#fb7185);transform:scaleX(1.05) translateY(-4px);z-index:3;}
  .bar.sorted{background:linear-gradient(180deg,#10b981,#34d399);box-shadow:0 2px 8px rgba(16,185,129,0.08);z-index:1;}
  .sidebar{background:linear-gradient(180deg,#041022,#071428);padding:12px;border-radius:10px;min-height:360px;display:flex;flex-direction:column;gap:12px;}
  .row{display:flex;justify-content:space-between;gap:8px;align-items:center;}
  .stats{display:flex;gap:10px;flex-wrap:wrap;}
  .stat{background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;min-width:78px;text-align:center;}
  .stat .label{font-size:12px;color:var(--muted);} .stat .value{font-weight:700;font-size:16px;margin-top:4px;}
  .pseudocode{background:linear-gradient(180deg,#061227,#02101a);padding:10px;border-radius:8px;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:13px;color:var(--muted);line-height:1.5;max-height:220px;overflow:auto;}
  .pc-line{padding:4px 6px;border-radius:6px;}
  .pc-line.current{background:linear-gradient(90deg,rgba(59,130,246,0.12),transparent);color:var(--text);font-weight:600;}
  .footer{margin-top:10px;font-size:13px;color:var(--muted);display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;}
  .small{font-size:12px;color:var(--muted);}
  .toggle{display:inline-flex;align-items:center;gap:8px;}
  .info{background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;font-size:13px;}
  .controls .input-group{display:flex;flex-direction:column;}
  @media (max-width:880px){
    .layout{grid-template-columns:1fr; }
    .sidebar{order:2}
  }
</style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Bubble Sort Visualizer</h1>
      <div class="small">Interactive demonstration of Bubble Sort — compare, swap, and watch the array get sorted step by step.</div>
    </header>

    <div class="controls">
      <div style="display:flex;gap:8px;align-items:center;">
        <button id="startBtn" class="btn">Start</button>
        <button id="pauseBtn" class="btn secondary" disabled>Pause</button>
        <button id="stepBtn" class="btn secondary">Step</button>
        <button id="shuffleBtn" class="btn secondary">Shuffle</button>
        <button id="resetBtn" class="btn secondary">Reset</button>
      </div>

      <div class="input-group" title="Number of elements">
        <label><span style="min-width:80px;display:inline-block;color:var(--muted)">Size</span>
          <input id="sizeRange" type="range" min="6" max="80" value="30">
          <span id="sizeVal" style="min-width:36px;display:inline-block;text-align:right;color:var(--muted);padding-left:6px">30</span>
        </label>
      </div>

      <div class="input-group" title="Delay between steps in milliseconds (lower is faster)">
        <label><span style="min-width:80px;display:inline-block;color:var(--muted)">Speed (ms)</span>
          <input id="speedRange" type="range" min="10" max="1000" value="120">
          <span id="speedVal" style="min-width:46px;display:inline-block;text-align:right;color:var(--muted);padding-left:6px">120</span>
        </label>
      </div>

      <div style="display:flex;gap:8px;align-items:center;">
        <label style="cursor:pointer"><input id="orderToggle" type="checkbox"> Descending</label>
        <label style="cursor:pointer"><input id="showValues" type="checkbox" checked> Show values</label>
      </div>
    </div>

    <div class="layout">
      <div class="visual">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div class="small">Array Visualization</div>
          <div class="small" id="statusText">Idle</div>
        </div>

        <div id="bars" class="bars" aria-hidden="true"></div>

        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div class="small">Blue = normal • Orange = comparing • Red = swapping • Green = sorted</div>
          <div class="small" id="progressText">0%</div>
        </div>
      </div>

      <aside class="sidebar">
        <div class="row">
          <div class="small">Statistics</div>
          <div class="small" id="modeLabel">Mode: Bubble Sort</div>
        </div>

        <div class="stats">
          <div class="stat"><div class="label">Comparisons</div><div id="compVal" class="value">0</div></div>
          <div class="stat"><div class="label">Swaps</div><div id="swapVal" class="value">0</div></div>
          <div class="stat"><div class="label">Steps</div><div id="stepVal" class="value">0</div></div>
          <div class="stat"><div class="label">Size</div><div id="sizeShow" class="value">30</div></div>
        </div>

        <div>
          <div style="margin-bottom:6px;" class="small">Pseudocode</div>
          <div id="pseudocode" class="pseudocode">
            <div id="pc0" class="pc-line">function bubbleSort(A)</div>
            <div id="pc1" class="pc-line">  n = A.length</div>
            <div id="pc2" class="pc-line">  for i from 0 to n-1</div>
            <div id="pc3" class="pc-line">    for j from 0 to n-i-2</div>
            <div id="pc4" class="pc-line">      if A[j] > A[j+1]</div>
            <div id="pc5" class="pc-line">        swap A[j] and A[j+1]</div>
            <div id="pc6" class="pc-line">      end if</div>
            <div id="pc7" class="pc-line">    end for</div>
            <div id="pc8" class="pc-line">  end for</div>
            <div id="pc9" class="pc-line">end function</div>
          </div>
        </div>

        <div>
          <div class="small">Notes</div>
          <div class="info" style="margin-top:6px;">
            Bubble Sort repeatedly steps through the list, compares adjacent elements and swaps them if they are in the wrong order. Best: O(n), Average/Worst: O(n^2). Stable. In-place.
          </div>
        </div>

      </aside>
    </div>

    <div class="footer">
      <div class="small">Try Step to move one comparison at a time, or Start to animate continuously. Toggle Descending to reverse the comparison.</div>
      <div class="small">Built for demonstration — values and speed adjustable.</div>
    </div>
  </div>

<script>
(function(){
  // DOM elements
  const barsEl = document.getElementById('bars');
  const startBtn = document.getElementById('startBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const stepBtn = document.getElementById('stepBtn');
  const shuffleBtn = document.getElementById('shuffleBtn');
  const resetBtn = document.getElementById('resetBtn');
  const sizeRange = document.getElementById('sizeRange');
  const sizeVal = document.getElementById('sizeVal');
  const sizeShow = document.getElementById('sizeShow');
  const speedRange = document.getElementById('speedRange');
  const speedVal = document.getElementById('speedVal');
  const orderToggle = document.getElementById('orderToggle');
  const showValues = document.getElementById('showValues');
  const compVal = document.getElementById('compVal');
  const swapVal = document.getElementById('swapVal');
  const stepVal = document.getElementById('stepVal');
  const statusText = document.getElementById('statusText');
  const progressText = document.getElementById('progressText');
  const pseudocode = {};
  for(let i=0;i<10;i++) pseudocode[i]=document.getElementById('pc'+i);

  // State
  let arr = [];
  let n = parseInt(sizeRange.value,10);
  let running = false;
  let comparisons = 0;
  let swaps = 0;
  let steps = 0;
  let iIndex = 0, jIndex = 0; // bubble indices
  let sorted = false;
  let descending = false;
  let automaticLoopId = null;
  let speed = parseInt(speedRange.value,10); // ms
  let showVals = showValues.checked;

  // Helpers
  function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }

  function createArray(size){
    // create random array 10..100
    const a = [];
    for(let i=0;i<size;i++){
      a.push(randInt(5,100));
    }
    return a;
  }

  function renderBars(){
    barsEl.innerHTML = '';
    const max = Math.max(...arr);
    const minHeight = 6;
    const gap = Math.max(1, Math.floor(180/arr.length));
    arr.forEach((v,idx)=>{
      const bar = document.createElement('div');
      bar.className = 'bar';
      if(arr.length>50) bar.classList.add('small');
      bar.style.height = (v/max*100) + '%';
      bar.dataset.index = idx;
      if(showVals){
        const label = document.createElement('div');
        label.className = 'bar-value';
        label.style.display = 'block';
        label.textContent = v;
        bar.appendChild(label);
      }
      barsEl.appendChild(bar);
    });
    sizeShow.textContent = arr.length;
    sizeVal.textContent = arr.length;
    sizeVal.title = arr.length;
  }

  function updateStats(){
    compVal.textContent = comparisons;
    swapVal.textContent = swaps;
    stepVal.textContent = steps;
  }

  function resetStats(){
    comparisons=swaps=steps=0;
    updateStats();
  }

  function highlightPC(line){
    for(let k in pseudocode) pseudocode[k].classList.remove('current');
    if(pseudocode[line]) pseudocode[line].classList.add('current');
  }

  function setStatus(text){
    statusText.textContent = text;
  }

  function setProgress(){
    if(arr.length<=1) return progressText.textContent='100%';
    const totalPasses = arr.length;
    const prog = Math.min(100, Math.floor((iIndex/totalPasses)*100));
    progressText.textContent = prog + '%';
  }

  function swapArray(a,b){
    const tmp = arr[a]; arr[a]=arr[b]; arr[b]=tmp;
  }

  function colorReset(){
    const bars = barsEl.children;
    for(let b of bars){
      b.classList.remove('compare','swap','sorted');
    }
  }

  function markSorted(final=true){
    const bars = barsEl.children;
    for(let idx=0; idx<bars.length; idx++){
      bars[idx].classList.remove('compare','swap');
      bars[idx].classList.add('sorted');
    }
    if(final){ setStatus('Sorted'); highlightPC(8); }
  }

  // Step execution: executes one comparison (and potential swap), advances indices
  async function doOneStep(){
    if(sorted) return;
    steps++;
    updateStats();

    const n = arr.length;
    // If starting new run:
    if(iIndex >= n-1){
      // finished
      sorted = true;
      colorReset();
      markSorted(true);
      running=false;
      startBtn.disabled = false;
      pauseBtn.disabled = true;
      stepBtn.disabled = true;
      return;
    }

    // If inner loop finished, advance outer
    if(jIndex >= n - iIndex - 1){
      // end inner loop
      highlightPC(7); // end for inner
      jIndex = 0;
      iIndex++;
      highlightPC(2); // outer loop
      setStatus(`Pass ${iIndex}/${n-1}`);
      setProgress();
      // small pause to show pass boundary
      await sleep(Math.max(30, speed/3));
      if(iIndex >= n-1){
        // finished
        sorted = true;
        colorReset();
        markSorted(true);
        running=false;
        startBtn.disabled = false;
        pauseBtn.disabled = true;
        stepBtn.disabled = true;
        return;
      }
    }

    // Now perform inner comparison at jIndex
    const a = jIndex;
    const b = jIndex+1;

    // highlight comparison
    colorReset();
    const bars = barsEl.children;
    if(bars[a]) bars[a].classList.add('compare');
    if(bars[b]) bars[b].classList.add('compare');

    highlightPC(4); // if A[j] > A[j+1]
    setStatus(`Comparing indices ${a} and ${b}`);
    await sleep(Math.max(20, speed/4));

    comparisons++;
    updateStats();

    const shouldSwap = descending ? (arr[a] < arr[b]) : (arr[a] > arr[b]);
    if(shouldSwap){
      highlightPC(5); // swap line
      setStatus(`Swapping ${arr[a]} ↔ ${arr[b]}`);
      // visually mark swap
      if(bars[a]) bars[a].classList.remove('compare');
      if(bars[b]) bars[b].classList.remove('compare');
      if(bars[a]) bars[a].classList.add('swap');
      if(bars[b]) bars[b].classList.add('swap');

      await animateSwap(a,b);
      swaps++;
      updateStats();
    } else {
      // no swap
      setStatus(`No swap needed`);
      await sleep(Math.max(20, speed/4));
    }

    // move to next j
    jIndex++;
    highlightPC(3); // inner for
    setProgress();

    // if at end of inner loop (jIndex now equals n-iIndex-1) we will handle next call
  }

  function sleep(ms){ return new Promise(res=>setTimeout(res,ms)); }

  // animate swap by swapping heights and value labels
  async function animateSwap(a,b){
    const bars = barsEl.children;
    const barA = bars[a];
    const barB = bars[b];
    if(!barA || !barB) return;
    // swap heights and values
    const hA = barA.style.height;
    const hB = barB.style.height;

    // swap dataset text if exists
    const labelA = barA.querySelector('.bar-value');
    const labelB = barB.querySelector('.bar-value');

    // animate: briefly translate to emphasize
    barA.style.transition = `height ${Math.max(80, speed)}ms ease, transform ${Math.max(80, speed/6)}ms`;
    barB.style.transition = `height ${Math.max(80, speed)}ms ease, transform ${Math.max(80, speed/6)}ms`;
    // perform height swap
    barA.style.height = hB;
    barB.style.height = hA;

    if(labelA && labelB){
      // update text after animation to match underlying arr values
      await sleep(Math.max(80, speed));
      labelA.textContent = arr[b];
      labelB.textContent = arr[a];
    } else {
      await sleep(Math.max(80, speed));
    }

    // swap in array
    swapArray(a,b);

    // cleanup
    if(barA) barA.classList.remove('swap');
    if(barB) barB.classList.remove('swap');
    barA.style.transition = '';
    barB.style.transition = '';
  }

  // Control loop when running
  async function runLoop(){
    startBtn.disabled = true;
    pauseBtn.disabled = false;
    stepBtn.disabled = false;
    running = true;
    setStatus('Running');
    while(running){
      await doOneStep();
      // if finished inside doOneStep it will set running=false
      if(!running) break;
      // wait according to speed
      await sleep(speed);
    }
    startBtn.disabled = false;
    pauseBtn.disabled = true;
    if(sorted) setStatus('Sorted');
  }

  // Public control functions
  function start(){
    if(sorted) return;
    if(running) return;
    runLoop();
  }

  function pause(){
    running=false;
    pauseBtn.disabled=true;
    startBtn.disabled=false;
    setStatus('Paused');
  }

  function step(){
    if(sorted) return;
    if(running) return;
    // perform a single step
    doOneStep();
  }

  function shuffle(){
    // create new array and reset indices
    n = parseInt(sizeRange.value,10);
    arr = createArray(n);
    iIndex = 0; jIndex = 0; sorted=false;
    resetStats();
    renderBars();
    colorReset();
    highlightPC(1);
    setStatus('Shuffled');
    setProgress();
    stepBtn.disabled=false;
    startBtn.disabled=false;
    pauseBtn.disabled=true;
  }

  function reset(){
    // reset to nearly sorted array (optional)
    n = parseInt(sizeRange.value,10);
    arr = [];
    // create sorted array to demonstrate bubble performance optionally
    for(let t=0;t<n;t++) arr.push(Math.round( (t+1)/n * 100));
    // slightly shuffle a few elements to make interesting
    for(let k=0;k<Math.min(10,n);k++){
      const a=randInt(0,n-1), b=randInt(0,n-1);
      const tmp=arr[a]; arr[a]=arr[b]; arr[b]=tmp;
    }
    iIndex=0; jIndex=0; sorted=false;
    resetStats();
    renderBars();
    colorReset();
    highlightPC(1);
    setStatus('Reset to near-sorted');
    setProgress();
    stepBtn.disabled=false;
    startBtn.disabled=false;
    pauseBtn.disabled=true;
  }

  // Event bindings
  startBtn.addEventListener('click', ()=>{
    start();
  });
  pauseBtn.addEventListener('click', ()=>{
    pause();
  });
  stepBtn.addEventListener('click', ()=>{
    step();
  });
  shuffleBtn.addEventListener('click', ()=>{
    shuffle();
  });
  resetBtn.addEventListener('click', ()=>{
    reset();
  });

  sizeRange.addEventListener('input', (e)=>{
    sizeVal.textContent = e.target.value;
  });
  sizeRange.addEventListener('change', (e)=>{
    sizeVal.textContent = e.target.value;
    sizeShow.textContent = e.target.value;
    // regenerate new array
    n = parseInt(e.target.value,10);
    arr = createArray(n);
    iIndex=0; jIndex=0; sorted=false;
    resetStats();
    renderBars();
    colorReset();
    highlightPC(1);
    setStatus('Size changed');
  });

  speedRange.addEventListener('input', (e)=>{
    speedVal.textContent = e.target.value;
    speed = parseInt(e.target.value,10);
  });

  orderToggle.addEventListener('change', (e)=>{
    descending = e.target.checked;
    setStatus(descending ? 'Descending order' : 'Ascending order');
  });

  showValues.addEventListener('change', (e)=>{
    showVals = e.target.checked;
    renderBars();
  });

  // Initialize
  function init(){
    n = parseInt(sizeRange.value,10);
    speed = parseInt(speedRange.value,10);
    arr = createArray(n);
    iIndex = 0; jIndex = 0; sorted=false;
    resetStats();
    renderBars();
    highlightPC(1);
    setStatus('Idle');
    setProgress();
  }
  init();

  // Expose nothing; all internal

})();
</script>
</body>
</html>