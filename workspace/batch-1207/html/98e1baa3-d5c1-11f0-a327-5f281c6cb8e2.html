<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Insertion Sort Visualizer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root{
      --bg:#0f1724;
      --panel:#0b1220;
      --muted:#9aa7c7;
      --accent:#38bdf8;
      --success:#34d399;
      --danger:#fb7185;
      --glass: rgba(255,255,255,0.03);
    }
    html,body{height:100%; margin:0; font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    body{
      background: linear-gradient(180deg,#071026 0%, #071229 40%, #041423 100%);
      color:#e6eef8;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:20px;
      box-sizing:border-box;
    }
    .container{
      width:1100px;
      max-width:100%;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:16px;
      box-shadow: 0 6px 30px rgba(2,6,23,0.7);
      display:grid;
      grid-template-columns: 1fr 420px;
      gap:16px;
    }
    .left, .right{ background:var(--panel); border-radius:10px; padding:12px; box-sizing:border-box;}
    .header{display:flex; gap:12px; align-items:center; margin-bottom:12px;}
    h1{font-size:18px; margin:0 6px 0 0;}
    .controls{display:flex; gap:8px; align-items:center; flex-wrap:wrap;}
    button, input[type=button]{
      background:var(--glass);
      color:var(--muted);
      border:1px solid rgba(255,255,255,0.04);
      padding:8px 10px;
      border-radius:8px;
      cursor:pointer;
      font-size:13px;
    }
    button.primary{ background: linear-gradient(90deg, rgba(56,189,248,0.14), rgba(52,211,153,0.06)); color:var(--accent); border:1px solid rgba(56,189,248,0.14);}
    button.danger{ background:linear-gradient(90deg, rgba(251,113,133,0.06), transparent); color:var(--danger); }
    .controls label{ font-size:13px; color:var(--muted); display:flex; gap:6px; align-items:center;}
    .canvas{
      height:320px;
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
      border-radius:8px;
      display:flex;
      align-items:end;
      padding:10px;
      gap:6px;
      margin-bottom:12px;
      overflow:hidden;
    }
    .bar{
      background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      width:100%;
      border-radius:6px 6px 2px 2px;
      transition:height 200ms ease, transform 120ms ease;
      box-shadow: 0 4px 10px rgba(2,6,23,0.6) inset;
      display:flex;
      align-items:flex-end;
      justify-content:center;
      color:rgba(255,255,255,0.9);
      font-size:12px;
      font-weight:600;
      user-select:none;
      position:relative;
    }
    .bar .label{ transform: translateY(-6px); font-size:11px; opacity:0.95;}
    .legend{display:flex; gap:8px; margin-bottom:10px; align-items:center; flex-wrap:wrap;}
    .legend .item{display:flex; gap:6px; align-items:center; color:var(--muted); font-size:13px;}
    .col{width:14px; height:14px; border-radius:4px;}
    .col.sorted{background:linear-gradient(180deg,var(--success), #1f9b78);}
    .col.key{background:linear-gradient(180deg,#fb923c,#f97316);}
    .col.compare{background:linear-gradient(180deg,#facc15,#f59e0b);}
    .col.shift{background:linear-gradient(180deg,#60a5fa,#3b82f6);}
    .info{display:flex; gap:12px; margin-top:6px; flex-wrap:wrap;}
    .stat{background:rgba(255,255,255,0.02); padding:8px 10px; border-radius:8px; color:var(--muted); font-size:13px;}
    .right h2{margin-top:0; font-size:15px;}
    .pseudocode{background:rgba(255,255,255,0.01); padding:10px; border-radius:8px; font-family:monospace; color:var(--muted); font-size:13px; line-height:1.6;}
    .pseudocode .line{padding:6px; border-radius:6px;}
    .pseudocode .active{ background:linear-gradient(90deg, rgba(56,189,248,0.06), rgba(52,211,153,0.02)); color:var(--accent); font-weight:600;}
    .desc{background:rgba(255,255,255,0.02); padding:10px; border-radius:8px; color:var(--muted); font-size:13px; margin-top:10px;}
    .bottom-controls{display:flex; gap:8px; align-items:center; margin-top:8px; flex-wrap:wrap;}
    input[type="range"]{accent-color: #38bdf8;}
    .small{font-size:12px; color:var(--muted);}
    .custom-input{display:flex; gap:8px; margin-top:8px;}
    .custom-input input{flex:1; padding:8px; border-radius:8px; border:1px solid rgba(255,255,255,0.03); background:transparent; color:inherit;}
    .footer{font-size:12px; color:var(--muted); margin-top:8px;}
    @media (max-width:1000px){
      .container{ grid-template-columns: 1fr; }
      .right{ order:2; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="left">
      <div class="header">
        <h1>Insertion Sort Visualizer</h1>
        <div class="small">Step-by-step animation and pseudocode</div>
      </div>

      <div class="controls">
        <label class="small">Size:
          <input id="size" type="range" min="5" max="40" value="18" />
          <span id="sizeLabel" class="small">18</span>
        </label>

        <label class="small">Order:
          <select id="order" style="padding:6px; border-radius:8px; background:transparent; border:1px solid rgba(255,255,255,0.03); color:var(--muted);">
            <option value="asc">Ascending</option>
            <option value="desc">Descending</option>
          </select>
        </label>

        <button id="generate" class="primary">Generate Random</button>
        <button id="prepare">Prepare Steps</button>
        <button id="reset">Reset</button>
      </div>

      <div style="display:flex; gap:10px; margin-top:10px; align-items:center;">
        <div class="legend" style="margin:0;">
          <div class="item"><div class="col sorted"></div> Sorted</div>
          <div class="item"><div class="col key"></div> Key</div>
          <div class="item"><div class="col compare"></div> Comparing</div>
          <div class="item"><div class="col shift"></div> Shifting</div>
        </div>

        <div style="flex:1;"></div>

        <div class="small">Speed:
          <input id="speed" type="range" min="50" max="1200" value="360" />
        </div>
      </div>

      <div id="canvas" class="canvas" aria-hidden="false"></div>

      <div class="info" aria-hidden="false">
        <div class="stat">Comparisons: <strong id="comp">0</strong></div>
        <div class="stat">Writes (moves): <strong id="writes">0</strong></div>
        <div class="stat">Steps: <strong id="stepsCount">0</strong></div>
        <div style="flex:1"></div>
        <div class="small">Tip: Click "Prepare Steps" after changing array or order to recompute the animation frames.</div>
      </div>

      <div class="bottom-controls">
        <button id="play" class="primary">Play</button>
        <button id="pause">Pause</button>
        <button id="stepBack">Step Back</button>
        <button id="stepForward">Step Forward</button>
        <div style="width:8px;"></div>
        <label class="small">Array (comma separated):
          <input id="arrinput" placeholder="e.g. 5,3,8,1,6" />
        </label>
        <button id="load">Load</button>
      </div>

      <div class="footer">
        Insertion sort iterates through the array, inserting each element into its correct position in the already-sorted left portion by shifting larger elements right.
      </div>
    </div>

    <div class="right">
      <h2>Pseudocode</h2>
      <div class="pseudocode" id="pseudocode">
        <div class="line" data-line="1">1. for i = 1 to n - 1 do</div>
        <div class="line" data-line="2">2. &nbsp;&nbsp; key = A[i]</div>
        <div class="line" data-line="3">3. &nbsp;&nbsp; j = i - 1</div>
        <div class="line" data-line="4">4. &nbsp;&nbsp; while j >= 0 and A[j] &gt; key do</div>
        <div class="line" data-line="5">5. &nbsp;&nbsp;&nbsp;&nbsp; A[j+1] = A[j]   // shift right</div>
        <div class="line" data-line="6">6. &nbsp;&nbsp;&nbsp;&nbsp; j = j - 1</div>
        <div class="line" data-line="7">7. &nbsp;&nbsp; A[j+1] = key   // insert</div>
      </div>

      <div class="desc" id="description">
        Press "Prepare Steps" to compute the frames, then Play to animate. Use Step Forward/Back to move manually.
      </div>

      <div style="margin-top:10px;">
        <h2>Complexity</h2>
        <div class="small" style="margin-bottom:6px;">Time Complexity: Best O(n), Average O(n^2), Worst O(n^2)</div>
        <div class="small">Space Complexity: O(1) (in-place)</div>
      </div>
    </div>
  </div>

  <script>
    // Insertion Sort Visualizer
    (function(){
      // DOM references
      const canvas = document.getElementById('canvas');
      const sizeRange = document.getElementById('size');
      const sizeLabel = document.getElementById('sizeLabel');
      const generateBtn = document.getElementById('generate');
      const prepareBtn = document.getElementById('prepare');
      const resetBtn = document.getElementById('reset');
      const playBtn = document.getElementById('play');
      const pauseBtn = document.getElementById('pause');
      const stepFwdBtn = document.getElementById('stepForward');
      const stepBackBtn = document.getElementById('stepBack');
      const speedRange = document.getElementById('speed');
      const orderSelect = document.getElementById('order');
      const arrInput = document.getElementById('arrinput');
      const loadBtn = document.getElementById('load');
      const compEl = document.getElementById('comp');
      const writesEl = document.getElementById('writes');
      const stepsCountEl = document.getElementById('stepsCount');
      const pseudocode = document.getElementById('pseudocode');
      const descEl = document.getElementById('description');

      let array = [];
      let bars = [];
      let steps = []; // recorded snapshots
      let currentStep = 0;
      let timer = null;
      let playing = false;

      let counts = {comp:0, writes:0};

      // Utility to create random array
      function genRandom(n){
        const arr=[];
        for(let i=0;i<n;i++){
          arr.push(Math.floor(Math.random()*90)+5);
        }
        return arr;
      }

      function renderArray(arr, meta){
        // Clear canvas
        canvas.innerHTML = '';
        const n = arr.length;
        // compute bar width
        const gap = 6;
        const totalGap = gap*(n-1);
        const width = canvas.clientWidth;
        const barWidth = Math.max(10, Math.floor((width - totalGap)/n));
        const maxVal = Math.max(...arr.concat([1]));
        for(let i=0;i<n;i++){
          const val = arr[i];
          const bar = document.createElement('div');
          bar.className = 'bar';
          bar.style.width = barWidth + 'px';
          const heightPercent = Math.max(6, Math.round((val/maxVal)*100));
          bar.style.height = (Math.max(18, Math.round((heightPercent/100)*(canvas.clientHeight-20)))) + 'px';

          const label = document.createElement('div');
          label.className = 'label';
          label.textContent = val;
          bar.appendChild(label);

          // color based on meta
          const state = (meta && meta.highlight && meta.highlight[i]) ? meta.highlight[i] : null;
          if(state === 'sorted') bar.style.background = 'linear-gradient(180deg,#34d399,#1f9b78)';
          else if(state === 'key') bar.style.background = 'linear-gradient(180deg,#fb923c,#f97316)';
          else if(state === 'compare') bar.style.background = 'linear-gradient(180deg,#facc15,#f59e0b)';
          else if(state === 'shift') bar.style.background = 'linear-gradient(180deg,#60a5fa,#3b82f6)';
          else bar.style.background = 'linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01))';

          // subtle transform for compared
          if(state === 'compare') bar.style.transform = 'translateY(-6px)';
          if(state === 'key') bar.style.transform = 'translateY(-8px) scale(1.02)';
          if(state === 'shift') bar.style.transform = 'translateY(-4px)';

          canvas.appendChild(bar);
          bars.push(bar);
        }
      }

      function clearHighlights(){
        Array.from(pseudocode.querySelectorAll('.line')).forEach(l=>l.classList.remove('active'));
      }

      function highlightPseudocode(line){
        clearHighlights();
        const el = pseudocode.querySelector('.line[data-line="'+line+'"]');
        if(el) el.classList.add('active');
      }

      // Build steps by simulating insertion sort on a copy of the array.
      // Each step: record arr copy, highlight mapping, action description, pseudocode line, counters at that moment.
      function buildSteps(initialArr, order='asc'){
        const arr = initialArr.slice();
        const n = arr.length;
        const cmp = (a,b)=> order === 'asc' ? a > b : a < b;

        const s = [];
        let comps = 0, writes = 0;

        function pushState(action, highlight, description, line){
          s.push({
            arr: arr.slice(),
            highlight: Object.assign({}, highlight || {}),
            action: action || '',
            description: description || '',
            line: line || 1,
            compsSoFar: comps,
            writesSoFar: writes
          });
        }

        // initial
        pushState('start', {}, 'Initial array', 1);

        for(let i=1;i<n;i++){
          // set key
          const key = arr[i];
          pushState('setKey', {[i]:'key'}, `Set key = A[${i}] (${key})`, 2);

          let j = i-1;
          pushState('setJ', {[j]:'compare', [i]:'key'}, `Set j = ${j}`, 3);

          // while j >=0 and A[j] > key
          while(j >= 0){
            comps++;
            pushState('compare', {[j]:'compare', [i]:'key'}, `Compare A[${j}] (${arr[j]}) with key (${key})`, 4);
            if(cmp(arr[j], key)){
              // shift
              arr[j+1] = arr[j];
              writes++;
              pushState('shift', {[j+1]:'shift', [j]:'compare', [i]:'key'}, `Shift A[${j}] -> A[${j+1}]`, 5);
              j = j-1;
              pushState('decJ', (function(){
                const h={};
                if(j>=0) h[j]='compare';
                // note: key remains at original i position visually for steps until inserted
                h[i]='key';
                return h;
              })(), `Decrement j to ${j}`, 6);
            } else {
              // comparison false, don't shift
              pushState('compareFalse', {[j]:'compare', [i]:'key'}, `A[${j}] (${arr[j]}) <= key (${key}) â€” break`, 4);
              break;
            }
          }
          // insert key
          arr[j+1] = key;
          writes++;
          pushState('insert', {[j+1]:'key'}, `Insert key at position ${j+1}`, 7);

          // mark sorted portion (0..i)
          const highlight = {};
          for(let k=0;k<=i;k++) highlight[k]='sorted';
          pushState('sorted', highlight, `After inserting, first ${i+1} elements are sorted`, 1);
        }

        // finished
        pushState('done', (function(){
          const h={};
          for(let k=0;k<n;k++) h[k]='sorted';
          return h;
        })(), 'Array sorted', 1);

        // update counters on final step info
        // but each step already has counters so we'll use the last snapshot's counts.
        return {steps: s, totals: {comp: comps, writes: writes}};
      }

      // Controls and state management
      function updateStatsFromStep(step){
        compEl.textContent = step ? step.compsSoFar : 0;
        writesEl.textContent = step ? step.writesSoFar : 0;
        stepsCountEl.textContent = steps.length;
      }

      function goToStep(index){
        if(index < 0) index = 0;
        if(index >= steps.length) index = steps.length-1;
        currentStep = index;
        const step = steps[currentStep];
        renderArray(step.arr, {highlight: step.highlight});
        highlightPseudocode(step.line);
        descEl.textContent = `Step ${currentStep}/${steps.length-1}: ${step.description}`;
        updateStatsFromStep(step);
      }

      function play(){
        if(playing) return;
        playing = true;
        playBtn.disabled = true;
        pauseBtn.disabled = false;
        const interval = Math.max(40, Number(speedRange.value));
        timer = setInterval(()=>{
          if(currentStep < steps.length-1){
            goToStep(currentStep+1);
          } else {
            pause();
          }
        }, interval);
      }

      function pause(){
        playing = false;
        playBtn.disabled = false;
        pauseBtn.disabled = true;
        if(timer) clearInterval(timer);
        timer = null;
      }

      // UI events
      sizeRange.addEventListener('input', ()=>{
        sizeLabel.textContent = sizeRange.value;
      });

      generateBtn.addEventListener('click', ()=>{
        array = genRandom(Number(sizeRange.value));
        arrInput.value = array.join(',');
        steps = [];
        currentStep = 0;
        renderArray(array, {highlight:{}});
        compEl.textContent = 0;
        writesEl.textContent = 0;
        stepsCountEl.textContent = 0;
        descEl.textContent = 'Random array generated. Press "Prepare Steps" to compute frames.';
        pause();
      });

      prepareBtn.addEventListener('click', ()=>{
        // parse existing array from arrInput if provided; else use current
        const raw = arrInput.value.trim();
        if(raw){
          const parsed = raw.split(',').map(s=>Number(s.trim())).filter(v=>!Number.isNaN(v));
          if(parsed.length>0) array = parsed;
        }
        if(!array || array.length===0){
          array = genRandom(Number(sizeRange.value));
          arrInput.value = array.join(',');
        }
        const order = orderSelect.value;
        const result = buildSteps(array, order);
        steps = result.steps;
        // after building, attach total counts to final step(s) by recalculating not necessary since step snapshots have counters
        currentStep = 0;
        goToStep(0);
        stepsCountEl.textContent = steps.length;
        descEl.textContent = `Prepared ${steps.length} steps. Comparison total: ${result.totals.comp}, writes total: ${result.totals.writes}. Press Play.`;
        pause();
      });

      resetBtn.addEventListener('click', ()=>{
        pause();
        if(steps && steps.length>0){
          currentStep = 0;
          goToStep(0);
        } else {
          renderArray(array, {highlight:{}});
        }
      });

      playBtn.addEventListener('click', ()=>{ play(); });
      pauseBtn.addEventListener('click', ()=>{ pause(); });
      stepFwdBtn.addEventListener('click', ()=>{
        pause();
        if(steps.length===0){
          descEl.textContent = 'No prepared steps. Press "Prepare Steps" first.';
          return;
        }
        if(currentStep < steps.length-1) goToStep(currentStep+1);
      });
      stepBackBtn.addEventListener('click', ()=>{
        pause();
        if(steps.length===0){
          descEl.textContent = 'No prepared steps. Press "Prepare Steps" first.';
          return;
        }
        if(currentStep > 0) goToStep(currentStep-1);
      });

      loadBtn.addEventListener('click', ()=>{
        const raw = arrInput.value.trim();
        if(!raw){ descEl.textContent = 'Please type a comma-separated array in the input.'; return; }
        const parsed = raw.split(',').map(s=>Number(s.trim())).filter(v=>!Number.isNaN(v));
        if(parsed.length===0){ descEl.textContent = 'No valid numbers found in input.'; return; }
        array = parsed;
        sizeRange.value = Math.max(5, Math.min(40, array.length));
        sizeLabel.textContent = sizeRange.value;
        steps = [];
        currentStep = 0;
        renderArray(array, {highlight:{}});
        descEl.textContent = 'Custom array loaded. Press "Prepare Steps" to compute frames.';
        pause();
      });

      // initial preparation
      (function init(){
        array = genRandom(Number(sizeRange.value));
        arrInput.value = array.join(',');
        renderArray(array, {highlight:{}});
        pauseBtn.disabled = true;
      })();

      // accessibility: keyboard shortcuts
      document.addEventListener('keydown', (e)=>{
        if(e.key === ' ') { // space: toggle play/pause
          e.preventDefault();
          if(playing) pause(); else play();
        } else if(e.key === 'ArrowRight'){ stepFwdBtn.click(); }
        else if(e.key === 'ArrowLeft'){ stepBackBtn.click(); }
      });

      // Resize observer to re-render bars responsively
      let resizeObserver = new ResizeObserver(()=>{
        if(steps.length>0) goToStep(currentStep);
        else renderArray(array, {highlight:{}});
      });
      resizeObserver.observe(canvas);
    })();
  </script>
</body>
</html>