<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Insertion Sort Visualization</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f5f7fa;
    color: #333;
  }
  h1 {
    text-align: center;
  }
  #arrayInput {
    width: 300px;
    padding: 8px;
    font-size: 16px;
  }
  #sortBtn {
    padding: 8px 16px;
    font-size: 16px;
    margin-left: 10px;
    cursor: pointer;
  }
  #bars {
    margin-top: 40px;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    height: 300px;
    border: 1px solid #ccc;
    background: white;
    max-width: 90vw;
    overflow-x: auto;
    padding: 10px 0;
  }
  .bar {
    width: 30px;
    margin: 0 3px;
    background-color: #4caf50;
    text-align: center;
    color: white;
    font-weight: bold;
    border-radius: 3px 3px 0 0;
    user-select: none;
    position: relative;
  }
  .bar.current {
    background-color: #ff5722;
  }
  .bar.compared {
    background-color: #2196f3;
  }
  #description {
    max-width: 600px;
    margin: 20px auto;
    font-size: 18px;
    line-height: 1.4;
    background: #e3f2fd;
    padding: 12px 20px;
    border-radius: 8px;
  }
  #speedControl {
    margin: 20px auto;
    max-width: 600px;
    text-align: center;
  }
  #speedControl label {
    margin-right: 10px;
  }
</style>
</head>
<body>
<h1>Insertion Sort Visualization</h1>
<div style="text-align:center;">
  <input id="arrayInput" type="text" placeholder="Enter numbers separated by commas" value="8,5,3,7,6,2,4,1"/>
  <button id="sortBtn">Start Sorting</button>
</div>
<div id="speedControl">
  <label for="speedRange">Animation Speed:</label>
  <input type="range" id="speedRange" min="50" max="2000" step="50" value="500" />
  <span id="speedDisplay">500 ms</span>
</div>
<div id="bars"></div>
<div id="description">
  Enter a sequence of numbers separated by commas above and click "Start Sorting" to see Insertion Sort in action.<br/>
  The red bar is the current key being inserted; blue bars are bars being compared; green bars are sorted or untouched.
</div>

<script>
  const barsContainer = document.getElementById('bars');
  const input = document.getElementById('arrayInput');
  const sortBtn = document.getElementById('sortBtn');
  const speedRange = document.getElementById('speedRange');
  const speedDisplay = document.getElementById('speedDisplay');

  let delay = Number(speedRange.value);

  speedRange.addEventListener('input', () => {
    delay = Number(speedRange.value);
    speedDisplay.textContent = delay + ' ms';
  });

  function createBars(arr) {
    barsContainer.innerHTML = '';
    let maxValue = Math.max(...arr);
    arr.forEach(value => {
      const bar = document.createElement('div');
      bar.classList.add('bar');
      bar.style.height = (value / maxValue) * 250 + 30 + 'px';
      bar.textContent = value;
      barsContainer.appendChild(bar);
    });
  }

  function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  async function insertionSortVisual(arr) {
    const bars = [...barsContainer.children];
    for (let i = 1; i < arr.length; i++) {
      let key = arr[i];
      let j = i - 1;

      bars[i].classList.add('current'); // key element
      await sleep(delay);

      while (j >= 0 && arr[j] > key) {
        bars[j].classList.add('compared');
        bars[j+1].classList.add('compared');
        await sleep(delay);

        arr[j + 1] = arr[j];
        bars[j + 1].style.height = bars[j].style.height;
        bars[j + 1].textContent = bars[j].textContent;

        bars[j].classList.remove('compared');
        bars[j+1].classList.remove('compared');

        j--;
      }
      arr[j + 1] = key;
      bars[j + 1].style.height = ((key / Math.max(...arr)) * 250 + 30) + 'px';
      bars[j + 1].textContent = key;

      bars[i].classList.remove('current');
      await sleep(delay);
    }
    // Final color all bars to indicate finished sorting
    bars.forEach(bar => bar.style.backgroundColor = '#4caf50');
  }

  function validateInput(str) {
    if(!str.trim()) return null;
    const parts = str.split(',').map(s => s.trim());
    if(parts.some(p => p === '' || isNaN(Number(p)))) return null;
    return parts.map(Number);
  }

  sortBtn.addEventListener('click', async () => {
    const arr = validateInput(input.value);
    if (!arr) {
      alert('Please enter a valid sequence of numbers separated by commas!');
      return;
    }
    createBars(arr);
    sortBtn.disabled = true;
    input.disabled = true;
    speedRange.disabled = true;
    await insertionSortVisual(arr);
    sortBtn.disabled = false;
    input.disabled = false;
    speedRange.disabled = false;
  });

  // Initial bars on page load
  window.onload = () => {
    const initialArr = validateInput(input.value) || [8,5,3,7,6,2,4,1];
    createBars(initialArr);
  };
</script>
</body>
</html>