<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quick Sort Visualization</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
      background: #f0f0f0;
      color: #333;
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
    }
    #inputSection {
      text-align: center;
      margin-bottom: 1rem;
    }
    #arrayInput {
      width: 300px;
      padding: 0.5rem;
      font-size: 1rem;
    }
    #sortButton {
      padding: 0.6rem 1.2rem;
      font-size: 1rem;
      margin-left: 0.5rem;
      cursor: pointer;
    }
    #output {
      max-width: 600px;
      margin: 1rem auto;
      background: white;
      padding: 1rem;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
      border-radius: 5px;
      font-family: monospace;
      white-space: pre-wrap;
    }
    #bars {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      height: 160px;
      margin: 2rem auto;
      max-width: 600px;
    }
    .bar {
      margin: 0 2px;
      background-color: steelblue;
      width: 20px;
      transition: background-color 0.3s ease, height 0.3s ease;
      border-radius: 3px 3px 0 0;
    }
    .pivot {
      background-color: #e63946 !important;
    }
    .comparing {
      background-color: #f1c40f !important;
    }
    .swapped {
      background-color: #2ecc71 !important;
    }
  </style>
</head>
<body>
  <h1>Quick Sort Demonstration</h1>
  <div id="inputSection">
    <input
      type="text"
      id="arrayInput"
      placeholder="Enter numbers separated by commas"
      value="8,3,7,6,2,5,4,1"
    />
    <button id="sortButton">Sort</button>
  </div>
  <div id="bars"></div>
  <div id="output"></div>

  <script>
    const arrayInput = document.getElementById("arrayInput");
    const sortButton = document.getElementById("sortButton");
    const barsContainer = document.getElementById("bars");
    const output = document.getElementById("output");

    // Delay helper
    function delay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // Render bars for the array
    function renderBars(arr, highlight = {}) {
      barsContainer.innerHTML = "";
      const maxVal = Math.max(...arr);
      arr.forEach((val, idx) => {
        const bar = document.createElement("div");
        bar.classList.add("bar");
        bar.style.height = ((val / maxVal) * 100 + 20) + "px"; // min height 20px
        if (highlight.pivot === idx) bar.classList.add("pivot");
        if (highlight.comparing && highlight.comparing.includes(idx))
          bar.classList.add("comparing");
        if (highlight.swapped && highlight.swapped.includes(idx))
          bar.classList.add("swapped");
        bar.title = val;
        barsContainer.appendChild(bar);
      });
    }

    // Quick sort with visualization and explanation text
    async function quickSortVisual(arr, low, high) {
      if (low < high) {
        output.textContent += `Calling partition(arr, ${low}, ${high})\n`;
        // Partition and get pivot index
        const pi = await partition(arr, low, high);
        output.textContent += `Pivot is now at index ${pi} with value ${arr[pi]}\n\n`;
        await quickSortVisual(arr, low, pi - 1);
        await quickSortVisual(arr, pi + 1, high);
      } else if (low === high) {
        output.textContent += `Single element at index ${low} (${arr[low]}) - already sorted\n\n`;
      }
    }

    async function partition(arr, low, high) {
      let pivot = arr[high];
      let i = low - 1;
      output.textContent += `Pivot selected: arr[${high}] = ${pivot}\n`;
      renderBars(arr, { pivot: high });
      await delay(1000);

      for (let j = low; j < high; j++) {
        output.textContent += `Compare arr[${j}] = ${arr[j]} with pivot ${pivot}\n`;
        renderBars(arr, { pivot: high, comparing: [j] });
        await delay(700);

        if (arr[j] < pivot) {
          i++;
          [arr[i], arr[j]] = [arr[j], arr[i]];
          output.textContent += `Swap arr[${i}] and arr[${j}] -> [${arr.join(", ")}]\n`;
          renderBars(arr, { pivot: high, swapped: [i, j] });
          await delay(700);
        }
      }
      // Place pivot in correct position
      [arr[i + 1], arr[high]] = [arr[high], arr[i + 1]];
      output.textContent += `Move pivot to correct position by swapping arr[${i + 1}] and arr[${high}] -> [${arr.join(", ")}]\n`;
      renderBars(arr, { swapped: [i + 1, high] });
      await delay(1000);
      return i + 1;
    }

    sortButton.addEventListener("click", async () => {
      output.textContent = "";
      let raw = arrayInput.value.trim();
      if (!raw) {
        alert("Please enter some numbers separated by commas.");
        return;
      }
      let arr = raw.split(",").map(x => Number(x.trim()));
      if (arr.some(isNaN)) {
        alert("Please enter valid numbers only.");
        return;
      }
      renderBars(arr);
      output.textContent += `Starting array: [${arr.join(", ")}]\n\n`;
      sortButton.disabled = true;
      arrayInput.disabled = true;
      await quickSortVisual(arr, 0, arr.length - 1);
      output.textContent += `Sorted array: [${arr.join(", ")}]\n\n`;
      renderBars(arr);
      sortButton.disabled = false;
      arrayInput.disabled = false;
    });

    // Initial render
    (() => {
      let arr = arrayInput.value.trim().split(",").map(x => Number(x.trim()));
      renderBars(arr);
    })();
  </script>
</body>
</html>