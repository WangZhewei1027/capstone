<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Bubble Sort Visualizer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#0f1724;
      --panel:#0b1220;
      --accent:#2dd4bf;
      --muted:#94a3b8;
      --bar:#60a5fa;
      --bar-compare:#fbbf24;
      --bar-swap:#fb7185;
      --bar-sorted:#34d399;
    }
    *{box-sizing:border-box;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
    body{margin:0;background:linear-gradient(180deg,#021124 0%, #071022 60%);color:#e6eef6;min-height:100vh;display:flex;align-items:flex-start;justify-content:center;padding:24px;}
    .container{max-width:1100px;width:100%;}
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px;}
    h1{margin:0;font-size:20px;}
    .panel{background:linear-gradient(180deg,var(--panel),#071229);border-radius:12px;padding:14px;color:var(--muted);box-shadow:0 6px 30px rgba(2,6,23,0.6);}
    .top{display:flex;gap:12px;align-items:center;flex-wrap:wrap;justify-content:space-between;}
    .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
    label{font-size:13px;color:var(--muted);}
    input[type=range]{accent-color:var(--accent);}
    .btn{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#e6eef6;padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:600;}
    .btn.primary{background:linear-gradient(90deg,var(--accent),#60a5fa);color:#001219;border:none;}
    .btn:active{transform:translateY(1px);}
    .controls .group{display:flex;gap:8px;align-items:center;}
    .display{display:flex;gap:12px;align-items:center;}
    .stats{display:flex;gap:12px;align-items:center;color:var(--muted);font-size:13px;}
    .visual{margin-top:14px;padding:14px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:10px;min-height:300px;}
    .bars{display:flex;align-items:flex-end;height:260px;gap:4px;padding:8px;border-radius:6px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);overflow:hidden;}
    .bar{flex:1 1 auto;background:var(--bar);height:40px;border-radius:4px;display:flex;align-items:end;justify-content:center;color:rgba(255,255,255,0.9);font-size:11px;transition:height 200ms ease, background-color 120ms;box-shadow:0 6px 20px rgba(2,6,23,0.45) inset;}
    .bar.small{font-size:9px;padding-bottom:4px;}
    .bar .val{padding-bottom:4px;}
    .help{margin-top:12px;color:var(--muted);font-size:13px;line-height:1.5;}
    .footer{margin-top:10px;color:var(--muted);font-size:12px;display:flex;justify-content:space-between;gap:12px;}
    .input-text{background:transparent;border:1px dashed rgba(255,255,255,0.04);padding:6px 8px;border-radius:6px;color:#e6eef6;min-width:220px;}
    .small{font-size:12px;color:var(--muted);}
    @media (max-width:720px){
      .bars{height:200px;}
      .container{padding:6px;}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Bubble Sort Visualizer</h1>
        <div class="small">Interactive demonstration: watch comparisons and swaps as bubble sort sorts the array.</div>
      </div>
    </header>

    <div class="panel">
      <div class="top">
        <div class="controls">
          <div class="group">
            <label for="size">Size</label>
            <input id="size" type="range" min="5" max="80" value="30">
          </div>

          <div class="group">
            <label for="speed">Speed</label>
            <input id="speed" type="range" min="10" max="1000" value="200">
          </div>

          <div class="group">
            <label for="optimized"><input id="optimized" type="checkbox"> Optimized</label>
          </div>

          <div class="group">
            <button id="shuffle" class="btn">Shuffle</button>
            <button id="start" class="btn primary">Start</button>
            <button id="step" class="btn">Step</button>
            <button id="pause" class="btn">Pause</button>
            <button id="reset" class="btn">Reset</button>
          </div>
        </div>

        <div class="display">
          <div class="stats">
            <div>Comparisons: <span id="comp">0</span></div>
            <div>Swaps: <span id="swaps">0</span></div>
            <div>Pass: <span id="pass">0</span></div>
          </div>
        </div>
      </div>

      <div class="visual">
        <div style="display:flex;gap:10px;align-items:center;margin-bottom:10px;">
          <input id="custom" class="input-text" placeholder="Enter numbers comma-separated (e.g. 5,3,8,1)" />
          <button id="apply" class="btn">Apply</button>
          <div style="flex:1"></div>
          <div class="small">Legend:
            <span style="display:inline-block;width:12px;height:12px;background:var(--bar);margin-left:8px;border-radius:2px;vertical-align:middle;"></span> normal
            <span style="display:inline-block;width:12px;height:12px;background:var(--bar-compare);margin-left:8px;border-radius:2px;vertical-align:middle;"></span> comparing
            <span style="display:inline-block;width:12px;height:12px;background:var(--bar-swap);margin-left:8px;border-radius:2px;vertical-align:middle;"></span> swapping
            <span style="display:inline-block;width:12px;height:12px;background:var(--bar-sorted);margin-left:8px;border-radius:2px;vertical-align:middle;"></span> sorted
          </div>
        </div>

        <div id="bars" class="bars" aria-hidden="false"></div>

        <div class="help">
          Bubble sort repeatedly steps through the list, compares adjacent items and swaps them if they are in the wrong order. This visualization allows step-by-step execution and automatic play. Toggle "Optimized" to stop early when the array becomes sorted.
        </div>
      </div>

      <div class="footer">
        <div>Current indices: i = <span id="idx-i">-</span>, j = <span id="idx-j">-</span></div>
        <div id="status">Status: idle</div>
      </div>
    </div>
  </div>

  <script>
    // Bubble Sort Visualizer
    (function(){
      const barsEl = document.getElementById('bars');
      const sizeInput = document.getElementById('size');
      const speedInput = document.getElementById('speed');
      const optimizedChk = document.getElementById('optimized');
      const shuffleBtn = document.getElementById('shuffle');
      const startBtn = document.getElementById('start');
      const stepBtn = document.getElementById('step');
      const pauseBtn = document.getElementById('pause');
      const resetBtn = document.getElementById('reset');
      const applyBtn = document.getElementById('apply');
      const customInput = document.getElementById('custom');

      const compEl = document.getElementById('comp');
      const swapsEl = document.getElementById('swaps');
      const passEl = document.getElementById('pass');
      const idxI = document.getElementById('idx-i');
      const idxJ = document.getElementById('idx-j');
      const statusEl = document.getElementById('status');

      let arr = [];
      let bars = [];
      let sorter = null;
      let running = false;
      let autoInterval = null;
      let comparisons = 0;
      let swaps = 0;
      let passes = 0;

      function randArray(n){
        const a = [];
        for(let i=0;i<n;i++){
          // generate values 5..100
          a.push(Math.floor(Math.random()*96)+5);
        }
        return a;
      }

      function buildBars(values){
        barsEl.innerHTML = '';
        bars = [];
        const max = Math.max(...values);
        values.forEach((v, idx) => {
          const bar = document.createElement('div');
          bar.className = 'bar';
          if (values.length > 50) bar.classList.add('small');
          bar.style.height = (v / max * 100) + '%';
          bar.dataset.value = v;
          bar.dataset.index = idx;
          const span = document.createElement('div');
          span.className = 'val';
          span.textContent = v;
          bar.appendChild(span);
          barsEl.appendChild(bar);
          bars.push(bar);
        });
      }

      function resetStats(){
        comparisons = 0; swaps = 0; passes = 0;
        compEl.textContent = comparisons;
        swapsEl.textContent = swaps;
        passEl.textContent = passes;
        idxI.textContent = '-';
        idxJ.textContent = '-';
      }

      function setStatus(s){
        statusEl.textContent = 'Status: ' + s;
      }

      function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }

      // generator that yields actions for bubble sort
      function* bubbleGenerator(a, optimized){
        const n = a.length;
        let arr = a.slice();
        let swapped;
        for(let i = 0; i < n - 1; i++){
          swapped = false;
          yield {type:'passStart', pass:i+1, i:i};
          for(let j = 0; j < n - 1 - i; j++){
            yield {type:'compare', i:j, j:j+1};
            if(arr[j] > arr[j+1]){
              // swap
              [arr[j], arr[j+1]] = [arr[j+1], arr[j]];
              yield {type:'swap', i:j, j:j+1, arr: arr.slice()};
              swapped = true;
            }
            yield {type:'afterCompare', i:j, j:j+1};
          }
          yield {type:'passEnd', pass:i+1, i:i, swapped:swapped, sortedIndex: n-1 - i};
          if(optimized && !swapped){
            break;
          }
        }
        yield {type:'done', arr: arr.slice()};
      }

      // Update bar heights and labels from array
      function updateBarsFromArray(values, highlight = {}){
        const max = Math.max(...values);
        bars.forEach((bar, idx) => {
          const v = values[idx];
          bar.style.height = (v / max * 100) + '%';
          bar.dataset.value = v;
          bar.querySelector('.val').textContent = v;
          bar.style.transition = `height ${Math.max(80, speedInput.value/2)}ms ease, background-color 120ms`;
          // reset colors
          bar.style.background = 'var(--bar)';
          bar.style.opacity = '1';
        });

        if(highlight.compare){
          const [i,j] = highlight.compare;
          if(bars[i]) bars[i].style.background = 'var(--bar-compare)';
          if(bars[j]) bars[j].style.background = 'var(--bar-compare)';
        }
        if(highlight.swap){
          const [i,j] = highlight.swap;
          if(bars[i]) bars[i].style.background = 'var(--bar-swap)';
          if(bars[j]) bars[j].style.background = 'var(--bar-swap)';
        }
        if(highlight.sortedIndex !== undefined){
          for(let k = highlight.sortedIndex; k < bars.length; k++){
            if(bars[k]) bars[k].style.background = 'var(--bar-sorted)';
          }
        }
      }

      // Controller to step through generator
      async function stepOnce(){
        if(!sorter) return;
        const {value, done} = sorter.next();
        if(done) {
          finalize();
          return;
        }
        await handleAction(value);
      }

      async function handleAction(action){
        if(!action) return;
        switch(action.type){
          case 'passStart':
            passes = action.pass - 1;
            passEl.textContent = passes;
            setStatus('Running: pass ' + action.pass);
            break;
          case 'compare':
            comparisons++;
            compEl.textContent = comparisons;
            idxI.textContent = action.i;
            idxJ.textContent = action.j;
            updateBarsFromArray(arr, {compare:[action.i, action.j]});
            break;
          case 'afterCompare':
            // short pause for clarity
            updateBarsFromArray(arr);
            break;
          case 'swap':
            swaps++;
            swapsEl.textContent = swaps;
            // update the underlying array immediately for visualization
            arr = action.arr.slice();
            updateBarsFromArray(arr, {swap:[action.i, action.j]});
            break;
          case 'passEnd':
            passes = action.pass;
            passEl.textContent = passes;
            // mark the tail as sorted
            updateBarsFromArray(arr, {sortedIndex: action.sortedIndex});
            if(action.swapped === false){
              setStatus('No swaps in pass, array is sorted (early exit)');
            } else {
              setStatus('Completed pass ' + action.pass);
            }
            break;
          case 'done':
            arr = action.arr.slice();
            updateBarsFromArray(arr, {sortedIndex:0});
            finalize();
            break;
        }
      }

      function finalize(){
        updateBarsFromArray(arr, {sortedIndex:0});
        setStatus('Completed');
        idxI.textContent = '-';
        idxJ.textContent = '-';
        running = false;
        sorter = null;
        if(autoInterval) { clearInterval(autoInterval); autoInterval = null; }
      }

      function startAuto(){
        if(running) return;
        if(!sorter) {
          sorter = bubbleGenerator(arr, optimizedChk.checked);
        }
        running = true;
        setStatus('Running');
        const tick = async () => {
          if(!running) return;
          const speed = Math.max(10, Number(speedInput.value));
          const {value, done} = sorter.next();
          if(done){
            finalize();
            return;
          }
          await handleAction(value);
          if(!running) return;
          // schedule next step according to speed
          autoInterval = setTimeout(tick, speed);
        };
        autoInterval = setTimeout(tick, 0);
      }

      function pauseAuto(){
        running = false;
        if(autoInterval){ clearTimeout(autoInterval); autoInterval = null; }
        setStatus('Paused');
      }

      function reset(){
        pauseAuto();
        arr = randArray(Number(sizeInput.value));
        buildBars(arr);
        resetStats();
        sorter = null;
        setStatus('Idle');
      }

      // Event bindings
      shuffleBtn.addEventListener('click', () => {
        reset();
      });

      startBtn.addEventListener('click', () => {
        if(!sorter){
          // initialize generator with a copy of the array
          sorter = bubbleGenerator(arr.slice(), optimizedChk.checked);
        }
        startAuto();
      });

      pauseBtn.addEventListener('click', () => {
        pauseAuto();
      });

      stepBtn.addEventListener('click', async () => {
        if(!sorter){
          sorter = bubbleGenerator(arr.slice(), optimizedChk.checked);
        }
        pauseAuto();
        await stepOnce();
      });

      resetBtn.addEventListener('click', () => {
        // reset to initial created random array
        pauseAuto();
        sorter = null;
        arr = arr.slice(); // no change, but ensure state
        updateBarsFromArray(arr);
        resetStats();
        setStatus('Reset');
      });

      applyBtn.addEventListener('click', () => {
        const txt = customInput.value.trim();
        if(!txt) return;
        const parts = txt.split(',').map(s=>s.trim()).filter(s=>s!=='');

        const parsed = parts.map(s=> {
          const n = Number(s);
          return Number.isFinite(n) ? n : null;
        });

        if(parsed.some(v=>v===null)){
          alert('Invalid numbers in input. Use comma-separated numeric values.');
          return;
        }
        arr = parsed.slice();
        sizeInput.value = arr.length;
        buildBars(arr);
        resetStats();
        sorter = null;
        setStatus('Applied custom array');
      });

      sizeInput.addEventListener('input', () => {
        const n = Number(sizeInput.value);
        arr = randArray(n);
        buildBars(arr);
        resetStats();
        sorter = null;
      });

      // initialize
      arr = randArray(Number(sizeInput.value));
      buildBars(arr);
      resetStats();
      setStatus('Idle');

      // keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        if(e.key === ' ') { // space toggles start/pause
          e.preventDefault();
          if(running) pauseAuto(); else startBtn.click();
        } else if(e.key === 'ArrowRight'){ // step
          stepBtn.click();
        } else if(e.key === 'r' || e.key === 'R'){
          shuffleBtn.click();
        }
      });

      // ensure bars resize when window changed for better spacing
      window.addEventListener('resize', () => {
        updateBarsFromArray(arr);
      });
    })();
  </script>
</body>
</html>