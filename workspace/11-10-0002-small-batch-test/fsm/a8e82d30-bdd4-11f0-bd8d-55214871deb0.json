{
  "topic": "Interactive Stack Module",
  "description": "Models the interactive states of a visual stack UI supporting push, pop, peek, clear, capacity changes, and keyboard shortcuts with animations and accessibility announcements.",
  "states": [
    {
      "name": "idle",
      "onEnter": "updateUI",
      "onExit": "noop",
      "on": {
        "PUSH_SUBMIT": "pushing",
        "PUSH_EMPTY": "invalidInput",
        "PUSH_OVERFLOW": "overflow",
        "POP_CLICK_VALID": "popping",
        "POP_CLICK_EMPTY": "underflow",
        "PEEK_CLICK_VALID": "peeking",
        "PEEK_CLICK_EMPTY": "underflow",
        "CLEAR_CLICK": "awaitingConfirmation",
        "CAPACITY_CHANGE": "capacityUpdating",
        "ALT_P_FOCUS": "idle",
        "ALT_O_POP_VALID": "popping",
        "ALT_O_POP_EMPTY": "underflow",
        "ALT_K_PEEK_VALID": "peeking",
        "ALT_K_PEEK_EMPTY": "underflow",
        "INPUT_CHANGE": "idle",
        "INVALID_ACK": "idle"
      }
    },
    {
      "name": "invalidInput",
      "onEnter": "announceEnterNonEmpty",
      "onExit": "noop",
      "on": {
        "INPUT_CHANGE": "idle",
        "ACK": "idle",
        "FOCUS_INPUT": "idle"
      }
    },
    {
      "name": "pushing",
      "onEnter": "pushValue; animateIn; updateSizeBadge; updateTopIndicatorPosition; announcePush",
      "onExit": "normalizeIndexes",
      "on": {
        "ANIMATION_END_PUSH": "idle",
        "CANCEL": "idle",
        "PUSH_INTERRUPTED": "idle"
      }
    },
    {
      "name": "popping",
      "onEnter": "animateOutTop; removeTopFromModel; updateSizeBadge; updateTopIndicatorPosition; announcePop",
      "onExit": "noop",
      "on": {
        "ANIMATION_END_POP": "idle",
        "CANCEL": "idle",
        "POP_INTERRUPTED": "idle"
      }
    },
    {
      "name": "peeking",
      "onEnter": "announcePeek; highlightTop",
      "onExit": "noop",
      "on": {
        "HIGHLIGHT_END": "idle",
        "CANCEL": "idle"
      }
    },
    {
      "name": "awaitingConfirmation",
      "onEnter": "showConfirmDialog",
      "onExit": "hideConfirmDialog",
      "on": {
        "CLEAR_CONFIRM": "clearing",
        "CLEAR_CANCEL": "idle",
        "ESCAPE": "idle"
      }
    },
    {
      "name": "clearing",
      "onEnter": "clearAllCards; animateOutAll; updateSizeBadge; updateTopIndicatorPosition; announceClear",
      "onExit": "noop",
      "on": {
        "CLEAR_COMPLETE": "idle"
      }
    },
    {
      "name": "capacityUpdating",
      "onEnter": "applyCapacityChange; announceCapacity; flashIfExceeded",
      "onExit": "noop",
      "on": {
        "CAPACITY_APPLIED": "idle"
      }
    },
    {
      "name": "overflow",
      "onEnter": "announceOverflow; flashCapacityWarning",
      "onExit": "noop",
      "on": {
        "ACK": "idle",
        "POP_CLICK_VALID": "popping",
        "CLEAR_CLICK": "awaitingConfirmation",
        "CAPACITY_CHANGE": "capacityUpdating"
      }
    },
    {
      "name": "underflow",
      "onEnter": "announceUnderflow; flashUnderflow",
      "onExit": "noop",
      "on": {
        "ACK": "idle",
        "CLEAR_CLICK": "awaitingConfirmation",
        "CAPACITY_CHANGE": "capacityUpdating"
      }
    }
  ],
  "events": [
    "PUSH_CLICK",
    "PUSH_SUBMIT",
    "PUSH_EMPTY",
    "PUSH_OVERFLOW",
    "ANIMATION_END_PUSH",
    "POP_CLICK",
    "POP_CLICK_VALID",
    "POP_CLICK_EMPTY",
    "ANIMATION_END_POP",
    "PEEK_CLICK",
    "PEEK_CLICK_VALID",
    "PEEK_CLICK_EMPTY",
    "HIGHLIGHT_END",
    "CLEAR_CLICK",
    "CLEAR_CONFIRM",
    "CLEAR_CANCEL",
    "CLEAR_COMPLETE",
    "CAPACITY_CHANGE",
    "CAPACITY_APPLIED",
    "ALT_P_FOCUS",
    "ALT_O_POP_VALID",
    "ALT_O_POP_EMPTY",
    "ALT_K_PEEK_VALID",
    "ALT_K_PEEK_EMPTY",
    "INPUT_CHANGE",
    "FOCUS_INPUT",
    "ACK",
    "INVALID_ACK",
    "CANCEL",
    "ESCAPE",
    "PUSH_INTERRUPTED",
    "POP_INTERRUPTED"
  ],
  "notes": "States model user-triggered operations and their animated lifecycles. 'pushing' and 'popping' represent transient animation+model-update phases that return to 'idle' on animation end. 'overflow' and 'underflow' are short-lived error feedback states that also allow recovery via ACK, capacity change, pop, or clear. 'awaitingConfirmation' models the browser confirm dialog before clearing. Keyboard shortcuts map to events that either focus input or invoke actions; those flows are represented as separate events for valid / empty conditions (e.g., POP_CLICK_VALID vs POP_CLICK_EMPTY). onEnter action strings describe the primary DOM/model side effects invoked in that state."
}