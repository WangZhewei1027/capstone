<!-- Generate a single HTML file with JavaScript demonstrating k nearest neighbor. Only respond in a single HTML file. 
 
It should be highly interactive, and utilizes multiple web components to show the concept step by step. -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>K-Nearest Neighbors Visualization</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        margin: 0;
        height: 100vh;
      }

      h1 {
        margin-bottom: 20px;
      }

      #chart {
        width: 500px;
        height: 500px;
        border: 1px solid #ccc;
        margin-bottom: 20px;
      }

      #controls {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .slider {
        margin: 10px;
      }

      #step-by-step {
        font-size: 14px;
        text-align: center;
        margin-top: 20px;
      }

      button {
        margin-top: 20px;
        padding: 10px 20px;
        cursor: pointer;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <h1>K-Nearest Neighbors Algorithm</h1>
    <div id="chart"></div>

    <div id="controls">
      <div class="slider">
        <label for="k-value">Choose K (Number of neighbors): </label>
        <input type="range" id="k-value" min="1" max="10" value="3" />
        <span id="k-display">K = 3</span>
      </div>

      <button id="generate">Generate Data</button>
      <button id="clear">Clear Chart</button>
    </div>

    <div id="step-by-step">
      <p>Step 1: Choose K and generate data points.</p>
      <p>Step 2: Add a point to classify, and visualize nearest neighbors.</p>
    </div>

    <script>
      class KNNVisualizer {
        constructor() {
          this.k = 3; // Default k value
          this.points = [];
          this.newPoint = null;
          this.chart = document.getElementById("chart");
          this.kDisplay = document.getElementById("k-display");
          this.stepDisplay = document.getElementById("step-by-step");
          this.generateButton = document.getElementById("generate");
          this.clearButton = document.getElementById("clear");
          this.kInput = document.getElementById("k-value");

          this.generateButton.addEventListener(
            "click",
            this.generateData.bind(this)
          );
          this.clearButton.addEventListener(
            "click",
            this.clearChart.bind(this)
          );
          this.kInput.addEventListener("input", this.updateK.bind(this));

          this.updateK();
        }

        updateK() {
          this.k = parseInt(this.kInput.value);
          this.kDisplay.textContent = `K = ${this.k}`;
        }

        generateData() {
          this.points = [];
          const numPoints = 20;

          for (let i = 0; i < numPoints; i++) {
            const x = Math.random() * this.chart.offsetWidth;
            const y = Math.random() * this.chart.offsetHeight;
            const label = Math.random() > 0.5 ? "A" : "B"; // Randomly assign 'A' or 'B' labels
            this.points.push({ x, y, label });
          }

          this.renderChart();
        }

        clearChart() {
          this.points = [];
          this.newPoint = null;
          this.renderChart();
        }

        renderChart() {
          this.chart.innerHTML = "";
          this.points.forEach((point) => {
            const pointElement = document.createElement("div");
            pointElement.style.position = "absolute";
            pointElement.style.left = `${point.x}px`;
            pointElement.style.top = `${point.y}px`;
            pointElement.style.width = "10px";
            pointElement.style.height = "10px";
            pointElement.style.borderRadius = "50%";
            pointElement.style.backgroundColor =
              point.label === "A" ? "red" : "blue";
            this.chart.appendChild(pointElement);
          });

          if (this.newPoint) {
            this.drawNewPoint();
            this.drawNeighbors();
          }
        }

        drawNewPoint() {
          const pointElement = document.createElement("div");
          pointElement.style.position = "absolute";
          pointElement.style.left = `${this.newPoint.x}px`;
          pointElement.style.top = `${this.newPoint.y}px`;
          pointElement.style.width = "15px";
          pointElement.style.height = "15px";
          pointElement.style.borderRadius = "50%";
          pointElement.style.backgroundColor = "green";
          this.chart.appendChild(pointElement);
        }

        drawNeighbors() {
          const distances = this.points.map((point) => {
            const dist = Math.sqrt(
              Math.pow(point.x - this.newPoint.x, 2) +
                Math.pow(point.y - this.newPoint.y, 2)
            );
            return { point, dist };
          });

          distances.sort((a, b) => a.dist - b.dist);

          const neighbors = distances.slice(0, this.k);
          neighbors.forEach((neighbor) => {
            const line = document.createElement("div");
            const angle = Math.atan2(
              neighbor.point.y - this.newPoint.y,
              neighbor.point.x - this.newPoint.x
            );
            const length = neighbor.dist;

            line.style.position = "absolute";
            line.style.left = `${this.newPoint.x}px`;
            line.style.top = `${this.newPoint.y}px`;
            line.style.width = `${length}px`;
            line.style.height = "2px";
            line.style.backgroundColor = "black";
            line.style.transform = `rotate(${angle}rad)`;
            line.style.transformOrigin = "0% 50%";
            this.chart.appendChild(line);
          });

          const labels = neighbors.map((neighbor) => neighbor.point.label);
          const prediction =
            labels.filter((label) => label === "A").length >
            labels.filter((label) => label === "B").length
              ? "A"
              : "B";
          this.stepDisplay.innerHTML = `<p>Predicted Label: ${prediction}</p>`;
        }

        addNewPoint(event) {
          const rect = this.chart.getBoundingClientRect();
          const x = event.clientX - rect.left;
          const y = event.clientY - rect.top;
          this.newPoint = { x, y };

          this.renderChart();
        }
      }

      const knnVisualizer = new KNNVisualizer();
      document
        .getElementById("chart")
        .addEventListener("click", (event) => knnVisualizer.addNewPoint(event));
    </script>
  </body>
</html>
